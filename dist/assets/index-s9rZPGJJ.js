const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Crx1KA4W.js","assets/index-nibyPLVP.js","assets/index-BTq7eDJq.js","assets/index-kzlEvkEN.js","assets/index-dt1SK_Rg.js","assets/events-DQ172AOg.js","assets/index.es-DcCOHnkq.js"])))=>i.map(i=>d[i]);
var yK=Object.defineProperty;var FD=t=>{throw TypeError(t)};var xK=(t,e,n)=>e in t?yK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var AS=(t,e,n)=>xK(t,typeof e!="symbol"?e+"":e,n),yC=(t,e,n)=>e.has(t)||FD("Cannot "+n);var Dt=(t,e,n)=>(yC(t,e,"read from private field"),n?n.call(t):e.get(t)),Ci=(t,e,n)=>e.has(t)?FD("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ti=(t,e,n,s)=>(yC(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n),_s=(t,e,n)=>(yC(t,e,"access private method"),n);var CS=(t,e,n,s)=>({set _(l){ti(t,e,l,n)},get _(){return Dt(t,e,s)}});function _K(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const l in s)if(l!=="default"&&!(l in t)){const u=Object.getOwnPropertyDescriptor(s,l);u&&Object.defineProperty(t,l,u.get?u:{enumerable:!0,get:()=>s[l]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function n(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(l){if(l.ep)return;l.ep=!0;const u=n(l);fetch(l.href,u)}})();var KAe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function vK(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var l=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,l.get?l:{enumerable:!0,get:function(){return t[s]}})}),n}var xC={exports:{}},_1={},_C={exports:{}},ks={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BD;function bK(){if(BD)return ks;BD=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),p=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),T=Symbol.iterator;function k(Le){return Le===null||typeof Le!="object"?null:(Le=T&&Le[T]||Le["@@iterator"],typeof Le=="function"?Le:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,O={};function F(Le,st,bt){this.props=Le,this.context=st,this.refs=O,this.updater=bt||R}F.prototype.isReactComponent={},F.prototype.setState=function(Le,st){if(typeof Le!="object"&&typeof Le!="function"&&Le!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Le,st,"setState")},F.prototype.forceUpdate=function(Le){this.updater.enqueueForceUpdate(this,Le,"forceUpdate")};function U(){}U.prototype=F.prototype;function X(Le,st,bt){this.props=Le,this.context=st,this.refs=O,this.updater=bt||R}var W=X.prototype=new U;W.constructor=X,D(W,F.prototype),W.isPureReactComponent=!0;var K=Array.isArray,ne=Object.prototype.hasOwnProperty,te={current:null},re={key:!0,ref:!0,__self:!0,__source:!0};function xe(Le,st,bt){var yt,Vt={},_t=null,vt=null;if(st!=null)for(yt in st.ref!==void 0&&(vt=st.ref),st.key!==void 0&&(_t=""+st.key),st)ne.call(st,yt)&&!re.hasOwnProperty(yt)&&(Vt[yt]=st[yt]);var qt=arguments.length-2;if(qt===1)Vt.children=bt;else if(1<qt){for(var kt=Array(qt),on=0;on<qt;on++)kt[on]=arguments[on+2];Vt.children=kt}if(Le&&Le.defaultProps)for(yt in qt=Le.defaultProps,qt)Vt[yt]===void 0&&(Vt[yt]=qt[yt]);return{$$typeof:t,type:Le,key:_t,ref:vt,props:Vt,_owner:te.current}}function ae(Le,st){return{$$typeof:t,type:Le.type,key:st,ref:Le.ref,props:Le.props,_owner:Le._owner}}function ce(Le){return typeof Le=="object"&&Le!==null&&Le.$$typeof===t}function ye(Le){var st={"=":"=0",":":"=2"};return"$"+Le.replace(/[=:]/g,function(bt){return st[bt]})}var Ce=/\/+/g;function Me(Le,st){return typeof Le=="object"&&Le!==null&&Le.key!=null?ye(""+Le.key):st.toString(36)}function Ke(Le,st,bt,yt,Vt){var _t=typeof Le;(_t==="undefined"||_t==="boolean")&&(Le=null);var vt=!1;if(Le===null)vt=!0;else switch(_t){case"string":case"number":vt=!0;break;case"object":switch(Le.$$typeof){case t:case e:vt=!0}}if(vt)return vt=Le,Vt=Vt(vt),Le=yt===""?"."+Me(vt,0):yt,K(Vt)?(bt="",Le!=null&&(bt=Le.replace(Ce,"$&/")+"/"),Ke(Vt,st,bt,"",function(on){return on})):Vt!=null&&(ce(Vt)&&(Vt=ae(Vt,bt+(!Vt.key||vt&&vt.key===Vt.key?"":(""+Vt.key).replace(Ce,"$&/")+"/")+Le)),st.push(Vt)),1;if(vt=0,yt=yt===""?".":yt+":",K(Le))for(var qt=0;qt<Le.length;qt++){_t=Le[qt];var kt=yt+Me(_t,qt);vt+=Ke(_t,st,bt,kt,Vt)}else if(kt=k(Le),typeof kt=="function")for(Le=kt.call(Le),qt=0;!(_t=Le.next()).done;)_t=_t.value,kt=yt+Me(_t,qt++),vt+=Ke(_t,st,bt,kt,Vt);else if(_t==="object")throw st=String(Le),Error("Objects are not valid as a React child (found: "+(st==="[object Object]"?"object with keys {"+Object.keys(Le).join(", ")+"}":st)+"). If you meant to render a collection of children, use an array instead.");return vt}function ke(Le,st,bt){if(Le==null)return Le;var yt=[],Vt=0;return Ke(Le,yt,"","",function(_t){return st.call(bt,_t,Vt++)}),yt}function je(Le){if(Le._status===-1){var st=Le._result;st=st(),st.then(function(bt){(Le._status===0||Le._status===-1)&&(Le._status=1,Le._result=bt)},function(bt){(Le._status===0||Le._status===-1)&&(Le._status=2,Le._result=bt)}),Le._status===-1&&(Le._status=0,Le._result=st)}if(Le._status===1)return Le._result.default;throw Le._result}var $e={current:null},Ae={transition:null},He={ReactCurrentDispatcher:$e,ReactCurrentBatchConfig:Ae,ReactCurrentOwner:te};function qe(){throw Error("act(...) is not supported in production builds of React.")}return ks.Children={map:ke,forEach:function(Le,st,bt){ke(Le,function(){st.apply(this,arguments)},bt)},count:function(Le){var st=0;return ke(Le,function(){st++}),st},toArray:function(Le){return ke(Le,function(st){return st})||[]},only:function(Le){if(!ce(Le))throw Error("React.Children.only expected to receive a single React element child.");return Le}},ks.Component=F,ks.Fragment=n,ks.Profiler=l,ks.PureComponent=X,ks.StrictMode=s,ks.Suspense=v,ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=He,ks.act=qe,ks.cloneElement=function(Le,st,bt){if(Le==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Le+".");var yt=D({},Le.props),Vt=Le.key,_t=Le.ref,vt=Le._owner;if(st!=null){if(st.ref!==void 0&&(_t=st.ref,vt=te.current),st.key!==void 0&&(Vt=""+st.key),Le.type&&Le.type.defaultProps)var qt=Le.type.defaultProps;for(kt in st)ne.call(st,kt)&&!re.hasOwnProperty(kt)&&(yt[kt]=st[kt]===void 0&&qt!==void 0?qt[kt]:st[kt])}var kt=arguments.length-2;if(kt===1)yt.children=bt;else if(1<kt){qt=Array(kt);for(var on=0;on<kt;on++)qt[on]=arguments[on+2];yt.children=qt}return{$$typeof:t,type:Le.type,key:Vt,ref:_t,props:yt,_owner:vt}},ks.createContext=function(Le){return Le={$$typeof:p,_currentValue:Le,_currentValue2:Le,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Le.Provider={$$typeof:u,_context:Le},Le.Consumer=Le},ks.createElement=xe,ks.createFactory=function(Le){var st=xe.bind(null,Le);return st.type=Le,st},ks.createRef=function(){return{current:null}},ks.forwardRef=function(Le){return{$$typeof:r,render:Le}},ks.isValidElement=ce,ks.lazy=function(Le){return{$$typeof:E,_payload:{_status:-1,_result:Le},_init:je}},ks.memo=function(Le,st){return{$$typeof:w,type:Le,compare:st===void 0?null:st}},ks.startTransition=function(Le){var st=Ae.transition;Ae.transition={};try{Le()}finally{Ae.transition=st}},ks.unstable_act=qe,ks.useCallback=function(Le,st){return $e.current.useCallback(Le,st)},ks.useContext=function(Le){return $e.current.useContext(Le)},ks.useDebugValue=function(){},ks.useDeferredValue=function(Le){return $e.current.useDeferredValue(Le)},ks.useEffect=function(Le,st){return $e.current.useEffect(Le,st)},ks.useId=function(){return $e.current.useId()},ks.useImperativeHandle=function(Le,st,bt){return $e.current.useImperativeHandle(Le,st,bt)},ks.useInsertionEffect=function(Le,st){return $e.current.useInsertionEffect(Le,st)},ks.useLayoutEffect=function(Le,st){return $e.current.useLayoutEffect(Le,st)},ks.useMemo=function(Le,st){return $e.current.useMemo(Le,st)},ks.useReducer=function(Le,st,bt){return $e.current.useReducer(Le,st,bt)},ks.useRef=function(Le){return $e.current.useRef(Le)},ks.useState=function(Le){return $e.current.useState(Le)},ks.useSyncExternalStore=function(Le,st,bt){return $e.current.useSyncExternalStore(Le,st,bt)},ks.useTransition=function(){return $e.current.useTransition()},ks.version="18.3.1",ks}var zD;function Kw(){return zD||(zD=1,_C.exports=bK()),_C.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UD;function wK(){if(UD)return _1;UD=1;var t=Kw(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function p(r,v,w){var E,T={},k=null,R=null;w!==void 0&&(k=""+w),v.key!==void 0&&(k=""+v.key),v.ref!==void 0&&(R=v.ref);for(E in v)s.call(v,E)&&!u.hasOwnProperty(E)&&(T[E]=v[E]);if(r&&r.defaultProps)for(E in v=r.defaultProps,v)T[E]===void 0&&(T[E]=v[E]);return{$$typeof:e,type:r,key:k,ref:R,props:T,_owner:l.current}}return _1.Fragment=n,_1.jsx=p,_1.jsxs=p,_1}var VD;function SK(){return VD||(VD=1,xC.exports=wK()),xC.exports}var f=SK(),he=Kw();const fe=Wx(he);var MS={},vC={exports:{}},fu={},bC={exports:{}},wC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HD;function TK(){return HD||(HD=1,(function(t){function e(Ae,He){var qe=Ae.length;Ae.push(He);e:for(;0<qe;){var Le=qe-1>>>1,st=Ae[Le];if(0<l(st,He))Ae[Le]=He,Ae[qe]=st,qe=Le;else break e}}function n(Ae){return Ae.length===0?null:Ae[0]}function s(Ae){if(Ae.length===0)return null;var He=Ae[0],qe=Ae.pop();if(qe!==He){Ae[0]=qe;e:for(var Le=0,st=Ae.length,bt=st>>>1;Le<bt;){var yt=2*(Le+1)-1,Vt=Ae[yt],_t=yt+1,vt=Ae[_t];if(0>l(Vt,qe))_t<st&&0>l(vt,Vt)?(Ae[Le]=vt,Ae[_t]=qe,Le=_t):(Ae[Le]=Vt,Ae[yt]=qe,Le=yt);else if(_t<st&&0>l(vt,qe))Ae[Le]=vt,Ae[_t]=qe,Le=_t;else break e}}return He}function l(Ae,He){var qe=Ae.sortIndex-He.sortIndex;return qe!==0?qe:Ae.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var p=Date,r=p.now();t.unstable_now=function(){return p.now()-r}}var v=[],w=[],E=1,T=null,k=3,R=!1,D=!1,O=!1,F=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function W(Ae){for(var He=n(w);He!==null;){if(He.callback===null)s(w);else if(He.startTime<=Ae)s(w),He.sortIndex=He.expirationTime,e(v,He);else break;He=n(w)}}function K(Ae){if(O=!1,W(Ae),!D)if(n(v)!==null)D=!0,je(ne);else{var He=n(w);He!==null&&$e(K,He.startTime-Ae)}}function ne(Ae,He){D=!1,O&&(O=!1,U(xe),xe=-1),R=!0;var qe=k;try{for(W(He),T=n(v);T!==null&&(!(T.expirationTime>He)||Ae&&!ye());){var Le=T.callback;if(typeof Le=="function"){T.callback=null,k=T.priorityLevel;var st=Le(T.expirationTime<=He);He=t.unstable_now(),typeof st=="function"?T.callback=st:T===n(v)&&s(v),W(He)}else s(v);T=n(v)}if(T!==null)var bt=!0;else{var yt=n(w);yt!==null&&$e(K,yt.startTime-He),bt=!1}return bt}finally{T=null,k=qe,R=!1}}var te=!1,re=null,xe=-1,ae=5,ce=-1;function ye(){return!(t.unstable_now()-ce<ae)}function Ce(){if(re!==null){var Ae=t.unstable_now();ce=Ae;var He=!0;try{He=re(!0,Ae)}finally{He?Me():(te=!1,re=null)}}else te=!1}var Me;if(typeof X=="function")Me=function(){X(Ce)};else if(typeof MessageChannel<"u"){var Ke=new MessageChannel,ke=Ke.port2;Ke.port1.onmessage=Ce,Me=function(){ke.postMessage(null)}}else Me=function(){F(Ce,0)};function je(Ae){re=Ae,te||(te=!0,Me())}function $e(Ae,He){xe=F(function(){Ae(t.unstable_now())},He)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ae){Ae.callback=null},t.unstable_continueExecution=function(){D||R||(D=!0,je(ne))},t.unstable_forceFrameRate=function(Ae){0>Ae||125<Ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<Ae?Math.floor(1e3/Ae):5},t.unstable_getCurrentPriorityLevel=function(){return k},t.unstable_getFirstCallbackNode=function(){return n(v)},t.unstable_next=function(Ae){switch(k){case 1:case 2:case 3:var He=3;break;default:He=k}var qe=k;k=He;try{return Ae()}finally{k=qe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ae,He){switch(Ae){case 1:case 2:case 3:case 4:case 5:break;default:Ae=3}var qe=k;k=Ae;try{return He()}finally{k=qe}},t.unstable_scheduleCallback=function(Ae,He,qe){var Le=t.unstable_now();switch(typeof qe=="object"&&qe!==null?(qe=qe.delay,qe=typeof qe=="number"&&0<qe?Le+qe:Le):qe=Le,Ae){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=qe+st,Ae={id:E++,callback:He,priorityLevel:Ae,startTime:qe,expirationTime:st,sortIndex:-1},qe>Le?(Ae.sortIndex=qe,e(w,Ae),n(v)===null&&Ae===n(w)&&(O?(U(xe),xe=-1):O=!0,$e(K,qe-Le))):(Ae.sortIndex=st,e(v,Ae),D||R||(D=!0,je(ne))),Ae},t.unstable_shouldYield=ye,t.unstable_wrapCallback=function(Ae){var He=k;return function(){var qe=k;k=He;try{return Ae.apply(this,arguments)}finally{k=qe}}}})(wC)),wC}var GD;function EK(){return GD||(GD=1,bC.exports=TK()),bC.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $D;function AK(){if($D)return fu;$D=1;var t=Kw(),e=EK();function n(b){for(var M="https://reactjs.org/docs/error-decoder.html?invariant="+b,B=1;B<arguments.length;B++)M+="&args[]="+encodeURIComponent(arguments[B]);return"Minified React error #"+b+"; visit "+M+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,l={};function u(b,M){p(b,M),p(b+"Capture",M)}function p(b,M){for(l[b]=M,b=0;b<M.length;b++)s.add(M[b])}var r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,E={},T={};function k(b){return v.call(T,b)?!0:v.call(E,b)?!1:w.test(b)?T[b]=!0:(E[b]=!0,!1)}function R(b,M,B,Z){if(B!==null&&B.type===0)return!1;switch(typeof M){case"function":case"symbol":return!0;case"boolean":return Z?!1:B!==null?!B.acceptsBooleans:(b=b.toLowerCase().slice(0,5),b!=="data-"&&b!=="aria-");default:return!1}}function D(b,M,B,Z){if(M===null||typeof M>"u"||R(b,M,B,Z))return!0;if(Z)return!1;if(B!==null)switch(B.type){case 3:return!M;case 4:return M===!1;case 5:return isNaN(M);case 6:return isNaN(M)||1>M}return!1}function O(b,M,B,Z,se,ge,Ue){this.acceptsBooleans=M===2||M===3||M===4,this.attributeName=Z,this.attributeNamespace=se,this.mustUseProperty=B,this.propertyName=b,this.type=M,this.sanitizeURL=ge,this.removeEmptyString=Ue}var F={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(b){F[b]=new O(b,0,!1,b,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(b){var M=b[0];F[M]=new O(M,1,!1,b[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(b){F[b]=new O(b,2,!1,b.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(b){F[b]=new O(b,2,!1,b,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(b){F[b]=new O(b,3,!1,b.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(b){F[b]=new O(b,3,!0,b,null,!1,!1)}),["capture","download"].forEach(function(b){F[b]=new O(b,4,!1,b,null,!1,!1)}),["cols","rows","size","span"].forEach(function(b){F[b]=new O(b,6,!1,b,null,!1,!1)}),["rowSpan","start"].forEach(function(b){F[b]=new O(b,5,!1,b.toLowerCase(),null,!1,!1)});var U=/[\-:]([a-z])/g;function X(b){return b[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(b){var M=b.replace(U,X);F[M]=new O(M,1,!1,b,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(b){var M=b.replace(U,X);F[M]=new O(M,1,!1,b,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(b){var M=b.replace(U,X);F[M]=new O(M,1,!1,b,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(b){F[b]=new O(b,1,!1,b.toLowerCase(),null,!1,!1)}),F.xlinkHref=new O("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(b){F[b]=new O(b,1,!1,b.toLowerCase(),null,!0,!0)});function W(b,M,B,Z){var se=F.hasOwnProperty(M)?F[M]:null;(se!==null?se.type!==0:Z||!(2<M.length)||M[0]!=="o"&&M[0]!=="O"||M[1]!=="n"&&M[1]!=="N")&&(D(M,B,se,Z)&&(B=null),Z||se===null?k(M)&&(B===null?b.removeAttribute(M):b.setAttribute(M,""+B)):se.mustUseProperty?b[se.propertyName]=B===null?se.type===3?!1:"":B:(M=se.attributeName,Z=se.attributeNamespace,B===null?b.removeAttribute(M):(se=se.type,B=se===3||se===4&&B===!0?"":""+B,Z?b.setAttributeNS(Z,M,B):b.setAttribute(M,B))))}var K=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ne=Symbol.for("react.element"),te=Symbol.for("react.portal"),re=Symbol.for("react.fragment"),xe=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),ce=Symbol.for("react.provider"),ye=Symbol.for("react.context"),Ce=Symbol.for("react.forward_ref"),Me=Symbol.for("react.suspense"),Ke=Symbol.for("react.suspense_list"),ke=Symbol.for("react.memo"),je=Symbol.for("react.lazy"),$e=Symbol.for("react.offscreen"),Ae=Symbol.iterator;function He(b){return b===null||typeof b!="object"?null:(b=Ae&&b[Ae]||b["@@iterator"],typeof b=="function"?b:null)}var qe=Object.assign,Le;function st(b){if(Le===void 0)try{throw Error()}catch(B){var M=B.stack.trim().match(/\n( *(at )?)/);Le=M&&M[1]||""}return`
`+Le+b}var bt=!1;function yt(b,M){if(!b||bt)return"";bt=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(M)if(M=function(){throw Error()},Object.defineProperty(M.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(M,[])}catch(Tn){var Z=Tn}Reflect.construct(b,[],M)}else{try{M.call()}catch(Tn){Z=Tn}b.call(M.prototype)}else{try{throw Error()}catch(Tn){Z=Tn}b()}}catch(Tn){if(Tn&&Z&&typeof Tn.stack=="string"){for(var se=Tn.stack.split(`
`),ge=Z.stack.split(`
`),Ue=se.length-1,xt=ge.length-1;1<=Ue&&0<=xt&&se[Ue]!==ge[xt];)xt--;for(;1<=Ue&&0<=xt;Ue--,xt--)if(se[Ue]!==ge[xt]){if(Ue!==1||xt!==1)do if(Ue--,xt--,0>xt||se[Ue]!==ge[xt]){var Ft=`
`+se[Ue].replace(" at new "," at ");return b.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",b.displayName)),Ft}while(1<=Ue&&0<=xt);break}}}finally{bt=!1,Error.prepareStackTrace=B}return(b=b?b.displayName||b.name:"")?st(b):""}function Vt(b){switch(b.tag){case 5:return st(b.type);case 16:return st("Lazy");case 13:return st("Suspense");case 19:return st("SuspenseList");case 0:case 2:case 15:return b=yt(b.type,!1),b;case 11:return b=yt(b.type.render,!1),b;case 1:return b=yt(b.type,!0),b;default:return""}}function _t(b){if(b==null)return null;if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case re:return"Fragment";case te:return"Portal";case ae:return"Profiler";case xe:return"StrictMode";case Me:return"Suspense";case Ke:return"SuspenseList"}if(typeof b=="object")switch(b.$$typeof){case ye:return(b.displayName||"Context")+".Consumer";case ce:return(b._context.displayName||"Context")+".Provider";case Ce:var M=b.render;return b=b.displayName,b||(b=M.displayName||M.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case ke:return M=b.displayName||null,M!==null?M:_t(b.type)||"Memo";case je:M=b._payload,b=b._init;try{return _t(b(M))}catch{}}return null}function vt(b){var M=b.type;switch(b.tag){case 24:return"Cache";case 9:return(M.displayName||"Context")+".Consumer";case 10:return(M._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return b=M.render,b=b.displayName||b.name||"",M.displayName||(b!==""?"ForwardRef("+b+")":"ForwardRef");case 7:return"Fragment";case 5:return M;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _t(M);case 8:return M===xe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof M=="function")return M.displayName||M.name||null;if(typeof M=="string")return M}return null}function qt(b){switch(typeof b){case"boolean":case"number":case"string":case"undefined":return b;case"object":return b;default:return""}}function kt(b){var M=b.type;return(b=b.nodeName)&&b.toLowerCase()==="input"&&(M==="checkbox"||M==="radio")}function on(b){var M=kt(b)?"checked":"value",B=Object.getOwnPropertyDescriptor(b.constructor.prototype,M),Z=""+b[M];if(!b.hasOwnProperty(M)&&typeof B<"u"&&typeof B.get=="function"&&typeof B.set=="function"){var se=B.get,ge=B.set;return Object.defineProperty(b,M,{configurable:!0,get:function(){return se.call(this)},set:function(Ue){Z=""+Ue,ge.call(this,Ue)}}),Object.defineProperty(b,M,{enumerable:B.enumerable}),{getValue:function(){return Z},setValue:function(Ue){Z=""+Ue},stopTracking:function(){b._valueTracker=null,delete b[M]}}}}function mn(b){b._valueTracker||(b._valueTracker=on(b))}function Hr(b){if(!b)return!1;var M=b._valueTracker;if(!M)return!0;var B=M.getValue(),Z="";return b&&(Z=kt(b)?b.checked?"true":"false":b.value),b=Z,b!==B?(M.setValue(b),!0):!1}function Un(b){if(b=b||(typeof document<"u"?document:void 0),typeof b>"u")return null;try{return b.activeElement||b.body}catch{return b.body}}function $r(b,M){var B=M.checked;return qe({},M,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:B??b._wrapperState.initialChecked})}function ht(b,M){var B=M.defaultValue==null?"":M.defaultValue,Z=M.checked!=null?M.checked:M.defaultChecked;B=qt(M.value!=null?M.value:B),b._wrapperState={initialChecked:Z,initialValue:B,controlled:M.type==="checkbox"||M.type==="radio"?M.checked!=null:M.value!=null}}function Lr(b,M){M=M.checked,M!=null&&W(b,"checked",M,!1)}function Br(b,M){Lr(b,M);var B=qt(M.value),Z=M.type;if(B!=null)Z==="number"?(B===0&&b.value===""||b.value!=B)&&(b.value=""+B):b.value!==""+B&&(b.value=""+B);else if(Z==="submit"||Z==="reset"){b.removeAttribute("value");return}M.hasOwnProperty("value")?Nn(b,M.type,B):M.hasOwnProperty("defaultValue")&&Nn(b,M.type,qt(M.defaultValue)),M.checked==null&&M.defaultChecked!=null&&(b.defaultChecked=!!M.defaultChecked)}function wn(b,M,B){if(M.hasOwnProperty("value")||M.hasOwnProperty("defaultValue")){var Z=M.type;if(!(Z!=="submit"&&Z!=="reset"||M.value!==void 0&&M.value!==null))return;M=""+b._wrapperState.initialValue,B||M===b.value||(b.value=M),b.defaultValue=M}B=b.name,B!==""&&(b.name=""),b.defaultChecked=!!b._wrapperState.initialChecked,B!==""&&(b.name=B)}function Nn(b,M,B){(M!=="number"||Un(b.ownerDocument)!==b)&&(B==null?b.defaultValue=""+b._wrapperState.initialValue:b.defaultValue!==""+B&&(b.defaultValue=""+B))}var mr=Array.isArray;function Qn(b,M,B,Z){if(b=b.options,M){M={};for(var se=0;se<B.length;se++)M["$"+B[se]]=!0;for(B=0;B<b.length;B++)se=M.hasOwnProperty("$"+b[B].value),b[B].selected!==se&&(b[B].selected=se),se&&Z&&(b[B].defaultSelected=!0)}else{for(B=""+qt(B),M=null,se=0;se<b.length;se++){if(b[se].value===B){b[se].selected=!0,Z&&(b[se].defaultSelected=!0);return}M!==null||b[se].disabled||(M=b[se])}M!==null&&(M.selected=!0)}}function Nt(b,M){if(M.dangerouslySetInnerHTML!=null)throw Error(n(91));return qe({},M,{value:void 0,defaultValue:void 0,children:""+b._wrapperState.initialValue})}function et(b,M){var B=M.value;if(B==null){if(B=M.children,M=M.defaultValue,B!=null){if(M!=null)throw Error(n(92));if(mr(B)){if(1<B.length)throw Error(n(93));B=B[0]}M=B}M==null&&(M=""),B=M}b._wrapperState={initialValue:qt(B)}}function Oe(b,M){var B=qt(M.value),Z=qt(M.defaultValue);B!=null&&(B=""+B,B!==b.value&&(b.value=B),M.defaultValue==null&&b.defaultValue!==B&&(b.defaultValue=B)),Z!=null&&(b.defaultValue=""+Z)}function Bt(b){var M=b.textContent;M===b._wrapperState.initialValue&&M!==""&&M!==null&&(b.value=M)}function En(b){switch(b){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Dn(b,M){return b==null||b==="http://www.w3.org/1999/xhtml"?En(M):b==="http://www.w3.org/2000/svg"&&M==="foreignObject"?"http://www.w3.org/1999/xhtml":b}var rn,wr=(function(b){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(M,B,Z,se){MSApp.execUnsafeLocalFunction(function(){return b(M,B,Z,se)})}:b})(function(b,M){if(b.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in b)b.innerHTML=M;else{for(rn=rn||document.createElement("div"),rn.innerHTML="<svg>"+M.valueOf().toString()+"</svg>",M=rn.firstChild;b.firstChild;)b.removeChild(b.firstChild);for(;M.firstChild;)b.appendChild(M.firstChild)}});function cr(b,M){if(M){var B=b.firstChild;if(B&&B===b.lastChild&&B.nodeType===3){B.nodeValue=M;return}}b.textContent=M}var Jn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ir=["Webkit","ms","Moz","O"];Object.keys(Jn).forEach(function(b){ir.forEach(function(M){M=M+b.charAt(0).toUpperCase()+b.substring(1),Jn[M]=Jn[b]})});function bn(b,M,B){return M==null||typeof M=="boolean"||M===""?"":B||typeof M!="number"||M===0||Jn.hasOwnProperty(b)&&Jn[b]?(""+M).trim():M+"px"}function In(b,M){b=b.style;for(var B in M)if(M.hasOwnProperty(B)){var Z=B.indexOf("--")===0,se=bn(B,M[B],Z);B==="float"&&(B="cssFloat"),Z?b.setProperty(B,se):b[B]=se}}var Zr=qe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vr(b,M){if(M){if(Zr[b]&&(M.children!=null||M.dangerouslySetInnerHTML!=null))throw Error(n(137,b));if(M.dangerouslySetInnerHTML!=null){if(M.children!=null)throw Error(n(60));if(typeof M.dangerouslySetInnerHTML!="object"||!("__html"in M.dangerouslySetInnerHTML))throw Error(n(61))}if(M.style!=null&&typeof M.style!="object")throw Error(n(62))}}function qn(b,M){if(b.indexOf("-")===-1)return typeof M.is=="string";switch(b){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kn=null;function St(b){return b=b.target||b.srcElement||window,b.correspondingUseElement&&(b=b.correspondingUseElement),b.nodeType===3?b.parentNode:b}var Gn=null,er=null,gr=null;function nr(b){if(b=kf(b)){if(typeof Gn!="function")throw Error(n(280));var M=b.stateNode;M&&(M=Ah(M),Gn(b.stateNode,b.type,M))}}function ln(b){er?gr?gr.push(b):gr=[b]:er=b}function Tr(){if(er){var b=er,M=gr;if(gr=er=null,nr(b),M)for(b=0;b<M.length;b++)nr(M[b])}}function ni(b,M){return b(M)}function Yi(){}var ns=!1;function Ht(b,M,B){if(ns)return b(M,B);ns=!0;try{return ni(b,M,B)}finally{ns=!1,(er!==null||gr!==null)&&(Yi(),Tr())}}function cs(b,M){var B=b.stateNode;if(B===null)return null;var Z=Ah(B);if(Z===null)return null;B=Z[M];e:switch(M){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(Z=!Z.disabled)||(b=b.type,Z=!(b==="button"||b==="input"||b==="select"||b==="textarea")),b=!Z;break e;default:b=!1}if(b)return null;if(B&&typeof B!="function")throw Error(n(231,M,typeof B));return B}var rl=!1;if(r)try{var ho={};Object.defineProperty(ho,"passive",{get:function(){rl=!0}}),window.addEventListener("test",ho,ho),window.removeEventListener("test",ho,ho)}catch{rl=!1}function Qr(b,M,B,Z,se,ge,Ue,xt,Ft){var Tn=Array.prototype.slice.call(arguments,3);try{M.apply(B,Tn)}catch(or){this.onError(or)}}var Rs=!1,ea=null,Hl=!1,ut=null,me={onError:function(b){Rs=!0,ea=b}};function ve(b,M,B,Z,se,ge,Ue,xt,Ft){Rs=!1,ea=null,Qr.apply(me,arguments)}function Fe(b,M,B,Z,se,ge,Ue,xt,Ft){if(ve.apply(this,arguments),Rs){if(Rs){var Tn=ea;Rs=!1,ea=null}else throw Error(n(198));Hl||(Hl=!0,ut=Tn)}}function tt(b){var M=b,B=b;if(b.alternate)for(;M.return;)M=M.return;else{b=M;do M=b,(M.flags&4098)!==0&&(B=M.return),b=M.return;while(b)}return M.tag===3?B:null}function Je(b){if(b.tag===13){var M=b.memoizedState;if(M===null&&(b=b.alternate,b!==null&&(M=b.memoizedState)),M!==null)return M.dehydrated}return null}function at(b){if(tt(b)!==b)throw Error(n(188))}function Pt(b){var M=b.alternate;if(!M){if(M=tt(b),M===null)throw Error(n(188));return M!==b?null:b}for(var B=b,Z=M;;){var se=B.return;if(se===null)break;var ge=se.alternate;if(ge===null){if(Z=se.return,Z!==null){B=Z;continue}break}if(se.child===ge.child){for(ge=se.child;ge;){if(ge===B)return at(se),b;if(ge===Z)return at(se),M;ge=ge.sibling}throw Error(n(188))}if(B.return!==Z.return)B=se,Z=ge;else{for(var Ue=!1,xt=se.child;xt;){if(xt===B){Ue=!0,B=se,Z=ge;break}if(xt===Z){Ue=!0,Z=se,B=ge;break}xt=xt.sibling}if(!Ue){for(xt=ge.child;xt;){if(xt===B){Ue=!0,B=ge,Z=se;break}if(xt===Z){Ue=!0,Z=ge,B=se;break}xt=xt.sibling}if(!Ue)throw Error(n(189))}}if(B.alternate!==Z)throw Error(n(190))}if(B.tag!==3)throw Error(n(188));return B.stateNode.current===B?b:M}function ct(b){return b=Pt(b),b!==null?Ct(b):null}function Ct(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){var M=Ct(b);if(M!==null)return M;b=b.sibling}return null}var un=e.unstable_scheduleCallback,tn=e.unstable_cancelCallback,Re=e.unstable_shouldYield,gt=e.unstable_requestPaint,wt=e.unstable_now,It=e.unstable_getCurrentPriorityLevel,Et=e.unstable_ImmediatePriority,Sn=e.unstable_UserBlockingPriority,Hn=e.unstable_NormalPriority,xr=e.unstable_LowPriority,vr=e.unstable_IdlePriority,jr=null,Er=null;function fr(b){if(Er&&typeof Er.onCommitFiberRoot=="function")try{Er.onCommitFiberRoot(jr,b,void 0,(b.current.flags&128)===128)}catch{}}var ur=Math.clz32?Math.clz32:li,ai=Math.log,vi=Math.LN2;function li(b){return b>>>=0,b===0?32:31-(ai(b)/vi|0)|0}var ii=64,Or=4194304;function Qi(b){switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return b&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return b}}function Ni(b,M){var B=b.pendingLanes;if(B===0)return 0;var Z=0,se=b.suspendedLanes,ge=b.pingedLanes,Ue=B&268435455;if(Ue!==0){var xt=Ue&~se;xt!==0?Z=Qi(xt):(ge&=Ue,ge!==0&&(Z=Qi(ge)))}else Ue=B&~se,Ue!==0?Z=Qi(Ue):ge!==0&&(Z=Qi(ge));if(Z===0)return 0;if(M!==0&&M!==Z&&(M&se)===0&&(se=Z&-Z,ge=M&-M,se>=ge||se===16&&(ge&4194240)!==0))return M;if((Z&4)!==0&&(Z|=B&16),M=b.entangledLanes,M!==0)for(b=b.entanglements,M&=Z;0<M;)B=31-ur(M),se=1<<B,Z|=b[B],M&=~se;return Z}function ko(b,M){switch(b){case 1:case 2:case 4:return M+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return M+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gs(b,M){for(var B=b.suspendedLanes,Z=b.pingedLanes,se=b.expirationTimes,ge=b.pendingLanes;0<ge;){var Ue=31-ur(ge),xt=1<<Ue,Ft=se[Ue];Ft===-1?((xt&B)===0||(xt&Z)!==0)&&(se[Ue]=ko(xt,M)):Ft<=M&&(b.expiredLanes|=xt),ge&=~xt}}function Zs(b){return b=b.pendingLanes&-1073741825,b!==0?b:b&1073741824?1073741824:0}function mo(){var b=ii;return ii<<=1,(ii&4194240)===0&&(ii=64),b}function ds(b){for(var M=[],B=0;31>B;B++)M.push(b);return M}function Is(b,M,B){b.pendingLanes|=M,M!==536870912&&(b.suspendedLanes=0,b.pingedLanes=0),b=b.eventTimes,M=31-ur(M),b[M]=B}function eo(b,M){var B=b.pendingLanes&~M;b.pendingLanes=M,b.suspendedLanes=0,b.pingedLanes=0,b.expiredLanes&=M,b.mutableReadLanes&=M,b.entangledLanes&=M,M=b.entanglements;var Z=b.eventTimes;for(b=b.expirationTimes;0<B;){var se=31-ur(B),ge=1<<se;M[se]=0,Z[se]=-1,b[se]=-1,B&=~ge}}function wo(b,M){var B=b.entangledLanes|=M;for(b=b.entanglements;B;){var Z=31-ur(B),se=1<<Z;se&M|b[Z]&M&&(b[Z]|=M),B&=~se}}var ji=0;function Zc(b){return b&=-b,1<b?4<b?(b&268435455)!==0?16:536870912:4:1}var il,ca,Gl,ua,sl,mc=!1,Qc=[],gc=null,yc=null,da=null,$l=new Map,ch=new Map,Cu=[],Wl="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hg(b,M){switch(b){case"focusin":case"focusout":gc=null;break;case"dragenter":case"dragleave":yc=null;break;case"mouseover":case"mouseout":da=null;break;case"pointerover":case"pointerout":$l.delete(M.pointerId);break;case"gotpointercapture":case"lostpointercapture":ch.delete(M.pointerId)}}function xc(b,M,B,Z,se,ge){return b===null||b.nativeEvent!==ge?(b={blockedOn:M,domEventName:B,eventSystemFlags:Z,nativeEvent:ge,targetContainers:[se]},M!==null&&(M=kf(M),M!==null&&ca(M)),b):(b.eventSystemFlags|=Z,M=b.targetContainers,se!==null&&M.indexOf(se)===-1&&M.push(se),b)}function uh(b,M,B,Z,se){switch(M){case"focusin":return gc=xc(gc,b,M,B,Z,se),!0;case"dragenter":return yc=xc(yc,b,M,B,Z,se),!0;case"mouseover":return da=xc(da,b,M,B,Z,se),!0;case"pointerover":var ge=se.pointerId;return $l.set(ge,xc($l.get(ge)||null,b,M,B,Z,se)),!0;case"gotpointercapture":return ge=se.pointerId,ch.set(ge,xc(ch.get(ge)||null,b,M,B,Z,se)),!0}return!1}function fg(b){var M=jd(b.target);if(M!==null){var B=tt(M);if(B!==null){if(M=B.tag,M===13){if(M=Je(B),M!==null){b.blockedOn=M,sl(b.priority,function(){Gl(B)});return}}else if(M===3&&B.stateNode.current.memoizedState.isDehydrated){b.blockedOn=B.tag===3?B.stateNode.containerInfo:null;return}}}b.blockedOn=null}function xd(b){if(b.blockedOn!==null)return!1;for(var M=b.targetContainers;0<M.length;){var B=pg(b.domEventName,b.eventSystemFlags,M[0],b.nativeEvent);if(B===null){B=b.nativeEvent;var Z=new B.constructor(B.type,B);Kn=Z,B.target.dispatchEvent(Z),Kn=null}else return M=kf(B),M!==null&&ca(M),b.blockedOn=B,!1;M.shift()}return!0}function dh(b,M,B){xd(b)&&B.delete(M)}function Di(){mc=!1,gc!==null&&xd(gc)&&(gc=null),yc!==null&&xd(yc)&&(yc=null),da!==null&&xd(da)&&(da=null),$l.forEach(dh),ch.forEach(dh)}function hh(b,M){b.blockedOn===M&&(b.blockedOn=null,mc||(mc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Di)))}function Mu(b){function M(se){return hh(se,b)}if(0<Qc.length){hh(Qc[0],b);for(var B=1;B<Qc.length;B++){var Z=Qc[B];Z.blockedOn===b&&(Z.blockedOn=null)}}for(gc!==null&&hh(gc,b),yc!==null&&hh(yc,b),da!==null&&hh(da,b),$l.forEach(M),ch.forEach(M),B=0;B<Cu.length;B++)Z=Cu[B],Z.blockedOn===b&&(Z.blockedOn=null);for(;0<Cu.length&&(B=Cu[0],B.blockedOn===null);)fg(B),B.blockedOn===null&&Cu.shift()}var Kc=K.ReactCurrentBatchConfig,gf=!0;function Cp(b,M,B,Z){var se=ji,ge=Kc.transition;Kc.transition=null;try{ji=1,fh(b,M,B,Z)}finally{ji=se,Kc.transition=ge}}function Mp(b,M,B,Z){var se=ji,ge=Kc.transition;Kc.transition=null;try{ji=4,fh(b,M,B,Z)}finally{ji=se,Kc.transition=ge}}function fh(b,M,B,Z){if(gf){var se=pg(b,M,B,Z);if(se===null)wg(b,M,Z,Yc,B),hg(b,Z);else if(uh(se,b,M,B,Z))Z.stopPropagation();else if(hg(b,Z),M&4&&-1<Wl.indexOf(b)){for(;se!==null;){var ge=kf(se);if(ge!==null&&il(ge),ge=pg(b,M,B,Z),ge===null&&wg(b,M,Z,Yc,B),ge===se)break;se=ge}se!==null&&Z.stopPropagation()}else wg(b,M,Z,null,B)}}var Yc=null;function pg(b,M,B,Z){if(Yc=null,b=St(Z),b=jd(b),b!==null)if(M=tt(b),M===null)b=null;else if(B=M.tag,B===13){if(b=Je(M),b!==null)return b;b=null}else if(B===3){if(M.stateNode.current.memoizedState.isDehydrated)return M.tag===3?M.stateNode.containerInfo:null;b=null}else M!==b&&(b=null);return Yc=b,null}function kp(b){switch(b){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(It()){case Et:return 1;case Sn:return 4;case Hn:case xr:return 16;case vr:return 536870912;default:return 16}default:return 16}}var _d=null,ph=null,wa=null;function yf(){if(wa)return wa;var b,M=ph,B=M.length,Z,se="value"in _d?_d.value:_d.textContent,ge=se.length;for(b=0;b<B&&M[b]===se[b];b++);var Ue=B-b;for(Z=1;Z<=Ue&&M[B-Z]===se[ge-Z];Z++);return wa=se.slice(b,1<Z?1-Z:void 0)}function ku(b){var M=b.keyCode;return"charCode"in b?(b=b.charCode,b===0&&M===13&&(b=13)):b=M,b===10&&(b=13),32<=b||b===13?b:0}function vd(){return!0}function Jc(){return!1}function bs(b){function M(B,Z,se,ge,Ue){this._reactName=B,this._targetInst=se,this.type=Z,this.nativeEvent=ge,this.target=Ue,this.currentTarget=null;for(var xt in b)b.hasOwnProperty(xt)&&(B=b[xt],this[xt]=B?B(ge):ge[xt]);return this.isDefaultPrevented=(ge.defaultPrevented!=null?ge.defaultPrevented:ge.returnValue===!1)?vd:Jc,this.isPropagationStopped=Jc,this}return qe(M.prototype,{preventDefault:function(){this.defaultPrevented=!0;var B=this.nativeEvent;B&&(B.preventDefault?B.preventDefault():typeof B.returnValue!="unknown"&&(B.returnValue=!1),this.isDefaultPrevented=vd)},stopPropagation:function(){var B=this.nativeEvent;B&&(B.stopPropagation?B.stopPropagation():typeof B.cancelBubble!="unknown"&&(B.cancelBubble=!0),this.isPropagationStopped=vd)},persist:function(){},isPersistent:vd}),M}var bd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(b){return b.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ip=bs(bd),mh=qe({},bd,{view:0,detail:0}),Wi=bs(mh),Pp,mg,xf,Ar=qe({},mh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:io,button:0,buttons:0,relatedTarget:function(b){return b.relatedTarget===void 0?b.fromElement===b.srcElement?b.toElement:b.fromElement:b.relatedTarget},movementX:function(b){return"movementX"in b?b.movementX:(b!==xf&&(xf&&b.type==="mousemove"?(Pp=b.screenX-xf.screenX,mg=b.screenY-xf.screenY):mg=Pp=0,xf=b),Pp)},movementY:function(b){return"movementY"in b?b.movementY:mg}}),_f=bs(Ar),Iu=qe({},Ar,{dataTransfer:0}),ql=bs(Iu),Xl=qe({},mh,{relatedTarget:0}),wd=bs(Xl),sr=qe({},bd,{animationName:0,elapsedTime:0,pseudoElement:0}),Ii=bs(sr),Ui=qe({},bd,{clipboardData:function(b){return"clipboardData"in b?b.clipboardData:window.clipboardData}}),ol=bs(Ui),vf=qe({},bd,{data:0}),qi=bs(vf),Rp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Np={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bo(b){var M=this.nativeEvent;return M.getModifierState?M.getModifierState(b):(b=Np[b])?!!M[b]:!1}function io(){return Bo}var Mb=qe({},mh,{key:function(b){if(b.key){var M=Rp[b.key]||b.key;if(M!=="Unidentified")return M}return b.type==="keypress"?(b=ku(b),b===13?"Enter":String.fromCharCode(b)):b.type==="keydown"||b.type==="keyup"?gh[b.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:io,charCode:function(b){return b.type==="keypress"?ku(b):0},keyCode:function(b){return b.type==="keydown"||b.type==="keyup"?b.keyCode:0},which:function(b){return b.type==="keypress"?ku(b):b.type==="keydown"||b.type==="keyup"?b.keyCode:0}}),jp=bs(Mb),ey=qe({},Ar,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bf=bs(ey),gg=qe({},mh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:io}),ty=bs(gg),Dp=qe({},bd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Io=bs(Dp),Pu=qe({},Ar,{deltaX:function(b){return"deltaX"in b?b.deltaX:"wheelDeltaX"in b?-b.wheelDeltaX:0},deltaY:function(b){return"deltaY"in b?b.deltaY:"wheelDeltaY"in b?-b.wheelDeltaY:"wheelDelta"in b?-b.wheelDelta:0},deltaZ:0,deltaMode:0}),za=bs(Pu),yg=[9,13,27,32],Sd=r&&"CompositionEvent"in window,so=null;r&&"documentMode"in document&&(so=document.documentMode);var eu=r&&"TextEvent"in window&&!so,tu=r&&(!Sd||so&&8<so&&11>=so),$s=" ",si=!1;function Xn(b,M){switch(b){case"keyup":return yg.indexOf(M.keyCode)!==-1;case"keydown":return M.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Td(b){return b=b.detail,typeof b=="object"&&"data"in b?b.data:null}var Cr=!1;function wf(b,M){switch(b){case"compositionend":return Td(M);case"keypress":return M.which!==32?null:(si=!0,$s);case"textInput":return b=M.data,b===$s&&si?null:b;default:return null}}function xg(b,M){if(Cr)return b==="compositionend"||!Sd&&Xn(b,M)?(b=yf(),wa=ph=_d=null,Cr=!1,b):null;switch(b){case"paste":return null;case"keypress":if(!(M.ctrlKey||M.altKey||M.metaKey)||M.ctrlKey&&M.altKey){if(M.char&&1<M.char.length)return M.char;if(M.which)return String.fromCharCode(M.which)}return null;case"compositionend":return tu&&M.locale!=="ko"?null:M.data;default:return null}}var Dr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Sf(b){var M=b&&b.nodeName&&b.nodeName.toLowerCase();return M==="input"?!!Dr[b.type]:M==="textarea"}function Lp(b,M,B,Z){ln(Z),M=Sg(M,"onChange"),0<M.length&&(B=new Ip("onChange","change",null,B,Z),b.push({event:B,listeners:M}))}var Tf=null,al=null;function _g(b){vh(b,0)}function go(b){var M=wc(b);if(Hr(M))return b}function ha(b,M){if(b==="change")return M}var Ed=!1;if(r){var Ad;if(r){var _c="oninput"in document;if(!_c){var Po=document.createElement("div");Po.setAttribute("oninput","return;"),_c=typeof Po.oninput=="function"}Ad=_c}else Ad=!1;Ed=Ad&&(!document.documentMode||9<document.documentMode)}function e_(){Tf&&(Tf.detachEvent("onpropertychange",t_),al=Tf=null)}function t_(b){if(b.propertyName==="value"&&go(al)){var M=[];Lp(M,al,b,St(b)),Ht(_g,M)}}function Op(b,M,B){b==="focusin"?(e_(),Tf=M,al=B,Tf.attachEvent("onpropertychange",t_)):b==="focusout"&&e_()}function Cd(b){if(b==="selectionchange"||b==="keyup"||b==="keydown")return go(al)}function n_(b,M){if(b==="click")return go(M)}function Zl(b,M){if(b==="input"||b==="change")return go(M)}function r_(b,M){return b===M&&(b!==0||1/b===1/M)||b!==b&&M!==M}var ll=typeof Object.is=="function"?Object.is:r_;function Ru(b,M){if(ll(b,M))return!0;if(typeof b!="object"||b===null||typeof M!="object"||M===null)return!1;var B=Object.keys(b),Z=Object.keys(M);if(B.length!==Z.length)return!1;for(Z=0;Z<B.length;Z++){var se=B[Z];if(!v.call(M,se)||!ll(b[se],M[se]))return!1}return!0}function Nu(b){for(;b&&b.firstChild;)b=b.firstChild;return b}function i_(b,M){var B=Nu(b);b=0;for(var Z;B;){if(B.nodeType===3){if(Z=b+B.textContent.length,b<=M&&Z>=M)return{node:B,offset:M-b};b=Z}e:{for(;B;){if(B.nextSibling){B=B.nextSibling;break e}B=B.parentNode}B=void 0}B=Nu(B)}}function ny(b,M){return b&&M?b===M?!0:b&&b.nodeType===3?!1:M&&M.nodeType===3?ny(b,M.parentNode):"contains"in b?b.contains(M):b.compareDocumentPosition?!!(b.compareDocumentPosition(M)&16):!1:!1}function s_(){for(var b=window,M=Un();M instanceof b.HTMLIFrameElement;){try{var B=typeof M.contentWindow.location.href=="string"}catch{B=!1}if(B)b=M.contentWindow;else break;M=Un(b.document)}return M}function nu(b){var M=b&&b.nodeName&&b.nodeName.toLowerCase();return M&&(M==="input"&&(b.type==="text"||b.type==="search"||b.type==="tel"||b.type==="url"||b.type==="password")||M==="textarea"||b.contentEditable==="true")}function kb(b){var M=s_(),B=b.focusedElem,Z=b.selectionRange;if(M!==B&&B&&B.ownerDocument&&ny(B.ownerDocument.documentElement,B)){if(Z!==null&&nu(B)){if(M=Z.start,b=Z.end,b===void 0&&(b=M),"selectionStart"in B)B.selectionStart=M,B.selectionEnd=Math.min(b,B.value.length);else if(b=(M=B.ownerDocument||document)&&M.defaultView||window,b.getSelection){b=b.getSelection();var se=B.textContent.length,ge=Math.min(Z.start,se);Z=Z.end===void 0?ge:Math.min(Z.end,se),!b.extend&&ge>Z&&(se=Z,Z=ge,ge=se),se=i_(B,ge);var Ue=i_(B,Z);se&&Ue&&(b.rangeCount!==1||b.anchorNode!==se.node||b.anchorOffset!==se.offset||b.focusNode!==Ue.node||b.focusOffset!==Ue.offset)&&(M=M.createRange(),M.setStart(se.node,se.offset),b.removeAllRanges(),ge>Z?(b.addRange(M),b.extend(Ue.node,Ue.offset)):(M.setEnd(Ue.node,Ue.offset),b.addRange(M)))}}for(M=[],b=B;b=b.parentNode;)b.nodeType===1&&M.push({element:b,left:b.scrollLeft,top:b.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<M.length;B++)b=M[B],b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}var ry=r&&"documentMode"in document&&11>=document.documentMode,ju=null,Fp=null,yh=null,cl=!1;function Md(b,M,B){var Z=B.window===B?B.document:B.nodeType===9?B:B.ownerDocument;cl||ju==null||ju!==Un(Z)||(Z=ju,"selectionStart"in Z&&nu(Z)?Z={start:Z.selectionStart,end:Z.selectionEnd}:(Z=(Z.ownerDocument&&Z.ownerDocument.defaultView||window).getSelection(),Z={anchorNode:Z.anchorNode,anchorOffset:Z.anchorOffset,focusNode:Z.focusNode,focusOffset:Z.focusOffset}),yh&&Ru(yh,Z)||(yh=Z,Z=Sg(Fp,"onSelect"),0<Z.length&&(M=new Ip("onSelect","select",null,M,B),b.push({event:M,listeners:Z}),M.target=ju)))}function kd(b,M){var B={};return B[b.toLowerCase()]=M.toLowerCase(),B["Webkit"+b]="webkit"+M,B["Moz"+b]="moz"+M,B}var Id={animationend:kd("Animation","AnimationEnd"),animationiteration:kd("Animation","AnimationIteration"),animationstart:kd("Animation","AnimationStart"),transitionend:kd("Transition","TransitionEnd")},Bp={},xh={};r&&(xh=document.createElement("div").style,"AnimationEvent"in window||(delete Id.animationend.animation,delete Id.animationiteration.animation,delete Id.animationstart.animation),"TransitionEvent"in window||delete Id.transitionend.transition);function Du(b){if(Bp[b])return Bp[b];if(!Id[b])return b;var M=Id[b],B;for(B in M)if(M.hasOwnProperty(B)&&B in xh)return Bp[b]=M[B];return b}var vg=Du("animationend"),zp=Du("animationiteration"),ul=Du("animationstart"),Up=Du("transitionend"),xn=new Map,bg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Al(b,M){xn.set(b,M),u(M,[b])}for(var Pd=0;Pd<bg.length;Pd++){var _h=bg[Pd],Vp=_h.toLowerCase(),ru=_h[0].toUpperCase()+_h.slice(1);Al(Vp,"on"+ru)}Al(vg,"onAnimationEnd"),Al(zp,"onAnimationIteration"),Al(ul,"onAnimationStart"),Al("dblclick","onDoubleClick"),Al("focusin","onFocus"),Al("focusout","onBlur"),Al(Up,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ql=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rd));function xi(b,M,B){var Z=b.type||"unknown-event";b.currentTarget=B,Fe(Z,M,void 0,b),b.currentTarget=null}function vh(b,M){M=(M&4)!==0;for(var B=0;B<b.length;B++){var Z=b[B],se=Z.event;Z=Z.listeners;e:{var ge=void 0;if(M)for(var Ue=Z.length-1;0<=Ue;Ue--){var xt=Z[Ue],Ft=xt.instance,Tn=xt.currentTarget;if(xt=xt.listener,Ft!==ge&&se.isPropagationStopped())break e;xi(se,xt,Tn),ge=Ft}else for(Ue=0;Ue<Z.length;Ue++){if(xt=Z[Ue],Ft=xt.instance,Tn=xt.currentTarget,xt=xt.listener,Ft!==ge&&se.isPropagationStopped())break e;xi(se,xt,Tn),ge=Ft}}}if(Hl)throw b=ut,Hl=!1,ut=null,b}function co(b,M){var B=M[Mf];B===void 0&&(B=M[Mf]=new Set);var Z=b+"__bubble";B.has(Z)||(Es(M,b,2,!1),B.add(Z))}function iy(b,M,B){var Z=0;M&&(Z|=4),Es(B,b,Z,M)}var bh="_reactListening"+Math.random().toString(36).slice(2);function Hp(b){if(!b[bh]){b[bh]=!0,s.forEach(function(B){B!=="selectionchange"&&(Ql.has(B)||iy(B,!1,b),iy(B,!0,b))});var M=b.nodeType===9?b:b.ownerDocument;M===null||M[bh]||(M[bh]=!0,iy("selectionchange",!1,M))}}function Es(b,M,B,Z){switch(kp(M)){case 1:var se=Cp;break;case 4:se=Mp;break;default:se=fh}B=se.bind(null,M,B,b),se=void 0,!rl||M!=="touchstart"&&M!=="touchmove"&&M!=="wheel"||(se=!0),Z?se!==void 0?b.addEventListener(M,B,{capture:!0,passive:se}):b.addEventListener(M,B,!0):se!==void 0?b.addEventListener(M,B,{passive:se}):b.addEventListener(M,B,!1)}function wg(b,M,B,Z,se){var ge=Z;if((M&1)===0&&(M&2)===0&&Z!==null)e:for(;;){if(Z===null)return;var Ue=Z.tag;if(Ue===3||Ue===4){var xt=Z.stateNode.containerInfo;if(xt===se||xt.nodeType===8&&xt.parentNode===se)break;if(Ue===4)for(Ue=Z.return;Ue!==null;){var Ft=Ue.tag;if((Ft===3||Ft===4)&&(Ft=Ue.stateNode.containerInfo,Ft===se||Ft.nodeType===8&&Ft.parentNode===se))return;Ue=Ue.return}for(;xt!==null;){if(Ue=jd(xt),Ue===null)return;if(Ft=Ue.tag,Ft===5||Ft===6){Z=ge=Ue;continue e}xt=xt.parentNode}}Z=Z.return}Ht(function(){var Tn=ge,or=St(B),yr=[];e:{var ar=xn.get(b);if(ar!==void 0){var ri=Ip,ci=b;switch(b){case"keypress":if(ku(B)===0)break e;case"keydown":case"keyup":ri=jp;break;case"focusin":ci="focus",ri=wd;break;case"focusout":ci="blur",ri=wd;break;case"beforeblur":case"afterblur":ri=wd;break;case"click":if(B.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ri=_f;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ri=ql;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ri=ty;break;case vg:case zp:case ul:ri=Ii;break;case Up:ri=Io;break;case"scroll":ri=Wi;break;case"wheel":ri=za;break;case"copy":case"cut":case"paste":ri=ol;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ri=bf}var Yr=(M&4)!==0,no=!Yr&&b==="scroll",cn=Yr?ar!==null?ar+"Capture":null:ar;Yr=[];for(var Xt=Tn,pn;Xt!==null;){pn=Xt;var Sr=pn.stateNode;if(pn.tag===5&&Sr!==null&&(pn=Sr,cn!==null&&(Sr=cs(Xt,cn),Sr!=null&&Yr.push(wh(Xt,Sr,pn)))),no)break;Xt=Xt.return}0<Yr.length&&(ar=new ri(ar,ci,null,B,or),yr.push({event:ar,listeners:Yr}))}}if((M&7)===0){e:{if(ar=b==="mouseover"||b==="pointerover",ri=b==="mouseout"||b==="pointerout",ar&&B!==Kn&&(ci=B.relatedTarget||B.fromElement)&&(jd(ci)||ci[bc]))break e;if((ri||ar)&&(ar=or.window===or?or:(ar=or.ownerDocument)?ar.defaultView||ar.parentWindow:window,ri?(ci=B.relatedTarget||B.toElement,ri=Tn,ci=ci?jd(ci):null,ci!==null&&(no=tt(ci),ci!==no||ci.tag!==5&&ci.tag!==6)&&(ci=null)):(ri=null,ci=Tn),ri!==ci)){if(Yr=_f,Sr="onMouseLeave",cn="onMouseEnter",Xt="mouse",(b==="pointerout"||b==="pointerover")&&(Yr=bf,Sr="onPointerLeave",cn="onPointerEnter",Xt="pointer"),no=ri==null?ar:wc(ri),pn=ci==null?ar:wc(ci),ar=new Yr(Sr,Xt+"leave",ri,B,or),ar.target=no,ar.relatedTarget=pn,Sr=null,jd(or)===Tn&&(Yr=new Yr(cn,Xt+"enter",ci,B,or),Yr.target=pn,Yr.relatedTarget=no,Sr=Yr),no=Sr,ri&&ci)t:{for(Yr=ri,cn=ci,Xt=0,pn=Yr;pn;pn=Ef(pn))Xt++;for(pn=0,Sr=cn;Sr;Sr=Ef(Sr))pn++;for(;0<Xt-pn;)Yr=Ef(Yr),Xt--;for(;0<pn-Xt;)cn=Ef(cn),pn--;for(;Xt--;){if(Yr===cn||cn!==null&&Yr===cn.alternate)break t;Yr=Ef(Yr),cn=Ef(cn)}Yr=null}else Yr=null;ri!==null&&o_(yr,ar,ri,Yr,!1),ci!==null&&no!==null&&o_(yr,no,ci,Yr,!0)}}e:{if(ar=Tn?wc(Tn):window,ri=ar.nodeName&&ar.nodeName.toLowerCase(),ri==="select"||ri==="input"&&ar.type==="file")var hi=ha;else if(Sf(ar))if(Ed)hi=Zl;else{hi=Cd;var Ai=Op}else(ri=ar.nodeName)&&ri.toLowerCase()==="input"&&(ar.type==="checkbox"||ar.type==="radio")&&(hi=n_);if(hi&&(hi=hi(b,Tn))){Lp(yr,hi,B,or);break e}Ai&&Ai(b,ar,Tn),b==="focusout"&&(Ai=ar._wrapperState)&&Ai.controlled&&ar.type==="number"&&Nn(ar,"number",ar.value)}switch(Ai=Tn?wc(Tn):window,b){case"focusin":(Sf(Ai)||Ai.contentEditable==="true")&&(ju=Ai,Fp=Tn,yh=null);break;case"focusout":yh=Fp=ju=null;break;case"mousedown":cl=!0;break;case"contextmenu":case"mouseup":case"dragend":cl=!1,Md(yr,B,or);break;case"selectionchange":if(ry)break;case"keydown":case"keyup":Md(yr,B,or)}var Mi;if(Sd)e:{switch(b){case"compositionstart":var Fi="onCompositionStart";break e;case"compositionend":Fi="onCompositionEnd";break e;case"compositionupdate":Fi="onCompositionUpdate";break e}Fi=void 0}else Cr?Xn(b,B)&&(Fi="onCompositionEnd"):b==="keydown"&&B.keyCode===229&&(Fi="onCompositionStart");Fi&&(tu&&B.locale!=="ko"&&(Cr||Fi!=="onCompositionStart"?Fi==="onCompositionEnd"&&Cr&&(Mi=yf()):(_d=or,ph="value"in _d?_d.value:_d.textContent,Cr=!0)),Ai=Sg(Tn,Fi),0<Ai.length&&(Fi=new qi(Fi,b,null,B,or),yr.push({event:Fi,listeners:Ai}),Mi?Fi.data=Mi:(Mi=Td(B),Mi!==null&&(Fi.data=Mi)))),(Mi=eu?wf(b,B):xg(b,B))&&(Tn=Sg(Tn,"onBeforeInput"),0<Tn.length&&(or=new qi("onBeforeInput","beforeinput",null,B,or),yr.push({event:or,listeners:Tn}),or.data=Mi))}vh(yr,M)})}function wh(b,M,B){return{instance:b,listener:M,currentTarget:B}}function Sg(b,M){for(var B=M+"Capture",Z=[];b!==null;){var se=b,ge=se.stateNode;se.tag===5&&ge!==null&&(se=ge,ge=cs(b,B),ge!=null&&Z.unshift(wh(b,ge,se)),ge=cs(b,M),ge!=null&&Z.push(wh(b,ge,se))),b=b.return}return Z}function Ef(b){if(b===null)return null;do b=b.return;while(b&&b.tag!==5);return b||null}function o_(b,M,B,Z,se){for(var ge=M._reactName,Ue=[];B!==null&&B!==Z;){var xt=B,Ft=xt.alternate,Tn=xt.stateNode;if(Ft!==null&&Ft===Z)break;xt.tag===5&&Tn!==null&&(xt=Tn,se?(Ft=cs(B,ge),Ft!=null&&Ue.unshift(wh(B,Ft,xt))):se||(Ft=cs(B,ge),Ft!=null&&Ue.push(wh(B,Ft,xt)))),B=B.return}Ue.length!==0&&b.push({event:M,listeners:Ue})}var Ib=/\r\n?/g,a_=/\u0000|\uFFFD/g;function l_(b){return(typeof b=="string"?b:""+b).replace(Ib,`
`).replace(a_,"")}function Sh(b,M,B){if(M=l_(M),l_(b)!==M&&B)throw Error(n(425))}function Tg(){}var Eg=null,Gp=null;function Af(b,M){return b==="textarea"||b==="noscript"||typeof M.children=="string"||typeof M.children=="number"||typeof M.dangerouslySetInnerHTML=="object"&&M.dangerouslySetInnerHTML!==null&&M.dangerouslySetInnerHTML.__html!=null}var $p=typeof setTimeout=="function"?setTimeout:void 0,Th=typeof clearTimeout=="function"?clearTimeout:void 0,Eh=typeof Promise=="function"?Promise:void 0,Wp=typeof queueMicrotask=="function"?queueMicrotask:typeof Eh<"u"?function(b){return Eh.resolve(null).then(b).catch(Cf)}:$p;function Cf(b){setTimeout(function(){throw b})}function Ag(b,M){var B=M,Z=0;do{var se=B.nextSibling;if(b.removeChild(B),se&&se.nodeType===8)if(B=se.data,B==="/$"){if(Z===0){b.removeChild(se),Mu(M);return}Z--}else B!=="$"&&B!=="$?"&&B!=="$!"||Z++;B=se}while(B);Mu(M)}function iu(b){for(;b!=null;b=b.nextSibling){var M=b.nodeType;if(M===1||M===3)break;if(M===8){if(M=b.data,M==="$"||M==="$!"||M==="$?")break;if(M==="/$")return null}}return b}function sy(b){b=b.previousSibling;for(var M=0;b;){if(b.nodeType===8){var B=b.data;if(B==="$"||B==="$!"||B==="$?"){if(M===0)return b;M--}else B==="/$"&&M++}b=b.previousSibling}return null}var vc=Math.random().toString(36).slice(2),Cl="__reactFiber$"+vc,Nd="__reactProps$"+vc,bc="__reactContainer$"+vc,Mf="__reactEvents$"+vc,qp="__reactListeners$"+vc,c_="__reactHandles$"+vc;function jd(b){var M=b[Cl];if(M)return M;for(var B=b.parentNode;B;){if(M=B[bc]||B[Cl]){if(B=M.alternate,M.child!==null||B!==null&&B.child!==null)for(b=sy(b);b!==null;){if(B=b[Cl])return B;b=sy(b)}return M}b=B,B=b.parentNode}return null}function kf(b){return b=b[Cl]||b[bc],!b||b.tag!==5&&b.tag!==6&&b.tag!==13&&b.tag!==3?null:b}function wc(b){if(b.tag===5||b.tag===6)return b.stateNode;throw Error(n(33))}function Ah(b){return b[Nd]||null}var oy=[],Ch=-1;function Dd(b){return{current:b}}function to(b){0>Ch||(b.current=oy[Ch],oy[Ch]=null,Ch--)}function Qs(b,M){Ch++,oy[Ch]=b.current,b.current=M}var Sc={},Go=Dd(Sc),zo=Dd(!1),Lu=Sc;function Mh(b,M){var B=b.type.contextTypes;if(!B)return Sc;var Z=b.stateNode;if(Z&&Z.__reactInternalMemoizedUnmaskedChildContext===M)return Z.__reactInternalMemoizedMaskedChildContext;var se={},ge;for(ge in B)se[ge]=M[ge];return Z&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=M,b.__reactInternalMemoizedMaskedChildContext=se),se}function ta(b){return b=b.childContextTypes,b!=null}function su(){to(zo),to(Go)}function Xp(b,M,B){if(Go.current!==Sc)throw Error(n(168));Qs(Go,M),Qs(zo,B)}function dl(b,M,B){var Z=b.stateNode;if(M=M.childContextTypes,typeof Z.getChildContext!="function")return B;Z=Z.getChildContext();for(var se in Z)if(!(se in M))throw Error(n(108,vt(b)||"Unknown",se));return qe({},B,Z)}function If(b){return b=(b=b.stateNode)&&b.__reactInternalMemoizedMergedChildContext||Sc,Lu=Go.current,Qs(Go,b),Qs(zo,zo.current),!0}function Pf(b,M,B){var Z=b.stateNode;if(!Z)throw Error(n(169));B?(b=dl(b,M,Lu),Z.__reactInternalMemoizedMergedChildContext=b,to(zo),to(Go),Qs(Go,b)):to(zo),Qs(zo,B)}var Ml=null,Rf=!1,Zp=!1;function Cg(b){Ml===null?Ml=[b]:Ml.push(b)}function Qp(b){Rf=!0,Cg(b)}function Tc(){if(!Zp&&Ml!==null){Zp=!0;var b=0,M=ji;try{var B=Ml;for(ji=1;b<B.length;b++){var Z=B[b];do Z=Z(!0);while(Z!==null)}Ml=null,Rf=!1}catch(se){throw Ml!==null&&(Ml=Ml.slice(b+1)),un(Et,Tc),se}finally{ji=M,Zp=!1}}return null}var Ec=[],Ou=0,kh=null,Kp=0,kl=[],fa=0,Ld=null,ou=1,Fu="";function Ih(b,M){Ec[Ou++]=Kp,Ec[Ou++]=kh,kh=b,Kp=M}function u_(b,M,B){kl[fa++]=ou,kl[fa++]=Fu,kl[fa++]=Ld,Ld=b;var Z=ou;b=Fu;var se=32-ur(Z)-1;Z&=~(1<<se),B+=1;var ge=32-ur(M)+se;if(30<ge){var Ue=se-se%5;ge=(Z&(1<<Ue)-1).toString(32),Z>>=Ue,se-=Ue,ou=1<<32-ur(M)+se|B<<se|Z,Fu=ge+b}else ou=1<<ge|B<<se|Z,Fu=b}function Nf(b){b.return!==null&&(Ih(b,1),u_(b,1,0))}function Yp(b){for(;b===kh;)kh=Ec[--Ou],Ec[Ou]=null,Kp=Ec[--Ou],Ec[Ou]=null;for(;b===Ld;)Ld=kl[--fa],kl[fa]=null,Fu=kl[--fa],kl[fa]=null,ou=kl[--fa],kl[fa]=null}var Ua=null,hl=null,Ws=!1,Il=null;function ay(b,M){var B=gi(5,null,null,0);B.elementType="DELETED",B.stateNode=M,B.return=b,M=b.deletions,M===null?(b.deletions=[B],b.flags|=16):M.push(B)}function ly(b,M){switch(b.tag){case 5:var B=b.type;return M=M.nodeType!==1||B.toLowerCase()!==M.nodeName.toLowerCase()?null:M,M!==null?(b.stateNode=M,Ua=b,hl=iu(M.firstChild),!0):!1;case 6:return M=b.pendingProps===""||M.nodeType!==3?null:M,M!==null?(b.stateNode=M,Ua=b,hl=null,!0):!1;case 13:return M=M.nodeType!==8?null:M,M!==null?(B=Ld!==null?{id:ou,overflow:Fu}:null,b.memoizedState={dehydrated:M,treeContext:B,retryLane:1073741824},B=gi(18,null,null,0),B.stateNode=M,B.return=b,b.child=B,Ua=b,hl=null,!0):!1;default:return!1}}function jf(b){return(b.mode&1)!==0&&(b.flags&128)===0}function Ac(b){if(Ws){var M=hl;if(M){var B=M;if(!ly(b,M)){if(jf(b))throw Error(n(418));M=iu(B.nextSibling);var Z=Ua;M&&ly(b,M)?ay(Z,B):(b.flags=b.flags&-4097|2,Ws=!1,Ua=b)}}else{if(jf(b))throw Error(n(418));b.flags=b.flags&-4097|2,Ws=!1,Ua=b}}}function Df(b){for(b=b.return;b!==null&&b.tag!==5&&b.tag!==3&&b.tag!==13;)b=b.return;Ua=b}function Ph(b){if(b!==Ua)return!1;if(!Ws)return Df(b),Ws=!0,!1;var M;if((M=b.tag!==3)&&!(M=b.tag!==5)&&(M=b.type,M=M!=="head"&&M!=="body"&&!Af(b.type,b.memoizedProps)),M&&(M=hl)){if(jf(b))throw Od(),Error(n(418));for(;M;)ay(b,M),M=iu(M.nextSibling)}if(Df(b),b.tag===13){if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));e:{for(b=b.nextSibling,M=0;b;){if(b.nodeType===8){var B=b.data;if(B==="/$"){if(M===0){hl=iu(b.nextSibling);break e}M--}else B!=="$"&&B!=="$!"&&B!=="$?"||M++}b=b.nextSibling}hl=null}}else hl=Ua?iu(b.stateNode.nextSibling):null;return!0}function Od(){for(var b=hl;b;)b=iu(b.nextSibling)}function Pl(){hl=Ua=null,Ws=!1}function Jp(b){Il===null?Il=[b]:Il.push(b)}var Mg=K.ReactCurrentBatchConfig;function Rh(b,M,B){if(b=B.ref,b!==null&&typeof b!="function"&&typeof b!="object"){if(B._owner){if(B=B._owner,B){if(B.tag!==1)throw Error(n(309));var Z=B.stateNode}if(!Z)throw Error(n(147,b));var se=Z,ge=""+b;return M!==null&&M.ref!==null&&typeof M.ref=="function"&&M.ref._stringRef===ge?M.ref:(M=function(Ue){var xt=se.refs;Ue===null?delete xt[ge]:xt[ge]=Ue},M._stringRef=ge,M)}if(typeof b!="string")throw Error(n(284));if(!B._owner)throw Error(n(290,b))}return b}function Lf(b,M){throw b=Object.prototype.toString.call(M),Error(n(31,b==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":b))}function em(b){var M=b._init;return M(b._payload)}function tm(b){function M(cn,Xt){if(b){var pn=cn.deletions;pn===null?(cn.deletions=[Xt],cn.flags|=16):pn.push(Xt)}}function B(cn,Xt){if(!b)return null;for(;Xt!==null;)M(cn,Xt),Xt=Xt.sibling;return null}function Z(cn,Xt){for(cn=new Map;Xt!==null;)Xt.key!==null?cn.set(Xt.key,Xt):cn.set(Xt.index,Xt),Xt=Xt.sibling;return cn}function se(cn,Xt){return cn=Gr(cn,Xt),cn.index=0,cn.sibling=null,cn}function ge(cn,Xt,pn){return cn.index=pn,b?(pn=cn.alternate,pn!==null?(pn=pn.index,pn<Xt?(cn.flags|=2,Xt):pn):(cn.flags|=2,Xt)):(cn.flags|=1048576,Xt)}function Ue(cn){return b&&cn.alternate===null&&(cn.flags|=2),cn}function xt(cn,Xt,pn,Sr){return Xt===null||Xt.tag!==6?(Xt=Si(pn,cn.mode,Sr),Xt.return=cn,Xt):(Xt=se(Xt,pn),Xt.return=cn,Xt)}function Ft(cn,Xt,pn,Sr){var hi=pn.type;return hi===re?or(cn,Xt,pn.props.children,Sr,pn.key):Xt!==null&&(Xt.elementType===hi||typeof hi=="object"&&hi!==null&&hi.$$typeof===je&&em(hi)===Xt.type)?(Sr=se(Xt,pn.props),Sr.ref=Rh(cn,Xt,pn),Sr.return=cn,Sr):(Sr=os(pn.type,pn.key,pn.props,null,cn.mode,Sr),Sr.ref=Rh(cn,Xt,pn),Sr.return=cn,Sr)}function Tn(cn,Xt,pn,Sr){return Xt===null||Xt.tag!==4||Xt.stateNode.containerInfo!==pn.containerInfo||Xt.stateNode.implementation!==pn.implementation?(Xt=xs(pn,cn.mode,Sr),Xt.return=cn,Xt):(Xt=se(Xt,pn.children||[]),Xt.return=cn,Xt)}function or(cn,Xt,pn,Sr,hi){return Xt===null||Xt.tag!==7?(Xt=Ei(pn,cn.mode,Sr,hi),Xt.return=cn,Xt):(Xt=se(Xt,pn),Xt.return=cn,Xt)}function yr(cn,Xt,pn){if(typeof Xt=="string"&&Xt!==""||typeof Xt=="number")return Xt=Si(""+Xt,cn.mode,pn),Xt.return=cn,Xt;if(typeof Xt=="object"&&Xt!==null){switch(Xt.$$typeof){case ne:return pn=os(Xt.type,Xt.key,Xt.props,null,cn.mode,pn),pn.ref=Rh(cn,null,Xt),pn.return=cn,pn;case te:return Xt=xs(Xt,cn.mode,pn),Xt.return=cn,Xt;case je:var Sr=Xt._init;return yr(cn,Sr(Xt._payload),pn)}if(mr(Xt)||He(Xt))return Xt=Ei(Xt,cn.mode,pn,null),Xt.return=cn,Xt;Lf(cn,Xt)}return null}function ar(cn,Xt,pn,Sr){var hi=Xt!==null?Xt.key:null;if(typeof pn=="string"&&pn!==""||typeof pn=="number")return hi!==null?null:xt(cn,Xt,""+pn,Sr);if(typeof pn=="object"&&pn!==null){switch(pn.$$typeof){case ne:return pn.key===hi?Ft(cn,Xt,pn,Sr):null;case te:return pn.key===hi?Tn(cn,Xt,pn,Sr):null;case je:return hi=pn._init,ar(cn,Xt,hi(pn._payload),Sr)}if(mr(pn)||He(pn))return hi!==null?null:or(cn,Xt,pn,Sr,null);Lf(cn,pn)}return null}function ri(cn,Xt,pn,Sr,hi){if(typeof Sr=="string"&&Sr!==""||typeof Sr=="number")return cn=cn.get(pn)||null,xt(Xt,cn,""+Sr,hi);if(typeof Sr=="object"&&Sr!==null){switch(Sr.$$typeof){case ne:return cn=cn.get(Sr.key===null?pn:Sr.key)||null,Ft(Xt,cn,Sr,hi);case te:return cn=cn.get(Sr.key===null?pn:Sr.key)||null,Tn(Xt,cn,Sr,hi);case je:var Ai=Sr._init;return ri(cn,Xt,pn,Ai(Sr._payload),hi)}if(mr(Sr)||He(Sr))return cn=cn.get(pn)||null,or(Xt,cn,Sr,hi,null);Lf(Xt,Sr)}return null}function ci(cn,Xt,pn,Sr){for(var hi=null,Ai=null,Mi=Xt,Fi=Xt=0,ia=null;Mi!==null&&Fi<pn.length;Fi++){Mi.index>Fi?(ia=Mi,Mi=null):ia=Mi.sibling;var js=ar(cn,Mi,pn[Fi],Sr);if(js===null){Mi===null&&(Mi=ia);break}b&&Mi&&js.alternate===null&&M(cn,Mi),Xt=ge(js,Xt,Fi),Ai===null?hi=js:Ai.sibling=js,Ai=js,Mi=ia}if(Fi===pn.length)return B(cn,Mi),Ws&&Ih(cn,Fi),hi;if(Mi===null){for(;Fi<pn.length;Fi++)Mi=yr(cn,pn[Fi],Sr),Mi!==null&&(Xt=ge(Mi,Xt,Fi),Ai===null?hi=Mi:Ai.sibling=Mi,Ai=Mi);return Ws&&Ih(cn,Fi),hi}for(Mi=Z(cn,Mi);Fi<pn.length;Fi++)ia=ri(Mi,cn,Fi,pn[Fi],Sr),ia!==null&&(b&&ia.alternate!==null&&Mi.delete(ia.key===null?Fi:ia.key),Xt=ge(ia,Xt,Fi),Ai===null?hi=ia:Ai.sibling=ia,Ai=ia);return b&&Mi.forEach(function(qh){return M(cn,qh)}),Ws&&Ih(cn,Fi),hi}function Yr(cn,Xt,pn,Sr){var hi=He(pn);if(typeof hi!="function")throw Error(n(150));if(pn=hi.call(pn),pn==null)throw Error(n(151));for(var Ai=hi=null,Mi=Xt,Fi=Xt=0,ia=null,js=pn.next();Mi!==null&&!js.done;Fi++,js=pn.next()){Mi.index>Fi?(ia=Mi,Mi=null):ia=Mi.sibling;var qh=ar(cn,Mi,js.value,Sr);if(qh===null){Mi===null&&(Mi=ia);break}b&&Mi&&qh.alternate===null&&M(cn,Mi),Xt=ge(qh,Xt,Fi),Ai===null?hi=qh:Ai.sibling=qh,Ai=qh,Mi=ia}if(js.done)return B(cn,Mi),Ws&&Ih(cn,Fi),hi;if(Mi===null){for(;!js.done;Fi++,js=pn.next())js=yr(cn,js.value,Sr),js!==null&&(Xt=ge(js,Xt,Fi),Ai===null?hi=js:Ai.sibling=js,Ai=js);return Ws&&Ih(cn,Fi),hi}for(Mi=Z(cn,Mi);!js.done;Fi++,js=pn.next())js=ri(Mi,cn,Fi,js.value,Sr),js!==null&&(b&&js.alternate!==null&&Mi.delete(js.key===null?Fi:js.key),Xt=ge(js,Xt,Fi),Ai===null?hi=js:Ai.sibling=js,Ai=js);return b&&Mi.forEach(function(j2){return M(cn,j2)}),Ws&&Ih(cn,Fi),hi}function no(cn,Xt,pn,Sr){if(typeof pn=="object"&&pn!==null&&pn.type===re&&pn.key===null&&(pn=pn.props.children),typeof pn=="object"&&pn!==null){switch(pn.$$typeof){case ne:e:{for(var hi=pn.key,Ai=Xt;Ai!==null;){if(Ai.key===hi){if(hi=pn.type,hi===re){if(Ai.tag===7){B(cn,Ai.sibling),Xt=se(Ai,pn.props.children),Xt.return=cn,cn=Xt;break e}}else if(Ai.elementType===hi||typeof hi=="object"&&hi!==null&&hi.$$typeof===je&&em(hi)===Ai.type){B(cn,Ai.sibling),Xt=se(Ai,pn.props),Xt.ref=Rh(cn,Ai,pn),Xt.return=cn,cn=Xt;break e}B(cn,Ai);break}else M(cn,Ai);Ai=Ai.sibling}pn.type===re?(Xt=Ei(pn.props.children,cn.mode,Sr,pn.key),Xt.return=cn,cn=Xt):(Sr=os(pn.type,pn.key,pn.props,null,cn.mode,Sr),Sr.ref=Rh(cn,Xt,pn),Sr.return=cn,cn=Sr)}return Ue(cn);case te:e:{for(Ai=pn.key;Xt!==null;){if(Xt.key===Ai)if(Xt.tag===4&&Xt.stateNode.containerInfo===pn.containerInfo&&Xt.stateNode.implementation===pn.implementation){B(cn,Xt.sibling),Xt=se(Xt,pn.children||[]),Xt.return=cn,cn=Xt;break e}else{B(cn,Xt);break}else M(cn,Xt);Xt=Xt.sibling}Xt=xs(pn,cn.mode,Sr),Xt.return=cn,cn=Xt}return Ue(cn);case je:return Ai=pn._init,no(cn,Xt,Ai(pn._payload),Sr)}if(mr(pn))return ci(cn,Xt,pn,Sr);if(He(pn))return Yr(cn,Xt,pn,Sr);Lf(cn,pn)}return typeof pn=="string"&&pn!==""||typeof pn=="number"?(pn=""+pn,Xt!==null&&Xt.tag===6?(B(cn,Xt.sibling),Xt=se(Xt,pn),Xt.return=cn,cn=Xt):(B(cn,Xt),Xt=Si(pn,cn.mode,Sr),Xt.return=cn,cn=Xt),Ue(cn)):B(cn,Xt)}return no}var Fd=tm(!0),nm=tm(!1),Bu=Dd(null),kg=null,Rl=null,Ig=null;function cy(){Ig=Rl=kg=null}function Of(b){var M=Bu.current;to(Bu),b._currentValue=M}function Ff(b,M,B){for(;b!==null;){var Z=b.alternate;if((b.childLanes&M)!==M?(b.childLanes|=M,Z!==null&&(Z.childLanes|=M)):Z!==null&&(Z.childLanes&M)!==M&&(Z.childLanes|=M),b===B)break;b=b.return}}function Va(b,M){kg=b,Ig=Rl=null,b=b.dependencies,b!==null&&b.firstContext!==null&&((b.lanes&M)!==0&&(Wo=!0),b.firstContext=null)}function Sa(b){var M=b._currentValue;if(Ig!==b)if(b={context:b,memoizedValue:M,next:null},Rl===null){if(kg===null)throw Error(n(308));Rl=b,kg.dependencies={lanes:0,firstContext:b}}else Rl=Rl.next=b;return M}var fl=null;function rm(b){fl===null?fl=[b]:fl.push(b)}function im(b,M,B,Z){var se=M.interleaved;return se===null?(B.next=B,rm(M)):(B.next=se.next,se.next=B),M.interleaved=B,Kl(b,Z)}function Kl(b,M){b.lanes|=M;var B=b.alternate;for(B!==null&&(B.lanes|=M),B=b,b=b.return;b!==null;)b.childLanes|=M,B=b.alternate,B!==null&&(B.childLanes|=M),B=b,b=b.return;return B.tag===3?B.stateNode:null}var Yl=!1;function Bf(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uy(b,M){b=b.updateQueue,M.updateQueue===b&&(M.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,effects:b.effects})}function Ha(b,M){return{eventTime:b,lane:M,tag:0,payload:null,callback:null,next:null}}function Nl(b,M,B){var Z=b.updateQueue;if(Z===null)return null;if(Z=Z.shared,(Ps&2)!==0){var se=Z.pending;return se===null?M.next=M:(M.next=se.next,se.next=M),Z.pending=M,Kl(b,B)}return se=Z.interleaved,se===null?(M.next=M,rm(Z)):(M.next=se.next,se.next=M),Z.interleaved=M,Kl(b,B)}function Fn(b,M,B){if(M=M.updateQueue,M!==null&&(M=M.shared,(B&4194240)!==0)){var Z=M.lanes;Z&=b.pendingLanes,B|=Z,M.lanes=B,wo(b,B)}}function Pg(b,M){var B=b.updateQueue,Z=b.alternate;if(Z!==null&&(Z=Z.updateQueue,B===Z)){var se=null,ge=null;if(B=B.firstBaseUpdate,B!==null){do{var Ue={eventTime:B.eventTime,lane:B.lane,tag:B.tag,payload:B.payload,callback:B.callback,next:null};ge===null?se=ge=Ue:ge=ge.next=Ue,B=B.next}while(B!==null);ge===null?se=ge=M:ge=ge.next=M}else se=ge=M;B={baseState:Z.baseState,firstBaseUpdate:se,lastBaseUpdate:ge,shared:Z.shared,effects:Z.effects},b.updateQueue=B;return}b=B.lastBaseUpdate,b===null?B.firstBaseUpdate=M:b.next=M,B.lastBaseUpdate=M}function Jl(b,M,B,Z){var se=b.updateQueue;Yl=!1;var ge=se.firstBaseUpdate,Ue=se.lastBaseUpdate,xt=se.shared.pending;if(xt!==null){se.shared.pending=null;var Ft=xt,Tn=Ft.next;Ft.next=null,Ue===null?ge=Tn:Ue.next=Tn,Ue=Ft;var or=b.alternate;or!==null&&(or=or.updateQueue,xt=or.lastBaseUpdate,xt!==Ue&&(xt===null?or.firstBaseUpdate=Tn:xt.next=Tn,or.lastBaseUpdate=Ft))}if(ge!==null){var yr=se.baseState;Ue=0,or=Tn=Ft=null,xt=ge;do{var ar=xt.lane,ri=xt.eventTime;if((Z&ar)===ar){or!==null&&(or=or.next={eventTime:ri,lane:0,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null});e:{var ci=b,Yr=xt;switch(ar=M,ri=B,Yr.tag){case 1:if(ci=Yr.payload,typeof ci=="function"){yr=ci.call(ri,yr,ar);break e}yr=ci;break e;case 3:ci.flags=ci.flags&-65537|128;case 0:if(ci=Yr.payload,ar=typeof ci=="function"?ci.call(ri,yr,ar):ci,ar==null)break e;yr=qe({},yr,ar);break e;case 2:Yl=!0}}xt.callback!==null&&xt.lane!==0&&(b.flags|=64,ar=se.effects,ar===null?se.effects=[xt]:ar.push(xt))}else ri={eventTime:ri,lane:ar,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null},or===null?(Tn=or=ri,Ft=yr):or=or.next=ri,Ue|=ar;if(xt=xt.next,xt===null){if(xt=se.shared.pending,xt===null)break;ar=xt,xt=ar.next,ar.next=null,se.lastBaseUpdate=ar,se.shared.pending=null}}while(!0);if(or===null&&(Ft=yr),se.baseState=Ft,se.firstBaseUpdate=Tn,se.lastBaseUpdate=or,M=se.shared.interleaved,M!==null){se=M;do Ue|=se.lane,se=se.next;while(se!==M)}else ge===null&&(se.shared.lanes=0);S|=Ue,b.lanes=Ue,b.memoizedState=yr}}function zu(b,M,B){if(b=M.effects,M.effects=null,b!==null)for(M=0;M<b.length;M++){var Z=b[M],se=Z.callback;if(se!==null){if(Z.callback=null,Z=B,typeof se!="function")throw Error(n(191,se));se.call(Z)}}}var ec={},pr=Dd(ec),Nh=Dd(ec),zf=Dd(ec);function au(b){if(b===ec)throw Error(n(174));return b}function Uf(b,M){switch(Qs(zf,M),Qs(Nh,b),Qs(pr,ec),b=M.nodeType,b){case 9:case 11:M=(M=M.documentElement)?M.namespaceURI:Dn(null,"");break;default:b=b===8?M.parentNode:M,M=b.namespaceURI||null,b=b.tagName,M=Dn(M,b)}to(pr),Qs(pr,M)}function Bd(){to(pr),to(Nh),to(zf)}function Rg(b){au(zf.current);var M=au(pr.current),B=Dn(M,b.type);M!==B&&(Qs(Nh,b),Qs(pr,B))}function Ng(b){Nh.current===b&&(to(pr),to(Nh))}var yo=Dd(0);function jg(b){for(var M=b;M!==null;){if(M.tag===13){var B=M.memoizedState;if(B!==null&&(B=B.dehydrated,B===null||B.data==="$?"||B.data==="$!"))return M}else if(M.tag===19&&M.memoizedProps.revealOrder!==void 0){if((M.flags&128)!==0)return M}else if(M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return null;M=M.return}M.sibling.return=M.return,M=M.sibling}return null}var Ta=[];function sm(){for(var b=0;b<Ta.length;b++)Ta[b]._workInProgressVersionPrimary=null;Ta.length=0}var $o=K.ReactCurrentDispatcher,lu=K.ReactCurrentBatchConfig,zd=0,uo=null,Ro=null,Uo=null,Vf=!1,na=!1,rs=0,om=0;function No(){throw Error(n(321))}function Dg(b,M){if(M===null)return!1;for(var B=0;B<M.length&&B<b.length;B++)if(!ll(b[B],M[B]))return!1;return!0}function Lg(b,M,B,Z,se,ge){if(zd=ge,uo=M,M.memoizedState=null,M.updateQueue=null,M.lanes=0,$o.current=b===null||b.memoizedState===null?gy:$a,b=B(Z,se),na){ge=0;do{if(na=!1,rs=0,25<=ge)throw Error(n(301));ge+=1,Uo=Ro=null,M.updateQueue=null,$o.current=Bh,b=B(Z,se)}while(na)}if($o.current=di,M=Ro!==null&&Ro.next!==null,zd=0,Uo=Ro=uo=null,Vf=!1,M)throw Error(n(300));return b}function Cc(){var b=rs!==0;return rs=0,b}function tc(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Uo===null?uo.memoizedState=Uo=b:Uo=Uo.next=b,Uo}function xo(){if(Ro===null){var b=uo.alternate;b=b!==null?b.memoizedState:null}else b=Ro.next;var M=Uo===null?uo.memoizedState:Uo.next;if(M!==null)Uo=M,Ro=b;else{if(b===null)throw Error(n(310));Ro=b,b={memoizedState:Ro.memoizedState,baseState:Ro.baseState,baseQueue:Ro.baseQueue,queue:Ro.queue,next:null},Uo===null?uo.memoizedState=Uo=b:Uo=Uo.next=b}return Uo}function Mc(b,M){return typeof M=="function"?M(b):M}function dn(b){var M=xo(),B=M.queue;if(B===null)throw Error(n(311));B.lastRenderedReducer=b;var Z=Ro,se=Z.baseQueue,ge=B.pending;if(ge!==null){if(se!==null){var Ue=se.next;se.next=ge.next,ge.next=Ue}Z.baseQueue=se=ge,B.pending=null}if(se!==null){ge=se.next,Z=Z.baseState;var xt=Ue=null,Ft=null,Tn=ge;do{var or=Tn.lane;if((zd&or)===or)Ft!==null&&(Ft=Ft.next={lane:0,action:Tn.action,hasEagerState:Tn.hasEagerState,eagerState:Tn.eagerState,next:null}),Z=Tn.hasEagerState?Tn.eagerState:b(Z,Tn.action);else{var yr={lane:or,action:Tn.action,hasEagerState:Tn.hasEagerState,eagerState:Tn.eagerState,next:null};Ft===null?(xt=Ft=yr,Ue=Z):Ft=Ft.next=yr,uo.lanes|=or,S|=or}Tn=Tn.next}while(Tn!==null&&Tn!==ge);Ft===null?Ue=Z:Ft.next=xt,ll(Z,M.memoizedState)||(Wo=!0),M.memoizedState=Z,M.baseState=Ue,M.baseQueue=Ft,B.lastRenderedState=Z}if(b=B.interleaved,b!==null){se=b;do ge=se.lane,uo.lanes|=ge,S|=ge,se=se.next;while(se!==b)}else se===null&&(B.lanes=0);return[M.memoizedState,B.dispatch]}function Pn(b){var M=xo(),B=M.queue;if(B===null)throw Error(n(311));B.lastRenderedReducer=b;var Z=B.dispatch,se=B.pending,ge=M.memoizedState;if(se!==null){B.pending=null;var Ue=se=se.next;do ge=b(ge,Ue.action),Ue=Ue.next;while(Ue!==se);ll(ge,M.memoizedState)||(Wo=!0),M.memoizedState=ge,M.baseQueue===null&&(M.baseState=ge),B.lastRenderedState=ge}return[ge,Z]}function jh(){}function Ns(b,M){var B=uo,Z=xo(),se=M(),ge=!ll(Z.memoizedState,se);if(ge&&(Z.memoizedState=se,Wo=!0),Z=Z.queue,Ga(Dh.bind(null,B,Z,b),[b]),Z.getSnapshot!==M||ge||Uo!==null&&Uo.memoizedState.tag&1){if(B.flags|=2048,cu(9,Og.bind(null,B,Z,se,M),void 0,null),ra===null)throw Error(n(349));(zd&30)!==0||ft(B,M,se)}return se}function ft(b,M,B){b.flags|=16384,b={getSnapshot:M,value:B},M=uo.updateQueue,M===null?(M={lastEffect:null,stores:null},uo.updateQueue=M,M.stores=[b]):(B=M.stores,B===null?M.stores=[b]:B.push(b))}function Og(b,M,B,Z){M.value=B,M.getSnapshot=Z,Lh(M)&&am(b)}function Dh(b,M,B){return B(function(){Lh(M)&&am(b)})}function Lh(b){var M=b.getSnapshot;b=b.value;try{var B=M();return!ll(b,B)}catch{return!0}}function am(b){var M=Kl(b,1);M!==null&&ze(M,b,1,-1)}function lm(b){var M=tc();return typeof b=="function"&&(b=b()),M.memoizedState=M.baseState=b,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mc,lastRenderedState:b},M.queue=b,b=b.dispatch=pa.bind(null,uo,b),[M.memoizedState,b]}function cu(b,M,B,Z){return b={tag:b,create:M,destroy:B,deps:Z,next:null},M=uo.updateQueue,M===null?(M={lastEffect:null,stores:null},uo.updateQueue=M,M.lastEffect=b.next=b):(B=M.lastEffect,B===null?M.lastEffect=b.next=b:(Z=B.next,B.next=b,b.next=Z,M.lastEffect=b)),b}function Oh(){return xo().memoizedState}function Fg(b,M,B,Z){var se=tc();uo.flags|=b,se.memoizedState=cu(1|M,B,void 0,Z===void 0?null:Z)}function cm(b,M,B,Z){var se=xo();Z=Z===void 0?null:Z;var ge=void 0;if(Ro!==null){var Ue=Ro.memoizedState;if(ge=Ue.destroy,Z!==null&&Dg(Z,Ue.deps)){se.memoizedState=cu(M,B,ge,Z);return}}uo.flags|=b,se.memoizedState=cu(1|M,B,ge,Z)}function dy(b,M){return Fg(8390656,8,b,M)}function Ga(b,M){return cm(2048,8,b,M)}function Bg(b,M){return cm(4,2,b,M)}function zg(b,M){return cm(4,4,b,M)}function hy(b,M){if(typeof M=="function")return b=b(),M(b),function(){M(null)};if(M!=null)return b=b(),M.current=b,function(){M.current=null}}function um(b,M,B){return B=B!=null?B.concat([b]):null,cm(4,4,hy.bind(null,M,b),B)}function Fh(){}function Ud(b,M){var B=xo();M=M===void 0?null:M;var Z=B.memoizedState;return Z!==null&&M!==null&&Dg(M,Z[1])?Z[0]:(B.memoizedState=[b,M],b)}function fy(b,M){var B=xo();M=M===void 0?null:M;var Z=B.memoizedState;return Z!==null&&M!==null&&Dg(M,Z[1])?Z[0]:(b=b(),B.memoizedState=[b,M],b)}function py(b,M,B){return(zd&21)===0?(b.baseState&&(b.baseState=!1,Wo=!0),b.memoizedState=B):(ll(B,M)||(B=mo(),uo.lanes|=B,S|=B,b.baseState=!0),M)}function Pb(b,M){var B=ji;ji=B!==0&&4>B?B:4,b(!0);var Z=lu.transition;lu.transition={};try{b(!1),M()}finally{ji=B,lu.transition=Z}}function my(){return xo().memoizedState}function Rb(b,M,B){var Z=Xe(b);if(B={lane:Z,action:B,hasEagerState:!1,eagerState:null,next:null},d_(b))Hf(M,B);else if(B=im(b,M,B,Z),B!==null){var se=Ne();ze(B,b,Z,se),hs(B,M,Z)}}function pa(b,M,B){var Z=Xe(b),se={lane:Z,action:B,hasEagerState:!1,eagerState:null,next:null};if(d_(b))Hf(M,se);else{var ge=b.alternate;if(b.lanes===0&&(ge===null||ge.lanes===0)&&(ge=M.lastRenderedReducer,ge!==null))try{var Ue=M.lastRenderedState,xt=ge(Ue,B);if(se.hasEagerState=!0,se.eagerState=xt,ll(xt,Ue)){var Ft=M.interleaved;Ft===null?(se.next=se,rm(M)):(se.next=Ft.next,Ft.next=se),M.interleaved=se;return}}catch{}finally{}B=im(b,M,se,Z),B!==null&&(se=Ne(),ze(B,b,Z,se),hs(B,M,Z))}}function d_(b){var M=b.alternate;return b===uo||M!==null&&M===uo}function Hf(b,M){na=Vf=!0;var B=b.pending;B===null?M.next=M:(M.next=B.next,B.next=M),b.pending=M}function hs(b,M,B){if((B&4194240)!==0){var Z=M.lanes;Z&=b.pendingLanes,B|=Z,M.lanes=B,wo(b,B)}}var di={readContext:Sa,useCallback:No,useContext:No,useEffect:No,useImperativeHandle:No,useInsertionEffect:No,useLayoutEffect:No,useMemo:No,useReducer:No,useRef:No,useState:No,useDebugValue:No,useDeferredValue:No,useTransition:No,useMutableSource:No,useSyncExternalStore:No,useId:No,unstable_isNewReconciler:!1},gy={readContext:Sa,useCallback:function(b,M){return tc().memoizedState=[b,M===void 0?null:M],b},useContext:Sa,useEffect:dy,useImperativeHandle:function(b,M,B){return B=B!=null?B.concat([b]):null,Fg(4194308,4,hy.bind(null,M,b),B)},useLayoutEffect:function(b,M){return Fg(4194308,4,b,M)},useInsertionEffect:function(b,M){return Fg(4,2,b,M)},useMemo:function(b,M){var B=tc();return M=M===void 0?null:M,b=b(),B.memoizedState=[b,M],b},useReducer:function(b,M,B){var Z=tc();return M=B!==void 0?B(M):M,Z.memoizedState=Z.baseState=M,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:M},Z.queue=b,b=b.dispatch=Rb.bind(null,uo,b),[Z.memoizedState,b]},useRef:function(b){var M=tc();return b={current:b},M.memoizedState=b},useState:lm,useDebugValue:Fh,useDeferredValue:function(b){return tc().memoizedState=b},useTransition:function(){var b=lm(!1),M=b[0];return b=Pb.bind(null,b[1]),tc().memoizedState=b,[M,b]},useMutableSource:function(){},useSyncExternalStore:function(b,M,B){var Z=uo,se=tc();if(Ws){if(B===void 0)throw Error(n(407));B=B()}else{if(B=M(),ra===null)throw Error(n(349));(zd&30)!==0||ft(Z,M,B)}se.memoizedState=B;var ge={value:B,getSnapshot:M};return se.queue=ge,dy(Dh.bind(null,Z,ge,b),[b]),Z.flags|=2048,cu(9,Og.bind(null,Z,ge,B,M),void 0,null),B},useId:function(){var b=tc(),M=ra.identifierPrefix;if(Ws){var B=Fu,Z=ou;B=(Z&~(1<<32-ur(Z)-1)).toString(32)+B,M=":"+M+"R"+B,B=rs++,0<B&&(M+="H"+B.toString(32)),M+=":"}else B=om++,M=":"+M+"r"+B.toString(32)+":";return b.memoizedState=M},unstable_isNewReconciler:!1},$a={readContext:Sa,useCallback:Ud,useContext:Sa,useEffect:Ga,useImperativeHandle:um,useInsertionEffect:Bg,useLayoutEffect:zg,useMemo:fy,useReducer:dn,useRef:Oh,useState:function(){return dn(Mc)},useDebugValue:Fh,useDeferredValue:function(b){var M=xo();return py(M,Ro.memoizedState,b)},useTransition:function(){var b=dn(Mc)[0],M=xo().memoizedState;return[b,M]},useMutableSource:jh,useSyncExternalStore:Ns,useId:my,unstable_isNewReconciler:!1},Bh={readContext:Sa,useCallback:Ud,useContext:Sa,useEffect:Ga,useImperativeHandle:um,useInsertionEffect:Bg,useLayoutEffect:zg,useMemo:fy,useReducer:Pn,useRef:Oh,useState:function(){return Pn(Mc)},useDebugValue:Fh,useDeferredValue:function(b){var M=xo();return Ro===null?M.memoizedState=b:py(M,Ro.memoizedState,b)},useTransition:function(){var b=Pn(Mc)[0],M=xo().memoizedState;return[b,M]},useMutableSource:jh,useSyncExternalStore:Ns,useId:my,unstable_isNewReconciler:!1};function Ea(b,M){if(b&&b.defaultProps){M=qe({},M),b=b.defaultProps;for(var B in b)M[B]===void 0&&(M[B]=b[B]);return M}return M}function kc(b,M,B,Z){M=b.memoizedState,B=B(Z,M),B=B==null?M:qe({},M,B),b.memoizedState=B,b.lanes===0&&(b.updateQueue.baseState=B)}var Gf={isMounted:function(b){return(b=b._reactInternals)?tt(b)===b:!1},enqueueSetState:function(b,M,B){b=b._reactInternals;var Z=Ne(),se=Xe(b),ge=Ha(Z,se);ge.payload=M,B!=null&&(ge.callback=B),M=Nl(b,ge,se),M!==null&&(ze(M,b,se,Z),Fn(M,b,se))},enqueueReplaceState:function(b,M,B){b=b._reactInternals;var Z=Ne(),se=Xe(b),ge=Ha(Z,se);ge.tag=1,ge.payload=M,B!=null&&(ge.callback=B),M=Nl(b,ge,se),M!==null&&(ze(M,b,se,Z),Fn(M,b,se))},enqueueForceUpdate:function(b,M){b=b._reactInternals;var B=Ne(),Z=Xe(b),se=Ha(B,Z);se.tag=2,M!=null&&(se.callback=M),M=Nl(b,se,Z),M!==null&&(ze(M,b,Z,B),Fn(M,b,Z))}};function Ug(b,M,B,Z,se,ge,Ue){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(Z,ge,Ue):M.prototype&&M.prototype.isPureReactComponent?!Ru(B,Z)||!Ru(se,ge):!0}function dm(b,M,B){var Z=!1,se=Sc,ge=M.contextType;return typeof ge=="object"&&ge!==null?ge=Sa(ge):(se=ta(M)?Lu:Go.current,Z=M.contextTypes,ge=(Z=Z!=null)?Mh(b,se):Sc),M=new M(B,ge),b.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Gf,b.stateNode=M,M._reactInternals=b,Z&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=se,b.__reactInternalMemoizedMaskedChildContext=ge),M}function hm(b,M,B,Z){b=M.state,typeof M.componentWillReceiveProps=="function"&&M.componentWillReceiveProps(B,Z),typeof M.UNSAFE_componentWillReceiveProps=="function"&&M.UNSAFE_componentWillReceiveProps(B,Z),M.state!==b&&Gf.enqueueReplaceState(M,M.state,null)}function Wa(b,M,B,Z){var se=b.stateNode;se.props=B,se.state=b.memoizedState,se.refs={},Bf(b);var ge=M.contextType;typeof ge=="object"&&ge!==null?se.context=Sa(ge):(ge=ta(M)?Lu:Go.current,se.context=Mh(b,ge)),se.state=b.memoizedState,ge=M.getDerivedStateFromProps,typeof ge=="function"&&(kc(b,M,ge,B),se.state=b.memoizedState),typeof M.getDerivedStateFromProps=="function"||typeof se.getSnapshotBeforeUpdate=="function"||typeof se.UNSAFE_componentWillMount!="function"&&typeof se.componentWillMount!="function"||(M=se.state,typeof se.componentWillMount=="function"&&se.componentWillMount(),typeof se.UNSAFE_componentWillMount=="function"&&se.UNSAFE_componentWillMount(),M!==se.state&&Gf.enqueueReplaceState(se,se.state,null),Jl(b,B,se,Z),se.state=b.memoizedState),typeof se.componentDidMount=="function"&&(b.flags|=4194308)}function jl(b,M){try{var B="",Z=M;do B+=Vt(Z),Z=Z.return;while(Z);var se=B}catch(ge){se=`
Error generating stack: `+ge.message+`
`+ge.stack}return{value:b,source:M,stack:se,digest:null}}function Uu(b,M,B){return{value:b,source:null,stack:B??null,digest:M??null}}function $f(b,M){try{console.error(M.value)}catch(B){setTimeout(function(){throw B})}}var Vg=typeof WeakMap=="function"?WeakMap:Map;function zh(b,M,B){B=Ha(-1,B),B.tag=3,B.payload={element:null};var Z=M.value;return B.callback=function(){Q||(Q=!0,ie=Z),$f(b,M)},B}function Vu(b,M,B){B=Ha(-1,B),B.tag=3;var Z=b.type.getDerivedStateFromError;if(typeof Z=="function"){var se=M.value;B.payload=function(){return Z(se)},B.callback=function(){$f(b,M)}}var ge=b.stateNode;return ge!==null&&typeof ge.componentDidCatch=="function"&&(B.callback=function(){$f(b,M),typeof Z!="function"&&(le===null?le=new Set([this]):le.add(this));var Ue=M.stack;this.componentDidCatch(M.value,{componentStack:Ue!==null?Ue:""})}),B}function Hg(b,M,B){var Z=b.pingCache;if(Z===null){Z=b.pingCache=new Vg;var se=new Set;Z.set(M,se)}else se=Z.get(M),se===void 0&&(se=new Set,Z.set(M,se));se.has(B)||(se.add(B),b=ts.bind(null,b,M,B),M.then(b,b))}function Dl(b){do{var M;if((M=b.tag===13)&&(M=b.memoizedState,M=M!==null?M.dehydrated!==null:!0),M)return b;b=b.return}while(b!==null);return null}function Gg(b,M,B,Z,se){return(b.mode&1)===0?(b===M?b.flags|=65536:(b.flags|=128,B.flags|=131072,B.flags&=-52805,B.tag===1&&(B.alternate===null?B.tag=17:(M=Ha(-1,1),M.tag=2,Nl(B,M,1))),B.lanes|=1),b):(b.flags|=65536,b.lanes=se,b)}var $g=K.ReactCurrentOwner,Wo=!1;function Vo(b,M,B,Z){M.child=b===null?nm(M,null,B,Z):Fd(M,b.child,B,Z)}function ys(b,M,B,Z,se){B=B.render;var ge=M.ref;return Va(M,se),Z=Lg(b,M,B,Z,ge,se),B=Cc(),b!==null&&!Wo?(M.updateQueue=b.updateQueue,M.flags&=-2053,b.lanes&=~se,uu(b,M,se)):(Ws&&B&&Nf(M),M.flags|=1,Vo(b,M,Z,se),M.child)}function Uh(b,M,B,Z,se){if(b===null){var ge=B.type;return typeof ge=="function"&&!Xr(ge)&&ge.defaultProps===void 0&&B.compare===null&&B.defaultProps===void 0?(M.tag=15,M.type=ge,Wg(b,M,ge,Z,se)):(b=os(B.type,null,Z,M,M.mode,se),b.ref=M.ref,b.return=M,M.child=b)}if(ge=b.child,(b.lanes&se)===0){var Ue=ge.memoizedProps;if(B=B.compare,B=B!==null?B:Ru,B(Ue,Z)&&b.ref===M.ref)return uu(b,M,se)}return M.flags|=1,b=Gr(ge,Z),b.ref=M.ref,b.return=M,M.child=b}function Wg(b,M,B,Z,se){if(b!==null){var ge=b.memoizedProps;if(Ru(ge,Z)&&b.ref===M.ref)if(Wo=!1,M.pendingProps=Z=ge,(b.lanes&se)!==0)(b.flags&131072)!==0&&(Wo=!0);else return M.lanes=b.lanes,uu(b,M,se)}return fm(b,M,B,Z,se)}function qg(b,M,B){var Z=M.pendingProps,se=Z.children,ge=b!==null?b.memoizedState:null;if(Z.mode==="hidden")if((M.mode&1)===0)M.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qs(o,g),g|=B;else{if((B&1073741824)===0)return b=ge!==null?ge.baseLanes|B:B,M.lanes=M.childLanes=1073741824,M.memoizedState={baseLanes:b,cachePool:null,transitions:null},M.updateQueue=null,Qs(o,g),g|=b,null;M.memoizedState={baseLanes:0,cachePool:null,transitions:null},Z=ge!==null?ge.baseLanes:B,Qs(o,g),g|=Z}else ge!==null?(Z=ge.baseLanes|B,M.memoizedState=null):Z=B,Qs(o,g),g|=Z;return Vo(b,M,se,B),M.child}function Vd(b,M){var B=M.ref;(b===null&&B!==null||b!==null&&b.ref!==B)&&(M.flags|=512,M.flags|=2097152)}function fm(b,M,B,Z,se){var ge=ta(B)?Lu:Go.current;return ge=Mh(M,ge),Va(M,se),B=Lg(b,M,B,Z,ge,se),Z=Cc(),b!==null&&!Wo?(M.updateQueue=b.updateQueue,M.flags&=-2053,b.lanes&=~se,uu(b,M,se)):(Ws&&Z&&Nf(M),M.flags|=1,Vo(b,M,B,se),M.child)}function Wf(b,M,B,Z,se){if(ta(B)){var ge=!0;If(M)}else ge=!1;if(Va(M,se),M.stateNode===null)Kf(b,M),dm(M,B,Z),Wa(M,B,Z,se),Z=!0;else if(b===null){var Ue=M.stateNode,xt=M.memoizedProps;Ue.props=xt;var Ft=Ue.context,Tn=B.contextType;typeof Tn=="object"&&Tn!==null?Tn=Sa(Tn):(Tn=ta(B)?Lu:Go.current,Tn=Mh(M,Tn));var or=B.getDerivedStateFromProps,yr=typeof or=="function"||typeof Ue.getSnapshotBeforeUpdate=="function";yr||typeof Ue.UNSAFE_componentWillReceiveProps!="function"&&typeof Ue.componentWillReceiveProps!="function"||(xt!==Z||Ft!==Tn)&&hm(M,Ue,Z,Tn),Yl=!1;var ar=M.memoizedState;Ue.state=ar,Jl(M,Z,Ue,se),Ft=M.memoizedState,xt!==Z||ar!==Ft||zo.current||Yl?(typeof or=="function"&&(kc(M,B,or,Z),Ft=M.memoizedState),(xt=Yl||Ug(M,B,xt,Z,ar,Ft,Tn))?(yr||typeof Ue.UNSAFE_componentWillMount!="function"&&typeof Ue.componentWillMount!="function"||(typeof Ue.componentWillMount=="function"&&Ue.componentWillMount(),typeof Ue.UNSAFE_componentWillMount=="function"&&Ue.UNSAFE_componentWillMount()),typeof Ue.componentDidMount=="function"&&(M.flags|=4194308)):(typeof Ue.componentDidMount=="function"&&(M.flags|=4194308),M.memoizedProps=Z,M.memoizedState=Ft),Ue.props=Z,Ue.state=Ft,Ue.context=Tn,Z=xt):(typeof Ue.componentDidMount=="function"&&(M.flags|=4194308),Z=!1)}else{Ue=M.stateNode,uy(b,M),xt=M.memoizedProps,Tn=M.type===M.elementType?xt:Ea(M.type,xt),Ue.props=Tn,yr=M.pendingProps,ar=Ue.context,Ft=B.contextType,typeof Ft=="object"&&Ft!==null?Ft=Sa(Ft):(Ft=ta(B)?Lu:Go.current,Ft=Mh(M,Ft));var ri=B.getDerivedStateFromProps;(or=typeof ri=="function"||typeof Ue.getSnapshotBeforeUpdate=="function")||typeof Ue.UNSAFE_componentWillReceiveProps!="function"&&typeof Ue.componentWillReceiveProps!="function"||(xt!==yr||ar!==Ft)&&hm(M,Ue,Z,Ft),Yl=!1,ar=M.memoizedState,Ue.state=ar,Jl(M,Z,Ue,se);var ci=M.memoizedState;xt!==yr||ar!==ci||zo.current||Yl?(typeof ri=="function"&&(kc(M,B,ri,Z),ci=M.memoizedState),(Tn=Yl||Ug(M,B,Tn,Z,ar,ci,Ft)||!1)?(or||typeof Ue.UNSAFE_componentWillUpdate!="function"&&typeof Ue.componentWillUpdate!="function"||(typeof Ue.componentWillUpdate=="function"&&Ue.componentWillUpdate(Z,ci,Ft),typeof Ue.UNSAFE_componentWillUpdate=="function"&&Ue.UNSAFE_componentWillUpdate(Z,ci,Ft)),typeof Ue.componentDidUpdate=="function"&&(M.flags|=4),typeof Ue.getSnapshotBeforeUpdate=="function"&&(M.flags|=1024)):(typeof Ue.componentDidUpdate!="function"||xt===b.memoizedProps&&ar===b.memoizedState||(M.flags|=4),typeof Ue.getSnapshotBeforeUpdate!="function"||xt===b.memoizedProps&&ar===b.memoizedState||(M.flags|=1024),M.memoizedProps=Z,M.memoizedState=ci),Ue.props=Z,Ue.state=ci,Ue.context=Ft,Z=Tn):(typeof Ue.componentDidUpdate!="function"||xt===b.memoizedProps&&ar===b.memoizedState||(M.flags|=4),typeof Ue.getSnapshotBeforeUpdate!="function"||xt===b.memoizedProps&&ar===b.memoizedState||(M.flags|=1024),Z=!1)}return pm(b,M,B,Z,ge,se)}function pm(b,M,B,Z,se,ge){Vd(b,M);var Ue=(M.flags&128)!==0;if(!Z&&!Ue)return se&&Pf(M,B,!1),uu(b,M,ge);Z=M.stateNode,$g.current=M;var xt=Ue&&typeof B.getDerivedStateFromError!="function"?null:Z.render();return M.flags|=1,b!==null&&Ue?(M.child=Fd(M,b.child,null,ge),M.child=Fd(M,null,xt,ge)):Vo(b,M,xt,ge),M.memoizedState=Z.state,se&&Pf(M,B,!0),M.child}function Hu(b){var M=b.stateNode;M.pendingContext?Xp(b,M.pendingContext,M.pendingContext!==M.context):M.context&&Xp(b,M.context,!1),Uf(b,M.containerInfo)}function Xg(b,M,B,Z,se){return Pl(),Jp(se),M.flags|=256,Vo(b,M,B,Z),M.child}var qf={dehydrated:null,treeContext:null,retryLane:0};function Xf(b){return{baseLanes:b,cachePool:null,transitions:null}}function Vh(b,M,B){var Z=M.pendingProps,se=yo.current,ge=!1,Ue=(M.flags&128)!==0,xt;if((xt=Ue)||(xt=b!==null&&b.memoizedState===null?!1:(se&2)!==0),xt?(ge=!0,M.flags&=-129):(b===null||b.memoizedState!==null)&&(se|=1),Qs(yo,se&1),b===null)return Ac(M),b=M.memoizedState,b!==null&&(b=b.dehydrated,b!==null)?((M.mode&1)===0?M.lanes=1:b.data==="$!"?M.lanes=8:M.lanes=1073741824,null):(Ue=Z.children,b=Z.fallback,ge?(Z=M.mode,ge=M.child,Ue={mode:"hidden",children:Ue},(Z&1)===0&&ge!==null?(ge.childLanes=0,ge.pendingProps=Ue):ge=Pr(Ue,Z,0,null),b=Ei(b,Z,B,null),ge.return=M,b.return=M,ge.sibling=b,M.child=ge,M.child.memoizedState=Xf(B),M.memoizedState=qf,b):mm(M,Ue));if(se=b.memoizedState,se!==null&&(xt=se.dehydrated,xt!==null))return yy(b,M,Ue,Z,xt,se,B);if(ge){ge=Z.fallback,Ue=M.mode,se=b.child,xt=se.sibling;var Ft={mode:"hidden",children:Z.children};return(Ue&1)===0&&M.child!==se?(Z=M.child,Z.childLanes=0,Z.pendingProps=Ft,M.deletions=null):(Z=Gr(se,Ft),Z.subtreeFlags=se.subtreeFlags&14680064),xt!==null?ge=Gr(xt,ge):(ge=Ei(ge,Ue,B,null),ge.flags|=2),ge.return=M,Z.return=M,Z.sibling=ge,M.child=Z,Z=ge,ge=M.child,Ue=b.child.memoizedState,Ue=Ue===null?Xf(B):{baseLanes:Ue.baseLanes|B,cachePool:null,transitions:Ue.transitions},ge.memoizedState=Ue,ge.childLanes=b.childLanes&~B,M.memoizedState=qf,Z}return ge=b.child,b=ge.sibling,Z=Gr(ge,{mode:"visible",children:Z.children}),(M.mode&1)===0&&(Z.lanes=B),Z.return=M,Z.sibling=null,b!==null&&(B=M.deletions,B===null?(M.deletions=[b],M.flags|=16):B.push(b)),M.child=Z,M.memoizedState=null,Z}function mm(b,M){return M=Pr({mode:"visible",children:M},b.mode,0,null),M.return=b,b.child=M}function Hh(b,M,B,Z){return Z!==null&&Jp(Z),Fd(M,b.child,null,B),b=mm(M,M.pendingProps.children),b.flags|=2,M.memoizedState=null,b}function yy(b,M,B,Z,se,ge,Ue){if(B)return M.flags&256?(M.flags&=-257,Z=Uu(Error(n(422))),Hh(b,M,Ue,Z)):M.memoizedState!==null?(M.child=b.child,M.flags|=128,null):(ge=Z.fallback,se=M.mode,Z=Pr({mode:"visible",children:Z.children},se,0,null),ge=Ei(ge,se,Ue,null),ge.flags|=2,Z.return=M,ge.return=M,Z.sibling=ge,M.child=Z,(M.mode&1)!==0&&Fd(M,b.child,null,Ue),M.child.memoizedState=Xf(Ue),M.memoizedState=qf,ge);if((M.mode&1)===0)return Hh(b,M,Ue,null);if(se.data==="$!"){if(Z=se.nextSibling&&se.nextSibling.dataset,Z)var xt=Z.dgst;return Z=xt,ge=Error(n(419)),Z=Uu(ge,Z,void 0),Hh(b,M,Ue,Z)}if(xt=(Ue&b.childLanes)!==0,Wo||xt){if(Z=ra,Z!==null){switch(Ue&-Ue){case 4:se=2;break;case 16:se=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:se=32;break;case 536870912:se=268435456;break;default:se=0}se=(se&(Z.suspendedLanes|Ue))!==0?0:se,se!==0&&se!==ge.retryLane&&(ge.retryLane=se,Kl(b,se),ze(Z,b,se,-1))}return _n(),Z=Uu(Error(n(421))),Hh(b,M,Ue,Z)}return se.data==="$?"?(M.flags|=128,M.child=b.child,M=bi.bind(null,b),se._reactRetry=M,null):(b=ge.treeContext,hl=iu(se.nextSibling),Ua=M,Ws=!0,Il=null,b!==null&&(kl[fa++]=ou,kl[fa++]=Fu,kl[fa++]=Ld,ou=b.id,Fu=b.overflow,Ld=M),M=mm(M,Z.children),M.flags|=4096,M)}function xy(b,M,B){b.lanes|=M;var Z=b.alternate;Z!==null&&(Z.lanes|=M),Ff(b.return,M,B)}function Zf(b,M,B,Z,se){var ge=b.memoizedState;ge===null?b.memoizedState={isBackwards:M,rendering:null,renderingStartTime:0,last:Z,tail:B,tailMode:se}:(ge.isBackwards=M,ge.rendering=null,ge.renderingStartTime=0,ge.last=Z,ge.tail=B,ge.tailMode=se)}function Qf(b,M,B){var Z=M.pendingProps,se=Z.revealOrder,ge=Z.tail;if(Vo(b,M,Z.children,B),Z=yo.current,(Z&2)!==0)Z=Z&1|2,M.flags|=128;else{if(b!==null&&(b.flags&128)!==0)e:for(b=M.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&xy(b,B,M);else if(b.tag===19)xy(b,B,M);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===M)break e;for(;b.sibling===null;){if(b.return===null||b.return===M)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}Z&=1}if(Qs(yo,Z),(M.mode&1)===0)M.memoizedState=null;else switch(se){case"forwards":for(B=M.child,se=null;B!==null;)b=B.alternate,b!==null&&jg(b)===null&&(se=B),B=B.sibling;B=se,B===null?(se=M.child,M.child=null):(se=B.sibling,B.sibling=null),Zf(M,!1,se,B,ge);break;case"backwards":for(B=null,se=M.child,M.child=null;se!==null;){if(b=se.alternate,b!==null&&jg(b)===null){M.child=se;break}b=se.sibling,se.sibling=B,B=se,se=b}Zf(M,!0,B,null,ge);break;case"together":Zf(M,!1,null,null,void 0);break;default:M.memoizedState=null}return M.child}function Kf(b,M){(M.mode&1)===0&&b!==null&&(b.alternate=null,M.alternate=null,M.flags|=2)}function uu(b,M,B){if(b!==null&&(M.dependencies=b.dependencies),S|=M.lanes,(B&M.childLanes)===0)return null;if(b!==null&&M.child!==b.child)throw Error(n(153));if(M.child!==null){for(b=M.child,B=Gr(b,b.pendingProps),M.child=B,B.return=M;b.sibling!==null;)b=b.sibling,B=B.sibling=Gr(b,b.pendingProps),B.return=M;B.sibling=null}return M.child}function _y(b,M,B){switch(M.tag){case 3:Hu(M),Pl();break;case 5:Rg(M);break;case 1:ta(M.type)&&If(M);break;case 4:Uf(M,M.stateNode.containerInfo);break;case 10:var Z=M.type._context,se=M.memoizedProps.value;Qs(Bu,Z._currentValue),Z._currentValue=se;break;case 13:if(Z=M.memoizedState,Z!==null)return Z.dehydrated!==null?(Qs(yo,yo.current&1),M.flags|=128,null):(B&M.child.childLanes)!==0?Vh(b,M,B):(Qs(yo,yo.current&1),b=uu(b,M,B),b!==null?b.sibling:null);Qs(yo,yo.current&1);break;case 19:if(Z=(B&M.childLanes)!==0,(b.flags&128)!==0){if(Z)return Qf(b,M,B);M.flags|=128}if(se=M.memoizedState,se!==null&&(se.rendering=null,se.tail=null,se.lastEffect=null),Qs(yo,yo.current),Z)break;return null;case 22:case 23:return M.lanes=0,qg(b,M,B)}return uu(b,M,B)}var vy,Yf,by,wy;vy=function(b,M){for(var B=M.child;B!==null;){if(B.tag===5||B.tag===6)b.appendChild(B.stateNode);else if(B.tag!==4&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===M)break;for(;B.sibling===null;){if(B.return===null||B.return===M)return;B=B.return}B.sibling.return=B.return,B=B.sibling}},Yf=function(){},by=function(b,M,B,Z){var se=b.memoizedProps;if(se!==Z){b=M.stateNode,au(pr.current);var ge=null;switch(B){case"input":se=$r(b,se),Z=$r(b,Z),ge=[];break;case"select":se=qe({},se,{value:void 0}),Z=qe({},Z,{value:void 0}),ge=[];break;case"textarea":se=Nt(b,se),Z=Nt(b,Z),ge=[];break;default:typeof se.onClick!="function"&&typeof Z.onClick=="function"&&(b.onclick=Tg)}Vr(B,Z);var Ue;B=null;for(Tn in se)if(!Z.hasOwnProperty(Tn)&&se.hasOwnProperty(Tn)&&se[Tn]!=null)if(Tn==="style"){var xt=se[Tn];for(Ue in xt)xt.hasOwnProperty(Ue)&&(B||(B={}),B[Ue]="")}else Tn!=="dangerouslySetInnerHTML"&&Tn!=="children"&&Tn!=="suppressContentEditableWarning"&&Tn!=="suppressHydrationWarning"&&Tn!=="autoFocus"&&(l.hasOwnProperty(Tn)?ge||(ge=[]):(ge=ge||[]).push(Tn,null));for(Tn in Z){var Ft=Z[Tn];if(xt=se!=null?se[Tn]:void 0,Z.hasOwnProperty(Tn)&&Ft!==xt&&(Ft!=null||xt!=null))if(Tn==="style")if(xt){for(Ue in xt)!xt.hasOwnProperty(Ue)||Ft&&Ft.hasOwnProperty(Ue)||(B||(B={}),B[Ue]="");for(Ue in Ft)Ft.hasOwnProperty(Ue)&&xt[Ue]!==Ft[Ue]&&(B||(B={}),B[Ue]=Ft[Ue])}else B||(ge||(ge=[]),ge.push(Tn,B)),B=Ft;else Tn==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,xt=xt?xt.__html:void 0,Ft!=null&&xt!==Ft&&(ge=ge||[]).push(Tn,Ft)):Tn==="children"?typeof Ft!="string"&&typeof Ft!="number"||(ge=ge||[]).push(Tn,""+Ft):Tn!=="suppressContentEditableWarning"&&Tn!=="suppressHydrationWarning"&&(l.hasOwnProperty(Tn)?(Ft!=null&&Tn==="onScroll"&&co("scroll",b),ge||xt===Ft||(ge=[])):(ge=ge||[]).push(Tn,Ft))}B&&(ge=ge||[]).push("style",B);var Tn=ge;(M.updateQueue=Tn)&&(M.flags|=4)}},wy=function(b,M,B,Z){B!==Z&&(M.flags|=4)};function Jf(b,M){if(!Ws)switch(b.tailMode){case"hidden":M=b.tail;for(var B=null;M!==null;)M.alternate!==null&&(B=M),M=M.sibling;B===null?b.tail=null:B.sibling=null;break;case"collapsed":B=b.tail;for(var Z=null;B!==null;)B.alternate!==null&&(Z=B),B=B.sibling;Z===null?M||b.tail===null?b.tail=null:b.tail.sibling=null:Z.sibling=null}}function ma(b){var M=b.alternate!==null&&b.alternate.child===b.child,B=0,Z=0;if(M)for(var se=b.child;se!==null;)B|=se.lanes|se.childLanes,Z|=se.subtreeFlags&14680064,Z|=se.flags&14680064,se.return=b,se=se.sibling;else for(se=b.child;se!==null;)B|=se.lanes|se.childLanes,Z|=se.subtreeFlags,Z|=se.flags,se.return=b,se=se.sibling;return b.subtreeFlags|=Z,b.childLanes=B,M}function h_(b,M,B){var Z=M.pendingProps;switch(Yp(M),M.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ma(M),null;case 1:return ta(M.type)&&su(),ma(M),null;case 3:return Z=M.stateNode,Bd(),to(zo),to(Go),sm(),Z.pendingContext&&(Z.context=Z.pendingContext,Z.pendingContext=null),(b===null||b.child===null)&&(Ph(M)?M.flags|=4:b===null||b.memoizedState.isDehydrated&&(M.flags&256)===0||(M.flags|=1024,Il!==null&&(lt(Il),Il=null))),Yf(b,M),ma(M),null;case 5:Ng(M);var se=au(zf.current);if(B=M.type,b!==null&&M.stateNode!=null)by(b,M,B,Z,se),b.ref!==M.ref&&(M.flags|=512,M.flags|=2097152);else{if(!Z){if(M.stateNode===null)throw Error(n(166));return ma(M),null}if(b=au(pr.current),Ph(M)){Z=M.stateNode,B=M.type;var ge=M.memoizedProps;switch(Z[Cl]=M,Z[Nd]=ge,b=(M.mode&1)!==0,B){case"dialog":co("cancel",Z),co("close",Z);break;case"iframe":case"object":case"embed":co("load",Z);break;case"video":case"audio":for(se=0;se<Rd.length;se++)co(Rd[se],Z);break;case"source":co("error",Z);break;case"img":case"image":case"link":co("error",Z),co("load",Z);break;case"details":co("toggle",Z);break;case"input":ht(Z,ge),co("invalid",Z);break;case"select":Z._wrapperState={wasMultiple:!!ge.multiple},co("invalid",Z);break;case"textarea":et(Z,ge),co("invalid",Z)}Vr(B,ge),se=null;for(var Ue in ge)if(ge.hasOwnProperty(Ue)){var xt=ge[Ue];Ue==="children"?typeof xt=="string"?Z.textContent!==xt&&(ge.suppressHydrationWarning!==!0&&Sh(Z.textContent,xt,b),se=["children",xt]):typeof xt=="number"&&Z.textContent!==""+xt&&(ge.suppressHydrationWarning!==!0&&Sh(Z.textContent,xt,b),se=["children",""+xt]):l.hasOwnProperty(Ue)&&xt!=null&&Ue==="onScroll"&&co("scroll",Z)}switch(B){case"input":mn(Z),wn(Z,ge,!0);break;case"textarea":mn(Z),Bt(Z);break;case"select":case"option":break;default:typeof ge.onClick=="function"&&(Z.onclick=Tg)}Z=se,M.updateQueue=Z,Z!==null&&(M.flags|=4)}else{Ue=se.nodeType===9?se:se.ownerDocument,b==="http://www.w3.org/1999/xhtml"&&(b=En(B)),b==="http://www.w3.org/1999/xhtml"?B==="script"?(b=Ue.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild)):typeof Z.is=="string"?b=Ue.createElement(B,{is:Z.is}):(b=Ue.createElement(B),B==="select"&&(Ue=b,Z.multiple?Ue.multiple=!0:Z.size&&(Ue.size=Z.size))):b=Ue.createElementNS(b,B),b[Cl]=M,b[Nd]=Z,vy(b,M,!1,!1),M.stateNode=b;e:{switch(Ue=qn(B,Z),B){case"dialog":co("cancel",b),co("close",b),se=Z;break;case"iframe":case"object":case"embed":co("load",b),se=Z;break;case"video":case"audio":for(se=0;se<Rd.length;se++)co(Rd[se],b);se=Z;break;case"source":co("error",b),se=Z;break;case"img":case"image":case"link":co("error",b),co("load",b),se=Z;break;case"details":co("toggle",b),se=Z;break;case"input":ht(b,Z),se=$r(b,Z),co("invalid",b);break;case"option":se=Z;break;case"select":b._wrapperState={wasMultiple:!!Z.multiple},se=qe({},Z,{value:void 0}),co("invalid",b);break;case"textarea":et(b,Z),se=Nt(b,Z),co("invalid",b);break;default:se=Z}Vr(B,se),xt=se;for(ge in xt)if(xt.hasOwnProperty(ge)){var Ft=xt[ge];ge==="style"?In(b,Ft):ge==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ft!=null&&wr(b,Ft)):ge==="children"?typeof Ft=="string"?(B!=="textarea"||Ft!=="")&&cr(b,Ft):typeof Ft=="number"&&cr(b,""+Ft):ge!=="suppressContentEditableWarning"&&ge!=="suppressHydrationWarning"&&ge!=="autoFocus"&&(l.hasOwnProperty(ge)?Ft!=null&&ge==="onScroll"&&co("scroll",b):Ft!=null&&W(b,ge,Ft,Ue))}switch(B){case"input":mn(b),wn(b,Z,!1);break;case"textarea":mn(b),Bt(b);break;case"option":Z.value!=null&&b.setAttribute("value",""+qt(Z.value));break;case"select":b.multiple=!!Z.multiple,ge=Z.value,ge!=null?Qn(b,!!Z.multiple,ge,!1):Z.defaultValue!=null&&Qn(b,!!Z.multiple,Z.defaultValue,!0);break;default:typeof se.onClick=="function"&&(b.onclick=Tg)}switch(B){case"button":case"input":case"select":case"textarea":Z=!!Z.autoFocus;break e;case"img":Z=!0;break e;default:Z=!1}}Z&&(M.flags|=4)}M.ref!==null&&(M.flags|=512,M.flags|=2097152)}return ma(M),null;case 6:if(b&&M.stateNode!=null)wy(b,M,b.memoizedProps,Z);else{if(typeof Z!="string"&&M.stateNode===null)throw Error(n(166));if(B=au(zf.current),au(pr.current),Ph(M)){if(Z=M.stateNode,B=M.memoizedProps,Z[Cl]=M,(ge=Z.nodeValue!==B)&&(b=Ua,b!==null))switch(b.tag){case 3:Sh(Z.nodeValue,B,(b.mode&1)!==0);break;case 5:b.memoizedProps.suppressHydrationWarning!==!0&&Sh(Z.nodeValue,B,(b.mode&1)!==0)}ge&&(M.flags|=4)}else Z=(B.nodeType===9?B:B.ownerDocument).createTextNode(Z),Z[Cl]=M,M.stateNode=Z}return ma(M),null;case 13:if(to(yo),Z=M.memoizedState,b===null||b.memoizedState!==null&&b.memoizedState.dehydrated!==null){if(Ws&&hl!==null&&(M.mode&1)!==0&&(M.flags&128)===0)Od(),Pl(),M.flags|=98560,ge=!1;else if(ge=Ph(M),Z!==null&&Z.dehydrated!==null){if(b===null){if(!ge)throw Error(n(318));if(ge=M.memoizedState,ge=ge!==null?ge.dehydrated:null,!ge)throw Error(n(317));ge[Cl]=M}else Pl(),(M.flags&128)===0&&(M.memoizedState=null),M.flags|=4;ma(M),ge=!1}else Il!==null&&(lt(Il),Il=null),ge=!0;if(!ge)return M.flags&65536?M:null}return(M.flags&128)!==0?(M.lanes=B,M):(Z=Z!==null,Z!==(b!==null&&b.memoizedState!==null)&&Z&&(M.child.flags|=8192,(M.mode&1)!==0&&(b===null||(yo.current&1)!==0?d===0&&(d=3):_n())),M.updateQueue!==null&&(M.flags|=4),ma(M),null);case 4:return Bd(),Yf(b,M),b===null&&Hp(M.stateNode.containerInfo),ma(M),null;case 10:return Of(M.type._context),ma(M),null;case 17:return ta(M.type)&&su(),ma(M),null;case 19:if(to(yo),ge=M.memoizedState,ge===null)return ma(M),null;if(Z=(M.flags&128)!==0,Ue=ge.rendering,Ue===null)if(Z)Jf(ge,!1);else{if(d!==0||b!==null&&(b.flags&128)!==0)for(b=M.child;b!==null;){if(Ue=jg(b),Ue!==null){for(M.flags|=128,Jf(ge,!1),Z=Ue.updateQueue,Z!==null&&(M.updateQueue=Z,M.flags|=4),M.subtreeFlags=0,Z=B,B=M.child;B!==null;)ge=B,b=Z,ge.flags&=14680066,Ue=ge.alternate,Ue===null?(ge.childLanes=0,ge.lanes=b,ge.child=null,ge.subtreeFlags=0,ge.memoizedProps=null,ge.memoizedState=null,ge.updateQueue=null,ge.dependencies=null,ge.stateNode=null):(ge.childLanes=Ue.childLanes,ge.lanes=Ue.lanes,ge.child=Ue.child,ge.subtreeFlags=0,ge.deletions=null,ge.memoizedProps=Ue.memoizedProps,ge.memoizedState=Ue.memoizedState,ge.updateQueue=Ue.updateQueue,ge.type=Ue.type,b=Ue.dependencies,ge.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext}),B=B.sibling;return Qs(yo,yo.current&1|2),M.child}b=b.sibling}ge.tail!==null&&wt()>q&&(M.flags|=128,Z=!0,Jf(ge,!1),M.lanes=4194304)}else{if(!Z)if(b=jg(Ue),b!==null){if(M.flags|=128,Z=!0,B=b.updateQueue,B!==null&&(M.updateQueue=B,M.flags|=4),Jf(ge,!0),ge.tail===null&&ge.tailMode==="hidden"&&!Ue.alternate&&!Ws)return ma(M),null}else 2*wt()-ge.renderingStartTime>q&&B!==1073741824&&(M.flags|=128,Z=!0,Jf(ge,!1),M.lanes=4194304);ge.isBackwards?(Ue.sibling=M.child,M.child=Ue):(B=ge.last,B!==null?B.sibling=Ue:M.child=Ue,ge.last=Ue)}return ge.tail!==null?(M=ge.tail,ge.rendering=M,ge.tail=M.sibling,ge.renderingStartTime=wt(),M.sibling=null,B=yo.current,Qs(yo,Z?B&1|2:B&1),M):(ma(M),null);case 22:case 23:return rt(),Z=M.memoizedState!==null,b!==null&&b.memoizedState!==null!==Z&&(M.flags|=8192),Z&&(M.mode&1)!==0?(g&1073741824)!==0&&(ma(M),M.subtreeFlags&6&&(M.flags|=8192)):ma(M),null;case 24:return null;case 25:return null}throw Error(n(156,M.tag))}function Nb(b,M){switch(Yp(M),M.tag){case 1:return ta(M.type)&&su(),b=M.flags,b&65536?(M.flags=b&-65537|128,M):null;case 3:return Bd(),to(zo),to(Go),sm(),b=M.flags,(b&65536)!==0&&(b&128)===0?(M.flags=b&-65537|128,M):null;case 5:return Ng(M),null;case 13:if(to(yo),b=M.memoizedState,b!==null&&b.dehydrated!==null){if(M.alternate===null)throw Error(n(340));Pl()}return b=M.flags,b&65536?(M.flags=b&-65537|128,M):null;case 19:return to(yo),null;case 4:return Bd(),null;case 10:return Of(M.type._context),null;case 22:case 23:return rt(),null;case 24:return null;default:return null}}var Zg=!1,Li=!1,f_=typeof WeakSet=="function"?WeakSet:Set,oi=null;function ep(b,M){var B=b.ref;if(B!==null)if(typeof B=="function")try{B(null)}catch(Z){zr(b,M,Z)}else B.current=null}function Sy(b,M,B){try{B()}catch(Z){zr(b,M,Z)}}var tp=!1;function gm(b,M){if(Eg=gf,b=s_(),nu(b)){if("selectionStart"in b)var B={start:b.selectionStart,end:b.selectionEnd};else e:{B=(B=b.ownerDocument)&&B.defaultView||window;var Z=B.getSelection&&B.getSelection();if(Z&&Z.rangeCount!==0){B=Z.anchorNode;var se=Z.anchorOffset,ge=Z.focusNode;Z=Z.focusOffset;try{B.nodeType,ge.nodeType}catch{B=null;break e}var Ue=0,xt=-1,Ft=-1,Tn=0,or=0,yr=b,ar=null;t:for(;;){for(var ri;yr!==B||se!==0&&yr.nodeType!==3||(xt=Ue+se),yr!==ge||Z!==0&&yr.nodeType!==3||(Ft=Ue+Z),yr.nodeType===3&&(Ue+=yr.nodeValue.length),(ri=yr.firstChild)!==null;)ar=yr,yr=ri;for(;;){if(yr===b)break t;if(ar===B&&++Tn===se&&(xt=Ue),ar===ge&&++or===Z&&(Ft=Ue),(ri=yr.nextSibling)!==null)break;yr=ar,ar=yr.parentNode}yr=ri}B=xt===-1||Ft===-1?null:{start:xt,end:Ft}}else B=null}B=B||{start:0,end:0}}else B=null;for(Gp={focusedElem:b,selectionRange:B},gf=!1,oi=M;oi!==null;)if(M=oi,b=M.child,(M.subtreeFlags&1028)!==0&&b!==null)b.return=M,oi=b;else for(;oi!==null;){M=oi;try{var ci=M.alternate;if((M.flags&1024)!==0)switch(M.tag){case 0:case 11:case 15:break;case 1:if(ci!==null){var Yr=ci.memoizedProps,no=ci.memoizedState,cn=M.stateNode,Xt=cn.getSnapshotBeforeUpdate(M.elementType===M.type?Yr:Ea(M.type,Yr),no);cn.__reactInternalSnapshotBeforeUpdate=Xt}break;case 3:var pn=M.stateNode.containerInfo;pn.nodeType===1?pn.textContent="":pn.nodeType===9&&pn.documentElement&&pn.removeChild(pn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Sr){zr(M,M.return,Sr)}if(b=M.sibling,b!==null){b.return=M.return,oi=b;break}oi=M.return}return ci=tp,tp=!1,ci}function Gh(b,M,B){var Z=M.updateQueue;if(Z=Z!==null?Z.lastEffect:null,Z!==null){var se=Z=Z.next;do{if((se.tag&b)===b){var ge=se.destroy;se.destroy=void 0,ge!==void 0&&Sy(M,B,ge)}se=se.next}while(se!==Z)}}function $h(b,M){if(M=M.updateQueue,M=M!==null?M.lastEffect:null,M!==null){var B=M=M.next;do{if((B.tag&b)===b){var Z=B.create;B.destroy=Z()}B=B.next}while(B!==M)}}function pl(b){var M=b.ref;if(M!==null){var B=b.stateNode;switch(b.tag){case 5:b=B;break;default:b=B}typeof M=="function"?M(b):M.current=b}}function ym(b){var M=b.alternate;M!==null&&(b.alternate=null,ym(M)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(M=b.stateNode,M!==null&&(delete M[Cl],delete M[Nd],delete M[Mf],delete M[qp],delete M[c_])),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function Ks(b){return b.tag===5||b.tag===3||b.tag===4}function Ic(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||Ks(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&b.tag!==18;){if(b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function Hd(b,M,B){var Z=b.tag;if(Z===5||Z===6)b=b.stateNode,M?B.nodeType===8?B.parentNode.insertBefore(b,M):B.insertBefore(b,M):(B.nodeType===8?(M=B.parentNode,M.insertBefore(b,B)):(M=B,M.appendChild(b)),B=B._reactRootContainer,B!=null||M.onclick!==null||(M.onclick=Tg));else if(Z!==4&&(b=b.child,b!==null))for(Hd(b,M,B),b=b.sibling;b!==null;)Hd(b,M,B),b=b.sibling}function Wh(b,M,B){var Z=b.tag;if(Z===5||Z===6)b=b.stateNode,M?B.insertBefore(b,M):B.appendChild(b);else if(Z!==4&&(b=b.child,b!==null))for(Wh(b,M,B),b=b.sibling;b!==null;)Wh(b,M,B),b=b.sibling}var qo=null,nc=!1;function rc(b,M,B){for(B=B.child;B!==null;)p_(b,M,B),B=B.sibling}function p_(b,M,B){if(Er&&typeof Er.onCommitFiberUnmount=="function")try{Er.onCommitFiberUnmount(jr,B)}catch{}switch(B.tag){case 5:Li||ep(B,M);case 6:var Z=qo,se=nc;qo=null,rc(b,M,B),qo=Z,nc=se,qo!==null&&(nc?(b=qo,B=B.stateNode,b.nodeType===8?b.parentNode.removeChild(B):b.removeChild(B)):qo.removeChild(B.stateNode));break;case 18:qo!==null&&(nc?(b=qo,B=B.stateNode,b.nodeType===8?Ag(b.parentNode,B):b.nodeType===1&&Ag(b,B),Mu(b)):Ag(qo,B.stateNode));break;case 4:Z=qo,se=nc,qo=B.stateNode.containerInfo,nc=!0,rc(b,M,B),qo=Z,nc=se;break;case 0:case 11:case 14:case 15:if(!Li&&(Z=B.updateQueue,Z!==null&&(Z=Z.lastEffect,Z!==null))){se=Z=Z.next;do{var ge=se,Ue=ge.destroy;ge=ge.tag,Ue!==void 0&&((ge&2)!==0||(ge&4)!==0)&&Sy(B,M,Ue),se=se.next}while(se!==Z)}rc(b,M,B);break;case 1:if(!Li&&(ep(B,M),Z=B.stateNode,typeof Z.componentWillUnmount=="function"))try{Z.props=B.memoizedProps,Z.state=B.memoizedState,Z.componentWillUnmount()}catch(xt){zr(B,M,xt)}rc(b,M,B);break;case 21:rc(b,M,B);break;case 22:B.mode&1?(Li=(Z=Li)||B.memoizedState!==null,rc(b,M,B),Li=Z):rc(b,M,B);break;default:rc(b,M,B)}}function Ty(b){var M=b.updateQueue;if(M!==null){b.updateQueue=null;var B=b.stateNode;B===null&&(B=b.stateNode=new f_),M.forEach(function(Z){var se=Kr.bind(null,b,Z);B.has(Z)||(B.add(Z),Z.then(se,se))})}}function Ll(b,M){var B=M.deletions;if(B!==null)for(var Z=0;Z<B.length;Z++){var se=B[Z];try{var ge=b,Ue=M,xt=Ue;e:for(;xt!==null;){switch(xt.tag){case 5:qo=xt.stateNode,nc=!1;break e;case 3:qo=xt.stateNode.containerInfo,nc=!0;break e;case 4:qo=xt.stateNode.containerInfo,nc=!0;break e}xt=xt.return}if(qo===null)throw Error(n(160));p_(ge,Ue,se),qo=null,nc=!1;var Ft=se.alternate;Ft!==null&&(Ft.return=null),se.return=null}catch(Tn){zr(se,M,Tn)}}if(M.subtreeFlags&12854)for(M=M.child;M!==null;)Qg(M,b),M=M.sibling}function Qg(b,M){var B=b.alternate,Z=b.flags;switch(b.tag){case 0:case 11:case 14:case 15:if(Ll(M,b),Ol(b),Z&4){try{Gh(3,b,b.return),$h(3,b)}catch(Yr){zr(b,b.return,Yr)}try{Gh(5,b,b.return)}catch(Yr){zr(b,b.return,Yr)}}break;case 1:Ll(M,b),Ol(b),Z&512&&B!==null&&ep(B,B.return);break;case 5:if(Ll(M,b),Ol(b),Z&512&&B!==null&&ep(B,B.return),b.flags&32){var se=b.stateNode;try{cr(se,"")}catch(Yr){zr(b,b.return,Yr)}}if(Z&4&&(se=b.stateNode,se!=null)){var ge=b.memoizedProps,Ue=B!==null?B.memoizedProps:ge,xt=b.type,Ft=b.updateQueue;if(b.updateQueue=null,Ft!==null)try{xt==="input"&&ge.type==="radio"&&ge.name!=null&&Lr(se,ge),qn(xt,Ue);var Tn=qn(xt,ge);for(Ue=0;Ue<Ft.length;Ue+=2){var or=Ft[Ue],yr=Ft[Ue+1];or==="style"?In(se,yr):or==="dangerouslySetInnerHTML"?wr(se,yr):or==="children"?cr(se,yr):W(se,or,yr,Tn)}switch(xt){case"input":Br(se,ge);break;case"textarea":Oe(se,ge);break;case"select":var ar=se._wrapperState.wasMultiple;se._wrapperState.wasMultiple=!!ge.multiple;var ri=ge.value;ri!=null?Qn(se,!!ge.multiple,ri,!1):ar!==!!ge.multiple&&(ge.defaultValue!=null?Qn(se,!!ge.multiple,ge.defaultValue,!0):Qn(se,!!ge.multiple,ge.multiple?[]:"",!1))}se[Nd]=ge}catch(Yr){zr(b,b.return,Yr)}}break;case 6:if(Ll(M,b),Ol(b),Z&4){if(b.stateNode===null)throw Error(n(162));se=b.stateNode,ge=b.memoizedProps;try{se.nodeValue=ge}catch(Yr){zr(b,b.return,Yr)}}break;case 3:if(Ll(M,b),Ol(b),Z&4&&B!==null&&B.memoizedState.isDehydrated)try{Mu(M.containerInfo)}catch(Yr){zr(b,b.return,Yr)}break;case 4:Ll(M,b),Ol(b);break;case 13:Ll(M,b),Ol(b),se=b.child,se.flags&8192&&(ge=se.memoizedState!==null,se.stateNode.isHidden=ge,!ge||se.alternate!==null&&se.alternate.memoizedState!==null||($=wt())),Z&4&&Ty(b);break;case 22:if(or=B!==null&&B.memoizedState!==null,b.mode&1?(Li=(Tn=Li)||or,Ll(M,b),Li=Tn):Ll(M,b),Ol(b),Z&8192){if(Tn=b.memoizedState!==null,(b.stateNode.isHidden=Tn)&&!or&&(b.mode&1)!==0)for(oi=b,or=b.child;or!==null;){for(yr=oi=or;oi!==null;){switch(ar=oi,ri=ar.child,ar.tag){case 0:case 11:case 14:case 15:Gh(4,ar,ar.return);break;case 1:ep(ar,ar.return);var ci=ar.stateNode;if(typeof ci.componentWillUnmount=="function"){Z=ar,B=ar.return;try{M=Z,ci.props=M.memoizedProps,ci.state=M.memoizedState,ci.componentWillUnmount()}catch(Yr){zr(Z,B,Yr)}}break;case 5:ep(ar,ar.return);break;case 22:if(ar.memoizedState!==null){ic(yr);continue}}ri!==null?(ri.return=ar,oi=ri):ic(yr)}or=or.sibling}e:for(or=null,yr=b;;){if(yr.tag===5){if(or===null){or=yr;try{se=yr.stateNode,Tn?(ge=se.style,typeof ge.setProperty=="function"?ge.setProperty("display","none","important"):ge.display="none"):(xt=yr.stateNode,Ft=yr.memoizedProps.style,Ue=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null,xt.style.display=bn("display",Ue))}catch(Yr){zr(b,b.return,Yr)}}}else if(yr.tag===6){if(or===null)try{yr.stateNode.nodeValue=Tn?"":yr.memoizedProps}catch(Yr){zr(b,b.return,Yr)}}else if((yr.tag!==22&&yr.tag!==23||yr.memoizedState===null||yr===b)&&yr.child!==null){yr.child.return=yr,yr=yr.child;continue}if(yr===b)break e;for(;yr.sibling===null;){if(yr.return===null||yr.return===b)break e;or===yr&&(or=null),yr=yr.return}or===yr&&(or=null),yr.sibling.return=yr.return,yr=yr.sibling}}break;case 19:Ll(M,b),Ol(b),Z&4&&Ty(b);break;case 21:break;default:Ll(M,b),Ol(b)}}function Ol(b){var M=b.flags;if(M&2){try{e:{for(var B=b.return;B!==null;){if(Ks(B)){var Z=B;break e}B=B.return}throw Error(n(160))}switch(Z.tag){case 5:var se=Z.stateNode;Z.flags&32&&(cr(se,""),Z.flags&=-33);var ge=Ic(b);Wh(b,ge,se);break;case 3:case 4:var Ue=Z.stateNode.containerInfo,xt=Ic(b);Hd(b,xt,Ue);break;default:throw Error(n(161))}}catch(Ft){zr(b,b.return,Ft)}b.flags&=-3}M&4096&&(b.flags&=-4097)}function Kg(b,M,B){oi=b,np(b)}function np(b,M,B){for(var Z=(b.mode&1)!==0;oi!==null;){var se=oi,ge=se.child;if(se.tag===22&&Z){var Ue=se.memoizedState!==null||Zg;if(!Ue){var xt=se.alternate,Ft=xt!==null&&xt.memoizedState!==null||Li;xt=Zg;var Tn=Li;if(Zg=Ue,(Li=Ft)&&!Tn)for(oi=se;oi!==null;)Ue=oi,Ft=Ue.child,Ue.tag===22&&Ue.memoizedState!==null?Xo(se):Ft!==null?(Ft.return=Ue,oi=Ft):Xo(se);for(;ge!==null;)oi=ge,np(ge),ge=ge.sibling;oi=se,Zg=xt,Li=Tn}du(b)}else(se.subtreeFlags&8772)!==0&&ge!==null?(ge.return=se,oi=ge):du(b)}}function du(b){for(;oi!==null;){var M=oi;if((M.flags&8772)!==0){var B=M.alternate;try{if((M.flags&8772)!==0)switch(M.tag){case 0:case 11:case 15:Li||$h(5,M);break;case 1:var Z=M.stateNode;if(M.flags&4&&!Li)if(B===null)Z.componentDidMount();else{var se=M.elementType===M.type?B.memoizedProps:Ea(M.type,B.memoizedProps);Z.componentDidUpdate(se,B.memoizedState,Z.__reactInternalSnapshotBeforeUpdate)}var ge=M.updateQueue;ge!==null&&zu(M,ge,Z);break;case 3:var Ue=M.updateQueue;if(Ue!==null){if(B=null,M.child!==null)switch(M.child.tag){case 5:B=M.child.stateNode;break;case 1:B=M.child.stateNode}zu(M,Ue,B)}break;case 5:var xt=M.stateNode;if(B===null&&M.flags&4){B=xt;var Ft=M.memoizedProps;switch(M.type){case"button":case"input":case"select":case"textarea":Ft.autoFocus&&B.focus();break;case"img":Ft.src&&(B.src=Ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(M.memoizedState===null){var Tn=M.alternate;if(Tn!==null){var or=Tn.memoizedState;if(or!==null){var yr=or.dehydrated;yr!==null&&Mu(yr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Li||M.flags&512&&pl(M)}catch(ar){zr(M,M.return,ar)}}if(M===b){oi=null;break}if(B=M.sibling,B!==null){B.return=M.return,oi=B;break}oi=M.return}}function ic(b){for(;oi!==null;){var M=oi;if(M===b){oi=null;break}var B=M.sibling;if(B!==null){B.return=M.return,oi=B;break}oi=M.return}}function Xo(b){for(;oi!==null;){var M=oi;try{switch(M.tag){case 0:case 11:case 15:var B=M.return;try{$h(4,M)}catch(Ft){zr(M,B,Ft)}break;case 1:var Z=M.stateNode;if(typeof Z.componentDidMount=="function"){var se=M.return;try{Z.componentDidMount()}catch(Ft){zr(M,se,Ft)}}var ge=M.return;try{pl(M)}catch(Ft){zr(M,ge,Ft)}break;case 5:var Ue=M.return;try{pl(M)}catch(Ft){zr(M,Ue,Ft)}}}catch(Ft){zr(M,M.return,Ft)}if(M===b){oi=null;break}var xt=M.sibling;if(xt!==null){xt.return=M.return,oi=xt;break}oi=M.return}}var Gu=Math.ceil,ml=K.ReactCurrentDispatcher,Ey=K.ReactCurrentOwner,sc=K.ReactCurrentBatchConfig,Ps=0,ra=null,So=null,Ls=0,g=0,o=Dd(0),d=0,y=null,S=0,C=0,I=0,j=null,z=null,$=0,q=1/0,ee=null,Q=!1,ie=null,le=null,de=!1,be=null,_e=0,Se=0,Pe=null,Ee=-1,We=0;function Ne(){return(Ps&6)!==0?wt():Ee!==-1?Ee:Ee=wt()}function Xe(b){return(b.mode&1)===0?1:(Ps&2)!==0&&Ls!==0?Ls&-Ls:Mg.transition!==null?(We===0&&(We=mo()),We):(b=ji,b!==0||(b=window.event,b=b===void 0?16:kp(b.type)),b)}function ze(b,M,B,Z){if(50<Se)throw Se=0,Pe=null,Error(n(185));Is(b,B,Z),((Ps&2)===0||b!==ra)&&(b===ra&&((Ps&2)===0&&(C|=B),d===4&&Tt(b,Ls)),De(b,Z),B===1&&Ps===0&&(M.mode&1)===0&&(q=wt()+500,Rf&&Tc()))}function De(b,M){var B=b.callbackNode;Gs(b,M);var Z=Ni(b,b===ra?Ls:0);if(Z===0)B!==null&&tn(B),b.callbackNode=null,b.callbackPriority=0;else if(M=Z&-Z,b.callbackPriority!==M){if(B!=null&&tn(B),M===1)b.tag===0?Qp(Gt.bind(null,b)):Cg(Gt.bind(null,b)),Wp(function(){(Ps&6)===0&&Tc()}),B=null;else{switch(Zc(Z)){case 1:B=Et;break;case 4:B=Sn;break;case 16:B=Hn;break;case 536870912:B=vr;break;default:B=Hn}B=wi(B,Qe.bind(null,b))}b.callbackPriority=M,b.callbackNode=B}}function Qe(b,M){if(Ee=-1,We=0,(Ps&6)!==0)throw Error(n(327));var B=b.callbackNode;if(_r()&&b.callbackNode!==B)return null;var Z=Ni(b,b===ra?Ls:0);if(Z===0)return null;if((Z&30)!==0||(Z&b.expiredLanes)!==0||M)M=Vn(b,Z);else{M=Z;var se=Ps;Ps|=2;var ge=Jt();(ra!==b||Ls!==M)&&(ee=null,q=wt()+500,zt(b,M));do try{yn();break}catch(xt){Mt(b,xt)}while(!0);cy(),ml.current=ge,Ps=se,So!==null?M=0:(ra=null,Ls=0,M=d)}if(M!==0){if(M===2&&(se=Zs(b),se!==0&&(Z=se,M=dt(b,se))),M===1)throw B=y,zt(b,0),Tt(b,Z),De(b,wt()),B;if(M===6)Tt(b,Z);else{if(se=b.current.alternate,(Z&30)===0&&!Lt(se)&&(M=Vn(b,Z),M===2&&(ge=Zs(b),ge!==0&&(Z=ge,M=dt(b,ge))),M===1))throw B=y,zt(b,0),Tt(b,Z),De(b,wt()),B;switch(b.finishedWork=se,b.finishedLanes=Z,M){case 0:case 1:throw Error(n(345));case 2:Cn(b,z,ee);break;case 3:if(Tt(b,Z),(Z&130023424)===Z&&(M=$+500-wt(),10<M)){if(Ni(b,0)!==0)break;if(se=b.suspendedLanes,(se&Z)!==Z){Ne(),b.pingedLanes|=b.suspendedLanes&se;break}b.timeoutHandle=$p(Cn.bind(null,b,z,ee),M);break}Cn(b,z,ee);break;case 4:if(Tt(b,Z),(Z&4194240)===Z)break;for(M=b.eventTimes,se=-1;0<Z;){var Ue=31-ur(Z);ge=1<<Ue,Ue=M[Ue],Ue>se&&(se=Ue),Z&=~ge}if(Z=se,Z=wt()-Z,Z=(120>Z?120:480>Z?480:1080>Z?1080:1920>Z?1920:3e3>Z?3e3:4320>Z?4320:1960*Gu(Z/1960))-Z,10<Z){b.timeoutHandle=$p(Cn.bind(null,b,z,ee),Z);break}Cn(b,z,ee);break;case 5:Cn(b,z,ee);break;default:throw Error(n(329))}}}return De(b,wt()),b.callbackNode===B?Qe.bind(null,b):null}function dt(b,M){var B=j;return b.current.memoizedState.isDehydrated&&(zt(b,M).flags|=256),b=Vn(b,M),b!==2&&(M=z,z=B,M!==null&&lt(M)),b}function lt(b){z===null?z=b:z.push.apply(z,b)}function Lt(b){for(var M=b;;){if(M.flags&16384){var B=M.updateQueue;if(B!==null&&(B=B.stores,B!==null))for(var Z=0;Z<B.length;Z++){var se=B[Z],ge=se.getSnapshot;se=se.value;try{if(!ll(ge(),se))return!1}catch{return!1}}}if(B=M.child,M.subtreeFlags&16384&&B!==null)B.return=M,M=B;else{if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return!0;M=M.return}M.sibling.return=M.return,M=M.sibling}}return!0}function Tt(b,M){for(M&=~I,M&=~C,b.suspendedLanes|=M,b.pingedLanes&=~M,b=b.expirationTimes;0<M;){var B=31-ur(M),Z=1<<B;b[B]=-1,M&=~Z}}function Gt(b){if((Ps&6)!==0)throw Error(n(327));_r();var M=Ni(b,0);if((M&1)===0)return De(b,wt()),null;var B=Vn(b,M);if(b.tag!==0&&B===2){var Z=Zs(b);Z!==0&&(M=Z,B=dt(b,Z))}if(B===1)throw B=y,zt(b,0),Tt(b,M),De(b,wt()),B;if(B===6)throw Error(n(345));return b.finishedWork=b.current.alternate,b.finishedLanes=M,Cn(b,z,ee),De(b,wt()),null}function hn(b,M){var B=Ps;Ps|=1;try{return b(M)}finally{Ps=B,Ps===0&&(q=wt()+500,Rf&&Tc())}}function mt(b){be!==null&&be.tag===0&&(Ps&6)===0&&_r();var M=Ps;Ps|=1;var B=sc.transition,Z=ji;try{if(sc.transition=null,ji=1,b)return b()}finally{ji=Z,sc.transition=B,Ps=M,(Ps&6)===0&&Tc()}}function rt(){g=o.current,to(o)}function zt(b,M){b.finishedWork=null,b.finishedLanes=0;var B=b.timeoutHandle;if(B!==-1&&(b.timeoutHandle=-1,Th(B)),So!==null)for(B=So.return;B!==null;){var Z=B;switch(Yp(Z),Z.tag){case 1:Z=Z.type.childContextTypes,Z!=null&&su();break;case 3:Bd(),to(zo),to(Go),sm();break;case 5:Ng(Z);break;case 4:Bd();break;case 13:to(yo);break;case 19:to(yo);break;case 10:Of(Z.type._context);break;case 22:case 23:rt()}B=B.return}if(ra=b,So=b=Gr(b.current,null),Ls=g=M,d=0,y=null,I=C=S=0,z=j=null,fl!==null){for(M=0;M<fl.length;M++)if(B=fl[M],Z=B.interleaved,Z!==null){B.interleaved=null;var se=Z.next,ge=B.pending;if(ge!==null){var Ue=ge.next;ge.next=se,Z.next=Ue}B.pending=Z}fl=null}return b}function Mt(b,M){do{var B=So;try{if(cy(),$o.current=di,Vf){for(var Z=uo.memoizedState;Z!==null;){var se=Z.queue;se!==null&&(se.pending=null),Z=Z.next}Vf=!1}if(zd=0,Uo=Ro=uo=null,na=!1,rs=0,Ey.current=null,B===null||B.return===null){d=1,y=M,So=null;break}e:{var ge=b,Ue=B.return,xt=B,Ft=M;if(M=Ls,xt.flags|=32768,Ft!==null&&typeof Ft=="object"&&typeof Ft.then=="function"){var Tn=Ft,or=xt,yr=or.tag;if((or.mode&1)===0&&(yr===0||yr===11||yr===15)){var ar=or.alternate;ar?(or.updateQueue=ar.updateQueue,or.memoizedState=ar.memoizedState,or.lanes=ar.lanes):(or.updateQueue=null,or.memoizedState=null)}var ri=Dl(Ue);if(ri!==null){ri.flags&=-257,Gg(ri,Ue,xt,ge,M),ri.mode&1&&Hg(ge,Tn,M),M=ri,Ft=Tn;var ci=M.updateQueue;if(ci===null){var Yr=new Set;Yr.add(Ft),M.updateQueue=Yr}else ci.add(Ft);break e}else{if((M&1)===0){Hg(ge,Tn,M),_n();break e}Ft=Error(n(426))}}else if(Ws&&xt.mode&1){var no=Dl(Ue);if(no!==null){(no.flags&65536)===0&&(no.flags|=256),Gg(no,Ue,xt,ge,M),Jp(jl(Ft,xt));break e}}ge=Ft=jl(Ft,xt),d!==4&&(d=2),j===null?j=[ge]:j.push(ge),ge=Ue;do{switch(ge.tag){case 3:ge.flags|=65536,M&=-M,ge.lanes|=M;var cn=zh(ge,Ft,M);Pg(ge,cn);break e;case 1:xt=Ft;var Xt=ge.type,pn=ge.stateNode;if((ge.flags&128)===0&&(typeof Xt.getDerivedStateFromError=="function"||pn!==null&&typeof pn.componentDidCatch=="function"&&(le===null||!le.has(pn)))){ge.flags|=65536,M&=-M,ge.lanes|=M;var Sr=Vu(ge,xt,M);Pg(ge,Sr);break e}}ge=ge.return}while(ge!==null)}On(B)}catch(hi){M=hi,So===B&&B!==null&&(So=B=B.return);continue}break}while(!0)}function Jt(){var b=ml.current;return ml.current=di,b===null?di:b}function _n(){(d===0||d===3||d===2)&&(d=4),ra===null||(S&268435455)===0&&(C&268435455)===0||Tt(ra,Ls)}function Vn(b,M){var B=Ps;Ps|=2;var Z=Jt();(ra!==b||Ls!==M)&&(ee=null,zt(b,M));do try{fn();break}catch(se){Mt(b,se)}while(!0);if(cy(),Ps=B,ml.current=Z,So!==null)throw Error(n(261));return ra=null,Ls=0,d}function fn(){for(;So!==null;)$n(So)}function yn(){for(;So!==null&&!Re();)$n(So)}function $n(b){var M=Xi(b.alternate,b,g);b.memoizedProps=b.pendingProps,M===null?On(b):So=M,Ey.current=null}function On(b){var M=b;do{var B=M.alternate;if(b=M.return,(M.flags&32768)===0){if(B=h_(B,M,g),B!==null){So=B;return}}else{if(B=Nb(B,M),B!==null){B.flags&=32767,So=B;return}if(b!==null)b.flags|=32768,b.subtreeFlags=0,b.deletions=null;else{d=6,So=null;return}}if(M=M.sibling,M!==null){So=M;return}So=M=b}while(M!==null);d===0&&(d=5)}function Cn(b,M,B){var Z=ji,se=sc.transition;try{sc.transition=null,ji=1,Bn(b,M,B,Z)}finally{sc.transition=se,ji=Z}return null}function Bn(b,M,B,Z){do _r();while(be!==null);if((Ps&6)!==0)throw Error(n(327));B=b.finishedWork;var se=b.finishedLanes;if(B===null)return null;if(b.finishedWork=null,b.finishedLanes=0,B===b.current)throw Error(n(177));b.callbackNode=null,b.callbackPriority=0;var ge=B.lanes|B.childLanes;if(eo(b,ge),b===ra&&(So=ra=null,Ls=0),(B.subtreeFlags&2064)===0&&(B.flags&2064)===0||de||(de=!0,wi(Hn,function(){return _r(),null})),ge=(B.flags&15990)!==0,(B.subtreeFlags&15990)!==0||ge){ge=sc.transition,sc.transition=null;var Ue=ji;ji=1;var xt=Ps;Ps|=4,Ey.current=null,gm(b,B),Qg(B,b),kb(Gp),gf=!!Eg,Gp=Eg=null,b.current=B,Kg(B),gt(),Ps=xt,ji=Ue,sc.transition=ge}else b.current=B;if(de&&(de=!1,be=b,_e=se),ge=b.pendingLanes,ge===0&&(le=null),fr(B.stateNode),De(b,wt()),M!==null)for(Z=b.onRecoverableError,B=0;B<M.length;B++)se=M[B],Z(se.value,{componentStack:se.stack,digest:se.digest});if(Q)throw Q=!1,b=ie,ie=null,b;return(_e&1)!==0&&b.tag!==0&&_r(),ge=b.pendingLanes,(ge&1)!==0?b===Pe?Se++:(Se=0,Pe=b):Se=0,Tc(),null}function _r(){if(be!==null){var b=Zc(_e),M=sc.transition,B=ji;try{if(sc.transition=null,ji=16>b?16:b,be===null)var Z=!1;else{if(b=be,be=null,_e=0,(Ps&6)!==0)throw Error(n(331));var se=Ps;for(Ps|=4,oi=b.current;oi!==null;){var ge=oi,Ue=ge.child;if((oi.flags&16)!==0){var xt=ge.deletions;if(xt!==null){for(var Ft=0;Ft<xt.length;Ft++){var Tn=xt[Ft];for(oi=Tn;oi!==null;){var or=oi;switch(or.tag){case 0:case 11:case 15:Gh(8,or,ge)}var yr=or.child;if(yr!==null)yr.return=or,oi=yr;else for(;oi!==null;){or=oi;var ar=or.sibling,ri=or.return;if(ym(or),or===Tn){oi=null;break}if(ar!==null){ar.return=ri,oi=ar;break}oi=ri}}}var ci=ge.alternate;if(ci!==null){var Yr=ci.child;if(Yr!==null){ci.child=null;do{var no=Yr.sibling;Yr.sibling=null,Yr=no}while(Yr!==null)}}oi=ge}}if((ge.subtreeFlags&2064)!==0&&Ue!==null)Ue.return=ge,oi=Ue;else e:for(;oi!==null;){if(ge=oi,(ge.flags&2048)!==0)switch(ge.tag){case 0:case 11:case 15:Gh(9,ge,ge.return)}var cn=ge.sibling;if(cn!==null){cn.return=ge.return,oi=cn;break e}oi=ge.return}}var Xt=b.current;for(oi=Xt;oi!==null;){Ue=oi;var pn=Ue.child;if((Ue.subtreeFlags&2064)!==0&&pn!==null)pn.return=Ue,oi=pn;else e:for(Ue=Xt;oi!==null;){if(xt=oi,(xt.flags&2048)!==0)try{switch(xt.tag){case 0:case 11:case 15:$h(9,xt)}}catch(hi){zr(xt,xt.return,hi)}if(xt===Ue){oi=null;break e}var Sr=xt.sibling;if(Sr!==null){Sr.return=xt.return,oi=Sr;break e}oi=xt.return}}if(Ps=se,Tc(),Er&&typeof Er.onPostCommitFiberRoot=="function")try{Er.onPostCommitFiberRoot(jr,b)}catch{}Z=!0}return Z}finally{ji=B,sc.transition=M}}return!1}function mi(b,M,B){M=jl(B,M),M=zh(b,M,1),b=Nl(b,M,1),M=Ne(),b!==null&&(Is(b,1,M),De(b,M))}function zr(b,M,B){if(b.tag===3)mi(b,b,B);else for(;M!==null;){if(M.tag===3){mi(M,b,B);break}else if(M.tag===1){var Z=M.stateNode;if(typeof M.type.getDerivedStateFromError=="function"||typeof Z.componentDidCatch=="function"&&(le===null||!le.has(Z))){b=jl(B,b),b=Vu(M,b,1),M=Nl(M,b,1),b=Ne(),M!==null&&(Is(M,1,b),De(M,b));break}}M=M.return}}function ts(b,M,B){var Z=b.pingCache;Z!==null&&Z.delete(M),M=Ne(),b.pingedLanes|=b.suspendedLanes&B,ra===b&&(Ls&B)===B&&(d===4||d===3&&(Ls&130023424)===Ls&&500>wt()-$?zt(b,0):I|=B),De(b,M)}function Ir(b,M){M===0&&((b.mode&1)===0?M=1:(M=Or,Or<<=1,(Or&130023424)===0&&(Or=4194304)));var B=Ne();b=Kl(b,M),b!==null&&(Is(b,M,B),De(b,B))}function bi(b){var M=b.memoizedState,B=0;M!==null&&(B=M.retryLane),Ir(b,B)}function Kr(b,M){var B=0;switch(b.tag){case 13:var Z=b.stateNode,se=b.memoizedState;se!==null&&(B=se.retryLane);break;case 19:Z=b.stateNode;break;default:throw Error(n(314))}Z!==null&&Z.delete(M),Ir(b,B)}var Xi;Xi=function(b,M,B){if(b!==null)if(b.memoizedProps!==M.pendingProps||zo.current)Wo=!0;else{if((b.lanes&B)===0&&(M.flags&128)===0)return Wo=!1,_y(b,M,B);Wo=(b.flags&131072)!==0}else Wo=!1,Ws&&(M.flags&1048576)!==0&&u_(M,Kp,M.index);switch(M.lanes=0,M.tag){case 2:var Z=M.type;Kf(b,M),b=M.pendingProps;var se=Mh(M,Go.current);Va(M,B),se=Lg(null,M,Z,b,se,B);var ge=Cc();return M.flags|=1,typeof se=="object"&&se!==null&&typeof se.render=="function"&&se.$$typeof===void 0?(M.tag=1,M.memoizedState=null,M.updateQueue=null,ta(Z)?(ge=!0,If(M)):ge=!1,M.memoizedState=se.state!==null&&se.state!==void 0?se.state:null,Bf(M),se.updater=Gf,M.stateNode=se,se._reactInternals=M,Wa(M,Z,b,B),M=pm(null,M,Z,!0,ge,B)):(M.tag=0,Ws&&ge&&Nf(M),Vo(null,M,se,B),M=M.child),M;case 16:Z=M.elementType;e:{switch(Kf(b,M),b=M.pendingProps,se=Z._init,Z=se(Z._payload),M.type=Z,se=M.tag=Oi(Z),b=Ea(Z,b),se){case 0:M=fm(null,M,Z,b,B);break e;case 1:M=Wf(null,M,Z,b,B);break e;case 11:M=ys(null,M,Z,b,B);break e;case 14:M=Uh(null,M,Z,Ea(Z.type,b),B);break e}throw Error(n(306,Z,""))}return M;case 0:return Z=M.type,se=M.pendingProps,se=M.elementType===Z?se:Ea(Z,se),fm(b,M,Z,se,B);case 1:return Z=M.type,se=M.pendingProps,se=M.elementType===Z?se:Ea(Z,se),Wf(b,M,Z,se,B);case 3:e:{if(Hu(M),b===null)throw Error(n(387));Z=M.pendingProps,ge=M.memoizedState,se=ge.element,uy(b,M),Jl(M,Z,null,B);var Ue=M.memoizedState;if(Z=Ue.element,ge.isDehydrated)if(ge={element:Z,isDehydrated:!1,cache:Ue.cache,pendingSuspenseBoundaries:Ue.pendingSuspenseBoundaries,transitions:Ue.transitions},M.updateQueue.baseState=ge,M.memoizedState=ge,M.flags&256){se=jl(Error(n(423)),M),M=Xg(b,M,Z,B,se);break e}else if(Z!==se){se=jl(Error(n(424)),M),M=Xg(b,M,Z,B,se);break e}else for(hl=iu(M.stateNode.containerInfo.firstChild),Ua=M,Ws=!0,Il=null,B=nm(M,null,Z,B),M.child=B;B;)B.flags=B.flags&-3|4096,B=B.sibling;else{if(Pl(),Z===se){M=uu(b,M,B);break e}Vo(b,M,Z,B)}M=M.child}return M;case 5:return Rg(M),b===null&&Ac(M),Z=M.type,se=M.pendingProps,ge=b!==null?b.memoizedProps:null,Ue=se.children,Af(Z,se)?Ue=null:ge!==null&&Af(Z,ge)&&(M.flags|=32),Vd(b,M),Vo(b,M,Ue,B),M.child;case 6:return b===null&&Ac(M),null;case 13:return Vh(b,M,B);case 4:return Uf(M,M.stateNode.containerInfo),Z=M.pendingProps,b===null?M.child=Fd(M,null,Z,B):Vo(b,M,Z,B),M.child;case 11:return Z=M.type,se=M.pendingProps,se=M.elementType===Z?se:Ea(Z,se),ys(b,M,Z,se,B);case 7:return Vo(b,M,M.pendingProps,B),M.child;case 8:return Vo(b,M,M.pendingProps.children,B),M.child;case 12:return Vo(b,M,M.pendingProps.children,B),M.child;case 10:e:{if(Z=M.type._context,se=M.pendingProps,ge=M.memoizedProps,Ue=se.value,Qs(Bu,Z._currentValue),Z._currentValue=Ue,ge!==null)if(ll(ge.value,Ue)){if(ge.children===se.children&&!zo.current){M=uu(b,M,B);break e}}else for(ge=M.child,ge!==null&&(ge.return=M);ge!==null;){var xt=ge.dependencies;if(xt!==null){Ue=ge.child;for(var Ft=xt.firstContext;Ft!==null;){if(Ft.context===Z){if(ge.tag===1){Ft=Ha(-1,B&-B),Ft.tag=2;var Tn=ge.updateQueue;if(Tn!==null){Tn=Tn.shared;var or=Tn.pending;or===null?Ft.next=Ft:(Ft.next=or.next,or.next=Ft),Tn.pending=Ft}}ge.lanes|=B,Ft=ge.alternate,Ft!==null&&(Ft.lanes|=B),Ff(ge.return,B,M),xt.lanes|=B;break}Ft=Ft.next}}else if(ge.tag===10)Ue=ge.type===M.type?null:ge.child;else if(ge.tag===18){if(Ue=ge.return,Ue===null)throw Error(n(341));Ue.lanes|=B,xt=Ue.alternate,xt!==null&&(xt.lanes|=B),Ff(Ue,B,M),Ue=ge.sibling}else Ue=ge.child;if(Ue!==null)Ue.return=ge;else for(Ue=ge;Ue!==null;){if(Ue===M){Ue=null;break}if(ge=Ue.sibling,ge!==null){ge.return=Ue.return,Ue=ge;break}Ue=Ue.return}ge=Ue}Vo(b,M,se.children,B),M=M.child}return M;case 9:return se=M.type,Z=M.pendingProps.children,Va(M,B),se=Sa(se),Z=Z(se),M.flags|=1,Vo(b,M,Z,B),M.child;case 14:return Z=M.type,se=Ea(Z,M.pendingProps),se=Ea(Z.type,se),Uh(b,M,Z,se,B);case 15:return Wg(b,M,M.type,M.pendingProps,B);case 17:return Z=M.type,se=M.pendingProps,se=M.elementType===Z?se:Ea(Z,se),Kf(b,M),M.tag=1,ta(Z)?(b=!0,If(M)):b=!1,Va(M,B),dm(M,Z,se),Wa(M,Z,se,B),pm(null,M,Z,!0,b,B);case 19:return Qf(b,M,B);case 22:return qg(b,M,B)}throw Error(n(156,M.tag))};function wi(b,M){return un(b,M)}function ss(b,M,B,Z){this.tag=b,this.key=B,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=M,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(b,M,B,Z){return new ss(b,M,B,Z)}function Xr(b){return b=b.prototype,!(!b||!b.isReactComponent)}function Oi(b){if(typeof b=="function")return Xr(b)?1:0;if(b!=null){if(b=b.$$typeof,b===Ce)return 11;if(b===ke)return 14}return 2}function Gr(b,M){var B=b.alternate;return B===null?(B=gi(b.tag,M,b.key,b.mode),B.elementType=b.elementType,B.type=b.type,B.stateNode=b.stateNode,B.alternate=b,b.alternate=B):(B.pendingProps=M,B.type=b.type,B.flags=0,B.subtreeFlags=0,B.deletions=null),B.flags=b.flags&14680064,B.childLanes=b.childLanes,B.lanes=b.lanes,B.child=b.child,B.memoizedProps=b.memoizedProps,B.memoizedState=b.memoizedState,B.updateQueue=b.updateQueue,M=b.dependencies,B.dependencies=M===null?null:{lanes:M.lanes,firstContext:M.firstContext},B.sibling=b.sibling,B.index=b.index,B.ref=b.ref,B}function os(b,M,B,Z,se,ge){var Ue=2;if(Z=b,typeof b=="function")Xr(b)&&(Ue=1);else if(typeof b=="string")Ue=5;else e:switch(b){case re:return Ei(B.children,se,ge,M);case xe:Ue=8,se|=8;break;case ae:return b=gi(12,B,M,se|2),b.elementType=ae,b.lanes=ge,b;case Me:return b=gi(13,B,M,se),b.elementType=Me,b.lanes=ge,b;case Ke:return b=gi(19,B,M,se),b.elementType=Ke,b.lanes=ge,b;case $e:return Pr(B,se,ge,M);default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case ce:Ue=10;break e;case ye:Ue=9;break e;case Ce:Ue=11;break e;case ke:Ue=14;break e;case je:Ue=16,Z=null;break e}throw Error(n(130,b==null?b:typeof b,""))}return M=gi(Ue,B,M,se),M.elementType=b,M.type=Z,M.lanes=ge,M}function Ei(b,M,B,Z){return b=gi(7,b,Z,M),b.lanes=B,b}function Pr(b,M,B,Z){return b=gi(22,b,Z,M),b.elementType=$e,b.lanes=B,b.stateNode={isHidden:!1},b}function Si(b,M,B){return b=gi(6,b,null,M),b.lanes=B,b}function xs(b,M,B){return M=gi(4,b.children!==null?b.children:[],b.key,M),M.lanes=B,M.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},M}function qs(b,M,B,Z,se){this.tag=M,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ds(0),this.expirationTimes=ds(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ds(0),this.identifierPrefix=Z,this.onRecoverableError=se,this.mutableSourceEagerHydrationData=null}function ws(b,M,B,Z,se,ge,Ue,xt,Ft){return b=new qs(b,M,B,xt,Ft),M===1?(M=1,ge===!0&&(M|=8)):M=0,ge=gi(3,null,null,M),b.current=ge,ge.stateNode=b,ge.memoizedState={element:Z,isDehydrated:B,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bf(ge),b}function Os(b,M,B){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:te,key:Z==null?null:""+Z,children:b,containerInfo:M,implementation:B}}function Aa(b){if(!b)return Sc;b=b._reactInternals;e:{if(tt(b)!==b||b.tag!==1)throw Error(n(170));var M=b;do{switch(M.tag){case 3:M=M.stateNode.context;break e;case 1:if(ta(M.type)){M=M.stateNode.__reactInternalMemoizedMergedChildContext;break e}}M=M.return}while(M!==null);throw Error(n(171))}if(b.tag===1){var B=b.type;if(ta(B))return dl(b,B,M)}return M}function ga(b,M,B,Z,se,ge,Ue,xt,Ft){return b=ws(B,Z,!0,b,se,ge,Ue,xt,Ft),b.context=Aa(null),B=b.current,Z=Ne(),se=Xe(B),ge=Ha(Z,se),ge.callback=M??null,Nl(B,ge,se),b.current.lanes=se,Is(b,se,Z),De(b,Z),b}function To(b,M,B,Z){var se=M.current,ge=Ne(),Ue=Xe(se);return B=Aa(B),M.context===null?M.context=B:M.pendingContext=B,M=Ha(ge,Ue),M.payload={element:b},Z=Z===void 0?null:Z,Z!==null&&(M.callback=Z),b=Nl(se,M,Ue),b!==null&&(ze(b,se,Ue,ge),Fn(b,se,Ue)),Ue}function jo(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 5:return b.child.stateNode;default:return b.child.stateNode}}function gl(b,M){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var B=b.retryLane;b.retryLane=B!==0&&B<M?B:M}}function Do(b,M){gl(b,M),(b=b.alternate)&&gl(b,M)}function Fl(){return null}var Bl=typeof reportError=="function"?reportError:function(b){console.error(b)};function _o(b){this._internalRoot=b}Ss.prototype.render=_o.prototype.render=function(b){var M=this._internalRoot;if(M===null)throw Error(n(409));To(b,M,null,null)},Ss.prototype.unmount=_o.prototype.unmount=function(){var b=this._internalRoot;if(b!==null){this._internalRoot=null;var M=b.containerInfo;mt(function(){To(null,b,null,null)}),M[bc]=null}};function Ss(b){this._internalRoot=b}Ss.prototype.unstable_scheduleHydration=function(b){if(b){var M=ua();b={blockedOn:null,target:b,priority:M};for(var B=0;B<Cu.length&&M!==0&&M<Cu[B].priority;B++);Cu.splice(B,0,b),B===0&&fg(b)}};function Fs(b){return!(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11)}function Ji(b){return!(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11&&(b.nodeType!==8||b.nodeValue!==" react-mount-point-unstable "))}function Xs(){}function Lo(b,M,B,Z,se){if(se){if(typeof Z=="function"){var ge=Z;Z=function(){var Tn=jo(Ue);ge.call(Tn)}}var Ue=ga(M,Z,b,0,null,!1,!1,"",Xs);return b._reactRootContainer=Ue,b[bc]=Ue.current,Hp(b.nodeType===8?b.parentNode:b),mt(),Ue}for(;se=b.lastChild;)b.removeChild(se);if(typeof Z=="function"){var xt=Z;Z=function(){var Tn=jo(Ft);xt.call(Tn)}}var Ft=ws(b,0,!1,null,null,!1,!1,"",Xs);return b._reactRootContainer=Ft,b[bc]=Ft.current,Hp(b.nodeType===8?b.parentNode:b),mt(function(){To(M,Ft,B,Z)}),Ft}function Ts(b,M,B,Z,se){var ge=B._reactRootContainer;if(ge){var Ue=ge;if(typeof se=="function"){var xt=se;se=function(){var Ft=jo(Ue);xt.call(Ft)}}To(M,Ue,b,se)}else Ue=Lo(B,M,b,se,Z);return jo(Ue)}il=function(b){switch(b.tag){case 3:var M=b.stateNode;if(M.current.memoizedState.isDehydrated){var B=Qi(M.pendingLanes);B!==0&&(wo(M,B|1),De(M,wt()),(Ps&6)===0&&(q=wt()+500,Tc()))}break;case 13:mt(function(){var Z=Kl(b,1);if(Z!==null){var se=Ne();ze(Z,b,1,se)}}),Do(b,1)}},ca=function(b){if(b.tag===13){var M=Kl(b,134217728);if(M!==null){var B=Ne();ze(M,b,134217728,B)}Do(b,134217728)}},Gl=function(b){if(b.tag===13){var M=Xe(b),B=Kl(b,M);if(B!==null){var Z=Ne();ze(B,b,M,Z)}Do(b,M)}},ua=function(){return ji},sl=function(b,M){var B=ji;try{return ji=b,M()}finally{ji=B}},Gn=function(b,M,B){switch(M){case"input":if(Br(b,B),M=B.name,B.type==="radio"&&M!=null){for(B=b;B.parentNode;)B=B.parentNode;for(B=B.querySelectorAll("input[name="+JSON.stringify(""+M)+'][type="radio"]'),M=0;M<B.length;M++){var Z=B[M];if(Z!==b&&Z.form===b.form){var se=Ah(Z);if(!se)throw Error(n(90));Hr(Z),Br(Z,se)}}}break;case"textarea":Oe(b,B);break;case"select":M=B.value,M!=null&&Qn(b,!!B.multiple,M,!1)}},ni=hn,Yi=mt;var zl={usingClientEntryPoint:!1,Events:[kf,wc,Ah,ln,Tr,hn]},hu={findFiberByHostInstance:jd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$u={bundleType:hu.bundleType,version:hu.version,rendererPackageName:hu.rendererPackageName,rendererConfig:hu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:K.ReactCurrentDispatcher,findHostInstanceByFiber:function(b){return b=ct(b),b===null?null:b.stateNode},findFiberByHostInstance:hu.findFiberByHostInstance||Fl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wu.isDisabled&&Wu.supportsFiber)try{jr=Wu.inject($u),Er=Wu}catch{}}return fu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zl,fu.createPortal=function(b,M){var B=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fs(M))throw Error(n(200));return Os(b,M,null,B)},fu.createRoot=function(b,M){if(!Fs(b))throw Error(n(299));var B=!1,Z="",se=Bl;return M!=null&&(M.unstable_strictMode===!0&&(B=!0),M.identifierPrefix!==void 0&&(Z=M.identifierPrefix),M.onRecoverableError!==void 0&&(se=M.onRecoverableError)),M=ws(b,1,!1,null,null,B,!1,Z,se),b[bc]=M.current,Hp(b.nodeType===8?b.parentNode:b),new _o(M)},fu.findDOMNode=function(b){if(b==null)return null;if(b.nodeType===1)return b;var M=b._reactInternals;if(M===void 0)throw typeof b.render=="function"?Error(n(188)):(b=Object.keys(b).join(","),Error(n(268,b)));return b=ct(M),b=b===null?null:b.stateNode,b},fu.flushSync=function(b){return mt(b)},fu.hydrate=function(b,M,B){if(!Ji(M))throw Error(n(200));return Ts(null,b,M,!0,B)},fu.hydrateRoot=function(b,M,B){if(!Fs(b))throw Error(n(405));var Z=B!=null&&B.hydratedSources||null,se=!1,ge="",Ue=Bl;if(B!=null&&(B.unstable_strictMode===!0&&(se=!0),B.identifierPrefix!==void 0&&(ge=B.identifierPrefix),B.onRecoverableError!==void 0&&(Ue=B.onRecoverableError)),M=ga(M,null,b,1,B??null,se,!1,ge,Ue),b[bc]=M.current,Hp(b),Z)for(b=0;b<Z.length;b++)B=Z[b],se=B._getVersion,se=se(B._source),M.mutableSourceEagerHydrationData==null?M.mutableSourceEagerHydrationData=[B,se]:M.mutableSourceEagerHydrationData.push(B,se);return new Ss(M)},fu.render=function(b,M,B){if(!Ji(M))throw Error(n(200));return Ts(null,b,M,!1,B)},fu.unmountComponentAtNode=function(b){if(!Ji(b))throw Error(n(40));return b._reactRootContainer?(mt(function(){Ts(null,null,b,!1,function(){b._reactRootContainer=null,b[bc]=null})}),!0):!1},fu.unstable_batchedUpdates=hn,fu.unstable_renderSubtreeIntoContainer=function(b,M,B,Z){if(!Ji(B))throw Error(n(200));if(b==null||b._reactInternals===void 0)throw Error(n(38));return Ts(b,M,B,!1,Z)},fu.version="18.3.1-next-f1338f8080-20240426",fu}var WD;function V8(){if(WD)return vC.exports;WD=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),vC.exports=AK(),vC.exports}var qD;function CK(){if(qD)return MS;qD=1;var t=V8();return MS.createRoot=t.createRoot,MS.hydrateRoot=t.hydrateRoot,MS}var MK=CK();const kK=Wx(MK),sE=[{inputs:[{components:[{name:"target",type:"address"},{name:"allowFailure",type:"bool"},{name:"callData",type:"bytes"}],name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{name:"success",type:"bool"},{name:"returnData",type:"bytes"}],name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],A5=[{name:"query",type:"function",stateMutability:"view",inputs:[{type:"tuple[]",name:"queries",components:[{type:"address",name:"sender"},{type:"string[]",name:"urls"},{type:"bytes",name:"data"}]}],outputs:[{type:"bool[]",name:"failures"},{type:"bytes[]",name:"responses"}]},{name:"HttpError",type:"error",inputs:[{type:"uint16",name:"status"},{type:"string",name:"message"}]}],H8=[{inputs:[{name:"dns",type:"bytes"}],name:"DNSDecodingFailed",type:"error"},{inputs:[{name:"ens",type:"string"}],name:"DNSEncodingFailed",type:"error"},{inputs:[],name:"EmptyAddress",type:"error"},{inputs:[{name:"status",type:"uint16"},{name:"message",type:"string"}],name:"HttpError",type:"error"},{inputs:[],name:"InvalidBatchGatewayResponse",type:"error"},{inputs:[{name:"errorData",type:"bytes"}],name:"ResolverError",type:"error"},{inputs:[{name:"name",type:"bytes"},{name:"resolver",type:"address"}],name:"ResolverNotContract",type:"error"},{inputs:[{name:"name",type:"bytes"}],name:"ResolverNotFound",type:"error"},{inputs:[{name:"primary",type:"string"},{name:"primaryAddress",type:"bytes"}],name:"ReverseAddressMismatch",type:"error"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"UnsupportedResolverProfile",type:"error"}],G8=[...H8,{name:"resolveWithGateways",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes"},{name:"data",type:"bytes"},{name:"gateways",type:"string[]"}],outputs:[{name:"",type:"bytes"},{name:"address",type:"address"}]}],IK=[...H8,{name:"reverseWithGateways",type:"function",stateMutability:"view",inputs:[{type:"bytes",name:"reverseName"},{type:"uint256",name:"coinType"},{type:"string[]",name:"gateways"}],outputs:[{type:"string",name:"resolvedName"},{type:"address",name:"resolver"},{type:"address",name:"reverseResolver"}]}],XD=[{name:"text",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"key",type:"string"}],outputs:[{name:"",type:"string"}]}],ZD=[{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"}],outputs:[{name:"",type:"address"}]},{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"coinType",type:"uint256"}],outputs:[{name:"",type:"bytes"}]}],$8=[{name:"isValidSignature",type:"function",stateMutability:"view",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}]}],QD=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];function df(t,{includeName:e=!1}={}){if(t.type!=="function"&&t.type!=="event"&&t.type!=="error")throw new HK(t.type);return`${t.name}(${qE(t.inputs,{includeName:e})})`}function qE(t,{includeName:e=!1}={}){return t?t.map(n=>PK(n,{includeName:e})).join(e?", ":","):""}function PK(t,{includeName:e}){return t.type.startsWith("tuple")?`(${qE(t.components,{includeName:e})})${t.type.slice(5)}`:t.type+(e&&t.name?` ${t.name}`:"")}function hf(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Yo(t){return hf(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const W8="2.40.3";let v1={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${W8}`},Wn=class C5 extends Error{constructor(e,n={}){var r;const s=(()=>{var v;return n.cause instanceof C5?n.cause.details:(v=n.cause)!=null&&v.message?n.cause.message:n.details})(),l=n.cause instanceof C5&&n.cause.docsPath||n.docsPath,u=(r=v1.getDocsUrl)==null?void 0:r.call(v1,{...n,docsPath:l}),p=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...u?[`Docs: ${u}`]:[],...s?[`Details: ${s}`]:[],...v1.version?[`Version: ${v1.version}`]:[]].join(`
`);super(p,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=l,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=W8}walk(e){return q8(this,e)}};function q8(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?q8(t.cause,e):e?null:t}class RK extends Wn{constructor({docsPath:e}){super(["A constructor was not found on the ABI.","Make sure you are using the correct ABI and that the constructor exists on it."].join(`
`),{docsPath:e,name:"AbiConstructorNotFoundError"})}}class KD extends Wn{constructor({docsPath:e}){super(["Constructor arguments were provided (`args`), but a constructor parameters (`inputs`) were not found on the ABI.","Make sure you are using the correct ABI, and that the `inputs` attribute on the constructor exists."].join(`
`),{docsPath:e,name:"AbiConstructorParamsNotFoundError"})}}class X8 extends Wn{constructor({data:e,params:n,size:s}){super([`Data size of ${s} bytes is too small for given parameters.`].join(`
`),{metaMessages:[`Params: (${qE(n,{includeName:!0})})`,`Data:   ${e} (${s} bytes)`],name:"AbiDecodingDataSizeTooSmallError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=e,this.params=n,this.size=s}}class Yw extends Wn{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.',{name:"AbiDecodingZeroDataError"})}}class NK extends Wn{constructor({expectedLength:e,givenLength:n,type:s}){super([`ABI encoding array length mismatch for type ${s}.`,`Expected length: ${e}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class jK extends Wn{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${Yo(n)}) does not match expected size (bytes${e}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class DK extends Wn{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${e}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class LK extends Wn{constructor(e,{docsPath:n}){super([`Arguments (\`args\`) were provided to "${e}", but "${e}" on the ABI does not contain any parameters (\`inputs\`).`,"Cannot encode error result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the inputs exist on it."].join(`
`),{docsPath:n,name:"AbiErrorInputsNotFoundError"})}}class YD extends Wn{constructor(e,{docsPath:n}={}){super([`Error ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it."].join(`
`),{docsPath:n,name:"AbiErrorNotFoundError"})}}class Z8 extends Wn{constructor(e,{docsPath:n}){super([`Encoded error signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${e}.`].join(`
`),{docsPath:n,name:"AbiErrorSignatureNotFoundError"}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.signature=e}}class OK extends Wn{constructor({docsPath:e}){super("Cannot extract event signature from empty topics.",{docsPath:e,name:"AbiEventSignatureEmptyTopicsError"})}}class Q8 extends Wn{constructor(e,{docsPath:n}){super([`Encoded event signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it.",`You can look up the signature here: https://openchain.xyz/signatures?query=${e}.`].join(`
`),{docsPath:n,name:"AbiEventSignatureNotFoundError"})}}class JD extends Wn{constructor(e,{docsPath:n}={}){super([`Event ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it."].join(`
`),{docsPath:n,name:"AbiEventNotFoundError"})}}class $v extends Wn{constructor(e,{docsPath:n}={}){super([`Function ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class K8 extends Wn{constructor(e,{docsPath:n}){super([`Function "${e}" does not contain any \`outputs\` on ABI.`,"Cannot decode function result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionOutputsNotFoundError"})}}class FK extends Wn{constructor(e,{docsPath:n}){super([`Encoded function signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it.",`You can look up the signature here: https://openchain.xyz/signatures?query=${e}.`].join(`
`),{docsPath:n,name:"AbiFunctionSignatureNotFoundError"})}}class BK extends Wn{constructor(e,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${e.type}\` in \`${df(e.abiItem)}\`, and`,`\`${n.type}\` in \`${df(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}let zK=class extends Wn{constructor({expectedSize:e,givenSize:n}){super(`Expected bytes${e}, got bytes${n}.`,{name:"BytesSizeMismatchError"})}};class Y1 extends Wn{constructor({abiItem:e,data:n,params:s,size:l}){super([`Data size of ${l} bytes is too small for non-indexed event parameters.`].join(`
`),{metaMessages:[`Params: (${qE(s,{includeName:!0})})`,`Data:   ${n} (${l} bytes)`],name:"DecodeLogDataMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=e,this.data=n,this.params=s,this.size=l}}class XE extends Wn{constructor({abiItem:e,param:n}){super([`Expected a topic for indexed event parameter${n.name?` "${n.name}"`:""} on event "${df(e,{includeName:!0})}".`].join(`
`),{name:"DecodeLogTopicsMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=e}}class UK extends Wn{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class VK extends Wn{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid decoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiDecodingType"})}}let Y8=class extends Wn{constructor(e){super([`Value "${e}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}};class HK extends Wn{constructor(e){super([`"${e}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}class e3e extends Wn{constructor(e){super(`Type "${e}" is not supported for packed encoding.`,{name:"UnsupportedPackedAbiType"})}}let Wc=class extends Wn{constructor({address:e}){super(`Address "${e}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}},J8=class extends Wn{constructor({offset:e,position:n,size:s}){super(`Slice ${n==="start"?"starting":"ending"} at offset "${e}" is out-of-bounds (size: ${s}).`,{name:"SliceOffsetOutOfBoundsError"})}},eU=class extends Wn{constructor({size:e,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}};class eL extends Wn{constructor({size:e,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} is expected to be ${n} ${s} long, but is ${e} ${s} long.`,{name:"InvalidBytesLengthError"})}}function ub(t,{dir:e,size:n=32}={}){return typeof t=="string"?D0(t,{dir:e,size:n}):GK(t,{dir:e,size:n})}function D0(t,{dir:e,size:n=32}={}){if(n===null)return t;const s=t.replace("0x","");if(s.length>n*2)throw new eU({size:Math.ceil(s.length/2),targetSize:n,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function GK(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new eU({size:t.length,targetSize:n,type:"bytes"});const s=new Uint8Array(n);for(let l=0;l<n;l++){const u=e==="right";s[u?l:n-l-1]=t[u?l:t.length-l-1]}return s}let tU=class extends Wn{constructor({max:e,min:n,signed:s,size:l,value:u}){super(`Number "${u}" is not in safe ${l?`${l*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}},$K=class extends Wn{constructor(e){super(`Bytes value "${e}" is not a valid boolean. The bytes array must contain a single byte of either a 0 or 1 value.`,{name:"InvalidBytesBooleanError"})}};class WK extends Wn{constructor(e){super(`Hex value "${e}" is not a valid boolean. The hex value must be "0x0" (false) or "0x1" (true).`,{name:"InvalidHexBooleanError"})}}let qK=class extends Wn{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function vu(t,{dir:e="left"}={}){let n=typeof t=="string"?t.replace("0x",""):t,s=0;for(let l=0;l<n.length-1&&n[e==="left"?l:n.length-l-1].toString()==="0";l++)s++;return n=e==="left"?n.slice(s):n.slice(0,n.length-s),typeof t=="string"?(n.length===1&&e==="right"&&(n=`${n}0`),`0x${n.length%2===1?`0${n}`:n}`):n}function lh(t,{size:e}){if(Yo(t)>e)throw new qK({givenSize:Yo(t),maxSize:e})}function dd(t,e={}){const{signed:n}=e;e.size&&lh(t,{size:e.size});const s=BigInt(t);if(!n)return s;const l=(t.length-2)/2,u=(1n<<BigInt(l)*8n-1n)-1n;return s<=u?s:s-BigInt(`0x${"f".padStart(l*2,"f")}`)-1n}function XK(t,e={}){let n=t;if(e.size&&(lh(n,{size:e.size}),n=vu(n)),vu(n)==="0x00")return!1;if(vu(n)==="0x01")return!0;throw new WK(n)}function hd(t,e={}){return Number(dd(t,e))}function ZK(t,e={}){let n=sh(t);return e.size&&(lh(n,{size:e.size}),n=vu(n,{dir:"right"})),new TextDecoder().decode(n)}const QK=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ih(t,e={}){return typeof t=="number"||typeof t=="bigint"?lr(t,e):typeof t=="string"?Wv(t,e):typeof t=="boolean"?nU(t,e):La(t,e)}function nU(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(lh(n,{size:e.size}),ub(n,{size:e.size})):n}function La(t,e={}){let n="";for(let l=0;l<t.length;l++)n+=QK[t[l]];const s=`0x${n}`;return typeof e.size=="number"?(lh(s,{size:e.size}),ub(s,{dir:"right",size:e.size})):s}function lr(t,e={}){const{signed:n,size:s}=e,l=BigInt(t);let u;s?n?u=(1n<<BigInt(s)*8n-1n)-1n:u=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(u=BigInt(Number.MAX_SAFE_INTEGER));const p=typeof u=="bigint"&&n?-u-1n:0;if(u&&l>u||l<p){const v=typeof t=="bigint"?"n":"";throw new tU({max:u?`${u}${v}`:void 0,min:`${p}${v}`,signed:n,size:s,value:`${t}${v}`})}const r=`0x${(n&&l<0?(1n<<BigInt(s*8))+BigInt(l):l).toString(16)}`;return s?ub(r,{size:s}):r}const KK=new TextEncoder;function Wv(t,e={}){const n=KK.encode(t);return La(n,e)}const YK=new TextEncoder;function db(t,e={}){return typeof t=="number"||typeof t=="bigint"?eY(t,e):typeof t=="boolean"?JK(t,e):hf(t)?sh(t,e):_x(t,e)}function JK(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(lh(n,{size:e.size}),ub(n,{size:e.size})):n}const bm={zero:48,nine:57,A:65,F:70,a:97,f:102};function tL(t){if(t>=bm.zero&&t<=bm.nine)return t-bm.zero;if(t>=bm.A&&t<=bm.F)return t-(bm.A-10);if(t>=bm.a&&t<=bm.f)return t-(bm.a-10)}function sh(t,e={}){let n=t;e.size&&(lh(n,{size:e.size}),n=ub(n,{dir:"right",size:e.size}));let s=n.slice(2);s.length%2&&(s=`0${s}`);const l=s.length/2,u=new Uint8Array(l);for(let p=0,r=0;p<l;p++){const v=tL(s.charCodeAt(r++)),w=tL(s.charCodeAt(r++));if(v===void 0||w===void 0)throw new Wn(`Invalid byte sequence ("${s[r-2]}${s[r-1]}" in "${s}").`);u[p]=v*16+w}return u}function eY(t,e){const n=lr(t,e);return sh(n)}function _x(t,e={}){const n=YK.encode(t);return typeof e.size=="number"?(lh(n,{size:e.size}),ub(n,{dir:"right",size:e.size})):n}const kS=BigInt(2**32-1),nL=BigInt(32);function tY(t,e=!1){return e?{h:Number(t&kS),l:Number(t>>nL&kS)}:{h:Number(t>>nL&kS)|0,l:Number(t&kS)|0}}function rU(t,e=!1){const n=t.length;let s=new Uint32Array(n),l=new Uint32Array(n);for(let u=0;u<n;u++){const{h:p,l:r}=tY(t[u],e);[s[u],l[u]]=[p,r]}return[s,l]}const rL=(t,e,n)=>t>>>n,iL=(t,e,n)=>t<<32-n|e>>>n,O_=(t,e,n)=>t>>>n|e<<32-n,F_=(t,e,n)=>t<<32-n|e>>>n,IS=(t,e,n)=>t<<64-n|e>>>n-32,PS=(t,e,n)=>t>>>n-32|e<<64-n,nY=(t,e,n)=>t<<n|e>>>32-n,rY=(t,e,n)=>e<<n|t>>>32-n,iY=(t,e,n)=>e<<n-32|t>>>64-n,sY=(t,e,n)=>t<<n-32|e>>>64-n;function wm(t,e,n,s){const l=(e>>>0)+(s>>>0);return{h:t+n+(l/2**32|0)|0,l:l|0}}const oY=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),aY=(t,e,n,s)=>e+n+s+(t/2**32|0)|0,lY=(t,e,n,s)=>(t>>>0)+(e>>>0)+(n>>>0)+(s>>>0),cY=(t,e,n,s,l)=>e+n+s+l+(t/2**32|0)|0,uY=(t,e,n,s,l)=>(t>>>0)+(e>>>0)+(n>>>0)+(s>>>0)+(l>>>0),dY=(t,e,n,s,l,u)=>e+n+s+l+u+(t/2**32|0)|0,B_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hY(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function J1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Mx(t,...e){if(!hY(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function fY(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");J1(t.outputLen),J1(t.blockLen)}function qv(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function iU(t,e){Mx(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function pY(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function z0(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function SC(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ap(t,e){return t<<32-e|t>>>e}const mY=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function gY(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function yY(t){for(let e=0;e<t.length;e++)t[e]=gY(t[e]);return t}const sL=mY?t=>t:yY;function xY(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ZE(t){return typeof t=="string"&&(t=xY(t)),Mx(t),t}function _Y(...t){let e=0;for(let s=0;s<t.length;s++){const l=t[s];Mx(l),e+=l.length}const n=new Uint8Array(e);for(let s=0,l=0;s<t.length;s++){const u=t[s];n.set(u,l),l+=u.length}return n}class dP{}function QE(t){const e=s=>t().update(ZE(s)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function vY(t=32){if(B_&&typeof B_.getRandomValues=="function")return B_.getRandomValues(new Uint8Array(t));if(B_&&typeof B_.randomBytes=="function")return Uint8Array.from(B_.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const bY=BigInt(0),b1=BigInt(1),wY=BigInt(2),SY=BigInt(7),TY=BigInt(256),EY=BigInt(113),sU=[],oU=[],aU=[];for(let t=0,e=b1,n=1,s=0;t<24;t++){[n,s]=[s,(2*n+3*s)%5],sU.push(2*(5*s+n)),oU.push((t+1)*(t+2)/2%64);let l=bY;for(let u=0;u<7;u++)e=(e<<b1^(e>>SY)*EY)%TY,e&wY&&(l^=b1<<(b1<<BigInt(u))-b1);aU.push(l)}const lU=rU(aU,!0),AY=lU[0],CY=lU[1],oL=(t,e,n)=>n>32?iY(t,e,n):nY(t,e,n),aL=(t,e,n)=>n>32?sY(t,e,n):rY(t,e,n);function MY(t,e=24){const n=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let p=0;p<10;p++)n[p]=t[p]^t[p+10]^t[p+20]^t[p+30]^t[p+40];for(let p=0;p<10;p+=2){const r=(p+8)%10,v=(p+2)%10,w=n[v],E=n[v+1],T=oL(w,E,1)^n[r],k=aL(w,E,1)^n[r+1];for(let R=0;R<50;R+=10)t[p+R]^=T,t[p+R+1]^=k}let l=t[2],u=t[3];for(let p=0;p<24;p++){const r=oU[p],v=oL(l,u,r),w=aL(l,u,r),E=sU[p];l=t[E],u=t[E+1],t[E]=v,t[E+1]=w}for(let p=0;p<50;p+=10){for(let r=0;r<10;r++)n[r]=t[p+r];for(let r=0;r<10;r++)t[p+r]^=~n[(r+2)%10]&n[(r+4)%10]}t[0]^=AY[s],t[1]^=CY[s]}z0(n)}class hP extends dP{constructor(e,n,s,l=!1,u=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=s,this.enableXOF=l,this.rounds=u,J1(s),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=pY(this.state)}clone(){return this._cloneInto()}keccak(){sL(this.state32),MY(this.state32,this.rounds),sL(this.state32),this.posOut=0,this.pos=0}update(e){qv(this),e=ZE(e),Mx(e);const{blockLen:n,state:s}=this,l=e.length;for(let u=0;u<l;){const p=Math.min(n-this.pos,l-u);for(let r=0;r<p;r++)s[this.pos++]^=e[u++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:s,blockLen:l}=this;e[s]^=n,(n&128)!==0&&s===l-1&&this.keccak(),e[l-1]^=128,this.keccak()}writeInto(e){qv(this,!1),Mx(e),this.finish();const n=this.state,{blockLen:s}=this;for(let l=0,u=e.length;l<u;){this.posOut>=s&&this.keccak();const p=Math.min(s-this.posOut,u-l);e.set(n.subarray(this.posOut,this.posOut+p),l),this.posOut+=p,l+=p}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return J1(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(iU(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,z0(this.state)}_cloneInto(e){const{blockLen:n,suffix:s,outputLen:l,rounds:u,enableXOF:p}=this;return e||(e=new hP(n,s,l,p,u)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=u,e.suffix=s,e.outputLen=l,e.enableXOF=p,e.destroyed=this.destroyed,e}}const kY=(t,e,n)=>QE(()=>new hP(e,t,n)),cU=kY(1,136,256/8);function bl(t,e){const n=e||"hex",s=cU(hf(t,{strict:!1})?db(t):t);return n==="bytes"?s:ih(s)}let hb=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}};const IY=/^0x[a-fA-F0-9]{40}$/,TC=new hb(8192);function Oa(t,e){const{strict:n=!0}=e??{},s=`${t}.${n}`;if(TC.has(s))return TC.get(s);const l=IY.test(t)?t.toLowerCase()===t?!0:n?Jw(t)===t:!0:!1;return TC.set(s,l),l}const EC=new hb(8192);function Jw(t,e){if(EC.has(`${t}.${e}`))return EC.get(`${t}.${e}`);const n=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),s=bl(_x(n),"bytes"),l=(e?n.substring(`${e}0x`.length):n).split("");for(let p=0;p<40;p+=2)s[p>>1]>>4>=8&&l[p]&&(l[p]=l[p].toUpperCase()),(s[p>>1]&15)>=8&&l[p+1]&&(l[p+1]=l[p+1].toUpperCase());const u=`0x${l.join("")}`;return EC.set(`${t}.${e}`,u),u}function wl(t,e){if(!Oa(t,{strict:!1}))throw new Wc({address:t});return Jw(t,e)}let lL=class extends Wn{constructor({offset:e}){super(`Offset \`${e}\` cannot be negative.`,{name:"NegativeOffsetError"})}},uU=class extends Wn{constructor({length:e,position:n}){super(`Position \`${n}\` is out of bounds (\`0 < position < ${e}\`).`,{name:"PositionOutOfBoundsError"})}},PY=class extends Wn{constructor({count:e,limit:n}){super(`Recursive read limit of \`${n}\` exceeded (recursive read count: \`${e}\`).`,{name:"RecursiveReadLimitExceededError"})}};const RY={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new PY({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new uU({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new lL({offset:t});const e=this.position-t;this.assertPosition(e),this.position=e},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new lL({offset:t});const e=this.position+t;this.assertPosition(e),this.position=e},inspectByte(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectBytes(t,e){const n=e??this.position;return this.assertPosition(n+t-1),this.bytes.subarray(n,n+t)},inspectUint8(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectUint16(t){const e=t??this.position;return this.assertPosition(e+1),this.dataView.getUint16(e)},inspectUint24(t){const e=t??this.position;return this.assertPosition(e+2),(this.dataView.getUint16(e)<<8)+this.dataView.getUint8(e+2)},inspectUint32(t){const e=t??this.position;return this.assertPosition(e+3),this.dataView.getUint32(e)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,t&255),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,e){this.assertReadLimit(),this._touch();const n=this.inspectBytes(t);return this.position+=e??t,n},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const e=this.position;return this.assertPosition(t),this.position=t,()=>this.position=e},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function fP(t,{recursiveReadLimit:e=8192}={}){const n=Object.create(RY);return n.bytes=t,n.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),n.positionReadCount=new Map,n.recursiveReadLimit=e,n}function kx(t,e,n,{strict:s}={}){return hf(t,{strict:!1})?M5(t,e,n,{strict:s}):fU(t,e,n,{strict:s})}function dU(t,e){if(typeof e=="number"&&e>0&&e>Yo(t)-1)throw new J8({offset:e,position:"start",size:Yo(t)})}function hU(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Yo(t)!==n-e)throw new J8({offset:n,position:"end",size:Yo(t)})}function fU(t,e,n,{strict:s}={}){dU(t,e);const l=t.slice(e,n);return s&&hU(l,e,n),l}function M5(t,e,n,{strict:s}={}){dU(t,e);const l=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return s&&hU(l,e,n),l}function NY(t,e={}){typeof e.size<"u"&&lh(t,{size:e.size});const n=La(t,e);return dd(n,e)}function jY(t,e={}){let n=t;if(typeof e.size<"u"&&(lh(n,{size:e.size}),n=vu(n)),n.length>1||n[0]>1)throw new $K(n);return!!n[0]}function Gm(t,e={}){typeof e.size<"u"&&lh(t,{size:e.size});const n=La(t,e);return hd(n,e)}function DY(t,e={}){let n=t;return typeof e.size<"u"&&(lh(n,{size:e.size}),n=vu(n,{dir:"right"})),new TextDecoder().decode(n)}function oh(t){return typeof t[0]=="string"?Tp(t):LY(t)}function LY(t){let e=0;for(const l of t)e+=l.length;const n=new Uint8Array(e);let s=0;for(const l of t)n.set(l,s),s+=l.length;return n}function Tp(t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}const d3e=/^(.*)\[([0-9]*)\]$/,OY=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,pU=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function qx(t,e){if(t.length!==e.length)throw new DK({expectedLength:t.length,givenLength:e.length});const n=FY({params:t,values:e}),s=mP(n);return s.length===0?"0x":s}function FY({params:t,values:e}){const n=[];for(let s=0;s<t.length;s++)n.push(pP({param:t[s],value:e[s]}));return n}function pP({param:t,value:e}){const n=gP(t.type);if(n){const[s,l]=n;return zY(e,{length:s,param:{...t,type:l}})}if(t.type==="tuple")return $Y(e,{param:t});if(t.type==="address")return BY(e);if(t.type==="bool")return VY(e);if(t.type.startsWith("uint")||t.type.startsWith("int")){const s=t.type.startsWith("int"),[,,l="256"]=pU.exec(t.type)??[];return HY(e,{signed:s,size:Number(l)})}if(t.type.startsWith("bytes"))return UY(e,{param:t});if(t.type==="string")return GY(e);throw new UK(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function mP(t){let e=0;for(let u=0;u<t.length;u++){const{dynamic:p,encoded:r}=t[u];p?e+=32:e+=Yo(r)}const n=[],s=[];let l=0;for(let u=0;u<t.length;u++){const{dynamic:p,encoded:r}=t[u];p?(n.push(lr(e+l,{size:32})),s.push(r),l+=Yo(r)):n.push(r)}return oh([...n,...s])}function BY(t){if(!Oa(t))throw new Wc({address:t});return{dynamic:!1,encoded:D0(t.toLowerCase())}}function zY(t,{length:e,param:n}){const s=e===null;if(!Array.isArray(t))throw new Y8(t);if(!s&&t.length!==e)throw new NK({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let l=!1;const u=[];for(let p=0;p<t.length;p++){const r=pP({param:n,value:t[p]});r.dynamic&&(l=!0),u.push(r)}if(s||l){const p=mP(u);if(s){const r=lr(u.length,{size:32});return{dynamic:!0,encoded:u.length>0?oh([r,p]):r}}if(l)return{dynamic:!0,encoded:p}}return{dynamic:!1,encoded:oh(u.map(({encoded:p})=>p))}}function UY(t,{param:e}){const[,n]=e.type.split("bytes"),s=Yo(t);if(!n){let l=t;return s%32!==0&&(l=D0(l,{dir:"right",size:Math.ceil((t.length-2)/2/32)*32})),{dynamic:!0,encoded:oh([D0(lr(s,{size:32})),l])}}if(s!==Number.parseInt(n,10))throw new jK({expectedSize:Number.parseInt(n,10),value:t});return{dynamic:!1,encoded:D0(t,{dir:"right"})}}function VY(t){if(typeof t!="boolean")throw new Wn(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:D0(nU(t))}}function HY(t,{signed:e,size:n=256}){if(typeof n=="number"){const s=2n**(BigInt(n)-(e?1n:0n))-1n,l=e?-s-1n:0n;if(t>s||t<l)throw new tU({max:s.toString(),min:l.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:lr(t,{size:32,signed:e})}}function GY(t){const e=Wv(t),n=Math.ceil(Yo(e)/32),s=[];for(let l=0;l<n;l++)s.push(D0(kx(e,l*32,(l+1)*32),{dir:"right"}));return{dynamic:!0,encoded:oh([D0(lr(Yo(e),{size:32})),...s])}}function $Y(t,{param:e}){let n=!1;const s=[];for(let l=0;l<e.components.length;l++){const u=e.components[l],p=Array.isArray(t)?l:u.name,r=pP({param:u,value:t[p]});s.push(r),r.dynamic&&(n=!0)}return{dynamic:n,encoded:n?mP(s):oh(s.map(({encoded:l})=>l))}}function gP(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}function e2(t,e){const n=typeof e=="string"?sh(e):e,s=fP(n);if(Yo(n)===0&&t.length>0)throw new Yw;if(Yo(e)&&Yo(e)<32)throw new X8({data:typeof e=="string"?e:La(e),params:t,size:Yo(e)});let l=0;const u=[];for(let p=0;p<t.length;++p){const r=t[p];s.setPosition(l);const[v,w]=Sv(s,r,{staticPosition:0});l+=w,u.push(v)}return u}function Sv(t,e,{staticPosition:n}){const s=gP(e.type);if(s){const[l,u]=s;return qY(t,{...e,type:u},{length:l,staticPosition:n})}if(e.type==="tuple")return KY(t,e,{staticPosition:n});if(e.type==="address")return WY(t);if(e.type==="bool")return XY(t);if(e.type.startsWith("bytes"))return ZY(t,e,{staticPosition:n});if(e.type.startsWith("uint")||e.type.startsWith("int"))return QY(t,e);if(e.type==="string")return YY(t,{staticPosition:n});throw new VK(e.type,{docsPath:"/docs/contract/decodeAbiParameters"})}const cL=32,k5=32;function WY(t){const e=t.readBytes(32);return[Jw(La(fU(e,-20))),32]}function qY(t,e,{length:n,staticPosition:s}){if(!n){const p=Gm(t.readBytes(k5)),r=s+p,v=r+cL;t.setPosition(r);const w=Gm(t.readBytes(cL)),E=ew(e);let T=0;const k=[];for(let R=0;R<w;++R){t.setPosition(v+(E?R*32:T));const[D,O]=Sv(t,e,{staticPosition:v});T+=O,k.push(D)}return t.setPosition(s+32),[k,32]}if(ew(e)){const p=Gm(t.readBytes(k5)),r=s+p,v=[];for(let w=0;w<n;++w){t.setPosition(r+w*32);const[E]=Sv(t,e,{staticPosition:r});v.push(E)}return t.setPosition(s+32),[v,32]}let l=0;const u=[];for(let p=0;p<n;++p){const[r,v]=Sv(t,e,{staticPosition:s+l});l+=v,u.push(r)}return[u,l]}function XY(t){return[jY(t.readBytes(32),{size:32}),32]}function ZY(t,e,{staticPosition:n}){const[s,l]=e.type.split("bytes");if(!l){const p=Gm(t.readBytes(32));t.setPosition(n+p);const r=Gm(t.readBytes(32));if(r===0)return t.setPosition(n+32),["0x",32];const v=t.readBytes(r);return t.setPosition(n+32),[La(v),32]}return[La(t.readBytes(Number.parseInt(l,10),32)),32]}function QY(t,e){const n=e.type.startsWith("int"),s=Number.parseInt(e.type.split("int")[1]||"256",10),l=t.readBytes(32);return[s>48?NY(l,{signed:n}):Gm(l,{signed:n}),32]}function KY(t,e,{staticPosition:n}){const s=e.components.length===0||e.components.some(({name:p})=>!p),l=s?[]:{};let u=0;if(ew(e)){const p=Gm(t.readBytes(k5)),r=n+p;for(let v=0;v<e.components.length;++v){const w=e.components[v];t.setPosition(r+u);const[E,T]=Sv(t,w,{staticPosition:r});u+=T,l[s?v:w==null?void 0:w.name]=E}return t.setPosition(n+32),[l,32]}for(let p=0;p<e.components.length;++p){const r=e.components[p],[v,w]=Sv(t,r,{staticPosition:n});l[s?p:r==null?void 0:r.name]=v,u+=w}return[l,u]}function YY(t,{staticPosition:e}){const n=Gm(t.readBytes(32)),s=e+n;t.setPosition(s);const l=Gm(t.readBytes(32));if(l===0)return t.setPosition(e+32),["",32];const u=t.readBytes(l,32),p=DY(vu(u));return t.setPosition(e+32),[p,32]}function ew(t){var s;const{type:e}=t;if(e==="string"||e==="bytes"||e.endsWith("[]"))return!0;if(e==="tuple")return(s=t.components)==null?void 0:s.some(ew);const n=gP(t.type);return!!(n&&ew({...t,type:n[1]}))}const JY=t=>bl(db(t));function eJ(t){return JY(t)}const tJ="1.1.0";let Eu=class I5 extends Error{constructor(e,n={}){var p;const s=n.cause instanceof I5?n.cause.details:(p=n.cause)!=null&&p.message?n.cause.message:n.details,l=n.cause instanceof I5&&n.cause.docsPath||n.docsPath,u=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...l?[`Docs: https://abitype.dev${l}`]:[],...s?[`Details: ${s}`]:[],`Version: abitype@${tJ}`].join(`
`);super(u),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiTypeError"}),n.cause&&(this.cause=n.cause),this.details=s,this.docsPath=l,this.metaMessages=n.metaMessages,this.shortMessage=e}};function cg(t,e){const n=t.exec(e);return n==null?void 0:n.groups}const mU=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,gU=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,yU=/^\(.+?\).*?$/,uL=/^tuple(?<array>(\[(\d*)\])*)$/;function P5(t){let e=t.type;if(uL.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let l=0;l<n;l++){const u=t.components[l];e+=P5(u),l<n-1&&(e+=", ")}const s=cg(uL,t.type);return e+=`)${(s==null?void 0:s.array)??""}`,P5({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function hv(t){let e="";const n=t.length;for(let s=0;s<n;s++){const l=t[s];e+=P5(l),s!==n-1&&(e+=", ")}return e}function oE(t){var e;return t.type==="function"?`function ${t.name}(${hv(t.inputs)})${t.stateMutability&&t.stateMutability!=="nonpayable"?` ${t.stateMutability}`:""}${(e=t.outputs)!=null&&e.length?` returns (${hv(t.outputs)})`:""}`:t.type==="event"?`event ${t.name}(${hv(t.inputs)})`:t.type==="error"?`error ${t.name}(${hv(t.inputs)})`:t.type==="constructor"?`constructor(${hv(t.inputs)})${t.stateMutability==="payable"?" payable":""}`:t.type==="fallback"?`fallback() external${t.stateMutability==="payable"?" payable":""}`:"receive() external payable"}const xU=/^error (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function nJ(t){return xU.test(t)}function rJ(t){return cg(xU,t)}const _U=/^event (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function iJ(t){return _U.test(t)}function sJ(t){return cg(_U,t)}const vU=/^function (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns\s?\((?<returns>.*?)\))?$/;function oJ(t){return vU.test(t)}function aJ(t){return cg(vU,t)}const bU=/^struct (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*) \{(?<properties>.*?)\}$/;function KE(t){return bU.test(t)}function lJ(t){return cg(bU,t)}const wU=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;function cJ(t){return wU.test(t)}function uJ(t){return cg(wU,t)}const SU=/^fallback\(\) external(?:\s(?<stateMutability>payable{1}))?$/;function dJ(t){return SU.test(t)}function hJ(t){return cg(SU,t)}const fJ=/^receive\(\) external payable$/;function pJ(t){return fJ.test(t)}const dL=new Set(["memory","indexed","storage","calldata"]),mJ=new Set(["indexed"]),R5=new Set(["calldata","memory","storage"]);class gJ extends Eu{constructor({signature:e}){super("Failed to parse ABI item.",{details:`parseAbiItem(${JSON.stringify(e,null,2)})`,docsPath:"/api/human#parseabiitem-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiItemError"})}}class yJ extends Eu{constructor({type:e}){super("Unknown type.",{metaMessages:[`Type "${e}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownTypeError"})}}class xJ extends Eu{constructor({type:e}){super("Unknown type.",{metaMessages:[`Type "${e}" is not a valid ABI type.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSolidityTypeError"})}}class _J extends Eu{constructor({params:e}){super("Failed to parse ABI parameters.",{details:`parseAbiParameters(${JSON.stringify(e,null,2)})`,docsPath:"/api/human#parseabiparameters-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiParametersError"})}}class vJ extends Eu{constructor({param:e}){super("Invalid ABI parameter.",{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParameterError"})}}class bJ extends Eu{constructor({param:e,name:n}){super("Invalid ABI parameter.",{details:e,metaMessages:[`"${n}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SolidityProtectedKeywordError"})}}class wJ extends Eu{constructor({param:e,type:n,modifier:s}){super("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s}" not allowed${n?` in "${n}" type`:""}.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidModifierError"})}}class SJ extends Eu{constructor({param:e,type:n,modifier:s}){super("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s}" not allowed${n?` in "${n}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${s}" was given.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidFunctionModifierError"})}}class TJ extends Eu{constructor({abiParameter:e}){super("Invalid ABI parameter.",{details:JSON.stringify(e,null,2),metaMessages:["ABI parameter type is invalid."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiTypeParameterError"})}}class fb extends Eu{constructor({signature:e,type:n}){super(`Invalid ${n} signature.`,{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidSignatureError"})}}class EJ extends Eu{constructor({signature:e}){super("Unknown signature.",{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSignatureError"})}}class AJ extends Eu{constructor({signature:e}){super("Invalid struct signature.",{details:e,metaMessages:["No properties exist."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidStructSignatureError"})}}class CJ extends Eu{constructor({type:e}){super("Circular reference detected.",{metaMessages:[`Struct "${e}" is a circular reference.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CircularReferenceError"})}}class MJ extends Eu{constructor({current:e,depth:n}){super("Unbalanced parentheses.",{metaMessages:[`"${e.trim()}" has too many ${n>0?"opening":"closing"} parentheses.`],details:`Depth "${n}"`}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParenthesisError"})}}function kJ(t,e,n){let s="";if(n)for(const l of Object.entries(n)){if(!l)continue;let u="";for(const p of l[1])u+=`[${p.type}${p.name?`:${p.name}`:""}]`;s+=`(${l[0]}{${u}})`}return e?`${e}:${t}${s}`:t}const AC=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]]);function N5(t,e={}){if(oJ(t))return IJ(t,e);if(iJ(t))return PJ(t,e);if(nJ(t))return RJ(t,e);if(cJ(t))return NJ(t,e);if(dJ(t))return jJ(t);if(pJ(t))return{type:"receive",stateMutability:"payable"};throw new EJ({signature:t})}function IJ(t,e={}){const n=aJ(t);if(!n)throw new fb({signature:t,type:"function"});const s=rd(n.parameters),l=[],u=s.length;for(let r=0;r<u;r++)l.push(eg(s[r],{modifiers:R5,structs:e,type:"function"}));const p=[];if(n.returns){const r=rd(n.returns),v=r.length;for(let w=0;w<v;w++)p.push(eg(r[w],{modifiers:R5,structs:e,type:"function"}))}return{name:n.name,type:"function",stateMutability:n.stateMutability??"nonpayable",inputs:l,outputs:p}}function PJ(t,e={}){const n=sJ(t);if(!n)throw new fb({signature:t,type:"event"});const s=rd(n.parameters),l=[],u=s.length;for(let p=0;p<u;p++)l.push(eg(s[p],{modifiers:mJ,structs:e,type:"event"}));return{name:n.name,type:"event",inputs:l}}function RJ(t,e={}){const n=rJ(t);if(!n)throw new fb({signature:t,type:"error"});const s=rd(n.parameters),l=[],u=s.length;for(let p=0;p<u;p++)l.push(eg(s[p],{structs:e,type:"error"}));return{name:n.name,type:"error",inputs:l}}function NJ(t,e={}){const n=uJ(t);if(!n)throw new fb({signature:t,type:"constructor"});const s=rd(n.parameters),l=[],u=s.length;for(let p=0;p<u;p++)l.push(eg(s[p],{structs:e,type:"constructor"}));return{type:"constructor",stateMutability:n.stateMutability??"nonpayable",inputs:l}}function jJ(t){const e=hJ(t);if(!e)throw new fb({signature:t,type:"fallback"});return{type:"fallback",stateMutability:e.stateMutability??"nonpayable"}}const DJ=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*(?:\spayable)?)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,LJ=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,OJ=/^u?int$/;function eg(t,e){var T,k;const n=kJ(t,e==null?void 0:e.type,e==null?void 0:e.structs);if(AC.has(n))return AC.get(n);const s=yU.test(t),l=cg(s?LJ:DJ,t);if(!l)throw new vJ({param:t});if(l.name&&BJ(l.name))throw new bJ({param:t,name:l.name});const u=l.name?{name:l.name}:{},p=l.modifier==="indexed"?{indexed:!0}:{},r=(e==null?void 0:e.structs)??{};let v,w={};if(s){v="tuple";const R=rd(l.type),D=[],O=R.length;for(let F=0;F<O;F++)D.push(eg(R[F],{structs:r}));w={components:D}}else if(l.type in r)v="tuple",w={components:r[l.type]};else if(OJ.test(l.type))v=`${l.type}256`;else if(l.type==="address payable")v="address";else if(v=l.type,(e==null?void 0:e.type)!=="struct"&&!TU(v))throw new xJ({type:v});if(l.modifier){if(!((k=(T=e==null?void 0:e.modifiers)==null?void 0:T.has)!=null&&k.call(T,l.modifier)))throw new wJ({param:t,type:e==null?void 0:e.type,modifier:l.modifier});if(R5.has(l.modifier)&&!zJ(v,!!l.array))throw new SJ({param:t,type:e==null?void 0:e.type,modifier:l.modifier})}const E={type:`${v}${l.array??""}`,...u,...p,...w};return AC.set(n,E),E}function rd(t,e=[],n="",s=0){const l=t.trim().length;for(let u=0;u<l;u++){const p=t[u],r=t.slice(u+1);switch(p){case",":return s===0?rd(r,[...e,n.trim()]):rd(r,e,`${n}${p}`,s);case"(":return rd(r,e,`${n}${p}`,s+1);case")":return rd(r,e,`${n}${p}`,s-1);default:return rd(r,e,`${n}${p}`,s)}}if(n==="")return e;if(s!==0)throw new MJ({current:n,depth:s});return e.push(n.trim()),e}function TU(t){return t==="address"||t==="bool"||t==="function"||t==="string"||mU.test(t)||gU.test(t)}const FJ=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/;function BJ(t){return t==="address"||t==="bool"||t==="function"||t==="string"||t==="tuple"||mU.test(t)||gU.test(t)||FJ.test(t)}function zJ(t,e){return e||t==="bytes"||t==="string"||t==="tuple"}function yP(t){const e={},n=t.length;for(let p=0;p<n;p++){const r=t[p];if(!KE(r))continue;const v=lJ(r);if(!v)throw new fb({signature:r,type:"struct"});const w=v.properties.split(";"),E=[],T=w.length;for(let k=0;k<T;k++){const D=w[k].trim();if(!D)continue;const O=eg(D,{type:"struct"});E.push(O)}if(!E.length)throw new AJ({signature:r});e[v.name]=E}const s={},l=Object.entries(e),u=l.length;for(let p=0;p<u;p++){const[r,v]=l[p];s[r]=EU(v,e)}return s}const UJ=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*)(?<array>(?:\[\d*?\])+?)?$/;function EU(t,e,n=new Set){const s=[],l=t.length;for(let u=0;u<l;u++){const p=t[u];if(yU.test(p.type))s.push(p);else{const v=cg(UJ,p.type);if(!(v!=null&&v.type))throw new TJ({abiParameter:p});const{array:w,type:E}=v;if(E in e){if(n.has(E))throw new CJ({type:E});s.push({...p,type:`tuple${w??""}`,components:EU(e[E]??[],e,new Set([...n,E]))})}else if(TU(E))s.push(p);else throw new yJ({type:E})}}return s}function AU(t){const e=yP(t),n=[],s=t.length;for(let l=0;l<s;l++){const u=t[l];KE(u)||n.push(N5(u,e))}return n}function hL(t){let e;if(typeof t=="string")e=N5(t);else{const n=yP(t),s=t.length;for(let l=0;l<s;l++){const u=t[l];if(!KE(u)){e=N5(u,n);break}}}if(!e)throw new gJ({signature:t});return e}function fL(t){const e=[];if(typeof t=="string"){const n=rd(t),s=n.length;for(let l=0;l<s;l++)e.push(eg(n[l],{modifiers:dL}))}else{const n=yP(t),s=t.length;for(let l=0;l<s;l++){const u=t[l];if(KE(u))continue;const p=rd(u),r=p.length;for(let v=0;v<r;v++)e.push(eg(p[v],{modifiers:dL,structs:n}))}}if(e.length===0)throw new _J({params:t});return e}function VJ(t){let e=!0,n="",s=0,l="",u=!1;for(let p=0;p<t.length;p++){const r=t[p];if(["(",")",","].includes(r)&&(e=!0),r==="("&&s++,r===")"&&s--,!!e){if(s===0){if(r===" "&&["event","function",""].includes(l))l="";else if(l+=r,r===")"){u=!0;break}continue}if(r===" "){t[p-1]!==","&&n!==","&&n!==",("&&(n="",e=!1);continue}l+=r,n+=r}}if(!u)throw new Wn("Unable to normalize signature.");return l}const HJ=t=>{const e=typeof t=="string"?t:oE(t);return VJ(e)};function CU(t){return eJ(HJ(t))}const YE=CU,t2=t=>kx(CU(t),0,4);function Xx(t){const{abi:e,args:n=[],name:s}=t,l=hf(s,{strict:!1}),u=e.filter(r=>l?r.type==="function"?t2(r)===s:r.type==="event"?YE(r)===s:!1:"name"in r&&r.name===s);if(u.length===0)return;if(u.length===1)return u[0];let p;for(const r of u){if(!("inputs"in r))continue;if(!n||n.length===0){if(!r.inputs||r.inputs.length===0)return r;continue}if(!r.inputs||r.inputs.length===0||r.inputs.length!==n.length)continue;if(n.every((w,E)=>{const T="inputs"in r&&r.inputs[E];return T?j5(w,T):!1})){if(p&&"inputs"in p&&p.inputs){const w=MU(r.inputs,p.inputs,n);if(w)throw new BK({abiItem:r,type:w[0]},{abiItem:p,type:w[1]})}p=r}}return p||u[0]}function j5(t,e){const n=typeof t,s=e.type;switch(s){case"address":return Oa(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in e?Object.values(e.components).every((l,u)=>j5(Object.values(t)[u],l)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(t)&&t.every(l=>j5(l,{...e,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function MU(t,e,n){for(const s in t){const l=t[s],u=e[s];if(l.type==="tuple"&&u.type==="tuple"&&"components"in l&&"components"in u)return MU(l.components,u.components,n[s]);const p=[l.type,u.type];if(p.includes("address")&&p.includes("bytes20")?!0:p.includes("address")&&p.includes("string")?Oa(n[s],{strict:!1}):p.includes("address")&&p.includes("bytes")?Oa(n[s],{strict:!1}):!1)return p}}const CC="/docs/contract/decodeFunctionResult";function Zx(t){const{abi:e,args:n,functionName:s,data:l}=t;let u=e[0];if(s){const r=Xx({abi:e,args:n,name:s});if(!r)throw new $v(s,{docsPath:CC});u=r}if(u.type!=="function")throw new $v(void 0,{docsPath:CC});if(!u.outputs)throw new K8(u.name,{docsPath:CC});const p=e2(u.outputs,l);if(p&&p.length>1)return p;if(p&&p.length===1)return p[0]}const pL="/docs/contract/encodeFunctionData";function GJ(t){const{abi:e,args:n,functionName:s}=t;let l=e[0];if(s){const u=Xx({abi:e,args:n,name:s});if(!u)throw new $v(s,{docsPath:pL});l=u}if(l.type!=="function")throw new $v(void 0,{docsPath:pL});return{abi:[l],functionName:t2(df(l))}}function gd(t){const{args:e}=t,{abi:n,functionName:s}=(()=>{var r;return t.abi.length===1&&((r=t.functionName)!=null&&r.startsWith("0x"))?t:GJ(t)})(),l=n[0],u=s,p="inputs"in l&&l.inputs?qx(l.inputs,e??[]):void 0;return Tp([u,p??"0x"])}class D5 extends Wn{constructor({blockNumber:e,chain:n,contract:s}){super(`Chain "${n.name}" does not support contract "${s.name}".`,{metaMessages:["This could be due to any of the following:",...e&&s.blockCreated&&s.blockCreated>e?[`- The contract "${s.name}" was not deployed until block ${s.blockCreated} (current block ${e}).`]:[`- The chain does not have the contract "${s.name}" configured.`]],name:"ChainDoesNotSupportContract"})}}class $J extends Wn{constructor({chain:e,currentChainId:n}){super(`The current chain of the wallet (id: ${n}) does not match the target chain for the transaction (id: ${e.id}  ${e.name}).`,{metaMessages:[`Current Chain ID:  ${n}`,`Expected Chain ID: ${e.id}  ${e.name}`],name:"ChainMismatchError"})}}class WJ extends Wn{constructor(){super(["No chain was provided to the request.","Please provide a chain with the `chain` argument on the Action, or by supplying a `chain` to WalletClient."].join(`
`),{name:"ChainNotFoundError"})}}class kU extends Wn{constructor(){super("No chain was provided to the Client.",{name:"ClientChainNotConfiguredError"})}}class JE extends Wn{constructor({chainId:e}){super(typeof e=="number"?`Chain ID "${e}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}function pb({blockNumber:t,chain:e,contract:n}){var l;const s=(l=e==null?void 0:e.contracts)==null?void 0:l[n];if(!s)throw new D5({chain:e,contract:{name:n}});if(t&&s.blockCreated&&s.blockCreated>t)throw new D5({blockNumber:t,chain:e,contract:{name:n,blockCreated:s.blockCreated}});return s.address}function Fo(t){return typeof t=="string"?{address:t,type:"json-rpc"}:t}const qJ={1:"An `assert` condition failed.",17:"Arithmetic operation resulted in underflow or overflow.",18:"Division or modulo by zero (e.g. `5 / 0` or `23 % 0`).",33:"Attempted to convert to an invalid type.",34:"Attempted to access a storage byte array that is incorrectly encoded.",49:"Performed `.pop()` on an empty array",50:"Array index is out of bounds.",65:"Allocated too much memory or created an array which is too large.",81:"Attempted to call a zero-initialized variable of internal function type."},IU={inputs:[{name:"message",type:"string"}],name:"Error",type:"error"},XJ={inputs:[{name:"reason",type:"uint256"}],name:"Panic",type:"error"};function ZJ(t){const{abi:e,data:n}=t,s=kx(n,0,4);if(s==="0x")throw new Yw;const u=[...e||[],IU,XJ].find(p=>p.type==="error"&&s===t2(df(p)));if(!u)throw new Z8(s,{docsPath:"/docs/contract/decodeErrorResult"});return{abiItem:u,args:"inputs"in u&&u.inputs&&u.inputs.length>0?e2(u.inputs,kx(n,4)):void 0,errorName:u.name}}const Ka=(t,e,n)=>JSON.stringify(t,(s,l)=>typeof l=="bigint"?l.toString():l,n);function PU({abiItem:t,args:e,includeFunctionName:n=!0,includeName:s=!1}){if("name"in t&&"inputs"in t&&t.inputs)return`${n?t.name:""}(${t.inputs.map((l,u)=>`${s&&l.name?`${l.name}: `:""}${typeof e[u]=="object"?Ka(e[u]):e[u]}`).join(", ")})`}const QJ={gwei:9,wei:18},KJ={ether:-9,wei:9},YJ={ether:-18,gwei:-9};function n2(t,e){let n=t.toString();const s=n.startsWith("-");s&&(n=n.slice(1)),n=n.padStart(e,"0");let[l,u]=[n.slice(0,n.length-e),n.slice(n.length-e)];return u=u.replace(/(0+)$/,""),`${s?"-":""}${l||"0"}${u?`.${u}`:""}`}function xP(t,e="wei"){return n2(t,QJ[e])}function bu(t,e="wei"){return n2(t,KJ[e])}class JJ extends Wn{constructor({address:e}){super(`State for account "${e}" is set multiple times.`,{name:"AccountStateConflictError"})}}class eee extends Wn{constructor(){super("state and stateDiff are set on the same account.",{name:"StateAssignmentConflictError"})}}function mL(t){return t.reduce((e,{slot:n,value:s})=>`${e}        ${n}: ${s}
`,"")}function tee(t){return t.reduce((e,{address:n,...s})=>{let l=`${e}    ${n}:
`;return s.nonce&&(l+=`      nonce: ${s.nonce}
`),s.balance&&(l+=`      balance: ${s.balance}
`),s.code&&(l+=`      code: ${s.code}
`),s.state&&(l+=`      state:
`,l+=mL(s.state)),s.stateDiff&&(l+=`      stateDiff:
`,l+=mL(s.stateDiff)),l},`  State Override:
`).slice(0,-1)}function r2(t){const e=Object.entries(t).map(([s,l])=>l===void 0||l===!1?null:[s,l]).filter(Boolean),n=e.reduce((s,[l])=>Math.max(s,l.length),0);return e.map(([s,l])=>`  ${`${s}:`.padEnd(n+1)}  ${l}`).join(`
`)}class nee extends Wn{constructor({v:e}){super(`Invalid \`v\` value "${e}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}}class ree extends Wn{constructor({transaction:e}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",r2(e),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class iee extends Wn{constructor({storageKey:e}){super(`Size for storage key "${e}" is invalid. Expected 32 bytes. Got ${Math.floor((e.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}class see extends Wn{constructor(e,{account:n,docsPath:s,chain:l,data:u,gas:p,gasPrice:r,maxFeePerGas:v,maxPriorityFeePerGas:w,nonce:E,to:T,value:k}){var D;const R=r2({chain:l&&`${l==null?void 0:l.name} (id: ${l==null?void 0:l.id})`,from:n==null?void 0:n.address,to:T,value:typeof k<"u"&&`${xP(k)} ${((D=l==null?void 0:l.nativeCurrency)==null?void 0:D.symbol)||"ETH"}`,data:u,gas:p,gasPrice:typeof r<"u"&&`${bu(r)} gwei`,maxFeePerGas:typeof v<"u"&&`${bu(v)} gwei`,maxPriorityFeePerGas:typeof w<"u"&&`${bu(w)} gwei`,nonce:E});super(e.shortMessage,{cause:e,docsPath:s,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Request Arguments:",R].filter(Boolean),name:"TransactionExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}class RU extends Wn{constructor({blockHash:e,blockNumber:n,blockTag:s,hash:l,index:u}){let p="Transaction";s&&u!==void 0&&(p=`Transaction at block time "${s}" at index "${u}"`),e&&u!==void 0&&(p=`Transaction at block hash "${e}" at index "${u}"`),n&&u!==void 0&&(p=`Transaction at block number "${n}" at index "${u}"`),l&&(p=`Transaction with hash "${l}"`),super(`${p} could not be found.`,{name:"TransactionNotFoundError"})}}class NU extends Wn{constructor({hash:e}){super(`Transaction receipt with hash "${e}" could not be found. The Transaction may not be processed on a block yet.`,{name:"TransactionReceiptNotFoundError"})}}class jU extends Wn{constructor({receipt:e}){super(`Transaction with hash "${e.transactionHash}" reverted.`,{metaMessages:['The receipt marked the transaction as "reverted". This could mean that the function on the contract you are trying to call threw an error.'," ","You can attempt to extract the revert reason by:","- calling the `simulateContract` or `simulateCalls` Action with the `abi` and `functionName` of the contract","- using the `call` Action with raw `data`"],name:"TransactionReceiptRevertedError"}),Object.defineProperty(this,"receipt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.receipt=e}}class oee extends Wn{constructor({hash:e}){super(`Timed out while waiting for transaction with hash "${e}" to be confirmed.`,{name:"WaitForTransactionReceiptTimeoutError"})}}const aee=t=>t,_P=t=>t;class DU extends Wn{constructor(e,{account:n,docsPath:s,chain:l,data:u,gas:p,gasPrice:r,maxFeePerGas:v,maxPriorityFeePerGas:w,nonce:E,to:T,value:k,stateOverride:R}){var F;const D=n?Fo(n):void 0;let O=r2({from:D==null?void 0:D.address,to:T,value:typeof k<"u"&&`${xP(k)} ${((F=l==null?void 0:l.nativeCurrency)==null?void 0:F.symbol)||"ETH"}`,data:u,gas:p,gasPrice:typeof r<"u"&&`${bu(r)} gwei`,maxFeePerGas:typeof v<"u"&&`${bu(v)} gwei`,maxPriorityFeePerGas:typeof w<"u"&&`${bu(w)} gwei`,nonce:E});R&&(O+=`
${tee(R)}`),super(e.shortMessage,{cause:e,docsPath:s,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Raw Call Arguments:",O].filter(Boolean),name:"CallExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}class vP extends Wn{constructor(e,{abi:n,args:s,contractAddress:l,docsPath:u,functionName:p,sender:r}){const v=Xx({abi:n,args:s,name:p}),w=v?PU({abiItem:v,args:s,includeFunctionName:!1,includeName:!1}):void 0,E=v?df(v,{includeName:!0}):void 0,T=r2({address:l&&aee(l),function:E,args:w&&w!=="()"&&`${[...Array((p==null?void 0:p.length)??0).keys()].map(()=>" ").join("")}${w}`,sender:r});super(e.shortMessage||`An unknown error occurred while executing the contract function "${p}".`,{cause:e,docsPath:u,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],T&&"Contract Call:",T].filter(Boolean),name:"ContractFunctionExecutionError"}),Object.defineProperty(this,"abi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formattedArgs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"functionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abi=n,this.args=s,this.cause=e,this.contractAddress=l,this.functionName=p,this.sender=r}}class L5 extends Wn{constructor({abi:e,data:n,functionName:s,message:l}){let u,p,r,v;if(n&&n!=="0x")try{p=ZJ({abi:e,data:n});const{abiItem:E,errorName:T,args:k}=p;if(T==="Error")v=k[0];else if(T==="Panic"){const[R]=k;v=qJ[R]}else{const R=E?df(E,{includeName:!0}):void 0,D=E&&k?PU({abiItem:E,args:k,includeFunctionName:!1,includeName:!1}):void 0;r=[R?`Error: ${R}`:"",D&&D!=="()"?`       ${[...Array((T==null?void 0:T.length)??0).keys()].map(()=>" ").join("")}${D}`:""]}}catch(E){u=E}else l&&(v=l);let w;u instanceof Z8&&(w=u.signature,r=[`Unable to decode signature "${w}" as it was not found on the provided ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${w}.`]),super(v&&v!=="execution reverted"||w?[`The contract function "${s}" reverted with the following ${w?"signature":"reason"}:`,v||w].join(`
`):`The contract function "${s}" reverted.`,{cause:u,metaMessages:r,name:"ContractFunctionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"raw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=p,this.raw=n,this.reason=v,this.signature=w}}class lee extends Wn{constructor({functionName:e}){super(`The contract function "${e}" returned no data ("0x").`,{metaMessages:["This could be due to any of the following:",`  - The contract does not have the function "${e}",`,"  - The parameters passed to the contract function may be invalid, or","  - The address is not a contract."],name:"ContractFunctionZeroDataError"})}}class cee extends Wn{constructor({factory:e}){super(`Deployment for counterfactual contract call failed${e?` for factory "${e}".`:""}`,{metaMessages:["Please ensure:","- The `factory` is a valid contract deployment factory (ie. Create2 Factory, ERC-4337 Factory, etc).","- The `factoryData` is a valid encoded function call for contract deployment function on the factory."],name:"CounterfactualDeploymentFailedError"})}}class eA extends Wn{constructor({data:e,message:n}){super(n||"",{name:"RawContractError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=e}}function bP(t){var n,s,l,u,p,r;if(!(t instanceof Wn))return!1;const e=t.walk(v=>v instanceof L5);return e instanceof L5?((n=e.data)==null?void 0:n.errorName)==="HttpError"||((s=e.data)==null?void 0:s.errorName)==="ResolverError"||((l=e.data)==null?void 0:l.errorName)==="ResolverNotContract"||((u=e.data)==null?void 0:u.errorName)==="ResolverNotFound"||((p=e.data)==null?void 0:p.errorName)==="ReverseAddressMismatch"||((r=e.data)==null?void 0:r.errorName)==="UnsupportedResolverProfile":!1}function uee(t){const{abi:e,data:n}=t,s=kx(n,0,4),l=e.find(u=>u.type==="function"&&s===t2(df(u)));if(!l)throw new FK(s,{docsPath:"/docs/contract/decodeFunctionData"});return{functionName:l.name,args:"inputs"in l&&l.inputs&&l.inputs.length>0?e2(l.inputs,kx(n,4)):void 0}}const MC="/docs/contract/encodeErrorResult";function gL(t){const{abi:e,errorName:n,args:s}=t;let l=e[0];if(n){const v=Xx({abi:e,args:s,name:n});if(!v)throw new YD(n,{docsPath:MC});l=v}if(l.type!=="error")throw new YD(void 0,{docsPath:MC});const u=df(l),p=t2(u);let r="0x";if(s&&s.length>0){if(!l.inputs)throw new LK(l.name,{docsPath:MC});r=qx(l.inputs,s)}return Tp([p,r])}const kC="/docs/contract/encodeFunctionResult";function dee(t){const{abi:e,functionName:n,result:s}=t;let l=e[0];if(n){const p=Xx({abi:e,name:n});if(!p)throw new $v(n,{docsPath:kC});l=p}if(l.type!=="function")throw new $v(void 0,{docsPath:kC});if(!l.outputs)throw new K8(l.name,{docsPath:kC});const u=(()=>{if(l.outputs.length===0)return[];if(l.outputs.length===1)return[s];if(Array.isArray(s))return s;throw new Y8(s)})();return qx(l.outputs,u)}const tA="x-batch-gateway:true";async function hee(t){const{data:e,ccipRequest:n}=t,{args:[s]}=uee({abi:A5,data:e}),l=[],u=[];return await Promise.all(s.map(async(p,r)=>{try{u[r]=p.urls.includes(tA)?await hee({data:p.data,ccipRequest:n}):await n(p),l[r]=!1}catch(v){l[r]=!0,u[r]=fee(v)}})),dee({abi:A5,functionName:"query",result:[l,u]})}function fee(t){return t.name==="HttpRequestError"&&t.status?gL({abi:A5,errorName:"HttpError",args:[t.status,t.shortMessage]}):gL({abi:[IU],errorName:"Error",args:["shortMessage"in t?t.shortMessage:t.message]})}function LU(t){if(t.length!==66||t.indexOf("[")!==0||t.indexOf("]")!==65)return null;const e=`0x${t.slice(1,65)}`;return hf(e)?e:null}function O5(t){let e=new Uint8Array(32).fill(0);if(!t)return La(e);const n=t.split(".");for(let s=n.length-1;s>=0;s-=1){const l=LU(n[s]),u=l?db(l):bl(_x(n[s]),"bytes");e=bl(oh([e,u]),"bytes")}return La(e)}function pee(t){return`[${t.slice(2)}]`}function mee(t){const e=new Uint8Array(32).fill(0);return t?LU(t)||bl(_x(t)):La(e)}function wP(t){const e=t.replace(/^\.|\.$/gm,"");if(e.length===0)return new Uint8Array(1);const n=new Uint8Array(_x(e).byteLength+2);let s=0;const l=e.split(".");for(let u=0;u<l.length;u++){let p=_x(l[u]);p.byteLength>255&&(p=_x(pee(mee(l[u])))),n[s]=p.length,n.set(p,s+1),s+=p.length+1}return n.byteLength!==s+1?n.slice(0,s+1):n}function pi(t,e,n){const s=t[e.name];if(typeof s=="function")return s;const l=t[n];return typeof l=="function"?l:u=>e(t,u)}class V1 extends Wn{constructor({body:e,cause:n,details:s,headers:l,status:u,url:p}){super("HTTP request failed.",{cause:n,details:s,metaMessages:[u&&`Status: ${u}`,`URL: ${_P(p)}`,e&&`Request body: ${Ka(e)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=e,this.headers=l,this.status=u,this.url=p}}class SP extends Wn{constructor({body:e,error:n,url:s}){super("RPC Request failed.",{cause:n,details:n.message,metaMessages:[`URL: ${_P(s)}`,`Request body: ${Ka(e)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=n.code,this.data=n.data,this.url=s}}class yL extends Wn{constructor({body:e,url:n}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${_P(n)}`,`Request body: ${Ka(e)}`],name:"TimeoutError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=n}}const gee=-1;class Au extends Wn{constructor(e,{code:n,docsPath:s,metaMessages:l,name:u,shortMessage:p}){super(p,{cause:e,docsPath:s,metaMessages:l||(e==null?void 0:e.metaMessages),name:u||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=u||e.name,this.code=e instanceof SP?e.code:n??gee}}class yd extends Au{constructor(e,n){super(e,n),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=n.data}}class tw extends Au{constructor(e){super(e,{code:tw.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}}Object.defineProperty(tw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class nw extends Au{constructor(e){super(e,{code:nw.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}}Object.defineProperty(nw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class rw extends Au{constructor(e,{method:n}={}){super(e,{code:rw.code,name:"MethodNotFoundRpcError",shortMessage:`The method${n?` "${n}"`:""} does not exist / is not available.`})}}Object.defineProperty(rw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class iw extends Au{constructor(e){super(e,{code:iw.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(iw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class Ix extends Au{constructor(e){super(e,{code:Ix.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}}Object.defineProperty(Ix,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class U0 extends Au{constructor(e){super(e,{code:U0.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(U0,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class sw extends Au{constructor(e){super(e,{code:sw.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(sw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class yp extends Au{constructor(e){super(e,{code:yp.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}}Object.defineProperty(yp,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class ow extends Au{constructor(e){super(e,{code:ow.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}}Object.defineProperty(ow,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class rx extends Au{constructor(e,{method:n}={}){super(e,{code:rx.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${n?` "${n}"`:""} is not supported.`})}}Object.defineProperty(rx,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class Xv extends Au{constructor(e){super(e,{code:Xv.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}}Object.defineProperty(Xv,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class aw extends Au{constructor(e){super(e,{code:aw.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}}Object.defineProperty(aw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class ao extends yd{constructor(e){super(e,{code:ao.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(ao,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class lw extends yd{constructor(e){super(e,{code:lw.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}}Object.defineProperty(lw,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class cw extends yd{constructor(e,{method:n}={}){super(e,{code:cw.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${n?` " ${n}"`:""}.`})}}Object.defineProperty(cw,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class uw extends yd{constructor(e){super(e,{code:uw.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}}Object.defineProperty(uw,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class dw extends yd{constructor(e){super(e,{code:dw.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}}Object.defineProperty(dw,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class ld extends yd{constructor(e){super(e,{code:ld.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(ld,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class Zv extends yd{constructor(e){super(e,{code:Zv.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}}Object.defineProperty(Zv,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class hw extends yd{constructor(e){super(e,{code:hw.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}}Object.defineProperty(hw,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class fw extends yd{constructor(e){super(e,{code:fw.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}}Object.defineProperty(fw,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class pw extends yd{constructor(e){super(e,{code:pw.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}}Object.defineProperty(pw,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class mw extends yd{constructor(e){super(e,{code:mw.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}}Object.defineProperty(mw,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class gw extends yd{constructor(e){super(e,{code:gw.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}}Object.defineProperty(gw,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class Qv extends yd{constructor(e){super(e,{code:Qv.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}}Object.defineProperty(Qv,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});class yee extends Au{constructor(e){super(e,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}const xee=3;function Px(t,{abi:e,address:n,args:s,docsPath:l,functionName:u,sender:p}){const r=t instanceof eA?t:t instanceof Wn?t.walk(D=>"data"in D)||t.walk():{},{code:v,data:w,details:E,message:T,shortMessage:k}=r,R=t instanceof Yw?new lee({functionName:u}):[xee,Ix.code].includes(v)&&(w||E||T||k)||v===U0.code&&E==="execution reverted"&&w?new L5({abi:e,data:typeof w=="object"?w.data:w,functionName:u,message:r instanceof SP?E:k??T}):t;return new vP(R,{abi:e,args:s,contractAddress:n,docsPath:l,functionName:u,sender:p})}const _ee="modulepreload",vee=function(t){return"/"+t},xL={},hr=function(e,n,s){let l=Promise.resolve();if(n&&n.length>0){let p=function(w){return Promise.all(w.map(E=>Promise.resolve(E).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),v=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));l=p(n.map(w=>{if(w=vee(w),w in xL)return;xL[w]=!0;const E=w.endsWith(".css"),T=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${T}`))return;const k=document.createElement("link");if(k.rel=E?"stylesheet":_ee,E||(k.as="script"),k.crossOrigin="",k.href=w,v&&k.setAttribute("nonce",v),document.head.appendChild(k),E)return new Promise((R,D)=>{k.addEventListener("load",R),k.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${w}`)))})}))}function u(p){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=p,window.dispatchEvent(r),!r.defaultPrevented)throw p}return l.then(p=>{for(const r of p||[])r.status==="rejected"&&u(r.reason);return e().catch(u)})};/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const TP=BigInt(0),F5=BigInt(1);function i2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function EP(t){if(!i2(t))throw new Error("Uint8Array expected")}function yw(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function RS(t){const e=t.toString(16);return e.length&1?"0"+e:e}function OU(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?TP:BigInt("0x"+t)}const FU=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",bee=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function xw(t){if(EP(t),FU)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=bee[t[n]];return e}const Sm={_0:48,_9:57,A:65,F:70,a:97,f:102};function _L(t){if(t>=Sm._0&&t<=Sm._9)return t-Sm._0;if(t>=Sm.A&&t<=Sm.F)return t-(Sm.A-10);if(t>=Sm.a&&t<=Sm.f)return t-(Sm.a-10)}function aE(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(FU)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(n);for(let l=0,u=0;l<n;l++,u+=2){const p=_L(t.charCodeAt(u)),r=_L(t.charCodeAt(u+1));if(p===void 0||r===void 0){const v=t[u]+t[u+1];throw new Error('hex string expected, got non-hex character "'+v+'" at index '+u)}s[l]=p*16+r}return s}function vx(t){return OU(xw(t))}function BU(t){return EP(t),OU(xw(Uint8Array.from(t).reverse()))}function s2(t,e){return aE(t.toString(16).padStart(e*2,"0"))}function zU(t,e){return s2(t,e).reverse()}function Zd(t,e,n){let s;if(typeof e=="string")try{s=aE(e)}catch(u){throw new Error(t+" must be hex string or Uint8Array, cause: "+u)}else if(i2(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const l=s.length;if(typeof n=="number"&&l!==n)throw new Error(t+" of length "+n+" expected, got "+l);return s}function lE(...t){let e=0;for(let s=0;s<t.length;s++){const l=t[s];EP(l),e+=l.length}const n=new Uint8Array(e);for(let s=0,l=0;s<t.length;s++){const u=t[s];n.set(u,l),l+=u.length}return n}const IC=t=>typeof t=="bigint"&&TP<=t;function AP(t,e,n){return IC(t)&&IC(e)&&IC(n)&&e<=t&&t<n}function Tv(t,e,n,s){if(!AP(e,n,s))throw new Error("expected valid "+t+": "+n+" <= n < "+s+", got "+e)}function wee(t){let e;for(e=0;t>TP;t>>=F5,e+=1);return e}const nA=t=>(F5<<BigInt(t))-F5,PC=t=>new Uint8Array(t),vL=t=>Uint8Array.from(t);function See(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let s=PC(t),l=PC(t),u=0;const p=()=>{s.fill(1),l.fill(0),u=0},r=(...T)=>n(l,s,...T),v=(T=PC(0))=>{l=r(vL([0]),T),s=r(),T.length!==0&&(l=r(vL([1]),T),s=r())},w=()=>{if(u++>=1e3)throw new Error("drbg: tried 1000 values");let T=0;const k=[];for(;T<e;){s=r();const R=s.slice();k.push(R),T+=s.length}return lE(...k)};return(T,k)=>{p(),v(T);let R;for(;!(R=k(w()));)v();return p(),R}}const Tee={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||i2(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function rA(t,e,n={}){const s=(l,u,p)=>{const r=Tee[u];if(typeof r!="function")throw new Error("invalid validator function");const v=t[l];if(!(p&&v===void 0)&&!r(v,t))throw new Error("param "+String(l)+" is invalid. Expected "+u+", got "+v)};for(const[l,u]of Object.entries(e))s(l,u,!1);for(const[l,u]of Object.entries(n))s(l,u,!0);return t}function bL(t){const e=new WeakMap;return(n,...s)=>{const l=e.get(n);if(l!==void 0)return l;const u=t(n,...s);return e.set(n,u),u}}const Eee="0.1.1";function Aee(){return Eee}let Vs=class B5 extends Error{constructor(e,n={}){const s=(()=>{var v;if(n.cause instanceof B5){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:(v=n.cause)!=null&&v.message?n.cause.message:n.details})(),l=n.cause instanceof B5&&n.cause.docsPath||n.docsPath,p=`https://oxlib.sh${l??""}`,r=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...s||l?["",s?`Details: ${s}`:void 0,l?`See: ${p}`:void 0]:[]].filter(v=>typeof v=="string").join(`
`);super(r,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Aee()}`}),this.cause=n.cause,this.details=s,this.docs=p,this.docsPath=l,this.shortMessage=e}walk(e){return UU(this,e)}};function UU(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?UU(t.cause,e):e?null:t}function o2(t,e){if(gv(t)>e)throw new Hee({givenSize:gv(t),maxSize:e})}const Tm={zero:48,nine:57,A:65,F:70,a:97,f:102};function wL(t){if(t>=Tm.zero&&t<=Tm.nine)return t-Tm.zero;if(t>=Tm.A&&t<=Tm.F)return t-(Tm.A-10);if(t>=Tm.a&&t<=Tm.f)return t-(Tm.a-10)}function Cee(t,e={}){const{dir:n,size:s=32}=e;if(s===0)return t;if(t.length>s)throw new Gee({size:t.length,targetSize:s,type:"Bytes"});const l=new Uint8Array(s);for(let u=0;u<s;u++){const p=n==="right";l[p?u:s-u-1]=t[p?u:t.length-u-1]}return l}function VU(t,e={}){const{dir:n="left"}=e;let s=t,l=0;for(let u=0;u<s.length-1&&s[n==="left"?u:s.length-u-1].toString()==="0";u++)l++;return s=n==="left"?s.slice(l):s.slice(0,s.length-l),s}function iA(t,e){if(fd(t)>e)throw new Qee({givenSize:fd(t),maxSize:e})}function Mee(t,e){if(typeof e=="number"&&e>0&&e>fd(t)-1)throw new KU({offset:e,position:"start",size:fd(t)})}function kee(t,e,n){if(typeof e=="number"&&typeof n=="number"&&fd(t)!==n-e)throw new KU({offset:n,position:"end",size:fd(t)})}function HU(t,e={}){const{dir:n,size:s=32}=e;if(s===0)return t;const l=t.replace("0x","");if(l.length>s*2)throw new Kee({size:Math.ceil(l.length/2),targetSize:s,type:"Hex"});return`0x${l[n==="right"?"padEnd":"padStart"](s*2,"0")}`}const Iee="#__bigint";function GU(t,e,n){return JSON.stringify(t,(s,l)=>typeof l=="bigint"?l.toString()+Iee:l,n)}const Pee=new TextDecoder,Ree=new TextEncoder;function Nee(t){return t instanceof Uint8Array?t:typeof t=="string"?$U(t):jee(t)}function jee(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function $U(t,e={}){const{size:n}=e;let s=t;n&&(iA(t,n),s=Nx(t,n));let l=s.slice(2);l.length%2&&(l=`0${l}`);const u=l.length/2,p=new Uint8Array(u);for(let r=0,v=0;r<u;r++){const w=wL(l.charCodeAt(v++)),E=wL(l.charCodeAt(v++));if(w===void 0||E===void 0)throw new Vs(`Invalid byte sequence ("${l[v-2]}${l[v-1]}" in "${l}").`);p[r]=w*16+E}return p}function Dee(t,e={}){const{size:n}=e,s=Ree.encode(t);return typeof n=="number"?(o2(s,n),Lee(s,n)):s}function Lee(t,e){return Cee(t,{dir:"right",size:e})}function gv(t){return t.length}function Oee(t,e,n,s={}){const{strict:l}=s;return t.slice(e,n)}function Fee(t,e={}){const{size:n}=e;typeof n<"u"&&o2(t,n);const s=pf(t,e);return XU(s,e)}function Bee(t,e={}){const{size:n}=e;let s=t;if(typeof n<"u"&&(o2(s,n),s=WU(s)),s.length>1||s[0]>1)throw new Vee(s);return!!s[0]}function $m(t,e={}){const{size:n}=e;typeof n<"u"&&o2(t,n);const s=pf(t,e);return ZU(s,e)}function zee(t,e={}){const{size:n}=e;let s=t;return typeof n<"u"&&(o2(s,n),s=Uee(s)),Pee.decode(s)}function WU(t){return VU(t,{dir:"left"})}function Uee(t){return VU(t,{dir:"right"})}class Vee extends Vs{constructor(e){super(`Bytes value \`${e}\` is not a valid boolean.`,{metaMessages:["The bytes array must contain a single byte of either a `0` or `1` value."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesBooleanError"})}}let Hee=class extends Vs{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}},Gee=class extends Vs{constructor({size:e,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}};const $ee=new TextEncoder,Wee=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function qee(t,e={}){const{strict:n=!1}=e;if(!t)throw new SL(t);if(typeof t!="string")throw new SL(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new TL(t);if(!t.startsWith("0x"))throw new TL(t)}function ff(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function Xee(t){return t instanceof Uint8Array?pf(t):Array.isArray(t)?pf(new Uint8Array(t)):t}function qU(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(iA(n,e.size),Rx(n,e.size)):n}function pf(t,e={}){let n="";for(let l=0;l<t.length;l++)n+=Wee[t[l]];const s=`0x${n}`;return typeof e.size=="number"?(iA(s,e.size),Nx(s,e.size)):s}function Uc(t,e={}){const{signed:n,size:s}=e,l=BigInt(t);let u;s?n?u=(1n<<BigInt(s)*8n-1n)-1n:u=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(u=BigInt(Number.MAX_SAFE_INTEGER));const p=typeof u=="bigint"&&n?-u-1n:0;if(u&&l>u||l<p){const w=typeof t=="bigint"?"n":"";throw new QU({max:u?`${u}${w}`:void 0,min:`${p}${w}`,signed:n,size:s,value:`${t}${w}`})}const v=`0x${(n&&l<0?(1n<<BigInt(s*8))+BigInt(l):l).toString(16)}`;return s?Rx(v,s):v}function CP(t,e={}){return pf($ee.encode(t),e)}function Rx(t,e){return HU(t,{dir:"left",size:e})}function Nx(t,e){return HU(t,{dir:"right",size:e})}function xp(t,e,n,s={}){const{strict:l}=s;Mee(t,e);const u=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return l&&kee(u,e,n),u}function fd(t){return Math.ceil((t.length-2)/2)}function XU(t,e={}){const{signed:n}=e;e.size&&iA(t,e.size);const s=BigInt(t);if(!n)return s;const l=(t.length-2)/2,u=(1n<<BigInt(l)*8n)-1n,p=u>>1n;return s<=p?s:s-u-1n}function ZU(t,e={}){const{signed:n,size:s}=e;return Number(!n&&!s?t:XU(t,e))}function Zee(t,e={}){const{strict:n=!1}=e;try{return qee(t,{strict:n}),!0}catch{return!1}}class QU extends Vs{constructor({max:e,min:n,signed:s,size:l,value:u}){super(`Number \`${u}\` is not in safe${l?` ${l*8}-bit`:""}${s?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class SL extends Vs{constructor(e){super(`Value \`${typeof e=="object"?GU(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class TL extends Vs{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class Qee extends Vs{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class KU extends Vs{constructor({offset:e,position:n,size:s}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${s}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class Kee extends Vs{constructor({size:e,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function Yee(t){return{address:t.address,amount:Uc(t.amount),index:Uc(t.index),validatorIndex:Uc(t.validatorIndex)}}function YU(t){return{...typeof t.baseFeePerGas=="bigint"&&{baseFeePerGas:Uc(t.baseFeePerGas)},...typeof t.blobBaseFee=="bigint"&&{blobBaseFee:Uc(t.blobBaseFee)},...typeof t.feeRecipient=="string"&&{feeRecipient:t.feeRecipient},...typeof t.gasLimit=="bigint"&&{gasLimit:Uc(t.gasLimit)},...typeof t.number=="bigint"&&{number:Uc(t.number)},...typeof t.prevRandao=="bigint"&&{prevRandao:Uc(t.prevRandao)},...typeof t.time=="bigint"&&{time:Uc(t.time)},...t.withdrawals&&{withdrawals:t.withdrawals.map(Yee)}}}const Jee="0x82ad56cb",JU="0x608060405234801561001057600080fd5b5060405161018e38038061018e83398101604081905261002f91610124565b6000808351602085016000f59050803b61004857600080fd5b6000808351602085016000855af16040513d6000823e81610067573d81fd5b3d81f35b634e487b7160e01b600052604160045260246000fd5b600082601f83011261009257600080fd5b81516001600160401b038111156100ab576100ab61006b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156100d9576100d961006b565b6040528181528382016020018510156100f157600080fd5b60005b82811015610110576020818601810151838301820152016100f4565b506000918101602001919091529392505050565b6000806040838503121561013757600080fd5b82516001600160401b0381111561014d57600080fd5b61015985828601610081565b602085015190935090506001600160401b0381111561017757600080fd5b61018385828601610081565b915050925092905056fe",ete="0x608060405234801561001057600080fd5b506040516102c03803806102c083398101604081905261002f916101e6565b836001600160a01b03163b6000036100e457600080836001600160a01b03168360405161005c9190610270565b6000604051808303816000865af19150503d8060008114610099576040519150601f19603f3d011682016040523d82523d6000602084013e61009e565b606091505b50915091508115806100b857506001600160a01b0386163b155b156100e1578060405163101bb98d60e01b81526004016100d8919061028c565b60405180910390fd5b50505b6000808451602086016000885af16040513d6000823e81610103573d81fd5b3d81f35b80516001600160a01b038116811461011e57600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561015457818101518382015260200161013c565b50506000910152565b600082601f83011261016e57600080fd5b81516001600160401b0381111561018757610187610123565b604051601f8201601f19908116603f011681016001600160401b03811182821017156101b5576101b5610123565b6040528181528382016020018510156101cd57600080fd5b6101de826020830160208701610139565b949350505050565b600080600080608085870312156101fc57600080fd5b61020585610107565b60208601519094506001600160401b0381111561022157600080fd5b61022d8782880161015d565b93505061023c60408601610107565b60608601519092506001600160401b0381111561025857600080fd5b6102648782880161015d565b91505092959194509250565b60008251610282818460208701610139565b9190910192915050565b60208152600082518060208401526102ab816040850160208701610139565b601f01601f1916919091016040019291505056fe",tte="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",MP="0x608060405234801561001057600080fd5b506115b9806100206000396000f3fe6080604052600436106100f35760003560e01c80634d2301cc1161008a578063a8b0574e11610059578063a8b0574e14610325578063bce38bd714610350578063c3077fa914610380578063ee82ac5e146103b2576100f3565b80634d2301cc1461026257806372425d9d1461029f57806382ad56cb146102ca57806386d516e8146102fa576100f3565b80633408e470116100c65780633408e470146101af578063399542e9146101da5780633e64a6961461020c57806342cbb15c14610237576100f3565b80630f28c97d146100f8578063174dea7114610123578063252dba421461015357806327e86d6e14610184575b600080fd5b34801561010457600080fd5b5061010d6103ef565b60405161011a9190610c0a565b60405180910390f35b61013d60048036038101906101389190610c94565b6103f7565b60405161014a9190610e94565b60405180910390f35b61016d60048036038101906101689190610f0c565b610615565b60405161017b92919061101b565b60405180910390f35b34801561019057600080fd5b506101996107ab565b6040516101a69190611064565b60405180910390f35b3480156101bb57600080fd5b506101c46107b7565b6040516101d19190610c0a565b60405180910390f35b6101f460048036038101906101ef91906110ab565b6107bf565b6040516102039392919061110b565b60405180910390f35b34801561021857600080fd5b506102216107e1565b60405161022e9190610c0a565b60405180910390f35b34801561024357600080fd5b5061024c6107e9565b6040516102599190610c0a565b60405180910390f35b34801561026e57600080fd5b50610289600480360381019061028491906111a7565b6107f1565b6040516102969190610c0a565b60405180910390f35b3480156102ab57600080fd5b506102b4610812565b6040516102c19190610c0a565b60405180910390f35b6102e460048036038101906102df919061122a565b61081a565b6040516102f19190610e94565b60405180910390f35b34801561030657600080fd5b5061030f6109e4565b60405161031c9190610c0a565b60405180910390f35b34801561033157600080fd5b5061033a6109ec565b6040516103479190611286565b60405180910390f35b61036a600480360381019061036591906110ab565b6109f4565b6040516103779190610e94565b60405180910390f35b61039a60048036038101906103959190610f0c565b610ba6565b6040516103a99392919061110b565b60405180910390f35b3480156103be57600080fd5b506103d960048036038101906103d491906112cd565b610bca565b6040516103e69190611064565b60405180910390f35b600042905090565b60606000808484905090508067ffffffffffffffff81111561041c5761041b6112fa565b5b60405190808252806020026020018201604052801561045557816020015b610442610bd5565b81526020019060019003908161043a5790505b5092503660005b828110156105c957600085828151811061047957610478611329565b5b6020026020010151905087878381811061049657610495611329565b5b90506020028101906104a89190611367565b925060008360400135905080860195508360000160208101906104cb91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16818580606001906104f2919061138f565b604051610500929190611431565b60006040518083038185875af1925050503d806000811461053d576040519150601f19603f3d011682016040523d82523d6000602084013e610542565b606091505b5083600001846020018290528215151515815250505081516020850135176105bc577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260846000fd5b826001019250505061045c565b5082341461060c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610603906114a7565b60405180910390fd5b50505092915050565b6000606043915060008484905090508067ffffffffffffffff81111561063e5761063d6112fa565b5b60405190808252806020026020018201604052801561067157816020015b606081526020019060019003908161065c5790505b5091503660005b828110156107a157600087878381811061069557610694611329565b5b90506020028101906106a791906114c7565b92508260000160208101906106bc91906111a7565b73ffffffffffffffffffffffffffffffffffffffff168380602001906106e2919061138f565b6040516106f0929190611431565b6000604051808303816000865af19150503d806000811461072d576040519150601f19603f3d011682016040523d82523d6000602084013e610732565b606091505b5086848151811061074657610745611329565b5b60200260200101819052819250505080610795576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161078c9061153b565b60405180910390fd5b81600101915050610678565b5050509250929050565b60006001430340905090565b600046905090565b6000806060439250434091506107d68686866109f4565b905093509350939050565b600048905090565b600043905090565b60008173ffffffffffffffffffffffffffffffffffffffff16319050919050565b600044905090565b606060008383905090508067ffffffffffffffff81111561083e5761083d6112fa565b5b60405190808252806020026020018201604052801561087757816020015b610864610bd5565b81526020019060019003908161085c5790505b5091503660005b828110156109db57600084828151811061089b5761089a611329565b5b602002602001015190508686838181106108b8576108b7611329565b5b90506020028101906108ca919061155b565b92508260000160208101906108df91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060400190610905919061138f565b604051610913929190611431565b6000604051808303816000865af19150503d8060008114610950576040519150601f19603f3d011682016040523d82523d6000602084013e610955565b606091505b5082600001836020018290528215151515815250505080516020840135176109cf577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260646000fd5b8160010191505061087e565b50505092915050565b600045905090565b600041905090565b606060008383905090508067ffffffffffffffff811115610a1857610a176112fa565b5b604051908082528060200260200182016040528015610a5157816020015b610a3e610bd5565b815260200190600190039081610a365790505b5091503660005b82811015610b9c576000848281518110610a7557610a74611329565b5b60200260200101519050868683818110610a9257610a91611329565b5b9050602002810190610aa491906114c7565b9250826000016020810190610ab991906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060200190610adf919061138f565b604051610aed929190611431565b6000604051808303816000865af19150503d8060008114610b2a576040519150601f19603f3d011682016040523d82523d6000602084013e610b2f565b606091505b508260000183602001829052821515151581525050508715610b90578060000151610b8f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b869061153b565b60405180910390fd5b5b81600101915050610a58565b5050509392505050565b6000806060610bb7600186866107bf565b8093508194508295505050509250925092565b600081409050919050565b6040518060400160405280600015158152602001606081525090565b6000819050919050565b610c0481610bf1565b82525050565b6000602082019050610c1f6000830184610bfb565b92915050565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b60008083601f840112610c5457610c53610c2f565b5b8235905067ffffffffffffffff811115610c7157610c70610c34565b5b602083019150836020820283011115610c8d57610c8c610c39565b5b9250929050565b60008060208385031215610cab57610caa610c25565b5b600083013567ffffffffffffffff811115610cc957610cc8610c2a565b5b610cd585828601610c3e565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b60008115159050919050565b610d2281610d0d565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610d62578082015181840152602081019050610d47565b83811115610d71576000848401525b50505050565b6000601f19601f8301169050919050565b6000610d9382610d28565b610d9d8185610d33565b9350610dad818560208601610d44565b610db681610d77565b840191505092915050565b6000604083016000830151610dd96000860182610d19565b5060208301518482036020860152610df18282610d88565b9150508091505092915050565b6000610e0a8383610dc1565b905092915050565b6000602082019050919050565b6000610e2a82610ce1565b610e348185610cec565b935083602082028501610e4685610cfd565b8060005b85811015610e825784840389528151610e638582610dfe565b9450610e6e83610e12565b925060208a01995050600181019050610e4a565b50829750879550505050505092915050565b60006020820190508181036000830152610eae8184610e1f565b905092915050565b60008083601f840112610ecc57610ecb610c2f565b5b8235905067ffffffffffffffff811115610ee957610ee8610c34565b5b602083019150836020820283011115610f0557610f04610c39565b5b9250929050565b60008060208385031215610f2357610f22610c25565b5b600083013567ffffffffffffffff811115610f4157610f40610c2a565b5b610f4d85828601610eb6565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000610f918383610d88565b905092915050565b6000602082019050919050565b6000610fb182610f59565b610fbb8185610f64565b935083602082028501610fcd85610f75565b8060005b858110156110095784840389528151610fea8582610f85565b9450610ff583610f99565b925060208a01995050600181019050610fd1565b50829750879550505050505092915050565b60006040820190506110306000830185610bfb565b81810360208301526110428184610fa6565b90509392505050565b6000819050919050565b61105e8161104b565b82525050565b60006020820190506110796000830184611055565b92915050565b61108881610d0d565b811461109357600080fd5b50565b6000813590506110a58161107f565b92915050565b6000806000604084860312156110c4576110c3610c25565b5b60006110d286828701611096565b935050602084013567ffffffffffffffff8111156110f3576110f2610c2a565b5b6110ff86828701610eb6565b92509250509250925092565b60006060820190506111206000830186610bfb565b61112d6020830185611055565b818103604083015261113f8184610e1f565b9050949350505050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061117482611149565b9050919050565b61118481611169565b811461118f57600080fd5b50565b6000813590506111a18161117b565b92915050565b6000602082840312156111bd576111bc610c25565b5b60006111cb84828501611192565b91505092915050565b60008083601f8401126111ea576111e9610c2f565b5b8235905067ffffffffffffffff81111561120757611206610c34565b5b60208301915083602082028301111561122357611222610c39565b5b9250929050565b6000806020838503121561124157611240610c25565b5b600083013567ffffffffffffffff81111561125f5761125e610c2a565b5b61126b858286016111d4565b92509250509250929050565b61128081611169565b82525050565b600060208201905061129b6000830184611277565b92915050565b6112aa81610bf1565b81146112b557600080fd5b50565b6000813590506112c7816112a1565b92915050565b6000602082840312156112e3576112e2610c25565b5b60006112f1848285016112b8565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008235600160800383360303811261138357611382611358565b5b80830191505092915050565b600080833560016020038436030381126113ac576113ab611358565b5b80840192508235915067ffffffffffffffff8211156113ce576113cd61135d565b5b6020830192506001820236038313156113ea576113e9611362565b5b509250929050565b600081905092915050565b82818337600083830152505050565b600061141883856113f2565b93506114258385846113fd565b82840190509392505050565b600061143e82848661140c565b91508190509392505050565b600082825260208201905092915050565b7f4d756c746963616c6c333a2076616c7565206d69736d61746368000000000000600082015250565b6000611491601a8361144a565b915061149c8261145b565b602082019050919050565b600060208201905081810360008301526114c081611484565b9050919050565b6000823560016040038336030381126114e3576114e2611358565b5b80830191505092915050565b7f4d756c746963616c6c333a2063616c6c206661696c6564000000000000000000600082015250565b600061152560178361144a565b9150611530826114ef565b602082019050919050565b6000602082019050818103600083015261155481611518565b9050919050565b60008235600160600383360303811261157757611576611358565b5b8083019150509291505056fea264697066735822122020c1bc9aacf8e4a6507193432a895a8e77094f45a1395583f07b24e860ef06cd64736f6c634300080c0033",RC="/docs/contract/encodeDeployData";function sA(t){const{abi:e,args:n,bytecode:s}=t;if(!n||n.length===0)return s;const l=e.find(p=>"type"in p&&p.type==="constructor");if(!l)throw new RK({docsPath:RC});if(!("inputs"in l))throw new KD({docsPath:RC});if(!l.inputs||l.inputs.length===0)throw new KD({docsPath:RC});const u=qx(l.inputs,n);return Tp([s,u])}class yv extends Wn{constructor({cause:e,message:n}={}){var l;const s=(l=n==null?void 0:n.replace("execution reverted: ",""))==null?void 0:l.replace("execution reverted","");super(`Execution reverted ${s?`with reason: ${s}`:"for an unknown reason"}.`,{cause:e,name:"ExecutionRevertedError"})}}Object.defineProperty(yv,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(yv,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});class jx extends Wn{constructor({cause:e,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${bu(n)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:e,name:"FeeCapTooHighError"})}}Object.defineProperty(jx,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class z5 extends Wn{constructor({cause:e,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${bu(n)}`:""} gwei) cannot be lower than the block base fee.`,{cause:e,name:"FeeCapTooLowError"})}}Object.defineProperty(z5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas less than block base fee|fee cap less than block base fee|transaction is outdated/});class U5 extends Wn{constructor({cause:e,nonce:n}={}){super(`Nonce provided for the transaction ${n?`(${n}) `:""}is higher than the next one expected.`,{cause:e,name:"NonceTooHighError"})}}Object.defineProperty(U5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too high/});class V5 extends Wn{constructor({cause:e,nonce:n}={}){super([`Nonce provided for the transaction ${n?`(${n}) `:""}is lower than the current nonce of the account.`,"Try increasing the nonce or find the latest nonce with `getTransactionCount`."].join(`
`),{cause:e,name:"NonceTooLowError"})}}Object.defineProperty(V5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too low|transaction already imported|already known/});class H5 extends Wn{constructor({cause:e,nonce:n}={}){super(`Nonce provided for the transaction ${n?`(${n}) `:""}exceeds the maximum allowed nonce.`,{cause:e,name:"NonceMaxValueError"})}}Object.defineProperty(H5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce has max value/});class G5 extends Wn{constructor({cause:e}={}){super(["The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account."].join(`
`),{cause:e,metaMessages:["This error could arise when the account does not have enough funds to:"," - pay for the total gas fee,"," - pay for the value to send."," ","The cost of the transaction is calculated as `gas * gas fee + value`, where:"," - `gas` is the amount of gas needed for transaction to execute,"," - `gas fee` is the gas fee,"," - `value` is the amount of ether to send to the recipient."],name:"InsufficientFundsError"})}}Object.defineProperty(G5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/insufficient funds|exceeds transaction sender account balance/});class $5 extends Wn{constructor({cause:e,gas:n}={}){super(`The amount of gas ${n?`(${n}) `:""}provided for the transaction exceeds the limit allowed for the block.`,{cause:e,name:"IntrinsicGasTooHighError"})}}Object.defineProperty($5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too high|gas limit reached/});class W5 extends Wn{constructor({cause:e,gas:n}={}){super(`The amount of gas ${n?`(${n}) `:""}provided for the transaction is too low.`,{cause:e,name:"IntrinsicGasTooLowError"})}}Object.defineProperty(W5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too low/});class q5 extends Wn{constructor({cause:e}){super("The transaction type is not supported for this chain.",{cause:e,name:"TransactionTypeNotSupportedError"})}}Object.defineProperty(q5,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/transaction type not valid/});class _w extends Wn{constructor({cause:e,maxPriorityFeePerGas:n,maxFeePerGas:s}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${n?` = ${bu(n)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${s?` = ${bu(s)} gwei`:""}).`].join(`
`),{cause:e,name:"TipAboveFeeCapError"})}}Object.defineProperty(_w,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});class a2 extends Wn{constructor({cause:e}){super(`An error occurred while executing: ${e==null?void 0:e.shortMessage}`,{cause:e,name:"UnknownNodeError"})}}function oA(t,e){const n=(t.details||"").toLowerCase(),s=t instanceof Wn?t.walk(l=>(l==null?void 0:l.code)===yv.code):t;return s instanceof Wn?new yv({cause:t,message:s.details}):yv.nodeMessage.test(n)?new yv({cause:t,message:t.details}):jx.nodeMessage.test(n)?new jx({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas}):z5.nodeMessage.test(n)?new z5({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas}):U5.nodeMessage.test(n)?new U5({cause:t,nonce:e==null?void 0:e.nonce}):V5.nodeMessage.test(n)?new V5({cause:t,nonce:e==null?void 0:e.nonce}):H5.nodeMessage.test(n)?new H5({cause:t,nonce:e==null?void 0:e.nonce}):G5.nodeMessage.test(n)?new G5({cause:t}):$5.nodeMessage.test(n)?new $5({cause:t,gas:e==null?void 0:e.gas}):W5.nodeMessage.test(n)?new W5({cause:t,gas:e==null?void 0:e.gas}):q5.nodeMessage.test(n)?new q5({cause:t}):_w.nodeMessage.test(n)?new _w({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas,maxPriorityFeePerGas:e==null?void 0:e.maxPriorityFeePerGas}):new a2({cause:t})}function e7(t,{docsPath:e,...n}){const s=(()=>{const l=oA(t,n);return l instanceof a2?t:l})();return new DU(s,{docsPath:e,...n})}function mb(t,{format:e}){if(!e)return{};const n={};function s(u){const p=Object.keys(u);for(const r of p)r in t&&(n[r]=t[r]),u[r]&&typeof u[r]=="object"&&!Array.isArray(u[r])&&s(u[r])}const l=e(t||{});return s(l),n}function kP(t,e){return({exclude:n,format:s})=>({exclude:n,format:(l,u)=>{const p=e(l,u);if(n)for(const r of n)delete p[r];return{...p,...s(l,u)}},type:t})}const nte={legacy:"0x0",eip2930:"0x1",eip1559:"0x2",eip4844:"0x3",eip7702:"0x4"};function X0(t,e){const n={};return typeof t.authorizationList<"u"&&(n.authorizationList=rte(t.authorizationList)),typeof t.accessList<"u"&&(n.accessList=t.accessList),typeof t.blobVersionedHashes<"u"&&(n.blobVersionedHashes=t.blobVersionedHashes),typeof t.blobs<"u"&&(typeof t.blobs[0]!="string"?n.blobs=t.blobs.map(s=>La(s)):n.blobs=t.blobs),typeof t.data<"u"&&(n.data=t.data),t.account&&(n.from=t.account.address),typeof t.from<"u"&&(n.from=t.from),typeof t.gas<"u"&&(n.gas=lr(t.gas)),typeof t.gasPrice<"u"&&(n.gasPrice=lr(t.gasPrice)),typeof t.maxFeePerBlobGas<"u"&&(n.maxFeePerBlobGas=lr(t.maxFeePerBlobGas)),typeof t.maxFeePerGas<"u"&&(n.maxFeePerGas=lr(t.maxFeePerGas)),typeof t.maxPriorityFeePerGas<"u"&&(n.maxPriorityFeePerGas=lr(t.maxPriorityFeePerGas)),typeof t.nonce<"u"&&(n.nonce=lr(t.nonce)),typeof t.to<"u"&&(n.to=t.to),typeof t.type<"u"&&(n.type=nte[t.type]),typeof t.value<"u"&&(n.value=lr(t.value)),n}function rte(t){return t.map(e=>({address:e.address,r:e.r?lr(BigInt(e.r)):e.r,s:e.s?lr(BigInt(e.s)):e.s,chainId:lr(e.chainId),nonce:lr(e.nonce),...typeof e.yParity<"u"?{yParity:lr(e.yParity)}:{},...typeof e.v<"u"&&typeof e.yParity>"u"?{v:lr(e.v)}:{}}))}function IP(){let t=()=>{},e=()=>{};return{promise:new Promise((s,l)=>{t=s,e=l}),resolve:t,reject:e}}const NC=new Map;function t7({fn:t,id:e,shouldSplitBatch:n,wait:s=0,sort:l}){const u=async()=>{const E=v();p();const T=E.map(({args:k})=>k);T.length!==0&&t(T).then(k=>{l&&Array.isArray(k)&&k.sort(l);for(let R=0;R<E.length;R++){const{resolve:D}=E[R];D==null||D([k[R],k])}}).catch(k=>{for(let R=0;R<E.length;R++){const{reject:D}=E[R];D==null||D(k)}})},p=()=>NC.delete(e),r=()=>v().map(({args:E})=>E),v=()=>NC.get(e)||[],w=E=>NC.set(e,[...v(),E]);return{flush:p,async schedule(E){const{promise:T,resolve:k,reject:R}=IP();return(n==null?void 0:n([...r(),E]))&&u(),v().length>0?(w({args:E,resolve:k,reject:R}),T):(w({args:E,resolve:k,reject:R}),setTimeout(u,s),T)}}}function EL(t){if(!(!t||t.length===0))return t.reduce((e,{slot:n,value:s})=>{if(n.length!==66)throw new eL({size:n.length,targetSize:66,type:"hex"});if(s.length!==66)throw new eL({size:s.length,targetSize:66,type:"hex"});return e[n]=s,e},{})}function ite(t){const{balance:e,nonce:n,state:s,stateDiff:l,code:u}=t,p={};if(u!==void 0&&(p.code=u),e!==void 0&&(p.balance=lr(e)),n!==void 0&&(p.nonce=lr(n)),s!==void 0&&(p.state=EL(s)),l!==void 0){if(p.state)throw new eee;p.stateDiff=EL(l)}return p}function PP(t){if(!t)return;const e={};for(const{address:n,...s}of t){if(!Oa(n,{strict:!1}))throw new Wc({address:n});if(e[n])throw new JJ({address:n});e[n]=ite(s)}return e}const aA=2n**256n-1n;function ug(t){const{account:e,maxFeePerGas:n,maxPriorityFeePerGas:s,to:l}=t,u=e?Fo(e):void 0;if(u&&!Oa(u.address))throw new Wc({address:u.address});if(l&&!Oa(l))throw new Wc({address:l});if(n&&n>aA)throw new jx({maxFeePerGas:n});if(s&&n&&s>n)throw new _w({maxFeePerGas:n,maxPriorityFeePerGas:s})}async function lA(t,e){var Me,Ke,ke,je;const{account:n=t.account,authorizationList:s,batch:l=!!((Me=t.batch)!=null&&Me.multicall),blockNumber:u,blockTag:p=t.experimental_blockTag??"latest",accessList:r,blobs:v,blockOverrides:w,code:E,data:T,factory:k,factoryData:R,gas:D,gasPrice:O,maxFeePerBlobGas:F,maxFeePerGas:U,maxPriorityFeePerGas:X,nonce:W,to:K,value:ne,stateOverride:te,...re}=e,xe=n?Fo(n):void 0;if(E&&(k||R))throw new Wn("Cannot provide both `code` & `factory`/`factoryData` as parameters.");if(E&&K)throw new Wn("Cannot provide both `code` & `to` as parameters.");const ae=E&&T,ce=k&&R&&K&&T,ye=ae||ce,Ce=ae?n7({code:E,data:T}):ce?ate({data:T,factory:k,factoryData:R,to:K}):T;try{ug(e);const Ae=(typeof u=="bigint"?lr(u):void 0)||p,He=w?YU(w):void 0,qe=PP(te),Le=(je=(ke=(Ke=t.chain)==null?void 0:Ke.formatters)==null?void 0:ke.transactionRequest)==null?void 0:je.format,bt=(Le||X0)({...mb(re,{format:Le}),accessList:r,account:xe,authorizationList:s,blobs:v,data:Ce,gas:D,gasPrice:O,maxFeePerBlobGas:F,maxFeePerGas:U,maxPriorityFeePerGas:X,nonce:W,to:ye?void 0:K,value:ne},"call");if(l&&ste({request:bt})&&!qe&&!He)try{return await ote(t,{...bt,blockNumber:u,blockTag:p})}catch(_t){if(!(_t instanceof kU)&&!(_t instanceof D5))throw _t}const yt=(()=>{const _t=[bt,Ae];return qe&&He?[..._t,qe,He]:qe?[..._t,qe]:He?[..._t,{},He]:_t})(),Vt=await t.request({method:"eth_call",params:yt});return Vt==="0x"?{data:void 0}:{data:Vt}}catch($e){const Ae=lte($e),{offchainLookup:He,offchainLookupSignature:qe}=await hr(async()=>{const{offchainLookup:Le,offchainLookupSignature:st}=await import("./ccip-626ANOBX.js");return{offchainLookup:Le,offchainLookupSignature:st}},[]);if(t.ccipRead!==!1&&(Ae==null?void 0:Ae.slice(0,10))===qe&&K)return{data:await He(t,{data:Ae,to:K})};throw ye&&(Ae==null?void 0:Ae.slice(0,10))==="0x101bb98d"?new cee({factory:k}):e7($e,{...e,account:xe,chain:t.chain})}}function ste({request:t}){const{data:e,to:n,...s}=t;return!(!e||e.startsWith(Jee)||!n||Object.values(s).filter(l=>typeof l<"u").length>0)}async function ote(t,e){var O;const{batchSize:n=1024,deployless:s=!1,wait:l=0}=typeof((O=t.batch)==null?void 0:O.multicall)=="object"?t.batch.multicall:{},{blockNumber:u,blockTag:p=t.experimental_blockTag??"latest",data:r,to:v}=e,w=(()=>{if(s)return null;if(e.multicallAddress)return e.multicallAddress;if(t.chain)return pb({blockNumber:u,chain:t.chain,contract:"multicall3"});throw new kU})(),T=(typeof u=="bigint"?lr(u):void 0)||p,{schedule:k}=t7({id:`${t.uid}.${T}`,wait:l,shouldSplitBatch(F){return F.reduce((X,{data:W})=>X+(W.length-2),0)>n*2},fn:async F=>{const U=F.map(K=>({allowFailure:!0,callData:K.data,target:K.to})),X=gd({abi:sE,args:[U],functionName:"aggregate3"}),W=await t.request({method:"eth_call",params:[{...w===null?{data:n7({code:MP,data:X})}:{to:w,data:X}},T]});return Zx({abi:sE,args:[U],functionName:"aggregate3",data:W||"0x"})}}),[{returnData:R,success:D}]=await k({data:r,to:v});if(!D)throw new eA({data:R});return R==="0x"?{data:void 0}:{data:R}}function n7(t){const{code:e,data:n}=t;return sA({abi:AU(["constructor(bytes, bytes)"]),bytecode:JU,args:[e,n]})}function ate(t){const{data:e,factory:n,factoryData:s,to:l}=t;return sA({abi:AU(["constructor(address, bytes, address, bytes)"]),bytecode:ete,args:[l,e,n,s]})}function lte(t){var n;if(!(t instanceof Wn))return;const e=t.walk();return typeof(e==null?void 0:e.data)=="object"?(n=e.data)==null?void 0:n.data:e.data}async function ah(t,e){const{abi:n,address:s,args:l,functionName:u,...p}=e,r=gd({abi:n,args:l,functionName:u});try{const{data:v}=await pi(t,lA,"call")({...p,data:r,to:s});return Zx({abi:n,args:l,functionName:u,data:v||"0x"})}catch(v){throw Px(v,{abi:n,address:s,args:l,docsPath:"/docs/contract/readContract",functionName:u})}}async function cte(t,e){const{blockNumber:n,blockTag:s,coinType:l,name:u,gatewayUrls:p,strict:r}=e,{chain:v}=t,w=(()=>{if(e.universalResolverAddress)return e.universalResolverAddress;if(!v)throw new Error("client chain not configured. universalResolverAddress is required.");return pb({blockNumber:n,chain:v,contract:"ensUniversalResolver"})})(),E=v==null?void 0:v.ensTlds;if(E&&!E.some(k=>u.endsWith(k)))return null;const T=l!=null?[O5(u),BigInt(l)]:[O5(u)];try{const k=gd({abi:ZD,functionName:"addr",args:T}),R={address:w,abi:G8,functionName:"resolveWithGateways",args:[ih(wP(u)),k,p??[tA]],blockNumber:n,blockTag:s},O=await pi(t,ah,"readContract")(R);if(O[0]==="0x")return null;const F=Zx({abi:ZD,args:T,functionName:"addr",data:O[0]});return F==="0x"||vu(F)==="0x00"?null:F}catch(k){if(r)throw k;if(bP(k))return null;throw k}}class ute extends Wn{constructor({data:e}){super("Unable to extract image from metadata. The metadata may be malformed or invalid.",{metaMessages:["- Metadata must be a JSON object with at least an `image`, `image_url` or `image_data` property.","",`Provided data: ${JSON.stringify(e)}`],name:"EnsAvatarInvalidMetadataError"})}}class w1 extends Wn{constructor({reason:e}){super(`ENS NFT avatar URI is invalid. ${e}`,{name:"EnsAvatarInvalidNftUriError"})}}class RP extends Wn{constructor({uri:e}){super(`Unable to resolve ENS avatar URI "${e}". The URI may be malformed, invalid, or does not respond with a valid image.`,{name:"EnsAvatarUriResolutionError"})}}class dte extends Wn{constructor({namespace:e}){super(`ENS NFT avatar namespace "${e}" is not supported. Must be "erc721" or "erc1155".`,{name:"EnsAvatarUnsupportedNamespaceError"})}}const hte=/(?<protocol>https?:\/\/[^/]*|ipfs:\/|ipns:\/|ar:\/)?(?<root>\/)?(?<subpath>ipfs\/|ipns\/)?(?<target>[\w\-.]+)(?<subtarget>\/.*)?/,fte=/^(Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})(\/(?<target>[\w\-.]+))?(?<subtarget>\/.*)?$/,pte=/^data:([a-zA-Z\-/+]*);base64,([^"].*)/,mte=/^data:([a-zA-Z\-/+]*)?(;[a-zA-Z0-9].*?)?(,)/;async function gte(t){try{const e=await fetch(t,{method:"HEAD"});if(e.status===200){const n=e.headers.get("content-type");return n==null?void 0:n.startsWith("image/")}return!1}catch(e){return typeof e=="object"&&typeof e.response<"u"||!Object.hasOwn(globalThis,"Image")?!1:new Promise(n=>{const s=new Image;s.onload=()=>{n(!0)},s.onerror=()=>{n(!1)},s.src=t})}}function AL(t,e){return t?t.endsWith("/")?t.slice(0,-1):t:e}function r7({uri:t,gatewayUrls:e}){const n=pte.test(t);if(n)return{uri:t,isOnChain:!0,isEncoded:n};const s=AL(e==null?void 0:e.ipfs,"https://ipfs.io"),l=AL(e==null?void 0:e.arweave,"https://arweave.net"),u=t.match(hte),{protocol:p,subpath:r,target:v,subtarget:w=""}=(u==null?void 0:u.groups)||{},E=p==="ipns:/"||r==="ipns/",T=p==="ipfs:/"||r==="ipfs/"||fte.test(t);if(t.startsWith("http")&&!E&&!T){let R=t;return e!=null&&e.arweave&&(R=t.replace(/https:\/\/arweave.net/g,e==null?void 0:e.arweave)),{uri:R,isOnChain:!1,isEncoded:!1}}if((E||T)&&v)return{uri:`${s}/${E?"ipns":"ipfs"}/${v}${w}`,isOnChain:!1,isEncoded:!1};if(p==="ar:/"&&v)return{uri:`${l}/${v}${w||""}`,isOnChain:!1,isEncoded:!1};let k=t.replace(mte,"");if(k.startsWith("<svg")&&(k=`data:image/svg+xml;base64,${btoa(k)}`),k.startsWith("data:")||k.startsWith("{"))return{uri:k,isOnChain:!0,isEncoded:!1};throw new RP({uri:t})}function i7(t){if(typeof t!="object"||!("image"in t)&&!("image_url"in t)&&!("image_data"in t))throw new ute({data:t});return t.image||t.image_url||t.image_data}async function yte({gatewayUrls:t,uri:e}){try{const n=await fetch(e).then(l=>l.json());return await NP({gatewayUrls:t,uri:i7(n)})}catch{throw new RP({uri:e})}}async function NP({gatewayUrls:t,uri:e}){const{uri:n,isOnChain:s}=r7({uri:e,gatewayUrls:t});if(s||await gte(n))return n;throw new RP({uri:e})}function xte(t){let e=t;e.startsWith("did:nft:")&&(e=e.replace("did:nft:","").replace(/_/g,"/"));const[n,s,l]=e.split("/"),[u,p]=n.split(":"),[r,v]=s.split(":");if(!u||u.toLowerCase()!=="eip155")throw new w1({reason:"Only EIP-155 supported"});if(!p)throw new w1({reason:"Chain ID not found"});if(!v)throw new w1({reason:"Contract address not found"});if(!l)throw new w1({reason:"Token ID not found"});if(!r)throw new w1({reason:"ERC namespace not found"});return{chainID:Number.parseInt(p,10),namespace:r.toLowerCase(),contractAddress:v,tokenID:l}}async function _te(t,{nft:e}){if(e.namespace==="erc721")return ah(t,{address:e.contractAddress,abi:[{name:"tokenURI",type:"function",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"tokenURI",args:[BigInt(e.tokenID)]});if(e.namespace==="erc1155")return ah(t,{address:e.contractAddress,abi:[{name:"uri",type:"function",stateMutability:"view",inputs:[{name:"_id",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"uri",args:[BigInt(e.tokenID)]});throw new dte({namespace:e.namespace})}async function vte(t,{gatewayUrls:e,record:n}){return/eip155:/i.test(n)?bte(t,{gatewayUrls:e,record:n}):NP({uri:n,gatewayUrls:e})}async function bte(t,{gatewayUrls:e,record:n}){const s=xte(n),l=await _te(t,{nft:s}),{uri:u,isOnChain:p,isEncoded:r}=r7({uri:l,gatewayUrls:e});if(p&&(u.includes("data:application/json;base64,")||u.startsWith("{"))){const w=r?atob(u.replace("data:application/json;base64,","")):u,E=JSON.parse(w);return NP({uri:i7(E),gatewayUrls:e})}let v=s.tokenID;return s.namespace==="erc1155"&&(v=v.replace("0x","").padStart(64,"0")),yte({gatewayUrls:e,uri:u.replace(/(?:0x)?{id}/,v)})}async function s7(t,e){const{blockNumber:n,blockTag:s,key:l,name:u,gatewayUrls:p,strict:r}=e,{chain:v}=t,w=(()=>{if(e.universalResolverAddress)return e.universalResolverAddress;if(!v)throw new Error("client chain not configured. universalResolverAddress is required.");return pb({blockNumber:n,chain:v,contract:"ensUniversalResolver"})})(),E=v==null?void 0:v.ensTlds;if(E&&!E.some(T=>u.endsWith(T)))return null;try{const T={address:w,abi:G8,args:[ih(wP(u)),gd({abi:XD,functionName:"text",args:[O5(u),l]}),p??[tA]],functionName:"resolveWithGateways",blockNumber:n,blockTag:s},R=await pi(t,ah,"readContract")(T);if(R[0]==="0x")return null;const D=Zx({abi:XD,functionName:"text",data:R[0]});return D===""?null:D}catch(T){if(r)throw T;if(bP(T))return null;throw T}}async function o7(t,{blockNumber:e,blockTag:n,assetGatewayUrls:s,name:l,gatewayUrls:u,strict:p,universalResolverAddress:r}){const v=await pi(t,s7,"getEnsText")({blockNumber:e,blockTag:n,key:"avatar",name:l,universalResolverAddress:r,gatewayUrls:u,strict:p});if(!v)return null;try{return await vte(t,{record:v,gatewayUrls:s})}catch{return null}}async function a7(t,e){const{address:n,blockNumber:s,blockTag:l,coinType:u=60n,gatewayUrls:p,strict:r}=e,{chain:v}=t,w=(()=>{if(e.universalResolverAddress)return e.universalResolverAddress;if(!v)throw new Error("client chain not configured. universalResolverAddress is required.");return pb({blockNumber:s,chain:v,contract:"ensUniversalResolver"})})();try{const E={address:w,abi:IK,args:[n,u,p??[tA]],functionName:"reverseWithGateways",blockNumber:s,blockTag:l},T=pi(t,ah,"readContract"),[k]=await T(E);return k||null}catch(E){if(r)throw E;if(bP(E))return null;throw E}}async function wte(t,e){const{blockNumber:n,blockTag:s,name:l}=e,{chain:u}=t,p=(()=>{if(e.universalResolverAddress)return e.universalResolverAddress;if(!u)throw new Error("client chain not configured. universalResolverAddress is required.");return pb({blockNumber:n,chain:u,contract:"ensUniversalResolver"})})(),r=u==null?void 0:u.ensTlds;if(r&&!r.some(w=>l.endsWith(w)))throw new Error(`${l} is not a valid ENS TLD (${r==null?void 0:r.join(", ")}) for chain "${u.name}" (id: ${u.id}).`);const[v]=await pi(t,ah,"readContract")({address:p,abi:[{inputs:[{type:"bytes"}],name:"findResolver",outputs:[{type:"address"},{type:"bytes32"},{type:"uint256"}],stateMutability:"view",type:"function"}],functionName:"findResolver",args:[ih(wP(l))],blockNumber:n,blockTag:s});return v}async function l7(t,e){var F,U,X;const{account:n=t.account,blockNumber:s,blockTag:l="latest",blobs:u,data:p,gas:r,gasPrice:v,maxFeePerBlobGas:w,maxFeePerGas:E,maxPriorityFeePerGas:T,to:k,value:R,...D}=e,O=n?Fo(n):void 0;try{ug(e);const K=(typeof s=="bigint"?lr(s):void 0)||l,ne=(X=(U=(F=t.chain)==null?void 0:F.formatters)==null?void 0:U.transactionRequest)==null?void 0:X.format,re=(ne||X0)({...mb(D,{format:ne}),account:O,blobs:u,data:p,gas:r,gasPrice:v,maxFeePerBlobGas:w,maxFeePerGas:E,maxPriorityFeePerGas:T,to:k,value:R},"createAccessList"),xe=await t.request({method:"eth_createAccessList",params:[re,K]});return{accessList:xe.accessList,gasUsed:BigInt(xe.gasUsed)}}catch(W){throw e7(W,{...e,account:O,chain:t.chain})}}function cA(t,{method:e}){var s,l;const n={};return t.transport.type==="fallback"&&((l=(s=t.transport).onResponse)==null||l.call(s,({method:u,response:p,status:r,transport:v})=>{r==="success"&&e===u&&(n[p]=v.request)})),(u=>n[u]||t.request)}async function Ste(t){const e=cA(t,{method:"eth_newBlockFilter"}),n=await t.request({method:"eth_newBlockFilter"});return{id:n,request:e(n),type:"block"}}class Tte extends Wn{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const CL="/docs/contract/encodeEventTopics";function l2(t){var v;const{abi:e,eventName:n,args:s}=t;let l=e[0];if(n){const w=Xx({abi:e,name:n});if(!w)throw new JD(n,{docsPath:CL});l=w}if(l.type!=="event")throw new JD(void 0,{docsPath:CL});const u=df(l),p=YE(u);let r=[];if(s&&"inputs"in l){const w=(v=l.inputs)==null?void 0:v.filter(T=>"indexed"in T&&T.indexed),E=Array.isArray(s)?s:Object.values(s).length>0?(w==null?void 0:w.map(T=>s[T.name]))??[]:[];E.length>0&&(r=(w==null?void 0:w.map((T,k)=>Array.isArray(E[k])?E[k].map((R,D)=>ML({param:T,value:E[k][D]})):typeof E[k]<"u"&&E[k]!==null?ML({param:T,value:E[k]}):null))??[])}return[p,...r]}function ML({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return bl(db(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Tte(t.type);return qx([t],[e])}async function c7(t,e){const{address:n,abi:s,args:l,eventName:u,fromBlock:p,strict:r,toBlock:v}=e,w=cA(t,{method:"eth_newFilter"}),E=u?l2({abi:s,args:l,eventName:u}):void 0,T=await t.request({method:"eth_newFilter",params:[{address:n,fromBlock:typeof p=="bigint"?lr(p):p,toBlock:typeof v=="bigint"?lr(v):v,topics:E}]});return{abi:s,args:l,eventName:u,id:T,request:w(T),strict:!!r,type:"event"}}async function u7(t,{address:e,args:n,event:s,events:l,fromBlock:u,strict:p,toBlock:r}={}){const v=l??(s?[s]:void 0),w=cA(t,{method:"eth_newFilter"});let E=[];v&&(E=[v.flatMap(R=>l2({abi:[R],eventName:R.name,args:n}))],s&&(E=E[0]));const T=await t.request({method:"eth_newFilter",params:[{address:e,fromBlock:typeof u=="bigint"?lr(u):u,toBlock:typeof r=="bigint"?lr(r):r,...E.length?{topics:E}:{}}]});return{abi:v,args:n,eventName:s?s.name:void 0,fromBlock:u,id:T,request:w(T),strict:!!p,toBlock:r,type:"event"}}async function d7(t){const e=cA(t,{method:"eth_newPendingTransactionFilter"}),n=await t.request({method:"eth_newPendingTransactionFilter"});return{id:n,request:e(n),type:"transaction"}}function h7(t){const e=bl(`0x${t.substring(4)}`).substring(26);return Jw(`0x${e}`)}async function Ete({hash:t,signature:e}){const n=hf(t)?t:ih(t),{secp256k1:s}=await hr(async()=>{const{secp256k1:p}=await Promise.resolve().then(()=>Fre);return{secp256k1:p}},void 0);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:w,s:E,v:T,yParity:k}=e,R=Number(k??T),D=kL(R);return new s.Signature(dd(w),dd(E)).addRecoveryBit(D)}const p=hf(e)?e:ih(e);if(Yo(p)!==65)throw new Error("invalid signature length");const r=hd(`0x${p.slice(130)}`),v=kL(r);return s.Signature.fromCompact(p.substring(2,130)).addRecoveryBit(v)})().recoverPublicKey(n.substring(2)).toHex(!1)}`}function kL(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function f7({hash:t,signature:e}){return h7(await Ete({hash:t,signature:e}))}function Dx(t,e="hex"){const n=p7(t),s=fP(new Uint8Array(n.length));return n.encode(s),e==="hex"?La(s.bytes):s.bytes}function p7(t){return Array.isArray(t)?Ate(t.map(e=>p7(e))):Cte(t)}function Ate(t){const e=t.reduce((l,u)=>l+u.length,0),n=m7(e);return{length:e<=55?1+e:1+n+e,encode(l){e<=55?l.pushByte(192+e):(l.pushByte(247+n),n===1?l.pushUint8(e):n===2?l.pushUint16(e):n===3?l.pushUint24(e):l.pushUint32(e));for(const{encode:u}of t)u(l)}}}function Cte(t){const e=typeof t=="string"?sh(t):t,n=m7(e.length);return{length:e.length===1&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length,encode(l){e.length===1&&e[0]<128?l.pushBytes(e):e.length<=55?(l.pushByte(128+e.length),l.pushBytes(e)):(l.pushByte(183+n),n===1?l.pushUint8(e.length):n===2?l.pushUint16(e.length):n===3?l.pushUint24(e.length):l.pushUint32(e.length),l.pushBytes(e))}}}function m7(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new Wn("Length is too large.")}function g7(t){const{chainId:e,nonce:n,to:s}=t,l=t.contractAddress??t.address,u=bl(Tp(["0x05",Dx([e?lr(e):"0x",l,n?lr(n):"0x"])]));return s==="bytes"?sh(u):u}async function uA(t){const{authorization:e,signature:n}=t;return f7({hash:g7(e),signature:n??e})}class Mte extends Wn{constructor(e,{account:n,docsPath:s,chain:l,data:u,gas:p,gasPrice:r,maxFeePerGas:v,maxPriorityFeePerGas:w,nonce:E,to:T,value:k}){var D;const R=r2({from:n==null?void 0:n.address,to:T,value:typeof k<"u"&&`${xP(k)} ${((D=l==null?void 0:l.nativeCurrency)==null?void 0:D.symbol)||"ETH"}`,data:u,gas:p,gasPrice:typeof r<"u"&&`${bu(r)} gwei`,maxFeePerGas:typeof v<"u"&&`${bu(v)} gwei`,maxPriorityFeePerGas:typeof w<"u"&&`${bu(w)} gwei`,nonce:E});super(e.shortMessage,{cause:e,docsPath:s,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Estimate Gas Arguments:",R].filter(Boolean),name:"EstimateGasExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}function kte(t,{docsPath:e,...n}){const s=(()=>{const l=oA(t,n);return l instanceof a2?t:l})();return new Mte(s,{docsPath:e,...n})}class y7 extends Wn{constructor(){super("`baseFeeMultiplier` must be greater than 1.",{name:"BaseFeeScalarError"})}}class jP extends Wn{constructor(){super("Chain does not support EIP-1559 fees.",{name:"Eip1559FeesNotSupportedError"})}}class Ite extends Wn{constructor({maxPriorityFeePerGas:e}){super(`\`maxFeePerGas\` cannot be less than the \`maxPriorityFeePerGas\` (${bu(e)} gwei).`,{name:"MaxFeePerGasTooLowError"})}}class x7 extends Wn{constructor({blockHash:e,blockNumber:n}){let s="Block";e&&(s=`Block at hash "${e}"`),n&&(s=`Block at number "${n}"`),super(`${s} could not be found.`,{name:"BlockNotFoundError"})}}const _7={"0x0":"legacy","0x1":"eip2930","0x2":"eip1559","0x3":"eip4844","0x4":"eip7702"};function dA(t,e){const n={...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,chainId:t.chainId?hd(t.chainId):void 0,gas:t.gas?BigInt(t.gas):void 0,gasPrice:t.gasPrice?BigInt(t.gasPrice):void 0,maxFeePerBlobGas:t.maxFeePerBlobGas?BigInt(t.maxFeePerBlobGas):void 0,maxFeePerGas:t.maxFeePerGas?BigInt(t.maxFeePerGas):void 0,maxPriorityFeePerGas:t.maxPriorityFeePerGas?BigInt(t.maxPriorityFeePerGas):void 0,nonce:t.nonce?hd(t.nonce):void 0,to:t.to?t.to:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,type:t.type?_7[t.type]:void 0,typeHex:t.type?t.type:void 0,value:t.value?BigInt(t.value):void 0,v:t.v?BigInt(t.v):void 0};return t.authorizationList&&(n.authorizationList=Pte(t.authorizationList)),n.yParity=(()=>{if(t.yParity)return Number(t.yParity);if(typeof n.v=="bigint"){if(n.v===0n||n.v===27n)return 0;if(n.v===1n||n.v===28n)return 1;if(n.v>=35n)return n.v%2n===0n?1:0}})(),n.type==="legacy"&&(delete n.accessList,delete n.maxFeePerBlobGas,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.yParity),n.type==="eip2930"&&(delete n.maxFeePerBlobGas,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas),n.type==="eip1559"&&delete n.maxFeePerBlobGas,n}const p3e=kP("transaction",dA);function Pte(t){return t.map(e=>({address:e.address,chainId:Number(e.chainId),nonce:Number(e.nonce),r:e.r,s:e.s,yParity:Number(e.yParity)}))}function DP(t,e){const n=(t.transactions??[]).map(s=>typeof s=="string"?s:dA(s));return{...t,baseFeePerGas:t.baseFeePerGas?BigInt(t.baseFeePerGas):null,blobGasUsed:t.blobGasUsed?BigInt(t.blobGasUsed):void 0,difficulty:t.difficulty?BigInt(t.difficulty):void 0,excessBlobGas:t.excessBlobGas?BigInt(t.excessBlobGas):void 0,gasLimit:t.gasLimit?BigInt(t.gasLimit):void 0,gasUsed:t.gasUsed?BigInt(t.gasUsed):void 0,hash:t.hash?t.hash:null,logsBloom:t.logsBloom?t.logsBloom:null,nonce:t.nonce?t.nonce:null,number:t.number?BigInt(t.number):null,size:t.size?BigInt(t.size):void 0,timestamp:t.timestamp?BigInt(t.timestamp):void 0,transactions:n,totalDifficulty:t.totalDifficulty?BigInt(t.totalDifficulty):null}}const m3e=kP("block",DP);async function cf(t,{blockHash:e,blockNumber:n,blockTag:s=t.experimental_blockTag??"latest",includeTransactions:l}={}){var w,E,T;const u=l??!1,p=n!==void 0?lr(n):void 0;let r=null;if(e?r=await t.request({method:"eth_getBlockByHash",params:[e,u]},{dedupe:!0}):r=await t.request({method:"eth_getBlockByNumber",params:[p||s,u]},{dedupe:!!p}),!r)throw new x7({blockHash:e,blockNumber:n});return(((T=(E=(w=t.chain)==null?void 0:w.formatters)==null?void 0:E.block)==null?void 0:T.format)||DP)(r,"getBlock")}async function LP(t){const e=await t.request({method:"eth_gasPrice"});return BigInt(e)}async function Rte(t,e){return v7(t,e)}async function v7(t,e){var u,p;const{block:n,chain:s=t.chain,request:l}=e||{};try{const r=((u=s==null?void 0:s.fees)==null?void 0:u.maxPriorityFeePerGas)??((p=s==null?void 0:s.fees)==null?void 0:p.defaultPriorityFee);if(typeof r=="function"){const w=n||await pi(t,cf,"getBlock")({}),E=await r({block:w,client:t,request:l});if(E===null)throw new Error;return E}if(typeof r<"u")return r;const v=await t.request({method:"eth_maxPriorityFeePerGas"});return dd(v)}catch{const[r,v]=await Promise.all([n?Promise.resolve(n):pi(t,cf,"getBlock")({}),pi(t,LP,"getGasPrice")({})]);if(typeof r.baseFeePerGas!="bigint")throw new jP;const w=v-r.baseFeePerGas;return w<0n?0n:w}}async function Nte(t,e){return X5(t,e)}async function X5(t,e){var k,R;const{block:n,chain:s=t.chain,request:l,type:u="eip1559"}=e||{},p=await(async()=>{var D,O;return typeof((D=s==null?void 0:s.fees)==null?void 0:D.baseFeeMultiplier)=="function"?s.fees.baseFeeMultiplier({block:n,client:t,request:l}):((O=s==null?void 0:s.fees)==null?void 0:O.baseFeeMultiplier)??1.2})();if(p<1)throw new y7;const v=10**(((k=p.toString().split(".")[1])==null?void 0:k.length)??0),w=D=>D*BigInt(Math.ceil(p*v))/BigInt(v),E=n||await pi(t,cf,"getBlock")({});if(typeof((R=s==null?void 0:s.fees)==null?void 0:R.estimateFeesPerGas)=="function"){const D=await s.fees.estimateFeesPerGas({block:n,client:t,multiply:w,request:l,type:u});if(D!==null)return D}if(u==="eip1559"){if(typeof E.baseFeePerGas!="bigint")throw new jP;const D=typeof(l==null?void 0:l.maxPriorityFeePerGas)=="bigint"?l.maxPriorityFeePerGas:await v7(t,{block:E,chain:s,request:l}),O=w(E.baseFeePerGas);return{maxFeePerGas:(l==null?void 0:l.maxFeePerGas)??O+D,maxPriorityFeePerGas:D}}return{gasPrice:(l==null?void 0:l.gasPrice)??w(await pi(t,LP,"getGasPrice")({}))}}async function OP(t,{address:e,blockTag:n="latest",blockNumber:s}){const l=await t.request({method:"eth_getTransactionCount",params:[e,typeof s=="bigint"?lr(s):n]},{dedupe:!!s});return hd(l)}function FP(t){const{kzg:e}=t,n=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),s=typeof t.blobs[0]=="string"?t.blobs.map(u=>sh(u)):t.blobs,l=[];for(const u of s)l.push(Uint8Array.from(e.blobToKzgCommitment(u)));return n==="bytes"?l:l.map(u=>La(u))}function BP(t){const{kzg:e}=t,n=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),s=typeof t.blobs[0]=="string"?t.blobs.map(p=>sh(p)):t.blobs,l=typeof t.commitments[0]=="string"?t.commitments.map(p=>sh(p)):t.commitments,u=[];for(let p=0;p<s.length;p++){const r=s[p],v=l[p];u.push(Uint8Array.from(e.computeBlobKzgProof(r,v)))}return n==="bytes"?u:u.map(p=>La(p))}function jte(t,e,n,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,s);const l=BigInt(32),u=BigInt(4294967295),p=Number(n>>l&u),r=Number(n&u),v=s?4:0,w=s?0:4;t.setUint32(e+v,p,s),t.setUint32(e+w,r,s)}function Dte(t,e,n){return t&e^~t&n}function Lte(t,e,n){return t&e^t&n^e&n}class b7 extends dP{constructor(e,n,s,l){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=s,this.isLE=l,this.buffer=new Uint8Array(e),this.view=SC(this.buffer)}update(e){qv(this),e=ZE(e),Mx(e);const{view:n,buffer:s,blockLen:l}=this,u=e.length;for(let p=0;p<u;){const r=Math.min(l-this.pos,u-p);if(r===l){const v=SC(e);for(;l<=u-p;p+=l)this.process(v,p);continue}s.set(e.subarray(p,p+r),this.pos),this.pos+=r,p+=r,this.pos===l&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){qv(this),iU(e,this),this.finished=!0;const{buffer:n,view:s,blockLen:l,isLE:u}=this;let{pos:p}=this;n[p++]=128,z0(this.buffer.subarray(p)),this.padOffset>l-p&&(this.process(s,0),p=0);for(let T=p;T<l;T++)n[T]=0;jte(s,l-8,BigInt(this.length*8),u),this.process(s,0);const r=SC(e),v=this.outputLen;if(v%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const w=v/4,E=this.get();if(w>E.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<w;T++)r.setUint32(4*T,E[T],u)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const s=e.slice(0,n);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:s,length:l,finished:u,destroyed:p,pos:r}=this;return e.destroyed=p,e.finished=u,e.length=l,e.pos=r,l%n&&e.buffer.set(s),e}clone(){return this._cloneInto()}}const o0=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),lc=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),cc=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Ote=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a0=new Uint32Array(64);class Fte extends b7{constructor(e=32){super(64,e,8,!1),this.A=o0[0]|0,this.B=o0[1]|0,this.C=o0[2]|0,this.D=o0[3]|0,this.E=o0[4]|0,this.F=o0[5]|0,this.G=o0[6]|0,this.H=o0[7]|0}get(){const{A:e,B:n,C:s,D:l,E:u,F:p,G:r,H:v}=this;return[e,n,s,l,u,p,r,v]}set(e,n,s,l,u,p,r,v){this.A=e|0,this.B=n|0,this.C=s|0,this.D=l|0,this.E=u|0,this.F=p|0,this.G=r|0,this.H=v|0}process(e,n){for(let T=0;T<16;T++,n+=4)a0[T]=e.getUint32(n,!1);for(let T=16;T<64;T++){const k=a0[T-15],R=a0[T-2],D=ap(k,7)^ap(k,18)^k>>>3,O=ap(R,17)^ap(R,19)^R>>>10;a0[T]=O+a0[T-7]+D+a0[T-16]|0}let{A:s,B:l,C:u,D:p,E:r,F:v,G:w,H:E}=this;for(let T=0;T<64;T++){const k=ap(r,6)^ap(r,11)^ap(r,25),R=E+k+Dte(r,v,w)+Ote[T]+a0[T]|0,O=(ap(s,2)^ap(s,13)^ap(s,22))+Lte(s,l,u)|0;E=w,w=v,v=r,r=p+R|0,p=u,u=l,l=s,s=R+O|0}s=s+this.A|0,l=l+this.B|0,u=u+this.C|0,p=p+this.D|0,r=r+this.E|0,v=v+this.F|0,w=w+this.G|0,E=E+this.H|0,this.set(s,l,u,p,r,v,w,E)}roundClean(){z0(a0)}destroy(){this.set(0,0,0,0,0,0,0,0),z0(this.buffer)}}const w7=rU(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Bte=w7[0],zte=w7[1],l0=new Uint32Array(80),c0=new Uint32Array(80);class S7 extends b7{constructor(e=64){super(128,e,16,!1),this.Ah=cc[0]|0,this.Al=cc[1]|0,this.Bh=cc[2]|0,this.Bl=cc[3]|0,this.Ch=cc[4]|0,this.Cl=cc[5]|0,this.Dh=cc[6]|0,this.Dl=cc[7]|0,this.Eh=cc[8]|0,this.El=cc[9]|0,this.Fh=cc[10]|0,this.Fl=cc[11]|0,this.Gh=cc[12]|0,this.Gl=cc[13]|0,this.Hh=cc[14]|0,this.Hl=cc[15]|0}get(){const{Ah:e,Al:n,Bh:s,Bl:l,Ch:u,Cl:p,Dh:r,Dl:v,Eh:w,El:E,Fh:T,Fl:k,Gh:R,Gl:D,Hh:O,Hl:F}=this;return[e,n,s,l,u,p,r,v,w,E,T,k,R,D,O,F]}set(e,n,s,l,u,p,r,v,w,E,T,k,R,D,O,F){this.Ah=e|0,this.Al=n|0,this.Bh=s|0,this.Bl=l|0,this.Ch=u|0,this.Cl=p|0,this.Dh=r|0,this.Dl=v|0,this.Eh=w|0,this.El=E|0,this.Fh=T|0,this.Fl=k|0,this.Gh=R|0,this.Gl=D|0,this.Hh=O|0,this.Hl=F|0}process(e,n){for(let W=0;W<16;W++,n+=4)l0[W]=e.getUint32(n),c0[W]=e.getUint32(n+=4);for(let W=16;W<80;W++){const K=l0[W-15]|0,ne=c0[W-15]|0,te=O_(K,ne,1)^O_(K,ne,8)^rL(K,ne,7),re=F_(K,ne,1)^F_(K,ne,8)^iL(K,ne,7),xe=l0[W-2]|0,ae=c0[W-2]|0,ce=O_(xe,ae,19)^IS(xe,ae,61)^rL(xe,ae,6),ye=F_(xe,ae,19)^PS(xe,ae,61)^iL(xe,ae,6),Ce=lY(re,ye,c0[W-7],c0[W-16]),Me=cY(Ce,te,ce,l0[W-7],l0[W-16]);l0[W]=Me|0,c0[W]=Ce|0}let{Ah:s,Al:l,Bh:u,Bl:p,Ch:r,Cl:v,Dh:w,Dl:E,Eh:T,El:k,Fh:R,Fl:D,Gh:O,Gl:F,Hh:U,Hl:X}=this;for(let W=0;W<80;W++){const K=O_(T,k,14)^O_(T,k,18)^IS(T,k,41),ne=F_(T,k,14)^F_(T,k,18)^PS(T,k,41),te=T&R^~T&O,re=k&D^~k&F,xe=uY(X,ne,re,zte[W],c0[W]),ae=dY(xe,U,K,te,Bte[W],l0[W]),ce=xe|0,ye=O_(s,l,28)^IS(s,l,34)^IS(s,l,39),Ce=F_(s,l,28)^PS(s,l,34)^PS(s,l,39),Me=s&u^s&r^u&r,Ke=l&p^l&v^p&v;U=O|0,X=F|0,O=R|0,F=D|0,R=T|0,D=k|0,{h:T,l:k}=wm(w|0,E|0,ae|0,ce|0),w=r|0,E=v|0,r=u|0,v=p|0,u=s|0,p=l|0;const ke=oY(ce,Ce,Ke);s=aY(ke,ae,ye,Me),l=ke|0}({h:s,l}=wm(this.Ah|0,this.Al|0,s|0,l|0)),{h:u,l:p}=wm(this.Bh|0,this.Bl|0,u|0,p|0),{h:r,l:v}=wm(this.Ch|0,this.Cl|0,r|0,v|0),{h:w,l:E}=wm(this.Dh|0,this.Dl|0,w|0,E|0),{h:T,l:k}=wm(this.Eh|0,this.El|0,T|0,k|0),{h:R,l:D}=wm(this.Fh|0,this.Fl|0,R|0,D|0),{h:O,l:F}=wm(this.Gh|0,this.Gl|0,O|0,F|0),{h:U,l:X}=wm(this.Hh|0,this.Hl|0,U|0,X|0),this.set(s,l,u,p,r,v,w,E,T,k,R,D,O,F,U,X)}roundClean(){z0(l0,c0)}destroy(){z0(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Ute extends S7{constructor(){super(48),this.Ah=lc[0]|0,this.Al=lc[1]|0,this.Bh=lc[2]|0,this.Bl=lc[3]|0,this.Ch=lc[4]|0,this.Cl=lc[5]|0,this.Dh=lc[6]|0,this.Dl=lc[7]|0,this.Eh=lc[8]|0,this.El=lc[9]|0,this.Fh=lc[10]|0,this.Fl=lc[11]|0,this.Gh=lc[12]|0,this.Gl=lc[13]|0,this.Hh=lc[14]|0,this.Hl=lc[15]|0}}const T7=QE(()=>new Fte),g3e=QE(()=>new S7),y3e=QE(()=>new Ute),Vte=T7;function Hte(t,e){return Vte(hf(t,{strict:!1})?db(t):t)}function Gte(t){const{commitment:e,version:n=1}=t,s=t.to??(typeof e=="string"?"hex":"bytes"),l=Hte(e);return l.set([n],0),s==="bytes"?l:La(l)}function E7(t){const{commitments:e,version:n}=t,s=t.to??(typeof e[0]=="string"?"hex":"bytes"),l=[];for(const u of e)l.push(Gte({commitment:u,to:s,version:n}));return l}const IL=6,A7=32,zP=4096,C7=A7*zP,PL=C7*IL-1-1*zP*IL,M7=1;class $te extends Wn{constructor({maxSize:e,size:n}){super("Blob size is too large.",{metaMessages:[`Max: ${e} bytes`,`Given: ${n} bytes`],name:"BlobSizeTooLargeError"})}}class k7 extends Wn{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class Wte extends Wn{constructor({hash:e,size:n}){super(`Versioned hash "${e}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${n}`],name:"InvalidVersionedHashSizeError"})}}class qte extends Wn{constructor({hash:e,version:n}){super(`Versioned hash "${e}" version is invalid.`,{metaMessages:[`Expected: ${M7}`,`Received: ${n}`],name:"InvalidVersionedHashVersionError"})}}function Xte(t){const e=t.to??(typeof t.data=="string"?"hex":"bytes"),n=typeof t.data=="string"?sh(t.data):t.data,s=Yo(n);if(!s)throw new k7;if(s>PL)throw new $te({maxSize:PL,size:s});const l=[];let u=!0,p=0;for(;u;){const r=fP(new Uint8Array(C7));let v=0;for(;v<zP;){const w=n.slice(p,p+(A7-1));if(r.pushByte(0),r.pushBytes(w),w.length<31){r.pushByte(128),u=!1;break}v++,p+=31}l.push(r)}return e==="bytes"?l.map(r=>r.bytes):l.map(r=>La(r.bytes))}function I7(t){const{data:e,kzg:n,to:s}=t,l=t.blobs??Xte({data:e,to:s}),u=t.commitments??FP({blobs:l,kzg:n,to:s}),p=t.proofs??BP({blobs:l,commitments:u,kzg:n,to:s}),r=[];for(let v=0;v<l.length;v++)r.push({blob:l[v],commitment:u[v],proof:p[v]});return r}function P7(t){if(t.type)return t.type;if(typeof t.authorizationList<"u")return"eip7702";if(typeof t.blobs<"u"||typeof t.blobVersionedHashes<"u"||typeof t.maxFeePerBlobGas<"u"||typeof t.sidecars<"u")return"eip4844";if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")return"eip1559";if(typeof t.gasPrice<"u")return typeof t.accessList<"u"?"eip2930":"legacy";throw new ree({transaction:t})}function hA(t,{docsPath:e,...n}){const s=(()=>{const l=oA(t,n);return l instanceof a2?t:l})();return new see(s,{docsPath:e,...n})}async function Z0(t){const e=await t.request({method:"eth_chainId"},{dedupe:!0});return hd(e)}async function UP(t,e){var xe,ae,ce,ye,Ce;const{account:n=t.account,accessList:s,authorizationList:l,chain:u=t.chain,blobVersionedHashes:p,blobs:r,data:v,gas:w,gasPrice:E,maxFeePerBlobGas:T,maxFeePerGas:k,maxPriorityFeePerGas:R,nonce:D,nonceManager:O,to:F,type:U,value:X,...W}=e,K=await(async()=>{if(!n||!O||typeof D<"u")return D;const Me=Fo(n),Ke=u?u.id:await pi(t,Z0,"getChainId")({});return await O.consume({address:Me.address,chainId:Ke,client:t})})();ug(e);const ne=(ae=(xe=u==null?void 0:u.formatters)==null?void 0:xe.transactionRequest)==null?void 0:ae.format,re=(ne||X0)({...mb(W,{format:ne}),account:n?Fo(n):void 0,accessList:s,authorizationList:l,blobs:r,blobVersionedHashes:p,data:v,gas:w,gasPrice:E,maxFeePerBlobGas:T,maxFeePerGas:k,maxPriorityFeePerGas:R,nonce:K,to:F,type:U,value:X},"fillTransaction");try{const Me=await t.request({method:"eth_fillTransaction",params:[re]}),ke=(((ye=(ce=u==null?void 0:u.formatters)==null?void 0:ce.transaction)==null?void 0:ye.format)||dA)(Me.tx);delete ke.blockHash,delete ke.blockNumber,delete ke.r,delete ke.s,delete ke.transactionIndex,delete ke.v,delete ke.yParity,ke.data=ke.input,ke.gas&&(ke.gas=e.gas??ke.gas),ke.gasPrice&&(ke.gasPrice=e.gasPrice??ke.gasPrice),ke.maxFeePerBlobGas&&(ke.maxFeePerBlobGas=e.maxFeePerBlobGas??ke.maxFeePerBlobGas),ke.maxFeePerGas&&(ke.maxFeePerGas=e.maxFeePerGas??ke.maxFeePerGas),ke.maxPriorityFeePerGas&&(ke.maxPriorityFeePerGas=e.maxPriorityFeePerGas??ke.maxPriorityFeePerGas),ke.nonce&&(ke.nonce=e.nonce??ke.nonce);const je=await(async()=>{var qe,Le;if(typeof((qe=u==null?void 0:u.fees)==null?void 0:qe.baseFeeMultiplier)=="function"){const st=await pi(t,cf,"getBlock")({});return u.fees.baseFeeMultiplier({block:st,client:t,request:e})}return((Le=u==null?void 0:u.fees)==null?void 0:Le.baseFeeMultiplier)??1.2})();if(je<1)throw new y7;const Ae=10**(((Ce=je.toString().split(".")[1])==null?void 0:Ce.length)??0),He=qe=>qe*BigInt(Math.ceil(je*Ae))/BigInt(Ae);return ke.maxFeePerGas&&!e.maxFeePerGas&&(ke.maxFeePerGas=He(ke.maxFeePerGas)),ke.gasPrice&&!e.gasPrice&&(ke.gasPrice=He(ke.gasPrice)),{raw:Me.raw,transaction:{from:re.from,...ke}}}catch(Me){throw hA(Me,{...e,chain:t.chain})}}const VP=["blobVersionedHashes","chainId","fees","gas","nonce","type"],RL=new Map,jC=new hb(128);async function c2(t,e){const{account:n=t.account,chain:s,nonceManager:l,parameters:u=VP}=e;let p;async function r(){return p||(s?s.id:typeof e.chainId<"u"?e.chainId:(p=await pi(t,Z0,"getChainId")({}),p))}const v=n&&Fo(n);let w=e.nonce;if(u.includes("nonce")&&typeof w>"u"&&v&&l){const W=await r();w=await l.consume({address:v.address,chainId:W,client:t})}const T=jC.get(t.uid)!==!1&&["fees","gas"].some(W=>{var K;return(K=e.parameters)==null?void 0:K.includes(W)})?await pi(t,UP,"fillTransaction")({...e,nonce:w}).then(W=>{const{chainId:K,from:ne,gas:te,gasPrice:re,nonce:xe,maxFeePerBlobGas:ae,maxFeePerGas:ce,maxPriorityFeePerGas:ye,type:Ce}=W.transaction;return jC.set(t.uid,!0),{...e,...K?{chainId:K}:{},...ne?{from:ne}:{},...te?{gas:te}:{},...re?{gasPrice:re}:{},...xe?{nonce:xe}:{},...ae?{maxFeePerBlobGas:ae}:{},...ce?{maxFeePerGas:ce}:{},...ye?{maxPriorityFeePerGas:ye}:{},...Ce?{type:Ce}:{}}}).catch(W=>(W.walk(te=>{const re=te;return re.name==="MethodNotFoundRpcError"||re.name==="MethodNotSupportedRpcError"})&&jC.set(t.uid,!1),e)):e,{blobs:k,gas:R,kzg:D,type:O}=T;w??(w=T.nonce);const F={...T,...v?{from:v==null?void 0:v.address}:{},...w?{nonce:w}:{}};let U;async function X(){return U||(U=await pi(t,cf,"getBlock")({blockTag:"latest"}),U)}if(u.includes("nonce")&&typeof w>"u"&&v&&!l&&(F.nonce=await pi(t,OP,"getTransactionCount")({address:v.address,blockTag:"pending"})),(u.includes("blobVersionedHashes")||u.includes("sidecars"))&&k&&D){const W=FP({blobs:k,kzg:D});if(u.includes("blobVersionedHashes")){const K=E7({commitments:W,to:"hex"});F.blobVersionedHashes=K}if(u.includes("sidecars")){const K=BP({blobs:k,commitments:W,kzg:D}),ne=I7({blobs:k,commitments:W,proofs:K,to:"hex"});F.sidecars=ne}}if(u.includes("chainId")&&(F.chainId=await r()),(u.includes("fees")||u.includes("type"))&&typeof O>"u")try{F.type=P7(F)}catch{let W=RL.get(t.uid);if(typeof W>"u"){const K=await X();W=typeof(K==null?void 0:K.baseFeePerGas)=="bigint",RL.set(t.uid,W)}F.type=W?"eip1559":"legacy"}if(u.includes("fees"))if(F.type!=="legacy"&&F.type!=="eip2930"){if(typeof F.maxFeePerGas>"u"||typeof F.maxPriorityFeePerGas>"u"){const W=await X(),{maxFeePerGas:K,maxPriorityFeePerGas:ne}=await X5(t,{block:W,chain:s,request:F});if(typeof F.maxPriorityFeePerGas>"u"&&F.maxFeePerGas&&F.maxFeePerGas<ne)throw new Ite({maxPriorityFeePerGas:ne});F.maxPriorityFeePerGas=ne,F.maxFeePerGas=K}}else{if(typeof F.maxFeePerGas<"u"||typeof F.maxPriorityFeePerGas<"u")throw new jP;if(typeof F.gasPrice>"u"){const W=await X(),{gasPrice:K}=await X5(t,{block:W,chain:s,request:F,type:"legacy"});F.gasPrice=K}}return u.includes("gas")&&typeof R>"u"&&(F.gas=await pi(t,HP,"estimateGas")({...F,account:v,prepare:(v==null?void 0:v.type)==="local"?[]:["blobVersionedHashes"]})),ug(F),delete F.parameters,F}async function HP(t,e){var p,r,v;const{account:n=t.account,prepare:s=!0}=e,l=n?Fo(n):void 0,u=(()=>{if(Array.isArray(s))return s;if((l==null?void 0:l.type)!=="local")return["blobVersionedHashes"]})();try{const{accessList:w,authorizationList:E,blobs:T,blobVersionedHashes:k,blockNumber:R,blockTag:D,data:O,gas:F,gasPrice:U,maxFeePerBlobGas:X,maxFeePerGas:W,maxPriorityFeePerGas:K,nonce:ne,value:te,stateOverride:re,...xe}=s?await c2(t,{...e,parameters:u}):e,ce=(typeof R=="bigint"?lr(R):void 0)||D,ye=PP(re),Ce=await(async()=>{if(xe.to)return xe.to;if(E&&E.length>0)return await uA({authorization:E[0]}).catch(()=>{throw new Wn("`to` is required. Could not infer from `authorizationList`")})})();ug(e);const Me=(v=(r=(p=t.chain)==null?void 0:p.formatters)==null?void 0:r.transactionRequest)==null?void 0:v.format,ke=(Me||X0)({...mb(xe,{format:Me}),account:l,accessList:w,authorizationList:E,blobs:T,blobVersionedHashes:k,data:O,gas:F,gasPrice:U,maxFeePerBlobGas:X,maxFeePerGas:W,maxPriorityFeePerGas:K,nonce:ne,to:Ce,value:te},"estimateGas");return BigInt(await t.request({method:"eth_estimateGas",params:ye?[ke,ce??t.experimental_blockTag??"latest",ye]:ce?[ke,ce]:[ke]}))}catch(w){throw kte(w,{...e,account:l,chain:t.chain})}}async function Zte(t,e){const{abi:n,address:s,args:l,functionName:u,dataSuffix:p,...r}=e,v=gd({abi:n,args:l,functionName:u});try{return await pi(t,HP,"estimateGas")({data:`${v}${p?p.replace("0x",""):""}`,to:s,...r})}catch(w){const E=r.account?Fo(r.account):void 0;throw Px(w,{abi:n,address:s,args:l,docsPath:"/docs/contract/estimateContractGas",functionName:u,sender:E==null?void 0:E.address})}}async function R7(t,{address:e,blockNumber:n,blockTag:s=t.experimental_blockTag??"latest"}){const l=typeof n=="bigint"?lr(n):void 0,u=await t.request({method:"eth_getBalance",params:[e,l||s]});return BigInt(u)}async function Qte(t){const e=await t.request({method:"eth_blobBaseFee"});return BigInt(e)}const Kte=new Map,Yte=new Map;function Jte(t){const e=(l,u)=>({clear:()=>u.delete(l),get:()=>u.get(l),set:p=>u.set(l,p)}),n=e(t,Kte),s=e(t,Yte);return{clear:()=>{n.clear(),s.clear()},promise:n,response:s}}async function ene(t,{cacheKey:e,cacheTime:n=Number.POSITIVE_INFINITY}){const s=Jte(e),l=s.response.get();if(l&&n>0&&Date.now()-l.created.getTime()<n)return l.data;let u=s.promise.get();u||(u=t(),s.promise.set(u));try{const p=await u;return s.response.set({created:new Date,data:p}),p}finally{s.promise.clear()}}const tne=t=>`blockNumber.${t}`;async function u2(t,{cacheTime:e=t.cacheTime}={}){const n=await ene(()=>t.request({method:"eth_blockNumber"}),{cacheKey:tne(t.uid),cacheTime:e});return BigInt(n)}async function nne(t,{blockHash:e,blockNumber:n,blockTag:s="latest"}={}){const l=n!==void 0?lr(n):void 0;let u;return e?u=await t.request({method:"eth_getBlockTransactionCountByHash",params:[e]},{dedupe:!0}):u=await t.request({method:"eth_getBlockTransactionCountByNumber",params:[l||s]},{dedupe:!!l}),hd(u)}async function Z5(t,{address:e,blockNumber:n,blockTag:s="latest"}){const l=n!==void 0?lr(n):void 0,u=await t.request({method:"eth_getCode",params:[e,l||s]},{dedupe:!!l});if(u!=="0x")return u}function d2(t,e){if(!Oa(t,{strict:!1}))throw new Wc({address:t});if(!Oa(e,{strict:!1}))throw new Wc({address:e});return t.toLowerCase()===e.toLowerCase()}const NL="/docs/contract/decodeEventLog";function GP(t){const{abi:e,data:n,strict:s,topics:l}=t,u=s??!0,[p,...r]=l;if(!p)throw new OK({docsPath:NL});const v=e.find(O=>O.type==="event"&&p===YE(df(O)));if(!(v&&"name"in v)||v.type!=="event")throw new Q8(p,{docsPath:NL});const{name:w,inputs:E}=v,T=E==null?void 0:E.some(O=>!("name"in O&&O.name)),k=T?[]:{},R=E.map((O,F)=>[O,F]).filter(([O])=>"indexed"in O&&O.indexed);for(let O=0;O<R.length;O++){const[F,U]=R[O],X=r[O];if(!X)throw new XE({abiItem:v,param:F});k[T?U:F.name||U]=rne({param:F,value:X})}const D=E.filter(O=>!("indexed"in O&&O.indexed));if(D.length>0){if(n&&n!=="0x")try{const O=e2(D,n);if(O)if(T)for(let F=0;F<E.length;F++)k[F]=k[F]??O.shift();else for(let F=0;F<D.length;F++)k[D[F].name]=O[F]}catch(O){if(u)throw O instanceof X8||O instanceof uU?new Y1({abiItem:v,data:n,params:D,size:Yo(n)}):O}else if(u)throw new Y1({abiItem:v,data:"0x",params:D,size:0})}return{eventName:w,args:Object.values(k).length>0?k:void 0}}function rne({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(e2([t],e)||[])[0]}function $P(t){const{abi:e,args:n,logs:s,strict:l=!0}=t,u=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return s.map(p=>{var r;try{const v=e.find(E=>E.type==="event"&&p.topics[0]===YE(E));if(!v)return null;const w=GP({...p,abi:[v],strict:l});return u&&!u.includes(w.eventName)||!ine({args:w.args,inputs:v.inputs,matchArgs:n})?null:{...w,...p}}catch(v){let w,E;if(v instanceof Q8)return null;if(v instanceof Y1||v instanceof XE){if(l)return null;w=v.abiItem.name,E=(r=v.abiItem.inputs)==null?void 0:r.some(T=>!("name"in T&&T.name))}return{...p,args:E?[]:{},eventName:w}}}).filter(Boolean)}function ine(t){const{args:e,inputs:n,matchArgs:s}=t;if(!s)return!0;if(!e)return!1;function l(u,p,r){try{return u.type==="address"?d2(p,r):u.type==="string"||u.type==="bytes"?bl(db(p))===r:p===r}catch{return!1}}return Array.isArray(e)&&Array.isArray(s)?s.every((u,p)=>{if(u==null)return!0;const r=n[p];return r?(Array.isArray(u)?u:[u]).some(w=>l(r,w,e[p])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof s=="object"&&!Array.isArray(s)?Object.entries(s).every(([u,p])=>{if(p==null)return!0;const r=n.find(w=>w.name===u);return r?(Array.isArray(p)?p:[p]).some(w=>l(r,w,e[u])):!1}):!1}function tg(t,{args:e,eventName:n}={}){return{...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,logIndex:t.logIndex?Number(t.logIndex):null,transactionHash:t.transactionHash?t.transactionHash:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,...n?{args:e,eventName:n}:{}}}async function WP(t,{address:e,blockHash:n,fromBlock:s,toBlock:l,event:u,events:p,args:r,strict:v}={}){const w=v??!1,E=p??(u?[u]:void 0);let T=[];E&&(T=[E.flatMap(O=>l2({abi:[O],eventName:O.name,args:p?void 0:r}))],u&&(T=T[0]));let k;n?k=await t.request({method:"eth_getLogs",params:[{address:e,topics:T,blockHash:n}]}):k=await t.request({method:"eth_getLogs",params:[{address:e,topics:T,fromBlock:typeof s=="bigint"?lr(s):s,toBlock:typeof l=="bigint"?lr(l):l}]});const R=k.map(D=>tg(D));return E?$P({abi:E,args:r,logs:R,strict:w}):R}async function N7(t,e){const{abi:n,address:s,args:l,blockHash:u,eventName:p,fromBlock:r,toBlock:v,strict:w}=e,E=p?Xx({abi:n,name:p}):void 0,T=E?void 0:n.filter(k=>k.type==="event");return pi(t,WP,"getLogs")({address:s,args:l,blockHash:u,event:E,events:T,fromBlock:r,toBlock:v,strict:w})}class sne extends Wn{constructor({address:e}){super(`No EIP-712 domain found on contract "${e}".`,{metaMessages:["Ensure that:",`- The contract is deployed at the address "${e}".`,"- `eip712Domain()` function exists on the contract.","- `eip712Domain()` function matches signature to ERC-5267 specification."],name:"Eip712DomainNotFoundError"})}}async function one(t,e){const{address:n,factory:s,factoryData:l}=e;try{const[u,p,r,v,w,E,T]=await pi(t,ah,"readContract")({abi:ane,address:n,functionName:"eip712Domain",factory:s,factoryData:l});return{domain:{name:p,version:r,chainId:Number(v),verifyingContract:w,salt:E},extensions:T,fields:u}}catch(u){const p=u;throw p.name==="ContractFunctionExecutionError"&&p.cause.name==="ContractFunctionZeroDataError"?new sne({address:n}):p}}const ane=[{inputs:[],name:"eip712Domain",outputs:[{name:"fields",type:"bytes1"},{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"},{name:"salt",type:"bytes32"},{name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"}];function lne(t){var e;return{baseFeePerGas:t.baseFeePerGas.map(n=>BigInt(n)),gasUsedRatio:t.gasUsedRatio,oldestBlock:BigInt(t.oldestBlock),reward:(e=t.reward)==null?void 0:e.map(n=>n.map(s=>BigInt(s)))}}async function cne(t,{blockCount:e,blockNumber:n,blockTag:s="latest",rewardPercentiles:l}){const u=typeof n=="bigint"?lr(n):void 0,p=await t.request({method:"eth_feeHistory",params:[lr(e),u||s,l]},{dedupe:!!u});return lne(p)}async function fA(t,{filter:e}){const n="strict"in e&&e.strict,s=await e.request({method:"eth_getFilterChanges",params:[e.id]});if(typeof s[0]=="string")return s;const l=s.map(u=>tg(u));return!("abi"in e)||!e.abi?l:$P({abi:e.abi,logs:l,strict:n})}async function une(t,{filter:e}){const n=e.strict??!1,l=(await e.request({method:"eth_getFilterLogs",params:[e.id]})).map(u=>tg(u));return e.abi?$P({abi:e.abi,logs:l,strict:n}):l}function dne(t){const{authorizationList:e}=t;if(e)for(const n of e){const{chainId:s}=n,l=n.address;if(!Oa(l))throw new Wc({address:l});if(s<0)throw new JE({chainId:s})}qP(t)}function hne(t){const{blobVersionedHashes:e}=t;if(e){if(e.length===0)throw new k7;for(const n of e){const s=Yo(n),l=hd(kx(n,0,1));if(s!==32)throw new Wte({hash:n,size:s});if(l!==M7)throw new qte({hash:n,version:l})}}qP(t)}function qP(t){const{chainId:e,maxPriorityFeePerGas:n,maxFeePerGas:s,to:l}=t;if(e<=0)throw new JE({chainId:e});if(l&&!Oa(l))throw new Wc({address:l});if(s&&s>aA)throw new jx({maxFeePerGas:s});if(n&&s&&n>s)throw new _w({maxFeePerGas:s,maxPriorityFeePerGas:n})}function fne(t){const{chainId:e,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:l,to:u}=t;if(e<=0)throw new JE({chainId:e});if(u&&!Oa(u))throw new Wc({address:u});if(n||l)throw new Wn("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(s&&s>aA)throw new jx({maxFeePerGas:s})}function pne(t){const{chainId:e,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:l,to:u}=t;if(u&&!Oa(u))throw new Wc({address:u});if(typeof e<"u"&&e<=0)throw new JE({chainId:e});if(n||l)throw new Wn("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(s&&s>aA)throw new jx({maxFeePerGas:s})}function pA(t){if(!t||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){const{address:s,storageKeys:l}=t[n];for(let u=0;u<l.length;u++)if(l[u].length-2!==64)throw new iee({storageKey:l[u]});if(!Oa(s,{strict:!1}))throw new Wc({address:s});e.push([s,l])}return e}function mne(t,e){const n=P7(t);return n==="eip1559"?xne(t,e):n==="eip2930"?_ne(t,e):n==="eip4844"?yne(t,e):n==="eip7702"?gne(t,e):vne(t,e)}function gne(t,e){const{authorizationList:n,chainId:s,gas:l,nonce:u,to:p,value:r,maxFeePerGas:v,maxPriorityFeePerGas:w,accessList:E,data:T}=t;dne(t);const k=pA(E),R=bne(n);return Tp(["0x04",Dx([lr(s),u?lr(u):"0x",w?lr(w):"0x",v?lr(v):"0x",l?lr(l):"0x",p??"0x",r?lr(r):"0x",T??"0x",k,R,...h2(t,e)])])}function yne(t,e){const{chainId:n,gas:s,nonce:l,to:u,value:p,maxFeePerBlobGas:r,maxFeePerGas:v,maxPriorityFeePerGas:w,accessList:E,data:T}=t;hne(t);let k=t.blobVersionedHashes,R=t.sidecars;if(t.blobs&&(typeof k>"u"||typeof R>"u")){const W=typeof t.blobs[0]=="string"?t.blobs:t.blobs.map(te=>La(te)),K=t.kzg,ne=FP({blobs:W,kzg:K});if(typeof k>"u"&&(k=E7({commitments:ne})),typeof R>"u"){const te=BP({blobs:W,commitments:ne,kzg:K});R=I7({blobs:W,commitments:ne,proofs:te})}}const D=pA(E),O=[lr(n),l?lr(l):"0x",w?lr(w):"0x",v?lr(v):"0x",s?lr(s):"0x",u??"0x",p?lr(p):"0x",T??"0x",D,r?lr(r):"0x",k??[],...h2(t,e)],F=[],U=[],X=[];if(R)for(let W=0;W<R.length;W++){const{blob:K,commitment:ne,proof:te}=R[W];F.push(K),U.push(ne),X.push(te)}return Tp(["0x03",Dx(R?[O,F,U,X]:O)])}function xne(t,e){const{chainId:n,gas:s,nonce:l,to:u,value:p,maxFeePerGas:r,maxPriorityFeePerGas:v,accessList:w,data:E}=t;qP(t);const T=pA(w),k=[lr(n),l?lr(l):"0x",v?lr(v):"0x",r?lr(r):"0x",s?lr(s):"0x",u??"0x",p?lr(p):"0x",E??"0x",T,...h2(t,e)];return Tp(["0x02",Dx(k)])}function _ne(t,e){const{chainId:n,gas:s,data:l,nonce:u,to:p,value:r,accessList:v,gasPrice:w}=t;fne(t);const E=pA(v),T=[lr(n),u?lr(u):"0x",w?lr(w):"0x",s?lr(s):"0x",p??"0x",r?lr(r):"0x",l??"0x",E,...h2(t,e)];return Tp(["0x01",Dx(T)])}function vne(t,e){const{chainId:n=0,gas:s,data:l,nonce:u,to:p,value:r,gasPrice:v}=t;pne(t);let w=[u?lr(u):"0x",v?lr(v):"0x",s?lr(s):"0x",p??"0x",r?lr(r):"0x",l??"0x"];if(e){const E=(()=>{if(e.v>=35n)return(e.v-35n)/2n>0?e.v:27n+(e.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+e.v-27n);const R=27n+(e.v===27n?0n:1n);if(e.v!==R)throw new nee({v:e.v});return R})(),T=vu(e.r),k=vu(e.s);w=[...w,lr(E),T==="0x00"?"0x":T,k==="0x00"?"0x":k]}else n>0&&(w=[...w,lr(n),"0x","0x"]);return Dx(w)}function h2(t,e){const n=e??t,{v:s,yParity:l}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof s>"u"&&typeof l>"u")return[];const u=vu(n.r),p=vu(n.s);return[typeof l=="number"?l?lr(1):"0x":s===0n?"0x":s===1n?lr(1):s===27n?"0x":lr(1),u==="0x00"?"0x":u,p==="0x00"?"0x":p]}function bne(t){if(!t||t.length===0)return[];const e=[];for(const n of t){const{chainId:s,nonce:l,...u}=n,p=n.address;e.push([s?ih(s):"0x",p,l?ih(l):"0x",...h2({},u)])}return e}async function wne({address:t,authorization:e,signature:n}){return d2(wl(t),await uA({authorization:e,signature:n}))}const NS=new hb(8192);function Sne(t,{enabled:e=!0,id:n}){if(!e||!n)return t();if(NS.get(n))return NS.get(n);const s=t().finally(()=>NS.delete(n));return NS.set(n,s),s}async function Q5(t){return new Promise(e=>setTimeout(e,t))}function Lx(t,{delay:e=100,retryCount:n=2,shouldRetry:s=()=>!0}={}){return new Promise((l,u)=>{const p=async({count:r=0}={})=>{const v=async({error:w})=>{const E=typeof e=="function"?e({count:r,error:w}):e;E&&await Q5(E),p({count:r+1})};try{const w=await t();l(w)}catch(w){if(r<n&&await s({count:r,error:w}))return v({error:w});u(w)}};p()})}function Tne(t,e={}){return async(n,s={})=>{var T;const{dedupe:l=!1,methods:u,retryDelay:p=150,retryCount:r=3,uid:v}={...e,...s},{method:w}=n;if((T=u==null?void 0:u.exclude)!=null&&T.includes(w))throw new rx(new Error("method not supported"),{method:w});if(u!=null&&u.include&&!u.include.includes(w))throw new rx(new Error("method not supported"),{method:w});const E=l?Wv(`${v}.${Ka(n)}`):void 0;return Sne(()=>Lx(async()=>{try{return await t(n)}catch(k){const R=k;switch(R.code){case tw.code:throw new tw(R);case nw.code:throw new nw(R);case rw.code:throw new rw(R,{method:n.method});case iw.code:throw new iw(R);case Ix.code:throw new Ix(R);case U0.code:throw new U0(R);case sw.code:throw new sw(R);case yp.code:throw new yp(R);case ow.code:throw new ow(R);case rx.code:throw new rx(R,{method:n.method});case Xv.code:throw new Xv(R);case aw.code:throw new aw(R);case ao.code:throw new ao(R);case lw.code:throw new lw(R);case cw.code:throw new cw(R);case uw.code:throw new uw(R);case dw.code:throw new dw(R);case ld.code:throw new ld(R);case Zv.code:throw new Zv(R);case hw.code:throw new hw(R);case fw.code:throw new fw(R);case pw.code:throw new pw(R);case mw.code:throw new mw(R);case gw.code:throw new gw(R);case Qv.code:throw new Qv(R);case 5e3:throw new ao(R);default:throw k instanceof Wn?k:new yee(R)}}},{delay:({count:k,error:R})=>{var D;if(R&&R instanceof V1){const O=(D=R==null?void 0:R.headers)==null?void 0:D.get("Retry-After");if(O!=null&&O.match(/\d/))return Number.parseInt(O,10)*1e3}return~~(1<<k)*p},retryCount:r,shouldRetry:({error:k})=>Ene(k)}),{enabled:l,id:E})}}function Ene(t){return"code"in t&&typeof t.code=="number"?t.code===-1||t.code===Xv.code||t.code===Ix.code:t instanceof V1&&t.status?t.status===403||t.status===408||t.status===413||t.status===429||t.status===500||t.status===502||t.status===503||t.status===504:!0}function XP({chain:t,currentChainId:e}){if(!t)throw new WJ;if(e!==t.id)throw new $J({chain:t,currentChainId:e})}function j7(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}const D7={"0x0":"reverted","0x1":"success"};function ZP(t,e){const n={...t,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs?t.logs.map(s=>tg(s)):null,to:t.to?t.to:null,transactionIndex:t.transactionIndex?hd(t.transactionIndex):null,status:t.status?D7[t.status]:null,type:t.type?_7[t.type]||t.type:null};return t.blobGasPrice&&(n.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(n.blobGasUsed=BigInt(t.blobGasUsed)),n}const x3e=kP("transactionReceipt",ZP);function mA(t,{errorInstance:e=new Error("timed out"),timeout:n,signal:s}){return new Promise((l,u)=>{(async()=>{let p;try{const r=new AbortController;n>0&&(p=setTimeout(()=>{s?r.abort():u(e)},n)),l(await t({signal:(r==null?void 0:r.signal)||null}))}catch(r){(r==null?void 0:r.name)==="AbortError"&&u(e),u(r)}finally{clearTimeout(p)}})()})}function Ane(){return{current:0,take(){return this.current++},reset(){this.current=0}}}const jL=Ane();function Cne(t,e={}){return{async request(n){var k;const{body:s,fetchFn:l=e.fetchFn??fetch,onRequest:u=e.onRequest,onResponse:p=e.onResponse,timeout:r=e.timeout??1e4}=n,v={...e.fetchOptions??{},...n.fetchOptions??{}},{headers:w,method:E,signal:T}=v;try{const R=await mA(async({signal:O})=>{const F={...v,body:Array.isArray(s)?Ka(s.map(K=>({jsonrpc:"2.0",id:K.id??jL.take(),...K}))):Ka({jsonrpc:"2.0",id:s.id??jL.take(),...s}),headers:{"Content-Type":"application/json",...w},method:E||"POST",signal:T||(r>0?O:null)},U=new Request(t,F),X=await(u==null?void 0:u(U,F))??{...F,url:t};return await l(X.url??t,X)},{errorInstance:new yL({body:s,url:t}),timeout:r,signal:!0});p&&await p(R);let D;if((k=R.headers.get("Content-Type"))!=null&&k.startsWith("application/json"))D=await R.json();else{D=await R.text();try{D=JSON.parse(D||"{}")}catch(O){if(R.ok)throw O;D={error:D}}}if(!R.ok)throw new V1({body:s,details:Ka(D.error)||R.statusText,headers:R.headers,status:R.status,url:t});return D}catch(R){throw R instanceof V1||R instanceof yL?R:new V1({body:s,cause:R,url:t})}}}}const Mne=`Ethereum Signed Message:
`;function kne(t){const e=typeof t=="string"?Wv(t):typeof t.raw=="string"?t.raw:La(t.raw),n=Wv(`${Mne}${Yo(e)}`);return oh([n,e])}function QP(t,e){return bl(kne(t),e)}class Ine extends Wn{constructor({domain:e}){super(`Invalid domain "${Ka(e)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class Pne extends Wn{constructor({primaryType:e,types:n}){super(`Invalid primary type \`${e}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class Rne extends Wn{constructor({type:e}){super(`Struct type "${e}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function Nne(t){const{domain:e,message:n,primaryType:s,types:l}=t,u=(v,w)=>{const E={...w};for(const T of v){const{name:k,type:R}=T;R==="address"&&(E[k]=E[k].toLowerCase())}return E},p=l.EIP712Domain?e?u(l.EIP712Domain,e):{}:{},r=(()=>{if(s!=="EIP712Domain")return u(l[s],n)})();return Ka({domain:p,message:r,primaryType:s,types:l})}function L7(t){const{domain:e,message:n,primaryType:s,types:l}=t,u=(p,r)=>{for(const v of p){const{name:w,type:E}=v,T=r[w],k=E.match(pU);if(k&&(typeof T=="number"||typeof T=="bigint")){const[O,F,U]=k;lr(T,{signed:F==="int",size:Number.parseInt(U,10)/8})}if(E==="address"&&typeof T=="string"&&!Oa(T))throw new Wc({address:T});const R=E.match(OY);if(R){const[O,F]=R;if(F&&Yo(T)!==Number.parseInt(F,10))throw new zK({expectedSize:Number.parseInt(F,10),givenSize:Yo(T)})}const D=l[E];D&&(jne(E),u(D,T))}};if(l.EIP712Domain&&e){if(typeof e!="object")throw new Ine({domain:e});u(l.EIP712Domain,e)}if(s!=="EIP712Domain")if(l[s])u(l[s],n);else throw new Pne({primaryType:s,types:l})}function O7({domain:t}){return[typeof(t==null?void 0:t.name)=="string"&&{name:"name",type:"string"},(t==null?void 0:t.version)&&{name:"version",type:"string"},(typeof(t==null?void 0:t.chainId)=="number"||typeof(t==null?void 0:t.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(t==null?void 0:t.verifyingContract)&&{name:"verifyingContract",type:"address"},(t==null?void 0:t.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function jne(t){if(t==="address"||t==="bool"||t==="string"||t.startsWith("bytes")||t.startsWith("uint")||t.startsWith("int"))throw new Rne({type:t})}function F7(t){const{domain:e={},message:n,primaryType:s}=t,l={EIP712Domain:O7({domain:e}),...t.types};L7({domain:e,message:n,primaryType:s,types:l});const u=["0x1901"];return e&&u.push(Dne({domain:e,types:l})),s!=="EIP712Domain"&&u.push(B7({data:n,primaryType:s,types:l})),bl(oh(u))}function Dne({domain:t,types:e}){return B7({data:t,primaryType:"EIP712Domain",types:e})}function B7({data:t,primaryType:e,types:n}){const s=z7({data:t,primaryType:e,types:n});return bl(s)}function z7({data:t,primaryType:e,types:n}){const s=[{type:"bytes32"}],l=[Lne({primaryType:e,types:n})];for(const u of n[e]){const[p,r]=V7({types:n,name:u.name,type:u.type,value:t[u.name]});s.push(p),l.push(r)}return qx(s,l)}function Lne({primaryType:t,types:e}){const n=ih(One({primaryType:t,types:e}));return bl(n)}function One({primaryType:t,types:e}){let n="";const s=U7({primaryType:t,types:e});s.delete(t);const l=[t,...Array.from(s).sort()];for(const u of l)n+=`${u}(${e[u].map(({name:p,type:r})=>`${r} ${p}`).join(",")})`;return n}function U7({primaryType:t,types:e},n=new Set){const s=t.match(/^\w*/u),l=s==null?void 0:s[0];if(n.has(l)||e[l]===void 0)return n;n.add(l);for(const u of e[l])U7({primaryType:u.type,types:e},n);return n}function V7({types:t,name:e,type:n,value:s}){if(t[n]!==void 0)return[{type:"bytes32"},bl(z7({data:s,primaryType:n,types:t}))];if(n==="bytes")return[{type:"bytes32"},bl(s)];if(n==="string")return[{type:"bytes32"},bl(ih(s))];if(n.lastIndexOf("]")===n.length-1){const l=n.slice(0,n.lastIndexOf("[")),u=s.map(p=>V7({name:e,type:l,types:t,value:p}));return[{type:"bytes32"},bl(qx(u.map(([p])=>p),u.map(([,p])=>p)))]}return[{type:n},s]}class Fne extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const Bne={checksum:new Fne(8192)},DC=Bne.checksum;function H7(t,e={}){const{as:n=typeof t=="string"?"Hex":"Bytes"}=e,s=cU(Nee(t));return n==="Bytes"?s:pf(s)}const zne=/^0x[a-fA-F0-9]{40}$/;function gA(t,e={}){const{strict:n=!0}=e;if(!zne.test(t))throw new DL({address:t,cause:new Une});if(n){if(t.toLowerCase()===t)return;if(G7(t)!==t)throw new DL({address:t,cause:new Vne})}}function G7(t){if(DC.has(t))return DC.get(t);gA(t,{strict:!1});const e=t.substring(2).toLowerCase(),n=H7(Dee(e),{as:"Bytes"}),s=e.split("");for(let u=0;u<40;u+=2)n[u>>1]>>4>=8&&s[u]&&(s[u]=s[u].toUpperCase()),(n[u>>1]&15)>=8&&s[u+1]&&(s[u+1]=s[u+1].toUpperCase());const l=`0x${s.join("")}`;return DC.set(t,l),l}function K5(t,e={}){const{strict:n=!0}=e??{};try{return gA(t,{strict:n}),!0}catch{return!1}}class DL extends Vs{constructor({address:e,cause:n}){super(`Address "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Une extends Vs{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Vne extends Vs{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Hne=/^(.*)\[([0-9]*)\]$/,Gne=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,$7=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,LL=2n**256n-1n;function Ev(t,e,n){const{checksumAddress:s,staticPosition:l}=n,u=JP(e.type);if(u){const[p,r]=u;return Wne(t,{...e,type:r},{checksumAddress:s,length:p,staticPosition:l})}if(e.type==="tuple")return Qne(t,e,{checksumAddress:s,staticPosition:l});if(e.type==="address")return $ne(t,{checksum:s});if(e.type==="bool")return qne(t);if(e.type.startsWith("bytes"))return Xne(t,e,{staticPosition:l});if(e.type.startsWith("uint")||e.type.startsWith("int"))return Zne(t,e);if(e.type==="string")return Kne(t,{staticPosition:l});throw new tR(e.type)}const OL=32,Y5=32;function $ne(t,e={}){const{checksum:n=!1}=e,s=t.readBytes(32);return[(u=>n?G7(u):u)(pf(Oee(s,-20))),32]}function Wne(t,e,n){const{checksumAddress:s,length:l,staticPosition:u}=n;if(!l){const v=$m(t.readBytes(Y5)),w=u+v,E=w+OL;t.setPosition(w);const T=$m(t.readBytes(OL)),k=vw(e);let R=0;const D=[];for(let O=0;O<T;++O){t.setPosition(E+(k?O*32:R));const[F,U]=Ev(t,e,{checksumAddress:s,staticPosition:E});R+=U,D.push(F)}return t.setPosition(u+32),[D,32]}if(vw(e)){const v=$m(t.readBytes(Y5)),w=u+v,E=[];for(let T=0;T<l;++T){t.setPosition(w+T*32);const[k]=Ev(t,e,{checksumAddress:s,staticPosition:w});E.push(k)}return t.setPosition(u+32),[E,32]}let p=0;const r=[];for(let v=0;v<l;++v){const[w,E]=Ev(t,e,{checksumAddress:s,staticPosition:u+p});p+=E,r.push(w)}return[r,p]}function qne(t){return[Bee(t.readBytes(32),{size:32}),32]}function Xne(t,e,{staticPosition:n}){const[s,l]=e.type.split("bytes");if(!l){const p=$m(t.readBytes(32));t.setPosition(n+p);const r=$m(t.readBytes(32));if(r===0)return t.setPosition(n+32),["0x",32];const v=t.readBytes(r);return t.setPosition(n+32),[pf(v),32]}return[pf(t.readBytes(Number.parseInt(l,10),32)),32]}function Zne(t,e){const n=e.type.startsWith("int"),s=Number.parseInt(e.type.split("int")[1]||"256",10),l=t.readBytes(32);return[s>48?Fee(l,{signed:n}):$m(l,{signed:n}),32]}function Qne(t,e,n){const{checksumAddress:s,staticPosition:l}=n,u=e.components.length===0||e.components.some(({name:v})=>!v),p=u?[]:{};let r=0;if(vw(e)){const v=$m(t.readBytes(Y5)),w=l+v;for(let E=0;E<e.components.length;++E){const T=e.components[E];t.setPosition(w+r);const[k,R]=Ev(t,T,{checksumAddress:s,staticPosition:w});r+=R,p[u?E:T==null?void 0:T.name]=k}return t.setPosition(l+32),[p,32]}for(let v=0;v<e.components.length;++v){const w=e.components[v],[E,T]=Ev(t,w,{checksumAddress:s,staticPosition:l});p[u?v:w==null?void 0:w.name]=E,r+=T}return[p,r]}function Kne(t,{staticPosition:e}){const n=$m(t.readBytes(32)),s=e+n;t.setPosition(s);const l=$m(t.readBytes(32));if(l===0)return t.setPosition(e+32),["",32];const u=t.readBytes(l,32),p=zee(WU(u));return t.setPosition(e+32),[p,32]}function Yne({checksumAddress:t,parameters:e,values:n}){const s=[];for(let l=0;l<e.length;l++)s.push(KP({checksumAddress:t,parameter:e[l],value:n[l]}));return s}function KP({checksumAddress:t=!1,parameter:e,value:n}){const s=e,l=JP(s.type);if(l){const[u,p]=l;return ere(n,{checksumAddress:t,length:u,parameter:{...s,type:p}})}if(s.type==="tuple")return sre(n,{checksumAddress:t,parameter:s});if(s.type==="address")return Jne(n,{checksum:t});if(s.type==="bool")return nre(n);if(s.type.startsWith("uint")||s.type.startsWith("int")){const u=s.type.startsWith("int"),[,,p="256"]=$7.exec(s.type)??[];return rre(n,{signed:u,size:Number(p)})}if(s.type.startsWith("bytes"))return tre(n,{type:s.type});if(s.type==="string")return ire(n);throw new tR(s.type)}function YP(t){let e=0;for(let u=0;u<t.length;u++){const{dynamic:p,encoded:r}=t[u];p?e+=32:e+=fd(r)}const n=[],s=[];let l=0;for(let u=0;u<t.length;u++){const{dynamic:p,encoded:r}=t[u];p?(n.push(Uc(e+l,{size:32})),s.push(r),l+=fd(r)):n.push(r)}return ff(...n,...s)}function Jne(t,e){const{checksum:n=!1}=e;return gA(t,{strict:n}),{dynamic:!1,encoded:Rx(t.toLowerCase())}}function ere(t,e){const{checksumAddress:n,length:s,parameter:l}=e,u=s===null;if(!Array.isArray(t))throw new pre(t);if(!u&&t.length!==s)throw new fre({expectedLength:s,givenLength:t.length,type:`${l.type}[${s}]`});let p=!1;const r=[];for(let v=0;v<t.length;v++){const w=KP({checksumAddress:n,parameter:l,value:t[v]});w.dynamic&&(p=!0),r.push(w)}if(u||p){const v=YP(r);if(u){const w=Uc(r.length,{size:32});return{dynamic:!0,encoded:r.length>0?ff(w,v):w}}if(p)return{dynamic:!0,encoded:v}}return{dynamic:!1,encoded:ff(...r.map(({encoded:v})=>v))}}function tre(t,{type:e}){const[,n]=e.split("bytes"),s=fd(t);if(!n){let l=t;return s%32!==0&&(l=Nx(l,Math.ceil((t.length-2)/2/32)*32)),{dynamic:!0,encoded:ff(Rx(Uc(s,{size:32})),l)}}if(s!==Number.parseInt(n,10))throw new q7({expectedSize:Number.parseInt(n,10),value:t});return{dynamic:!1,encoded:Nx(t)}}function nre(t){if(typeof t!="boolean")throw new Vs(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Rx(qU(t))}}function rre(t,{signed:e,size:n}){if(typeof n=="number"){const s=2n**(BigInt(n)-(e?1n:0n))-1n,l=e?-s-1n:0n;if(t>s||t<l)throw new QU({max:s.toString(),min:l.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:Uc(t,{size:32,signed:e})}}function ire(t){const e=CP(t),n=Math.ceil(fd(e)/32),s=[];for(let l=0;l<n;l++)s.push(Nx(xp(e,l*32,(l+1)*32)));return{dynamic:!0,encoded:ff(Nx(Uc(fd(e),{size:32})),...s)}}function sre(t,e){const{checksumAddress:n,parameter:s}=e;let l=!1;const u=[];for(let p=0;p<s.components.length;p++){const r=s.components[p],v=Array.isArray(t)?p:r.name,w=KP({checksumAddress:n,parameter:r,value:t[v]});u.push(w),w.dynamic&&(l=!0)}return{dynamic:l,encoded:l?YP(u):ff(...u.map(({encoded:p})=>p))}}function JP(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}function vw(t){var s;const{type:e}=t;if(e==="string"||e==="bytes"||e.endsWith("[]"))return!0;if(e==="tuple")return(s=t.components)==null?void 0:s.some(vw);const n=JP(t.type);return!!(n&&vw({...t,type:n[1]}))}const ore={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new cre({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new lre({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new FL({offset:t});const e=this.position-t;this.assertPosition(e),this.position=e},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new FL({offset:t});const e=this.position+t;this.assertPosition(e),this.position=e},inspectByte(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectBytes(t,e){const n=e??this.position;return this.assertPosition(n+t-1),this.bytes.subarray(n,n+t)},inspectUint8(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectUint16(t){const e=t??this.position;return this.assertPosition(e+1),this.dataView.getUint16(e)},inspectUint24(t){const e=t??this.position;return this.assertPosition(e+2),(this.dataView.getUint16(e)<<8)+this.dataView.getUint8(e+2)},inspectUint32(t){const e=t??this.position;return this.assertPosition(e+3),this.dataView.getUint32(e)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,t&255),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,e){this.assertReadLimit(),this._touch();const n=this.inspectBytes(t);return this.position+=e??t,n},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const e=this.position;return this.assertPosition(t),this.position=t,()=>this.position=e},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function are(t,{recursiveReadLimit:e=8192}={}){const n=Object.create(ore);return n.bytes=t,n.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),n.positionReadCount=new Map,n.recursiveReadLimit=e,n}class FL extends Vs{constructor({offset:e}){super(`Offset \`${e}\` cannot be negative.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.NegativeOffsetError"})}}class lre extends Vs{constructor({length:e,position:n}){super(`Position \`${n}\` is out of bounds (\`0 < position < ${e}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.PositionOutOfBoundsError"})}}class cre extends Vs{constructor({count:e,limit:n}){super(`Recursive read limit of \`${n}\` exceeded (recursive read count: \`${e}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.RecursiveReadLimitExceededError"})}}function ure(t,e,n={}){const{as:s="Array",checksumAddress:l=!1}=n,u=typeof e=="string"?$U(e):e,p=are(u);if(gv(u)===0&&t.length>0)throw new hre;if(gv(u)&&gv(u)<32)throw new dre({data:typeof e=="string"?e:pf(e),parameters:t,size:gv(u)});let r=0;const v=s==="Array"?[]:{};for(let w=0;w<t.length;++w){const E=t[w];p.setPosition(r);const[T,k]=Ev(p,E,{checksumAddress:l,staticPosition:0});r+=k,s==="Array"?v.push(T):v[E.name??w]=T}return v}function eR(t,e,n){const{checksumAddress:s=!1}={};if(t.length!==e.length)throw new X7({expectedLength:t.length,givenLength:e.length});const l=Yne({checksumAddress:s,parameters:t,values:e}),u=YP(l);return u.length===0?"0x":u}function J5(t,e){if(t.length!==e.length)throw new X7({expectedLength:t.length,givenLength:e.length});const n=[];for(let s=0;s<t.length;s++){const l=t[s],u=e[s];n.push(J5.encode(l,u))}return ff(...n)}(function(t){function e(n,s,l=!1){if(n==="address"){const v=s;return gA(v),Rx(v.toLowerCase(),l?32:0)}if(n==="string")return CP(s);if(n==="bytes")return s;if(n==="bool")return Rx(qU(s),l?32:1);const u=n.match($7);if(u){const[v,w,E="256"]=u,T=Number.parseInt(E,10)/8;return Uc(s,{size:l?32:T,signed:w==="int"})}const p=n.match(Gne);if(p){const[v,w]=p;if(Number.parseInt(w,10)!==(s.length-2)/2)throw new q7({expectedSize:Number.parseInt(w,10),value:s});return Nx(s,l?32:0)}const r=n.match(Hne);if(r&&Array.isArray(s)){const[v,w]=r,E=[];for(let T=0;T<s.length;T++)E.push(e(w,s[T],!0));return E.length===0?"0x":ff(...E)}throw new tR(n)}t.encode=e})(J5||(J5={}));function W7(t){return Array.isArray(t)&&typeof t[0]=="string"||typeof t=="string"?fL(t):t}class dre extends Vs{constructor({data:e,parameters:n,size:s}){super(`Data size of ${s} bytes is too small for given parameters.`,{metaMessages:[`Params: (${hv(n)})`,`Data:   ${e} (${s} bytes)`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.DataSizeTooSmallError"})}}class hre extends Vs{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.'),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ZeroDataError"})}}class fre extends Vs{constructor({expectedLength:e,givenLength:n,type:s}){super(`Array length mismatch for type \`${s}\`. Expected: \`${e}\`. Given: \`${n}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}class q7 extends Vs{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${fd(n)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class X7 extends Vs{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class pre extends Vs{constructor(e){super(`Value \`${e}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class tR extends Vs{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class Z7 extends dP{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,fY(e);const s=ZE(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const l=this.blockLen,u=new Uint8Array(l);u.set(s.length>l?e.create().update(s).digest():s);for(let p=0;p<u.length;p++)u[p]^=54;this.iHash.update(u),this.oHash=e.create();for(let p=0;p<u.length;p++)u[p]^=106;this.oHash.update(u),z0(u)}update(e){return qv(this),this.iHash.update(e),this}digestInto(e){qv(this),Mx(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:l,destroyed:u,blockLen:p,outputLen:r}=this;return e=e,e.finished=l,e.destroyed=u,e.blockLen=p,e.outputLen=r,e.oHash=n._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Q7=(t,e,n)=>new Z7(t,e).update(n).digest();Q7.create=(t,e)=>new Z7(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _u=BigInt(0),Hc=BigInt(1),ix=BigInt(2),mre=BigInt(3),K7=BigInt(4),Y7=BigInt(5),J7=BigInt(8);function xu(t,e){const n=t%e;return n>=_u?n:e+n}function $d(t,e,n){let s=t;for(;e-- >_u;)s*=s,s%=n;return s}function ek(t,e){if(t===_u)throw new Error("invert: expected non-zero number");if(e<=_u)throw new Error("invert: expected positive modulus, got "+e);let n=xu(t,e),s=e,l=_u,u=Hc;for(;n!==_u;){const r=s/n,v=s%n,w=l-u*r;s=n,n=v,l=u,u=w}if(s!==Hc)throw new Error("invert: does not exist");return xu(l,e)}function e9(t,e){const n=(t.ORDER+Hc)/K7,s=t.pow(e,n);if(!t.eql(t.sqr(s),e))throw new Error("Cannot find square root");return s}function gre(t,e){const n=(t.ORDER-Y7)/J7,s=t.mul(e,ix),l=t.pow(s,n),u=t.mul(e,l),p=t.mul(t.mul(u,ix),l),r=t.mul(u,t.sub(p,t.ONE));if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function yre(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Hc,n=0;for(;e%ix===_u;)e/=ix,n++;let s=ix;const l=nR(t);for(;BL(l,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return e9;let u=l.pow(s,e);const p=(e+Hc)/ix;return function(v,w){if(v.is0(w))return w;if(BL(v,w)!==1)throw new Error("Cannot find square root");let E=n,T=v.mul(v.ONE,u),k=v.pow(w,e),R=v.pow(w,p);for(;!v.eql(k,v.ONE);){if(v.is0(k))return v.ZERO;let D=1,O=v.sqr(k);for(;!v.eql(O,v.ONE);)if(D++,O=v.sqr(O),D===E)throw new Error("Cannot find square root");const F=Hc<<BigInt(E-D-1),U=v.pow(T,F);E=D,T=v.sqr(U),k=v.mul(k,T),R=v.mul(R,U)}return R}}function xre(t){return t%K7===mre?e9:t%J7===Y7?gre:yre(t)}const _re=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function vre(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=_re.reduce((s,l)=>(s[l]="function",s),e);return rA(t,n)}function bre(t,e,n){if(n<_u)throw new Error("invalid exponent, negatives unsupported");if(n===_u)return t.ONE;if(n===Hc)return e;let s=t.ONE,l=e;for(;n>_u;)n&Hc&&(s=t.mul(s,l)),l=t.sqr(l),n>>=Hc;return s}function t9(t,e,n=!1){const s=new Array(e.length).fill(n?t.ZERO:void 0),l=e.reduce((p,r,v)=>t.is0(r)?p:(s[v]=p,t.mul(p,r)),t.ONE),u=t.inv(l);return e.reduceRight((p,r,v)=>t.is0(r)?p:(s[v]=t.mul(p,s[v]),t.mul(p,r)),u),s}function BL(t,e){const n=(t.ORDER-Hc)/ix,s=t.pow(e,n),l=t.eql(s,t.ONE),u=t.eql(s,t.ZERO),p=t.eql(s,t.neg(t.ONE));if(!l&&!u&&!p)throw new Error("invalid Legendre symbol result");return l?1:u?0:-1}function n9(t,e){e!==void 0&&J1(e);const n=e!==void 0?e:t.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function nR(t,e,n=!1,s={}){if(t<=_u)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:l,nByteLength:u}=n9(t,e);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let p;const r=Object.freeze({ORDER:t,isLE:n,BITS:l,BYTES:u,MASK:nA(l),ZERO:_u,ONE:Hc,create:v=>xu(v,t),isValid:v=>{if(typeof v!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof v);return _u<=v&&v<t},is0:v=>v===_u,isOdd:v=>(v&Hc)===Hc,neg:v=>xu(-v,t),eql:(v,w)=>v===w,sqr:v=>xu(v*v,t),add:(v,w)=>xu(v+w,t),sub:(v,w)=>xu(v-w,t),mul:(v,w)=>xu(v*w,t),pow:(v,w)=>bre(r,v,w),div:(v,w)=>xu(v*ek(w,t),t),sqrN:v=>v*v,addN:(v,w)=>v+w,subN:(v,w)=>v-w,mulN:(v,w)=>v*w,inv:v=>ek(v,t),sqrt:s.sqrt||(v=>(p||(p=xre(t)),p(r,v))),toBytes:v=>n?zU(v,u):s2(v,u),fromBytes:v=>{if(v.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+v.length);return n?BU(v):vx(v)},invertBatch:v=>t9(r,v),cmov:(v,w,E)=>E?w:v});return Object.freeze(r)}function r9(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function i9(t){const e=r9(t);return e+Math.ceil(e/2)}function wre(t,e,n=!1){const s=t.length,l=r9(e),u=i9(e);if(s<16||s<u||s>1024)throw new Error("expected "+u+"-1024 bytes of input, got "+s);const p=n?BU(t):vx(t),r=xu(p,e-Hc)+Hc;return n?zU(r,l):s2(r,l)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const zL=BigInt(0),tk=BigInt(1);function LC(t,e){const n=e.negate();return t?n:e}function s9(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function OC(t,e){s9(t,e);const n=Math.ceil(e/t)+1,s=2**(t-1),l=2**t,u=nA(t),p=BigInt(t);return{windows:n,windowSize:s,mask:u,maxNumber:l,shiftBy:p}}function UL(t,e,n){const{windowSize:s,mask:l,maxNumber:u,shiftBy:p}=n;let r=Number(t&l),v=t>>p;r>s&&(r-=u,v+=tk);const w=e*s,E=w+Math.abs(r)-1,T=r===0,k=r<0,R=e%2!==0;return{nextN:v,offset:E,isZero:T,isNeg:k,isNegF:R,offsetF:w}}function Sre(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,s)=>{if(!(n instanceof e))throw new Error("invalid point at index "+s)})}function Tre(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,s)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+s)})}const FC=new WeakMap,o9=new WeakMap;function BC(t){return o9.get(t)||1}function Ere(t,e){return{constTimeNegate:LC,hasPrecomputes(n){return BC(n)!==1},unsafeLadder(n,s,l=t.ZERO){let u=n;for(;s>zL;)s&tk&&(l=l.add(u)),u=u.double(),s>>=tk;return l},precomputeWindow(n,s){const{windows:l,windowSize:u}=OC(s,e),p=[];let r=n,v=r;for(let w=0;w<l;w++){v=r,p.push(v);for(let E=1;E<u;E++)v=v.add(r),p.push(v);r=v.double()}return p},wNAF(n,s,l){let u=t.ZERO,p=t.BASE;const r=OC(n,e);for(let v=0;v<r.windows;v++){const{nextN:w,offset:E,isZero:T,isNeg:k,isNegF:R,offsetF:D}=UL(l,v,r);l=w,T?p=p.add(LC(R,s[D])):u=u.add(LC(k,s[E]))}return{p:u,f:p}},wNAFUnsafe(n,s,l,u=t.ZERO){const p=OC(n,e);for(let r=0;r<p.windows&&l!==zL;r++){const{nextN:v,offset:w,isZero:E,isNeg:T}=UL(l,r,p);if(l=v,!E){const k=s[w];u=u.add(T?k.negate():k)}}return u},getPrecomputes(n,s,l){let u=FC.get(s);return u||(u=this.precomputeWindow(s,n),n!==1&&FC.set(s,l(u))),u},wNAFCached(n,s,l){const u=BC(n);return this.wNAF(u,this.getPrecomputes(u,n,l),s)},wNAFCachedUnsafe(n,s,l,u){const p=BC(n);return p===1?this.unsafeLadder(n,s,u):this.wNAFUnsafe(p,this.getPrecomputes(p,n,l),s,u)},setWindowSize(n,s){s9(s,e),o9.set(n,s),FC.delete(n)}}}function Are(t,e,n,s){Sre(n,t),Tre(s,e);const l=n.length,u=s.length;if(l!==u)throw new Error("arrays of points and scalars must have equal length");const p=t.ZERO,r=wee(BigInt(l));let v=1;r>12?v=r-3:r>4?v=r-2:r>0&&(v=2);const w=nA(v),E=new Array(Number(w)+1).fill(p),T=Math.floor((e.BITS-1)/v)*v;let k=p;for(let R=T;R>=0;R-=v){E.fill(p);for(let O=0;O<u;O++){const F=s[O],U=Number(F>>BigInt(R)&w);E[U]=E[U].add(n[O])}let D=p;for(let O=E.length-1,F=p;O>0;O--)F=F.add(E[O]),D=D.add(F);if(k=k.add(D),R!==0)for(let O=0;O<v;O++)k=k.double()}return k}function a9(t){return vre(t.Fp),rA(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...n9(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function VL(t){t.lowS!==void 0&&yw("lowS",t.lowS),t.prehash!==void 0&&yw("prehash",t.prehash)}function Cre(t){const e=a9(t);rA(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:s,a:l}=e;if(n){if(!s.eql(l,s.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Mre extends Error{constructor(e=""){super(e)}}const jm={Err:Mre,_tlv:{encode:(t,e)=>{const{Err:n}=jm;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const s=e.length/2,l=RS(s);if(l.length/2&128)throw new n("tlv.encode: long form length too big");const u=s>127?RS(l.length/2|128):"";return RS(t)+u+l+e},decode(t,e){const{Err:n}=jm;let s=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[s++]!==t)throw new n("tlv.decode: wrong tlv");const l=e[s++],u=!!(l&128);let p=0;if(!u)p=l;else{const v=l&127;if(!v)throw new n("tlv.decode(long): indefinite length not supported");if(v>4)throw new n("tlv.decode(long): byte length is too big");const w=e.subarray(s,s+v);if(w.length!==v)throw new n("tlv.decode: length bytes not complete");if(w[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const E of w)p=p<<8|E;if(s+=v,p<128)throw new n("tlv.decode(long): not minimal encoding")}const r=e.subarray(s,s+p);if(r.length!==p)throw new n("tlv.decode: wrong value length");return{v:r,l:e.subarray(s+p)}}},_int:{encode(t){const{Err:e}=jm;if(t<Bm)throw new e("integer: negative integers are not allowed");let n=RS(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=jm;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return vx(t)}},toSig(t){const{Err:e,_int:n,_tlv:s}=jm,l=Zd("signature",t),{v:u,l:p}=s.decode(48,l);if(p.length)throw new e("invalid signature: left bytes after parsing");const{v:r,l:v}=s.decode(2,u),{v:w,l:E}=s.decode(2,v);if(E.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(r),s:n.decode(w)}},hexFromSig(t){const{_tlv:e,_int:n}=jm,s=e.encode(2,n.encode(t.r)),l=e.encode(2,n.encode(t.s)),u=s+l;return e.encode(48,u)}};function zC(t,e){return xw(s2(t,e))}const Bm=BigInt(0),vl=BigInt(1);BigInt(2);const UC=BigInt(3),kre=BigInt(4);function Ire(t){const e=Cre(t),{Fp:n}=e,s=nR(e.n,e.nBitLength),l=e.toBytes||((W,K,ne)=>{const te=K.toAffine();return lE(Uint8Array.from([4]),n.toBytes(te.x),n.toBytes(te.y))}),u=e.fromBytes||(W=>{const K=W.subarray(1),ne=n.fromBytes(K.subarray(0,n.BYTES)),te=n.fromBytes(K.subarray(n.BYTES,2*n.BYTES));return{x:ne,y:te}});function p(W){const{a:K,b:ne}=e,te=n.sqr(W),re=n.mul(te,W);return n.add(n.add(re,n.mul(W,K)),ne)}function r(W,K){const ne=n.sqr(K),te=p(W);return n.eql(ne,te)}if(!r(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const v=n.mul(n.pow(e.a,UC),kre),w=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(v,w)))throw new Error("bad curve params: a or b");function E(W){return AP(W,vl,e.n)}function T(W){const{allowedPrivateKeyLengths:K,nByteLength:ne,wrapPrivateKey:te,n:re}=e;if(K&&typeof W!="bigint"){if(i2(W)&&(W=xw(W)),typeof W!="string"||!K.includes(W.length))throw new Error("invalid private key");W=W.padStart(ne*2,"0")}let xe;try{xe=typeof W=="bigint"?W:vx(Zd("private key",W,ne))}catch{throw new Error("invalid private key, expected hex or "+ne+" bytes, got "+typeof W)}return te&&(xe=xu(xe,re)),Tv("private key",xe,vl,re),xe}function k(W){if(!(W instanceof O))throw new Error("ProjectivePoint expected")}const R=bL((W,K)=>{const{px:ne,py:te,pz:re}=W;if(n.eql(re,n.ONE))return{x:ne,y:te};const xe=W.is0();K==null&&(K=xe?n.ONE:n.inv(re));const ae=n.mul(ne,K),ce=n.mul(te,K),ye=n.mul(re,K);if(xe)return{x:n.ZERO,y:n.ZERO};if(!n.eql(ye,n.ONE))throw new Error("invZ was invalid");return{x:ae,y:ce}}),D=bL(W=>{if(W.is0()){if(e.allowInfinityPoint&&!n.is0(W.py))return;throw new Error("bad point: ZERO")}const{x:K,y:ne}=W.toAffine();if(!n.isValid(K)||!n.isValid(ne))throw new Error("bad point: x or y not FE");if(!r(K,ne))throw new Error("bad point: equation left != right");if(!W.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class O{constructor(K,ne,te){if(K==null||!n.isValid(K))throw new Error("x required");if(ne==null||!n.isValid(ne)||n.is0(ne))throw new Error("y required");if(te==null||!n.isValid(te))throw new Error("z required");this.px=K,this.py=ne,this.pz=te,Object.freeze(this)}static fromAffine(K){const{x:ne,y:te}=K||{};if(!K||!n.isValid(ne)||!n.isValid(te))throw new Error("invalid affine point");if(K instanceof O)throw new Error("projective point not allowed");const re=xe=>n.eql(xe,n.ZERO);return re(ne)&&re(te)?O.ZERO:new O(ne,te,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(K){const ne=t9(n,K.map(te=>te.pz));return K.map((te,re)=>te.toAffine(ne[re])).map(O.fromAffine)}static fromHex(K){const ne=O.fromAffine(u(Zd("pointHex",K)));return ne.assertValidity(),ne}static fromPrivateKey(K){return O.BASE.multiply(T(K))}static msm(K,ne){return Are(O,s,K,ne)}_setWindowSize(K){X.setWindowSize(this,K)}assertValidity(){D(this)}hasEvenY(){const{y:K}=this.toAffine();if(n.isOdd)return!n.isOdd(K);throw new Error("Field doesn't support isOdd")}equals(K){k(K);const{px:ne,py:te,pz:re}=this,{px:xe,py:ae,pz:ce}=K,ye=n.eql(n.mul(ne,ce),n.mul(xe,re)),Ce=n.eql(n.mul(te,ce),n.mul(ae,re));return ye&&Ce}negate(){return new O(this.px,n.neg(this.py),this.pz)}double(){const{a:K,b:ne}=e,te=n.mul(ne,UC),{px:re,py:xe,pz:ae}=this;let ce=n.ZERO,ye=n.ZERO,Ce=n.ZERO,Me=n.mul(re,re),Ke=n.mul(xe,xe),ke=n.mul(ae,ae),je=n.mul(re,xe);return je=n.add(je,je),Ce=n.mul(re,ae),Ce=n.add(Ce,Ce),ce=n.mul(K,Ce),ye=n.mul(te,ke),ye=n.add(ce,ye),ce=n.sub(Ke,ye),ye=n.add(Ke,ye),ye=n.mul(ce,ye),ce=n.mul(je,ce),Ce=n.mul(te,Ce),ke=n.mul(K,ke),je=n.sub(Me,ke),je=n.mul(K,je),je=n.add(je,Ce),Ce=n.add(Me,Me),Me=n.add(Ce,Me),Me=n.add(Me,ke),Me=n.mul(Me,je),ye=n.add(ye,Me),ke=n.mul(xe,ae),ke=n.add(ke,ke),Me=n.mul(ke,je),ce=n.sub(ce,Me),Ce=n.mul(ke,Ke),Ce=n.add(Ce,Ce),Ce=n.add(Ce,Ce),new O(ce,ye,Ce)}add(K){k(K);const{px:ne,py:te,pz:re}=this,{px:xe,py:ae,pz:ce}=K;let ye=n.ZERO,Ce=n.ZERO,Me=n.ZERO;const Ke=e.a,ke=n.mul(e.b,UC);let je=n.mul(ne,xe),$e=n.mul(te,ae),Ae=n.mul(re,ce),He=n.add(ne,te),qe=n.add(xe,ae);He=n.mul(He,qe),qe=n.add(je,$e),He=n.sub(He,qe),qe=n.add(ne,re);let Le=n.add(xe,ce);return qe=n.mul(qe,Le),Le=n.add(je,Ae),qe=n.sub(qe,Le),Le=n.add(te,re),ye=n.add(ae,ce),Le=n.mul(Le,ye),ye=n.add($e,Ae),Le=n.sub(Le,ye),Me=n.mul(Ke,qe),ye=n.mul(ke,Ae),Me=n.add(ye,Me),ye=n.sub($e,Me),Me=n.add($e,Me),Ce=n.mul(ye,Me),$e=n.add(je,je),$e=n.add($e,je),Ae=n.mul(Ke,Ae),qe=n.mul(ke,qe),$e=n.add($e,Ae),Ae=n.sub(je,Ae),Ae=n.mul(Ke,Ae),qe=n.add(qe,Ae),je=n.mul($e,qe),Ce=n.add(Ce,je),je=n.mul(Le,qe),ye=n.mul(He,ye),ye=n.sub(ye,je),je=n.mul(He,$e),Me=n.mul(Le,Me),Me=n.add(Me,je),new O(ye,Ce,Me)}subtract(K){return this.add(K.negate())}is0(){return this.equals(O.ZERO)}wNAF(K){return X.wNAFCached(this,K,O.normalizeZ)}multiplyUnsafe(K){const{endo:ne,n:te}=e;Tv("scalar",K,Bm,te);const re=O.ZERO;if(K===Bm)return re;if(this.is0()||K===vl)return this;if(!ne||X.hasPrecomputes(this))return X.wNAFCachedUnsafe(this,K,O.normalizeZ);let{k1neg:xe,k1:ae,k2neg:ce,k2:ye}=ne.splitScalar(K),Ce=re,Me=re,Ke=this;for(;ae>Bm||ye>Bm;)ae&vl&&(Ce=Ce.add(Ke)),ye&vl&&(Me=Me.add(Ke)),Ke=Ke.double(),ae>>=vl,ye>>=vl;return xe&&(Ce=Ce.negate()),ce&&(Me=Me.negate()),Me=new O(n.mul(Me.px,ne.beta),Me.py,Me.pz),Ce.add(Me)}multiply(K){const{endo:ne,n:te}=e;Tv("scalar",K,vl,te);let re,xe;if(ne){const{k1neg:ae,k1:ce,k2neg:ye,k2:Ce}=ne.splitScalar(K);let{p:Me,f:Ke}=this.wNAF(ce),{p:ke,f:je}=this.wNAF(Ce);Me=X.constTimeNegate(ae,Me),ke=X.constTimeNegate(ye,ke),ke=new O(n.mul(ke.px,ne.beta),ke.py,ke.pz),re=Me.add(ke),xe=Ke.add(je)}else{const{p:ae,f:ce}=this.wNAF(K);re=ae,xe=ce}return O.normalizeZ([re,xe])[0]}multiplyAndAddUnsafe(K,ne,te){const re=O.BASE,xe=(ce,ye)=>ye===Bm||ye===vl||!ce.equals(re)?ce.multiplyUnsafe(ye):ce.multiply(ye),ae=xe(this,ne).add(xe(K,te));return ae.is0()?void 0:ae}toAffine(K){return R(this,K)}isTorsionFree(){const{h:K,isTorsionFree:ne}=e;if(K===vl)return!0;if(ne)return ne(O,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:K,clearCofactor:ne}=e;return K===vl?this:ne?ne(O,this):this.multiplyUnsafe(e.h)}toRawBytes(K=!0){return yw("isCompressed",K),this.assertValidity(),l(O,this,K)}toHex(K=!0){return yw("isCompressed",K),xw(this.toRawBytes(K))}}O.BASE=new O(e.Gx,e.Gy,n.ONE),O.ZERO=new O(n.ZERO,n.ONE,n.ZERO);const{endo:F,nBitLength:U}=e,X=Ere(O,F?Math.ceil(U/2):U);return{CURVE:e,ProjectivePoint:O,normPrivateKeyToScalar:T,weierstrassEquation:p,isWithinCurveOrder:E}}function Pre(t){const e=a9(t);return rA(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Rre(t){const e=Pre(t),{Fp:n,n:s,nByteLength:l,nBitLength:u}=e,p=n.BYTES+1,r=2*n.BYTES+1;function v(ke){return xu(ke,s)}function w(ke){return ek(ke,s)}const{ProjectivePoint:E,normPrivateKeyToScalar:T,weierstrassEquation:k,isWithinCurveOrder:R}=Ire({...e,toBytes(ke,je,$e){const Ae=je.toAffine(),He=n.toBytes(Ae.x),qe=lE;return yw("isCompressed",$e),$e?qe(Uint8Array.from([je.hasEvenY()?2:3]),He):qe(Uint8Array.from([4]),He,n.toBytes(Ae.y))},fromBytes(ke){const je=ke.length,$e=ke[0],Ae=ke.subarray(1);if(je===p&&($e===2||$e===3)){const He=vx(Ae);if(!AP(He,vl,n.ORDER))throw new Error("Point is not on curve");const qe=k(He);let Le;try{Le=n.sqrt(qe)}catch(yt){const Vt=yt instanceof Error?": "+yt.message:"";throw new Error("Point is not on curve"+Vt)}const st=(Le&vl)===vl;return($e&1)===1!==st&&(Le=n.neg(Le)),{x:He,y:Le}}else if(je===r&&$e===4){const He=n.fromBytes(Ae.subarray(0,n.BYTES)),qe=n.fromBytes(Ae.subarray(n.BYTES,2*n.BYTES));return{x:He,y:qe}}else{const He=p,qe=r;throw new Error("invalid Point, expected length of "+He+", or uncompressed "+qe+", got "+je)}}});function D(ke){const je=s>>vl;return ke>je}function O(ke){return D(ke)?v(-ke):ke}const F=(ke,je,$e)=>vx(ke.slice(je,$e));class U{constructor(je,$e,Ae){Tv("r",je,vl,s),Tv("s",$e,vl,s),this.r=je,this.s=$e,Ae!=null&&(this.recovery=Ae),Object.freeze(this)}static fromCompact(je){const $e=l;return je=Zd("compactSignature",je,$e*2),new U(F(je,0,$e),F(je,$e,2*$e))}static fromDER(je){const{r:$e,s:Ae}=jm.toSig(Zd("DER",je));return new U($e,Ae)}assertValidity(){}addRecoveryBit(je){return new U(this.r,this.s,je)}recoverPublicKey(je){const{r:$e,s:Ae,recovery:He}=this,qe=re(Zd("msgHash",je));if(He==null||![0,1,2,3].includes(He))throw new Error("recovery id invalid");const Le=He===2||He===3?$e+e.n:$e;if(Le>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const st=(He&1)===0?"02":"03",bt=E.fromHex(st+zC(Le,n.BYTES)),yt=w(Le),Vt=v(-qe*yt),_t=v(Ae*yt),vt=E.BASE.multiplyAndAddUnsafe(bt,Vt,_t);if(!vt)throw new Error("point at infinify");return vt.assertValidity(),vt}hasHighS(){return D(this.s)}normalizeS(){return this.hasHighS()?new U(this.r,v(-this.s),this.recovery):this}toDERRawBytes(){return aE(this.toDERHex())}toDERHex(){return jm.hexFromSig(this)}toCompactRawBytes(){return aE(this.toCompactHex())}toCompactHex(){const je=l;return zC(this.r,je)+zC(this.s,je)}}const X={isValidPrivateKey(ke){try{return T(ke),!0}catch{return!1}},normPrivateKeyToScalar:T,randomPrivateKey:()=>{const ke=i9(e.n);return wre(e.randomBytes(ke),e.n)},precompute(ke=8,je=E.BASE){return je._setWindowSize(ke),je.multiply(BigInt(3)),je}};function W(ke,je=!0){return E.fromPrivateKey(ke).toRawBytes(je)}function K(ke){if(typeof ke=="bigint")return!1;if(ke instanceof E)return!0;const $e=Zd("key",ke).length,Ae=n.BYTES,He=Ae+1,qe=2*Ae+1;if(!(e.allowedPrivateKeyLengths||l===He))return $e===He||$e===qe}function ne(ke,je,$e=!0){if(K(ke)===!0)throw new Error("first arg must be private key");if(K(je)===!1)throw new Error("second arg must be public key");return E.fromHex(je).multiply(T(ke)).toRawBytes($e)}const te=e.bits2int||function(ke){if(ke.length>8192)throw new Error("input is too large");const je=vx(ke),$e=ke.length*8-u;return $e>0?je>>BigInt($e):je},re=e.bits2int_modN||function(ke){return v(te(ke))},xe=nA(u);function ae(ke){return Tv("num < 2^"+u,ke,Bm,xe),s2(ke,l)}function ce(ke,je,$e=ye){if(["recovered","canonical"].some(kt=>kt in $e))throw new Error("sign() legacy options not supported");const{hash:Ae,randomBytes:He}=e;let{lowS:qe,prehash:Le,extraEntropy:st}=$e;qe==null&&(qe=!0),ke=Zd("msgHash",ke),VL($e),Le&&(ke=Zd("prehashed msgHash",Ae(ke)));const bt=re(ke),yt=T(je),Vt=[ae(yt),ae(bt)];if(st!=null&&st!==!1){const kt=st===!0?He(n.BYTES):st;Vt.push(Zd("extraEntropy",kt))}const _t=lE(...Vt),vt=bt;function qt(kt){const on=te(kt);if(!R(on))return;const mn=w(on),Hr=E.BASE.multiply(on).toAffine(),Un=v(Hr.x);if(Un===Bm)return;const $r=v(mn*v(vt+Un*yt));if($r===Bm)return;let ht=(Hr.x===Un?0:2)|Number(Hr.y&vl),Lr=$r;return qe&&D($r)&&(Lr=O($r),ht^=1),new U(Un,Lr,ht)}return{seed:_t,k2sig:qt}}const ye={lowS:e.lowS,prehash:!1},Ce={lowS:e.lowS,prehash:!1};function Me(ke,je,$e=ye){const{seed:Ae,k2sig:He}=ce(ke,je,$e),qe=e;return See(qe.hash.outputLen,qe.nByteLength,qe.hmac)(Ae,He)}E.BASE._setWindowSize(8);function Ke(ke,je,$e,Ae=Ce){var ht;const He=ke;je=Zd("msgHash",je),$e=Zd("publicKey",$e);const{lowS:qe,prehash:Le,format:st}=Ae;if(VL(Ae),"strict"in Ae)throw new Error("options.strict was renamed to lowS");if(st!==void 0&&st!=="compact"&&st!=="der")throw new Error("format must be compact or der");const bt=typeof He=="string"||i2(He),yt=!bt&&!st&&typeof He=="object"&&He!==null&&typeof He.r=="bigint"&&typeof He.s=="bigint";if(!bt&&!yt)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Vt,_t;try{if(yt&&(Vt=new U(He.r,He.s)),bt){try{st!=="compact"&&(Vt=U.fromDER(He))}catch(Lr){if(!(Lr instanceof jm.Err))throw Lr}!Vt&&st!=="der"&&(Vt=U.fromCompact(He))}_t=E.fromHex($e)}catch{return!1}if(!Vt||qe&&Vt.hasHighS())return!1;Le&&(je=e.hash(je));const{r:vt,s:qt}=Vt,kt=re(je),on=w(qt),mn=v(kt*on),Hr=v(vt*on),Un=(ht=E.BASE.multiplyAndAddUnsafe(_t,mn,Hr))==null?void 0:ht.toAffine();return Un?v(Un.x)===vt:!1}return{CURVE:e,getPublicKey:W,getSharedSecret:ne,sign:Me,verify:Ke,ProjectivePoint:E,Signature:U,utils:X}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Nre(t){return{hash:t,hmac:(e,...n)=>Q7(t,e,_Y(...n)),randomBytes:vY}}function jre(t,e){const n=s=>Rre({...t,...Nre(s)});return{...n(e),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const l9=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),HL=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Dre=BigInt(0),Lre=BigInt(1),nk=BigInt(2),GL=(t,e)=>(t+e/nk)/e;function Ore(t){const e=l9,n=BigInt(3),s=BigInt(6),l=BigInt(11),u=BigInt(22),p=BigInt(23),r=BigInt(44),v=BigInt(88),w=t*t*t%e,E=w*w*t%e,T=$d(E,n,e)*E%e,k=$d(T,n,e)*E%e,R=$d(k,nk,e)*w%e,D=$d(R,l,e)*R%e,O=$d(D,u,e)*D%e,F=$d(O,r,e)*O%e,U=$d(F,v,e)*F%e,X=$d(U,r,e)*O%e,W=$d(X,n,e)*E%e,K=$d(W,p,e)*D%e,ne=$d(K,s,e)*w%e,te=$d(ne,nk,e);if(!rk.eql(rk.sqr(te),t))throw new Error("Cannot find square root");return te}const rk=nR(l9,void 0,void 0,{sqrt:Ore}),yA=jre({a:Dre,b:BigInt(7),Fp:rk,n:HL,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=HL,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-Lre*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),l=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),u=n,p=BigInt("0x100000000000000000000000000000000"),r=GL(u*t,e),v=GL(-s*t,e);let w=xu(t-r*n-v*l,e),E=xu(-r*s-v*u,e);const T=w>p,k=E>p;if(T&&(w=e-w),k&&(E=e-E),w>p||E>p)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:T,k1:w,k2neg:k,k2:E}}}},T7),Fre=Object.freeze(Object.defineProperty({__proto__:null,secp256k1:yA},Symbol.toStringTag,{value:"Module"}));function c9(t,e={}){const{recovered:n}=e;if(typeof t.r>"u")throw new VC({signature:t});if(typeof t.s>"u")throw new VC({signature:t});if(n&&typeof t.yParity>"u")throw new VC({signature:t});if(t.r<0n||t.r>LL)throw new $re({value:t.r});if(t.s<0n||t.s>LL)throw new Wre({value:t.s});if(typeof t.yParity=="number"&&t.yParity!==0&&t.yParity!==1)throw new iR({value:t.yParity})}function Bre(t){return u9(pf(t))}function u9(t){if(t.length!==130&&t.length!==132)throw new Gre({signature:t});const e=BigInt(xp(t,0,32)),n=BigInt(xp(t,32,64)),s=(()=>{const l=+`0x${t.slice(130)}`;if(!Number.isNaN(l))try{return rR(l)}catch{throw new iR({value:l})}})();return typeof s>"u"?{r:e,s:n}:{r:e,s:n,yParity:s}}function zre(t){if(!(typeof t.r>"u")&&!(typeof t.s>"u"))return Ure(t)}function Ure(t){const e=typeof t=="string"?u9(t):t instanceof Uint8Array?Bre(t):typeof t.r=="string"?Hre(t):t.v?Vre(t):{r:t.r,s:t.s,...typeof t.yParity<"u"?{yParity:t.yParity}:{}};return c9(e),e}function Vre(t){return{r:t.r,s:t.s,yParity:rR(t.v)}}function Hre(t){const e=(()=>{const n=t.v?Number(t.v):void 0;let s=t.yParity?Number(t.yParity):void 0;if(typeof n=="number"&&typeof s!="number"&&(s=rR(n)),typeof s!="number")throw new iR({value:t.yParity});return s})();return{r:BigInt(t.r),s:BigInt(t.s),yParity:e}}function rR(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new qre({value:t})}class Gre extends Vs{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${fd(Xee(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class VC extends Vs{constructor({signature:e}){super(`Signature \`${GU(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class $re extends Vs{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class Wre extends Vs{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class iR extends Vs{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class qre extends Vs{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function Xre(t,e={}){return typeof t.chainId=="string"?Zre(t):{...t,...e.signature}}function Zre(t){const{address:e,chainId:n,nonce:s}=t,l=zre(t);return{address:e,chainId:Number(n),nonce:BigInt(s),...l}}const Qre="0x8010801080108010801080108010801080108010801080108010801080108010",Kre=W7("(uint256 chainId, address delegation, uint256 nonce, uint8 yParity, uint256 r, uint256 s), address to, bytes data");function d9(t){if(typeof t=="string"){if(xp(t,-32)!==Qre)throw new eie(t)}else c9(t.authorization)}function Yre(t){d9(t);const e=ZU(xp(t,-64,-32)),n=xp(t,-e-64,-64),s=xp(t,0,-e-64),[l,u,p]=ure(Kre,n);return{authorization:Xre({address:l.delegation,chainId:Number(l.chainId),nonce:l.nonce,yParity:l.yParity,r:l.r,s:l.s}),signature:s,...p&&p!=="0x"?{data:p,to:u}:{}}}function Jre(t){try{return d9(t),!0}catch{return!1}}let eie=class extends Vs{constructor(e){super(`Value \`${e}\` is an invalid ERC-8010 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SignatureErc8010.InvalidWrappedSignatureError"})}};class tie extends Wn{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function nie(t,e){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(t))throw new tie({value:t});let[n,s="0"]=t.split(".");const l=n.startsWith("-");if(l&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),s.length>e){const[u,p,r]=[s.slice(0,e-1),s.slice(e-1,e),s.slice(e)],v=Math.round(+`${p}.${r}`);v>9?s=`${BigInt(u)+BigInt(1)}0`.padStart(u.length+1,"0"):s=`${u}${v}`,s.length>e&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,e)}else s=s.padEnd(e,"0");return BigInt(`${l?"-":""}${n}${s}`)}function rie(t){return t.map(e=>({...e,value:BigInt(e.value)}))}function iie(t){return{...t,balance:t.balance?BigInt(t.balance):void 0,nonce:t.nonce?hd(t.nonce):void 0,storageProof:t.storageProof?rie(t.storageProof):void 0}}async function sie(t,{address:e,blockNumber:n,blockTag:s,storageKeys:l}){const u=s??"latest",p=n!==void 0?lr(n):void 0,r=await t.request({method:"eth_getProof",params:[e,l,p||u]});return iie(r)}async function oie(t,{address:e,blockNumber:n,blockTag:s="latest",slot:l}){const u=n!==void 0?lr(n):void 0;return await t.request({method:"eth_getStorageAt",params:[e,l,u||s]})}async function sR(t,{blockHash:e,blockNumber:n,blockTag:s,hash:l,index:u,sender:p,nonce:r}){var k,R,D;const v=s||"latest",w=n!==void 0?lr(n):void 0;let E=null;if(l?E=await t.request({method:"eth_getTransactionByHash",params:[l]},{dedupe:!0}):e?E=await t.request({method:"eth_getTransactionByBlockHashAndIndex",params:[e,lr(u)]},{dedupe:!0}):typeof u=="number"?E=await t.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[w||v,lr(u)]},{dedupe:!!w}):p&&typeof r=="number"&&(E=await t.request({method:"eth_getTransactionBySenderAndNonce",params:[p,lr(r)]},{dedupe:!0})),!E)throw new RU({blockHash:e,blockNumber:n,blockTag:v,hash:l,index:u});return(((D=(R=(k=t.chain)==null?void 0:k.formatters)==null?void 0:R.transaction)==null?void 0:D.format)||dA)(E,"getTransaction")}async function aie(t,{hash:e,transactionReceipt:n}){const[s,l]=await Promise.all([pi(t,u2,"getBlockNumber")({}),e?pi(t,sR,"getTransaction")({hash:e}):void 0]),u=(n==null?void 0:n.blockNumber)||(l==null?void 0:l.blockNumber);return u?s-u+1n:0n}async function NT(t,{hash:e}){var l,u,p;const n=await t.request({method:"eth_getTransactionReceipt",params:[e]},{dedupe:!0});if(!n)throw new NU({hash:e});return(((p=(u=(l=t.chain)==null?void 0:l.formatters)==null?void 0:u.transactionReceipt)==null?void 0:p.format)||ZP)(n,"getTransactionReceipt")}async function h9(t,e){var X;const{account:n,authorizationList:s,allowFailure:l=!0,blockNumber:u,blockOverrides:p,blockTag:r,stateOverride:v}=e,w=e.contracts,{batchSize:E=e.batchSize??1024,deployless:T=e.deployless??!1}=typeof((X=t.batch)==null?void 0:X.multicall)=="object"?t.batch.multicall:{},k=(()=>{if(e.multicallAddress)return e.multicallAddress;if(T)return null;if(t.chain)return pb({blockNumber:u,chain:t.chain,contract:"multicall3"});throw new Error("client chain not configured. multicallAddress is required.")})(),R=[[]];let D=0,O=0;for(let W=0;W<w.length;W++){const{abi:K,address:ne,args:te,functionName:re}=w[W];try{const xe=gd({abi:K,args:te,functionName:re});O+=(xe.length-2)/2,E>0&&O>E&&R[D].length>0&&(D++,O=(xe.length-2)/2,R[D]=[]),R[D]=[...R[D],{allowFailure:!0,callData:xe,target:ne}]}catch(xe){const ae=Px(xe,{abi:K,address:ne,args:te,docsPath:"/docs/contract/multicall",functionName:re,sender:n});if(!l)throw ae;R[D]=[...R[D],{allowFailure:!0,callData:"0x",target:ne}]}}const F=await Promise.allSettled(R.map(W=>pi(t,ah,"readContract")({...k===null?{code:MP}:{address:k},abi:sE,account:n,args:[W],authorizationList:s,blockNumber:u,blockOverrides:p,blockTag:r,functionName:"aggregate3",stateOverride:v}))),U=[];for(let W=0;W<F.length;W++){const K=F[W];if(K.status==="rejected"){if(!l)throw K.reason;for(let te=0;te<R[W].length;te++)U.push({status:"failure",error:K.reason,result:void 0});continue}const ne=K.value;for(let te=0;te<ne.length;te++){const{returnData:re,success:xe}=ne[te],{callData:ae}=R[W][te],{abi:ce,address:ye,functionName:Ce,args:Me}=w[U.length];try{if(ae==="0x")throw new Yw;if(!xe)throw new eA({data:re});const Ke=Zx({abi:ce,args:Me,data:re,functionName:Ce});U.push(l?{result:Ke,status:"success"}:Ke)}catch(Ke){const ke=Px(Ke,{abi:ce,address:ye,args:Me,docsPath:"/docs/contract/multicall",functionName:Ce});if(!l)throw ke;U.push({error:ke,result:void 0,status:"failure"})}}}if(U.length!==w.length)throw new Wn("multicall results mismatch");return U}async function ik(t,e){const{blockNumber:n,blockTag:s=t.experimental_blockTag??"latest",blocks:l,returnFullTransactions:u,traceTransfers:p,validation:r}=e;try{const v=[];for(const k of l){const R=k.blockOverrides?YU(k.blockOverrides):void 0,D=k.calls.map(F=>{const U=F,X=U.account?Fo(U.account):void 0,W=U.abi?gd(U):U.data,K={...U,account:X,data:U.dataSuffix?oh([W||"0x",U.dataSuffix]):W,from:U.from??(X==null?void 0:X.address)};return ug(K),X0(K)}),O=k.stateOverrides?PP(k.stateOverrides):void 0;v.push({blockOverrides:R,calls:D,stateOverrides:O})}const E=(typeof n=="bigint"?lr(n):void 0)||s;return(await t.request({method:"eth_simulateV1",params:[{blockStateCalls:v,returnFullTransactions:u,traceTransfers:p,validation:r},E]})).map((k,R)=>({...DP(k),calls:k.calls.map((D,O)=>{var ce,ye;const{abi:F,args:U,functionName:X,to:W}=l[R].calls[O],K=((ce=D.error)==null?void 0:ce.data)??D.returnData,ne=BigInt(D.gasUsed),te=(ye=D.logs)==null?void 0:ye.map(Ce=>tg(Ce)),re=D.status==="0x1"?"success":"failure",xe=F&&re==="success"&&K!=="0x"?Zx({abi:F,data:K,functionName:X}):null,ae=(()=>{var Me;if(re==="success")return;let Ce;if(((Me=D.error)==null?void 0:Me.data)==="0x"?Ce=new Yw:D.error&&(Ce=new eA(D.error)),!!Ce)return Px(Ce,{abi:F??[],address:W??"0x",args:U,functionName:X??"<unknown>"})})();return{data:K,gasUsed:ne,logs:te,status:re,...re==="success"?{result:xe}:{error:ae}}})}))}catch(v){const w=v,E=oA(w,{});throw E instanceof a2?w:E}}function sk(t){let e=!0,n="",s=0,l="",u=!1;for(let p=0;p<t.length;p++){const r=t[p];if(["(",")",","].includes(r)&&(e=!0),r==="("&&s++,r===")"&&s--,!!e){if(s===0){if(r===" "&&["event","function","error",""].includes(l))l="";else if(l+=r,r===")"){u=!0;break}continue}if(r===" "){t[p-1]!==","&&n!==","&&n!==",("&&(n="",e=!1);continue}l+=r,n+=r}}if(!u)throw new Vs("Unable to normalize signature.");return l}function ok(t,e){const n=typeof t,s=e.type;switch(s){case"address":return K5(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in e?Object.values(e.components).every((l,u)=>ok(Object.values(t)[u],l)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(t)&&t.every(l=>ok(l,{...e,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function f9(t,e,n){for(const s in t){const l=t[s],u=e[s];if(l.type==="tuple"&&u.type==="tuple"&&"components"in l&&"components"in u)return f9(l.components,u.components,n[s]);const p=[l.type,u.type];if(p.includes("address")&&p.includes("bytes20")?!0:p.includes("address")&&p.includes("string")?K5(n[s],{strict:!1}):p.includes("address")&&p.includes("bytes")?K5(n[s],{strict:!1}):!1)return p}}function p9(t,e={}){const{prepare:n=!0}=e,s=Array.isArray(t)||typeof t=="string"?hL(t):t;return{...s,...n?{hash:xv(s)}:{}}}function xA(t,e,n){const{args:s=[],prepare:l=!0}=n??{},u=Zee(e,{strict:!1}),p=t.filter(w=>u?w.type==="function"||w.type==="error"?m9(w)===xp(e,0,4):w.type==="event"?xv(w)===e:!1:"name"in w&&w.name===e);if(p.length===0)throw new cE({name:e});if(p.length===1)return{...p[0],...l?{hash:xv(p[0])}:{}};let r;for(const w of p){if(!("inputs"in w))continue;if(!s||s.length===0){if(!w.inputs||w.inputs.length===0)return{...w,...l?{hash:xv(w)}:{}};continue}if(!w.inputs||w.inputs.length===0||w.inputs.length!==s.length)continue;if(s.every((T,k)=>{const R="inputs"in w&&w.inputs[k];return R?ok(T,R):!1})){if(r&&"inputs"in r&&r.inputs){const T=f9(w.inputs,r.inputs,s);if(T)throw new cie({abiItem:w,type:T[0]},{abiItem:r,type:T[1]})}r=w}}const v=(()=>{if(r)return r;const[w,...E]=p;return{...w,overloads:E}})();if(!v)throw new cE({name:e});return{...v,...l?{hash:xv(v)}:{}}}function m9(...t){const e=(()=>{if(Array.isArray(t[0])){const[n,s]=t;return xA(n,s)}return t[0]})();return xp(xv(e),0,4)}function lie(...t){const e=(()=>{if(Array.isArray(t[0])){const[s,l]=t;return xA(s,l)}return t[0]})(),n=typeof e=="string"?e:oE(e);return sk(n)}function xv(...t){const e=(()=>{if(Array.isArray(t[0])){const[n,s]=t;return xA(n,s)}return t[0]})();return typeof e!="string"&&"hash"in e&&e.hash?e.hash:H7(CP(lie(e)))}class cie extends Vs{constructor(e,n){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${e.type}\` in \`${sk(oE(e.abiItem))}\`, and`,`\`${n.type}\` in \`${sk(oE(n.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class cE extends Vs{constructor({name:e,data:n,type:s="item"}){const l=e?` with name "${e}"`:n?` with data "${n}"`:"";super(`ABI ${s}${l} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}function uie(...t){var u;const[e,n]=(()=>{if(Array.isArray(t[0])){const[p,r]=t;return[hie(p),r]}return t})(),{bytecode:s,args:l}=n;return ff(s,(u=e.inputs)!=null&&u.length&&(l!=null&&l.length)?eR(e.inputs,l):"0x")}function die(t){return p9(t)}function hie(t){const e=t.find(n=>n.type==="constructor");if(!e)throw new cE({name:"constructor"});return e}function fie(...t){const[e,n=[]]=(()=>{if(Array.isArray(t[0])){const[w,E,T]=t;return[$L(w,E,{args:T}),T]}const[r,v]=t;return[r,v]})(),{overloads:s}=e,l=s?$L([e,...s],e.name,{args:n}):e,u=pie(l),p=n.length>0?eR(l.inputs,n):void 0;return p?ff(u,p):u}function z_(t,e={}){return p9(t,e)}function $L(t,e,n){const s=xA(t,e,n);if(s.type!=="function")throw new cE({name:e,type:"function"});return s}function pie(t){return m9(t)}const mie="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",lp="0x0000000000000000000000000000000000000000",gie="0x6080604052348015600e575f80fd5b5061016d8061001c5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063f8b2cb4f1461002d575b5f80fd5b610047600480360381019061004291906100db565b61005d565b604051610054919061011e565b60405180910390f35b5f8173ffffffffffffffffffffffffffffffffffffffff16319050919050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100aa82610081565b9050919050565b6100ba816100a0565b81146100c4575f80fd5b50565b5f813590506100d5816100b1565b92915050565b5f602082840312156100f0576100ef61007d565b5b5f6100fd848285016100c7565b91505092915050565b5f819050919050565b61011881610106565b82525050565b5f6020820190506101315f83018461010f565b9291505056fea26469706673582212203b9fe929fe995c7cf9887f0bdba8a36dd78e8b73f149b17d2d9ad7cd09d2dc6264736f6c634300081a0033";async function yie(t,e){const{blockNumber:n,blockTag:s,calls:l,stateOverrides:u,traceAssetChanges:p,traceTransfers:r,validation:v}=e,w=e.account?Fo(e.account):void 0;if(p&&!w)throw new Wn("`account` is required when `traceAssetChanges` is true");const E=w?uie(die("constructor(bytes, bytes)"),{bytecode:JU,args:[gie,fie(z_("function getBalance(address)"),[w.address])]}):void 0,T=p?await Promise.all(e.calls.map(async Ae=>{if(!Ae.data&&!Ae.abi)return;const{accessList:He}=await l7(t,{account:w.address,...Ae,data:Ae.abi?gd(Ae):Ae.data});return He.map(({address:qe,storageKeys:Le})=>Le.length>0?qe:null)})).then(Ae=>Ae.flat().filter(Boolean)):[],k=await ik(t,{blockNumber:n,blockTag:s,blocks:[...p?[{calls:[{data:E}],stateOverrides:u},{calls:T.map((Ae,He)=>({abi:[z_("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[w.address],to:Ae,from:lp,nonce:He})),stateOverrides:[{address:lp,nonce:0}]}]:[],{calls:[...l,{}].map(Ae=>({...Ae,from:w==null?void 0:w.address})),stateOverrides:u},...p?[{calls:[{data:E}]},{calls:T.map((Ae,He)=>({abi:[z_("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[w.address],to:Ae,from:lp,nonce:He})),stateOverrides:[{address:lp,nonce:0}]},{calls:T.map((Ae,He)=>({to:Ae,abi:[z_("function decimals() returns (uint256)")],functionName:"decimals",from:lp,nonce:He})),stateOverrides:[{address:lp,nonce:0}]},{calls:T.map((Ae,He)=>({to:Ae,abi:[z_("function tokenURI(uint256) returns (string)")],functionName:"tokenURI",args:[0n],from:lp,nonce:He})),stateOverrides:[{address:lp,nonce:0}]},{calls:T.map((Ae,He)=>({to:Ae,abi:[z_("function symbol() returns (string)")],functionName:"symbol",from:lp,nonce:He})),stateOverrides:[{address:lp,nonce:0}]}]:[]],traceTransfers:r,validation:v}),R=p?k[2]:k[0],[D,O,,F,U,X,W,K]=p?k:[],{calls:ne,...te}=R,re=ne.slice(0,-1)??[],xe=(D==null?void 0:D.calls)??[],ae=(O==null?void 0:O.calls)??[],ce=[...xe,...ae].map(Ae=>Ae.status==="success"?dd(Ae.data):null),ye=(F==null?void 0:F.calls)??[],Ce=(U==null?void 0:U.calls)??[],Me=[...ye,...Ce].map(Ae=>Ae.status==="success"?dd(Ae.data):null),Ke=((X==null?void 0:X.calls)??[]).map(Ae=>Ae.status==="success"?Ae.result:null),ke=((K==null?void 0:K.calls)??[]).map(Ae=>Ae.status==="success"?Ae.result:null),je=((W==null?void 0:W.calls)??[]).map(Ae=>Ae.status==="success"?Ae.result:null),$e=[];for(const[Ae,He]of Me.entries()){const qe=ce[Ae];if(typeof He!="bigint"||typeof qe!="bigint")continue;const Le=Ke[Ae-1],st=ke[Ae-1],bt=je[Ae-1],yt=Ae===0?{address:mie,decimals:18,symbol:"ETH"}:{address:T[Ae-1],decimals:bt||Le?Number(Le??1):void 0,symbol:st??void 0};$e.some(Vt=>Vt.token.address===yt.address)||$e.push({token:yt,value:{pre:qe,post:He,diff:He-qe}})}return{assetChanges:$e,block:te,results:re}}async function xie(t,e){const{abi:n,address:s,args:l,dataSuffix:u,functionName:p,...r}=e,v=r.account?Fo(r.account):t.account,w=gd({abi:n,args:l,functionName:p});try{const{data:E}=await pi(t,lA,"call")({batch:!1,data:`${w}${u?u.replace("0x",""):""}`,to:s,...r,account:v}),T=Zx({abi:n,args:l,functionName:p,data:E||"0x"}),k=n.filter(R=>"name"in R&&R.name===e.functionName);return{result:T,request:{abi:k,address:s,args:l,dataSuffix:u,functionName:p,...r,account:v}}}catch(E){throw Px(E,{abi:n,address:s,args:l,docsPath:"/docs/contract/simulateContract",functionName:p,sender:v==null?void 0:v.address})}}async function _A(t,{filter:e}){return e.request({method:"eth_uninstallFilter",params:[e.id]})}const g9="0x6492649264926492649264926492649264926492649264926492649264926492";function _ie(t){if(xp(t,-32)!==g9)throw new wie(t)}function vie(t){const{data:e,signature:n,to:s}=t;return ff(eR(W7("address, bytes, bytes"),[s,e,n]),g9)}function bie(t){try{return _ie(t),!0}catch{return!1}}class wie extends Vs{constructor(e){super(`Value \`${e}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SignatureErc6492.InvalidWrappedSignatureError"})}}function y9({r:t,s:e,to:n="hex",v:s,yParity:l}){const u=(()=>{if(l===0||l===1)return l;if(s&&(s===27n||s===28n||s>=35n))return s%2n===0n?1:0;throw new Error("Invalid `v` or `yParity` value")})(),p=`0x${new yA.Signature(dd(t),dd(e)).toCompactHex()}${u===0?"1b":"1c"}`;return n==="hex"?p:sh(p)}async function vA(t,e){var r,v,w,E,T,k;const{address:n,hash:s,erc6492VerifierAddress:l=e.universalSignatureVerifierAddress??((w=(v=(r=t.chain)==null?void 0:r.contracts)==null?void 0:v.erc6492Verifier)==null?void 0:w.address),multicallAddress:u=e.multicallAddress??((k=(T=(E=t.chain)==null?void 0:E.contracts)==null?void 0:T.multicall3)==null?void 0:k.address)}=e,p=(()=>{const R=e.signature;return hf(R)?R:typeof R=="object"&&"r"in R&&"s"in R?y9(R):La(R)})();try{return Jre(p)?await Sie(t,{...e,multicallAddress:u,signature:p}):await Tie(t,{...e,verifierAddress:l,signature:p})}catch(R){try{if(d2(wl(n),await f7({hash:s,signature:p})))return!0}catch{}if(R instanceof Ox)return!1;throw R}}async function Sie(t,e){var F;const{address:n,blockNumber:s,blockTag:l,hash:u,multicallAddress:p}=e,{authorization:r,data:v,signature:w,to:E}=Yre(e.signature);if(await Z5(t,{address:n,blockNumber:s,blockTag:l})===Tp(["0xef0100",r.address]))return await Eie(t,{address:n,blockNumber:s,blockTag:l,hash:u,signature:w});const k={address:r.address,chainId:Number(r.chainId),nonce:Number(r.nonce),r:lr(r.r,{size:32}),s:lr(r.s,{size:32}),yParity:r.yParity};if(!await wne({address:n,authorization:k}))throw new Ox;const D=await pi(t,ah,"readContract")({...p?{address:p}:{code:MP},authorizationList:[k],abi:sE,blockNumber:s,blockTag:"pending",functionName:"aggregate3",args:[[...v?[{allowFailure:!0,target:E??n,callData:v}]:[],{allowFailure:!0,target:n,callData:gd({abi:$8,functionName:"isValidSignature",args:[u,w]})}]]}),O=(F=D[D.length-1])==null?void 0:F.returnData;if(O!=null&&O.startsWith("0x1626ba7e"))return!0;throw new Ox}async function Tie(t,e){const{address:n,factory:s,factoryData:l,hash:u,signature:p,verifierAddress:r,...v}=e,w=await(async()=>!s&&!l||bie(p)?p:vie({data:l,signature:p,to:s}))(),E=r?{to:r,data:gd({abi:QD,functionName:"isValidSig",args:[n,u,w]}),...v}:{data:sA({abi:QD,args:[n,u,w],bytecode:tte}),...v},{data:T}=await pi(t,lA,"call")(E).catch(k=>{throw k instanceof DU?new Ox:k});if(XK(T??"0x0"))return!0;throw new Ox}async function Eie(t,e){const{address:n,blockNumber:s,blockTag:l,hash:u,signature:p}=e;if((await pi(t,ah,"readContract")({address:n,abi:$8,args:[u,p],blockNumber:s,blockTag:l,functionName:"isValidSignature"}).catch(v=>{throw v instanceof vP?new Ox:v})).startsWith("0x1626ba7e"))return!0;throw new Ox}class Ox extends Error{}async function Aie(t,{address:e,message:n,factory:s,factoryData:l,signature:u,...p}){const r=QP(n);return pi(t,vA,"verifyHash")({address:e,factory:s,factoryData:l,hash:r,signature:u,...p})}async function Cie(t,e){const{address:n,factory:s,factoryData:l,signature:u,message:p,primaryType:r,types:v,domain:w,...E}=e,T=F7({message:p,primaryType:r,types:v,domain:w});return pi(t,vA,"verifyHash")({address:n,factory:s,factoryData:l,hash:T,signature:u,...E})}const HC=new Map,WL=new Map;let Mie=0;function ng(t,e,n){const s=++Mie,l=()=>HC.get(t)||[],u=()=>{const E=l();HC.set(t,E.filter(T=>T.id!==s))},p=()=>{const E=l();if(!E.some(k=>k.id===s))return;const T=WL.get(t);if(E.length===1&&T){const k=T();k instanceof Promise&&k.catch(()=>{})}u()},r=l();if(HC.set(t,[...r,{id:s,fns:e}]),r&&r.length>0)return p;const v={};for(const E in e)v[E]=((...T)=>{var R,D;const k=l();if(k.length!==0)for(const O of k)(D=(R=O.fns)[E])==null||D.call(R,...T)});const w=n(v);return typeof w=="function"&&WL.set(t,w),p}function gb(t,{emitOnBegin:e,initialWaitTime:n,interval:s}){let l=!0;const u=()=>l=!1;return(async()=>{let r;e&&(r=await t({unpoll:u}));const v=await(n==null?void 0:n(r))??s;await Q5(v);const w=async()=>{l&&(await t({unpoll:u}),await Q5(s),w())};w()})(),u}function x9(t,{emitOnBegin:e=!1,emitMissed:n=!1,onBlockNumber:s,onError:l,poll:u,pollingInterval:p=t.pollingInterval}){const r=typeof u<"u"?u:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc"));let v;return r?(()=>{const T=Ka(["watchBlockNumber",t.uid,e,n,p]);return ng(T,{onBlockNumber:s,onError:l},k=>gb(async()=>{var R;try{const D=await pi(t,u2,"getBlockNumber")({cacheTime:0});if(v!==void 0){if(D===v)return;if(D-v>1&&n)for(let O=v+1n;O<D;O++)k.onBlockNumber(O,v),v=O}(v===void 0||D>v)&&(k.onBlockNumber(D,v),v=D)}catch(D){(R=k.onError)==null||R.call(k,D)}},{emitOnBegin:e,interval:p}))})():(()=>{const T=Ka(["watchBlockNumber",t.uid,e,n]);return ng(T,{onBlockNumber:s,onError:l},k=>{let R=!0,D=()=>R=!1;return(async()=>{try{const O=(()=>{if(t.transport.type==="fallback"){const U=t.transport.transports.find(X=>X.config.type==="webSocket"||X.config.type==="ipc");return U?U.value:t.transport}return t.transport})(),{unsubscribe:F}=await O.subscribe({params:["newHeads"],onData(U){var W;if(!R)return;const X=dd((W=U.result)==null?void 0:W.number);k.onBlockNumber(X,v),v=X},onError(U){var X;(X=k.onError)==null||X.call(k,U)}});D=F,R||D()}catch(O){l==null||l(O)}})(),()=>D()})})()}async function _9(t,e){const{checkReplacement:n=!0,confirmations:s=1,hash:l,onReplaced:u,retryCount:p=6,retryDelay:r=({count:ne})=>~~(1<<ne)*200,timeout:v=18e4}=e,w=Ka(["waitForTransactionReceipt",t.uid,l]),E=(()=>{var ne;return e.pollingInterval?e.pollingInterval:(ne=t.chain)!=null&&ne.experimental_preconfirmationTime?t.chain.experimental_preconfirmationTime:t.pollingInterval})();let T,k,R,D=!1,O,F;const{promise:U,resolve:X,reject:W}=IP(),K=v?setTimeout(()=>{F==null||F(),O==null||O(),W(new oee({hash:l}))},v):void 0;return O=ng(w,{onReplaced:u,resolve:X,reject:W},async ne=>{if(R=await pi(t,NT,"getTransactionReceipt")({hash:l}).catch(()=>{}),R&&s<=1){clearTimeout(K),ne.resolve(R),O==null||O();return}F=pi(t,x9,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:E,async onBlockNumber(te){const re=ae=>{clearTimeout(K),F==null||F(),ae(),O==null||O()};let xe=te;if(!D)try{if(R){if(s>1&&(!R.blockNumber||xe-R.blockNumber+1n<s))return;re(()=>ne.resolve(R));return}if(n&&!T&&(D=!0,await Lx(async()=>{T=await pi(t,sR,"getTransaction")({hash:l}),T.blockNumber&&(xe=T.blockNumber)},{delay:r,retryCount:p}),D=!1),R=await pi(t,NT,"getTransactionReceipt")({hash:l}),s>1&&(!R.blockNumber||xe-R.blockNumber+1n<s))return;re(()=>ne.resolve(R))}catch(ae){if(ae instanceof RU||ae instanceof NU){if(!T){D=!1;return}try{k=T,D=!0;const ce=await Lx(()=>pi(t,cf,"getBlock")({blockNumber:xe,includeTransactions:!0}),{delay:r,retryCount:p,shouldRetry:({error:Me})=>Me instanceof x7});D=!1;const ye=ce.transactions.find(({from:Me,nonce:Ke})=>Me===k.from&&Ke===k.nonce);if(!ye||(R=await pi(t,NT,"getTransactionReceipt")({hash:ye.hash}),s>1&&(!R.blockNumber||xe-R.blockNumber+1n<s)))return;let Ce="replaced";ye.to===k.to&&ye.value===k.value&&ye.input===k.input?Ce="repriced":ye.from===ye.to&&ye.value===0n&&(Ce="cancelled"),re(()=>{var Me;(Me=ne.onReplaced)==null||Me.call(ne,{reason:Ce,replacedTransaction:k,transaction:ye,transactionReceipt:R}),ne.resolve(R)})}catch(ce){re(()=>ne.reject(ce))}}else re(()=>ne.reject(ae))}}})}),U}function kie(t,{blockTag:e=t.experimental_blockTag??"latest",emitMissed:n=!1,emitOnBegin:s=!1,onBlock:l,onError:u,includeTransactions:p,poll:r,pollingInterval:v=t.pollingInterval}){const w=typeof r<"u"?r:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc")),E=p??!1;let T;return w?(()=>{const D=Ka(["watchBlocks",t.uid,e,n,s,E,v]);return ng(D,{onBlock:l,onError:u},O=>gb(async()=>{var F;try{const U=await pi(t,cf,"getBlock")({blockTag:e,includeTransactions:E});if(U.number!==null&&(T==null?void 0:T.number)!=null){if(U.number===T.number)return;if(U.number-T.number>1&&n)for(let X=(T==null?void 0:T.number)+1n;X<U.number;X++){const W=await pi(t,cf,"getBlock")({blockNumber:X,includeTransactions:E});O.onBlock(W,T),T=W}}((T==null?void 0:T.number)==null||e==="pending"&&(U==null?void 0:U.number)==null||U.number!==null&&U.number>T.number)&&(O.onBlock(U,T),T=U)}catch(U){(F=O.onError)==null||F.call(O,U)}},{emitOnBegin:s,interval:v}))})():(()=>{let D=!0,O=!0,F=()=>D=!1;return(async()=>{try{s&&pi(t,cf,"getBlock")({blockTag:e,includeTransactions:E}).then(W=>{D&&O&&(l(W,void 0),O=!1)}).catch(u);const U=(()=>{if(t.transport.type==="fallback"){const W=t.transport.transports.find(K=>K.config.type==="webSocket"||K.config.type==="ipc");return W?W.value:t.transport}return t.transport})(),{unsubscribe:X}=await U.subscribe({params:["newHeads"],async onData(W){var ne;if(!D)return;const K=await pi(t,cf,"getBlock")({blockNumber:(ne=W.result)==null?void 0:ne.number,includeTransactions:E}).catch(()=>{});D&&(l(K,T),O=!1,T=K)},onError(W){u==null||u(W)}});F=X,D||F()}catch(U){u==null||u(U)}})(),()=>F()})()}function Iie(t,e){const{abi:n,address:s,args:l,batch:u=!0,eventName:p,fromBlock:r,onError:v,onLogs:w,poll:E,pollingInterval:T=t.pollingInterval,strict:k}=e;return(typeof E<"u"?E:typeof r=="bigint"?!0:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc")))?(()=>{const F=k??!1,U=Ka(["watchContractEvent",s,l,u,t.uid,p,T,F,r]);return ng(U,{onLogs:w,onError:v},X=>{let W;r!==void 0&&(W=r-1n);let K,ne=!1;const te=gb(async()=>{var re;if(!ne){try{K=await pi(t,c7,"createContractEventFilter")({abi:n,address:s,args:l,eventName:p,strict:F,fromBlock:r})}catch{}ne=!0;return}try{let xe;if(K)xe=await pi(t,fA,"getFilterChanges")({filter:K});else{const ae=await pi(t,u2,"getBlockNumber")({});W&&W<ae?xe=await pi(t,N7,"getContractEvents")({abi:n,address:s,args:l,eventName:p,fromBlock:W+1n,toBlock:ae,strict:F}):xe=[],W=ae}if(xe.length===0)return;if(u)X.onLogs(xe);else for(const ae of xe)X.onLogs([ae])}catch(xe){K&&xe instanceof U0&&(ne=!1),(re=X.onError)==null||re.call(X,xe)}},{emitOnBegin:!0,interval:T});return async()=>{K&&await pi(t,_A,"uninstallFilter")({filter:K}),te()}})})():(()=>{const F=k??!1,U=Ka(["watchContractEvent",s,l,u,t.uid,p,T,F]);let X=!0,W=()=>X=!1;return ng(U,{onLogs:w,onError:v},K=>((async()=>{try{const ne=(()=>{if(t.transport.type==="fallback"){const xe=t.transport.transports.find(ae=>ae.config.type==="webSocket"||ae.config.type==="ipc");return xe?xe.value:t.transport}return t.transport})(),te=p?l2({abi:n,eventName:p,args:l}):[],{unsubscribe:re}=await ne.subscribe({params:["logs",{address:s,topics:te}],onData(xe){var ce;if(!X)return;const ae=xe.result;try{const{eventName:ye,args:Ce}=GP({abi:n,data:ae.data,topics:ae.topics,strict:k}),Me=tg(ae,{args:Ce,eventName:ye});K.onLogs([Me])}catch(ye){let Ce,Me;if(ye instanceof Y1||ye instanceof XE){if(k)return;Ce=ye.abiItem.name,Me=(ce=ye.abiItem.inputs)==null?void 0:ce.some(ke=>!("name"in ke&&ke.name))}const Ke=tg(ae,{args:Me?[]:{},eventName:Ce});K.onLogs([Ke])}},onError(xe){var ae;(ae=K.onError)==null||ae.call(K,xe)}});W=re,X||W()}catch(ne){v==null||v(ne)}})(),()=>W()))})()}function Pie(t,{address:e,args:n,batch:s=!0,event:l,events:u,fromBlock:p,onError:r,onLogs:v,poll:w,pollingInterval:E=t.pollingInterval,strict:T}){const k=typeof w<"u"?w:typeof p=="bigint"?!0:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc")),R=T??!1;return k?(()=>{const F=Ka(["watchEvent",e,n,s,t.uid,l,E,p]);return ng(F,{onLogs:v,onError:r},U=>{let X;p!==void 0&&(X=p-1n);let W,K=!1;const ne=gb(async()=>{var te;if(!K){try{W=await pi(t,u7,"createEventFilter")({address:e,args:n,event:l,events:u,strict:R,fromBlock:p})}catch{}K=!0;return}try{let re;if(W)re=await pi(t,fA,"getFilterChanges")({filter:W});else{const xe=await pi(t,u2,"getBlockNumber")({});X&&X!==xe?re=await pi(t,WP,"getLogs")({address:e,args:n,event:l,events:u,fromBlock:X+1n,toBlock:xe}):re=[],X=xe}if(re.length===0)return;if(s)U.onLogs(re);else for(const xe of re)U.onLogs([xe])}catch(re){W&&re instanceof U0&&(K=!1),(te=U.onError)==null||te.call(U,re)}},{emitOnBegin:!0,interval:E});return async()=>{W&&await pi(t,_A,"uninstallFilter")({filter:W}),ne()}})})():(()=>{let F=!0,U=()=>F=!1;return(async()=>{try{const X=(()=>{if(t.transport.type==="fallback"){const te=t.transport.transports.find(re=>re.config.type==="webSocket"||re.config.type==="ipc");return te?te.value:t.transport}return t.transport})(),W=u??(l?[l]:void 0);let K=[];W&&(K=[W.flatMap(re=>l2({abi:[re],eventName:re.name,args:n}))],l&&(K=K[0]));const{unsubscribe:ne}=await X.subscribe({params:["logs",{address:e,topics:K}],onData(te){var xe;if(!F)return;const re=te.result;try{const{eventName:ae,args:ce}=GP({abi:W??[],data:re.data,topics:re.topics,strict:R}),ye=tg(re,{args:ce,eventName:ae});v([ye])}catch(ae){let ce,ye;if(ae instanceof Y1||ae instanceof XE){if(T)return;ce=ae.abiItem.name,ye=(xe=ae.abiItem.inputs)==null?void 0:xe.some(Me=>!("name"in Me&&Me.name))}const Ce=tg(re,{args:ye?[]:{},eventName:ce});v([Ce])}},onError(te){r==null||r(te)}});U=ne,F||U()}catch(X){r==null||r(X)}})(),()=>U()})()}function Rie(t,{batch:e=!0,onError:n,onTransactions:s,poll:l,pollingInterval:u=t.pollingInterval}){return(typeof l<"u"?l:t.transport.type!=="webSocket"&&t.transport.type!=="ipc")?(()=>{const w=Ka(["watchPendingTransactions",t.uid,e,u]);return ng(w,{onTransactions:s,onError:n},E=>{let T;const k=gb(async()=>{var R;try{if(!T)try{T=await pi(t,d7,"createPendingTransactionFilter")({});return}catch(O){throw k(),O}const D=await pi(t,fA,"getFilterChanges")({filter:T});if(D.length===0)return;if(e)E.onTransactions(D);else for(const O of D)E.onTransactions([O])}catch(D){(R=E.onError)==null||R.call(E,D)}},{emitOnBegin:!0,interval:u});return async()=>{T&&await pi(t,_A,"uninstallFilter")({filter:T}),k()}})})():(()=>{let w=!0,E=()=>w=!1;return(async()=>{try{const{unsubscribe:T}=await t.transport.subscribe({params:["newPendingTransactions"],onData(k){if(!w)return;const R=k.result;s([R])},onError(k){n==null||n(k)}});E=T,w||E()}catch(T){n==null||n(T)}})(),()=>E()})()}async function Nie(t,{chain:e}){const{id:n,name:s,nativeCurrency:l,rpcUrls:u,blockExplorers:p}=e;await t.request({method:"wallet_addEthereumChain",params:[{chainId:lr(n),chainName:s,nativeCurrency:l,rpcUrls:u.default.http,blockExplorerUrls:p?Object.values(p).map(({url:r})=>r):void 0}]},{dedupe:!0,retryCount:0})}class Q0 extends Wn{constructor({docsPath:e}={}){super(["Could not find an Account to execute with this Action.","Please provide an Account with the `account` argument on the Action, or by supplying an `account` to the Client."].join(`
`),{docsPath:e,docsSlug:"account",name:"AccountNotFoundError"})}}class bx extends Wn{constructor({docsPath:e,metaMessages:n,type:s}){super(`Account type "${s}" is not supported.`,{docsPath:e,metaMessages:n,name:"AccountTypeNotSupportedError"})}}async function oR(t,{serializedTransaction:e}){return t.request({method:"eth_sendRawTransaction",params:[e]},{retryCount:0})}const GC=new hb(128);async function bA(t,e){var X,W,K,ne;const{account:n=t.account,chain:s=t.chain,accessList:l,authorizationList:u,blobs:p,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,type:D,value:O,...F}=e;if(typeof n>"u")throw new Q0({docsPath:"/docs/actions/wallet/sendTransaction"});const U=n?Fo(n):null;try{ug(e);const te=await(async()=>{if(e.to)return e.to;if(e.to!==null&&u&&u.length>0)return await uA({authorization:u[0]}).catch(()=>{throw new Wn("`to` is required. Could not infer from `authorizationList`.")})})();if((U==null?void 0:U.type)==="json-rpc"||U===null){let re;s!==null&&(re=await pi(t,Z0,"getChainId")({}),XP({currentChainId:re,chain:s}));const xe=(K=(W=(X=t.chain)==null?void 0:X.formatters)==null?void 0:W.transactionRequest)==null?void 0:K.format,ce=(xe||X0)({...mb(F,{format:xe}),accessList:l,account:U,authorizationList:u,blobs:p,chainId:re,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,to:te,type:D,value:O},"sendTransaction"),ye=GC.get(t.uid),Ce=ye?"wallet_sendTransaction":"eth_sendTransaction";try{return await t.request({method:Ce,params:[ce]},{retryCount:0})}catch(Me){if(ye===!1)throw Me;const Ke=Me;if(Ke.name==="InvalidInputRpcError"||Ke.name==="InvalidParamsRpcError"||Ke.name==="MethodNotFoundRpcError"||Ke.name==="MethodNotSupportedRpcError")return await t.request({method:"wallet_sendTransaction",params:[ce]},{retryCount:0}).then(ke=>(GC.set(t.uid,!0),ke)).catch(ke=>{const je=ke;throw je.name==="MethodNotFoundRpcError"||je.name==="MethodNotSupportedRpcError"?(GC.set(t.uid,!1),Ke):je});throw Ke}}if((U==null?void 0:U.type)==="local"){const re=await pi(t,c2,"prepareTransactionRequest")({account:U,accessList:l,authorizationList:u,blobs:p,chain:s,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,nonceManager:U.nonceManager,parameters:[...VP,"sidecars"],type:D,value:O,...F,to:te}),xe=(ne=s==null?void 0:s.serializers)==null?void 0:ne.transaction,ae=await U.signTransaction(re,{serializer:xe});return await pi(t,oR,"sendRawTransaction")({serializedTransaction:ae})}throw(U==null?void 0:U.type)==="smart"?new bx({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new bx({docsPath:"/docs/actions/wallet/sendTransaction",type:U==null?void 0:U.type})}catch(te){throw te instanceof bx?te:hA(te,{...e,account:U,chain:e.chain||void 0})}}function jie(t,e){const{abi:n,args:s,bytecode:l,...u}=e,p=sA({abi:n,args:s,bytecode:l});return bA(t,{...u,...u.authorizationList?{to:null}:{},data:p})}async function Die(t){var n;return((n=t.account)==null?void 0:n.type)==="local"?[t.account.address]:(await t.request({method:"eth_accounts"},{dedupe:!0})).map(s=>Jw(s))}const v9="0x5792579257925792579257925792579257925792579257925792579257925792",b9=lr(0,{size:32});async function w9(t,e){const{account:n=t.account,capabilities:s,chain:l=t.chain,experimental_fallback:u,experimental_fallbackDelay:p=32,forceAtomic:r=!1,id:v,version:w="2.0.0"}=e,E=n?Fo(n):null,T=e.calls.map(k=>{const R=k,D=R.abi?gd({abi:R.abi,functionName:R.functionName,args:R.args}):R.data;return{data:R.dataSuffix&&D?oh([D,R.dataSuffix]):D,to:R.to,value:R.value?lr(R.value):void 0}});try{const k=await t.request({method:"wallet_sendCalls",params:[{atomicRequired:r,calls:T,capabilities:s,chainId:lr(l.id),from:E==null?void 0:E.address,id:v,version:w}]},{retryCount:0});return typeof k=="string"?{id:k}:k}catch(k){const R=k;if(u&&(R.name==="MethodNotFoundRpcError"||R.name==="MethodNotSupportedRpcError"||R.name==="UnknownRpcError"||R.details.toLowerCase().includes("does not exist / is not available")||R.details.toLowerCase().includes("missing or invalid. request()")||R.details.toLowerCase().includes("did not match any variant of untagged enum")||R.details.toLowerCase().includes("account upgraded to unsupported contract")||R.details.toLowerCase().includes("eip-7702 not supported")||R.details.toLowerCase().includes("unsupported wc_ method")||R.details.toLowerCase().includes("feature toggled misconfigured")||R.details.toLowerCase().includes("jsonrpcengine: response has no error or result for request"))){if(s&&Object.values(s).some(X=>!X.optional)){const X="non-optional `capabilities` are not supported on fallback to `eth_sendTransaction`.";throw new Zv(new Wn(X,{details:X}))}if(r&&T.length>1){const U="`forceAtomic` is not supported on fallback to `eth_sendTransaction`.";throw new Qv(new Wn(U,{details:U}))}const D=[];for(const U of T){const X=bA(t,{account:E,chain:l,data:U.data,to:U.to,value:U.value?dd(U.value):void 0});D.push(X),p>0&&await new Promise(W=>setTimeout(W,p))}const O=await Promise.allSettled(D);if(O.every(U=>U.status==="rejected"))throw O[0].reason;const F=O.map(U=>U.status==="fulfilled"?U.value:b9);return{id:oh([...F,lr(l.id,{size:32}),v9])}}throw hA(k,{...e,account:E,chain:e.chain})}}async function S9(t,e){async function n(E){if(E.endsWith(v9.slice(2))){const k=vu(M5(E,-64,-32)),R=M5(E,0,-64).slice(2).match(/.{1,64}/g),D=await Promise.all(R.map(F=>b9.slice(2)!==F?t.request({method:"eth_getTransactionReceipt",params:[`0x${F}`]},{dedupe:!0}):void 0)),O=D.some(F=>F===null)?100:D.every(F=>(F==null?void 0:F.status)==="0x1")?200:D.every(F=>(F==null?void 0:F.status)==="0x0")?500:600;return{atomic:!1,chainId:hd(k),receipts:D.filter(Boolean),status:O,version:"2.0.0"}}return t.request({method:"wallet_getCallsStatus",params:[E]})}const{atomic:s=!1,chainId:l,receipts:u,version:p="2.0.0",...r}=await n(e.id),[v,w]=(()=>{const E=r.status;return E>=100&&E<200?["pending",E]:E>=200&&E<300?["success",E]:E>=300&&E<700?["failure",E]:E==="CONFIRMED"?["success",200]:E==="PENDING"?["pending",100]:[void 0,E]})();return{...r,atomic:s,chainId:l?hd(l):void 0,receipts:(u==null?void 0:u.map(E=>({...E,blockNumber:dd(E.blockNumber),gasUsed:dd(E.gasUsed),status:D7[E.status]})))??[],statusCode:w,status:v,version:p}}async function Lie(t,e={}){const{account:n=t.account,chainId:s}=e,l=n?Fo(n):void 0,u=s?[l==null?void 0:l.address,[lr(s)]]:[l==null?void 0:l.address],p=await t.request({method:"wallet_getCapabilities",params:u}),r={};for(const[v,w]of Object.entries(p)){r[Number(v)]={};for(let[E,T]of Object.entries(w))E==="addSubAccount"&&(E="unstable_addSubAccount"),r[Number(v)][E]=T}return typeof s=="number"?r[s]:r}async function Oie(t){return await t.request({method:"wallet_getPermissions"},{dedupe:!0})}async function T9(t,e){var v;const{account:n=t.account,chainId:s,nonce:l}=e;if(!n)throw new Q0({docsPath:"/docs/eip7702/prepareAuthorization"});const u=Fo(n),p=(()=>{if(e.executor)return e.executor==="self"?e.executor:Fo(e.executor)})(),r={address:e.contractAddress??e.address,chainId:s,nonce:l};return typeof r.chainId>"u"&&(r.chainId=((v=t.chain)==null?void 0:v.id)??await pi(t,Z0,"getChainId")({})),typeof r.nonce>"u"&&(r.nonce=await pi(t,OP,"getTransactionCount")({address:u.address,blockTag:"pending"}),(p==="self"||p!=null&&p.address&&d2(p.address,u.address))&&(r.nonce+=1)),r}async function Fie(t){return(await t.request({method:"eth_requestAccounts"},{dedupe:!0,retryCount:0})).map(n=>wl(n))}async function Bie(t,e){return t.request({method:"wallet_requestPermissions",params:[e]},{retryCount:0})}class zie extends Wn{constructor(e){super(`Call bundle failed with status: ${e.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=e}}async function E9(t,e){const{id:n,pollingInterval:s=t.pollingInterval,status:l=({statusCode:O})=>O===200||O>=300,retryCount:u=4,retryDelay:p=({count:O})=>~~(1<<O)*200,timeout:r=6e4,throwOnFailure:v=!1}=e,w=Ka(["waitForCallsStatus",t.uid,n]),{promise:E,resolve:T,reject:k}=IP();let R;const D=ng(w,{resolve:T,reject:k},O=>{const F=gb(async()=>{const U=X=>{clearTimeout(R),F(),X(),D()};try{const X=await Lx(async()=>{const W=await pi(t,S9,"getCallsStatus")({id:n});if(v&&W.status==="failure")throw new zie(W);return W},{retryCount:u,delay:p});if(!l(X))return;U(()=>O.resolve(X))}catch(X){U(()=>O.reject(X))}},{interval:s,emitOnBegin:!0});return F});return R=r?setTimeout(()=>{D(),clearTimeout(R),k(new Uie({id:n}))},r):void 0,await E}class Uie extends Wn{constructor({id:e}){super(`Timed out while waiting for call bundle with id "${e}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}async function Vie(t,e){const{chain:n=t.chain}=e,s=e.timeout??Math.max(((n==null?void 0:n.blockTime)??0)*3,5e3),l=await w9(t,e);return await E9(t,{...e,id:l.id,timeout:s})}async function aR(t,{serializedTransaction:e,throwOnReceiptRevert:n,timeout:s}){var r,v,w;const l=await t.request({method:"eth_sendRawTransactionSync",params:s?[e,lr(s)]:[e]},{retryCount:0}),p=(((w=(v=(r=t.chain)==null?void 0:r.formatters)==null?void 0:v.transactionReceipt)==null?void 0:w.format)||ZP)(l);if(p.status==="reverted"&&n)throw new jU({receipt:p});return p}const $C=new hb(128);async function A9(t,e){var ne,te,re,xe;const{account:n=t.account,chain:s=t.chain,accessList:l,authorizationList:u,blobs:p,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,pollingInterval:D,throwOnReceiptRevert:O,type:F,value:U,...X}=e,W=e.timeout??Math.max(((s==null?void 0:s.blockTime)??0)*3,5e3);if(typeof n>"u")throw new Q0({docsPath:"/docs/actions/wallet/sendTransactionSync"});const K=n?Fo(n):null;try{ug(e);const ae=await(async()=>{if(e.to)return e.to;if(e.to!==null&&u&&u.length>0)return await uA({authorization:u[0]}).catch(()=>{throw new Wn("`to` is required. Could not infer from `authorizationList`.")})})();if((K==null?void 0:K.type)==="json-rpc"||K===null){let ce;s!==null&&(ce=await pi(t,Z0,"getChainId")({}),XP({currentChainId:ce,chain:s}));const ye=(re=(te=(ne=t.chain)==null?void 0:ne.formatters)==null?void 0:te.transactionRequest)==null?void 0:re.format,Me=(ye||X0)({...mb(X,{format:ye}),accessList:l,account:K,authorizationList:u,blobs:p,chainId:ce,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,to:ae,type:F,value:U},"sendTransaction"),Ke=$C.get(t.uid),ke=Ke?"wallet_sendTransaction":"eth_sendTransaction",je=await(async()=>{try{return await t.request({method:ke,params:[Me]},{retryCount:0})}catch(Ae){if(Ke===!1)throw Ae;const He=Ae;if(He.name==="InvalidInputRpcError"||He.name==="InvalidParamsRpcError"||He.name==="MethodNotFoundRpcError"||He.name==="MethodNotSupportedRpcError")return await t.request({method:"wallet_sendTransaction",params:[Me]},{retryCount:0}).then(qe=>($C.set(t.uid,!0),qe)).catch(qe=>{const Le=qe;throw Le.name==="MethodNotFoundRpcError"||Le.name==="MethodNotSupportedRpcError"?($C.set(t.uid,!1),He):Le});throw He}})(),$e=await pi(t,_9,"waitForTransactionReceipt")({checkReplacement:!1,hash:je,pollingInterval:D,timeout:W});if(O&&$e.status==="reverted")throw new jU({receipt:$e});return $e}if((K==null?void 0:K.type)==="local"){const ce=await pi(t,c2,"prepareTransactionRequest")({account:K,accessList:l,authorizationList:u,blobs:p,chain:s,data:r,gas:v,gasPrice:w,maxFeePerBlobGas:E,maxFeePerGas:T,maxPriorityFeePerGas:k,nonce:R,nonceManager:K.nonceManager,parameters:[...VP,"sidecars"],type:F,value:U,...X,to:ae}),ye=(xe=s==null?void 0:s.serializers)==null?void 0:xe.transaction,Ce=await K.signTransaction(ce,{serializer:ye});return await pi(t,aR,"sendRawTransactionSync")({serializedTransaction:Ce,throwOnReceiptRevert:O})}throw(K==null?void 0:K.type)==="smart"?new bx({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new bx({docsPath:"/docs/actions/wallet/sendTransactionSync",type:K==null?void 0:K.type})}catch(ae){throw ae instanceof bx?ae:hA(ae,{...e,account:K,chain:e.chain||void 0})}}async function Hie(t,e){const{id:n}=e;await t.request({method:"wallet_showCallsStatus",params:[n]})}async function Gie(t,e){const{account:n=t.account}=e;if(!n)throw new Q0({docsPath:"/docs/eip7702/signAuthorization"});const s=Fo(n);if(!s.signAuthorization)throw new bx({docsPath:"/docs/eip7702/signAuthorization",metaMessages:["The `signAuthorization` Action does not support JSON-RPC Accounts."],type:s.type});const l=await T9(t,e);return s.signAuthorization(l)}async function C9(t,{account:e=t.account,message:n}){if(!e)throw new Q0({docsPath:"/docs/actions/wallet/signMessage"});const s=Fo(e);if(s.signMessage)return s.signMessage({message:n});const l=typeof n=="string"?Wv(n):n.raw instanceof Uint8Array?ih(n.raw):n.raw;return t.request({method:"personal_sign",params:[l,s.address]},{retryCount:0})}async function $ie(t,e){var w,E,T,k;const{account:n=t.account,chain:s=t.chain,...l}=e;if(!n)throw new Q0({docsPath:"/docs/actions/wallet/signTransaction"});const u=Fo(n);ug({account:u,...e});const p=await pi(t,Z0,"getChainId")({});s!==null&&XP({currentChainId:p,chain:s});const r=(s==null?void 0:s.formatters)||((w=t.chain)==null?void 0:w.formatters),v=((E=r==null?void 0:r.transactionRequest)==null?void 0:E.format)||X0;return u.signTransaction?u.signTransaction({...l,chainId:p},{serializer:(k=(T=t.chain)==null?void 0:T.serializers)==null?void 0:k.transaction}):await t.request({method:"eth_signTransaction",params:[{...v({...l,account:u},"signTransaction"),chainId:lr(p),from:u.address}]},{retryCount:0})}async function Wie(t,e){const{account:n=t.account,domain:s,message:l,primaryType:u}=e;if(!n)throw new Q0({docsPath:"/docs/actions/wallet/signTypedData"});const p=Fo(n),r={EIP712Domain:O7({domain:s}),...e.types};if(L7({domain:s,message:l,primaryType:u,types:r}),p.signTypedData)return p.signTypedData({domain:s,message:l,primaryType:u,types:r});const v=Nne({domain:s,message:l,primaryType:u,types:r});return t.request({method:"eth_signTypedData_v4",params:[p.address,v]},{retryCount:0})}async function qie(t,{id:e}){await t.request({method:"wallet_switchEthereumChain",params:[{chainId:lr(e)}]},{retryCount:0})}async function Xie(t,e){return await t.request({method:"wallet_watchAsset",params:e},{retryCount:0})}async function bw(t,e){return bw.internal(t,bA,"sendTransaction",e)}(function(t){async function e(n,s,l,u){const{abi:p,account:r=n.account,address:v,args:w,dataSuffix:E,functionName:T,...k}=u;if(typeof r>"u")throw new Q0({docsPath:"/docs/contract/writeContract"});const R=r?Fo(r):null,D=gd({abi:p,args:w,functionName:T});try{return await pi(n,s,l)({data:`${D}${E?E.replace("0x",""):""}`,to:v,account:R,...k})}catch(O){throw Px(O,{abi:p,address:v,args:w,docsPath:"/docs/contract/writeContract",functionName:T,sender:R==null?void 0:R.address})}}t.internal=e})(bw||(bw={}));async function Zie(t,e){return bw.internal(t,A9,"sendTransactionSync",e)}function yb(t,e,n){const s=t[e.name];if(typeof s=="function")return s;const l=t[n];return typeof l=="function"?l:u=>e(t,u)}const jT="2.22.1",Qie=()=>`@wagmi/core@${jT}`;var M9=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},uE,k9;let dg=class ak extends Error{get docsBaseUrl(){return"https://wagmi.sh/core"}get version(){return Qie()}constructor(e,n={}){var u;super(),uE.add(this),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiCoreError"});const s=n.cause instanceof ak?n.cause.details:(u=n.cause)!=null&&u.message?n.cause.message:n.details,l=n.cause instanceof ak&&n.cause.docsPath||n.docsPath;this.message=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...l?[`Docs: ${this.docsBaseUrl}${l}.html${n.docsSlug?`#${n.docsSlug}`:""}`]:[],...s?[`Details: ${s}`]:[],`Version: ${this.version}`].join(`
`),n.cause&&(this.cause=n.cause),this.details=s,this.docsPath=l,this.metaMessages=n.metaMessages,this.shortMessage=e}walk(e){return M9(this,uE,"m",k9).call(this,this,e)}};uE=new WeakSet,k9=function t(e,n){return n!=null&&n(e)?e:e.cause?M9(this,uE,"m",t).call(this,e.cause,n):e};class V0 extends dg{constructor(){super("Chain not configured."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ChainNotConfiguredError"})}}class Kie extends dg{constructor(){super("Connector already connected."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorAlreadyConnectedError"})}}class Yie extends dg{constructor(){super("Connector not connected."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorNotConnectedError"})}}class Jie extends dg{constructor({address:e,connector:n}){super(`Account "${e}" not found for connector "${n.name}".`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorAccountNotFoundError"})}}class ese extends dg{constructor({connectionChainId:e,connectorChainId:n}){super(`The current chain of the connector (id: ${n}) does not match the connection's chain (id: ${e}).`,{metaMessages:[`Current Chain ID:  ${n}`,`Expected Chain ID: ${e}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorChainMismatchError"})}}class tse extends dg{constructor({connector:e}){super(`Connector "${e.name}" unavailable while reconnecting.`,{details:["During the reconnection step, the only connector methods guaranteed to be available are: `id`, `name`, `type`, `uid`.","All other methods are not guaranteed to be available until reconnection completes and connectors are fully restored.","This error commonly occurs for connectors that asynchronously inject after reconnection has already started."].join(" ")}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorUnavailableReconnectingError"})}}async function nse(t,e){var s;let n;if(typeof e.connector=="function"?n=t._internal.connectors.setup(e.connector):n=e.connector,n.uid===t.state.current)throw new Kie;try{t.setState(r=>({...r,status:"connecting"})),n.emitter.emit("message",{type:"connecting"});const{connector:l,...u}=e,p=await n.connect(u);return n.emitter.off("connect",t._internal.events.connect),n.emitter.on("change",t._internal.events.change),n.emitter.on("disconnect",t._internal.events.disconnect),await((s=t.storage)==null?void 0:s.setItem("recentConnectorId",n.id)),t.setState(r=>({...r,connections:new Map(r.connections).set(n.uid,{accounts:u.withCapabilities?p.accounts.map(v=>typeof v=="object"?v.address:v):p.accounts,chainId:p.chainId,connector:n}),current:n.uid,status:"connected"})),{accounts:u.withCapabilities?p.accounts.map(r=>typeof r=="object"?r:{address:r,capabilities:{}}):p.accounts,chainId:p.chainId}}catch(l){throw t.setState(u=>({...u,status:u.current?"connected":"disconnected"})),l}}const lk=256;let jS=lk,DS;function I9(t=11){if(!DS||jS+t>lk*2){DS="",jS=0;for(let e=0;e<lk;e++)DS+=(256+Math.random()*256|0).toString(16).substring(1)}return DS.substring(jS,jS+++t)}function wA(t){const{batch:e,chain:n,ccipRead:s,key:l="base",name:u="Base Client",type:p="base"}=t,r=t.experimental_blockTag??(typeof(n==null?void 0:n.experimental_preconfirmationTime)=="number"?"pending":void 0),v=(n==null?void 0:n.blockTime)??12e3,w=Math.min(Math.max(Math.floor(v/2),500),4e3),E=t.pollingInterval??w,T=t.cacheTime??E,k=t.account?Fo(t.account):void 0,{config:R,request:D,value:O}=t.transport({account:k,chain:n,pollingInterval:E}),F={...R,...O},U={account:k,batch:e,cacheTime:T,ccipRead:s,chain:n,key:l,name:u,pollingInterval:E,request:D,transport:F,type:p,uid:I9(),...r?{experimental_blockTag:r}:{}};function X(W){return K=>{const ne=K(W);for(const re in U)delete ne[re];const te={...W,...ne};return Object.assign(te,{extend:X(te)})}}return Object.assign(U,{extend:X(U)})}function rse(t){var T,k,R;const{scheme:e,statement:n,...s}=((T=t.match(ise))==null?void 0:T.groups)??{},{chainId:l,expirationTime:u,issuedAt:p,notBefore:r,requestId:v,...w}=((k=t.match(sse))==null?void 0:k.groups)??{},E=(R=t.split("Resources:")[1])==null?void 0:R.split(`
- `).slice(1);return{...s,...w,...l?{chainId:Number(l)}:{},...u?{expirationTime:new Date(u)}:{},...p?{issuedAt:new Date(p)}:{},...r?{notBefore:new Date(r)}:{},...v?{requestId:v}:{},...E?{resources:E}:{},...e?{scheme:e}:{},...n?{statement:n}:{}}}const ise=/^(?:(?<scheme>[a-zA-Z][a-zA-Z0-9+-.]*):\/\/)?(?<domain>[a-zA-Z0-9+-.]*(?::[0-9]{1,5})?) (?:wants you to sign in with your Ethereum account:\n)(?<address>0x[a-fA-F0-9]{40})\n\n(?:(?<statement>.*)\n\n)?/,sse=/(?:URI: (?<uri>.+))\n(?:Version: (?<version>.+))\n(?:Chain ID: (?<chainId>\d+))\n(?:Nonce: (?<nonce>[a-zA-Z0-9]+))\n(?:Issued At: (?<issuedAt>.+))(?:\nExpiration Time: (?<expirationTime>.+))?(?:\nNot Before: (?<notBefore>.+))?(?:\nRequest ID: (?<requestId>.+))?/;function ose(t){const{address:e,domain:n,message:s,nonce:l,scheme:u,time:p=new Date}=t;if(n&&s.domain!==n||l&&s.nonce!==l||u&&s.scheme!==u||s.expirationTime&&p>=s.expirationTime||s.notBefore&&p<s.notBefore)return!1;try{if(!s.address||!Oa(s.address,{strict:!1})||e&&!d2(s.address,e))return!1}catch{return!1}return!0}async function ase(t,e){const{address:n,domain:s,message:l,nonce:u,scheme:p,signature:r,time:v=new Date,...w}=e,E=rse(l);if(!E.address||!ose({address:n,domain:s,message:E,nonce:u,scheme:p,time:v}))return!1;const k=QP(l);return vA(t,{address:E.address,hash:k,signature:r,...w})}function P9(t){return{call:e=>lA(t,e),createAccessList:e=>l7(t,e),createBlockFilter:()=>Ste(t),createContractEventFilter:e=>c7(t,e),createEventFilter:e=>u7(t,e),createPendingTransactionFilter:()=>d7(t),estimateContractGas:e=>Zte(t,e),estimateGas:e=>HP(t,e),getBalance:e=>R7(t,e),getBlobBaseFee:()=>Qte(t),getBlock:e=>cf(t,e),getBlockNumber:e=>u2(t,e),getBlockTransactionCount:e=>nne(t,e),getBytecode:e=>Z5(t,e),getChainId:()=>Z0(t),getCode:e=>Z5(t,e),getContractEvents:e=>N7(t,e),getEip712Domain:e=>one(t,e),getEnsAddress:e=>cte(t,e),getEnsAvatar:e=>o7(t,e),getEnsName:e=>a7(t,e),getEnsResolver:e=>wte(t,e),getEnsText:e=>s7(t,e),getFeeHistory:e=>cne(t,e),estimateFeesPerGas:e=>Nte(t,e),getFilterChanges:e=>fA(t,e),getFilterLogs:e=>une(t,e),getGasPrice:()=>LP(t),getLogs:e=>WP(t,e),getProof:e=>sie(t,e),estimateMaxPriorityFeePerGas:e=>Rte(t,e),fillTransaction:e=>UP(t,e),getStorageAt:e=>oie(t,e),getTransaction:e=>sR(t,e),getTransactionConfirmations:e=>aie(t,e),getTransactionCount:e=>OP(t,e),getTransactionReceipt:e=>NT(t,e),multicall:e=>h9(t,e),prepareTransactionRequest:e=>c2(t,e),readContract:e=>ah(t,e),sendRawTransaction:e=>oR(t,e),sendRawTransactionSync:e=>aR(t,e),simulate:e=>ik(t,e),simulateBlocks:e=>ik(t,e),simulateCalls:e=>yie(t,e),simulateContract:e=>xie(t,e),verifyHash:e=>vA(t,e),verifyMessage:e=>Aie(t,e),verifySiweMessage:e=>ase(t,e),verifyTypedData:e=>Cie(t,e),uninstallFilter:e=>_A(t,e),waitForTransactionReceipt:e=>_9(t,e),watchBlocks:e=>kie(t,e),watchBlockNumber:e=>x9(t,e),watchContractEvent:e=>Iie(t,e),watchEvent:e=>Pie(t,e),watchPendingTransactions:e=>Rie(t,e)}}function lR(t){const{key:e="public",name:n="Public Client"}=t;return wA({...t,key:e,name:n,type:"publicClient"}).extend(P9)}function lse(t){return{addChain:e=>Nie(t,e),deployContract:e=>jie(t,e),fillTransaction:e=>UP(t,e),getAddresses:()=>Die(t),getCallsStatus:e=>S9(t,e),getCapabilities:e=>Lie(t,e),getChainId:()=>Z0(t),getPermissions:()=>Oie(t),prepareAuthorization:e=>T9(t,e),prepareTransactionRequest:e=>c2(t,e),requestAddresses:()=>Fie(t),requestPermissions:e=>Bie(t,e),sendCalls:e=>w9(t,e),sendCallsSync:e=>Vie(t,e),sendRawTransaction:e=>oR(t,e),sendRawTransactionSync:e=>aR(t,e),sendTransaction:e=>bA(t,e),sendTransactionSync:e=>A9(t,e),showCallsStatus:e=>Hie(t,e),signAuthorization:e=>Gie(t,e),signMessage:e=>C9(t,e),signTransaction:e=>$ie(t,e),signTypedData:e=>Wie(t,e),switchChain:e=>qie(t,e),waitForCallsStatus:e=>E9(t,e),watchAsset:e=>Xie(t,e),writeContract:e=>bw(t,e),writeContractSync:e=>Zie(t,e)}}function cse(t){const{key:e="wallet",name:n="Wallet Client",transport:s}=t;return wA({...t,key:e,name:n,transport:s,type:"walletClient"}).extend(lse)}function R9({key:t,methods:e,name:n,request:s,retryCount:l=3,retryDelay:u=150,timeout:p,type:r},v){const w=I9();return{config:{key:t,methods:e,name:n,request:s,retryCount:l,retryDelay:u,timeout:p,type:r},request:Tne(s,{methods:e,retryCount:l,retryDelay:u,uid:w}),value:v}}function use(t,e={}){const{key:n="custom",methods:s,name:l="Custom Provider",retryDelay:u}=e;return({retryCount:p})=>R9({key:n,methods:s,name:l,request:t.request.bind(t),retryCount:e.retryCount??p,retryDelay:u,type:"custom"})}class dse extends Wn{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}}function f2(t,e={}){const{batch:n,fetchFn:s,fetchOptions:l,key:u="http",methods:p,name:r="HTTP JSON-RPC",onFetchRequest:v,onFetchResponse:w,retryDelay:E,raw:T}=e;return({chain:k,retryCount:R,timeout:D})=>{const{batchSize:O=1e3,wait:F=0}=typeof n=="object"?n:{},U=e.retryCount??R,X=D??e.timeout??1e4,W=t||(k==null?void 0:k.rpcUrls.default.http[0]);if(!W)throw new dse;const K=Cne(W,{fetchFn:s,fetchOptions:l,onRequest:v,onResponse:w,timeout:X});return R9({key:u,methods:p,name:r,async request({method:ne,params:te}){const re={method:ne,params:te},{schedule:xe}=t7({id:W,wait:F,shouldSplitBatch(Ce){return Ce.length>O},fn:Ce=>K.request({body:Ce}),sort:(Ce,Me)=>Ce.id-Me.id}),ae=async Ce=>n?xe(Ce):[await K.request({body:Ce})],[{error:ce,result:ye}]=await ae(re);if(T)return{error:ce,result:ye};if(ce)throw new SP({body:re,error:ce,url:W});return ye},retryCount:U,retryDelay:E,timeout:X,type:"http"},{fetchOptions:l,url:W})}}async function hse(t,e={}){const{assertChainId:n=!0}=e;let s;if(e.connector){const{connector:E}=e;if(t.state.status==="reconnecting"&&!E.getAccounts&&!E.getChainId)throw new tse({connector:E});const[T,k]=await Promise.all([E.getAccounts().catch(R=>{if(e.account===null)return[];throw R}),E.getChainId()]);s={accounts:T,chainId:k,connector:E}}else s=t.state.connections.get(t.state.current);if(!s)throw new Yie;const l=e.chainId??s.chainId,u=await s.connector.getChainId();if(n&&u!==l)throw new ese({connectionChainId:l,connectorChainId:u});const p=s.connector;if(p.getClient)return p.getClient({chainId:l});const r=Fo(e.account??s.accounts[0]);if(r&&(r.address=wl(r.address)),e.account&&!s.accounts.some(E=>E.toLowerCase()===r.address.toLowerCase()))throw new Jie({address:r.address,connector:p});const v=t.chains.find(E=>E.id===l),w=await s.connector.getProvider({chainId:l});return wA({account:r,chain:v,name:"Connector Client",transport:E=>use(w)({...E,retryCount:0})})}async function fse(t,e={}){var l,u;let n;if(e.connector)n=e.connector;else{const{connections:p,current:r}=t.state,v=p.get(r);n=v==null?void 0:v.connector}const s=t.state.connections;n&&(await n.disconnect(),n.emitter.off("change",t._internal.events.change),n.emitter.off("disconnect",t._internal.events.disconnect),n.emitter.on("connect",t._internal.events.connect),s.delete(n.uid)),t.setState(p=>{if(s.size===0)return{...p,connections:new Map,current:null,status:"disconnected"};const r=s.values().next().value;return{...p,connections:new Map(s),current:r.connector.uid}});{const p=t.state.current;if(!p)return;const r=(l=t.state.connections.get(p))==null?void 0:l.connector;if(!r)return;await((u=t.storage)==null?void 0:u.setItem("recentConnectorId",r.id))}}function N9(t){return typeof t=="number"?t:t==="wei"?0:Math.abs(YJ[t])}function j9(t){const e=t.state.current,n=t.state.connections.get(e),s=n==null?void 0:n.accounts,l=s==null?void 0:s[0],u=t.chains.find(r=>r.id===(n==null?void 0:n.chainId)),p=t.state.status;switch(p){case"connected":return{address:l,addresses:s,chain:u,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!0,isConnecting:!1,isDisconnected:!1,isReconnecting:!1,status:p};case"reconnecting":return{address:l,addresses:s,chain:u,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!!l,isConnecting:!1,isDisconnected:!1,isReconnecting:!0,status:p};case"connecting":return{address:l,addresses:s,chain:u,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!1,isConnecting:!0,isDisconnected:!1,isReconnecting:!1,status:p};case"disconnected":return{address:void 0,addresses:void 0,chain:void 0,chainId:void 0,connector:void 0,isConnected:!1,isConnecting:!1,isDisconnected:!0,isReconnecting:!1,status:p}}}async function pse(t,e){const{allowFailure:n=!0,chainId:s,contracts:l,...u}=e,p=t.getClient({chainId:s});return yb(p,h9,"multicall")({allowFailure:n,contracts:l,...u})}function mse(t,e){const{chainId:n,...s}=e,l=t.getClient({chainId:n});return yb(l,ah,"readContract")(s)}async function gse(t,e){var r;const{allowFailure:n=!0,blockNumber:s,blockTag:l,...u}=e,p=e.contracts;try{const v={};for(const[k,R]of p.entries()){const D=R.chainId??t.state.chainId;v[D]||(v[D]=[]),(r=v[D])==null||r.push({contract:R,index:k})}const w=()=>Object.entries(v).map(([k,R])=>pse(t,{...u,allowFailure:n,blockNumber:s,blockTag:l,chainId:Number.parseInt(k,10),contracts:R.map(({contract:D})=>D)})),E=(await Promise.all(w())).flat(),T=Object.values(v).flatMap(k=>k.map(({index:R})=>R));return E.reduce((k,R,D)=>(k&&(k[T[D]]=R),k),[])}catch(v){if(v instanceof vP)throw v;const w=()=>p.map(E=>mse(t,{...E,blockNumber:s,blockTag:l}));return n?(await Promise.allSettled(w())).map(E=>E.status==="fulfilled"?{result:E.value,status:"success"}:{error:E.reason,result:void 0,status:"failure"}):await Promise.all(w())}}async function yse(t,e){const{address:n,blockNumber:s,blockTag:l,chainId:u,token:p,unit:r="ether"}=e;if(p)try{return await qL(t,{balanceAddress:n,chainId:u,symbolType:"string",tokenAddress:p})}catch(k){if(k.name==="ContractFunctionExecutionError"){const R=await qL(t,{balanceAddress:n,chainId:u,symbolType:"bytes32",tokenAddress:p}),D=ZK(vu(R.symbol,{dir:"right"}));return{...R,symbol:D}}throw k}const v=t.getClient({chainId:u}),E=await yb(v,R7,"getBalance")(s?{address:n,blockNumber:s}:{address:n,blockTag:l}),T=t.chains.find(k=>k.id===u)??v.chain;return{decimals:T.nativeCurrency.decimals,formatted:n2(E,N9(r)),symbol:T.nativeCurrency.symbol,value:E}}async function qL(t,e){const{balanceAddress:n,chainId:s,symbolType:l,tokenAddress:u,unit:p}=e,r={abi:[{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:l}]}],address:u},[v,w,E]=await gse(t,{allowFailure:!1,contracts:[{...r,functionName:"balanceOf",args:[n],chainId:s},{...r,functionName:"decimals",chainId:s},{...r,functionName:"symbol",chainId:s}]}),T=n2(v??"0",N9(p??w));return{decimals:w,formatted:T,symbol:E,value:v}}function XL(t){return t.state.chainId}function Fx(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;let n,s;if(Array.isArray(t)&&Array.isArray(e)){if(n=t.length,n!==e.length)return!1;for(s=n;s--!==0;)if(!Fx(t[s],e[s]))return!1;return!0}if(typeof t.valueOf=="function"&&t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(typeof t.toString=="function"&&t.toString!==Object.prototype.toString)return t.toString()===e.toString();const l=Object.keys(t);if(n=l.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!Object.hasOwn(e,l[s]))return!1;for(s=n;s--!==0;){const u=l[s];if(u&&!Fx(t[u],e[u]))return!1}return!0}return t!==t&&e!==e}let WC=[];function ZL(t){const e=t.chains;return Fx(WC,e)?WC:(WC=e,e)}function xse(t,e={}){try{return t.getClient(e)}catch{return}}let LS=[];function ck(t){const e=[...t.state.connections.values()];return t.state.status==="reconnecting"||Fx(LS,e)?LS:(LS=e,e)}let OS=[];function QL(t){const e=t.connectors;return OS.length===e.length&&OS.every((n,s)=>n===e[s])?OS:(OS=e,e)}function _se(t,e){const{chainId:n,...s}=e,l=t.getClient({chainId:n});return yb(l,o7,"getEnsAvatar")(s)}function vse(t,e){const{chainId:n,...s}=e,l=t.getClient({chainId:n});return yb(l,a7,"getEnsName")(s)}function uk(t,e={}){const n=xse(t,e);return n==null?void 0:n.extend(P9)}let qC=!1;async function bse(t,e={}){var w,E;if(qC)return[];qC=!0,t.setState(T=>({...T,status:T.current?"reconnecting":"connecting"}));const n=[];if((w=e.connectors)!=null&&w.length)for(const T of e.connectors){let k;typeof T=="function"?k=t._internal.connectors.setup(T):k=T,n.push(k)}else n.push(...t.connectors);let s;try{s=await((E=t.storage)==null?void 0:E.getItem("recentConnectorId"))}catch{}const l={};for(const[,T]of t.state.connections)l[T.connector.id]=1;s&&(l[s]=0);const u=Object.keys(l).length>0?[...n].sort((T,k)=>(l[T.id]??10)-(l[k.id]??10)):n;let p=!1;const r=[],v=[];for(const T of u){const k=await T.getProvider().catch(()=>{});if(!k||v.some(O=>O===k)||!await T.isAuthorized())continue;const D=await T.connect({isReconnecting:!0}).catch(()=>null);D&&(T.emitter.off("connect",t._internal.events.connect),T.emitter.on("change",t._internal.events.change),T.emitter.on("disconnect",t._internal.events.disconnect),t.setState(O=>{const F=new Map(p?O.connections:new Map).set(T.uid,{accounts:D.accounts,chainId:D.chainId,connector:T});return{...O,current:p?O.current:T.uid,connections:F}}),r.push({accounts:D.accounts,chainId:D.chainId,connector:T}),v.push(k),p=!0)}return(t.state.status==="reconnecting"||t.state.status==="connecting")&&(p?t.setState(T=>({...T,status:"connected"})):t.setState(T=>({...T,connections:new Map,current:null,status:"disconnected"}))),qC=!1,r}async function wse(t,e){const{account:n,connector:s,...l}=e;let u;return typeof n=="object"&&n.type==="local"?u=t.getClient():u=await hse(t,{account:n,connector:s}),yb(u,C9,"signMessage")({...l,...n?{account:n}:{}})}class td extends dg{constructor(){super("Provider not found."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderNotFoundError"})}}class Sse extends dg{constructor({connector:e}){super(`"${e.name}" does not support programmatic chain switching.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SwitchChainNotSupportedError"})}}async function Tse(t,e){var p;const{addEthereumChainParameter:n,chainId:s}=e,l=t.state.connections.get(((p=e.connector)==null?void 0:p.uid)??t.state.current);if(l){const r=l.connector;if(!r.switchChain)throw new Sse({connector:r});return await r.switchChain({addEthereumChainParameter:n,chainId:s})}const u=t.chains.find(r=>r.id===s);if(!u)throw new V0;return t.setState(r=>({...r,chainId:s})),u}function D9(t,e){const{onChange:n}=e;return t.subscribe(()=>j9(t),n,{equalityFn(s,l){const{connector:u,...p}=s,{connector:r,...v}=l;return Fx(p,v)&&(u==null?void 0:u.id)===(r==null?void 0:r.id)&&(u==null?void 0:u.uid)===(r==null?void 0:r.uid)}})}function Ese(t,e){const{onChange:n}=e;return t.subscribe(s=>s.chainId,n)}function Ase(t,e){const{onChange:n}=e;return t.subscribe(()=>ck(t),n,{equalityFn:Fx})}function Cse(t,e){const{onChange:n}=e;return t._internal.connectors.subscribe((s,l)=>{n(Object.values(s),l)})}function Mse(t,e){const{onChange:n}=e;return t.subscribe(()=>uk(t),n,{equalityFn(s,l){return(s==null?void 0:s.uid)===(l==null?void 0:l.uid)}})}SA.type="injected";function SA(t={}){const{shimDisconnect:e=!0,unstable_shimAsyncInject:n}=t;function s(){const v=t.target;if(typeof v=="function"){const w=v();if(w)return w}return typeof v=="object"?v:typeof v=="string"?{...kse[v]??{id:v,name:`${v[0].toUpperCase()}${v.slice(1)}`,provider:`is${v[0].toUpperCase()}${v.slice(1)}`}}:{id:"injected",name:"Injected",provider(w){return w==null?void 0:w.ethereum}}}let l,u,p,r;return v=>({get icon(){return s().icon},get id(){return s().id},get name(){return s().name},get supportsSimulation(){return!0},type:SA.type,async setup(){const w=await this.getProvider();w!=null&&w.on&&t.target&&(p||(p=this.onConnect.bind(this),w.on("connect",p)),l||(l=this.onAccountsChanged.bind(this),w.on("accountsChanged",l)))},async connect({chainId:w,isReconnecting:E,withCapabilities:T}={}){var D,O,F,U,X,W;const k=await this.getProvider();if(!k)throw new td;let R=[];if(E)R=await this.getAccounts().catch(()=>[]);else if(e)try{R=(U=(F=(O=(D=(await k.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}))[0])==null?void 0:D.caveats)==null?void 0:O[0])==null?void 0:F.value)==null?void 0:U.map(ne=>wl(ne)),R.length>0&&(R=await this.getAccounts())}catch(K){const ne=K;if(ne.code===ao.code)throw new ao(ne);if(ne.code===yp.code)throw ne}try{!(R!=null&&R.length)&&!E&&(R=(await k.request({method:"eth_requestAccounts"})).map(te=>wl(te))),p&&(k.removeListener("connect",p),p=void 0),l||(l=this.onAccountsChanged.bind(this),k.on("accountsChanged",l)),u||(u=this.onChainChanged.bind(this),k.on("chainChanged",u)),r||(r=this.onDisconnect.bind(this),k.on("disconnect",r));let K=await this.getChainId();if(w&&K!==w){const ne=await this.switchChain({chainId:w}).catch(te=>{if(te.code===ao.code)throw te;return{id:K}});K=(ne==null?void 0:ne.id)??K}return e&&await((X=v.storage)==null?void 0:X.removeItem(`${this.id}.disconnected`)),t.target||await((W=v.storage)==null?void 0:W.setItem("injected.connected",!0)),{accounts:T?R.map(ne=>({address:ne,capabilities:{}})):R,chainId:K}}catch(K){const ne=K;throw ne.code===ao.code?new ao(ne):ne.code===yp.code?new yp(ne):ne}},async disconnect(){var E,T;const w=await this.getProvider();if(!w)throw new td;u&&(w.removeListener("chainChanged",u),u=void 0),r&&(w.removeListener("disconnect",r),r=void 0),p||(p=this.onConnect.bind(this),w.on("connect",p));try{await mA(()=>w.request({method:"wallet_revokePermissions",params:[{eth_accounts:{}}]}),{timeout:100})}catch{}e&&await((E=v.storage)==null?void 0:E.setItem(`${this.id}.disconnected`,!0)),t.target||await((T=v.storage)==null?void 0:T.removeItem("injected.connected"))},async getAccounts(){const w=await this.getProvider();if(!w)throw new td;return(await w.request({method:"eth_accounts"})).map(T=>wl(T))},async getChainId(){const w=await this.getProvider();if(!w)throw new td;const E=await w.request({method:"eth_chainId"});return Number(E)},async getProvider(){if(typeof window>"u")return;let w;const E=s();return typeof E.provider=="function"?w=E.provider(window):typeof E.provider=="string"?w=DT(window,E.provider):w=E.provider,w&&!w.removeListener&&("off"in w&&typeof w.off=="function"?w.removeListener=w.off:w.removeListener=()=>{}),w},async isAuthorized(){var w,E;try{if(e&&await((w=v.storage)==null?void 0:w.getItem(`${this.id}.disconnected`))||!t.target&&!await((E=v.storage)==null?void 0:E.getItem("injected.connected")))return!1;if(!await this.getProvider()){if(n!==void 0&&n!==!1){const D=async()=>(typeof window<"u"&&window.removeEventListener("ethereum#initialized",D),!!await this.getProvider()),O=typeof n=="number"?n:1e3;if(await Promise.race([...typeof window<"u"?[new Promise(U=>window.addEventListener("ethereum#initialized",()=>U(D()),{once:!0}))]:[],new Promise(U=>setTimeout(()=>U(D()),O))]))return!0}throw new td}return!!(await Lx(()=>this.getAccounts())).length}catch{return!1}},async switchChain({addEthereumChainParameter:w,chainId:E}){var D,O,F,U;const T=await this.getProvider();if(!T)throw new td;const k=v.chains.find(X=>X.id===E);if(!k)throw new ld(new V0);const R=new Promise(X=>{const W=(K=>{"chainId"in K&&K.chainId===E&&(v.emitter.off("change",W),X())});v.emitter.on("change",W)});try{return await Promise.all([T.request({method:"wallet_switchEthereumChain",params:[{chainId:lr(E)}]}).then(async()=>{await this.getChainId()===E&&v.emitter.emit("change",{chainId:E})}),R]),k}catch(X){const W=X;if(W.code===4902||((O=(D=W==null?void 0:W.data)==null?void 0:D.originalError)==null?void 0:O.code)===4902)try{const{default:K,...ne}=k.blockExplorers??{};let te;w!=null&&w.blockExplorerUrls?te=w.blockExplorerUrls:K&&(te=[K.url,...Object.values(ne).map(ae=>ae.url)]);let re;(F=w==null?void 0:w.rpcUrls)!=null&&F.length?re=w.rpcUrls:re=[((U=k.rpcUrls.default)==null?void 0:U.http[0])??""];const xe={blockExplorerUrls:te,chainId:lr(E),chainName:(w==null?void 0:w.chainName)??k.name,iconUrls:w==null?void 0:w.iconUrls,nativeCurrency:(w==null?void 0:w.nativeCurrency)??k.nativeCurrency,rpcUrls:re};return await Promise.all([T.request({method:"wallet_addEthereumChain",params:[xe]}).then(async()=>{if(await this.getChainId()===E)v.emitter.emit("change",{chainId:E});else throw new ao(new Error("User rejected switch after adding network."))}),R]),k}catch(K){throw new ao(K)}throw W.code===ao.code?new ao(W):new ld(W)}},async onAccountsChanged(w){var E;if(w.length===0)this.onDisconnect();else if(v.emitter.listenerCount("connect")){const T=(await this.getChainId()).toString();this.onConnect({chainId:T}),e&&await((E=v.storage)==null?void 0:E.removeItem(`${this.id}.disconnected`))}else v.emitter.emit("change",{accounts:w.map(T=>wl(T))})},onChainChanged(w){const E=Number(w);v.emitter.emit("change",{chainId:E})},async onConnect(w){const E=await this.getAccounts();if(E.length===0)return;const T=Number(w.chainId);v.emitter.emit("connect",{accounts:E,chainId:T});const k=await this.getProvider();k&&(p&&(k.removeListener("connect",p),p=void 0),l||(l=this.onAccountsChanged.bind(this),k.on("accountsChanged",l)),u||(u=this.onChainChanged.bind(this),k.on("chainChanged",u)),r||(r=this.onDisconnect.bind(this),k.on("disconnect",r)))},async onDisconnect(w){const E=await this.getProvider();w&&w.code===1013&&E&&(await this.getAccounts()).length||(v.emitter.emit("disconnect"),E&&(u&&(E.removeListener("chainChanged",u),u=void 0),r&&(E.removeListener("disconnect",r),r=void 0),p||(p=this.onConnect.bind(this),E.on("connect",p))))}})}const kse={coinbaseWallet:{id:"coinbaseWallet",name:"Coinbase Wallet",provider(t){return t!=null&&t.coinbaseWalletExtension?t.coinbaseWalletExtension:DT(t,"isCoinbaseWallet")}},metaMask:{id:"metaMask",name:"MetaMask",provider(t){return DT(t,e=>{if(!e.isMetaMask||e.isBraveWallet&&!e._events&&!e._state)return!1;const n=["isApexWallet","isAvalanche","isBitKeep","isBlockWallet","isKuCoinWallet","isMathWallet","isOkxWallet","isOKExWallet","isOneInchIOSWallet","isOneInchAndroidWallet","isOpera","isPhantom","isPortal","isRabby","isTokenPocket","isTokenary","isUniswapWallet","isZerion"];for(const s of n)if(e[s])return!1;return!0})}},phantom:{id:"phantom",name:"Phantom",provider(t){var e,n;return(e=t==null?void 0:t.phantom)!=null&&e.ethereum?(n=t.phantom)==null?void 0:n.ethereum:DT(t,"isPhantom")}}};function DT(t,e){function n(l){return typeof e=="function"?e(l):typeof e=="string"?l[e]:!0}const s=t.ethereum;if(s!=null&&s.providers)return s.providers.find(l=>n(l));if(s&&n(s))return s}function Ise(t){if(typeof window>"u")return;const e=n=>t(n.detail);return window.addEventListener("eip6963:announceProvider",e),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",e)}function Pse(){const t=new Set;let e=[];const n=()=>Ise(l=>{e.some(({info:u})=>u.uuid===l.info.uuid)||(e=[...e,l],t.forEach(u=>u(e,{added:[l]})))});let s=n();return{_listeners(){return t},clear(){t.forEach(l=>l([],{removed:[...e]})),e=[]},destroy(){this.clear(),t.clear(),s==null||s()},findProvider({rdns:l}){return e.find(u=>u.info.rdns===l)},getProviders(){return e},reset(){this.clear(),s==null||s(),s=n()},subscribe(l,{emitImmediately:u}={}){return t.add(l),u&&l(e,{added:e}),()=>t.delete(l)}}}const Rse=t=>(e,n,s)=>{const l=s.subscribe;return s.subscribe=(p,r,v)=>{let w=p;if(r){const E=(v==null?void 0:v.equalityFn)||Object.is;let T=p(s.getState());w=k=>{const R=p(k);if(!E(T,R)){const D=T;r(T=R,D)}},v!=null&&v.fireImmediately&&r(T,T)}return l(w)},t(e,n,s)},Nse=Rse;function jse(t,e){let n;try{n=t()}catch{return}return{getItem:l=>{var u;const p=v=>v===null?null:JSON.parse(v,void 0),r=(u=n.getItem(l))!=null?u:null;return r instanceof Promise?r.then(p):p(r)},setItem:(l,u)=>n.setItem(l,JSON.stringify(u,void 0)),removeItem:l=>n.removeItem(l)}}const dk=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(s){return dk(s)(n)},catch(s){return this}}}catch(n){return{then(s){return this},catch(s){return dk(s)(n)}}}},Dse=(t,e)=>(n,s,l)=>{let u={storage:jse(()=>localStorage),partialize:O=>O,version:0,merge:(O,F)=>({...F,...O}),...e},p=!1;const r=new Set,v=new Set;let w=u.storage;if(!w)return t((...O)=>{console.warn(`[zustand persist middleware] Unable to update item '${u.name}', the given storage is currently unavailable.`),n(...O)},s,l);const E=()=>{const O=u.partialize({...s()});return w.setItem(u.name,{state:O,version:u.version})},T=l.setState;l.setState=(O,F)=>{T(O,F),E()};const k=t((...O)=>{n(...O),E()},s,l);l.getInitialState=()=>k;let R;const D=()=>{var O,F;if(!w)return;p=!1,r.forEach(X=>{var W;return X((W=s())!=null?W:k)});const U=((F=u.onRehydrateStorage)==null?void 0:F.call(u,(O=s())!=null?O:k))||void 0;return dk(w.getItem.bind(w))(u.name).then(X=>{if(X)if(typeof X.version=="number"&&X.version!==u.version){if(u.migrate)return[!0,u.migrate(X.state,X.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,X.state];return[!1,void 0]}).then(X=>{var W;const[K,ne]=X;if(R=u.merge(ne,(W=s())!=null?W:k),n(R,!0),K)return E()}).then(()=>{U==null||U(R,void 0),R=s(),p=!0,v.forEach(X=>X(R))}).catch(X=>{U==null||U(void 0,X)})};return l.persist={setOptions:O=>{u={...u,...O},O.storage&&(w=O.storage)},clearStorage:()=>{w==null||w.removeItem(u.name)},getOptions:()=>u,rehydrate:()=>D(),hasHydrated:()=>p,onHydrate:O=>(r.add(O),()=>{r.delete(O)}),onFinishHydration:O=>(v.add(O),()=>{v.delete(O)})},u.skipHydration||D(),R||k},Lse=Dse,KL=t=>{let e;const n=new Set,s=(w,E)=>{const T=typeof w=="function"?w(e):w;if(!Object.is(T,e)){const k=e;e=E??(typeof T!="object"||T===null)?T:Object.assign({},e,T),n.forEach(R=>R(e,k))}},l=()=>e,r={setState:s,getState:l,getInitialState:()=>v,subscribe:w=>(n.add(w),()=>n.delete(w))},v=e=t(s,l,r);return r},XC=t=>t?KL(t):KL;var ZC={exports:{}},YL;function Ose(){return YL||(YL=1,(function(t){var e=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function l(v,w,E){this.fn=v,this.context=w,this.once=E||!1}function u(v,w,E,T,k){if(typeof E!="function")throw new TypeError("The listener must be a function");var R=new l(E,T||v,k),D=n?n+w:w;return v._events[D]?v._events[D].fn?v._events[D]=[v._events[D],R]:v._events[D].push(R):(v._events[D]=R,v._eventsCount++),v}function p(v,w){--v._eventsCount===0?v._events=new s:delete v._events[w]}function r(){this._events=new s,this._eventsCount=0}r.prototype.eventNames=function(){var w=[],E,T;if(this._eventsCount===0)return w;for(T in E=this._events)e.call(E,T)&&w.push(n?T.slice(1):T);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(E)):w},r.prototype.listeners=function(w){var E=n?n+w:w,T=this._events[E];if(!T)return[];if(T.fn)return[T.fn];for(var k=0,R=T.length,D=new Array(R);k<R;k++)D[k]=T[k].fn;return D},r.prototype.listenerCount=function(w){var E=n?n+w:w,T=this._events[E];return T?T.fn?1:T.length:0},r.prototype.emit=function(w,E,T,k,R,D){var O=n?n+w:w;if(!this._events[O])return!1;var F=this._events[O],U=arguments.length,X,W;if(F.fn){switch(F.once&&this.removeListener(w,F.fn,void 0,!0),U){case 1:return F.fn.call(F.context),!0;case 2:return F.fn.call(F.context,E),!0;case 3:return F.fn.call(F.context,E,T),!0;case 4:return F.fn.call(F.context,E,T,k),!0;case 5:return F.fn.call(F.context,E,T,k,R),!0;case 6:return F.fn.call(F.context,E,T,k,R,D),!0}for(W=1,X=new Array(U-1);W<U;W++)X[W-1]=arguments[W];F.fn.apply(F.context,X)}else{var K=F.length,ne;for(W=0;W<K;W++)switch(F[W].once&&this.removeListener(w,F[W].fn,void 0,!0),U){case 1:F[W].fn.call(F[W].context);break;case 2:F[W].fn.call(F[W].context,E);break;case 3:F[W].fn.call(F[W].context,E,T);break;case 4:F[W].fn.call(F[W].context,E,T,k);break;default:if(!X)for(ne=1,X=new Array(U-1);ne<U;ne++)X[ne-1]=arguments[ne];F[W].fn.apply(F[W].context,X)}}return!0},r.prototype.on=function(w,E,T){return u(this,w,E,T,!1)},r.prototype.once=function(w,E,T){return u(this,w,E,T,!0)},r.prototype.removeListener=function(w,E,T,k){var R=n?n+w:w;if(!this._events[R])return this;if(!E)return p(this,R),this;var D=this._events[R];if(D.fn)D.fn===E&&(!k||D.once)&&(!T||D.context===T)&&p(this,R);else{for(var O=0,F=[],U=D.length;O<U;O++)(D[O].fn!==E||k&&!D[O].once||T&&D[O].context!==T)&&F.push(D[O]);F.length?this._events[R]=F.length===1?F[0]:F:p(this,R)}return this},r.prototype.removeAllListeners=function(w){var E;return w?(E=n?n+w:w,this._events[E]&&p(this,E)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,r.EventEmitter=r,t.exports=r})(ZC)),ZC.exports}var Fse=Ose();const Bse=Wx(Fse);class zse{constructor(e){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"_emitter",{enumerable:!0,configurable:!0,writable:!0,value:new Bse})}on(e,n){this._emitter.on(e,n)}once(e,n){this._emitter.once(e,n)}off(e,n){this._emitter.off(e,n)}emit(e,...n){const s=n[0];this._emitter.emit(e,{uid:this.uid,...s})}listenerCount(e){return this._emitter.listenerCount(e)}}function Use(t){return new zse(t)}function Vse(t,e){return JSON.parse(t,(n,s)=>{let l=s;return(l==null?void 0:l.__type)==="bigint"&&(l=BigInt(l.value)),(l==null?void 0:l.__type)==="Map"&&(l=new Map(l.value)),(e==null?void 0:e(n,l))??l})}function JL(t,e){return t.slice(0,e).join(".")||"."}function eO(t,e){const{length:n}=t;for(let s=0;s<n;++s)if(t[s]===e)return s+1;return 0}function Hse(t,e){const n=typeof t=="function",s=typeof e=="function",l=[],u=[];return function(r,v){if(typeof v=="object")if(l.length){const w=eO(l,this);w===0?l[l.length]=this:(l.splice(w),u.splice(w)),u[u.length]=r;const E=eO(l,v);if(E!==0)return s?e.call(this,r,v,JL(u,E)):`[ref=${JL(u,E)}]`}else l[0]=v,u[0]=r;return n?t.call(this,r,v):v}}function Gse(t,e,n,s){return JSON.stringify(t,Hse((l,u)=>{let p=u;return typeof p=="bigint"&&(p={__type:"bigint",value:u.toString()}),p instanceof Map&&(p={__type:"Map",value:Array.from(u.entries())}),(e==null?void 0:e(l,p))??p},s),n??void 0)}function $se(t){const{deserialize:e=Vse,key:n="wagmi",serialize:s=Gse,storage:l=L9}=t;function u(p){return p instanceof Promise?p.then(r=>r).catch(()=>null):p}return{...l,key:n,async getItem(p,r){const v=l.getItem(`${n}.${p}`),w=await u(v);return w?e(w)??null:r??null},async setItem(p,r){const v=`${n}.${p}`;r===null?await u(l.removeItem(v)):await u(l.setItem(v,s(r)))},async removeItem(p){await u(l.removeItem(`${n}.${p}`))}}}const L9={getItem:()=>null,setItem:()=>{},removeItem:()=>{}};function Wse(){const t=typeof window<"u"&&window.localStorage?window.localStorage:L9;return{getItem(e){return t.getItem(e)},removeItem(e){t.removeItem(e)},setItem(e,n){try{t.setItem(e,n)}catch{}}}}const hk=256;let FS=hk,BS;function qse(t=11){if(!BS||FS+t>hk*2){BS="",FS=0;for(let e=0;e<hk;e++)BS+=(256+Math.random()*256|0).toString(16).substring(1)}return BS.substring(FS,FS+++t)}function Xse(t){const{multiInjectedProviderDiscovery:e=!0,storage:n=$se({storage:Wse()}),syncConnectedChain:s=!0,ssr:l=!1,...u}=t,p=typeof window<"u"&&e?Pse():void 0,r=XC(()=>u.chains),v=XC(()=>{const ne=[],te=new Set;for(const re of u.connectors??[]){const xe=w(re);if(ne.push(xe),!l&&xe.rdns){const ae=typeof xe.rdns=="string"?[xe.rdns]:xe.rdns;for(const ce of ae)te.add(ce)}}if(!l&&p){const re=p.getProviders();for(const xe of re)te.has(xe.info.rdns)||ne.push(w(E(xe)))}return ne});function w(ne){var xe;const te=Use(qse()),re={...ne({emitter:te,chains:r.getState(),storage:n,transports:u.transports}),emitter:te,uid:te.uid};return te.on("connect",W),(xe=re.setup)==null||xe.call(re),re}function E(ne){const{info:te}=ne,re=ne.provider;return SA({target:{...te,id:te.rdns,provider:re}})}const T=new Map;function k(ne={}){const te=ne.chainId??F.getState().chainId,re=r.getState().find(ae=>ae.id===te);if(ne.chainId&&!re)throw new V0;{const ae=T.get(F.getState().chainId);if(ae&&!re)return ae;if(!re)throw new V0}{const ae=T.get(te);if(ae)return ae}let xe;if(u.client)xe=u.client({chain:re});else{const ae=re.id,ce=r.getState().map(Me=>Me.id),ye={},Ce=Object.entries(u);for(const[Me,Ke]of Ce)if(!(Me==="chains"||Me==="client"||Me==="connectors"||Me==="transports"))if(typeof Ke=="object")if(ae in Ke)ye[Me]=Ke[ae];else{if(ce.some(je=>je in Ke))continue;ye[Me]=Ke}else ye[Me]=Ke;xe=wA({...ye,chain:re,batch:ye.batch??{multicall:!0},transport:Me=>u.transports[ae]({...Me,connectors:v})})}return T.set(te,xe),xe}function R(){return{chainId:r.getState()[0].id,connections:new Map,current:null,status:"disconnected"}}let D;const O="0.0.0-canary-";jT.startsWith(O)?D=Number.parseInt(jT.replace(O,""),10):D=Number.parseInt(jT.split(".")[0]??"0",10);const F=XC(Nse(n?Lse(R,{migrate(ne,te){if(te===D)return ne;const re=R(),xe=U(ne,re.chainId);return{...re,chainId:xe}},name:"store",partialize(ne){return{connections:{__type:"Map",value:Array.from(ne.connections.entries()).map(([te,re])=>{const{id:xe,name:ae,type:ce,uid:ye}=re.connector;return[te,{...re,connector:{id:xe,name:ae,type:ce,uid:ye}}]})},chainId:ne.chainId,current:ne.current}},merge(ne,te){typeof ne=="object"&&ne&&"status"in ne&&delete ne.status;const re=U(ne,te.chainId);return{...te,...ne,chainId:re}},skipHydration:l,storage:n,version:D}):R));F.setState(R());function U(ne,te){return ne&&typeof ne=="object"&&"chainId"in ne&&typeof ne.chainId=="number"&&r.getState().some(re=>re.id===ne.chainId)?ne.chainId:te}s&&F.subscribe(({connections:ne,current:te})=>{var re;return te?(re=ne.get(te))==null?void 0:re.chainId:void 0},ne=>{if(r.getState().some(re=>re.id===ne))return F.setState(re=>({...re,chainId:ne??re.chainId}))}),p==null||p.subscribe(ne=>{const te=new Set,re=new Set;for(const ae of v.getState())if(te.add(ae.id),ae.rdns){const ce=typeof ae.rdns=="string"?[ae.rdns]:ae.rdns;for(const ye of ce)re.add(ye)}const xe=[];for(const ae of ne){if(re.has(ae.info.rdns))continue;const ce=w(E(ae));te.has(ce.id)||xe.push(ce)}n&&!F.persist.hasHydrated()||v.setState(ae=>[...ae,...xe],!0)});function X(ne){F.setState(te=>{const re=te.connections.get(ne.uid);return re?{...te,connections:new Map(te.connections).set(ne.uid,{accounts:ne.accounts??re.accounts,chainId:ne.chainId??re.chainId,connector:re.connector})}:te})}function W(ne){F.getState().status==="connecting"||F.getState().status==="reconnecting"||F.setState(te=>{const re=v.getState().find(xe=>xe.uid===ne.uid);return re?(re.emitter.listenerCount("connect")&&re.emitter.off("connect",X),re.emitter.listenerCount("change")||re.emitter.on("change",X),re.emitter.listenerCount("disconnect")||re.emitter.on("disconnect",K),{...te,connections:new Map(te.connections).set(ne.uid,{accounts:ne.accounts,chainId:ne.chainId,connector:re}),current:ne.uid,status:"connected"}):te})}function K(ne){F.setState(te=>{const re=te.connections.get(ne.uid);if(re){const ae=re.connector;ae.emitter.listenerCount("change")&&re.connector.emitter.off("change",X),ae.emitter.listenerCount("disconnect")&&re.connector.emitter.off("disconnect",K),ae.emitter.listenerCount("connect")||re.connector.emitter.on("connect",W)}if(te.connections.delete(ne.uid),te.connections.size===0)return{...te,connections:new Map,current:null,status:"disconnected"};const xe=te.connections.values().next().value;return{...te,connections:new Map(te.connections),current:xe.connector.uid}})}return{get chains(){return r.getState()},get connectors(){return v.getState()},storage:n,getClient:k,get state(){return F.getState()},setState(ne){let te;typeof ne=="function"?te=ne(F.getState()):te=ne;const re=R();typeof te!="object"&&(te=re),Object.keys(re).some(ae=>!(ae in te))&&(te=re),F.setState(te,!0)},subscribe(ne,te,re){return F.subscribe(ne,te,re?{...re,fireImmediately:re.emitImmediately}:void 0)},_internal:{mipd:p,async revalidate(){const ne=F.getState(),te=ne.connections;let re=ne.current;for(const[,xe]of te){const ae=xe.connector;ae.isAuthorized&&await ae.isAuthorized()||(te.delete(ae.uid),re===ae.uid&&(re=null))}F.setState(xe=>({...xe,connections:te,current:re}))},store:F,ssr:!!l,syncConnectedChain:s,transports:u.transports,chains:{setState(ne){const te=typeof ne=="function"?ne(r.getState()):ne;if(te.length!==0)return r.setState(te,!0)},subscribe(ne){return r.subscribe(ne)}},connectors:{providerDetailToConnector:E,setup:w,setState(ne){return v.setState(typeof ne=="function"?ne(v.getState()):ne,!0)},subscribe(ne){return v.subscribe(ne)}},events:{change:X,connect:W,disconnect:K}}}}function Zse(t,e){const{initialState:n,reconnectOnMount:s}=e;return n&&!t._internal.store.persist.hasHydrated()&&t.setState({...n,chainId:t.chains.some(l=>l.id===n.chainId)?n.chainId:t.chains[0].id,connections:s?n.connections:new Map,status:s?"reconnecting":"disconnected"}),{async onMount(){t._internal.ssr&&(await t._internal.store.persist.rehydrate(),t._internal.mipd&&t._internal.connectors.setState(l=>{var v;const u=new Set;for(const w of l??[])if(w.rdns){const E=Array.isArray(w.rdns)?w.rdns:[w.rdns];for(const T of E)u.add(T)}const p=[],r=((v=t._internal.mipd)==null?void 0:v.getProviders())??[];for(const w of r){if(u.has(w.info.rdns))continue;const E=t._internal.connectors.providerDetailToConnector(w),T=t._internal.connectors.setup(E);p.push(T)}return[...l,...p]})),s?bse(t):t.storage&&t.setState(l=>({...l,connections:new Map}))}}}function O9(t){var u,p,r;const{chain:e}=t,n=e.rpcUrls.default.http[0];if(!t.transports)return[n];const s=(p=(u=t.transports)==null?void 0:u[e.id])==null?void 0:p.call(u,{chain:e});return(((r=s==null?void 0:s.value)==null?void 0:r.transports)||[s]).map(({value:v})=>(v==null?void 0:v.url)||n)}function Qse(t){const{children:e,config:n,initialState:s,reconnectOnMount:l=!0}=t,{onMount:u}=Zse(n,{initialState:s,reconnectOnMount:l});n._internal.ssr||u();const p=he.useRef(!0);return he.useEffect(()=>{if(p.current&&n._internal.ssr)return u(),()=>{p.current=!1}},[]),e}const F9=he.createContext(void 0);function Kse(t){const{children:e,config:n}=t,s={value:n};return he.createElement(Qse,t,he.createElement(F9.Provider,s,e))}const Yse="2.19.5",Jse=()=>`wagmi@${Yse}`;class eoe extends dg{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiError"})}get docsBaseUrl(){return"https://wagmi.sh/react"}get version(){return Jse()}}class toe extends eoe{constructor(){super("`useConfig` must be used within `WagmiProvider`.",{docsPath:"/api/WagmiProvider"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiProviderNotFoundError"})}}function Tl(t={}){const e=t.config??he.useContext(F9);if(!e)throw new toe;return e}function noe(t,e){const{onChange:n}=e;return t._internal.chains.subscribe((s,l)=>{n(s,l)})}var QC={exports:{}},KC={},YC={exports:{}},JC={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tO;function roe(){if(tO)return JC;tO=1;var t=Kw();function e(T,k){return T===k&&(T!==0||1/T===1/k)||T!==T&&k!==k}var n=typeof Object.is=="function"?Object.is:e,s=t.useState,l=t.useEffect,u=t.useLayoutEffect,p=t.useDebugValue;function r(T,k){var R=k(),D=s({inst:{value:R,getSnapshot:k}}),O=D[0].inst,F=D[1];return u(function(){O.value=R,O.getSnapshot=k,v(O)&&F({inst:O})},[T,R,k]),l(function(){return v(O)&&F({inst:O}),T(function(){v(O)&&F({inst:O})})},[T]),p(R),R}function v(T){var k=T.getSnapshot;T=T.value;try{var R=k();return!n(T,R)}catch{return!0}}function w(T,k){return k()}var E=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?w:r;return JC.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:E,JC}var nO;function ioe(){return nO||(nO=1,YC.exports=roe()),YC.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rO;function soe(){if(rO)return KC;rO=1;var t=Kw(),e=ioe();function n(w,E){return w===E&&(w!==0||1/w===1/E)||w!==w&&E!==E}var s=typeof Object.is=="function"?Object.is:n,l=e.useSyncExternalStore,u=t.useRef,p=t.useEffect,r=t.useMemo,v=t.useDebugValue;return KC.useSyncExternalStoreWithSelector=function(w,E,T,k,R){var D=u(null);if(D.current===null){var O={hasValue:!1,value:null};D.current=O}else O=D.current;D=r(function(){function U(te){if(!X){if(X=!0,W=te,te=k(te),R!==void 0&&O.hasValue){var re=O.value;if(R(re,te))return K=re}return K=te}if(re=K,s(W,te))return re;var xe=k(te);return R!==void 0&&R(re,xe)?(W=te,re):(W=te,K=xe)}var X=!1,W,K,ne=T===void 0?null:T;return[function(){return U(E())},ne===null?void 0:function(){return U(ne())}]},[E,T,k,R]);var F=l(w,D[0],D[1]);return p(function(){O.hasValue=!0,O.value=F},[F]),v(F),F},KC}var iO;function ooe(){return iO||(iO=1,QC.exports=soe()),QC.exports}var B9=ooe();const eM=t=>typeof t=="object"&&!Array.isArray(t);function aoe(t,e,n=e,s=Fx){const l=he.useRef([]),u=B9.useSyncExternalStoreWithSelector(t,e,n,p=>p,(p,r)=>{if(eM(p)&&eM(r)&&l.current.length){for(const v of l.current)if(!s(p[v],r[v]))return!1;return!0}return s(p,r)});return he.useMemo(()=>{if(eM(u)){const p={...u};let r={};for(const[v,w]of Object.entries(p))r={...r,[v]:{configurable:!1,enumerable:!0,get:()=>(l.current.includes(v)||l.current.push(v),w)}};return Object.defineProperties(p,r),p}return u},[u])}function qc(t={}){const e=Tl(t);return aoe(n=>D9(e,{onChange:n}),()=>j9(e))}function z9(t={}){const{onConnect:e,onDisconnect:n}=t,s=Tl(t);he.useEffect(()=>D9(s,{onChange(l,u){if((u.status==="reconnecting"||u.status==="connecting"&&u.address===void 0)&&l.status==="connected"){const{address:p,addresses:r,chain:v,chainId:w,connector:E}=l,T=u.status==="reconnecting"||u.status===void 0;e==null||e({address:p,addresses:r,chain:v,chainId:w,connector:E,isReconnected:T})}else u.status==="connected"&&l.status==="disconnected"&&(n==null||n())}}),[s,e,n])}var xb=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},loe={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},E0,uP,P8,coe=(P8=class{constructor(){Ci(this,E0,loe);Ci(this,uP,!1)}setTimeoutProvider(t){ti(this,E0,t)}setTimeout(t,e){return Dt(this,E0).setTimeout(t,e)}clearTimeout(t){Dt(this,E0).clearTimeout(t)}setInterval(t,e){return Dt(this,E0).setInterval(t,e)}clearInterval(t){Dt(this,E0).clearInterval(t)}},E0=new WeakMap,uP=new WeakMap,P8),sx=new coe;function uoe(t){setTimeout(t,0)}var Bx=typeof window>"u"||"Deno"in globalThis;function zc(){}function doe(t,e){return typeof t=="function"?t(e):t}function fk(t){return typeof t=="number"&&t>=0&&t!==1/0}function U9(t,e){return Math.max(t+(e||0)-Date.now(),0)}function L0(t,e){return typeof t=="function"?t(e):t}function Kd(t,e){return typeof t=="function"?t(e):t}function sO(t,e){const{type:n="all",exact:s,fetchStatus:l,predicate:u,queryKey:p,stale:r}=t;if(p){if(s){if(e.queryHash!==cR(p,e.options))return!1}else if(!ww(e.queryKey,p))return!1}if(n!=="all"){const v=e.isActive();if(n==="active"&&!v||n==="inactive"&&v)return!1}return!(typeof r=="boolean"&&e.isStale()!==r||l&&l!==e.state.fetchStatus||u&&!u(e))}function oO(t,e){const{exact:n,status:s,predicate:l,mutationKey:u}=t;if(u){if(!e.options.mutationKey)return!1;if(n){if(zx(e.options.mutationKey)!==zx(u))return!1}else if(!ww(e.options.mutationKey,u))return!1}return!(s&&e.state.status!==s||l&&!l(e))}function cR(t,e){return((e==null?void 0:e.queryKeyHashFn)||zx)(t)}function zx(t){return JSON.stringify(t,(e,n)=>pk(n)?Object.keys(n).sort().reduce((s,l)=>(s[l]=n[l],s),{}):n)}function ww(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ww(t[n],e[n])):!1}var hoe=Object.prototype.hasOwnProperty;function V9(t,e){if(t===e)return t;const n=aO(t)&&aO(e);if(!n&&!(pk(t)&&pk(e)))return e;const l=(n?t:Object.keys(t)).length,u=n?e:Object.keys(e),p=u.length,r=n?new Array(p):{};let v=0;for(let w=0;w<p;w++){const E=n?w:u[w],T=t[E],k=e[E];if(T===k){r[E]=T,(n?w<l:hoe.call(t,E))&&v++;continue}if(T===null||k===null||typeof T!="object"||typeof k!="object"){r[E]=k;continue}const R=V9(T,k);r[E]=R,R===T&&v++}return l===p&&v===l?t:r}function dE(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function aO(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function pk(t){if(!lO(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!lO(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function lO(t){return Object.prototype.toString.call(t)==="[object Object]"}function foe(t){return new Promise(e=>{sx.setTimeout(e,t)})}function mk(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?V9(t,e):e}function poe(t,e,n=0){const s=[...t,e];return n&&s.length>n?s.slice(1):s}function moe(t,e,n=0){const s=[e,...t];return n&&s.length>n?s.slice(0,-1):s}var uR=Symbol();function H9(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===uR?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function G9(t,e){return typeof t=="function"?t(...e):!!t}var ux,A0,Nv,R8,goe=(R8=class extends xb{constructor(){super();Ci(this,ux);Ci(this,A0);Ci(this,Nv);ti(this,Nv,e=>{if(!Bx&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){Dt(this,A0)||this.setEventListener(Dt(this,Nv))}onUnsubscribe(){var e;this.hasListeners()||((e=Dt(this,A0))==null||e.call(this),ti(this,A0,void 0))}setEventListener(e){var n;ti(this,Nv,e),(n=Dt(this,A0))==null||n.call(this),ti(this,A0,e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(e){Dt(this,ux)!==e&&(ti(this,ux,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof Dt(this,ux)=="boolean"?Dt(this,ux):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},ux=new WeakMap,A0=new WeakMap,Nv=new WeakMap,R8),dR=new goe;function gk(){let t,e;const n=new Promise((l,u)=>{t=l,e=u});n.status="pending",n.catch(()=>{});function s(l){Object.assign(n,l),delete n.resolve,delete n.reject}return n.resolve=l=>{s({status:"fulfilled",value:l}),t(l)},n.reject=l=>{s({status:"rejected",reason:l}),e(l)},n}var yoe=uoe;function xoe(){let t=[],e=0,n=r=>{r()},s=r=>{r()},l=yoe;const u=r=>{e?t.push(r):l(()=>{n(r)})},p=()=>{const r=t;t=[],r.length&&l(()=>{s(()=>{r.forEach(v=>{n(v)})})})};return{batch:r=>{let v;e++;try{v=r()}finally{e--,e||p()}return v},batchCalls:r=>(...v)=>{u(()=>{r(...v)})},schedule:u,setNotifyFunction:r=>{n=r},setBatchNotifyFunction:r=>{s=r},setScheduler:r=>{l=r}}}var Xa=xoe(),jv,C0,Dv,N8,_oe=(N8=class extends xb{constructor(){super();Ci(this,jv,!0);Ci(this,C0);Ci(this,Dv);ti(this,Dv,e=>{if(!Bx&&window.addEventListener){const n=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",s)}}})}onSubscribe(){Dt(this,C0)||this.setEventListener(Dt(this,Dv))}onUnsubscribe(){var e;this.hasListeners()||((e=Dt(this,C0))==null||e.call(this),ti(this,C0,void 0))}setEventListener(e){var n;ti(this,Dv,e),(n=Dt(this,C0))==null||n.call(this),ti(this,C0,e(this.setOnline.bind(this)))}setOnline(e){Dt(this,jv)!==e&&(ti(this,jv,e),this.listeners.forEach(s=>{s(e)}))}isOnline(){return Dt(this,jv)}},jv=new WeakMap,C0=new WeakMap,Dv=new WeakMap,N8),hE=new _oe;function voe(t){return Math.min(1e3*2**t,3e4)}function $9(t){return(t??"online")==="online"?hE.isOnline():!0}var yk=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function W9(t){let e=!1,n=0,s;const l=gk(),u=()=>l.status!=="pending",p=O=>{var F;if(!u()){const U=new yk(O);k(U),(F=t.onCancel)==null||F.call(t,U)}},r=()=>{e=!0},v=()=>{e=!1},w=()=>dR.isFocused()&&(t.networkMode==="always"||hE.isOnline())&&t.canRun(),E=()=>$9(t.networkMode)&&t.canRun(),T=O=>{u()||(s==null||s(),l.resolve(O))},k=O=>{u()||(s==null||s(),l.reject(O))},R=()=>new Promise(O=>{var F;s=U=>{(u()||w())&&O(U)},(F=t.onPause)==null||F.call(t)}).then(()=>{var O;s=void 0,u()||(O=t.onContinue)==null||O.call(t)}),D=()=>{if(u())return;let O;const F=n===0?t.initialPromise:void 0;try{O=F??t.fn()}catch(U){O=Promise.reject(U)}Promise.resolve(O).then(T).catch(U=>{var te;if(u())return;const X=t.retry??(Bx?0:3),W=t.retryDelay??voe,K=typeof W=="function"?W(n,U):W,ne=X===!0||typeof X=="number"&&n<X||typeof X=="function"&&X(n,U);if(e||!ne){k(U);return}n++,(te=t.onFail)==null||te.call(t,n,U),foe(K).then(()=>w()?void 0:R()).then(()=>{e?k(U):D()})})};return{promise:l,status:()=>l.status,cancel:p,continue:()=>(s==null||s(),l),cancelRetry:r,continueRetry:v,canStart:E,start:()=>(E()?D():R().then(D),l)}}var dx,j8,q9=(j8=class{constructor(){Ci(this,dx)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),fk(this.gcTime)&&ti(this,dx,sx.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Bx?1/0:300*1e3))}clearGcTimeout(){Dt(this,dx)&&(sx.clearTimeout(Dt(this,dx)),ti(this,dx,void 0))}},dx=new WeakMap,j8),hx,Lv,Qd,fx,_l,Ww,px,sf,Pm,D8,boe=(D8=class extends q9{constructor(e){super();Ci(this,sf);Ci(this,hx);Ci(this,Lv);Ci(this,Qd);Ci(this,fx);Ci(this,_l);Ci(this,Ww);Ci(this,px);ti(this,px,!1),ti(this,Ww,e.defaultOptions),this.setOptions(e.options),this.observers=[],ti(this,fx,e.client),ti(this,Qd,Dt(this,fx).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ti(this,hx,uO(this.options)),this.state=e.state??Dt(this,hx),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=Dt(this,_l))==null?void 0:e.promise}setOptions(e){if(this.options={...Dt(this,Ww),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=uO(this.options);n.data!==void 0&&(this.setState(cO(n.data,n.dataUpdatedAt)),ti(this,hx,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Dt(this,Qd).remove(this)}setData(e,n){const s=mk(this.state.data,e,this.options);return _s(this,sf,Pm).call(this,{data:s,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),s}setState(e,n){_s(this,sf,Pm).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var s,l;const n=(s=Dt(this,_l))==null?void 0:s.promise;return(l=Dt(this,_l))==null||l.cancel(e),n?n.then(zc).catch(zc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Dt(this,hx))}isActive(){return this.observers.some(e=>Kd(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===uR||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>L0(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!U9(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(s=>s.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=Dt(this,_l))==null||n.continue()}onOnline(){var n;const e=this.observers.find(s=>s.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=Dt(this,_l))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Dt(this,Qd).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(Dt(this,_l)&&(Dt(this,px)?Dt(this,_l).cancel({revert:!0}):Dt(this,_l).cancelRetry()),this.scheduleGc()),Dt(this,Qd).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||_s(this,sf,Pm).call(this,{type:"invalidate"})}async fetch(e,n){var v,w,E,T,k,R,D,O,F,U,X,W;if(this.state.fetchStatus!=="idle"&&((v=Dt(this,_l))==null?void 0:v.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(Dt(this,_l))return Dt(this,_l).continueRetry(),Dt(this,_l).promise}if(e&&this.setOptions(e),!this.options.queryFn){const K=this.observers.find(ne=>ne.options.queryFn);K&&this.setOptions(K.options)}const s=new AbortController,l=K=>{Object.defineProperty(K,"signal",{enumerable:!0,get:()=>(ti(this,px,!0),s.signal)})},u=()=>{const K=H9(this.options,n),te=(()=>{const re={client:Dt(this,fx),queryKey:this.queryKey,meta:this.meta};return l(re),re})();return ti(this,px,!1),this.options.persister?this.options.persister(K,te,this):K(te)},r=(()=>{const K={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:Dt(this,fx),state:this.state,fetchFn:u};return l(K),K})();(w=this.options.behavior)==null||w.onFetch(r,this),ti(this,Lv,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((E=r.fetchOptions)==null?void 0:E.meta))&&_s(this,sf,Pm).call(this,{type:"fetch",meta:(T=r.fetchOptions)==null?void 0:T.meta}),ti(this,_l,W9({initialPromise:n==null?void 0:n.initialPromise,fn:r.fetchFn,onCancel:K=>{K instanceof yk&&K.revert&&this.setState({...Dt(this,Lv),fetchStatus:"idle"}),s.abort()},onFail:(K,ne)=>{_s(this,sf,Pm).call(this,{type:"failed",failureCount:K,error:ne})},onPause:()=>{_s(this,sf,Pm).call(this,{type:"pause"})},onContinue:()=>{_s(this,sf,Pm).call(this,{type:"continue"})},retry:r.options.retry,retryDelay:r.options.retryDelay,networkMode:r.options.networkMode,canRun:()=>!0}));try{const K=await Dt(this,_l).start();if(K===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(K),(R=(k=Dt(this,Qd).config).onSuccess)==null||R.call(k,K,this),(O=(D=Dt(this,Qd).config).onSettled)==null||O.call(D,K,this.state.error,this),K}catch(K){if(K instanceof yk){if(K.silent)return Dt(this,_l).promise;if(K.revert){if(this.state.data===void 0)throw K;return this.state.data}}throw _s(this,sf,Pm).call(this,{type:"error",error:K}),(U=(F=Dt(this,Qd).config).onError)==null||U.call(F,K,this),(W=(X=Dt(this,Qd).config).onSettled)==null||W.call(X,this.state.data,K,this),K}finally{this.scheduleGc()}}},hx=new WeakMap,Lv=new WeakMap,Qd=new WeakMap,fx=new WeakMap,_l=new WeakMap,Ww=new WeakMap,px=new WeakMap,sf=new WeakSet,Pm=function(e){const n=s=>{switch(e.type){case"failed":return{...s,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...X9(s.data,this.options),fetchMeta:e.meta??null};case"success":const l={...s,...cO(e.data,e.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return ti(this,Lv,e.manual?l:void 0),l;case"error":const u=e.error;return{...s,error:u,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...e.state}}};this.state=n(this.state),Xa.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),Dt(this,Qd).notify({query:this,type:"updated",action:e})})},D8);function X9(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:$9(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function cO(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function uO(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,s=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var mu,zs,qw,Oc,mx,Ov,Dm,M0,Xw,Fv,Bv,gx,yx,k0,zv,lo,j1,xk,_k,vk,bk,wk,Sk,Tk,Z9,L8,woe=(L8=class extends xb{constructor(e,n){super();Ci(this,lo);Ci(this,mu);Ci(this,zs);Ci(this,qw);Ci(this,Oc);Ci(this,mx);Ci(this,Ov);Ci(this,Dm);Ci(this,M0);Ci(this,Xw);Ci(this,Fv);Ci(this,Bv);Ci(this,gx);Ci(this,yx);Ci(this,k0);Ci(this,zv,new Set);this.options=n,ti(this,mu,e),ti(this,M0,null),ti(this,Dm,gk()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Dt(this,zs).addObserver(this),dO(Dt(this,zs),this.options)?_s(this,lo,j1).call(this):this.updateResult(),_s(this,lo,bk).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ek(Dt(this,zs),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ek(Dt(this,zs),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,_s(this,lo,wk).call(this),_s(this,lo,Sk).call(this),Dt(this,zs).removeObserver(this)}setOptions(e){const n=this.options,s=Dt(this,zs);if(this.options=Dt(this,mu).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Kd(this.options.enabled,Dt(this,zs))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");_s(this,lo,Tk).call(this),Dt(this,zs).setOptions(this.options),n._defaulted&&!dE(this.options,n)&&Dt(this,mu).getQueryCache().notify({type:"observerOptionsUpdated",query:Dt(this,zs),observer:this});const l=this.hasListeners();l&&hO(Dt(this,zs),s,this.options,n)&&_s(this,lo,j1).call(this),this.updateResult(),l&&(Dt(this,zs)!==s||Kd(this.options.enabled,Dt(this,zs))!==Kd(n.enabled,Dt(this,zs))||L0(this.options.staleTime,Dt(this,zs))!==L0(n.staleTime,Dt(this,zs)))&&_s(this,lo,xk).call(this);const u=_s(this,lo,_k).call(this);l&&(Dt(this,zs)!==s||Kd(this.options.enabled,Dt(this,zs))!==Kd(n.enabled,Dt(this,zs))||u!==Dt(this,k0))&&_s(this,lo,vk).call(this,u)}getOptimisticResult(e){const n=Dt(this,mu).getQueryCache().build(Dt(this,mu),e),s=this.createResult(n,e);return Toe(this,s)&&(ti(this,Oc,s),ti(this,Ov,this.options),ti(this,mx,Dt(this,zs).state)),s}getCurrentResult(){return Dt(this,Oc)}trackResult(e,n){return new Proxy(e,{get:(s,l)=>(this.trackProp(l),n==null||n(l),l==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&Dt(this,Dm).status==="pending"&&Dt(this,Dm).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,l))})}trackProp(e){Dt(this,zv).add(e)}getCurrentQuery(){return Dt(this,zs)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const n=Dt(this,mu).defaultQueryOptions(e),s=Dt(this,mu).getQueryCache().build(Dt(this,mu),n);return s.fetch().then(()=>this.createResult(s,n))}fetch(e){return _s(this,lo,j1).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),Dt(this,Oc)))}createResult(e,n){var ae;const s=Dt(this,zs),l=this.options,u=Dt(this,Oc),p=Dt(this,mx),r=Dt(this,Ov),w=e!==s?e.state:Dt(this,qw),{state:E}=e;let T={...E},k=!1,R;if(n._optimisticResults){const ce=this.hasListeners(),ye=!ce&&dO(e,n),Ce=ce&&hO(e,s,n,l);(ye||Ce)&&(T={...T,...X9(E.data,e.options)}),n._optimisticResults==="isRestoring"&&(T.fetchStatus="idle")}let{error:D,errorUpdatedAt:O,status:F}=T;R=T.data;let U=!1;if(n.placeholderData!==void 0&&R===void 0&&F==="pending"){let ce;u!=null&&u.isPlaceholderData&&n.placeholderData===(r==null?void 0:r.placeholderData)?(ce=u.data,U=!0):ce=typeof n.placeholderData=="function"?n.placeholderData((ae=Dt(this,Bv))==null?void 0:ae.state.data,Dt(this,Bv)):n.placeholderData,ce!==void 0&&(F="success",R=mk(u==null?void 0:u.data,ce,n),k=!0)}if(n.select&&R!==void 0&&!U)if(u&&R===(p==null?void 0:p.data)&&n.select===Dt(this,Xw))R=Dt(this,Fv);else try{ti(this,Xw,n.select),R=n.select(R),R=mk(u==null?void 0:u.data,R,n),ti(this,Fv,R),ti(this,M0,null)}catch(ce){ti(this,M0,ce)}Dt(this,M0)&&(D=Dt(this,M0),R=Dt(this,Fv),O=Date.now(),F="error");const X=T.fetchStatus==="fetching",W=F==="pending",K=F==="error",ne=W&&X,te=R!==void 0,xe={status:F,fetchStatus:T.fetchStatus,isPending:W,isSuccess:F==="success",isError:K,isInitialLoading:ne,isLoading:ne,data:R,dataUpdatedAt:T.dataUpdatedAt,error:D,errorUpdatedAt:O,failureCount:T.fetchFailureCount,failureReason:T.fetchFailureReason,errorUpdateCount:T.errorUpdateCount,isFetched:T.dataUpdateCount>0||T.errorUpdateCount>0,isFetchedAfterMount:T.dataUpdateCount>w.dataUpdateCount||T.errorUpdateCount>w.errorUpdateCount,isFetching:X,isRefetching:X&&!W,isLoadingError:K&&!te,isPaused:T.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:K&&te,isStale:hR(e,n),refetch:this.refetch,promise:Dt(this,Dm),isEnabled:Kd(n.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const ce=Me=>{xe.status==="error"?Me.reject(xe.error):xe.data!==void 0&&Me.resolve(xe.data)},ye=()=>{const Me=ti(this,Dm,xe.promise=gk());ce(Me)},Ce=Dt(this,Dm);switch(Ce.status){case"pending":e.queryHash===s.queryHash&&ce(Ce);break;case"fulfilled":(xe.status==="error"||xe.data!==Ce.value)&&ye();break;case"rejected":(xe.status!=="error"||xe.error!==Ce.reason)&&ye();break}}return xe}updateResult(){const e=Dt(this,Oc),n=this.createResult(Dt(this,zs),this.options);if(ti(this,mx,Dt(this,zs).state),ti(this,Ov,this.options),Dt(this,mx).data!==void 0&&ti(this,Bv,Dt(this,zs)),dE(n,e))return;ti(this,Oc,n);const s=()=>{if(!e)return!0;const{notifyOnChangeProps:l}=this.options,u=typeof l=="function"?l():l;if(u==="all"||!u&&!Dt(this,zv).size)return!0;const p=new Set(u??Dt(this,zv));return this.options.throwOnError&&p.add("error"),Object.keys(Dt(this,Oc)).some(r=>{const v=r;return Dt(this,Oc)[v]!==e[v]&&p.has(v)})};_s(this,lo,Z9).call(this,{listeners:s()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&_s(this,lo,bk).call(this)}},mu=new WeakMap,zs=new WeakMap,qw=new WeakMap,Oc=new WeakMap,mx=new WeakMap,Ov=new WeakMap,Dm=new WeakMap,M0=new WeakMap,Xw=new WeakMap,Fv=new WeakMap,Bv=new WeakMap,gx=new WeakMap,yx=new WeakMap,k0=new WeakMap,zv=new WeakMap,lo=new WeakSet,j1=function(e){_s(this,lo,Tk).call(this);let n=Dt(this,zs).fetch(this.options,e);return e!=null&&e.throwOnError||(n=n.catch(zc)),n},xk=function(){_s(this,lo,wk).call(this);const e=L0(this.options.staleTime,Dt(this,zs));if(Bx||Dt(this,Oc).isStale||!fk(e))return;const s=U9(Dt(this,Oc).dataUpdatedAt,e)+1;ti(this,gx,sx.setTimeout(()=>{Dt(this,Oc).isStale||this.updateResult()},s))},_k=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Dt(this,zs)):this.options.refetchInterval)??!1},vk=function(e){_s(this,lo,Sk).call(this),ti(this,k0,e),!(Bx||Kd(this.options.enabled,Dt(this,zs))===!1||!fk(Dt(this,k0))||Dt(this,k0)===0)&&ti(this,yx,sx.setInterval(()=>{(this.options.refetchIntervalInBackground||dR.isFocused())&&_s(this,lo,j1).call(this)},Dt(this,k0)))},bk=function(){_s(this,lo,xk).call(this),_s(this,lo,vk).call(this,_s(this,lo,_k).call(this))},wk=function(){Dt(this,gx)&&(sx.clearTimeout(Dt(this,gx)),ti(this,gx,void 0))},Sk=function(){Dt(this,yx)&&(sx.clearInterval(Dt(this,yx)),ti(this,yx,void 0))},Tk=function(){const e=Dt(this,mu).getQueryCache().build(Dt(this,mu),this.options);if(e===Dt(this,zs))return;const n=Dt(this,zs);ti(this,zs,e),ti(this,qw,e.state),this.hasListeners()&&(n==null||n.removeObserver(this),e.addObserver(this))},Z9=function(e){Xa.batch(()=>{e.listeners&&this.listeners.forEach(n=>{n(Dt(this,Oc))}),Dt(this,mu).getQueryCache().notify({query:Dt(this,zs),type:"observerResultsUpdated"})})},L8);function Soe(t,e){return Kd(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function dO(t,e){return Soe(t,e)||t.state.data!==void 0&&Ek(t,e,e.refetchOnMount)}function Ek(t,e,n){if(Kd(e.enabled,t)!==!1&&L0(e.staleTime,t)!=="static"){const s=typeof n=="function"?n(t):n;return s==="always"||s!==!1&&hR(t,e)}return!1}function hO(t,e,n,s){return(t!==e||Kd(s.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&hR(t,n)}function hR(t,e){return Kd(e.enabled,t)!==!1&&t.isStaleByTime(L0(e.staleTime,t))}function Toe(t,e){return!dE(t.getCurrentResult(),e)}function fO(t){return{onFetch:(e,n)=>{var E,T,k,R,D;const s=e.options,l=(k=(T=(E=e.fetchOptions)==null?void 0:E.meta)==null?void 0:T.fetchMore)==null?void 0:k.direction,u=((R=e.state.data)==null?void 0:R.pages)||[],p=((D=e.state.data)==null?void 0:D.pageParams)||[];let r={pages:[],pageParams:[]},v=0;const w=async()=>{let O=!1;const F=W=>{Object.defineProperty(W,"signal",{enumerable:!0,get:()=>(e.signal.aborted?O=!0:e.signal.addEventListener("abort",()=>{O=!0}),e.signal)})},U=H9(e.options,e.fetchOptions),X=async(W,K,ne)=>{if(O)return Promise.reject();if(K==null&&W.pages.length)return Promise.resolve(W);const re=(()=>{const ye={client:e.client,queryKey:e.queryKey,pageParam:K,direction:ne?"backward":"forward",meta:e.options.meta};return F(ye),ye})(),xe=await U(re),{maxPages:ae}=e.options,ce=ne?moe:poe;return{pages:ce(W.pages,xe,ae),pageParams:ce(W.pageParams,K,ae)}};if(l&&u.length){const W=l==="backward",K=W?Eoe:pO,ne={pages:u,pageParams:p},te=K(s,ne);r=await X(ne,te,W)}else{const W=t??u.length;do{const K=v===0?p[0]??s.initialPageParam:pO(s,r);if(v>0&&K==null)break;r=await X(r,K),v++}while(v<W)}return r};e.options.persister?e.fetchFn=()=>{var O,F;return(F=(O=e.options).persister)==null?void 0:F.call(O,w,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=w}}}function pO(t,{pages:e,pageParams:n}){const s=e.length-1;return e.length>0?t.getNextPageParam(e[s],e,n[s],n):void 0}function Eoe(t,{pages:e,pageParams:n}){var s;return e.length>0?(s=t.getPreviousPageParam)==null?void 0:s.call(t,e[0],e,n[0],n):void 0}var Zw,dp,Fc,xx,hp,_0,O8,Aoe=(O8=class extends q9{constructor(e){super();Ci(this,hp);Ci(this,Zw);Ci(this,dp);Ci(this,Fc);Ci(this,xx);ti(this,Zw,e.client),this.mutationId=e.mutationId,ti(this,Fc,e.mutationCache),ti(this,dp,[]),this.state=e.state||Q9(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Dt(this,dp).includes(e)||(Dt(this,dp).push(e),this.clearGcTimeout(),Dt(this,Fc).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ti(this,dp,Dt(this,dp).filter(n=>n!==e)),this.scheduleGc(),Dt(this,Fc).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Dt(this,dp).length||(this.state.status==="pending"?this.scheduleGc():Dt(this,Fc).remove(this))}continue(){var e;return((e=Dt(this,xx))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var p,r,v,w,E,T,k,R,D,O,F,U,X,W,K,ne,te,re,xe,ae;const n=()=>{_s(this,hp,_0).call(this,{type:"continue"})},s={client:Dt(this,Zw),meta:this.options.meta,mutationKey:this.options.mutationKey};ti(this,xx,W9({fn:()=>this.options.mutationFn?this.options.mutationFn(e,s):Promise.reject(new Error("No mutationFn found")),onFail:(ce,ye)=>{_s(this,hp,_0).call(this,{type:"failed",failureCount:ce,error:ye})},onPause:()=>{_s(this,hp,_0).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Dt(this,Fc).canRun(this)}));const l=this.state.status==="pending",u=!Dt(this,xx).canStart();try{if(l)n();else{_s(this,hp,_0).call(this,{type:"pending",variables:e,isPaused:u}),await((r=(p=Dt(this,Fc).config).onMutate)==null?void 0:r.call(p,e,this,s));const ye=await((w=(v=this.options).onMutate)==null?void 0:w.call(v,e,s));ye!==this.state.context&&_s(this,hp,_0).call(this,{type:"pending",context:ye,variables:e,isPaused:u})}const ce=await Dt(this,xx).start();return await((T=(E=Dt(this,Fc).config).onSuccess)==null?void 0:T.call(E,ce,e,this.state.context,this,s)),await((R=(k=this.options).onSuccess)==null?void 0:R.call(k,ce,e,this.state.context,s)),await((O=(D=Dt(this,Fc).config).onSettled)==null?void 0:O.call(D,ce,null,this.state.variables,this.state.context,this,s)),await((U=(F=this.options).onSettled)==null?void 0:U.call(F,ce,null,e,this.state.context,s)),_s(this,hp,_0).call(this,{type:"success",data:ce}),ce}catch(ce){try{throw await((W=(X=Dt(this,Fc).config).onError)==null?void 0:W.call(X,ce,e,this.state.context,this,s)),await((ne=(K=this.options).onError)==null?void 0:ne.call(K,ce,e,this.state.context,s)),await((re=(te=Dt(this,Fc).config).onSettled)==null?void 0:re.call(te,void 0,ce,this.state.variables,this.state.context,this,s)),await((ae=(xe=this.options).onSettled)==null?void 0:ae.call(xe,void 0,ce,e,this.state.context,s)),ce}finally{_s(this,hp,_0).call(this,{type:"error",error:ce})}}finally{Dt(this,Fc).runNext(this)}}},Zw=new WeakMap,dp=new WeakMap,Fc=new WeakMap,xx=new WeakMap,hp=new WeakSet,_0=function(e){const n=s=>{switch(e.type){case"failed":return{...s,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...s,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:e.error,failureCount:s.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Xa.batch(()=>{Dt(this,dp).forEach(s=>{s.onMutationUpdate(e)}),Dt(this,Fc).notify({mutation:this,type:"updated",action:e})})},O8);function Q9(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Lm,of,Qw,F8,Coe=(F8=class extends xb{constructor(e={}){super();Ci(this,Lm);Ci(this,of);Ci(this,Qw);this.config=e,ti(this,Lm,new Set),ti(this,of,new Map),ti(this,Qw,0)}build(e,n,s){const l=new Aoe({client:e,mutationCache:this,mutationId:++CS(this,Qw)._,options:e.defaultMutationOptions(n),state:s});return this.add(l),l}add(e){Dt(this,Lm).add(e);const n=zS(e);if(typeof n=="string"){const s=Dt(this,of).get(n);s?s.push(e):Dt(this,of).set(n,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Dt(this,Lm).delete(e)){const n=zS(e);if(typeof n=="string"){const s=Dt(this,of).get(n);if(s)if(s.length>1){const l=s.indexOf(e);l!==-1&&s.splice(l,1)}else s[0]===e&&Dt(this,of).delete(n)}}this.notify({type:"removed",mutation:e})}canRun(e){const n=zS(e);if(typeof n=="string"){const s=Dt(this,of).get(n),l=s==null?void 0:s.find(u=>u.state.status==="pending");return!l||l===e}else return!0}runNext(e){var s;const n=zS(e);if(typeof n=="string"){const l=(s=Dt(this,of).get(n))==null?void 0:s.find(u=>u!==e&&u.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Xa.batch(()=>{Dt(this,Lm).forEach(e=>{this.notify({type:"removed",mutation:e})}),Dt(this,Lm).clear(),Dt(this,of).clear()})}getAll(){return Array.from(Dt(this,Lm))}find(e){const n={exact:!0,...e};return this.getAll().find(s=>oO(n,s))}findAll(e={}){return this.getAll().filter(n=>oO(e,n))}notify(e){Xa.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return Xa.batch(()=>Promise.all(e.map(n=>n.continue().catch(zc))))}},Lm=new WeakMap,of=new WeakMap,Qw=new WeakMap,F8);function zS(t){var e;return(e=t.options.scope)==null?void 0:e.id}var Om,I0,gu,Fm,Jm,LT,Ak,B8,Moe=(B8=class extends xb{constructor(n,s){super();Ci(this,Jm);Ci(this,Om);Ci(this,I0);Ci(this,gu);Ci(this,Fm);ti(this,Om,n),this.setOptions(s),this.bindMethods(),_s(this,Jm,LT).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var l;const s=this.options;this.options=Dt(this,Om).defaultMutationOptions(n),dE(this.options,s)||Dt(this,Om).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Dt(this,gu),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&zx(s.mutationKey)!==zx(this.options.mutationKey)?this.reset():((l=Dt(this,gu))==null?void 0:l.state.status)==="pending"&&Dt(this,gu).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=Dt(this,gu))==null||n.removeObserver(this)}onMutationUpdate(n){_s(this,Jm,LT).call(this),_s(this,Jm,Ak).call(this,n)}getCurrentResult(){return Dt(this,I0)}reset(){var n;(n=Dt(this,gu))==null||n.removeObserver(this),ti(this,gu,void 0),_s(this,Jm,LT).call(this),_s(this,Jm,Ak).call(this)}mutate(n,s){var l;return ti(this,Fm,s),(l=Dt(this,gu))==null||l.removeObserver(this),ti(this,gu,Dt(this,Om).getMutationCache().build(Dt(this,Om),this.options)),Dt(this,gu).addObserver(this),Dt(this,gu).execute(n)}},Om=new WeakMap,I0=new WeakMap,gu=new WeakMap,Fm=new WeakMap,Jm=new WeakSet,LT=function(){var s;const n=((s=Dt(this,gu))==null?void 0:s.state)??Q9();ti(this,I0,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},Ak=function(n){Xa.batch(()=>{var s,l,u,p,r,v,w,E;if(Dt(this,Fm)&&this.hasListeners()){const T=Dt(this,I0).variables,k=Dt(this,I0).context,R={client:Dt(this,Om),meta:this.options.meta,mutationKey:this.options.mutationKey};(n==null?void 0:n.type)==="success"?((l=(s=Dt(this,Fm)).onSuccess)==null||l.call(s,n.data,T,k,R),(p=(u=Dt(this,Fm)).onSettled)==null||p.call(u,n.data,null,T,k,R)):(n==null?void 0:n.type)==="error"&&((v=(r=Dt(this,Fm)).onError)==null||v.call(r,n.error,T,k,R),(E=(w=Dt(this,Fm)).onSettled)==null||E.call(w,void 0,n.error,T,k,R))}this.listeners.forEach(T=>{T(Dt(this,I0))})})},B8),fp,z8,koe=(z8=class extends xb{constructor(e={}){super();Ci(this,fp);this.config=e,ti(this,fp,new Map)}build(e,n,s){const l=n.queryKey,u=n.queryHash??cR(l,n);let p=this.get(u);return p||(p=new boe({client:e,queryKey:l,queryHash:u,options:e.defaultQueryOptions(n),state:s,defaultOptions:e.getQueryDefaults(l)}),this.add(p)),p}add(e){Dt(this,fp).has(e.queryHash)||(Dt(this,fp).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=Dt(this,fp).get(e.queryHash);n&&(e.destroy(),n===e&&Dt(this,fp).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Xa.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Dt(this,fp).get(e)}getAll(){return[...Dt(this,fp).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(s=>sO(n,s))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(s=>sO(e,s)):n}notify(e){Xa.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){Xa.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Xa.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},fp=new WeakMap,z8),aa,P0,R0,Uv,Vv,N0,Hv,Gv,U8,Ioe=(U8=class{constructor(t={}){Ci(this,aa);Ci(this,P0);Ci(this,R0);Ci(this,Uv);Ci(this,Vv);Ci(this,N0);Ci(this,Hv);Ci(this,Gv);ti(this,aa,t.queryCache||new koe),ti(this,P0,t.mutationCache||new Coe),ti(this,R0,t.defaultOptions||{}),ti(this,Uv,new Map),ti(this,Vv,new Map),ti(this,N0,0)}mount(){CS(this,N0)._++,Dt(this,N0)===1&&(ti(this,Hv,dR.subscribe(async t=>{t&&(await this.resumePausedMutations(),Dt(this,aa).onFocus())})),ti(this,Gv,hE.subscribe(async t=>{t&&(await this.resumePausedMutations(),Dt(this,aa).onOnline())})))}unmount(){var t,e;CS(this,N0)._--,Dt(this,N0)===0&&((t=Dt(this,Hv))==null||t.call(this),ti(this,Hv,void 0),(e=Dt(this,Gv))==null||e.call(this),ti(this,Gv,void 0))}isFetching(t){return Dt(this,aa).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return Dt(this,P0).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=Dt(this,aa).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=Dt(this,aa).build(this,e),s=n.state.data;return s===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(L0(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(s))}getQueriesData(t){return Dt(this,aa).findAll(t).map(({queryKey:e,state:n})=>{const s=n.data;return[e,s]})}setQueryData(t,e,n){const s=this.defaultQueryOptions({queryKey:t}),l=Dt(this,aa).get(s.queryHash),u=l==null?void 0:l.state.data,p=doe(e,u);if(p!==void 0)return Dt(this,aa).build(this,s).setData(p,{...n,manual:!0})}setQueriesData(t,e,n){return Xa.batch(()=>Dt(this,aa).findAll(t).map(({queryKey:s})=>[s,this.setQueryData(s,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=Dt(this,aa).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=Dt(this,aa);Xa.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=Dt(this,aa);return Xa.batch(()=>(n.findAll(t).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},s=Xa.batch(()=>Dt(this,aa).findAll(t).map(l=>l.cancel(n)));return Promise.all(s).then(zc).catch(zc)}invalidateQueries(t,e={}){return Xa.batch(()=>(Dt(this,aa).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},s=Xa.batch(()=>Dt(this,aa).findAll(t).filter(l=>!l.isDisabled()&&!l.isStatic()).map(l=>{let u=l.fetch(void 0,n);return n.throwOnError||(u=u.catch(zc)),l.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(s).then(zc)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=Dt(this,aa).build(this,e);return n.isStaleByTime(L0(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(zc).catch(zc)}fetchInfiniteQuery(t){return t.behavior=fO(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(zc).catch(zc)}ensureInfiniteQueryData(t){return t.behavior=fO(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return hE.isOnline()?Dt(this,P0).resumePausedMutations():Promise.resolve()}getQueryCache(){return Dt(this,aa)}getMutationCache(){return Dt(this,P0)}getDefaultOptions(){return Dt(this,R0)}setDefaultOptions(t){ti(this,R0,t)}setQueryDefaults(t,e){Dt(this,Uv).set(zx(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...Dt(this,Uv).values()],n={};return e.forEach(s=>{ww(t,s.queryKey)&&Object.assign(n,s.defaultOptions)}),n}setMutationDefaults(t,e){Dt(this,Vv).set(zx(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...Dt(this,Vv).values()],n={};return e.forEach(s=>{ww(t,s.mutationKey)&&Object.assign(n,s.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...Dt(this,R0).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=cR(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===uR&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...Dt(this,R0).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){Dt(this,aa).clear(),Dt(this,P0).clear()}},aa=new WeakMap,P0=new WeakMap,R0=new WeakMap,Uv=new WeakMap,Vv=new WeakMap,N0=new WeakMap,Hv=new WeakMap,Gv=new WeakMap,U8);function Poe(t){return JSON.stringify(t,(e,n)=>Roe(n)?Object.keys(n).sort().reduce((s,l)=>(s[l]=n[l],s),{}):typeof n=="bigint"?n.toString():n)}function Roe(t){if(!mO(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const n=e.prototype;return!(!mO(n)||!n.hasOwnProperty("isPrototypeOf"))}function mO(t){return Object.prototype.toString.call(t)==="[object Object]"}function fR(t){const{_defaulted:e,behavior:n,gcTime:s,initialData:l,initialDataUpdatedAt:u,maxPages:p,meta:r,networkMode:v,queryFn:w,queryHash:E,queryKey:T,queryKeyHashFn:k,retry:R,retryDelay:D,structuralSharing:O,getPreviousPageParam:F,getNextPageParam:U,initialPageParam:X,_optimisticResults:W,enabled:K,notifyOnChangeProps:ne,placeholderData:te,refetchInterval:re,refetchIntervalInBackground:xe,refetchOnMount:ae,refetchOnReconnect:ce,refetchOnWindowFocus:ye,retryOnMount:Ce,select:Me,staleTime:Ke,suspense:ke,throwOnError:je,config:$e,connector:Ae,query:He,...qe}=t;return qe}function Noe(t){return{mutationFn(e){return nse(t,e)},mutationKey:["connect"]}}function joe(t){return{mutationFn(e){return fse(t,e)},mutationKey:["disconnect"]}}function Doe(t,e={}){return{async queryFn({queryKey:n}){const{address:s,scopeKey:l,...u}=n[1];if(!s)throw new Error("address is required");return await yse(t,{...u,address:s})??null},queryKey:Loe(e)}}function Loe(t={}){return["balance",fR(t)]}function Ooe(t,e={}){return{async queryFn({queryKey:n}){const{name:s,scopeKey:l,...u}=n[1];if(!s)throw new Error("name is required");return _se(t,{...u,name:s})},queryKey:Foe(e)}}function Foe(t={}){return["ensAvatar",fR(t)]}function Boe(t,e={}){return{async queryFn({queryKey:n}){const{address:s,scopeKey:l,...u}=n[1];if(!s)throw new Error("address is required");return vse(t,{...u,address:s})},queryKey:zoe(e)}}function zoe(t={}){return["ensName",fR(t)]}function Uoe(t){return{mutationFn(e){return wse(t,e)},mutationKey:["signMessage"]}}function Voe(t){return{mutationFn(e){return Tse(t,e)},mutationKey:["switchChain"]}}var K9=he.createContext(void 0),Y9=t=>{const e=he.useContext(K9);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Hoe=({client:t,children:e})=>(he.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),f.jsx(K9.Provider,{value:t,children:e})),J9=he.createContext(!1),Goe=()=>he.useContext(J9);J9.Provider;function $oe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Woe=he.createContext($oe()),qoe=()=>he.useContext(Woe),Xoe=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Zoe=t=>{he.useEffect(()=>{t.clearReset()},[t])},Qoe=({result:t,errorResetBoundary:e,throwOnError:n,query:s,suspense:l})=>t.isError&&!e.isReset()&&!t.isFetching&&s&&(l&&t.data===void 0||G9(n,[t.error,s])),Koe=t=>{if(t.suspense){const n=l=>l==="static"?l:Math.max(l??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...l)=>n(s(...l)):n(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Yoe=(t,e)=>t.isLoading&&t.isFetching&&!e,Joe=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,gO=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function eae(t,e,n){var T,k,R,D,O;const s=Goe(),l=qoe(),u=Y9(),p=u.defaultQueryOptions(t);(k=(T=u.getDefaultOptions().queries)==null?void 0:T._experimental_beforeQuery)==null||k.call(T,p),p._optimisticResults=s?"isRestoring":"optimistic",Koe(p),Xoe(p,l),Zoe(l);const r=!u.getQueryCache().get(p.queryHash),[v]=he.useState(()=>new e(u,p)),w=v.getOptimisticResult(p),E=!s&&t.subscribed!==!1;if(he.useSyncExternalStore(he.useCallback(F=>{const U=E?v.subscribe(Xa.batchCalls(F)):zc;return v.updateResult(),U},[v,E]),()=>v.getCurrentResult(),()=>v.getCurrentResult()),he.useEffect(()=>{v.setOptions(p)},[p,v]),Joe(p,w))throw gO(p,v,l);if(Qoe({result:w,errorResetBoundary:l,throwOnError:p.throwOnError,query:u.getQueryCache().get(p.queryHash),suspense:p.suspense}))throw w.error;if((D=(R=u.getDefaultOptions().queries)==null?void 0:R._experimental_afterQuery)==null||D.call(R,p,w),p.experimental_prefetchInRender&&!Bx&&Yoe(w,s)){const F=r?gO(p,v,l):(O=u.getQueryCache().get(p.queryHash))==null?void 0:O.promise;F==null||F.catch(zc).finally(()=>{v.updateResult()})}return p.notifyOnChangeProps?w:v.trackResult(w)}function eV(t,e){return eae(t,woe)}function TA(t,e){const n=Y9(),[s]=he.useState(()=>new Moe(n,t));he.useEffect(()=>{s.setOptions(t)},[s,t]);const l=he.useSyncExternalStore(he.useCallback(p=>s.subscribe(Xa.batchCalls(p)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),u=he.useCallback((p,r)=>{s.mutate(p,r).catch(zc)},[s]);if(l.error&&G9(s.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:u,mutateAsync:l.mutate}}function pR(t){const e=eV({...t,queryKeyHashFn:Poe});return e.queryKey=t.queryKey,e}function mR(t={}){const e=Tl(t);return he.useSyncExternalStore(n=>Ese(e,{onChange:n}),()=>XL(e),()=>XL(e))}function tV(t={}){const{address:e,query:n={}}=t,s=Tl(t),l=mR({config:s}),u=Doe(s,{...t,chainId:t.chainId??l}),p=!!(e&&(n.enabled??!0));return pR({...n,...u,enabled:p})}function tae(t={}){const e=Tl(t);return he.useSyncExternalStore(n=>noe(e,{onChange:n}),()=>ZL(e),()=>ZL(e))}function nae(t={}){const e=Tl(t);return he.useSyncExternalStore(n=>Cse(e,{onChange:n}),()=>QL(e),()=>QL(e))}function rae(t={}){const{mutation:e}=t,n=Tl(t),s=Noe(n),{mutate:l,mutateAsync:u,...p}=TA({...e,...s});return he.useEffect(()=>n.subscribe(({status:r})=>r,(r,v)=>{v==="connected"&&r==="disconnected"&&p.reset()}),[n,p.reset]),{...p,connect:l,connectAsync:u,connectors:nae({config:n})}}function iae(t={}){const e=Tl(t);return he.useSyncExternalStore(n=>Ase(e,{onChange:n}),()=>ck(e),()=>ck(e))}function EA(t={}){const{mutation:e}=t,n=Tl(t),s=joe(n),{mutate:l,mutateAsync:u,...p}=TA({...e,...s});return{...p,connectors:iae({config:n}).map(r=>r.connector),disconnect:l,disconnectAsync:u}}function sae(t={}){const{name:e,query:n={}}=t,s=Tl(t),l=mR({config:s}),u=Ooe(s,{...t,chainId:t.chainId??l}),p=!!(e&&(n.enabled??!0));return pR({...n,...u,enabled:p})}function oae(t={}){const{address:e,query:n={}}=t,s=Tl(t),l=mR({config:s}),u=Boe(s,{...t,chainId:t.chainId??l}),p=!!(e&&(n.enabled??!0));return pR({...n,...u,enabled:p})}function aae(t={}){const e=Tl(t);return B9.useSyncExternalStoreWithSelector(n=>Mse(e,{onChange:n}),()=>uk(e,t),()=>uk(e,t),n=>n,(n,s)=>(n==null?void 0:n.uid)===(s==null?void 0:s.uid))}function lae(t={}){const{mutation:e}=t,n=Tl(t),s=Uoe(n),{mutate:l,mutateAsync:u,...p}=TA({...e,...s});return{...p,signMessage:l,signMessageAsync:u}}function cae(t={}){const{mutation:e}=t,n=Tl(t),s=Voe(n),{mutate:l,mutateAsync:u,...p}=TA({...e,...s});return{...p,chains:tae({config:n}),switchChain:l,switchChainAsync:u}}var yO='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',uae={rounded:`SFRounded, ui-rounded, "SF Pro Rounded", ${yO}`,system:yO},S1={large:{actionButton:"9999px",connectButton:"12px",modal:"24px",modalMobile:"28px"},medium:{actionButton:"10px",connectButton:"8px",modal:"16px",modalMobile:"18px"},none:{actionButton:"0px",connectButton:"0px",modal:"0px",modalMobile:"0px"},small:{actionButton:"4px",connectButton:"4px",modal:"8px",modalMobile:"8px"}},dae={large:{modalOverlay:"blur(20px)"},none:{modalOverlay:"blur(0px)"},small:{modalOverlay:"blur(4px)"}},nV=({borderRadius:t="large",fontStack:e="rounded",overlayBlur:n="none"})=>({blurs:{modalOverlay:dae[n].modalOverlay},fonts:{body:uae[e]},radii:{actionButton:S1[t].actionButton,connectButton:S1[t].connectButton,menuButton:S1[t].connectButton,modal:S1[t].modal,modalMobile:S1[t].modalMobile}}),OT="#1A1B1F",rV={blue:{accentColor:"#3898FF",accentColorForeground:"#FFF"},green:{accentColor:"#4BD166",accentColorForeground:OT},orange:{accentColor:"#FF983D",accentColorForeground:OT},pink:{accentColor:"#FF7AB8",accentColorForeground:OT},purple:{accentColor:"#7A70FF",accentColorForeground:"#FFF"},red:{accentColor:"#FF6257",accentColorForeground:"#FFF"}},xO=rV.blue,iV=({accentColor:t=xO.accentColor,accentColorForeground:e=xO.accentColorForeground,...n}={})=>({...nV(n),colors:{accentColor:t,accentColorForeground:e,actionButtonBorder:"rgba(255, 255, 255, 0.04)",actionButtonBorderMobile:"rgba(255, 255, 255, 0.08)",actionButtonSecondaryBackground:"rgba(255, 255, 255, 0.08)",closeButton:"rgba(224, 232, 255, 0.6)",closeButtonBackground:"rgba(255, 255, 255, 0.08)",connectButtonBackground:OT,connectButtonBackgroundError:"#FF494A",connectButtonInnerBackground:"linear-gradient(0deg, rgba(255, 255, 255, 0.075), rgba(255, 255, 255, 0.15))",connectButtonText:"#FFF",connectButtonTextError:"#FFF",connectionIndicator:"#30E000",downloadBottomCardBackground:"linear-gradient(126deg, rgba(0, 0, 0, 0) 9.49%, rgba(120, 120, 120, 0.2) 71.04%), #1A1B1F",downloadTopCardBackground:"linear-gradient(126deg, rgba(120, 120, 120, 0.2) 9.49%, rgba(0, 0, 0, 0) 71.04%), #1A1B1F",error:"#FF494A",generalBorder:"rgba(255, 255, 255, 0.08)",generalBorderDim:"rgba(255, 255, 255, 0.04)",menuItemBackground:"rgba(224, 232, 255, 0.1)",modalBackdrop:"rgba(0, 0, 0, 0.5)",modalBackground:"#1A1B1F",modalBorder:"rgba(255, 255, 255, 0.08)",modalText:"#FFF",modalTextDim:"rgba(224, 232, 255, 0.3)",modalTextSecondary:"rgba(255, 255, 255, 0.6)",profileAction:"rgba(224, 232, 255, 0.1)",profileActionHover:"rgba(224, 232, 255, 0.2)",profileForeground:"rgba(224, 232, 255, 0.05)",selectedOptionBorder:"rgba(224, 232, 255, 0.1)",standby:"#FFD641"},shadows:{connectButton:"0px 4px 12px rgba(0, 0, 0, 0.1)",dialog:"0px 8px 32px rgba(0, 0, 0, 0.32)",profileDetailsAction:"0px 2px 6px rgba(37, 41, 46, 0.04)",selectedOption:"0px 2px 6px rgba(0, 0, 0, 0.24)",selectedWallet:"0px 2px 6px rgba(0, 0, 0, 0.24)",walletLogo:"0px 2px 16px rgba(0, 0, 0, 0.16)"}});iV.accentColors=rV;var sV={blue:{accentColor:"#0E76FD",accentColorForeground:"#FFF"},green:{accentColor:"#1DB847",accentColorForeground:"#FFF"},orange:{accentColor:"#FF801F",accentColorForeground:"#FFF"},pink:{accentColor:"#FF5CA0",accentColorForeground:"#FFF"},purple:{accentColor:"#5F5AFA",accentColorForeground:"#FFF"},red:{accentColor:"#FA423C",accentColorForeground:"#FFF"}},_O=sV.blue,oV=({accentColor:t=_O.accentColor,accentColorForeground:e=_O.accentColorForeground,...n}={})=>({...nV(n),colors:{accentColor:t,accentColorForeground:e,actionButtonBorder:"rgba(0, 0, 0, 0.04)",actionButtonBorderMobile:"rgba(0, 0, 0, 0.06)",actionButtonSecondaryBackground:"rgba(0, 0, 0, 0.06)",closeButton:"rgba(60, 66, 66, 0.8)",closeButtonBackground:"rgba(0, 0, 0, 0.06)",connectButtonBackground:"#FFF",connectButtonBackgroundError:"#FF494A",connectButtonInnerBackground:"linear-gradient(0deg, rgba(0, 0, 0, 0.03), rgba(0, 0, 0, 0.06))",connectButtonText:"#25292E",connectButtonTextError:"#FFF",connectionIndicator:"#30E000",downloadBottomCardBackground:"linear-gradient(126deg, rgba(255, 255, 255, 0) 9.49%, rgba(171, 171, 171, 0.04) 71.04%), #FFFFFF",downloadTopCardBackground:"linear-gradient(126deg, rgba(171, 171, 171, 0.2) 9.49%, rgba(255, 255, 255, 0) 71.04%), #FFFFFF",error:"#FF494A",generalBorder:"rgba(0, 0, 0, 0.06)",generalBorderDim:"rgba(0, 0, 0, 0.03)",menuItemBackground:"rgba(60, 66, 66, 0.1)",modalBackdrop:"rgba(0, 0, 0, 0.3)",modalBackground:"#FFF",modalBorder:"transparent",modalText:"#25292E",modalTextDim:"rgba(60, 66, 66, 0.3)",modalTextSecondary:"rgba(60, 66, 66, 0.6)",profileAction:"#FFF",profileActionHover:"rgba(255, 255, 255, 0.5)",profileForeground:"rgba(60, 66, 66, 0.06)",selectedOptionBorder:"rgba(60, 66, 66, 0.1)",standby:"#FFD641"},shadows:{connectButton:"0px 4px 12px rgba(0, 0, 0, 0.1)",dialog:"0px 8px 32px rgba(0, 0, 0, 0.32)",profileDetailsAction:"0px 2px 6px rgba(37, 41, 46, 0.04)",selectedOption:"0px 2px 6px rgba(0, 0, 0, 0.24)",selectedWallet:"0px 2px 6px rgba(0, 0, 0, 0.12)",walletLogo:"0px 2px 16px rgba(0, 0, 0, 0.16)"}});oV.accentColors=sV;var Ck=`{
  "connect_wallet": {
    "label": "Connect Wallet",
    "wrong_network": {
      "label": "Wrong network"
    }
  },

  "intro": {
    "title": "What is a Wallet?",
    "description": "A wallet is used to send, receive, store, and display digital assets. It's also a new way to log in, without needing to create new accounts and passwords on every website.",
    "digital_asset": {
      "title": "A Home for your Digital Assets",
      "description": "Wallets are used to send, receive, store, and display digital assets like Ethereum and NFTs."
    },
    "login": {
      "title": "A New Way to Log In",
      "description": "Instead of creating new accounts and passwords on every website, just connect your wallet."
    },
    "get": {
      "label": "Get a Wallet"
    },
    "learn_more": {
      "label": "Learn More"
    }
  },

  "sign_in": {
    "label": "Verify your account",
    "description": "To finish connecting, you must sign a message in your wallet to verify that you are the owner of this account.",
    "message": {
      "send": "Sign message",
      "preparing": "Preparing message...",
      "cancel": "Cancel",
      "preparing_error": "Error preparing message, please retry!"
    },
    "signature": {
      "waiting": "Waiting for signature...",
      "verifying": "Verifying signature...",
      "signing_error": "Error signing message, please retry!",
      "verifying_error": "Error verifying signature, please retry!",
      "oops_error": "Oops, something went wrong!"
    }
  },

  "connect": {
    "label": "Connect",
    "title": "Connect a Wallet",
    "new_to_ethereum": {
      "description": "New to Ethereum wallets?",
      "learn_more": {
        "label": "Learn More"
      }
    },
    "learn_more": {
      "label": "Learn more"
    },
    "recent": "Recent",
    "status": {
      "opening": "Opening %{wallet}...",
      "connecting": "Connecting",
      "connect_mobile": "Continue in %{wallet}",
      "not_installed": "%{wallet} is not installed",
      "not_available": "%{wallet} is not available",
      "confirm": "Confirm connection in the extension",
      "confirm_mobile": "Accept connection request in the wallet"
    },
    "secondary_action": {
      "get": {
        "description": "Don't have %{wallet}?",
        "label": "GET"
      },
      "install": {
        "label": "INSTALL"
      },
      "retry": {
        "label": "RETRY"
      }
    },
    "walletconnect": {
      "description": {
        "full": "Need the official WalletConnect modal?",
        "compact": "Need the WalletConnect modal?"
      },
      "open": {
        "label": "OPEN"
      }
    }
  },

  "connect_scan": {
    "title": "Scan with %{wallet}",
    "fallback_title": "Scan with your phone"
  },

  "connector_group": {
    "installed": "Installed",
    "recommended": "Recommended",
    "other": "Other",
    "popular": "Popular",
    "more": "More",
    "others": "Others"
  },

  "get": {
    "title": "Get a Wallet",
    "action": {
      "label": "GET"
    },
    "mobile": {
      "description": "Mobile Wallet"
    },
    "extension": {
      "description": "Browser Extension"
    },
    "mobile_and_extension": {
      "description": "Mobile Wallet and Extension"
    },
    "mobile_and_desktop": {
      "description": "Mobile and Desktop Wallet"
    },
    "looking_for": {
      "title": "Not what you're looking for?",
      "mobile": {
        "description": "Select a wallet on the main screen to get started with a different wallet provider."
      },
      "desktop": {
        "compact_description": "Select a wallet on the main screen to get started with a different wallet provider.",
        "wide_description": "Select a wallet on the left to get started with a different wallet provider."
      }
    }
  },

  "get_options": {
    "title": "Get started with %{wallet}",
    "short_title": "Get %{wallet}",
    "mobile": {
      "title": "%{wallet} for Mobile",
      "description": "Use the mobile wallet to explore the world of Ethereum.",
      "download": {
        "label": "Get the app"
      }
    },
    "extension": {
      "title": "%{wallet} for %{browser}",
      "description": "Access your wallet right from your favorite web browser.",
      "download": {
        "label": "Add to %{browser}"
      }
    },
    "desktop": {
      "title": "%{wallet} for %{platform}",
      "description": "Access your wallet natively from your powerful desktop.",
      "download": {
        "label": "Add to %{platform}"
      }
    }
  },

  "get_mobile": {
    "title": "Install %{wallet}",
    "description": "Scan with your phone to download on iOS or Android",
    "continue": {
      "label": "Continue"
    }
  },

  "get_instructions": {
    "mobile": {
      "connect": {
        "label": "Connect"
      },
      "learn_more": {
        "label": "Learn More"
      }
    },
    "extension": {
      "refresh": {
        "label": "Refresh"
      },
      "learn_more": {
        "label": "Learn More"
      }
    },
    "desktop": {
      "connect": {
        "label": "Connect"
      },
      "learn_more": {
        "label": "Learn More"
      }
    }
  },

  "chains": {
    "title": "Switch Networks",
    "wrong_network": "Wrong network detected, switch or disconnect to continue.",
    "confirm": "Confirm in Wallet",
    "switching_not_supported": "Your wallet does not support switching networks from %{appName}. Try switching networks from within your wallet instead.",
    "switching_not_supported_fallback": "Your wallet does not support switching networks from this app. Try switching networks from within your wallet instead.",
    "disconnect": "Disconnect",
    "connected": "Connected"
  },

  "profile": {
    "disconnect": {
      "label": "Disconnect"
    },
    "copy_address": {
      "label": "Copy Address",
      "copied": "Copied!"
    },
    "explorer": {
      "label": "View more on explorer"
    },
    "transactions": {
      "description": "%{appName} transactions will appear here...",
      "description_fallback": "Your transactions will appear here...",
      "recent": {
        "title": "Recent Transactions"
      },
      "clear": {
        "label": "Clear All"
      }
    }
  },

  "wallet_connectors": {
    "argent": {
      "qr_code": {
        "step1": {
          "description": "Put Argent on your home screen for faster access to your wallet.",
          "title": "Open the Argent app"
        },
        "step2": {
          "description": "Create a wallet and username, or import an existing wallet.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the Scan QR button"
        }
      }
    },

    "berasig": {
      "extension": {
        "step1": {
          "title": "Install the BeraSig extension",
          "description": "We recommend pinning BeraSig to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "best": {
      "qr_code": {
        "step1": {
          "title": "Open the Best Wallet app",
          "description": "Add Best Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "bifrost": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Bifrost Wallet on your home screen for quicker access.",
          "title": "Open the Bifrost Wallet app"
        },
        "step2": {
          "description": "Create or import a wallet using your recovery phrase.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      }
    },

    "bitget": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Bitget Wallet on your home screen for quicker access.",
          "title": "Open the Bitget Wallet app"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      },

      "extension": {
        "step1": {
          "description": "We recommend pinning Bitget Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Bitget Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "bitski": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Bitski to your taskbar for quicker access to your wallet.",
          "title": "Install the Bitski extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "bitverse": {
      "qr_code": {
        "step1": {
          "title": "Open the Bitverse Wallet app",
          "description": "Add Bitverse Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "bloom": {
      "desktop": {
        "step1": {
          "title": "Open the Bloom Wallet app",
          "description": "We recommend putting Bloom Wallet on your home screen for quicker access."
        },
        "step2": {
          "description": "Create or import a wallet using your recovery phrase.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you have a wallet, click on Connect to connect via Bloom. A connection prompt in the app will appear for you to confirm the connection.",
          "title": "Click on Connect"
        }
      }
    },

    "bybit": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Bybit on your home screen for faster access to your wallet.",
          "title": "Open the Bybit app"
        },
        "step2": {
          "description": "You can easily backup your wallet using our backup feature on your phone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      },

      "extension": {
        "step1": {
          "description": "Click at the top right of your browser and pin Bybit Wallet for easy access.",
          "title": "Install the Bybit Wallet extension"
        },
        "step2": {
          "description": "Create a new wallet or import an existing one.",
          "title": "Create or Import a wallet"
        },
        "step3": {
          "description": "Once you set up Bybit Wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "binance": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Binance on your home screen for faster access to your wallet.",
          "title": "Open the Binance app"
        },
        "step2": {
          "description": "You can easily backup your wallet using our backup feature on your phone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the WalletConnect button"
        }
      },
      "extension": {
        "step1": {
          "title": "Install the Binance Wallet extension",
          "description": "We recommend pinning Binance Wallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "coin98": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Coin98 Wallet on your home screen for faster access to your wallet.",
          "title": "Open the Coin98 Wallet app"
        },
        "step2": {
          "description": "You can easily backup your wallet using our backup feature on your phone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the WalletConnect button"
        }
      },

      "extension": {
        "step1": {
          "description": "Click at the top right of your browser and pin Coin98 Wallet for easy access.",
          "title": "Install the Coin98 Wallet extension"
        },
        "step2": {
          "description": "Create a new wallet or import an existing one.",
          "title": "Create or Import a wallet"
        },
        "step3": {
          "description": "Once you set up Coin98 Wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "coinbase": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Coinbase Wallet on your home screen for quicker access.",
          "title": "Open the Coinbase Wallet app"
        },
        "step2": {
          "description": "You can easily backup your wallet using the cloud backup feature.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      },

      "extension": {
        "step1": {
          "description": "We recommend pinning Coinbase Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Coinbase Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "compass": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Compass Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Compass Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "core": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Core on your home screen for faster access to your wallet.",
          "title": "Open the Core app"
        },
        "step2": {
          "description": "You can easily backup your wallet using our backup feature on your phone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the WalletConnect button"
        }
      },

      "extension": {
        "step1": {
          "description": "We recommend pinning Core to your taskbar for quicker access to your wallet.",
          "title": "Install the Core extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "fox": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting FoxWallet on your home screen for quicker access.",
          "title": "Open the FoxWallet app"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      }
    },

    "frontier": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Frontier Wallet on your home screen for quicker access.",
          "title": "Open the Frontier Wallet app"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      },

      "extension": {
        "step1": {
          "description": "We recommend pinning Frontier Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Frontier Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "im_token": {
      "qr_code": {
        "step1": {
          "title": "Open the imToken app",
          "description": "Put imToken app on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap Scanner Icon in top right corner",
          "description": "Choose New Connection, then scan the QR code and confirm the prompt to connect."
        }
      }
    },

    "iopay": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting ioPay on your home screen for faster access to your wallet.",
          "title": "Open the ioPay app"
        },
        "step2": {
          "description": "You can easily backup your wallet using our backup feature on your phone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the WalletConnect button"
        }
      }
    },

    "kaikas": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Kaikas to your taskbar for quicker access to your wallet.",
          "title": "Install the Kaikas extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the Kaikas app",
          "description": "Put Kaikas app on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap Scanner Icon in top right corner",
          "description": "Choose New Connection, then scan the QR code and confirm the prompt to connect."
        }
      }
    },

    "kaia": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Kaia to your taskbar for quicker access to your wallet.",
          "title": "Install the Kaia extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the Kaia app",
          "description": "Put Kaia app on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap Scanner Icon in top right corner",
          "description": "Choose New Connection, then scan the QR code and confirm the prompt to connect."
        }
      }
    },

    "kraken": {
      "qr_code": {
        "step1": {
          "title": "Open the Kraken Wallet app",
          "description": "Add Kraken Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "kresus": {
      "qr_code": {
        "step1": {
          "title": "Open the Kresus Wallet app",
          "description": "Add Kresus Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "magicEden": {
      "extension": {
        "step1": {
          "title": "Install the Magic Eden extension",
          "description": "We recommend pinning Magic Eden to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret recovery phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "metamask": {
      "qr_code": {
        "step1": {
          "title": "Open the MetaMask app",
          "description": "We recommend putting MetaMask on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      },

      "extension": {
        "step1": {
          "title": "Install the MetaMask extension",
          "description": "We recommend pinning MetaMask to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "nestwallet": {
      "extension": {
        "step1": {
          "title": "Install the NestWallet extension",
          "description": "We recommend pinning NestWallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "okx": {
      "qr_code": {
        "step1": {
          "title": "Open the OKX Wallet app",
          "description": "We recommend putting OKX Wallet on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      },

      "extension": {
        "step1": {
          "title": "Install the OKX Wallet extension",
          "description": "We recommend pinning OKX Wallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "omni": {
      "qr_code": {
        "step1": {
          "title": "Open the Omni app",
          "description": "Add Omni to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your home screen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "1inch": {
      "qr_code": {
        "step1": {
          "description": "Put 1inch Wallet on your home screen for faster access to your wallet.",
          "title": "Open the 1inch Wallet app"
        },
        "step2": {
          "description": "Create a wallet and username, or import an existing wallet.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the Scan QR button"
        }
      }
    },

    "token_pocket": {
      "qr_code": {
        "step1": {
          "title": "Open the TokenPocket app",
          "description": "We recommend putting TokenPocket on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      },

      "extension": {
        "step1": {
          "title": "Install the TokenPocket extension",
          "description": "We recommend pinning TokenPocket to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "trust": {
      "qr_code": {
        "step1": {
          "title": "Open the Trust Wallet app",
          "description": "Put Trust Wallet on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap WalletConnect in Settings",
          "description": "Choose New Connection, then scan the QR code and confirm the prompt to connect."
        }
      },

      "extension": {
        "step1": {
          "title": "Install the Trust Wallet extension",
          "description": "Click at the top right of your browser and pin Trust Wallet for easy access."
        },
        "step2": {
          "title": "Create or Import a wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up Trust Wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "uniswap": {
      "qr_code": {
        "step1": {
          "title": "Open the Uniswap app",
          "description": "Add Uniswap Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "zerion": {
      "qr_code": {
        "step1": {
          "title": "Open the Zerion app",
          "description": "We recommend putting Zerion on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      },

      "extension": {
        "step1": {
          "title": "Install the Zerion extension",
          "description": "We recommend pinning Zerion to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "rainbow": {
      "qr_code": {
        "step1": {
          "title": "Open the Rainbow app",
          "description": "We recommend putting Rainbow on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "You can easily backup your wallet using our backup feature on your phone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "enkrypt": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Enkrypt Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Enkrypt Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "frame": {
      "extension": {
        "step1": {
          "description": "We recommend pinning Frame to your taskbar for quicker access to your wallet.",
          "title": "Install Frame & the companion extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "one_key": {
      "extension": {
        "step1": {
          "title": "Install the OneKey Wallet extension",
          "description": "We recommend pinning OneKey Wallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "paraswap": {
      "qr_code": {
        "step1": {
          "title": "Open the ParaSwap app",
          "description": "Add ParaSwap Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      }
    },

    "phantom": {
      "extension": {
        "step1": {
          "title": "Install the Phantom extension",
          "description": "We recommend pinning Phantom to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret recovery phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "rabby": {
      "extension": {
        "step1": {
          "title": "Install the Rabby extension",
          "description": "We recommend pinning Rabby to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "ronin": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting Ronin Wallet on your home screen for quicker access.",
          "title": "Open the Ronin Wallet app"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      },

      "extension": {
        "step1": {
          "description": "We recommend pinning Ronin Wallet to your taskbar for quicker access to your wallet.",
          "title": "Install the Ronin Wallet extension"
        },
        "step2": {
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension.",
          "title": "Refresh your browser"
        }
      }
    },

    "ramper": {
      "extension": {
        "step1": {
          "title": "Install the Ramper extension",
          "description": "We recommend pinning Ramper to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "safeheron": {
      "extension": {
        "step1": {
          "title": "Install the Core extension",
          "description": "We recommend pinning Safeheron to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "taho": {
      "extension": {
        "step1": {
          "title": "Install the Taho extension",
          "description": "We recommend pinning Taho to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "wigwam": {
      "extension": {
        "step1": {
          "title": "Install the Wigwam extension",
          "description": "We recommend pinning Wigwam to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "talisman": {
      "extension": {
        "step1": {
          "title": "Install the Talisman extension",
          "description": "We recommend pinning Talisman to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import an Ethereum Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your recovery phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "xdefi": {
      "extension": {
        "step1": {
          "title": "Install the XDEFI Wallet extension",
          "description": "We recommend pinning XDEFI Wallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "zeal": {
      "qr_code": {
        "step1": {
          "title": "Open the Zeal app",
          "description": "Add Zeal Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the QR icon and scan",
          "description": "Tap the QR icon on your homescreen, scan the code and confirm the prompt to connect."
        }
      },
      "extension": {
        "step1": {
          "title": "Install the Zeal extension",
          "description": "We recommend pinning Zeal to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "safepal": {
      "extension": {
        "step1": {
          "title": "Install the SafePal Wallet extension",
          "description": "Click at the top right of your browser and pin SafePal Wallet for easy access."
        },
        "step2": {
          "title": "Create or Import a wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up SafePal Wallet, click below to refresh the browser and load up the extension."
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the SafePal Wallet app",
          "description": "Put SafePal Wallet on your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap WalletConnect in Settings",
          "description": "Choose New Connection, then scan the QR code and confirm the prompt to connect."
        }
      }
    },

    "desig": {
      "extension": {
        "step1": {
          "title": "Install the Desig extension",
          "description": "We recommend pinning Desig to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "subwallet": {
      "extension": {
        "step1": {
          "title": "Install the SubWallet extension",
          "description": "We recommend pinning SubWallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your recovery phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the SubWallet app",
          "description": "We recommend putting SubWallet on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "clv": {
      "extension": {
        "step1": {
          "title": "Install the CLV Wallet extension",
          "description": "We recommend pinning CLV Wallet to your taskbar for quicker access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the CLV Wallet app",
          "description": "We recommend putting CLV Wallet on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret phrase with anyone."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "okto": {
      "qr_code": {
        "step1": {
          "title": "Open the Okto app",
          "description": "Add Okto to your home screen for quick access"
        },
        "step2": {
          "title": "Create an MPC Wallet",
          "description": "Create an account and generate a wallet"
        },
        "step3": {
          "title": "Tap WalletConnect in Settings",
          "description": "Tap the Scan QR icon at the top right and confirm the prompt to connect."
        }
      }
    },

    "ledger": {
      "desktop": {
        "step1": {
          "title": "Open the Ledger Live app",
          "description": "We recommend putting Ledger Live on your home screen for quicker access."
        },
        "step2": {
          "title": "Set up your Ledger",
          "description": "Set up a new Ledger or connect to an existing one."
        },
        "step3": {
          "title": "Connect",
          "description": "A connection prompt will appear for you to connect your wallet."
        }
      },
      "qr_code": {
        "step1": {
          "title": "Open the Ledger Live app",
          "description": "We recommend putting Ledger Live on your home screen for quicker access."
        },
        "step2": {
          "title": "Set up your Ledger",
          "description": "You can either sync with the desktop app or connect your Ledger."
        },
        "step3": {
          "title": "Scan the code",
          "description": "Tap WalletConnect then Switch to Scanner. After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "valora": {
      "qr_code": {
        "step1": {
          "title": "Open the Valora app",
          "description": "We recommend putting Valora on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or import a wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "gate": {
      "qr_code": {
        "step1": {
          "title": "Open the Gate app",
          "description": "We recommend putting Gate on your home screen for quicker access."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      },
      "extension": {
        "step1": {
          "title": "Install the Gate extension",
          "description": "We recommend pinning Gate to your taskbar for easier access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Be sure to back up your wallet using a secure method. Never share your secret recovery phrase with anyone."
        },
        "step3": {
          "title": "Refresh your browser",
          "description": "Once you set up your wallet, click below to refresh the browser and load up the extension."
        }
      }
    },

    "gemini": {
      "qr_code": {
        "step1": {
          "title": "Open keys.gemini.com",
          "description": "Visit keys.gemini.com on your mobile browser - no app download required."
        },
        "step2": {
          "title": "Create Your Wallet Instantly",
          "description": "Set up your smart wallet in seconds using your device's built-in authentication."
        },
        "step3": {
          "title": "Scan to Connect",
          "description": "Scan the QR code to instantly connect your wallet - it just works."
        }
      },
      "extension": {
        "step1": {
          "title": "Go to keys.gemini.com",
          "description": "No extensions or downloads needed - your wallet lives securely in the browser."
        },
        "step2": {
          "title": "One-Click Setup",
          "description": "Create your smart wallet instantly with passkey authentication - easier than any wallet out there."
        },
        "step3": {
          "title": "Connect and Go",
          "description": "Approve the connection and you're ready - the unopinionated wallet that just works."
        }
      }
    },

    "xportal": {
      "qr_code": {
        "step1": {
          "description": "Put xPortal on your home screen for faster access to your wallet.",
          "title": "Open the xPortal app"
        },
        "step2": {
          "description": "Create a wallet or import an existing one.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the Scan QR button"
        }
      }
    },

    "mew": {
      "qr_code": {
        "step1": {
          "description": "We recommend putting MEW Wallet on your home screen for quicker access.",
          "title": "Open the MEW Wallet app"
        },
        "step2": {
          "description": "You can easily backup your wallet using the cloud backup feature.",
          "title": "Create or Import a Wallet"
        },
        "step3": {
          "description": "After you scan, a connection prompt will appear for you to connect your wallet.",
          "title": "Tap the scan button"
        }
      }
    },

    "zilpay": {
      "qr_code": {
        "step1": {
          "title": "Open the ZilPay app",
          "description": "Add ZilPay to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    },

    "nova": {
      "qr_code": {
        "step1": {
          "title": "Open the Nova Wallet app",
          "description": "Add Nova Wallet to your home screen for faster access to your wallet."
        },
        "step2": {
          "title": "Create or Import a Wallet",
          "description": "Create a new wallet or import an existing one."
        },
        "step3": {
          "title": "Tap the scan button",
          "description": "After you scan, a connection prompt will appear for you to connect your wallet."
        }
      }
    }
  }
}
`;function hae(t,e){return Object.defineProperty(t,"__recipe__",{value:e,writable:!1}),t}var aV=hae;function lV(t){var{conditions:e}=t;if(!e)throw new Error("Styles have no conditions");function n(s){if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"){if(!e.defaultCondition)throw new Error("No default condition");return{[e.defaultCondition]:s}}if(Array.isArray(s)){if(!("responsiveArray"in e))throw new Error("Responsive arrays are not supported");var l={};for(var u in e.responsiveArray)s[u]!=null&&(l[e.responsiveArray[u]]=s[u]);return l}return s}return aV(n,{importPath:"@vanilla-extract/sprinkles/createUtils",importName:"createNormalizeValueFn",args:[{conditions:t.conditions}]})}function fae(t){var{conditions:e}=t;if(!e)throw new Error("Styles have no conditions");var n=lV(t);function s(l,u){if(typeof l=="string"||typeof l=="number"||typeof l=="boolean"){if(!e.defaultCondition)throw new Error("No default condition");return u(l,e.defaultCondition)}var p=Array.isArray(l)?n(l):l,r={};for(var v in p)p[v]!=null&&(r[v]=u(p[v],v));return r}return aV(s,{importPath:"@vanilla-extract/sprinkles/createUtils",importName:"createMapValueFn",args:[{conditions:t.conditions}]})}function pae(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mae(t){var e=pae(t,"string");return typeof e=="symbol"?e:String(e)}function gae(t,e,n){return e=mae(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,s)}return n}function tM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vO(Object(n),!0).forEach(function(s){gae(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vO(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var yae=t=>function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var l=Object.assign({},...n.map(v=>v.styles)),u=Object.keys(l),p=u.filter(v=>"mappings"in l[v]),r=v=>{var w=[],E={},T=tM({},v),k=!1;for(var R of p){var D=v[R];if(D!=null){var O=l[R];k=!0;for(var F of O.mappings)E[F]=D,T[F]==null&&delete T[F]}}var U=k?tM(tM({},E),T):v,X=function(){var ne=U[W],te=l[W];try{if(te.mappings)return 1;if(typeof ne=="string"||typeof ne=="number")w.push(te.values[ne].defaultClass);else if(Array.isArray(ne))for(var re=0;re<ne.length;re++){var xe=ne[re];if(xe!=null){var ae=te.responsiveArray[re];w.push(te.values[xe].conditions[ae])}}else for(var ce in ne){var ye=ne[ce];ye!=null&&w.push(te.values[ye].conditions[ce])}}catch(Ce){throw Ce}};for(var W in U)X();return t(w.join(" "))};return Object.assign(r,{properties:new Set(u)})},xae=t=>t,_ae=function(){return yae(xae)(...arguments)};function cV(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var l=t.length;for(e=0;e<l;e++)t[e]&&(n=cV(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function uV(){for(var t,e,n=0,s="",l=arguments.length;n<l;n++)(t=arguments[n])&&(e=cV(t))&&(s&&(s+=" "),s+=e);return s}var vae="AEkVMQnvDV0B0wKWAQYBQgDpATQAoQDcAIUApwBsAOMAcACTAEUAigBRAHkAPgA/ACwANwAoAGIAHgAvACsAJQAXAC8AHAAhACIALwAVACsAEQAiAAsAGwARABgAFwA7ACoAKwAsADQAFgAtABIAHAAhAA4AHQAdABUAFgAZAA0ADgAXABAAGQAUABIEtAYQASIUOjfDBdMAsQCuPwFnAKUBA10jAK5/Ly8vLwE/pwUJ6/0HPwbkMQVXBVgAPSs5APa2EQbIwQuUCkEDyJ4zAsUKLwKOoQKG2D+Ob4kCxcsCg/IBH98JAPKtAUECLY0KP48A4wDiChUAF9S5yAwLPZ0EG3cA/QI5GL0P6wkGKekFBIFnDRsHLQCrAGmR76WcfwBbBpMjBukAGwA7DJMAWxVbqft7uycM2yDPCLspA7EUOwD3LWujAKF9GAAXBCXXFgEdALkZzQT6CSBMNwmXCYgeG1ZZTOODQgATAAwAFQAOa1QAIQAOAEfuFdg98zlYypXmLgoQHV9NWD3sABMADAAVAA5rIFxAlwDD6wAbADkMxQAbFVup+3EB224cHQVbBeIC0J8CxLAKTBykZRRzGm1M9QC7DWcC4QALLTSJF8mRAoF7ARMbAL0NZwLhAAstAUhQJZFMCgMt+wUyCddpF60B10MASSsSdwIxFiEC6ye5N2sAOeEB9SUAxw7LtQEbY4EAsQUABQCK00kFG8MfBxcAqCfRAaErLQObAGcBChk+7Td0BBgXAKoBxwIhANMrEnM681CwBZA6dyc1SAX6JwVZBVivuAVpO11CEjpYQZd7k2ZfofgLEwPFByXxdyMEo0sCU1MCdRurJwGPo6U1WwNFFwSDYQkA0QarPy8jBykCOV0AawFhH3EAgx0ZAJUBSbcAJ2kXAa/FAzctIUNTAW9ZBmUCZQDxSRcDKQEFAElBAKsAXQBzACu1Bgfz7xmNfwAJIQApALMbRwHRAdsHCzGXeIHoAAoAEQA0AD0AODN3edPAEF8QXAFNCUxsOhULAqwPpgvlERUM0SrL09gANKkH6wNTB+sDUwNTB+sH6wNTB+sDUwNTA1MDUxwK8BrTwBBfD0gEbQWOBYsE1giDJkkRgQcoCNJUDXQeHEcDRQD8IyVJHDuTMwslQkwMTQMH/DZCbKd9OANHMatU9ZCiA8syTzlsAR5xEqAAKg9zHDW1Tn56R3GgCktPrrV/SWJOZwK+Oqg/+AohCZNvu3dOBj0QFyehEPMMLwGxATcN6UvUBO0GNwTFH3kZFQ/JlZgIoS3ZDOkm3y6dgFYj8Sp/BelL8DzZC0lRZA9VC2EJ3zpfgUoDHQEJIocK2Q01CGkQ7wrFZw3hEUEHNQPRSZYAoQb9Cw0dMRWxJgxiqAsFOXMG9xryC4smqxMlevgFzxodBkkBJRr7AMsu44WsWi1cGE9bBf8LISPDFKRQHA0hQLN4RBoXBxElpQKNQ2xKg1EyHo8h8jw5DWIuD1F4B/E8ARlLC308mkanRQoRzj6JPUQiRUwoBDF7LCsnhwnLD4EMtXxuAVUJHQmtDG0TLRETN8EINQcVKZcgJxEIHUaRYJYE85sD7xPNAwcFOwk9Bw8DsRwpEyoVJQUJgSDTAu820S6vAotWfAETBccPIR/bEExH3A7lCJcCYQN/JecAKRUdABMilwg/XwBbj9RTAS7HCMNqaCNwA2MU410RbweNDlMHoxwvFbsc3XDEXgeGBCifqwlXAXEJlQFbBN8IBTVXjJwgPWdPi1QYlyBdQTtd+AItDGEVm0S5h3QChw9nEhcBMQFvBzUM/QJzEekRZxCRCOeGADWxM/Q6IQRLIX8gDQojA0tsygsjJvUM9GUBnxJeAwg0OXfqZ6dgsiAX+QcVMsFBXCHtC45PyQyYGr0YPlQqGeAHuwPvGu8n5kFTBfsDnw86STPqBLkLZQiHCTsARQ6fEwfTGGYKbYzMAS2HAbOVA1ONfwJriwYzBwcAYweDBXXhABkCowifAAEAywNTADUCqQeZABUAgT0BOQMjKwEd4QKLA48ILccBkSsB7yUEF78MEQDzM25GAsOtAoBmZp4F2VQCigJFMQFJIQQBSkNNA6tt3QDXAEcGD9tDARGnRscW3z8B22snAMMA9wABMQcBPQHJAe9pALMBWwstCZ6vsQFJ5SUAfwARZwHTAoUA2QAxAHvtAU8ASQVV9QXPAktFAQ0tFCdTXQG3AxsBLwEJAHUGx4mhxQMbBGkHzwIQFxXdAu8qB7EDItsTyULBAr3aUQAyEgo0CrUKtB9f81wvAi1uPUwACh+kPsM/SgVNO087VDtPO1Q7TztUO087VDtPO1QDk7veu94KaF9BYecMog3QRMQ6RRPXYE1gLhPELbMUvRXKJVIZORq4JwEl4FUFDwAtz2YsCCg0cRe4ADspZIM9Y4IeLApHHONTjVT0LRcArUueM6sNqBsRRDwFQ3XpYiYWCgoeAmR9AmI+V0mrVzccAqHzAmiUAmYFAp+AOBcHAmY3AmYiBGoEewN/DwN+jjkCOXMTOX46Hx8CbBkCMjI4BgJtwwJtquuGL2NBJwFjANoA3QBGAQeUDIkA+ge+AAmxAncrAnaeOwJ5Rz8CeLYZWNdFqkbTAnw7AnrEAn0FAnzsBVUFHEf8SHlfIAAnEUlUSlcRE0rIAtD9AtDISyMDiEsDh+JEwZEuAvKdXP8DA6pLykwpIctNSE2rAos7AorUvRcDGT9jAbMCjjMCjlg8k30CjtUCjlh0UbBTMQZS0FSBApP3ApMIAOUAGFUaVatVzAIsFymRgjLdeGJFNzUCl5sC765YHaQAVSEClosClniYAKVZqFoFfUkANwKWsQKWSlxAXM0CmccCmWBcxl0DFQKclzm+OpkCnBICn5cCnrSGABkLLSYLAp3tAp6OALE5YTBh6wKezwKgagGlAp6bGwKeSqFjxGQjIScCJ6sCJnoCoPcCoEgCotkCocACpisCpcoCp/sAeQKn7mh4aK3/RWoYas0CrN8CrKoCrWMCrP4CVxkCVdgCsd3TAx9KbJMCsrkJArLkE2zcbV9tRFsDJckCtlg3O26MAylBArhaArlDEQK5JnNwMnDdAr0VArvWcJIDMg0CvoRx/gMzbQK+FnMec0sCw8cCwwBzfnRHMUF03AM8owM8lgM9uwLFeALGQwLGDIUCyGVNAshAAslLAskqAmSZAt3OeHVdeKp5IUvMAxifZv4CYfAZ75Ugewdejl63DQLPZwLPaCtHT87vD5sAwqkCz28BJeYDTg5+RwEC3CMC24YC0ksDUlgDU1sA/QNViICFO8cS6VxBghiCz4LKg4kC2sMC2dqEDIRFpzgDhqEAKwNkCoZtVfUAUQLfYQLetG9zAuIr7RAB8ywjAfSXAfLOgwLr7wLpbHUC6vUC6uAA9UMBtQLuhQLrmJamlv8C7jsDhdyYdXDccZ0C8v8AZQOOEpmPAvcPA5FqA5KDAveUAvnVAvhimhiap7czmxoDnX8C/vYBFwA1nxifrwMFiQOmZgOm1QDNwQMGZqGEogEFAwxFAQsBGwdpBl21YwEAtwRnuw2HHq8JABNxNQAfAy8SSQOFewFfIx0AjOsAHQDmnwObjQizBhufwQCnBRG76R09PhZ4BWg3PkArQiFCtF9xEV+8AJbFBTIAkEwZm7k7JmAyEbrPDi8YxhiJyfYFVwVYBVcFWAVjBVgFVwVYBVcFWAVXBVgFVwVYRhUI14VnAgICCmRe6SsEyQOxBi+7uwC7BKe7AOdAKRayBUY+aT5wQj9Ctl91N1/oAFgRM6sAjP7Ma8v8pudGej0mIwQrFic2NX5t32rB8RnCLGkBa9duMBcFXwVqycHJuAjPSVsAAAAKfF59i74AMz+BAAMW0QblrSMFAIzDCwMBDQDlZR09JB9KQrFCvEE4I18nYDYnOCMJwT0KRD9DPng+gT5wPnECiUK8SUI7X8tOT2pNCixrVC9qC24fX+AzOhsJZ5sKYiMrPB0mQqtCvCvMAcv8X8kOHy4JCAkifp3fajotShfJq8msCWXBy8wKYEFfD+UQoxEAk40dRUIlG6ltOc44CjM/Qz5wQj8cBwodTEdsWywtWuG8Egp97R0rQj8cXQhKCQ4zVENCNwQ7Q5wsCoEbLUI/G/UIUyIjGDAxAAWPYfBeCnFkyWALYC0jbkNgGTkCGx5gswYCaxBlTmBNEQFk52AVYJVgfWCzYEtgkWgWFwa1DtxVqbxaC0MWqwG7K83BAh8VABwDHgF5AmwvMJVSgAGKCrhHGgDkI3SOCsoNpk3qAZsCh5xPBUBfAPf3BwA0FlcMC6UMJB+6r0eAgQw0ABUTnyuCCHoC0gtLZREbANhOBnUECh5aADEAtritAJQnCxZvqyQ4nxkBWwGGCfwD2e0PBqoGSga5AB3LValaCbthE4kLLT8OuwG7ASICR1ooKCggHh8hLBImBiEMjQBUAm5XkEmVAW4fD3FHAdN1D85RIBmpsE3qBxEFTF8A9/cHAHoGJGwKKwulODAtx69WDQsAX7wLAGNAlQh6AOpN7yIbvwAxALa4rQCUJy07Ds4CkBh7ULtYyHRyjsOlmw/ZFUkb7AEpEFwSBh/lAccJOhCTBQ8rDDYLABEAs+AiAQIApADhAJiCCrJrOS8AFABbG8YubHYqDcEQAjskHNPhHB4LG30CewTBCqrxbAAnLQ6mLs6hHAe7CQAQOg+7GkcczaF3HgE9Kl8cLs4RGQB9q9ocAuugCAHCAULz5B9lAb4Jtwz6CDwKPgAFwAs9AksNuwi8DTwKvAk8DrsFmAEbawouzqEqD4sa4QHDAREWOwCgCzsLuxC7BBiqe9wAO2sMPAACpgm8BRvQ9QUBvgH6bsoGewG7D00RErwBAQDqAQAAdBVbBhbLFPxvF7sYOxjbL7ZtvgNIqLsAB7sALrsC6w5WAAq7BAAeuwJVICp/FTwVuwG+J+QAsloBvSjgo7vIAAFbAAG7AAJbAALjAAg7AA67AgAbu6VbDr/EAPQAaPuoOwMBu5UnSwDn3Rm7CBp7CKEFCv9wAN+7p7sau6OLeXIG+6mbgwASuwYbCwG8AACGAG27BgALu6c7ARo7ugihnMoBuwvtB8CpOwDhewG/AADlABW7AAb7AAm7AGmLABq7GLuOaRX7AA5rAC5LHgAGuwAXuwghAA1KAcIAt68mAcAAALQADpsAHBsBv/7hCqEABcYLFRXbAAebAEK7AQIAabsAC3sAHbsACLsJoQAFygBunxnVAJEIIQAFygABOwAH2wAdmwghAAaaAAl7ABsrAG0bAOa7gAAIWwAUuwkhAAbKAOOLAAk7C6EOxPtfAAc7AG6cQEgARwADOwAJrQM3AAcbABl7Abv/Aab7AAobAAo7AAn7p+sGuwAJGwADCwAQOwAIPAAUOwARawAPiwAN6wANuwAZCwYWGwAVOwBumxm7ALobLgATOwMAaSsKAOFLAAI7AARSABd7BRsABtAAGLsAC/sAX7sAa/sA5IsBuwAXdgG8AAFyC6EABUoAbXYAB/sA5XsAHGseAXsoUgA5RQD+Bw0McgAoKnABpAUIXgG8XiMMCQdvS2xfKokfPBRiLTYDoQq0AdgAFgLRA24BdnJHUhQhA08CFT4BLAYDc0a8e1J6QAApADEB+wBTCtsAe5AsASsAduUNETJGAUoAVwUAAVABB4rMAHg7BCClAFoA1hUAlWg3H4sAzWuxAM/UFgjCdXMbGFYdCdEBiJCrIlNTTUgSPMKJ+QB/HDdAKSvgEZdPAHIBKSwwKUIZDwMwVQT3xe4AS2XcAGoCcQI/EXo6x3guNdUGBQAQGx0KCAwqBB8dKU5TTgi5ugAKEs0AJgABGgCGAIkAjjUA7gC0AOAAnTwAuwCrAKYAoQDyAJ8A0wCcAOsBDAEHAMAAeQBaAMsAzQEHANcA6wCIAKIBNQDjANgA1QMBByoz1NTU1LbA3M3QzkMyFwFNAVcvRwFVAWQBYwFWAUdLQ0VoDQFOFQcIAzI2DAcAIg0kJiksODo6PT09Pj8OQB5RUVFRU1NSUylUVVdWVhxdYWFgYmEjZmhwb3JycnJycnR0dHR0dHR0dHR0dnZ3dnVbAEDsAEUAlgB0AC4AYvIAigBTAFMAMwJz6QCH//LyAGAAj+wAmwBLAF4AYPn5qgCBAIEAZQBSAK0AHgCyAH8CPAI/APgA4wD6APoA5AD7AOUA5QDkAOIAKQJ3AU0BPAE6AVABOgE6AToBNQE0ATQBNAEYAVQPACsIAABNFwoWAxUWDgCKAJIAogBLAGQYAi0AcABpAJEDEgMkKgMeQT5HKQCLAksAwwJTAqAAugKSApICkgKSApICkgKHApICkgKSApICkgKSApECkQKUApwCkwKSApICkAKQApACkAKOApECcQHQApMCmwKSApICkRZ5CwD6BQOnAl0CNhcBUBA1At4RCisTAUo3E02RAXekPAFlWQD/Az1HAQAAkykeGI9qAClgAGkALgCJA5TMi/CuhFoFuisOwhEBndV0KgsEIzFsATNabAGyAN5+gH9+gH6BgoJ+g4aEfoWIhoCHgoiCiX6Kfot+jIqNfo5+j4KQfpF+kn6TfpSDlYiWgpd+2gLabOEC2GwAgmwkbKAAg2xsBEkERgRIBEsESQRPBEwERwRNBE8ETgRKBEwETwCWZmwAowOIbAC0ZgEFbADJUWxsAM9sAgxsAPZabAD2ARkA9gD0APQA9QD0A31ebNSEI2XAAPYA9AD0APUA9BxsbACJWmwA9gCJARkA9gCJAL4A6AAIAPYAiQN9XmzUhCNlwBxsAPdabAEZAPYA9gD0APQA9QD0APcA9AD0APUA9AN9XmzUhCNlwBxsbACJWmwBGQD2AIkA9gCJAu0A9gCJAL4CNwD3AIkDfV5s1IQjZcAcbAJDATZsAkoBOWwCS8FsbAJXbGwDnwLtA58DnwOgA6ADoAOg1IQjZcAGA31ebBxsbACJWmwBGQOfAIkDnwCJAu0DnwCJAL4CNwOfAInUhCNlwAYDfV5sHGwEPmwAiQQ/AIkGjTFtIDFs1m4DKGwDrAJsbABVWv4VMgJsbACJAmwAVAEAul5sAmxebGwAiV5sAmxebD3YAEls1gJsbEbCxxP/x5BApA0KYFA89AsjTx97EHmJQPyocItC2JnNFRCEnFU6SFTDoI0PxeRNRoNRWkpzVnWW8pTagkNmgf+jGupqZ3eu50LAFnc+OzfJwdub1AdpOy76VnijWNR/CMEevikQkFyQuLuPajxWi9chqOoMJ7qpCN4sx3LJG4Myu8kD68wC6+iAwt+pU1JEeY13rpCVkXSZfinVKn4xZpxsI3Lp8bJLrJ9ujkrIalMRBAcv/GSKEtowzcEn5XmJw2BagB8V2UWJoJHZ14SXhM7p0XeGFOuw6mlvyq99WYp5XxrO6ru9nn4RHcOkJ7hx5UqWtman7yVMLzYXQefQRUdIY70RYQE8+aAzCNSGQkXiHfnHYRMi+xczKDdZLk3AV1gzxkkSHLjBwuq8shIJ+/RAbqjqQbugFhe0rqklu432EERkM5k9y1DXzds46oLqKAx6OhPT2WiqEfhaITn7OF9Y694AmKmUvbpWp0xJqDaf3jeNJXnK6NpnGcFOmbclbARC+5+5U52ufw5b0Hh+2LrrNimvZe4eYmApRsZnJE310SqB+1xB6rSJfnV1f2D0awB18Oc0sXAFqIlgHgWiaZGdvP5CJUSsCTCQUC335+iSkwPlLJJ5lwjTSn9Lw22NbK1Tu8w+bUpHtDRDPho7Gun8aw2Jzu9i+N0Ot/kPMbLAb/rUQ82kfpk85qLDkfxLl39QPDngo72GYh/Xigbpcm1pA23D2ywt3D8GgMOao040wDqkHxOEx0OhC+ZmHiIdjK7yRbfJD2ouZbAedhD3p7s8WDmCJfNforgDYPGAXSI08fTjPZ5B37lc5VXGzc1vJmibDwBNVzXuaUzg7N5H4BxqjhJ+kz9HLUJys7bpBDYAPvbut13AwJCWd059tS8YTYgC8HwrkewBfa1LSSpmMr9uR2EekTiAMH+Mx4AGzgbquccwBDlLmRhgXL/YiLPCEb6d2k5qJ6o800qddABkpqt7NG+sc2uvHZwZs57W1AHTFM1KkMShasADAh2FvzbzJOzVDMS3ZlT2BSFKdnkZFB6JyqJbhm6XANis9TrtzJdlPVp+rl8v3nIke6Jou7m2TKu53Vounupgkz2LzrQPhhatLIG7rfF/gUKWp15X3LKt+ZvuCDSqPUigF9yJntimC1HJR7Yj/dUrLAXWrT+1tnwPJJLGKAlQ5VeNDWRKCTt2vz3rJuo4+gIt75/Mkfl/gSZblZ9r/SEeeosZXneli/xNh1WVCvkRt2RnyyjtMkMqhzXh1PVOCbILqv0r7rGYm0CHIyKdhHL90cl9E1I6eEtQTCt6RXj8M0HHrHCHLVRpNM6WIbT5BCMGVnL0o5895qSRbCJz+5I8PGMhAN/Xrj4BgIdlKqlHtBHqTJwmK169toZ2IWxNzrAbIG7zh85Q/LG2A4yBcaBel52zdunokB0lv3A7kXnTI7M6ZnfZ7nwuj5lkGhqSpW+w5CI/FmRlplBEbnZy1ZxS3DL8rf1YWhO5XivWZBSRh1gFsjjyj3qRG1cm/6ors7WsEif6WRxns1MKDZa6KrbfMQ/swIb+2nb0tqxHeii6FcgVeAjE/Xwac1owx04dJKG8R5YQgHNnEfHf0qb8WOnU0eQSjazq+IK7cSuCqYzPEUB/x+QgGZqM3dBoYvNvZVOHDkbgdilWdagqO5bkybXfLpyMPuGq8mvAAEZGbR6RwXGlW9ErOWTfnjfx6dXFJqBj0OBSGFz4lWQasNOmVJeN4SFWSLfOGB/7ehV5YuoNNROHZEG9ElVuMnqbDMMuDleOt/cN/gsWxGw128mwU8/HxkOKqdTZnI7dHka67WCTf/FmBrxpNCaKJ1GxBTCSS7MNfhNj8S4Gtotg6Z3AM9cAeVROnppUMaiV5jjudLnNqoVrKO1/FijLlAc74kxydxKX1RQuMqHR63eecYr5o6MJ+B78VsLlCrpelWh6GOrCOBIoQmIcdpJL1pwE2zzZqBkecGTdK8KMOB6r1eNRURyrz6M899TZaoS/vNOxHf+5gORU+OyYIcIW6diP25GHF6u8TNjuL/GJzCnLLXd01KrsjRa51v4+O/VIAWXESJxfxWjv628J+cWUQpoD+Yytzs3jSMRJ23/XT+vUdtUMLDQq1vnIoeg/GjWh88MT6k9dRqDaQ+vodilFgvjuNw5pJpId9mfwyYeLCGb3BmHXdfQfhfPRQaupe/f8TG4Bk3eDKlYBaEK3kZYNN2Sdxz47m/vYBxvIOKtnqplB1pebzuXmAr/MuzQCknKe653dzaWQQ7MUhWYWvzIZwLe1v0rXxImLaz+AkAu+sYikhouNF3EW6w4crZ6MuUiDbIAx8XhAfegcvW6x9BPb3/sCxGWu9YyatqExB+TSm69qIkI9IwhjrcnzME+jWBx4mNQm5WwLzUjSyY4FZ0aMF5YFlXUD4hL4XfOeYv5rDe2s2D/Cn+28fZ9UCnOQvXFMnQqfc0G+ZqOWWD9l/liqUPaNQzZjxCHpUAD8Rcc90MniQ02ugHWsUupFUvhC9usY7zNPt5F2jO7qgzhafsQSd50jgLrC6Qx6bpHbXR3WNAu1BzGmwbz+ebGmwTjdy006Y6zipP7n/OJlvSmbq+SY+nefAVKK6EBMPbce5n3IdRI8+vbxCpN53rw3TvgNds1SuMiuLGxt89L71mxPDeanGhyHvOjmO56tnVpoHalQnL6TqNuqKsHjHCIKB4pCgj4WyYPvRvYvqi5EMr7lN3MotPR/KH7JUD1lZbU0QzfbrEBJnuQiVAyAC9vwXWp2TRU1/0aapyAH2cbglEHVAdl+1rb1u147uV0td1eNoQZsqHrIMIYVPXtLk2TIU3cJE08PjoYNDpfF/IcJnYQHl6nsplczX3Rgah4NbJJHl//5scUufqsSd//kbIS406ZWoMP//+jhGUswX/5nVNz/jAj9KmXPtAmMiK+khhbn1w/mELzZMT/WxcW//y/jsHaOM/61oAW/CjYhJtY622/TtMYuP7bilBvbiT3vB9n8IcFPnwM78H0KfhYDRdY5PhWJ4jWRQzB+HT5NVZV56LG82hcQms+jOTT/c9Y9sx5rPi1/wB7f/+c5UfUCKk3iwwCuywUc2MGnAwsXf1E5hoI55x1Q/Qby+sWH8NRjavZ8VaDsdi1NUVhH86BJHX1yaFt1w1OYeL5LVmdN+5Q+KuTvXEPDzUCg6xp0HhsUhTWSe7MZMM/6rsTUb0/nbUE3YQlGGt48kT1/6cnf6yHnvHtQx9EosOXN077yyEq/jE3YTiG/5SEJmXFeocJJ1EAd6vKeK6VEdJLOZ1km/EwOnZWCQpzCLKPHxrfh4yJhGq//2dos2E/3+MOcdW5EsgIdmTQUQetzRy5fQHhDBl37XbWzsqO/cASEDjyst1/8NEROqVAxWnddQV+umJ8IrKVgKvGaTc0GsQ4s8h0Osql5QKwlddPDjJhKInyWqYUKmmlIts+FIcXZ6yM6cljbsjUG2ksSOkuIw4sYHffRNgBOLApvD6XrR6Rt0rV2Uf8IpnIUVnb9Twt91QjAaD/dStSWDxg7aYY+VXIgnuowYdOkjywa2hlgrnI6PjaU3e3UjQ5Yk5mdIJGyHnv3/P+1EkMav1yFyF+FeJE/RXnWBw+Nh0aOo6TGlKX7d+dkP9+brvr79SdtXJtcD/aXBGiMNfG6/NQniQHYQlK78FEHDqOh+bDI0o+2Ub0h53EL/vlzjrBczVEZz2bOtvIL+DIzDkk9nCWt7tlqsq3l9JMtJk3r5HG2iJ9b/X11TG6wwMAjHLQ2oasaMEsydh88QPvI+hmqIHhvalpKoKOueJR0eZ9J8G2alNOIOy98jwvbc87Ewk9d+5G/tUijTmlbjFlDKXV05HalKxaRTrucc73On7yzAPS6f2v4ogiaWyWeV73dv/MsQT5HjRrsYV9dLAcI3T+zC2qEVINyNpEhoKV+xVSuWtT4AhBfpnZ7unIM+HX3msI0HiI+P+z2PFgkjGi5PqEbG/wNIWeRUjPtDEgbbubN+I4JaDLrW9borRBDob7ZFx+JdKeFVUKVeWqb/c88Ol7DhM0suLtuEd8tkDSMTD3DFx8UphPINHMHi51hAPttXL4Ektt/lKEUG/R4qZKohHjVpAcPIMiHyWr6xR8/EWnNJvBFET76yCdk5er7ADB/1bgoImhpSiZ/omZjPKPCEeZsOwvPmXL+1vlJNeGO3TzySmGA1X6e58gLrazDM71jywM1XL8zKHN6G3kB31Y8vLtP982N975SZXk2JwDvmv7AY/aDsFFk1v+nE7/hbvuOWhBH4kuemeYozPk2K22Vx/YGiDTLU7YilpOt29u3RZMBh4UJjlTP5ItxTzWv6ebL9b+GSU1Vsm2S8LMfVfJczaBSqE8J1A4YUjpsALL7++bwCPXFhaufdpDFtBlHb9makeYbqdg9ltvK/HwF/rNE6KrtWUkEcxmTB7Iyu5TiVaIgW/YxzQhpArliIMkOoK5L7ShVtF+DYqV01mk7fwop04hQRwg4KFmr5z9nYf05VVqkSe7gfnx5bxxlQ0qEV0jiwzf064qG11iEqjHcUgDWWsDs/LEGlzX31T5KVL+7D4EoKim7HBagiqRo5JI3WfDBgpKIruWz9j/J6Hp5Q/EJbMWB8NeSMuFarNw3AEYPBJtYQO/4oD/ZgPTSQ06di0EeumX5EbrdThO+fvYEVSxLtZ3AJkee0Xn0sDwNtiiZhJjJRDuG1YRKB1vOulfd9JjHeyu+UHTmrtra/pm+8Rixh4WKiLaLOCxIbZNoWRZSyyUGLPjAaAo+SQBpfO2uruWrzFxLlpvrXJNMCWtlJDKGAnlWK5xpU2tcxXbeD+sbdfwYXt/qTwDk6UqXR/aUt099DhSNl4Nk8mXwpw+b0nvjKOG6Mg1PRXjrMUMANvNgEArv8nMJs3vj1aHi8MHz/UfJWWzkcrSpZTNBhduXlGR7i+ip/THDp5R9KRNcDKECgtwgXg4EFN5HHfikP/XvsoCkHTg+NbsD8Gl6eknk4Arwn/BWGJ0hgW0/gUKrzuGZhub7igRP3abetpIm+24xEOlWl3YKpm2qTBFvX8ddDRvm1LcwnCJuEfZx12qPY9TrntMIQsv316zvpyWnyStX8VU4j6tQk+CWlLBUCJR6MdH9Cp7g2qdn2WM9qFbREmejH09dlWEPm8hPF0L7RxwRRdiCs0DP8ewk6ApoELkKU9hckSdbnXm8UHJmaNXjxv/q0fTTpu8rnl9lN0vQCpDRbCtcz12rGRFEA7Cfg7FhZn5QFkNmv1ZURKEsiZce1nS9K7HrwpC7yJV4Xt3eAVbLJfoXHrtwG60Z8gwaSnmxoL3s2ZlRqggZN/MHo1oUS4L+GwObFI596Ld4Mvi8l+cQmF1gJpkpnDio7TuO35npaMHiWzFqPSX3qNgkIPGuX0qGYnPIVsM901Yu8oZnOZOY1TbtIdFUNKNq2dP8SJ4F/VCEzIjF0/Rh+7UrZj80tC6rognVH3mqa8eCs/lcQU1Pjj98kBmAKDbZUTwosv02UunRR3n0X6c+f73mtwB7/WbQ16gO431EtwZbNG1SM4TZPBnsQSESlsfG2JLQXx5xWf4bmQ/xcVCPISAX5897JxHKLD/Xkgu57+ABR2+MMtEbX64+MNlBHpKC7sjlWVEShf5qA+dGc59LFVlZrX/Enq9z/v+wnZ1HErmxmjJjxOA+hAjVUWgtq6ygAi/8ewJDjUMFw3zhQFtbyTLDPFd21Ji5S5QPZo9nMSxdg1+DGFSN0wlWt7XeYPbHqLfliV0J1kOhQNp0VbUPy0MS2Ms66OxtSWvaULaWHnfAA+sieVVgtjDwN3nKonWapkSKRN8BKKJQpCfqo8RQI5udhfu5s5+7vwsppmAJDgz2GNA7d43VdbV2l/SrvEu4RYslmNJmfSOVbssxAhSYy6WxpIQdDB0FVBpZ6IM8yr81QN+XLZ3n/wed/R+s6LslkxKbzzst/GkRbe6rFmtvJCwr1T44ETM+IMgOnjUO0eG6a1n2w7lwM1oFBvzMUWRkNFOvKcx3oSb5XdenZ5dXsute6nkRypBiSdAtA2fxAd8UdLOZW/MB7fZoEuFheQXijdaF8kuaRZoSeWdKOkKsGYEGaXfaDKTu0WMTcLniQs7KRCz9iK3SP+Y2xIjkfVGqFLSQ6vh+A1u6FdfwXsv1VPMfi2cxmdM+/xTgMXEyo2ZGcQ2YmPsghnYdv2+z48JpGZA4tUK1p1q2VdVxyfypXEXcrxKKtmt8UdW7sHWmKMqDuBBM3J/JUQx8eUYN4pJ5oRqvdiPHU1o/WPjiKvnlCqOdyxlxF54L9PrtLD1NejZ9aZDivVr6ZfMFK1/psVygoPIAnphcJWWb9+5IKMKmgRQULsTPZi6Bw4wP32zVEoKcHpP73CkFAqS98nSaGoWDjDJiaACJn4p5o1jq9R4Q4VcibhXF//LHP0bdf63kRVZdRbbhGe7sDQcyWS5tpkfeYHnff25WK+4FpzLlAcbaKmHdIBqOw3fImx1uqQIADH0TyHzFlqTG6nMoY81svP0T6BIyELMS8tMe+E1p6TFP6sVpZa6VNaTumufD5aj9goRa9SAmdJT4HhI2r0egj8UrgFb8L59wGLnYlzkLAiUd3m/WWIIEU61kPoEjd3gIVy/fiBcgqQqHnoXpL0SqLGdGGgn7DQeVMSYWHfjno1FngIKP9cjYaTlcRP6bZunjHP13/lbVm4awti894pTf/ZNNqr4OR+tDVie/m+rC8QpVnRbsCMPukOH87B2jM4AG6pHuXl1x9SiKdhYJVOhfo/+SCaGjUW2CoogL1FFhFGN9o+acoVLl0SXs/3vrSccmZeAF3NewFuOg/P12QYKQF+SH+KYcNnsAhIAELPBUgre/KRUJEA+KPD0MHRjv+3J/j2Z23MuJmkfy7leWcMsti8wXLSHgXFJTaksx1Woi6oljwxFVIJG12SBSZLNJDbXMYPekmiXT4FclKI35BFgqnYpKfcsr+f8HUXQoHJ9UYZ4J5YMiHHyAxg6eidhodgqJ2Htf/xYEx+G0zXchuzlt8hcAl+AT8NCQ4orFc4DerabF1enA7NTLnvtZh3FUwqIOvY7Q4DYmoDHwXTSw5UNNh6r7j0B/ezMYJMDcw4+6gCTZX4YQ+7Xs8de72vsR3cmfpxIX64/6KR1p3VX4F6vfHEzxzarh8aDH4G1DFoBBM6npXFpK+Rh+WrcFclAeAxi0PoaR9CpOxxGLSdvxKVSw8oOOanG/soKImRopN38AdcUhhM2GT/PgQeSQrG12njuJJD5Z7vWfAZmFybYLdSA91kB4aoBhoj1Z//KNIVVujqaLLRwCkbyn4vh0739C9V9iSjybeOIeSOvNs7LW1a7EUtNoKAnOGML4U8KBXpfrw73WjAszJG4Qscq+Xr3kZWR4Omm0xT6qE9y6FNSpstV4onMZSqCEJ+3VX9qjvdx5QVrM0WXxmPZxejdfnihcFAjzv5PjlTl6ickDbHe6+Lch52pjOPqk+m3RZ+bh2JSMGtFBuODbMchrpRVlt16NTQ05Ps0IDtWlUmWfP2vX8M4YDynIuOZ4Ck91+591B98Gw9fw+yQogTR8CSg0zaJu+rlBo/mr3A+1NziF+kdubz+whc857AZt6DwIBIF5+5yiaaf3ByQp1Fm3sOkZDAzwsYSQTM/Kv6idkugF63FDobDdUY3huruU+sCaBuRR+HmOowvmZoBjZHNh77SXFtmY/oOUE7ifN7nBHAo83S/xvcS6H4Ci2u/9Id62Wv6Ui+zMNLAzhfkTkVcW2BwrnYvpur0ZDlzs+ZLsmGTWvd1892t78gx1YjEJusGcxphjLkV0UfAKlekfSBVWHE2ahk4AbbRmHyL7GYdtKfdlINwrcdJuf3Cee1nfUojDQn/YmItESOFhtLzrkEv4k2XpMU9oaJQ3VUC+1INh6BE68pkHameGJm4Gvdb24Q0fXWxd9Tp3A9mzFSe4qXDGGDIV4AAGV1jIDfveknH1TwWpUT6HiQxKP3AAHJNkJeRlj/mXBmS4S1j8FK6YmpK7jyyAiRbsMCCLoJcx01fvgpMvKQRxu9IOwymconQjD56g7ksOrcOeoTbius4JnGesAS1DtgdaophYsw1wGIsMS3P7K6doE3K5czznqPQLSRRF/Ylzb5NtSKsL33SgskFNCF4khn5LWaDxI23ZRi2hzqN8uW8UzZEBYy68+VtGLSymQrXGUlr2nO2BbBIT5Vh1RmGAyDXaW0FPrpx3wv2UYdFk9tSl+906bMxCuXQaKDQP/U19UEcVGK4gmksL8lAorxQSAOwpeYX9xrZsh6yoGaL/X5O3tgQC8OM+/GvxnW9XvAtu/JxAigydfSmZfqZfg1XOcHNOpLlN8j64OZ36l5qawDBJ62YaTvxeNmm5gowCdBosgcpHOgNgwA+sknN8XmsR2IYChcafl9bGNMZ/nB5guWuvEziv6QI2bP2DtyKWG/qUjZMaxy+wASkkVGtuwGtywkTYG6MYrZBo18vYcww48G/+f+eITA/qMwbLlJC0S3+/ai2pPvkOhRRVmGTuSupaxhIk0xoXLtixCxSAn4Z3OnUS3wBqVscLI4P3GP7i/6gxYsswsVmkvDXFLhO/OKcur8flegCSKiqmVpIRvCzgbjEA0mXPn+RExXY/2OE1f/BYuWpRQY8gCDpMOYBx9Gn4tL3hihSIR1ixh2PIIT7cr2gUJbfs76EKYG52Jk0UZF/PQkBxGuFCEWXnG6ue/hTIqjTRq1sotVrKrwIGHDrITyuanUzbIYdgdEeV88K1VD82TYB2B61Ft+tB1KqHPmT9+hWoaV+iF3SuvtJqvnoLaA8wxrD56AUMULEgzO9SvBcBAfqz/dzMYzwMt/YLszDbmGe1bcHHfFMcvGql9bf/tp+Hrj4q18aNnftGjmXTfws39emn7/5IBxog9MrmftAA5Oq4awenm8HimWO72dwVlHcHmutVMdrMHw+p2vzpzT+B0iIZ+IEpplwWhClcXlxhxAsF3CHRnnaUEqq3ByQ+cqhe5SvR4SFxh/LZoQwtj8QZQGT1BzY2EMpYnUcZWQEPlwFZw+7UryK9qV8KgruYsvyMoK16KI2sN4SOblrVwhyiL8+IBZ8cpUhsJQSU7TFHAi+L2F0sn0y+FtDODlnuif2Mba8QddPZYYxjTsIgkMe3M6+7kXxUfZvbCUlyq71J1eNczGk6Vqw6rSx2K3vM+DjLxDRGzWepTO2qTT/W8S7u0QXcyFUahcB4vq8xCYTpy8iswtnyz7Kx6lgTEQJ9RqkgEIN6DOUqB0uRdeYuDa7AP7Zy9z+ZlTsmVR5vtV71m3dmdtNeWghbr5PnPJtjXAzcvZjxyV96VEx/B1TA0IEQSI50ywGuIbmAYdQg/l/rxhQLX+6uOLyFsaUt6mtjpAJkLfehnB6MlOHnNOrWLvCBqVBS07jcM+4RzLEed3f3/0Xwp92U+nataNHyEgnnuYR6PXEjRLETz0xrt3UglfK7Bn4aNlXG7cZco4lMziLv5+Mh2JCww3mz69Z9ZMRR/xv5EKJ38IFxKd9dw5CgPIXja/gzAshMbF14/qBIgNkdUQeP8YE7SrICGtiTnAKTyA9cXa3OauDHxZOdTP7yuYBzD1UcHstIO16FxF1bRUAlSkszI83YufTchU8OPnnozDl9bS0y6CnnjGwgj9M61cXcZsljjhLeT/Vq+30ScN2PcT/dOoxUDqDS38+OpCCzLDdnwHQc3ECQVIkaxmdPaZTSdfp2jjGzSdNLM5yPQsgJDl+ZnhclDQi8ltUnkqWJ323IvTZPN8rn0+EshL1cx9PiaLTzUsryn9Zp2Nt/detUAh4N/2I3dlMQqjHFxSihv0uykzflq5clMy2ZBaxoEb0/QMp03IQQus3vnZd/NOmSsmgqXqKFP3ozyDgY7RQS+npabe/hNG+5sa5FtvL8v0uYuag2NewYkcol3TOTadpuncCnDgOGpmLnTQ1PEPUN2cNsrW8LYfIv+hzfb7vod+ipXHzmbgj5Fzc6RcT/5PD7VQ8nTJBNj1urkVUx9uJvTWmqY08OC80rGDLaWXv243VB16gjt4Xtwp5H2UDR0LiKW24Ed/sOO8jl1yEU/XAb3h7ScKnCFy/V3sICrkY1D0K9fSokHIL0s5/7DLShLAPXRbV7fbv4qj6OwHC9d5PlEOX3LRpQ3P7hcSAKlIKPDM83ypz56U5+rJeo0cyUtC7wltL8wqEiNSgZsDWzACc7RFoZqhlD0+sihIBQlkQTXmvUyIOZhkQX2zqME5VRC7ms1sa3CY+odMn3mMBiTvCMKnnCxg5ZPLq4GUDB4jF8Br2K4x4sxfWjGXQatJ25I1JyrIv2Z4bP1jKw5C+B2/s0v4dGUOsaS6IPIQV3ETQ+F2fSl2BPBXHzyYN8VmwWIrKeMX9pyGWuAOVXwkxJsRBaBVzLhZDP8ONGncknL5DpTxHN32GgFWMwsc0GmL0oRDmRT8u2lvjAKUIi0MmXhIHSlFeh3Qh5pP6ap4YUd6b569ZIaHgya2AyD12cPxY0In/PBjzDctTaKJCU+xc6m9RkNLDEE8guvxtJP8sl8N9bLqw0F/qejaBlcHYqw31zYpsutQp07hsP1vhGdl4hJ1wA7OCsAHnKj9879uSHILEmuZ6vI1lT4tvnWCVKZhhYrWHW9oPKPKpbOC6FTjf/OtUvwmiXr2ykvyLzHGQeyS7BenZpL3N/CaF5T7Gkml7JXN5cj0PKaDpZVImD61FuMgFHPqSHvt4Ej4KBdAfdcoO3AjQPLwwtKsgGM+ty4lNZMBEItJSRLunG5ckrM/BeoXWoPZVvEoIzLgFQYPupMwZCXis4W2SCJ2zsefZqCj+aTfSq1FYdUj2UeJALvVTf7vuuikOE1Hit3UIAGUi/sqgMum9vw218y1FlY/9XnOji9nqhGAcMYICc7BiqLZj5N+cKEuSAuiyWbMg81ZD1lHovy/we2eaCcCv4MzEW3O0mVA/t2xdA0cxTVbXmFhn+tARDpvDz5ftLr15OAAmvo2QiAky+feVO4bGibv2nlBmBzqx0lEDfEm4UnEs11pbnwZlJ/0Y73/wBPYfTNZiJKR73TzdCW1BffiJq9bLjQmaKnU0+gN8sfe25IKSUCooQwxePDrFn3a/zUgWxvPoTYVXfobY/GV2qqTkeVDV9D8657fhY0/wiaJ5NfLxhXbE/naxs34N0hd6vxNfdm1TCnozm/NKSCThchoYgMF7Z2tzXFovRfsNVkf86JjrM60r7UIuV3bsmfrMOqzjXjN6HPBG25zCJ3QLueySbj9oFvX/HxWBqh31PBPxduCVAxMqC9HK+YL3oBZqBruoh6LKvdMqoz0PYXUBrwbiioyE8Tj5ImjJmiOOWLbAZvIZ/l9rIPljx3T5glJ2ewlfuIT5GlodQsAf/IEtmYkML5SRQGxxwW+rlZkD8belJNu09Itwx9xDULTnemVDeojdbgcd2gKGM9aO00Jivtbs7ZyOSE8IPh98GfvatD8Ud5uHcZfAfMiPSlIxd4UqeSDzuNfbKDuFepkyC/s3j9fawmhY1b9NqDi0ZS5eP35l7rL2eK5QlWLlyCmxx8AFaFiTuD2pMUxZV5mBSJuJduOaq2ZrWpu28DE8jl/hisBz7bGWH6qLF0ayWNq1Sejtcs8KQrQqJk5P9QHDYHOIolgNsMDmEaWcTelghbfFCDqWrq6YLwDWy+m68ec5nShgq2fduUBpQUuKKKgnttaUX9PRfMmxqJyU7e0RLr1bev+ge1KK0bZyhHKKDE8gQX9Vf7rNHWOxBtZcxwwGusyMpH77qWZxXsQmbgIGhtiO+gSSRCyu/ek+OFsz1HMiQH0IHV7PjJi3dszYfFp8ue9h4+AfKte4MTiehPvxNcm/T1t9vsFZx8rHN5ie77r2jzZOq/Em4Q+H9sNcZakf9HnzCc1fJixppxP8FQABmVnqa6GbJhwaka7WH7Wdoz1WxOjSNV8N9sgW5S3Ppgkut+TTCkjA+AodUOk1KIR+8G8S3WrSZG4nyqfJ6FEjXl6a/LEoRMHZUqfPRWvwqrtXYy9IUsmUGzkqi76ib4NANCe5DnyOxnFRZ9d8FdBVBjra3iNuZhJuWW5Omi/hBigqDsg0mu2AhfJDXdwyMIJ33HHHPfS2JtjegRejX11m41TbNL+Qp7mR0g9CPKTj9PIjuSycGN/YPozXI4zarXuAeLv5CHKtKcJKRbd6R2oLNiEt0T8+QIVJH7zt9ncKMgd49vV2P1AyScZ9Qzbu3m3LBnuu6dw7aE0b6r4kzVkI/GUS88mA53L/rLtntkFlZXGtIoqNP2mD3eVv08AVVPT3wJn81zpbJV9SuqZ6Pd1ge0Zz2RFHeCdV5CLPftH9V5o9+VzFu4R0QeumqDwUhXn3IyYotdJnxr1l3BqWnQVAeDBEOtPyJQx1q5+mODiClXtYeBLTWtsJ42AMBcf/IFIhpfhYO08hsg0Ik+DpQFNOKReK3o3cudkxWX0soPtI5eSFOA6yNylS+IQjrQtYQ/5s4UcixJfokumBUjpH9ofSjUTwPCapGFndfqqG5IHeMMvfg+88SXm7bNyjk6pGKzL+WxDAdqKtQ72WWVbOk3I+ueGuammmB2pvFZvqIcU/lvW3n9+r2lycnQLE4OX9R1jIgW4cDjJ3v8dAa66mVcfC7ptCr5io6mCaA9qI9T9FFWqo1ZAaMxgxAu8aXqmaOYryMND2sTUfoHvxcYK7hEiJhCLYFDx3PBhE97c2a0ub1/ePJcyJOqr7UaTAPTJ+xvZtjb/40sloY1ltRnTkWILmIP2b7S3AdXCR+YiArMUHwdncpjpyDGfzqGOUoAuaamWzAMacQtb34/M32FEgR5lUEf8fRzFrZUhzQj0fR7/6gdzdnVVvcSneLmtqJ930VCCDORY8CVdQWdo/S3PNkX3pQsPVKWIYGAMrFZoq8bQ/OJBDSXP7KSBdL3QN0Zqd393p6VFc7DnlnFiN00SY5Nux7yadeIM0Upl2rVsu8/VAI";const bO=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),wO=4;function bae(t){let e=0;function n(){return t[e++]<<8|t[e++]}let s=n(),l=1,u=[0,1];for(let ne=1;ne<s;ne++)u.push(l+=n());let p=n(),r=e;e+=p;let v=0,w=0;function E(){return v==0&&(w=w<<8|t[e++],v=8),w>>--v&1}const T=31,k=2**T,R=k>>>1,D=R>>1,O=k-1;let F=0;for(let ne=0;ne<T;ne++)F=F<<1|E();let U=[],X=0,W=k;for(;;){let ne=Math.floor(((F-X+1)*l-1)/W),te=0,re=s;for(;re-te>1;){let ce=te+re>>>1;ne<u[ce]?re=ce:te=ce}if(te==0)break;U.push(te);let xe=X+Math.floor(W*u[te]/l),ae=X+Math.floor(W*u[te+1]/l)-1;for(;((xe^ae)&R)==0;)F=F<<1&O|E(),xe=xe<<1&O,ae=ae<<1&O|1;for(;xe&~ae&D;)F=F&R|F<<1&O>>>1|E(),xe=xe<<1^R,ae=(ae^R)<<1|R|1;X=xe,W=1+ae-xe}let K=s-4;return U.map(ne=>{switch(ne-K){case 3:return K+65792+(t[r++]<<16|t[r++]<<8|t[r++]);case 2:return K+256+(t[r++]<<8|t[r++]);case 1:return K+t[r++];default:return ne-1}})}function wae(t){let e=0;return()=>t[e++]}function dV(t){return wae(bae(Sae(t)))}function Sae(t){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((l,u)=>e[l.charCodeAt(0)]=u);let n=t.length,s=new Uint8Array(6*n>>3);for(let l=0,u=0,p=0,r=0;l<n;l++)r=r<<6|e[t.charCodeAt(l)],p+=6,p>=8&&(s[u++]=r>>(p-=8));return s}function Tae(t){return t&1?~t>>1:t>>1}function Eae(t,e){let n=Array(t);for(let s=0,l=0;s<t;s++)n[s]=l+=Tae(e());return n}function Sw(t,e=0){let n=[];for(;;){let s=t(),l=t();if(!l)break;e+=s;for(let u=0;u<l;u++)n.push(e+u);e+=l+1}return n}function hV(t){return Tw(()=>{let e=Sw(t);if(e.length)return e})}function fV(t){let e=[];for(;;){let n=t();if(n==0)break;e.push(Aae(n,t))}for(;;){let n=t()-1;if(n<0)break;e.push(Cae(n,t))}return e.flat()}function Tw(t){let e=[];for(;;){let n=t(e.length);if(!n)break;e.push(n)}return e}function pV(t,e,n){let s=Array(t).fill().map(()=>[]);for(let l=0;l<e;l++)Eae(t,n).forEach((u,p)=>s[p].push(u));return s}function Aae(t,e){let n=1+e(),s=e(),l=Tw(e);return pV(l.length,1+t,e).flatMap((p,r)=>{let[v,...w]=p;return Array(l[r]).fill().map((E,T)=>{let k=T*s;return[v+T*n,w.map(R=>R+k)]})})}function Cae(t,e){let n=1+e();return pV(n,1+t,e).map(l=>[l[0],l.slice(1)])}function Mae(t){let e=[],n=Sw(t);return l(s([]),[]),e;function s(u){let p=t(),r=Tw(()=>{let v=Sw(t).map(w=>n[w]);if(v.length)return s(v)});return{S:p,B:r,Q:u}}function l({S:u,B:p},r,v){if(!(u&4&&v===r[r.length-1])){u&2&&(v=r[r.length-1]),u&1&&e.push(r);for(let w of p)for(let E of w.Q)l(w,[...r,E],v)}}}function kae(t){return t.toString(16).toUpperCase().padStart(2,"0")}function mV(t){return`{${kae(t)}}`}function Iae(t){let e=[];for(let n=0,s=t.length;n<s;){let l=t.codePointAt(n);n+=l<65536?1:2,e.push(l)}return e}function Kv(t){let n=t.length;if(n<4096)return String.fromCodePoint(...t);let s=[];for(let l=0;l<n;)s.push(String.fromCodePoint(...t.slice(l,l+=4096)));return s.join("")}function Pae(t,e){let n=t.length,s=n-e.length;for(let l=0;s==0&&l<n;l++)s=t[l]-e[l];return s}var Rae="AEUDWAHSCGYATwDVADIAdgAiADQAFAAtABQAIQAPACcADQASAAsAGQAJABIACQARAAUACwAFAAwABQAQAAMABwAEAAoABQAJAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACwANAA0AAwAKAAkABAAdAAYAZwDTAecDNACxCmIB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgPi89uj00MsvBXxEPAGPCDwBnQKoEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJEMAJpIBpob5AERSMAKNoAXqaQLRBMCzEiC+AZ4EWRJJFbEu7QDQLARtEbgECxDwAb/RyAk1AV4nD2cEQQKTAzsAGpobPgAahAGPCrysdy0OAKwAfFIcBAQFUmoA/PtZADkBIadVj2UMUgx5Il4ANQC9vLIBDAHUGVsQ8wCzfQIbGVcCHBZHAZ8CBAgXOhG7AqMZ4M7+1M0UAPDNAWsC+mcJDe8AAQA99zkEXLICyQozAo6lAobcP5JvjQLFzwKD9gU/OD8FEQCtEQL6bW+nAKUEvzjDHsuRyUvOFHcacUz5AqIFRSE2kzsBEQCuaQL5DQTlcgO6twSpTiUgCwIFCAUXBHQEqQV6swAVxUlmTmsCwjqsP/wKJQmXb793UgZBEBsnpRD3DDMBtQE7De1L2ATxBjsEyR99GRkPzZWcCKUt3QztJuMuoYBaI/UqgwXtS/Q83QtNUWgPWQtlCeM6Y4FOAyEBDSKLCt0NOQhtEPMKyWsN5RFFBzkD1UmaAKUHAQsRHTUVtSYQYqwLCTl3Bvsa9guPJq8TKXr8BdMaIQZNASka/wDPLueFsFoxXBxPXwYDCyUjxxSoUCANJUC3eEgaGwcVJakCkUNwSodRNh6TIfY8PQ1mLhNRfAf1PAUZTwuBPJ5Gq0UOEdI+jT1IIklMLAQ1fywvJ4sJzw+FDLl8cgFZCSEJsQxxEzERFzfFCDkHGS2XJCcVCCFGlWCaBPefA/MT0QMLBT8JQQcTA7UcLRMuFSkFDYEk1wLzNtUuswKPVoABFwXLDyUf3xBQR+AO6QibAmUDgyXrAC0VIQAXIpsIQ2MAX4/YUwUuywjHamwjdANnFOdhEXMHkQ5XB6ccMxW/HOFwyF4Lhggoo68JWwF1CZkBXwTjCAk1W4ygIEFnU4tYGJsgYUE/XfwCMQxlFZ9EvYd4AosPaxIbATUBcwc5DQECdxHtEWsQlQjrhgQ1tTP4OiUETyGDIBEKJwNPbM4LJyb5DPhpAaMSYgMMND137merYLYkF/0HGTLFQWAh8QuST80MnBrBGEJULhnkB78D8xrzJ+pBVwX/A6MDEzpNM+4EvQtpCIsJPwBJDqMXB9cYagpxjNABMYsBt5kDV5GDAm+PBjcHCwBnC4cFeeUAHQKnCKMABQDPA1cAOQKtB50AGQCFQQE9AycvASHlAo8DkwgxywGVLwHzKQQbwwwVAPc3bkoCw7ECgGpmogXdWAKOAkk1AU0lBAVOR1EDr3HhANsASwYT30cBFatKyxrjQwHfbysAxwD7AAU1BwVBAc0B820AtwFfCzEJorO1AU3pKQCDABVrAdcCiQDdADUAf/EBUwBNBVn5BdMCT0kBETEYK1dhAbsDHwEzAQ0AeQbLjaXJBx8EbQfTAhAbFeEC7y4HtQEDIt8TzULFAr3eVaFgAmSBAmJCW02vWzcgAqH3AmiYAmYJAp+EOBsLAmY7AmYmBG4EfwN/EwN+kjkGOXcXOYI6IyMCbB0CMjY4CgJtxwJtru+KM2dFKwFnAN4A4QBKBQeYDI0A/gvCAA21AncvAnaiPwJ5S0MCeLodXNtFrkbXAnw/AnrIAn0JAnzwBVkFIEgASH1jJAKBbQKAAAKABQJ/rklYSlsVF0rMAtEBAtDMSycDiE8Dh+ZExZEyAvKhXQMDA65LzkwtJQPPTUxNrwKLPwKK2MEbBx1DZwW3Ao43Ao5cQJeBAo7ZAo5ceFG0UzUKUtRUhQKT+wKTDADpABxVHlWvVdAGLBsplYYy4XhmRTs5ApefAu+yWCGoAFklApaPApZ8nACpWaxaCYFNADsClrUClk5cRFzRApnLAplkXMpdBxkCnJs5wjqdApwWAp+bAp64igAdDzEqDwKd8QKekgC1PWE0Ye8CntMCoG4BqQKenx8Cnk6lY8hkJyUrAievAiZ+AqD7AqBMAqLdAqHEAqYvAqXOAqf/AH0Cp/JofGixAANJahxq0QKs4wKsrgKtZwKtAgJXHQJV3AKx4dcDH05slwKyvQ0CsugXbOBtY21IXwMlzQK2XDs/bpADKUUCuF4CuUcVArkqd3A2cOECvRkCu9pwlgMyEQK+iHICAzNxAr4acyJzTwLDywLDBHOCdEs1RXTgAzynAzyaAz2/AsV8AsZHAsYQiQLIaVECyEQCyU8CyS4CZJ0C3dJ4eWF4rnklS9ADGKNnAgJh9BnzlSR7C16SXrsRAs9rAs9sL0tT0vMTnwDGrQLPcwEp6gNOEn5LBQLcJwLbigLSTwNSXANTXwEBA1WMgIk/AMsW7WBFghyC04LOg40C2scC2d6EEIRJpzwDhqUALwNkDoZxWfkAVQLfZQLeuHN3AuIv7RQB8zAnAfSbAfLShwLr8wLpcHkC6vkC6uQA+UcBuQLuiQLrnJaqlwMC7j8DheCYeXDgcaEC8wMAaQOOFpmTAvcTA5FuA5KHAveYAvnZAvhmmhyaq7s3mx4DnYMC/voBGwA5nxyfswMFjQOmagOm2QDRxQMGaqGIogUJAwxJAtQAPwMA4UEXUwER8wNrB5dnBQCTLSu3r73bAYmZFH8RBDkB+ykFIQ6dCZ8Akv0TtRQrxQL3LScApQC3BbmOkRc/xqdtQS4UJo0uAUMBgPwBtSYAdQMOBG0ALAIWDKEAAAoCPQJqA90DfgSRASBFBSF8CgAFAEQAEwA2EgJ3AQAF1QNr7wrFAgD3Cp8nv7G35QGRIUFCAekUfxE0wIkABAAbAFoCRQKEiwAGOlM6lI1tALg6jzrQAI04wTrcAKUA6ADLATqBOjs5/Dn5O3aJOls7nok6bzkYAVYBMwFsBS81XTWeNa01ZjV1NbY1xTWCNZE10jXhNZ41rTXuNf01sjXBNgI2ETXGNdU2FjYnNd417TYuNj02LjUtITY6Nj02PDbJNwgEkDxXNjg23TcgNw82yiA3iTcwCgSwPGc2JDcZN2w6jTchQtRDB0LgQwscDw8JmyhtKFFVBgDpfwDpsAD+mxQ91wLpNSMArQC9BbeOkRdLxptzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgELgEaJZkC7aMAoQCjBcGOmxdNxrsBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUHqSvAj5Gqwr7YrMUACT9AN3rpF27H7fsd/twPt4l+UW1yQYKBt2Cgy7qJpGiLcdE2P1cQSImUbqJ6ICH27H4knQMIRMrFkHu3sx6tC35Y+eLIh4e4CMKJ4DfyV+8mfta499RCAJ0xfeZR8PsoYOApva9pjGn4PhvyZS7/h5JLuhaucfjuU+Z584wwqNO4hWYmaBCcjgQPale1bjoHzMUbut/zTgxHxBnAyrdKpF4IRMASLBtD/jviyLeCgj8twWjAd3HchN/uqaeRYeHJgl7JEY9/cTrvtfybx/r3Y/NtxJ9dp+MTVmiS9bwBH73s8Di56/Ma+mTPMHq4T1yEG1fWcqr0u+hrGnJEvU1JJAm/maQSrKrazIyvSkDFkj8UUlfBq8baniTGPng6YZRL661rDNw4w/1g2figG0IhXnL7wosd/sVNo5dYSmMBTP5c7rYLjRdCwg8quwljOMPf63D8ICAL0r71XRiyFHdgwHbwfgnPOf4Lzjf2v+j+IiDHG2isp5yUnzSDyDRb4i/Vs0qHSHq8PiEQ/JnBP7PxnjN0j6gT4AVAeRx/1o9VnEUlUwvFrzJqHk9jxAw4sYxCnrxaeBdCFFKbnE7z+x54F5W7ZZsU6kx8Qocul6FoAHHy01FGL/nne61mn4+uYXfQ1Uccn+HMLKE+cZzT8BB1E3FRskOgJrRsq25rauLm8+uamXpkS/bTy6y1wDbCrW4eD532kTWrtNUmVVZOIn/C+/JR9KVR5iG9TY8iaT67ubm/whL1xbKZoqtY+a6fNxMJrg211bGYJDUkYMNWA0BMB++9zOm6Eik4roqs9CCEFW0lyAK0PbvlzvoxrZuY/OEhNW/l/63U15Od/RSvmDvXpGLiVmeGi5PDSH2bYz5o2g6wFDQ2FbZgYgTF8rPlvA1ifjZD3NLtFdXdpSIJvgKR7GpjJWG7GZGawPomIH8B5tUmtHH9LpM+/KQKunEPa1GiQkCXv4Cnm9DLORo2joicHdPDZ64obQrPZ5bgqckkj0G6/NEiPYBY4bCkL7W8G5YzsUb6GakFjykSPkT7JGeLeB6uJOGMm+x7N381BCDfbJFx0dtLgV9Q477BfL1fvitX5anV/oYfxeYl+eF5x5bB8+Ep/L2nsmd56aKF4aAD4GbJWsdKyBW22xEmAD3XdbtsMyAFoR5mOla0gEd9U/YVB7zvHGpHbQonay9Sv0bQ8iZ8piaXVrKc5AG1AmqqgaEvzHSP2Wux7aZTWh6quVDVU01JtMIVRdCFwlSbbqqhoFlyzsotQzRexFvZ/MqUSFu3OhRIuNBbufvBpdVgb8XdGJ48/lJPCZ7dsOujTTbKPSEvGXkOnG2Xdi8/nM3EMRqITd5QeU7iOjKqC7URJY6TnLsHij22xAHKnVRD5MDtBYnoGFqZGMDmXCW6Oj+BAWw14hESY/xLF6bLku06AHkiXTHPCFZ0f9YSqqo27eAhhS67OrA2Het4M9JM3jm/yRX6bYxnfmzYl5qQdHxN08FsNuWDrWd4vMUY2QD3hr8vS73SCTkFoXZR3xNzOQt8d/6HfjBmXqvrE6EGkLzK6YK2U2/ksU/iUH+LvVIsJI+ri2AL/klo+ShdDyfs5A83i2prkMs51IKR7ZcqjZJi5X3+bd8GlyWvtddxKEoEqSgEO7A8jIgf2nH0h8FjM7oB6yte3X5mpL0i/E4Rx0CotKnILJj/vJqo4VkPQ93jRtRVfaitQPqldl5xRYPq8387Z0DcnZvOeION0Ht1+P27kFLGQIcLBX4FG3sffccNHh5cPfzp9INoRtqVtdViJfg8RjnXiIz/MNqEN6zvzX3hMzyWC7oSoXIT14ubc0abPX8Rp9GVa5NI/8iv+6ela1oTncbdimRKnrbRffDR/X4nH+bgqAuHWl7hOaeXPWVzIeRl7ga+JzD4Sx3mlj/q6Ra/E2HhDf21eEzTLNGfCZsY+/yxZzQzIAuijG65ii4O/waAJCrEJaWd/DRAKMQ5678Dw5AT7RCKzdadIwd8LsD+DgPBASmWsUlf8R0k1w/2k4lO2Wpb4zMI6EJVJs0xk/wn8/fRUPqrDKhbjHR41SqgFMx5RGMPuduFwlu5lK89tW11sTqiX/5EfGs5nO+y9FKvgXKPOEmgE05EKNL6Sjb3xS40H3BVPhm0ESOZgAjZoymc8be0inDVo4JdJVf+NKd3tN/CaB7GShhH27qf95NoFZVX/6ZkR2lX+CgWrQ2INgkh+bbMz68+uJ3Clsh8HSMPEQtAt+BBE6fXDab7KIlsKxU1lIXW/KWVstpdPanJ0pdXpQinDyUQjtY7ZVcfiecRxRDMAUhHFU2cEaciQ+htiPMPx1kdvtWG9T44w3r037ljHBFJdYR0r55qvMRixtAEFJAqA4T1ES87FAx7UozXasytg8MftZYt0rjYgLe6EJ5aWvy2qscBSBQ7yehoJIA3wIIZ9ukfkyBb6qnue5ko8W50rpV4kXqWjI5nbGRXrNW0tBZHXlY48nSgcUXBHWT4GcgLZJoLlKJnV96kCYpq9eWHh7xJzkCAyrQuQ5AJ0qq/uZ3toJglNterev+Qm0KXxPg/+YbFRJdfhbp1wOnVOEYdVHTya6CtO0afhEaBhx3oHwCb5Kq6RwHDzFMl2vfjL8GwzcCoTj7wZe+UFnYDV2yKpPU9dba29gYBdNqJg/KXozO+CJTlKmlKhnqTf5doeS35DZFV+cYJQVjd+oVY/Gtc/6XPzUxb1gMqf6cEjNNoRC8AObrp+fx0cVtGu4ffC2TgXRC8zPl8moUHCB5HZ25d87mlsiiK0aNwBtcEQjRNBT/QrXbw/8aVXdKMHn9EqYEKEyxSGTpYQOaes1G1Qq8pDgqkZtlO2HRyCXpmeM7TSrRPkAh004BfisVpF6zP44n2Jvxz/gOVocNCyy9V6lkod28QM4pbaMvVJigD/w3BrsjSJrXlqc4ulBYOCceiBN4b/gHajYyupbhEt63a619Ay4wsL6a6w6B+A7TnoyE7BliWHJfzVxxIKM/W3M/J8Bx99Op863Q8eNuIMGRx++VbYfjm+VGYBA3Ap/KEu/wxBNBpJJncwHPG45V8Gh98ZIrGCc20MwijGowZbcS7d1nEgcOW5cddZpHL2XPAIRbColiheZzXTvBxZOY3iMSDSKDrICyJ/iQs1vdplVdH/JrLJsQ2jtTnfCrITIghq3KFX3qAgLWAIp8IffNSdTYptnbGfc8s+qcr3zyzyHp1aJg+jxTF4kD1ry5Wauv5V3xnOGwTFecNzXSLHBW20/pCQjk4uorD0plIhMSTc79+/r4RKPClRYTBYex1Ob5crtfvRQBBv6re/6FhtCqtduag67glqRA77/3ulblh9YRtMdDxkCyJDeNnAuCLPQFmdRRWJtH20Z8DstfJf+5oj5SSB64d0iF5/Ya4KfTWxfivj9Ap2/zbYaTo/1gO3tM6RYsCZharMBFr7Fm61mLSrQnEI4OF1gbVS4k/JE9UotOrnLJZuswoWodCSV8zbybkJSVIP7n8UaE9xCR39rJZmf27HOAPVOGc9pdkQUcRrI0qyVF9Z3j1RHDbxIfwbWzmPVjwIdPJvtmBYwEQIUsIW1S939hcVikK00ozPRI02cqhzVUNzpOxVdrwRPvlh1aIOf0xFEqD3YkGnCnFah/cFN3J2gB7N+bZSGawwkKFu1tpQMrp1W+27YNkyT0TpcFpTqgOqqLabrgcCUPxh97mREOGy4xItzQ9xSl6rq+8BZsHcrQFReS+QeMxJ3P6CnL9EP/eOLDjumLhvrcQrpPiknsofbzBv9gTP0lU+TIVwE6E7CcKfT36q+ZiEOHJ9ayf0dyUJLezAb2M8aNHwd0+OJmsVgTzRWA";const Ew=44032,fE=4352,pE=4449,mE=4519,gV=19,yV=21,Yv=28,gE=yV*Yv,Nae=gV*gE,jae=Ew+Nae,Dae=fE+gV,Lae=pE+yV,Oae=mE+Yv;function D1(t){return t>>24&255}function xV(t){return t&16777215}let Mk,SO,kk,FT;function Fae(){let t=dV(Rae);Mk=new Map(hV(t).flatMap((e,n)=>e.map(s=>[s,n+1<<24]))),SO=new Set(Sw(t)),kk=new Map,FT=new Map;for(let[e,n]of fV(t)){if(!SO.has(e)&&n.length==2){let[s,l]=n,u=FT.get(s);u||(u=new Map,FT.set(s,u)),u.set(l,e)}kk.set(e,n.reverse())}}function _V(t){return t>=Ew&&t<jae}function Bae(t,e){if(t>=fE&&t<Dae&&e>=pE&&e<Lae)return Ew+(t-fE)*gE+(e-pE)*Yv;if(_V(t)&&e>mE&&e<Oae&&(t-Ew)%Yv==0)return t+(e-mE);{let n=FT.get(t);return n&&(n=n.get(e),n)?n:-1}}function vV(t){Mk||Fae();let e=[],n=[],s=!1;function l(u){let p=Mk.get(u);p&&(s=!0,u|=p),e.push(u)}for(let u of t)for(;;){if(u<128)e.push(u);else if(_V(u)){let p=u-Ew,r=p/gE|0,v=p%gE/Yv|0,w=p%Yv;l(fE+r),l(pE+v),w>0&&l(mE+w)}else{let p=kk.get(u);p?n.push(...p):l(u)}if(!n.length)break;u=n.pop()}if(s&&e.length>1){let u=D1(e[0]);for(let p=1;p<e.length;p++){let r=D1(e[p]);if(r==0||u<=r){u=r;continue}let v=p-1;for(;;){let w=e[v+1];if(e[v+1]=e[v],e[v]=w,!v||(u=D1(e[--v]),u<=r))break}u=D1(e[p])}}return e}function zae(t){let e=[],n=[],s=-1,l=0;for(let u of t){let p=D1(u),r=xV(u);if(s==-1)p==0?s=r:e.push(r);else if(l>0&&l>=p)p==0?(e.push(s,...n),n.length=0,s=r):n.push(r),l=p;else{let v=Bae(s,r);v>=0?s=v:l==0&&p==0?(e.push(s),s=r):(n.push(r),l=p)}}return s>=0&&e.push(s,...n),e}function bV(t){return vV(t).map(xV)}function Uae(t){return zae(vV(t))}const TO=45,wV=".",SV=65039,TV=1,yE=t=>Array.from(t);function Aw(t,e){return t.P.has(e)||t.Q.has(e)}class Vae extends Array{get is_emoji(){return!0}}let Ik,EV,ox,Pk,AV,Av,nM,fv,Wy,EO,Rk;function gR(){if(Ik)return;let t=dV(vae);const e=()=>Sw(t),n=()=>new Set(e()),s=(E,T)=>T.forEach(k=>E.add(k));Ik=new Map(fV(t)),EV=n(),ox=e(),Pk=new Set(e().map(E=>ox[E])),ox=new Set(ox),AV=n(),n();let l=hV(t),u=t();const p=()=>{let E=new Set;return e().forEach(T=>s(E,l[T])),s(E,e()),E};Av=Tw(E=>{let T=Tw(t).map(k=>k+96);if(T.length){let k=E>=u;T[0]-=32,T=Kv(T),k&&(T=`Restricted[${T}]`);let R=p(),D=p(),O=!t();return{N:T,P:R,Q:D,M:O,R:k}}}),nM=n(),fv=new Map;let r=e().concat(yE(nM)).sort((E,T)=>E-T);r.forEach((E,T)=>{let k=t(),R=r[T]=k?r[T-k]:{V:[],M:new Map};R.V.push(E),nM.has(E)||fv.set(E,R)});for(let{V:E,M:T}of new Set(fv.values())){let k=[];for(let D of E){let O=Av.filter(U=>Aw(U,D)),F=k.find(({G:U})=>O.some(X=>U.has(X)));F||(F={G:new Set,V:[]},k.push(F)),F.V.push(D),s(F.G,O)}let R=k.flatMap(D=>yE(D.G));for(let{G:D,V:O}of k){let F=new Set(R.filter(U=>!D.has(U)));for(let U of O)T.set(U,F)}}Wy=new Set;let v=new Set;const w=E=>Wy.has(E)?v.add(E):Wy.add(E);for(let E of Av){for(let T of E.P)w(T);for(let T of E.Q)w(T)}for(let E of Wy)!fv.has(E)&&!v.has(E)&&fv.set(E,TV);s(Wy,bV(Wy)),EO=Mae(t).map(E=>Vae.from(E)).sort(Pae),Rk=new Map;for(let E of EO){let T=[Rk];for(let k of E){let R=T.map(D=>{let O=D.get(k);return O||(O=new Map,D.set(k,O)),O});k===SV?T.push(...R):T=R}for(let k of T)k.V=E}}function yR(t){return(CV(t)?"":`${xR(AA([t]))} `)+mV(t)}function xR(t){return`"${t}"`}function Hae(t){if(t.length>=4&&t[2]==TO&&t[3]==TO)throw new Error(`invalid label extension: "${Kv(t.slice(0,4))}"`)}function Gae(t){for(let n=t.lastIndexOf(95);n>0;)if(t[--n]!==95)throw new Error("underscore allowed only at start")}function $ae(t){let e=t[0],n=bO.get(e);if(n)throw H1(`leading ${n}`);let s=t.length,l=-1;for(let u=1;u<s;u++){e=t[u];let p=bO.get(e);if(p){if(l==u)throw H1(`${n} + ${p}`);l=u+1,n=p}}if(l==s)throw H1(`trailing ${n}`)}function AA(t,e=1/0,n=mV){let s=[];Wae(t[0])&&s.push(""),t.length>e&&(e>>=1,t=[...t.slice(0,e),8230,...t.slice(-e)]);let l=0,u=t.length;for(let p=0;p<u;p++){let r=t[p];CV(r)&&(s.push(Kv(t.slice(l,p))),s.push(n(r)),l=p+1)}return s.push(Kv(t.slice(l,u))),s.join("")}function Wae(t,e){return gR(),ox.has(t)}function CV(t){return gR(),AV.has(t)}function qae(t){return Kae(Xae(t,Uae,ele))}function Xae(t,e,n){if(!t)return[];gR();let s=0;return t.split(wV).map(l=>{let u=Iae(l),p={input:u,offset:s};s+=u.length+1;try{let r=p.tokens=Jae(u,e,n),v=r.length,w;if(!v)throw new Error("empty label");let E=p.output=r.flat();if(Gae(E),!(p.emoji=v>1||r[0].is_emoji)&&E.every(k=>k<128))Hae(E),w="ASCII";else{let k=r.flatMap(R=>R.is_emoji?[]:R);if(!k.length)w="Emoji";else{if(ox.has(E[0]))throw H1("leading combining mark");for(let O=1;O<v;O++){let F=r[O];if(!F.is_emoji&&ox.has(F[0]))throw H1(`emoji + combining mark: "${Kv(r[O-1])} + ${AA([F[0]])}"`)}$ae(E);let R=yE(new Set(k)),[D]=Qae(R);Yae(D,k),Zae(D,R),w=D.N}}p.type=w}catch(r){p.error=r}return p})}function Zae(t,e){let n,s=[];for(let l of e){let u=fv.get(l);if(u===TV)return;if(u){let p=u.M.get(l);if(n=n?n.filter(r=>p.has(r)):yE(p),!n.length)return}else s.push(l)}if(n){for(let l of n)if(s.every(u=>Aw(l,u)))throw new Error(`whole-script confusable: ${t.N}/${l.N}`)}}function Qae(t){let e=Av;for(let n of t){let s=e.filter(l=>Aw(l,n));if(!s.length)throw Av.some(l=>Aw(l,n))?kV(e[0],n):MV(n);if(e=s,s.length==1)break}return e}function Kae(t){return t.map(({input:e,error:n,output:s})=>{if(n){let l=n.message;throw new Error(t.length==1?l:`Invalid label ${xR(AA(e,63))}: ${l}`)}return Kv(s)}).join(wV)}function MV(t){return new Error(`disallowed character: ${yR(t)}`)}function kV(t,e){let n=yR(e),s=Av.find(l=>l.P.has(e));return s&&(n=`${s.N} ${n}`),new Error(`illegal mixture: ${t.N} + ${n}`)}function H1(t){return new Error(`illegal placement: ${t}`)}function Yae(t,e){for(let n of e)if(!Aw(t,n))throw kV(t,n);if(t.M){let n=bV(e);for(let s=1,l=n.length;s<l;s++)if(Pk.has(n[s])){let u=s+1;for(let p;u<l&&Pk.has(p=n[u]);u++)for(let r=s;r<u;r++)if(n[r]==p)throw new Error(`duplicate non-spacing marks: ${yR(p)}`);if(u-s>wO)throw new Error(`excessive non-spacing marks: ${xR(AA(n.slice(s-1,u)))} (${u-s}/${wO})`);s=u}}}function Jae(t,e,n){let s=[],l=[];for(t=t.slice().reverse();t.length;){let u=tle(t);if(u)l.length&&(s.push(e(l)),l=[]),s.push(n(u));else{let p=t.pop();if(Wy.has(p))l.push(p);else{let r=Ik.get(p);if(r)l.push(...r);else if(!EV.has(p))throw MV(p)}}}return l.length&&s.push(e(l)),s}function ele(t){return t.filter(e=>e!=SV)}function tle(t,e){let n=Rk,s,l=t.length;for(;l&&(n=n.get(t[--l]),!!n);){let{V:u}=n;u&&(s=u,t.length=l)}return s}function nle(t){return qae(t)}function rle(t){return nle(t)}const _R=j7({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:12e3,rpcUrls:{default:{http:["https://eth.merkle.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://etherscan.io",apiUrl:"https://api.etherscan.io/api"}},contracts:{ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:23085558},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:14353601}}}),Ux=j7({id:11155111,name:"Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://11155111.rpc.thirdweb.com"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.etherscan.io",apiUrl:"https://api-sepolia.etherscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:751532},ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:8928790}},testnet:!0});var IV=V8();const CA=Wx(IV);var Nk=function(t,e){return Nk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])},Nk(t,e)};function PV(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nk(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var eh=function(){return eh=Object.assign||function(e){for(var n,s=1,l=arguments.length;s<l;s++){n=arguments[s];for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(e[u]=n[u])}return e},eh.apply(this,arguments)};function K0(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,s=Object.getOwnPropertySymbols(t);l<s.length;l++)e.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(t,s[l])&&(n[s[l]]=t[s[l]]);return n}function RV(t,e,n,s){var l=arguments.length,u=l<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(t,e,n,s);else for(var r=t.length-1;r>=0;r--)(p=t[r])&&(u=(l<3?p(u):l>3?p(e,n,u):p(e,n))||u);return l>3&&u&&Object.defineProperty(e,n,u),u}function NV(t,e){return function(n,s){e(n,s,t)}}function jV(t,e,n,s,l,u){function p(U){if(U!==void 0&&typeof U!="function")throw new TypeError("Function expected");return U}for(var r=s.kind,v=r==="getter"?"get":r==="setter"?"set":"value",w=!e&&t?s.static?t:t.prototype:null,E=e||(w?Object.getOwnPropertyDescriptor(w,s.name):{}),T,k=!1,R=n.length-1;R>=0;R--){var D={};for(var O in s)D[O]=O==="access"?{}:s[O];for(var O in s.access)D.access[O]=s.access[O];D.addInitializer=function(U){if(k)throw new TypeError("Cannot add initializers after decoration has completed");u.push(p(U||null))};var F=(0,n[R])(r==="accessor"?{get:E.get,set:E.set}:E[v],D);if(r==="accessor"){if(F===void 0)continue;if(F===null||typeof F!="object")throw new TypeError("Object expected");(T=p(F.get))&&(E.get=T),(T=p(F.set))&&(E.set=T),(T=p(F.init))&&l.unshift(T)}else(T=p(F))&&(r==="field"?l.unshift(T):E[v]=T)}w&&Object.defineProperty(w,s.name,E),k=!0}function DV(t,e,n){for(var s=arguments.length>2,l=0;l<e.length;l++)n=s?e[l].call(t,n):e[l].call(t);return s?n:void 0}function LV(t){return typeof t=="symbol"?t:"".concat(t)}function OV(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function FV(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function yi(t,e,n,s){function l(u){return u instanceof n?u:new n(function(p){p(u)})}return new(n||(n=Promise))(function(u,p){function r(E){try{w(s.next(E))}catch(T){p(T)}}function v(E){try{w(s.throw(E))}catch(T){p(T)}}function w(E){E.done?u(E.value):l(E.value).then(r,v)}w((s=s.apply(t,e||[])).next())})}function BV(t,e){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,l,u,p=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return p.next=r(0),p.throw=r(1),p.return=r(2),typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function r(w){return function(E){return v([w,E])}}function v(w){if(s)throw new TypeError("Generator is already executing.");for(;p&&(p=0,w[0]&&(n=0)),n;)try{if(s=1,l&&(u=w[0]&2?l.return:w[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,w[1])).done)return u;switch(l=0,u&&(w=[w[0]&2,u.value]),w[0]){case 0:case 1:u=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,l=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!u||w[1]>u[0]&&w[1]<u[3])){n.label=w[1];break}if(w[0]===6&&n.label<u[1]){n.label=u[1],u=w;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(w);break}u[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(E){w=[6,E],l=0}finally{s=u=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var MA=Object.create?(function(t,e,n,s){s===void 0&&(s=n);var l=Object.getOwnPropertyDescriptor(e,n);(!l||("get"in l?!e.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,s,l)}):(function(t,e,n,s){s===void 0&&(s=n),t[s]=e[n]});function zV(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&MA(e,t,n)}function xE(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vR(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var s=n.call(t),l,u=[],p;try{for(;(e===void 0||e-- >0)&&!(l=s.next()).done;)u.push(l.value)}catch(r){p={error:r}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(p)throw p.error}}return u}function UV(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(vR(arguments[e]));return t}function VV(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var s=Array(t),l=0,e=0;e<n;e++)for(var u=arguments[e],p=0,r=u.length;p<r;p++,l++)s[l]=u[p];return s}function bR(t,e,n){if(n||arguments.length===2)for(var s=0,l=e.length,u;s<l;s++)(u||!(s in e))&&(u||(u=Array.prototype.slice.call(e,0,s)),u[s]=e[s]);return t.concat(u||Array.prototype.slice.call(e))}function Jv(t){return this instanceof Jv?(this.v=t,this):new Jv(t)}function HV(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),l,u=[];return l=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),r("next"),r("throw"),r("return",p),l[Symbol.asyncIterator]=function(){return this},l;function p(R){return function(D){return Promise.resolve(D).then(R,T)}}function r(R,D){s[R]&&(l[R]=function(O){return new Promise(function(F,U){u.push([R,O,F,U])>1||v(R,O)})},D&&(l[R]=D(l[R])))}function v(R,D){try{w(s[R](D))}catch(O){k(u[0][3],O)}}function w(R){R.value instanceof Jv?Promise.resolve(R.value.v).then(E,T):k(u[0][2],R)}function E(R){v("next",R)}function T(R){v("throw",R)}function k(R,D){R(D),u.shift(),u.length&&v(u[0][0],u[0][1])}}function GV(t){var e,n;return e={},s("next"),s("throw",function(l){throw l}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(l,u){e[l]=t[l]?function(p){return(n=!n)?{value:Jv(t[l](p)),done:!1}:u?u(p):p}:u}}function $V(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof xE=="function"?xE(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(u){n[u]=t[u]&&function(p){return new Promise(function(r,v){p=t[u](p),l(r,v,p.done,p.value)})}}function l(u,p,r,v){Promise.resolve(v).then(function(w){u({value:w,done:r})},p)}}function WV(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var ile=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},jk=function(t){return jk=Object.getOwnPropertyNames||function(e){var n=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[n.length]=s);return n},jk(t)};function qV(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=jk(t),s=0;s<n.length;s++)n[s]!=="default"&&MA(e,t,n[s]);return ile(e,t),e}function XV(t){return t&&t.__esModule?t:{default:t}}function ZV(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)}function QV(t,e,n,s,l){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!l)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!l:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?l.call(t,n):l?l.value=n:e.set(t,n),n}function KV(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function YV(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,l;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],n&&(l=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");l&&(s=function(){try{l.call(this)}catch(u){return Promise.reject(u)}}),t.stack.push({value:e,dispose:s,async:n})}else n&&t.stack.push({async:!0});return e}var sle=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var s=new Error(n);return s.name="SuppressedError",s.error=t,s.suppressed=e,s};function JV(t){function e(u){t.error=t.hasError?new sle(u,t.error,"An error was suppressed during disposal."):u,t.hasError=!0}var n,s=0;function l(){for(;n=t.stack.pop();)try{if(!n.async&&s===1)return s=0,t.stack.push(n),Promise.resolve().then(l);if(n.dispose){var u=n.dispose.call(n.value);if(n.async)return s|=2,Promise.resolve(u).then(l,function(p){return e(p),l()})}else s|=1}catch(p){e(p)}if(s===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return l()}function eH(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,s,l,u,p){return s?e?".jsx":".js":l&&(!u||!p)?n:l+u+"."+p.toLowerCase()+"js"}):t}const ole={__extends:PV,__assign:eh,__rest:K0,__decorate:RV,__param:NV,__esDecorate:jV,__runInitializers:DV,__propKey:LV,__setFunctionName:OV,__metadata:FV,__awaiter:yi,__generator:BV,__createBinding:MA,__exportStar:zV,__values:xE,__read:vR,__spread:UV,__spreadArrays:VV,__spreadArray:bR,__await:Jv,__asyncGenerator:HV,__asyncDelegator:GV,__asyncValues:$V,__makeTemplateObject:WV,__importStar:qV,__importDefault:XV,__classPrivateFieldGet:ZV,__classPrivateFieldSet:QV,__classPrivateFieldIn:KV,__addDisposableResource:YV,__disposeResources:JV,__rewriteRelativeImportExtension:eH},ale=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:YV,get __assign(){return eh},__asyncDelegator:GV,__asyncGenerator:HV,__asyncValues:$V,__await:Jv,__awaiter:yi,__classPrivateFieldGet:ZV,__classPrivateFieldIn:KV,__classPrivateFieldSet:QV,__createBinding:MA,__decorate:RV,__disposeResources:JV,__esDecorate:jV,__exportStar:zV,__extends:PV,__generator:BV,__importDefault:XV,__importStar:qV,__makeTemplateObject:WV,__metadata:FV,__param:NV,__propKey:LV,__read:vR,__rest:K0,__rewriteRelativeImportExtension:eH,__runInitializers:DV,__setFunctionName:OV,__spread:UV,__spreadArray:bR,__spreadArrays:VV,__values:xE,default:ole},Symbol.toStringTag,{value:"Module"}));var BT="right-scroll-bar-position",zT="width-before-scroll-bar",lle="with-scroll-bars-hidden",cle="--removed-body-scroll-bar-size";function rM(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function ule(t,e){var n=he.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(s){var l=n.value;l!==s&&(n.value=s,n.callback(s,l))}}}})[0];return n.callback=e,n.facade}var dle=typeof window<"u"?he.useLayoutEffect:he.useEffect,AO=new WeakMap;function hle(t,e){var n=ule(null,function(s){return t.forEach(function(l){return rM(l,s)})});return dle(function(){var s=AO.get(n);if(s){var l=new Set(s),u=new Set(t),p=n.current;l.forEach(function(r){u.has(r)||rM(r,null)}),u.forEach(function(r){l.has(r)||rM(r,p)})}AO.set(n,t)},[t]),n}function fle(t){return t}function ple(t,e){e===void 0&&(e=fle);var n=[],s=!1,l={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(u){var p=e(u,s);return n.push(p),function(){n=n.filter(function(r){return r!==p})}},assignSyncMedium:function(u){for(s=!0;n.length;){var p=n;n=[],p.forEach(u)}n={push:function(r){return u(r)},filter:function(){return n}}},assignMedium:function(u){s=!0;var p=[];if(n.length){var r=n;n=[],r.forEach(u),p=n}var v=function(){var E=p;p=[],E.forEach(u)},w=function(){return Promise.resolve().then(v)};w(),n={push:function(E){p.push(E),w()},filter:function(E){return p=p.filter(E),n}}}};return l}function mle(t){t===void 0&&(t={});var e=ple(null);return e.options=eh({async:!0,ssr:!1},t),e}var tH=function(t){var e=t.sideCar,n=K0(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return he.createElement(s,eh({},n))};tH.isSideCarExport=!0;function gle(t,e){return t.useMedium(e),tH}var nH=mle(),iM=function(){},kA=he.forwardRef(function(t,e){var n=he.useRef(null),s=he.useState({onScrollCapture:iM,onWheelCapture:iM,onTouchMoveCapture:iM}),l=s[0],u=s[1],p=t.forwardProps,r=t.children,v=t.className,w=t.removeScrollBar,E=t.enabled,T=t.shards,k=t.sideCar,R=t.noIsolation,D=t.inert,O=t.allowPinchZoom,F=t.as,U=F===void 0?"div":F,X=t.gapMode,W=K0(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),K=k,ne=hle([n,e]),te=eh(eh({},W),l);return he.createElement(he.Fragment,null,E&&he.createElement(K,{sideCar:nH,removeScrollBar:w,shards:T,noIsolation:R,inert:D,setCallbacks:u,allowPinchZoom:!!O,lockRef:n,gapMode:X}),p?he.cloneElement(he.Children.only(r),eh(eh({},te),{ref:ne})):he.createElement(U,eh({},te,{className:v,ref:ne}),r))});kA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};kA.classNames={fullWidth:zT,zeroRight:BT};var yle=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xle(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=yle();return e&&t.setAttribute("nonce",e),t}function _le(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function vle(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var ble=function(){var t=0,e=null;return{add:function(n){t==0&&(e=xle())&&(_le(e,n),vle(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},wle=function(){var t=ble();return function(e,n){he.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},rH=function(){var t=wle(),e=function(n){var s=n.styles,l=n.dynamic;return t(s,l),null};return e},Sle={left:0,top:0,right:0,gap:0},sM=function(t){return parseInt(t||"",10)||0},Tle=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],s=e[t==="padding"?"paddingTop":"marginTop"],l=e[t==="padding"?"paddingRight":"marginRight"];return[sM(n),sM(s),sM(l)]},Ele=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Sle;var e=Tle(t),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-n+e[2]-e[0])}},Ale=rH(),Cv="data-scroll-locked",Cle=function(t,e,n,s){var l=t.left,u=t.top,p=t.right,r=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(lle,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(r,"px ").concat(s,`;
  }
  body[`).concat(Cv,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(r,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(r,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(BT,` {
    right: `).concat(r,"px ").concat(s,`;
  }
  
  .`).concat(zT,` {
    margin-right: `).concat(r,"px ").concat(s,`;
  }
  
  .`).concat(BT," .").concat(BT,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(zT," .").concat(zT,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Cv,`] {
    `).concat(cle,": ").concat(r,`px;
  }
`)},CO=function(){var t=parseInt(document.body.getAttribute(Cv)||"0",10);return isFinite(t)?t:0},Mle=function(){he.useEffect(function(){return document.body.setAttribute(Cv,(CO()+1).toString()),function(){var t=CO()-1;t<=0?document.body.removeAttribute(Cv):document.body.setAttribute(Cv,t.toString())}},[])},kle=function(t){var e=t.noRelative,n=t.noImportant,s=t.gapMode,l=s===void 0?"margin":s;Mle();var u=he.useMemo(function(){return Ele(l)},[l]);return he.createElement(Ale,{styles:Cle(u,!e,l,n?"":"!important")})},Dk=!1;if(typeof window<"u")try{var US=Object.defineProperty({},"passive",{get:function(){return Dk=!0,!0}});window.addEventListener("test",US,US),window.removeEventListener("test",US,US)}catch{Dk=!1}var U_=Dk?{passive:!1}:!1,Ile=function(t){return t.tagName==="TEXTAREA"},iH=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Ile(t)&&n[e]==="visible")},Ple=function(t){return iH(t,"overflowY")},Rle=function(t){return iH(t,"overflowX")},MO=function(t,e){var n=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var l=sH(t,s);if(l){var u=oH(t,s),p=u[1],r=u[2];if(p>r)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},Nle=function(t){var e=t.scrollTop,n=t.scrollHeight,s=t.clientHeight;return[e,n,s]},jle=function(t){var e=t.scrollLeft,n=t.scrollWidth,s=t.clientWidth;return[e,n,s]},sH=function(t,e){return t==="v"?Ple(e):Rle(e)},oH=function(t,e){return t==="v"?Nle(e):jle(e)},Dle=function(t,e){return t==="h"&&e==="rtl"?-1:1},Lle=function(t,e,n,s,l){var u=Dle(t,window.getComputedStyle(e).direction),p=u*s,r=n.target,v=e.contains(r),w=!1,E=p>0,T=0,k=0;do{var R=oH(t,r),D=R[0],O=R[1],F=R[2],U=O-F-u*D;(D||U)&&sH(t,r)&&(T+=U,k+=D),r instanceof ShadowRoot?r=r.host:r=r.parentNode}while(!v&&r!==document.body||v&&(e.contains(r)||e===r));return(E&&Math.abs(T)<1||!E&&Math.abs(k)<1)&&(w=!0),w},VS=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},kO=function(t){return[t.deltaX,t.deltaY]},IO=function(t){return t&&"current"in t?t.current:t},Ole=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Fle=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Ble=0,V_=[];function zle(t){var e=he.useRef([]),n=he.useRef([0,0]),s=he.useRef(),l=he.useState(Ble++)[0],u=he.useState(rH)[0],p=he.useRef(t);he.useEffect(function(){p.current=t},[t]),he.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(l));var O=bR([t.lockRef.current],(t.shards||[]).map(IO),!0).filter(Boolean);return O.forEach(function(F){return F.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),O.forEach(function(F){return F.classList.remove("allow-interactivity-".concat(l))})}}},[t.inert,t.lockRef.current,t.shards]);var r=he.useCallback(function(O,F){if("touches"in O&&O.touches.length===2||O.type==="wheel"&&O.ctrlKey)return!p.current.allowPinchZoom;var U=VS(O),X=n.current,W="deltaX"in O?O.deltaX:X[0]-U[0],K="deltaY"in O?O.deltaY:X[1]-U[1],ne,te=O.target,re=Math.abs(W)>Math.abs(K)?"h":"v";if("touches"in O&&re==="h"&&te.type==="range")return!1;var xe=MO(re,te);if(!xe)return!0;if(xe?ne=re:(ne=re==="v"?"h":"v",xe=MO(re,te)),!xe)return!1;if(!s.current&&"changedTouches"in O&&(W||K)&&(s.current=ne),!ne)return!0;var ae=s.current||ne;return Lle(ae,F,O,ae==="h"?W:K)},[]),v=he.useCallback(function(O){var F=O;if(!(!V_.length||V_[V_.length-1]!==u)){var U="deltaY"in F?kO(F):VS(F),X=e.current.filter(function(ne){return ne.name===F.type&&(ne.target===F.target||F.target===ne.shadowParent)&&Ole(ne.delta,U)})[0];if(X&&X.should){F.cancelable&&F.preventDefault();return}if(!X){var W=(p.current.shards||[]).map(IO).filter(Boolean).filter(function(ne){return ne.contains(F.target)}),K=W.length>0?r(F,W[0]):!p.current.noIsolation;K&&F.cancelable&&F.preventDefault()}}},[]),w=he.useCallback(function(O,F,U,X){var W={name:O,delta:F,target:U,should:X,shadowParent:Ule(U)};e.current.push(W),setTimeout(function(){e.current=e.current.filter(function(K){return K!==W})},1)},[]),E=he.useCallback(function(O){n.current=VS(O),s.current=void 0},[]),T=he.useCallback(function(O){w(O.type,kO(O),O.target,r(O,t.lockRef.current))},[]),k=he.useCallback(function(O){w(O.type,VS(O),O.target,r(O,t.lockRef.current))},[]);he.useEffect(function(){return V_.push(u),t.setCallbacks({onScrollCapture:T,onWheelCapture:T,onTouchMoveCapture:k}),document.addEventListener("wheel",v,U_),document.addEventListener("touchmove",v,U_),document.addEventListener("touchstart",E,U_),function(){V_=V_.filter(function(O){return O!==u}),document.removeEventListener("wheel",v,U_),document.removeEventListener("touchmove",v,U_),document.removeEventListener("touchstart",E,U_)}},[]);var R=t.removeScrollBar,D=t.inert;return he.createElement(he.Fragment,null,D?he.createElement(u,{styles:Fle(l)}):null,R?he.createElement(kle,{gapMode:t.gapMode}):null)}function Ule(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Vle=gle(nH,zle);var aH=he.forwardRef(function(t,e){return he.createElement(kA,eh({},t,{ref:e,sideCar:Vle}))});aH.classNames=kA.classNames;function PO(t){var e=t.match(/^var\((.*)\)$/);return e?e[1]:t}function Hle(t,e){var n=t;for(var s of e){if(!(s in n))throw new Error("Path ".concat(e.join(" -> ")," does not exist in object"));n=n[s]}return n}function lH(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s={};for(var l in t){var u=t[l],p=[...n,l];typeof u=="string"||typeof u=="number"||u==null?s[l]=e(u,p):typeof u=="object"&&!Array.isArray(u)?s[l]=lH(u,e,p):console.warn('Skipping invalid key "'.concat(p.join("."),'". Should be a string, number, null or object. Received: "').concat(Array.isArray(u)?"Array":typeof u,'"'))}return s}function RO(t,e){var n={};if(typeof e=="object"){var s=t;lH(e,(r,v)=>{if(r!=null){var w=Hle(s,v);n[PO(w)]=String(r)}})}else{var l=t;for(var u in l){var p=l[u];p!=null&&(n[PO(u)]=p)}}return Object.defineProperty(n,"toString",{value:function(){return Object.keys(this).map(v=>"".concat(v,":").concat(this[v])).join(";")},writable:!1}),n}var L1={exports:{}},Gle=L1.exports,NO;function $le(){return NO||(NO=1,(function(t,e){(function(n,s){var l="1.0.41",u="",p="?",r="function",v="undefined",w="object",E="string",T="major",k="model",R="name",D="type",O="vendor",F="version",U="architecture",X="console",W="mobile",K="tablet",ne="smarttv",te="wearable",re="embedded",xe=500,ae="Amazon",ce="Apple",ye="ASUS",Ce="BlackBerry",Me="Browser",Ke="Chrome",ke="Edge",je="Firefox",$e="Google",Ae="Honor",He="Huawei",qe="Lenovo",Le="LG",st="Microsoft",bt="Motorola",yt="Nvidia",Vt="OnePlus",_t="Opera",vt="OPPO",qt="Samsung",kt="Sharp",on="Sony",mn="Xiaomi",Hr="Zebra",Un="Facebook",$r="Chromium OS",ht="Mac OS",Lr=" Browser",Br=function(Jn,ir){var bn={};for(var In in Jn)ir[In]&&ir[In].length%2===0?bn[In]=ir[In].concat(Jn[In]):bn[In]=Jn[In];return bn},wn=function(Jn){for(var ir={},bn=0;bn<Jn.length;bn++)ir[Jn[bn].toUpperCase()]=Jn[bn];return ir},Nn=function(Jn,ir){return typeof Jn===E?mr(ir).indexOf(mr(Jn))!==-1:!1},mr=function(Jn){return Jn.toLowerCase()},Qn=function(Jn){return typeof Jn===E?Jn.replace(/[^\d\.]/g,u).split(".")[0]:s},Nt=function(Jn,ir){if(typeof Jn===E)return Jn=Jn.replace(/^\s\s*/,u),typeof ir===v?Jn:Jn.substring(0,xe)},et=function(Jn,ir){for(var bn=0,In,Zr,Vr,qn,Kn,St;bn<ir.length&&!Kn;){var Gn=ir[bn],er=ir[bn+1];for(In=Zr=0;In<Gn.length&&!Kn&&Gn[In];)if(Kn=Gn[In++].exec(Jn),Kn)for(Vr=0;Vr<er.length;Vr++)St=Kn[++Zr],qn=er[Vr],typeof qn===w&&qn.length>0?qn.length===2?typeof qn[1]==r?this[qn[0]]=qn[1].call(this,St):this[qn[0]]=qn[1]:qn.length===3?typeof qn[1]===r&&!(qn[1].exec&&qn[1].test)?this[qn[0]]=St?qn[1].call(this,St,qn[2]):s:this[qn[0]]=St?St.replace(qn[1],qn[2]):s:qn.length===4&&(this[qn[0]]=St?qn[3].call(this,St.replace(qn[1],qn[2])):s):this[qn]=St||s;bn+=2}},Oe=function(Jn,ir){for(var bn in ir)if(typeof ir[bn]===w&&ir[bn].length>0){for(var In=0;In<ir[bn].length;In++)if(Nn(ir[bn][In],Jn))return bn===p?s:bn}else if(Nn(ir[bn],Jn))return bn===p?s:bn;return ir.hasOwnProperty("*")?ir["*"]:Jn},Bt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},En={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Dn={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[F,[R,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[F,[R,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[R,F],[/opios[\/ ]+([\w\.]+)/i],[F,[R,_t+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[F,[R,_t+" GX"]],[/\bopr\/([\w\.]+)/i],[F,[R,_t]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[F,[R,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[F,[R,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[R,F],[/quark(?:pc)?\/([-\w\.]+)/i],[F,[R,"Quark"]],[/\bddg\/([\w\.]+)/i],[F,[R,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[F,[R,"UC"+Me]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[F,[R,"WeChat"]],[/konqueror\/([\w\.]+)/i],[F,[R,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[F,[R,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[F,[R,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[F,[R,"Smart Lenovo "+Me]],[/(avast|avg)\/([\w\.]+)/i],[[R,/(.+)/,"$1 Secure "+Me],F],[/\bfocus\/([\w\.]+)/i],[F,[R,je+" Focus"]],[/\bopt\/([\w\.]+)/i],[F,[R,_t+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[F,[R,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[F,[R,"Dolphin"]],[/coast\/([\w\.]+)/i],[F,[R,_t+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[F,[R,"MIUI"+Lr]],[/fxios\/([\w\.-]+)/i],[F,[R,je]],[/\bqihoobrowser\/?([\w\.]*)/i],[F,[R,"360"]],[/\b(qq)\/([\w\.]+)/i],[[R,/(.+)/,"$1Browser"],F],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[R,/(.+)/,"$1"+Lr],F],[/samsungbrowser\/([\w\.]+)/i],[F,[R,qt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[F,[R,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[R,"Sogou Mobile"],F],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[R,F],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[R],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[F,R],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[R,Un],F],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[R,F],[/\bgsa\/([\w\.]+) .*safari\//i],[F,[R,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[F,[R,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[F,[R,Ke+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[R,Ke+" WebView"],F],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[F,[R,"Android "+Me]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[R,F],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[F,[R,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[F,R],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[R,[F,Oe,Bt]],[/(webkit|khtml)\/([\w\.]+)/i],[R,F],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[R,"Netscape"],F],[/(wolvic|librewolf)\/([\w\.]+)/i],[R,F],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[F,[R,je+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[R,[F,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[R,[F,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[U,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[U,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[U,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[U,/ower/,u,mr]],[/ sun4\w[;\)]/i],[[U,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[U,mr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[k,[O,qt],[D,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[k,[O,qt],[D,W]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[k,[O,ce],[D,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[k,[O,ce],[D,K]],[/(macintosh);/i],[k,[O,ce]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[k,[O,kt],[D,W]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[k,[O,Ae],[D,K]],[/honor([-\w ]+)[;\)]/i],[k,[O,Ae],[D,W]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[k,[O,He],[D,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[k,[O,He],[D,W]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[k,/_/g," "],[O,mn],[D,K]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[k,/_/g," "],[O,mn],[D,W]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[k,[O,vt],[D,W]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[k,[O,Oe,{OnePlus:["304","403","203"],"*":vt}],[D,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[k,[O,"Vivo"],[D,W]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[k,[O,"Realme"],[D,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[k,[O,bt],[D,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[k,[O,bt],[D,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[k,[O,Le],[D,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[k,[O,Le],[D,W]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[k,[O,qe],[D,K]],[/(nokia) (t[12][01])/i],[O,k,[D,K]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[k,/_/g," "],[D,W],[O,"Nokia"]],[/(pixel (c|tablet))\b/i],[k,[O,$e],[D,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[k,[O,$e],[D,W]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[k,[O,on],[D,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[k,"Xperia Tablet"],[O,on],[D,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[k,[O,Vt],[D,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[k,[O,ae],[D,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[k,/(.+)/g,"Fire Phone $1"],[O,ae],[D,W]],[/(playbook);[-\w\),; ]+(rim)/i],[k,O,[D,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[k,[O,Ce],[D,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[k,[O,ye],[D,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[k,[O,ye],[D,W]],[/(nexus 9)/i],[k,[O,"HTC"],[D,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[k,/_/g," "],[D,W]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[k,[O,"TCL"],[D,K]],[/(itel) ((\w+))/i],[[O,mr],k,[D,Oe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[k,[O,"Acer"],[D,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[k,[O,"Meizu"],[D,W]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[k,[O,"Ulefone"],[D,W]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[k,[O,"Energizer"],[D,W]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[k,[O,"Cat"],[D,W]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[k,[O,"Smartfren"],[D,W]],[/droid.+; (a(?:015|06[35]|142p?))/i],[k,[O,"Nothing"],[D,W]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[k,[O,"Archos"],[D,K]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[k,[O,"Archos"],[D,W]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[O,k,[D,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[O,k,[D,W]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,k,[D,K]],[/(surface duo)/i],[k,[O,st],[D,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[k,[O,"Fairphone"],[D,W]],[/(u304aa)/i],[k,[O,"AT&T"],[D,W]],[/\bsie-(\w*)/i],[k,[O,"Siemens"],[D,W]],[/\b(rct\w+) b/i],[k,[O,"RCA"],[D,K]],[/\b(venue[\d ]{2,7}) b/i],[k,[O,"Dell"],[D,K]],[/\b(q(?:mv|ta)\w+) b/i],[k,[O,"Verizon"],[D,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[k,[O,"Barnes & Noble"],[D,K]],[/\b(tm\d{3}\w+) b/i],[k,[O,"NuVision"],[D,K]],[/\b(k88) b/i],[k,[O,"ZTE"],[D,K]],[/\b(nx\d{3}j) b/i],[k,[O,"ZTE"],[D,W]],[/\b(gen\d{3}) b.+49h/i],[k,[O,"Swiss"],[D,W]],[/\b(zur\d{3}) b/i],[k,[O,"Swiss"],[D,K]],[/\b((zeki)?tb.*\b) b/i],[k,[O,"Zeki"],[D,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],k,[D,K]],[/\b(ns-?\w{0,9}) b/i],[k,[O,"Insignia"],[D,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[k,[O,"NextBook"],[D,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],k,[D,W]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],k,[D,W]],[/\b(ph-1) /i],[k,[O,"Essential"],[D,W]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[k,[O,"Envizen"],[D,K]],[/\b(trio[-\w\. ]+) b/i],[k,[O,"MachSpeed"],[D,K]],[/\btu_(1491) b/i],[k,[O,"Rotor"],[D,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[k,[O,yt],[D,K]],[/(sprint) (\w+)/i],[O,k,[D,W]],[/(kin\.[onetw]{3})/i],[[k,/\./g," "],[O,st],[D,W]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[k,[O,Hr],[D,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[k,[O,Hr],[D,W]],[/smart-tv.+(samsung)/i],[O,[D,ne]],[/hbbtv.+maple;(\d+)/i],[[k,/^/,"SmartTV"],[O,qt],[D,ne]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,Le],[D,ne]],[/(apple) ?tv/i],[O,[k,ce+" TV"],[D,ne]],[/crkey/i],[[k,Ke+"cast"],[O,$e],[D,ne]],[/droid.+aft(\w+)( bui|\))/i],[k,[O,ae],[D,ne]],[/(shield \w+ tv)/i],[k,[O,yt],[D,ne]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[k,[O,kt],[D,ne]],[/(bravia[\w ]+)( bui|\))/i],[k,[O,on],[D,ne]],[/(mi(tv|box)-?\w+) bui/i],[k,[O,mn],[D,ne]],[/Hbbtv.*(technisat) (.*);/i],[O,k,[D,ne]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[O,Nt],[k,Nt],[D,ne]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[k,[D,ne]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[D,ne]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,k,[D,X]],[/droid.+; (shield)( bui|\))/i],[k,[O,yt],[D,X]],[/(playstation \w+)/i],[k,[O,on],[D,X]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[k,[O,st],[D,X]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[k,[O,qt],[D,te]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[O,k,[D,te]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[k,[O,vt],[D,te]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[k,[O,ce],[D,te]],[/(opwwe\d{3})/i],[k,[O,Vt],[D,te]],[/(moto 360)/i],[k,[O,bt],[D,te]],[/(smartwatch 3)/i],[k,[O,on],[D,te]],[/(g watch r)/i],[k,[O,Le],[D,te]],[/droid.+; (wt63?0{2,3})\)/i],[k,[O,Hr],[D,te]],[/droid.+; (glass) \d/i],[k,[O,$e],[D,te]],[/(pico) (4|neo3(?: link|pro)?)/i],[O,k,[D,te]],[/; (quest( \d| pro)?)/i],[k,[O,Un],[D,te]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[D,re]],[/(aeobc)\b/i],[k,[O,ae],[D,re]],[/(homepod).+mac os/i],[k,[O,ce],[D,re]],[/windows iot/i],[[D,re]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[k,[D,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[k,[D,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[D,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[D,W]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[k,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[F,[R,ke+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[R,F],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[F,[R,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[R,F],[/ladybird\//i],[[R,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[F,R]],os:[[/microsoft (windows) (vista|xp)/i],[R,F],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[R,[F,Oe,En]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[F,Oe,En],[R,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[F,/_/g,"."],[R,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[R,ht],[F,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[F,R],[/(ubuntu) ([\w\.]+) like android/i],[[R,/(.+)/,"$1 Touch"],F],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[R,F],[/\(bb(10);/i],[F,[R,Ce]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[F,[R,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[F,[R,je+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[F,[R,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[F,[R,"watchOS"]],[/crkey\/([\d\.]+)/i],[F,[R,Ke+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[R,$r],F],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[R,F],[/(sunos) ?([\w\.\d]*)/i],[[R,"Solaris"],F],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[R,F]]},rn=function(Jn,ir){if(typeof Jn===w&&(ir=Jn,Jn=s),!(this instanceof rn))return new rn(Jn,ir).getResult();var bn=typeof n!==v&&n.navigator?n.navigator:s,In=Jn||(bn&&bn.userAgent?bn.userAgent:u),Zr=bn&&bn.userAgentData?bn.userAgentData:s,Vr=ir?Br(Dn,ir):Dn,qn=bn&&bn.userAgent==In;return this.getBrowser=function(){var Kn={};return Kn[R]=s,Kn[F]=s,et.call(Kn,In,Vr.browser),Kn[T]=Qn(Kn[F]),qn&&bn&&bn.brave&&typeof bn.brave.isBrave==r&&(Kn[R]="Brave"),Kn},this.getCPU=function(){var Kn={};return Kn[U]=s,et.call(Kn,In,Vr.cpu),Kn},this.getDevice=function(){var Kn={};return Kn[O]=s,Kn[k]=s,Kn[D]=s,et.call(Kn,In,Vr.device),qn&&!Kn[D]&&Zr&&Zr.mobile&&(Kn[D]=W),qn&&Kn[k]=="Macintosh"&&bn&&typeof bn.standalone!==v&&bn.maxTouchPoints&&bn.maxTouchPoints>2&&(Kn[k]="iPad",Kn[D]=K),Kn},this.getEngine=function(){var Kn={};return Kn[R]=s,Kn[F]=s,et.call(Kn,In,Vr.engine),Kn},this.getOS=function(){var Kn={};return Kn[R]=s,Kn[F]=s,et.call(Kn,In,Vr.os),qn&&!Kn[R]&&Zr&&Zr.platform&&Zr.platform!="Unknown"&&(Kn[R]=Zr.platform.replace(/chrome os/i,$r).replace(/macos/i,ht)),Kn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return In},this.setUA=function(Kn){return In=typeof Kn===E&&Kn.length>xe?Nt(Kn,xe):Kn,this},this.setUA(In),this};rn.VERSION=l,rn.BROWSER=wn([R,F,T]),rn.CPU=wn([U]),rn.DEVICE=wn([k,O,D,X,W,ne,K,te,re]),rn.ENGINE=rn.OS=wn([R,F]),t.exports&&(e=t.exports=rn),e.UAParser=rn;var wr=typeof n!==v&&(n.jQuery||n.Zepto);if(wr&&!wr.ua){var cr=new rn;wr.ua=cr.getResult(),wr.ua.get=function(){return cr.getUA()},wr.ua.set=function(Jn){cr.setUA(Jn);var ir=cr.getResult();for(var bn in ir)wr.ua[bn]=ir[bn]}}})(typeof window=="object"?window:Gle)})(L1,L1.exports)),L1.exports}var Wle=$le();/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const T1={newline:10,reset:27};function qle(t){if(!Number.isSafeInteger(t))throw new Error(`integer expected: ${t}`)}function Xle(t){if(!Number.isSafeInteger(t)||t<1||t>40)throw new Error(`Invalid version=${t}. Expected number [1..40]`)}function Dy(t,e){return t.toString(2).padStart(e,"0")}function jO(t,e){const n=t%e;return n>=0?n:e+n}function ed(t,e){return new Array(t).fill(e)}function DO(...t){let e=0;for(const s of t)e=Math.max(e,s.length);const n=[];for(let s=0;s<e;s++)for(const l of t)s>=l.length||n.push(l[s]);return new Uint8Array(n)}function LO(t,e,n){if(n<0||n+e.length>t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[n+s])return!1;return!0}function Zle(){let t,e=1/0;return{add(n,s){n>=e||(t=s,e=n)},get:()=>t,score:()=>e}}function OO(t){return{has:e=>t.includes(e),decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=t.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return s})},encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(qle(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})}}}class Ju{constructor(e,n){AS(this,"data");AS(this,"height");AS(this,"width");const{height:s,width:l}=Ju.size(e);this.data=n||Array.from({length:s},()=>ed(l,void 0)),this.height=s,this.width=l}static size(e,n){if(typeof e=="number"&&(e={height:e,width:e}),!Number.isSafeInteger(e.height)&&e.height!==1/0)throw new Error(`Bitmap: invalid height=${e.height} (${typeof e.height})`);if(!Number.isSafeInteger(e.width)&&e.width!==1/0)throw new Error(`Bitmap: invalid width=${e.width} (${typeof e.width})`);return n!==void 0&&(e={width:Math.min(e.width,n.width),height:Math.min(e.height,n.height)}),e}static fromString(e){e=e.replace(/^\n+/g,"").replace(/\n+$/g,"");const n=e.split(String.fromCharCode(T1.newline)),s=n.length,l=new Array(s);let u;for(const p of n){const r=p.split("").map(v=>{if(v==="X")return!0;if(v===" ")return!1;if(v!=="?")throw new Error(`Bitmap.fromString: unknown symbol=${v}`)});if(u&&r.length!==u)throw new Error(`Bitmap.fromString different row sizes: width=${u} cur=${r.length}`);u=r.length,l.push(r)}return u||(u=0),new Ju({height:s,width:u},l)}point(e){return this.data[e.y][e.x]}isInside(e){return 0<=e.x&&e.x<this.width&&0<=e.y&&e.y<this.height}size(e){if(!e)return{height:this.height,width:this.width};const{x:n,y:s}=this.xy(e);return{height:this.height-s,width:this.width-n}}xy(e){if(typeof e=="number"&&(e={x:e,y:e}),!Number.isSafeInteger(e.x))throw new Error(`Bitmap: invalid x=${e.x}`);if(!Number.isSafeInteger(e.y))throw new Error(`Bitmap: invalid y=${e.y}`);return e.x=jO(e.x,this.width),e.y=jO(e.y,this.height),e}rect(e,n,s){const{x:l,y:u}=this.xy(e),{height:p,width:r}=Ju.size(n,this.size({x:l,y:u}));for(let v=0;v<p;v++)for(let w=0;w<r;w++)this.data[u+v][l+w]=typeof s=="function"?s({x:w,y:v},this.data[u+v][l+w]):s;return this}rectRead(e,n,s){return this.rect(e,n,(l,u)=>(s(l,u),u))}hLine(e,n,s){return this.rect(e,{width:n,height:1},s)}vLine(e,n,s){return this.rect(e,{width:1,height:n},s)}border(e=2,n){const s=this.height+2*e,l=this.width+2*e,u=ed(e,n),p=Array.from({length:e},()=>ed(l,n));return new Ju({height:s,width:l},[...p,...this.data.map(r=>[...u,...r,...u]),...p])}embed(e,n){return this.rect(e,n.size(),({x:s,y:l})=>n.data[l][s])}rectSlice(e,n=this.size()){const s=new Ju(Ju.size(n,this.size(this.xy(e))));return this.rect(e,n,({x:l,y:u},p)=>s.data[u][l]=p),s}inverse(){const{height:e,width:n}=this;return new Ju({height:n,width:e}).rect({x:0,y:0},1/0,({x:l,y:u})=>this.data[l][u])}scale(e){if(!Number.isSafeInteger(e)||e>1024)throw new Error(`invalid scale factor: ${e}`);const{height:n,width:s}=this;return new Ju({height:e*n,width:e*s}).rect({x:0,y:0},1/0,({x:u,y:p})=>this.data[Math.floor(p/e)][Math.floor(u/e)])}clone(){return new Ju(this.size()).rect({x:0,y:0},this.size(),({x:n,y:s})=>this.data[s][n])}assertDrawn(){this.rectRead(0,1/0,(e,n)=>{if(typeof n!="boolean")throw new Error(`Invalid color type=${typeof n}`)})}toString(){return this.data.map(e=>e.map(n=>n===void 0?"?":n?"X":" ").join("")).join(String.fromCharCode(T1.newline))}toASCII(){const{height:e,width:n,data:s}=this;let l="";for(let u=0;u<e;u+=2){for(let p=0;p<n;p++){const r=s[u][p],v=u+1>=e?!0:s[u+1][p];!r&&!v?l+="":!r&&v?l+="":r&&!v?l+="":r&&v&&(l+=" ")}l+=String.fromCharCode(T1.newline)}return l}toTerm(){const e=String.fromCharCode(T1.reset),n=e+"[0m",s=e+"[1;47m  "+n,l=e+"[40m  "+n;return this.data.map(u=>u.map(p=>p?l:s).join("")).join(String.fromCharCode(T1.newline))}toSVG(e=!0){let n=`<svg viewBox="0 0 ${this.width} ${this.height}" xmlns="http://www.w3.org/2000/svg">`,s="",l;return this.rectRead(0,1/0,(u,p)=>{if(!p)return;const{x:r,y:v}=u;if(!e){n+=`<rect x="${r}" y="${v}" width="1" height="1" />`;return}let w=`M${r} ${v}`;if(l){const T=`m${r-l.x} ${v-l.y}`;T.length<=w.length&&(w=T)}const E=r<10?`H${r}`:"h-1";s+=`${w}h1v1${E}Z`,l=u}),e&&(n+=`<path d="${s}"/>`),n+="</svg>",n}toGIF(){const e=r=>[r&255,r>>>8&255],n=[...e(this.width),...e(this.height)],s=[];this.rectRead(0,1/0,(r,v)=>s.push(+(v===!0)));const l=126,u=[71,73,70,56,55,97,...n,246,0,0,255,255,255,...ed(381,0),44,0,0,0,0,...n,0,7],p=Math.floor(s.length/l);for(let r=0;r<p;r++)u.push(l+1,128,...s.slice(l*r,l*(r+1)).map(v=>+v));return u.push(s.length%l+1,128,...s.slice(p*l).map(r=>+r)),u.push(1,129,0,59),new Uint8Array(u)}toImage(e=!1){const{height:n,width:s}=this.size(),l=new Uint8Array(n*s*(e?3:4));let u=0;for(let p=0;p<n;p++)for(let r=0;r<s;r++){const v=this.data[p][r]?0:255;l[u++]=v,l[u++]=v,l[u++]=v,e||(l[u++]=255)}return{height:n,width:s,data:l}}}const FO=["low","medium","quartile","high"],BO=["numeric","alphanumeric","byte","kanji","eci"],Qle=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],Kle={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]},Yle={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]},pc={size:{encode:t=>21+4*(t-1),decode:t=>(t-17)/4},sizeType:t=>Math.floor((t+7)/17),alignmentPatterns(t){if(t===1)return[];const e=6,n=pc.size.encode(t)-e-1,s=n-e,l=Math.ceil(s/28);let u=Math.floor(s/l);u%2?u+=1:s%l*2>=l&&(u+=2);const p=[e];for(let r=1;r<l;r++)p.push(n-(l-r)*u);return p.push(n),p},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits(t,e){const n=pc.ECCode[t]<<3|e;let s=n;for(let l=0;l<10;l++)s=s<<1^(s>>9)*1335;return(n<<10|s)^pc.formatMask},versionBits(t){let e=t;for(let n=0;n<12;n++)e=e<<1^(e>>11)*7973;return t<<12|e},alphabet:{numeric:OO("0123456789"),alphanumerc:OO("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits(t,e){return{numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]}[e][pc.sizeType(t)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity(t,e){const n=Qle[t-1],s=Kle[e][t-1],l=Yle[e][t-1],u=Math.floor(n/l)-s,p=l-n%l;return{words:s,numBlocks:l,shortBlocks:p,blockLen:u,capacity:(n-s*l)*8,total:(s+u)*l+l-p}}},wR=[(t,e)=>(t+e)%2==0,(t,e)=>e%2==0,(t,e)=>t%3==0,(t,e)=>(t+e)%3==0,(t,e)=>(Math.floor(e/2)+Math.floor(t/3))%2==0,(t,e)=>t*e%2+t*e%3==0,(t,e)=>(t*e%2+t*e%3)%2==0,(t,e)=>((t+e)%2+t*e%3)%2==0],ui={tables:(t=>{const e=ed(256,0),n=ed(256,0);for(let s=0,l=1;s<256;s++)e[s]=l,n[l]=s,l<<=1,l&256&&(l^=t);return{exp:e,log:n}})(285),exp:t=>ui.tables.exp[t],log(t){if(t===0)throw new Error(`GF.log: invalid arg=${t}`);return ui.tables.log[t]%255},mul(t,e){return t===0||e===0?0:ui.tables.exp[(ui.tables.log[t]+ui.tables.log[e])%255]},add:(t,e)=>t^e,pow:(t,e)=>ui.tables.exp[ui.tables.log[t]*e%255],inv(t){if(t===0)throw new Error(`GF.inverse: invalid arg=${t}`);return ui.tables.exp[255-ui.tables.log[t]]},polynomial(t){if(t.length==0)throw new Error("GF.polymomial: invalid length");if(t[0]!==0)return t;let e=0;for(;e<t.length-1&&t[e]==0;e++);return t.slice(e)},monomial(t,e){if(t<0)throw new Error(`GF.monomial: invalid degree=${t}`);if(e==0)return[0];let n=ed(t+1,0);return n[0]=e,ui.polynomial(n)},degree:t=>t.length-1,coefficient:(t,e)=>t[ui.degree(t)-e],mulPoly(t,e){if(t[0]===0||e[0]===0)return[0];const n=ed(t.length+e.length-1,0);for(let s=0;s<t.length;s++)for(let l=0;l<e.length;l++)n[s+l]=ui.add(n[s+l],ui.mul(t[s],e[l]));return ui.polynomial(n)},mulPolyScalar(t,e){if(e==0)return[0];if(e==1)return t;const n=ed(t.length,0);for(let s=0;s<t.length;s++)n[s]=ui.mul(t[s],e);return ui.polynomial(n)},mulPolyMonomial(t,e,n){if(e<0)throw new Error("GF.mulPolyMonomial: invalid degree");if(n==0)return[0];const s=ed(t.length+e,0);for(let l=0;l<t.length;l++)s[l]=ui.mul(t[l],n);return ui.polynomial(s)},addPoly(t,e){if(t[0]===0)return e;if(e[0]===0)return t;let n=t,s=e;n.length>s.length&&([n,s]=[s,n]);let l=ed(s.length,0),u=s.length-n.length,p=s.slice(0,u);for(let r=0;r<p.length;r++)l[r]=p[r];for(let r=u;r<s.length;r++)l[r]=ui.add(n[r-u],s[r]);return ui.polynomial(l)},remainderPoly(t,e){const n=Array.from(t);for(let s=0;s<t.length-e.length+1;s++){const l=n[s];if(l!==0)for(let u=1;u<e.length;u++)e[u]!==0&&(n[s+u]=ui.add(n[s+u],ui.mul(e[u],l)))}return n.slice(t.length-e.length+1,n.length)},divisorPoly(t){let e=[1];for(let n=0;n<t;n++)e=ui.mulPoly(e,[1,ui.pow(2,n)]);return e},evalPoly(t,e){if(e==0)return ui.coefficient(t,0);let n=t[0];for(let s=1;s<t.length;s++)n=ui.add(ui.mul(e,n),t[s]);return n},euclidian(t,e,n){ui.degree(t)<ui.degree(e)&&([t,e]=[e,t]);let s=t,l=e,u=[0],p=[1];for(;2*ui.degree(l)>=n;){let w=s,E=u;if(s=l,u=p,s[0]===0)throw new Error("rLast[0] === 0");l=w;let T=[0];const k=ui.inv(s[0]);for(;ui.degree(l)>=ui.degree(s)&&l[0]!==0;){const R=ui.degree(l)-ui.degree(s),D=ui.mul(l[0],k);T=ui.addPoly(T,ui.monomial(R,D)),l=ui.addPoly(l,ui.mulPolyMonomial(s,R,D))}if(T=ui.mulPoly(T,u),p=ui.addPoly(T,E),ui.degree(l)>=ui.degree(s))throw new Error(`Division failed r: ${l}, rLast: ${s}`)}const r=ui.coefficient(p,0);if(r==0)throw new Error("sigmaTilde(0) was zero");const v=ui.inv(r);return[ui.mulPolyScalar(p,v),ui.mulPolyScalar(l,v)]}};function Jle(t){return{encode(e){const n=ui.divisorPoly(t),s=Array.from(e);return s.push(...n.slice(0,-1).fill(0)),Uint8Array.from(ui.remainderPoly(s,n))},decode(e){const n=e.slice(),s=ui.polynomial(Array.from(e));let l=ed(t,0),u=!1;for(let T=0;T<t;T++){const k=ui.evalPoly(s,ui.exp(T));l[l.length-1-T]=k,k!==0&&(u=!0)}if(!u)return n;l=ui.polynomial(l);const p=ui.monomial(t,1),[r,v]=ui.euclidian(p,l,t),w=ed(ui.degree(r),0);let E=0;for(let T=1;T<256&&E<w.length;T++)ui.evalPoly(r,T)===0&&(w[E++]=ui.inv(T));if(E!==w.length)throw new Error("RS.decode: invalid errors number");for(let T=0;T<w.length;T++){const k=n.length-1-ui.log(w[T]);if(k<0)throw new Error("RS.decode: invalid error location");const R=ui.inv(w[T]);let D=1;for(let O=0;O<w.length;O++)T!==O&&(D=ui.mul(D,ui.add(1,ui.mul(w[O],R))));n[k]=ui.add(n[k],ui.mul(ui.evalPoly(v,R),ui.inv(D)))}return n}}}function ece(t,e){const{words:n,shortBlocks:s,numBlocks:l,blockLen:u,total:p}=pc.capacity(t,e),r=Jle(n);return{encode(v){const w=[],E=[];for(let D=0;D<l;D++){const O=D<s,F=u+(O?0:1);w.push(v.subarray(0,F)),E.push(r.encode(v.subarray(0,F))),v=v.subarray(F)}const T=DO(...w),k=DO(...E),R=new Uint8Array(T.length+k.length);return R.set(T),R.set(k,T.length),R},decode(v){if(v.length!==p)throw new Error(`interleave.decode: len(data)=${v.length}, total=${p}`);const w=[];for(let k=0;k<l;k++){const R=k<s;w.push(new Uint8Array(n+u+(R?0:1)))}let E=0;for(let k=0;k<u;k++)for(let R=0;R<l;R++)w[R][k]=v[E++];for(let k=s;k<l;k++)w[k][u]=v[E++];for(let k=u;k<u+n;k++)for(let R=0;R<l;R++){const D=R<s;w[R][k+(D?0:1)]=v[E++]}const T=[];for(const k of w)T.push(...Array.from(r.decode(k)).slice(0,-n));return Uint8Array.from(T)}}}function tce(t,e,n,s=!1){const l=pc.size.encode(t);let u=new Ju(l+2);const p=new Ju(3).rect(0,3,!0).border(1,!1).border(1,!0).border(1,!1);u=u.embed(0,p).embed({x:-p.width,y:0},p).embed({x:0,y:-p.height},p),u=u.rectSlice(1,l);const r=new Ju(1).rect(0,1,!0).border(1,!1).border(1,!0),v=pc.alignmentPatterns(t);for(const w of v)for(const E of v)u.data[w][E]===void 0&&u.embed({x:E-2,y:w-2},r);u=u.hLine({x:0,y:6},1/0,({x:w},E)=>E===void 0?w%2==0:E).vLine({x:6,y:0},1/0,({y:w},E)=>E===void 0?w%2==0:E);{const w=pc.formatBits(e,n),E=T=>!s&&(w>>T&1)==1;for(let T=0;T<6;T++)u.data[T][8]=E(T);for(let T=6;T<8;T++)u.data[T+1][8]=E(T);for(let T=8;T<15;T++)u.data[l-15+T][8]=E(T);for(let T=0;T<8;T++)u.data[8][l-T-1]=E(T);for(let T=8;T<9;T++)u.data[8][15-T-1+1]=E(T);for(let T=9;T<15;T++)u.data[8][15-T-1]=E(T);u.data[l-8][8]=!s}if(t>=7){const w=pc.versionBits(t);for(let E=0;E<18;E+=1){const T=!s&&(w>>E&1)==1,k=Math.floor(E/3),R=E%3+l-8-3;u.data[k][R]=T,u.data[R][k]=T}}return u}function nce(t,e,n){const s=t.height,l=wR[e];let u=-1,p=s-1;for(let r=s-1;r>0;r-=2){for(r==6&&(r=5);;p+=u){for(let v=0;v<2;v+=1){const w=r-v;t.data[p][w]===void 0&&n(w,p,l(w,p))}if(p+u<0||p+u>=s)break}u=-u}}function rce(t){let e="numeric";for(let n of t)if(!pc.alphabet.numeric.has(n)&&(e="alphanumeric",!pc.alphabet.alphanumerc.has(n)))return"byte";return e}function ice(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function zO(t,e,n,s){let l="",u=n.length;if(s==="numeric"){const T=pc.alphabet.numeric.decode(n.split("")),k=T.length;for(let R=0;R<k-2;R+=3)l+=Dy(T[R]*100+T[R+1]*10+T[R+2],10);k%3===1?l+=Dy(T[k-1],4):k%3===2&&(l+=Dy(T[k-2]*10+T[k-1],7))}else if(s==="alphanumeric"){const T=pc.alphabet.alphanumerc.decode(n.split("")),k=T.length;for(let R=0;R<k-1;R+=2)l+=Dy(T[R]*45+T[R+1],11);k%2==1&&(l+=Dy(T[k-1],6))}else if(s==="byte"){const T=ice(n);u=T.length,l=Array.from(T).map(k=>Dy(k,8)).join("")}else throw new Error("encode: unsupported type");const{capacity:p}=pc.capacity(t,e),r=Dy(u,pc.lengthBits(t,s));let v=pc.modeBits[s]+r+l;if(v.length>p)throw new Error("Capacity overflow");v+="0".repeat(Math.min(4,Math.max(0,p-v.length))),v.length%8&&(v+="0".repeat(8-v.length%8));const w="1110110000010001";for(let T=0;v.length!==p;T++)v+=w[T%w.length];const E=Uint8Array.from(v.match(/(.{8})/g).map(T=>+`0b${T}`));return ece(t,e).encode(E)}function UO(t,e,n,s,l=!1){const u=tce(t,e,s,l);let p=0;const r=8*n.length;if(nce(u,s,(v,w,E)=>{let T=!1;p<r&&(T=(n[p>>>3]>>(7-p&7)&1)!==0,p++),u.data[w][v]=T!==E}),p!==r)throw new Error("QR: bytes left after draw");return u}function sce(t){const e=t.inverse(),n=R=>{let D=0;for(let O=0,F=1,U=void 0;O<R.length;O++)U===R[O]&&(F++,O!==R.length-1)||(F>=5&&(D+=3+(F-5)),U=R[O],F=1);return D};let s=0;t.data.forEach(R=>s+=n(R)),e.data.forEach(R=>s+=n(R));let l=0,u=t.data;const p=t.width-1,r=t.height-1;for(let R=0;R<p;R++)for(let D=0;D<r;D++){const O=R+1,F=D+1;u[R][D]===u[O][D]&&u[O][D]===u[R][F]&&u[O][D]===u[O][F]&&(l+=3)}const v=R=>{const D=[!0,!1,!0,!0,!0,!1,!0],O=[!1,!1,!1,!1],F=[...D,...O],U=[...O,...D];let X=0;for(let W=0;W<R.length;W++)LO(R,F,W)&&(X+=40),LO(R,U,W)&&(X+=40);return X};let w=0;for(const R of t.data)w+=v(R);for(const R of e.data)w+=v(R);let E=0;t.rectRead(0,1/0,(R,D)=>E+=D?1:0);const T=E/(t.height*t.width)*100,k=10*Math.floor(Math.abs(T-50)/5);return s+l+w+k}function oce(t,e,n,s){if(s===void 0){const l=Zle();for(let u=0;u<wR.length;u++)l.add(sce(UO(t,e,n,u,!0)),u);s=l.get()}if(s===void 0)throw new Error("Cannot find mask");return UO(t,e,n,s)}function ace(t){if(!FO.includes(t))throw new Error(`Invalid error correction mode=${t}. Expected: ${FO}`)}function lce(t){if(!BO.includes(t))throw new Error(`Encoding: invalid mode=${t}. Expected: ${BO}`);if(t==="kanji"||t==="eci")throw new Error(`Encoding: ${t} is not supported (yet?).`)}function cce(t){if(![0,1,2,3,4,5,6,7].includes(t)||!wR[t])throw new Error(`Invalid mask=${t}. Expected number [0..7]`)}function uce(t,e="raw",n={}){const s=n.ecc!==void 0?n.ecc:"medium";ace(s);const l=n.encoding!==void 0?n.encoding:rce(t);lce(l),n.mask!==void 0&&cce(n.mask);let u=n.version,p,r=new Error("Unknown error");if(u!==void 0)Xle(u),p=zO(u,s,t,l);else for(let E=1;E<=40;E++)try{p=zO(E,s,t,l),u=E;break}catch(T){r=T}if(!u||!p)throw r;let v=oce(u,s,p,n.mask);v.assertDrawn();const w=n.border===void 0?2:n.border;if(!Number.isSafeInteger(w))throw new Error(`invalid border type=${typeof w}`);if(v=v.border(w,!1),n.scale!==void 0&&(v=v.scale(n.scale)),e==="raw")return v.data;if(e==="ascii")return v.toASCII();if(e==="svg")return v.toSVG(n.optimize);if(e==="gif")return v.toGIF();if(e==="term")return v.toTerm();throw new Error(`Unknown output: ${e}`)}function dce(t,e={}){const{errorCorrection:n,version:s}=e,l=uce(t,"raw",{border:0,ecc:n,scale:1,version:s});return{edgeLength:l.length,finderLength:7,grid:l,value:t}}function mp(t){const{arena:e,...n}=t;return f.jsxs(mp.Root,{...n,children:[f.jsx(mp.Finder,{}),f.jsx(mp.Cells,{}),e&&f.jsx(mp.Arena,{children:typeof e=="string"?f.jsx("img",{alt:"Arena",src:e,style:{borderRadius:1,height:"100%",objectFit:"cover",width:"100%"}}):e})]})}(function(t){t.Context=he.createContext(null);function e(u){const{children:p,size:r="100%",value:v,version:w,errorCorrection:E,...T}=u,k=he.useMemo(()=>(he.Children.map(p,W=>!he.isValidElement(W)||typeof W.type=="string"?null:"displayName"in W.type&&W.type.displayName==="Arena"?!0:null)??[]).some(Boolean),[p]),R=he.useMemo(()=>{let W=E;return k&&E==="low"&&(W="medium"),dce(v,{errorCorrection:W,version:w})},[v,k,E,w]),D=1,O=R.edgeLength*D,F=R.finderLength*D/2,U=k?Math.floor(O/4):0,X=he.useMemo(()=>({arenaSize:U,cellSize:D,edgeSize:O,qrcode:R,finderSize:F}),[U,O,R,F]);return f.jsx(t.Context.Provider,{value:X,children:f.jsxs("svg",{...T,width:r,height:r,viewBox:`0 0 ${O} ${O}`,xmlns:"http://www.w3.org/2000/svg",children:[f.jsx("title",{children:"QR Code"}),p]})})}t.Root=e,(function(u){u.displayName="Root"})(e=t.Root||(t.Root={}));function n(u){const{className:p,fill:r,innerClassName:v,radius:w=.25}=u,{cellSize:E,edgeSize:T,finderSize:k}=he.useContext(t.Context);function R({position:D}){let O=k-(k-E)-E/2;D==="top-right"&&(O=T-k-(k-E)-E/2);let F=k-(k-E)-E/2;D==="bottom-left"&&(F=T-k-(k-E)-E/2);let U=k-E*1.5;D==="top-right"&&(U=T-k-E*1.5);let X=k-E*1.5;return D==="bottom-left"&&(X=T-k-E*1.5),f.jsxs(f.Fragment,{children:[f.jsx("rect",{className:p,stroke:r??"currentColor",fill:"transparent",x:O,y:F,width:E+(k-E)*2,height:E+(k-E)*2,rx:2*w*(k-E),ry:2*w*(k-E),strokeWidth:E}),f.jsx("rect",{className:v,fill:r??"currentColor",x:U,y:X,width:E*3,height:E*3,rx:2*w*E,ry:2*w*E})]})}return f.jsxs(f.Fragment,{children:[f.jsx(R,{position:"top-left"}),f.jsx(R,{position:"top-right"}),f.jsx(R,{position:"bottom-left"})]})}t.Finder=n,(function(u){u.displayName="Finder"})(n=t.Finder||(t.Finder={}));function s(u){const{className:p,fill:r="currentColor",inset:v=!0,radius:w=1}=u,{arenaSize:E,cellSize:T,qrcode:k}=he.useContext(t.Context),{edgeLength:R,finderLength:D}=k,O=he.useMemo(()=>{let F="";for(let U=0;U<k.grid.length;U++){const X=k.grid[U];if(X)for(let W=0;W<X.length;W++){if(!X[W])continue;const ne=R/2-E/2,te=ne+E;if(U>=ne&&U<=te&&W>=ne&&W<=te)continue;const re=U<D&&W<D,xe=U<D&&W>=R-D,ae=U>=R-D&&W<D;if(re||xe||ae)continue;const ce=v?T*.1:0,ye=(T-ce*2)/2,Ce=W*T+T/2,Me=U*T+T/2,Ke=Ce-ye,ke=Ce+ye,je=Me-ye,$e=Me+ye,Ae=w*ye;F+=[`M ${Ke+Ae},${je}`,`L ${ke-Ae},${je}`,`A ${Ae},${Ae} 0 0,1 ${ke},${je+Ae}`,`L ${ke},${$e-Ae}`,`A ${Ae},${Ae} 0 0,1 ${ke-Ae},${$e}`,`L ${Ke+Ae},${$e}`,`A ${Ae},${Ae} 0 0,1 ${Ke},${$e-Ae}`,`L ${Ke},${je+Ae}`,`A ${Ae},${Ae} 0 0,1 ${Ke+Ae},${je}`,"z"].join(" ")}}return F},[E,T,R,D,k.grid,v,w]);return f.jsx("path",{className:p,d:O,fill:r})}t.Cells=s,(function(u){u.displayName="Cells"})(s=t.Cells||(t.Cells={}));function l(u){const{children:p}=u,{arenaSize:r,cellSize:v,edgeSize:w}=he.useContext(t.Context),E=Math.ceil(w/2-r/2),T=r+r%2,k=v/2;return f.jsx("foreignObject",{x:E,y:E,width:T,height:T,children:f.jsx("div",{style:{alignItems:"center",display:"flex",fontSize:1,justifyContent:"center",height:"100%",overflow:"hidden",width:"100%",padding:k,boxSizing:"border-box"},children:p})})}t.Arena=l,(function(u){u.displayName="Arena"})(l=t.Arena||(t.Arena={}))})(mp||(mp={}));function hce(t={}){let e,n,s,l;return u=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:p,withCapabilities:r,...v}={}){var w;try{const E=await this.getProvider(),T=p??((w=u.chains[0])==null?void 0:w.id);if(!T)throw new V0;const k=await E.request({method:"wallet_connect",params:[{capabilities:"capabilities"in v&&v.capabilities?v.capabilities:{},chainIds:[lr(T),...u.chains.filter(O=>O.id!==T).map(O=>lr(O.id))]}]}),R=k.accounts.map(O=>({address:wl(O.address),capabilities:O.capabilities??{}}));let D=Number(k.chainIds[0]);if(n||(n=this.onAccountsChanged.bind(this),E.on("accountsChanged",n)),s||(s=this.onChainChanged.bind(this),E.on("chainChanged",s)),l||(l=this.onDisconnect.bind(this),E.on("disconnect",l)),p&&D!==p){const O=await this.switchChain({chainId:p}).catch(F=>{if(F.code===ao.code)throw F;return{id:D}});D=(O==null?void 0:O.id)??D}return{accounts:r?R:R.map(O=>O.address),chainId:D}}catch(E){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(E.message)?new ao(E):E}},async disconnect(){const p=await this.getProvider();n&&(p.removeListener("accountsChanged",n),n=void 0),s&&(p.removeListener("chainChanged",s),s=void 0),l&&(p.removeListener("disconnect",l),l=void 0),p.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(r=>wl(r))},async getChainId(){const r=await(await this.getProvider()).request({method:"eth_chainId"});return Number(r)},async getProvider(){if(!e){const p=(()=>{var w;return typeof t.preference=="string"?{options:t.preference}:{...t.preference,options:((w=t.preference)==null?void 0:w.options)??"all"}})(),{createBaseAccountSDK:r}=await hr(async()=>{const{createBaseAccountSDK:w}=await import("./index-Crx1KA4W.js");return{createBaseAccountSDK:w}},__vite__mapDeps([0,1]));e=r({...t,appChainIds:u.chains.map(w=>w.id),preference:p}).getProvider()}return e},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:p,chainId:r}){var E,T,k,R;const v=u.chains.find(D=>D.id===r);if(!v)throw new ld(new V0);const w=await this.getProvider();try{return await w.request({method:"wallet_switchEthereumChain",params:[{chainId:lr(v.id)}]}),v}catch(D){if(D.code===4902)try{let O;p!=null&&p.blockExplorerUrls?O=p.blockExplorerUrls:O=(E=v.blockExplorers)!=null&&E.default.url?[(T=v.blockExplorers)==null?void 0:T.default.url]:[];let F;(k=p==null?void 0:p.rpcUrls)!=null&&k.length?F=p.rpcUrls:F=[((R=v.rpcUrls.default)==null?void 0:R.http[0])??""];const U={blockExplorerUrls:O,chainId:lr(r),chainName:(p==null?void 0:p.chainName)??v.name,iconUrls:p==null?void 0:p.iconUrls,nativeCurrency:(p==null?void 0:p.nativeCurrency)??v.nativeCurrency,rpcUrls:F};return await w.request({method:"wallet_addEthereumChain",params:[U]}),v}catch(O){throw new ao(O)}throw new ld(D)}},onAccountsChanged(p){p.length===0?this.onDisconnect():u.emitter.emit("change",{accounts:p.map(r=>wl(r))})},onChainChanged(p){const r=Number(p);u.emitter.emit("change",{chainId:r})},async onDisconnect(p){u.emitter.emit("disconnect");const r=await this.getProvider();n&&(r.removeListener("accountsChanged",n),n=void 0),s&&(r.removeListener("chainChanged",s),s=void 0),l&&(r.removeListener("disconnect",l),l=void 0)}})}SR.type="metaMask";function SR(t={}){let e,n,s,l,u,p,r,v;return w=>({id:"metaMaskSDK",name:"MetaMask",rdns:["io.metamask","io.metamask.mobile"],type:SR.type,async setup(){const E=await this.getProvider();E!=null&&E.on&&(p||(p=this.onConnect.bind(this),E.on("connect",p)),l||(l=this.onAccountsChanged.bind(this),E.on("accountsChanged",l)))},async connect({chainId:E,isReconnecting:T,withCapabilities:k}={}){const R=await this.getProvider();r||(r=this.onDisplayUri,R.on("display_uri",r));let D=[];T&&(D=await this.getAccounts().catch(()=>[]));try{let O,F;D!=null&&D.length||(t.connectAndSign||t.connectWith?(t.connectAndSign?O=await e.connectAndSign({msg:t.connectAndSign}):t.connectWith&&(F=await e.connectWith({method:t.connectWith.method,params:t.connectWith.params})),D=await this.getAccounts()):D=(await e.connect()).map(W=>wl(W)));let U=await this.getChainId();if(E&&U!==E){const X=await this.switchChain({chainId:E}).catch(W=>{if(W.code===ao.code)throw W;return{id:U}});U=(X==null?void 0:X.id)??U}return r&&(R.removeListener("display_uri",r),r=void 0),O?R.emit("connectAndSign",{accounts:D,chainId:U,signResponse:O}):F&&R.emit("connectWith",{accounts:D,chainId:U,connectWithResponse:F}),p&&(R.removeListener("connect",p),p=void 0),l||(l=this.onAccountsChanged.bind(this),R.on("accountsChanged",l)),u||(u=this.onChainChanged.bind(this),R.on("chainChanged",u)),v||(v=this.onDisconnect.bind(this),R.on("disconnect",v)),{accounts:k?D.map(X=>({address:X,capabilities:{}})):D,chainId:U}}catch(O){const F=O;throw F.code===ao.code?new ao(F):F.code===yp.code?new yp(F):F}},async disconnect(){const E=await this.getProvider();u&&(E.removeListener("chainChanged",u),u=void 0),v&&(E.removeListener("disconnect",v),v=void 0),p||(p=this.onConnect.bind(this),E.on("connect",p)),await e.terminate()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(k=>wl(k))},async getChainId(){const E=await this.getProvider(),T=E.getChainId()||await(E==null?void 0:E.request({method:"eth_chainId"}));return Number(T)},async getProvider(){async function E(){var O,F,U,X,W;const T=await(async()=>{const{default:K}=await hr(async()=>{const{default:ne}=await import("./metamask-sdk-BrRex54u.js");return{default:ne}},[]);return typeof K!="function"&&typeof K.default=="function"?K.default:K})(),k={};for(const K of w.chains)k[lr(K.id)]=(O=O9({chain:K,transports:w.transports}))==null?void 0:O[0];e=new T({_source:"wagmi",forceDeleteProvider:!1,forceInjectProvider:!1,injectProvider:!1,...t,readonlyRPCMap:k,dappMetadata:{...t.dappMetadata,name:(F=t.dappMetadata)!=null&&F.name?(U=t.dappMetadata)==null?void 0:U.name:"wagmi",url:(X=t.dappMetadata)!=null&&X.url?(W=t.dappMetadata)==null?void 0:W.url:typeof window<"u"?window.location.origin:"https://wagmi.sh"},useDeeplink:t.useDeeplink??!0});const R=await e.init(),D=R!=null&&R.activeProvider?R.activeProvider:e.getProvider();if(!D)throw new td;return D}return n||(s||(s=E()),n=await s),n},async isAuthorized(){try{return!!(await Lx(()=>mA(()=>this.getAccounts(),{timeout:200}),{delay:201,retryCount:3})).length}catch{return!1}},async switchChain({addEthereumChainParameter:E,chainId:T}){var F,U;const k=await this.getProvider(),R=w.chains.find(X=>X.id===T);if(!R)throw new ld(new V0);try{return await k.request({method:"wallet_switchEthereumChain",params:[{chainId:lr(T)}]}),await D(),await O(T),R}catch(X){const W=X;if(W.code===ao.code)throw new ao(W);if(W.code===4902||((U=(F=W==null?void 0:W.data)==null?void 0:F.originalError)==null?void 0:U.code)===4902)try{return await k.request({method:"wallet_addEthereumChain",params:[{blockExplorerUrls:(()=>{const{default:K,...ne}=R.blockExplorers??{};if(E!=null&&E.blockExplorerUrls)return E.blockExplorerUrls;if(K)return[K.url,...Object.values(ne).map(te=>te.url)]})(),chainId:lr(T),chainName:(E==null?void 0:E.chainName)??R.name,iconUrls:E==null?void 0:E.iconUrls,nativeCurrency:(E==null?void 0:E.nativeCurrency)??R.nativeCurrency,rpcUrls:(()=>{var K,ne;return(K=E==null?void 0:E.rpcUrls)!=null&&K.length?E.rpcUrls:[((ne=R.rpcUrls.default)==null?void 0:ne.http[0])??""]})()}]}),await D(),await O(T),R}catch(K){const ne=K;throw ne.code===ao.code?new ao(ne):new ld(ne)}throw new ld(W)}async function D(){await Lx(async()=>{const X=hd(await k.request({method:"eth_chainId"}));if(X!==T)throw new Error("User rejected switch after adding network.");return X},{delay:50,retryCount:20})}async function O(X){await new Promise(W=>{const K=(ne=>{"chainId"in ne&&ne.chainId===X&&(w.emitter.off("change",K),W())});w.emitter.on("change",K),w.emitter.emit("change",{chainId:X})})}},async onAccountsChanged(E){if(E.length===0)if(e.isExtensionActive())this.onDisconnect();else return;else if(w.emitter.listenerCount("connect")){const T=(await this.getChainId()).toString();this.onConnect({chainId:T})}else w.emitter.emit("change",{accounts:E.map(T=>wl(T))})},onChainChanged(E){const T=Number(E);w.emitter.emit("change",{chainId:T})},async onConnect(E){const T=await this.getAccounts();if(T.length===0)return;const k=Number(E.chainId);w.emitter.emit("connect",{accounts:T,chainId:k});const R=await this.getProvider();p&&(R.removeListener("connect",p),p=void 0),l||(l=this.onAccountsChanged.bind(this),R.on("accountsChanged",l)),u||(u=this.onChainChanged.bind(this),R.on("chainChanged",u)),v||(v=this.onDisconnect.bind(this),R.on("disconnect",v))},async onDisconnect(E){const T=await this.getProvider();E&&E.code===1013&&T&&(await this.getAccounts()).length||(w.emitter.emit("disconnect"),u&&(T.removeListener("chainChanged",u),u=void 0),v&&(T.removeListener("disconnect",v),v=void 0),p||(p=this.onConnect.bind(this),T.on("connect",p)))},onDisplayUri(E){w.emitter.emit("message",{type:"display_uri",data:E})}})}function fce(t){if(typeof t=="string"){if(!Oa(t,{strict:!1}))throw new Wc({address:t});return{address:t,type:"json-rpc"}}if(!Oa(t.address,{strict:!1}))throw new Wc({address:t.address});return{address:t.address,nonceManager:t.nonceManager,sign:t.sign,signAuthorization:t.signAuthorization,signMessage:t.signMessage,signTransaction:t.signTransaction,signTypedData:t.signTypedData,source:"custom",type:"local"}}let oM=!1;async function p2({hash:t,privateKey:e,to:n="object"}){const{r:s,s:l,recovery:u}=yA.sign(t.slice(2),e.slice(2),{lowS:!0,extraEntropy:hf(oM,{strict:!1})?sh(oM):oM}),p={r:lr(s,{size:32}),s:lr(l,{size:32}),v:u?28n:27n,yParity:u};return n==="bytes"||n==="hex"?y9({...p,to:n}):p}async function pce(t){const{chainId:e,nonce:n,privateKey:s,to:l="object"}=t,u=t.contractAddress??t.address,p=await p2({hash:g7({address:u,chainId:e,nonce:n}),privateKey:s,to:l});return l==="object"?{address:u,chainId:e,nonce:n,...p}:p}async function mce({message:t,privateKey:e}){return await p2({hash:QP(t),privateKey:e,to:"hex"})}async function gce(t){const{privateKey:e,transaction:n,serializer:s=mne}=t,l=n.type==="eip4844"?{...n,sidecars:!1}:n,u=await p2({hash:bl(await s(l)),privateKey:e});return await s(n,u)}async function yce(t){const{privateKey:e,...n}=t;return await p2({hash:F7(n),privateKey:e,to:"hex"})}function xce(t,e={}){const{nonceManager:n}=e,s=ih(yA.getPublicKey(t.slice(2),!1)),l=h7(s);return{...fce({address:l,nonceManager:n,async sign({hash:p}){return p2({hash:p,privateKey:t,to:"hex"})},async signAuthorization(p){return pce({...p,privateKey:t})},async signMessage({message:p}){return mce({message:p,privateKey:t})},async signTransaction(p,{serializer:r}={}){return gce({privateKey:t,transaction:p,serializer:r})},async signTypedData(p){return yce({...p,privateKey:t})}}),publicKey:s,source:"privateKey"}}TR.type="safe";function TR(t={}){const{shimDisconnect:e=!1}=t;let n,s;return l=>({id:"safe",name:"Safe",type:TR.type,async connect({withCapabilities:u}={}){var w;const p=await this.getProvider();if(!p)throw new td;const r=await this.getAccounts(),v=await this.getChainId();return s||(s=this.onDisconnect.bind(this),p.on("disconnect",s)),e&&await((w=l.storage)==null?void 0:w.removeItem("safe.disconnected")),{accounts:u?r.map(E=>({address:E,capabilities:{}})):r,chainId:v}},async disconnect(){var p;const u=await this.getProvider();if(!u)throw new td;s&&(u.removeListener("disconnect",s),s=void 0),e&&await((p=l.storage)==null?void 0:p.setItem("safe.disconnected",!0))},async getAccounts(){const u=await this.getProvider();if(!u)throw new td;return(await u.request({method:"eth_accounts"})).map(wl)},async getProvider(){if(typeof window<"u"&&(window==null?void 0:window.parent)!==window){if(!n){const{default:p}=await hr(async()=>{const{default:E}=await import("./index-BTq7eDJq.js");return{default:E}},__vite__mapDeps([2,3])),r=new p(t),v=await mA(()=>r.safe.getInfo(),{timeout:t.unstable_getInfoTimeout??10});if(!v)throw new Error("Could not load Safe information");const w=await(async()=>{const E=await hr(()=>import("./index-dt1SK_Rg.js").then(T=>T.i),__vite__mapDeps([4,3,5]));return typeof E.SafeAppProvider!="function"&&typeof E.default.SafeAppProvider=="function"?E.default.SafeAppProvider:E.SafeAppProvider})();n=new w(v,r)}return n}},async getChainId(){const u=await this.getProvider();if(!u)throw new td;return Number(u.chainId)},async isAuthorized(){var u;try{return e&&await((u=l.storage)==null?void 0:u.getItem("safe.disconnected"))?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){l.emitter.emit("disconnect")}})}ER.type="walletConnect";function ER(t){const e=t.isNewChainsStale??!0;let n,s;const l="eip155";let u,p,r,v,w,E;return T=>({id:"walletConnect",name:"WalletConnect",type:ER.type,async setup(){const k=await this.getProvider().catch(()=>null);k&&(r||(r=this.onConnect.bind(this),k.on("connect",r)),w||(w=this.onSessionDelete.bind(this),k.on("session_delete",w)))},async connect({chainId:k,withCapabilities:R,...D}={}){var O,F;try{const U=await this.getProvider();if(!U)throw new td;v||(v=this.onDisplayUri,U.on("display_uri",v));let X=k;if(!X){const te=await((O=T.storage)==null?void 0:O.getItem("state"))??{};T.chains.some(xe=>xe.id===te.chainId)?X=te.chainId:X=(F=T.chains[0])==null?void 0:F.id}if(!X)throw new Error("No chains found on connector.");const W=await this.isChainsStale();if(U.session&&W&&await U.disconnect(),!U.session||W){const te=T.chains.filter(re=>re.id!==X).map(re=>re.id);await U.connect({optionalChains:[X,...te],..."pairingTopic"in D?{pairingTopic:D.pairingTopic}:{}}),this.setRequestedChainsIds(T.chains.map(re=>re.id))}const K=(await U.enable()).map(te=>wl(te));let ne=await this.getChainId();if(k&&ne!==k){const te=await this.switchChain({chainId:k}).catch(re=>{var xe;if(re.code===ao.code&&((xe=re.cause)==null?void 0:xe.message)!=="Missing or invalid. request() method: wallet_addEthereumChain")throw re;return{id:ne}});ne=(te==null?void 0:te.id)??ne}return v&&(U.removeListener("display_uri",v),v=void 0),r&&(U.removeListener("connect",r),r=void 0),u||(u=this.onAccountsChanged.bind(this),U.on("accountsChanged",u)),p||(p=this.onChainChanged.bind(this),U.on("chainChanged",p)),E||(E=this.onDisconnect.bind(this),U.on("disconnect",E)),w||(w=this.onSessionDelete.bind(this),U.on("session_delete",w)),{accounts:R?K.map(te=>({address:te,capabilities:{}})):K,chainId:ne}}catch(U){throw/(user rejected|connection request reset)/i.test(U==null?void 0:U.message)?new ao(U):U}},async disconnect(){const k=await this.getProvider();try{await(k==null?void 0:k.disconnect())}catch(R){if(!/No matching key/i.test(R.message))throw R}finally{p&&(k==null||k.removeListener("chainChanged",p),p=void 0),E&&(k==null||k.removeListener("disconnect",E),E=void 0),r||(r=this.onConnect.bind(this),k==null||k.on("connect",r)),u&&(k==null||k.removeListener("accountsChanged",u),u=void 0),w&&(k==null||k.removeListener("session_delete",w),w=void 0),this.setRequestedChainsIds([])}},async getAccounts(){return(await this.getProvider()).accounts.map(R=>wl(R))},async getProvider({chainId:k}={}){var D;async function R(){const O=T.chains.map(U=>U.id);if(!O.length)return;const{EthereumProvider:F}=await hr(async()=>{const{EthereumProvider:U}=await import("./index.es-DcCOHnkq.js").then(X=>X.W);return{EthereumProvider:U}},__vite__mapDeps([6,5,1]));return await F.init({...t,disableProviderPing:!0,optionalChains:O,projectId:t.projectId,rpcMap:Object.fromEntries(T.chains.map(U=>{const[X]=O9({chain:U,transports:T.transports});return[U.id,X]})),showQrModal:t.showQrModal??!0})}return n||(s||(s=R()),n=await s,n==null||n.events.setMaxListeners(Number.POSITIVE_INFINITY)),k&&await((D=this.switchChain)==null?void 0:D.call(this,{chainId:k})),n},async getChainId(){return(await this.getProvider()).chainId},async isAuthorized(){try{const[k,R]=await Promise.all([this.getAccounts(),this.getProvider()]);return k.length?await this.isChainsStale()&&R.session?(await R.disconnect().catch(()=>{}),!1):!0:!1}catch{return!1}},async switchChain({addEthereumChainParameter:k,chainId:R}){var F,U,X;const D=await this.getProvider();if(!D)throw new td;const O=T.chains.find(W=>W.id===R);if(!O)throw new ld(new V0);try{await Promise.all([new Promise(K=>{const ne=({chainId:te})=>{te===R&&(T.emitter.off("change",ne),K())};T.emitter.on("change",ne)}),D.request({method:"wallet_switchEthereumChain",params:[{chainId:lr(R)}]})]);const W=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...W,R]),O}catch(W){const K=W;if(/(user rejected)/i.test(K.message))throw new ao(K);try{let ne;k!=null&&k.blockExplorerUrls?ne=k.blockExplorerUrls:ne=(F=O.blockExplorers)!=null&&F.default.url?[(U=O.blockExplorers)==null?void 0:U.default.url]:[];let te;(X=k==null?void 0:k.rpcUrls)!=null&&X.length?te=k.rpcUrls:te=[...O.rpcUrls.default.http];const re={blockExplorerUrls:ne,chainId:lr(R),chainName:(k==null?void 0:k.chainName)??O.name,iconUrls:k==null?void 0:k.iconUrls,nativeCurrency:(k==null?void 0:k.nativeCurrency)??O.nativeCurrency,rpcUrls:te};await D.request({method:"wallet_addEthereumChain",params:[re]});const xe=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...xe,R]),O}catch(ne){throw new ao(ne)}}},onAccountsChanged(k){k.length===0?this.onDisconnect():T.emitter.emit("change",{accounts:k.map(R=>wl(R))})},onChainChanged(k){const R=Number(k);T.emitter.emit("change",{chainId:R})},async onConnect(k){const R=Number(k.chainId),D=await this.getAccounts();T.emitter.emit("connect",{accounts:D,chainId:R})},async onDisconnect(k){this.setRequestedChainsIds([]),T.emitter.emit("disconnect");const R=await this.getProvider();u&&(R.removeListener("accountsChanged",u),u=void 0),p&&(R.removeListener("chainChanged",p),p=void 0),E&&(R.removeListener("disconnect",E),E=void 0),w&&(R.removeListener("session_delete",w),w=void 0),r||(r=this.onConnect.bind(this),R.on("connect",r))},onDisplayUri(k){T.emitter.emit("message",{type:"display_uri",data:k})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){var R,D,O;return n?((O=(D=(R=n.session)==null?void 0:R.namespaces[l])==null?void 0:D.accounts)==null?void 0:O.map(F=>Number.parseInt(F.split(":")[1]||"",10)))??[]:[]},async getRequestedChainsIds(){var k;return await((k=T.storage)==null?void 0:k.getItem(this.requestedChainsStorageKey))??[]},async isChainsStale(){if(!e)return!1;const k=T.chains.map(O=>O.id),R=this.getNamespaceChainsIds();if(R.length&&!R.some(O=>k.includes(O)))return!1;const D=await this.getRequestedChainsIds();return!k.every(O=>D.includes(O))},async setRequestedChainsIds(k){var R;await((R=T.storage)==null?void 0:R.setItem(this.requestedChainsStorageKey,k))},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}})}var _E={},_ce=768,H_=fae({conditions:{defaultCondition:"smallScreen",conditionNames:["smallScreen","largeScreen"],responsiveArray:void 0}}),cH=lV({conditions:{defaultCondition:"smallScreen",conditionNames:["smallScreen","largeScreen"],responsiveArray:void 0}}),Lk=_ae({conditions:{defaultCondition:"base",conditionNames:["base","hover","active"],responsiveArray:void 0},styles:{background:{values:{accentColor:{conditions:{base:"ju367v9i",hover:"ju367v9j",active:"ju367v9k"},defaultClass:"ju367v9i"},accentColorForeground:{conditions:{base:"ju367v9l",hover:"ju367v9m",active:"ju367v9n"},defaultClass:"ju367v9l"},actionButtonBorder:{conditions:{base:"ju367v9o",hover:"ju367v9p",active:"ju367v9q"},defaultClass:"ju367v9o"},actionButtonBorderMobile:{conditions:{base:"ju367v9r",hover:"ju367v9s",active:"ju367v9t"},defaultClass:"ju367v9r"},actionButtonSecondaryBackground:{conditions:{base:"ju367v9u",hover:"ju367v9v",active:"ju367v9w"},defaultClass:"ju367v9u"},closeButton:{conditions:{base:"ju367v9x",hover:"ju367v9y",active:"ju367v9z"},defaultClass:"ju367v9x"},closeButtonBackground:{conditions:{base:"ju367va0",hover:"ju367va1",active:"ju367va2"},defaultClass:"ju367va0"},connectButtonBackground:{conditions:{base:"ju367va3",hover:"ju367va4",active:"ju367va5"},defaultClass:"ju367va3"},connectButtonBackgroundError:{conditions:{base:"ju367va6",hover:"ju367va7",active:"ju367va8"},defaultClass:"ju367va6"},connectButtonInnerBackground:{conditions:{base:"ju367va9",hover:"ju367vaa",active:"ju367vab"},defaultClass:"ju367va9"},connectButtonText:{conditions:{base:"ju367vac",hover:"ju367vad",active:"ju367vae"},defaultClass:"ju367vac"},connectButtonTextError:{conditions:{base:"ju367vaf",hover:"ju367vag",active:"ju367vah"},defaultClass:"ju367vaf"},connectionIndicator:{conditions:{base:"ju367vai",hover:"ju367vaj",active:"ju367vak"},defaultClass:"ju367vai"},downloadBottomCardBackground:{conditions:{base:"ju367val",hover:"ju367vam",active:"ju367van"},defaultClass:"ju367val"},downloadTopCardBackground:{conditions:{base:"ju367vao",hover:"ju367vap",active:"ju367vaq"},defaultClass:"ju367vao"},error:{conditions:{base:"ju367var",hover:"ju367vas",active:"ju367vat"},defaultClass:"ju367var"},generalBorder:{conditions:{base:"ju367vau",hover:"ju367vav",active:"ju367vaw"},defaultClass:"ju367vau"},generalBorderDim:{conditions:{base:"ju367vax",hover:"ju367vay",active:"ju367vaz"},defaultClass:"ju367vax"},menuItemBackground:{conditions:{base:"ju367vb0",hover:"ju367vb1",active:"ju367vb2"},defaultClass:"ju367vb0"},modalBackdrop:{conditions:{base:"ju367vb3",hover:"ju367vb4",active:"ju367vb5"},defaultClass:"ju367vb3"},modalBackground:{conditions:{base:"ju367vb6",hover:"ju367vb7",active:"ju367vb8"},defaultClass:"ju367vb6"},modalBorder:{conditions:{base:"ju367vb9",hover:"ju367vba",active:"ju367vbb"},defaultClass:"ju367vb9"},modalText:{conditions:{base:"ju367vbc",hover:"ju367vbd",active:"ju367vbe"},defaultClass:"ju367vbc"},modalTextDim:{conditions:{base:"ju367vbf",hover:"ju367vbg",active:"ju367vbh"},defaultClass:"ju367vbf"},modalTextSecondary:{conditions:{base:"ju367vbi",hover:"ju367vbj",active:"ju367vbk"},defaultClass:"ju367vbi"},profileAction:{conditions:{base:"ju367vbl",hover:"ju367vbm",active:"ju367vbn"},defaultClass:"ju367vbl"},profileActionHover:{conditions:{base:"ju367vbo",hover:"ju367vbp",active:"ju367vbq"},defaultClass:"ju367vbo"},profileForeground:{conditions:{base:"ju367vbr",hover:"ju367vbs",active:"ju367vbt"},defaultClass:"ju367vbr"},selectedOptionBorder:{conditions:{base:"ju367vbu",hover:"ju367vbv",active:"ju367vbw"},defaultClass:"ju367vbu"},standby:{conditions:{base:"ju367vbx",hover:"ju367vby",active:"ju367vbz"},defaultClass:"ju367vbx"}}},borderColor:{values:{accentColor:{conditions:{base:"ju367vc0",hover:"ju367vc1",active:"ju367vc2"},defaultClass:"ju367vc0"},accentColorForeground:{conditions:{base:"ju367vc3",hover:"ju367vc4",active:"ju367vc5"},defaultClass:"ju367vc3"},actionButtonBorder:{conditions:{base:"ju367vc6",hover:"ju367vc7",active:"ju367vc8"},defaultClass:"ju367vc6"},actionButtonBorderMobile:{conditions:{base:"ju367vc9",hover:"ju367vca",active:"ju367vcb"},defaultClass:"ju367vc9"},actionButtonSecondaryBackground:{conditions:{base:"ju367vcc",hover:"ju367vcd",active:"ju367vce"},defaultClass:"ju367vcc"},closeButton:{conditions:{base:"ju367vcf",hover:"ju367vcg",active:"ju367vch"},defaultClass:"ju367vcf"},closeButtonBackground:{conditions:{base:"ju367vci",hover:"ju367vcj",active:"ju367vck"},defaultClass:"ju367vci"},connectButtonBackground:{conditions:{base:"ju367vcl",hover:"ju367vcm",active:"ju367vcn"},defaultClass:"ju367vcl"},connectButtonBackgroundError:{conditions:{base:"ju367vco",hover:"ju367vcp",active:"ju367vcq"},defaultClass:"ju367vco"},connectButtonInnerBackground:{conditions:{base:"ju367vcr",hover:"ju367vcs",active:"ju367vct"},defaultClass:"ju367vcr"},connectButtonText:{conditions:{base:"ju367vcu",hover:"ju367vcv",active:"ju367vcw"},defaultClass:"ju367vcu"},connectButtonTextError:{conditions:{base:"ju367vcx",hover:"ju367vcy",active:"ju367vcz"},defaultClass:"ju367vcx"},connectionIndicator:{conditions:{base:"ju367vd0",hover:"ju367vd1",active:"ju367vd2"},defaultClass:"ju367vd0"},downloadBottomCardBackground:{conditions:{base:"ju367vd3",hover:"ju367vd4",active:"ju367vd5"},defaultClass:"ju367vd3"},downloadTopCardBackground:{conditions:{base:"ju367vd6",hover:"ju367vd7",active:"ju367vd8"},defaultClass:"ju367vd6"},error:{conditions:{base:"ju367vd9",hover:"ju367vda",active:"ju367vdb"},defaultClass:"ju367vd9"},generalBorder:{conditions:{base:"ju367vdc",hover:"ju367vdd",active:"ju367vde"},defaultClass:"ju367vdc"},generalBorderDim:{conditions:{base:"ju367vdf",hover:"ju367vdg",active:"ju367vdh"},defaultClass:"ju367vdf"},menuItemBackground:{conditions:{base:"ju367vdi",hover:"ju367vdj",active:"ju367vdk"},defaultClass:"ju367vdi"},modalBackdrop:{conditions:{base:"ju367vdl",hover:"ju367vdm",active:"ju367vdn"},defaultClass:"ju367vdl"},modalBackground:{conditions:{base:"ju367vdo",hover:"ju367vdp",active:"ju367vdq"},defaultClass:"ju367vdo"},modalBorder:{conditions:{base:"ju367vdr",hover:"ju367vds",active:"ju367vdt"},defaultClass:"ju367vdr"},modalText:{conditions:{base:"ju367vdu",hover:"ju367vdv",active:"ju367vdw"},defaultClass:"ju367vdu"},modalTextDim:{conditions:{base:"ju367vdx",hover:"ju367vdy",active:"ju367vdz"},defaultClass:"ju367vdx"},modalTextSecondary:{conditions:{base:"ju367ve0",hover:"ju367ve1",active:"ju367ve2"},defaultClass:"ju367ve0"},profileAction:{conditions:{base:"ju367ve3",hover:"ju367ve4",active:"ju367ve5"},defaultClass:"ju367ve3"},profileActionHover:{conditions:{base:"ju367ve6",hover:"ju367ve7",active:"ju367ve8"},defaultClass:"ju367ve6"},profileForeground:{conditions:{base:"ju367ve9",hover:"ju367vea",active:"ju367veb"},defaultClass:"ju367ve9"},selectedOptionBorder:{conditions:{base:"ju367vec",hover:"ju367ved",active:"ju367vee"},defaultClass:"ju367vec"},standby:{conditions:{base:"ju367vef",hover:"ju367veg",active:"ju367veh"},defaultClass:"ju367vef"}}},boxShadow:{values:{connectButton:{conditions:{base:"ju367vei",hover:"ju367vej",active:"ju367vek"},defaultClass:"ju367vei"},dialog:{conditions:{base:"ju367vel",hover:"ju367vem",active:"ju367ven"},defaultClass:"ju367vel"},profileDetailsAction:{conditions:{base:"ju367veo",hover:"ju367vep",active:"ju367veq"},defaultClass:"ju367veo"},selectedOption:{conditions:{base:"ju367ver",hover:"ju367ves",active:"ju367vet"},defaultClass:"ju367ver"},selectedWallet:{conditions:{base:"ju367veu",hover:"ju367vev",active:"ju367vew"},defaultClass:"ju367veu"},walletLogo:{conditions:{base:"ju367vex",hover:"ju367vey",active:"ju367vez"},defaultClass:"ju367vex"}}},color:{values:{accentColor:{conditions:{base:"ju367vf0",hover:"ju367vf1",active:"ju367vf2"},defaultClass:"ju367vf0"},accentColorForeground:{conditions:{base:"ju367vf3",hover:"ju367vf4",active:"ju367vf5"},defaultClass:"ju367vf3"},actionButtonBorder:{conditions:{base:"ju367vf6",hover:"ju367vf7",active:"ju367vf8"},defaultClass:"ju367vf6"},actionButtonBorderMobile:{conditions:{base:"ju367vf9",hover:"ju367vfa",active:"ju367vfb"},defaultClass:"ju367vf9"},actionButtonSecondaryBackground:{conditions:{base:"ju367vfc",hover:"ju367vfd",active:"ju367vfe"},defaultClass:"ju367vfc"},closeButton:{conditions:{base:"ju367vff",hover:"ju367vfg",active:"ju367vfh"},defaultClass:"ju367vff"},closeButtonBackground:{conditions:{base:"ju367vfi",hover:"ju367vfj",active:"ju367vfk"},defaultClass:"ju367vfi"},connectButtonBackground:{conditions:{base:"ju367vfl",hover:"ju367vfm",active:"ju367vfn"},defaultClass:"ju367vfl"},connectButtonBackgroundError:{conditions:{base:"ju367vfo",hover:"ju367vfp",active:"ju367vfq"},defaultClass:"ju367vfo"},connectButtonInnerBackground:{conditions:{base:"ju367vfr",hover:"ju367vfs",active:"ju367vft"},defaultClass:"ju367vfr"},connectButtonText:{conditions:{base:"ju367vfu",hover:"ju367vfv",active:"ju367vfw"},defaultClass:"ju367vfu"},connectButtonTextError:{conditions:{base:"ju367vfx",hover:"ju367vfy",active:"ju367vfz"},defaultClass:"ju367vfx"},connectionIndicator:{conditions:{base:"ju367vg0",hover:"ju367vg1",active:"ju367vg2"},defaultClass:"ju367vg0"},downloadBottomCardBackground:{conditions:{base:"ju367vg3",hover:"ju367vg4",active:"ju367vg5"},defaultClass:"ju367vg3"},downloadTopCardBackground:{conditions:{base:"ju367vg6",hover:"ju367vg7",active:"ju367vg8"},defaultClass:"ju367vg6"},error:{conditions:{base:"ju367vg9",hover:"ju367vga",active:"ju367vgb"},defaultClass:"ju367vg9"},generalBorder:{conditions:{base:"ju367vgc",hover:"ju367vgd",active:"ju367vge"},defaultClass:"ju367vgc"},generalBorderDim:{conditions:{base:"ju367vgf",hover:"ju367vgg",active:"ju367vgh"},defaultClass:"ju367vgf"},menuItemBackground:{conditions:{base:"ju367vgi",hover:"ju367vgj",active:"ju367vgk"},defaultClass:"ju367vgi"},modalBackdrop:{conditions:{base:"ju367vgl",hover:"ju367vgm",active:"ju367vgn"},defaultClass:"ju367vgl"},modalBackground:{conditions:{base:"ju367vgo",hover:"ju367vgp",active:"ju367vgq"},defaultClass:"ju367vgo"},modalBorder:{conditions:{base:"ju367vgr",hover:"ju367vgs",active:"ju367vgt"},defaultClass:"ju367vgr"},modalText:{conditions:{base:"ju367vgu",hover:"ju367vgv",active:"ju367vgw"},defaultClass:"ju367vgu"},modalTextDim:{conditions:{base:"ju367vgx",hover:"ju367vgy",active:"ju367vgz"},defaultClass:"ju367vgx"},modalTextSecondary:{conditions:{base:"ju367vh0",hover:"ju367vh1",active:"ju367vh2"},defaultClass:"ju367vh0"},profileAction:{conditions:{base:"ju367vh3",hover:"ju367vh4",active:"ju367vh5"},defaultClass:"ju367vh3"},profileActionHover:{conditions:{base:"ju367vh6",hover:"ju367vh7",active:"ju367vh8"},defaultClass:"ju367vh6"},profileForeground:{conditions:{base:"ju367vh9",hover:"ju367vha",active:"ju367vhb"},defaultClass:"ju367vh9"},selectedOptionBorder:{conditions:{base:"ju367vhc",hover:"ju367vhd",active:"ju367vhe"},defaultClass:"ju367vhc"},standby:{conditions:{base:"ju367vhf",hover:"ju367vhg",active:"ju367vhh"},defaultClass:"ju367vhf"}}}}},{conditions:{defaultCondition:"smallScreen",conditionNames:["smallScreen","largeScreen"],responsiveArray:void 0},styles:{alignItems:{values:{"flex-start":{conditions:{smallScreen:"ju367v0",largeScreen:"ju367v1"},defaultClass:"ju367v0"},"flex-end":{conditions:{smallScreen:"ju367v2",largeScreen:"ju367v3"},defaultClass:"ju367v2"},center:{conditions:{smallScreen:"ju367v4",largeScreen:"ju367v5"},defaultClass:"ju367v4"}}},display:{values:{none:{conditions:{smallScreen:"ju367v6",largeScreen:"ju367v7"},defaultClass:"ju367v6"},block:{conditions:{smallScreen:"ju367v8",largeScreen:"ju367v9"},defaultClass:"ju367v8"},flex:{conditions:{smallScreen:"ju367va",largeScreen:"ju367vb"},defaultClass:"ju367va"},inline:{conditions:{smallScreen:"ju367vc",largeScreen:"ju367vd"},defaultClass:"ju367vc"}}}}},{conditions:void 0,styles:{margin:{mappings:["marginTop","marginBottom","marginLeft","marginRight"]},marginX:{mappings:["marginLeft","marginRight"]},marginY:{mappings:["marginTop","marginBottom"]},padding:{mappings:["paddingTop","paddingBottom","paddingLeft","paddingRight"]},paddingX:{mappings:["paddingLeft","paddingRight"]},paddingY:{mappings:["paddingTop","paddingBottom"]},alignSelf:{values:{"flex-start":{defaultClass:"ju367ve"},"flex-end":{defaultClass:"ju367vf"},center:{defaultClass:"ju367vg"}}},backgroundSize:{values:{cover:{defaultClass:"ju367vh"}}},borderRadius:{values:{1:{defaultClass:"ju367vi"},6:{defaultClass:"ju367vj"},10:{defaultClass:"ju367vk"},13:{defaultClass:"ju367vl"},actionButton:{defaultClass:"ju367vm"},connectButton:{defaultClass:"ju367vn"},menuButton:{defaultClass:"ju367vo"},modal:{defaultClass:"ju367vp"},modalMobile:{defaultClass:"ju367vq"},"25%":{defaultClass:"ju367vr"},full:{defaultClass:"ju367vs"}}},borderStyle:{values:{solid:{defaultClass:"ju367vt"}}},borderWidth:{values:{0:{defaultClass:"ju367vu"},1:{defaultClass:"ju367vv"},2:{defaultClass:"ju367vw"},4:{defaultClass:"ju367vx"}}},cursor:{values:{pointer:{defaultClass:"ju367vy"},none:{defaultClass:"ju367vz"}}},pointerEvents:{values:{none:{defaultClass:"ju367v10"},all:{defaultClass:"ju367v11"}}},minHeight:{values:{8:{defaultClass:"ju367v12"},44:{defaultClass:"ju367v13"}}},flexDirection:{values:{row:{defaultClass:"ju367v14"},column:{defaultClass:"ju367v15"}}},fontFamily:{values:{body:{defaultClass:"ju367v16"}}},fontSize:{values:{12:{defaultClass:"ju367v17"},13:{defaultClass:"ju367v18"},14:{defaultClass:"ju367v19"},16:{defaultClass:"ju367v1a"},18:{defaultClass:"ju367v1b"},20:{defaultClass:"ju367v1c"},23:{defaultClass:"ju367v1d"}}},fontWeight:{values:{regular:{defaultClass:"ju367v1e"},medium:{defaultClass:"ju367v1f"},semibold:{defaultClass:"ju367v1g"},bold:{defaultClass:"ju367v1h"},heavy:{defaultClass:"ju367v1i"}}},gap:{values:{0:{defaultClass:"ju367v1j"},1:{defaultClass:"ju367v1k"},2:{defaultClass:"ju367v1l"},3:{defaultClass:"ju367v1m"},4:{defaultClass:"ju367v1n"},5:{defaultClass:"ju367v1o"},6:{defaultClass:"ju367v1p"},8:{defaultClass:"ju367v1q"},10:{defaultClass:"ju367v1r"},12:{defaultClass:"ju367v1s"},14:{defaultClass:"ju367v1t"},16:{defaultClass:"ju367v1u"},18:{defaultClass:"ju367v1v"},20:{defaultClass:"ju367v1w"},24:{defaultClass:"ju367v1x"},28:{defaultClass:"ju367v1y"},32:{defaultClass:"ju367v1z"},36:{defaultClass:"ju367v20"},44:{defaultClass:"ju367v21"},64:{defaultClass:"ju367v22"},"-1":{defaultClass:"ju367v23"}}},height:{values:{1:{defaultClass:"ju367v24"},2:{defaultClass:"ju367v25"},4:{defaultClass:"ju367v26"},8:{defaultClass:"ju367v27"},12:{defaultClass:"ju367v28"},20:{defaultClass:"ju367v29"},24:{defaultClass:"ju367v2a"},28:{defaultClass:"ju367v2b"},30:{defaultClass:"ju367v2c"},32:{defaultClass:"ju367v2d"},34:{defaultClass:"ju367v2e"},36:{defaultClass:"ju367v2f"},40:{defaultClass:"ju367v2g"},44:{defaultClass:"ju367v2h"},48:{defaultClass:"ju367v2i"},54:{defaultClass:"ju367v2j"},60:{defaultClass:"ju367v2k"},200:{defaultClass:"ju367v2l"},full:{defaultClass:"ju367v2m"},max:{defaultClass:"ju367v2n"}}},justifyContent:{values:{"flex-start":{defaultClass:"ju367v2o"},"flex-end":{defaultClass:"ju367v2p"},center:{defaultClass:"ju367v2q"},"space-between":{defaultClass:"ju367v2r"},"space-around":{defaultClass:"ju367v2s"}}},textAlign:{values:{left:{defaultClass:"ju367v2t"},center:{defaultClass:"ju367v2u"},inherit:{defaultClass:"ju367v2v"}}},marginBottom:{values:{0:{defaultClass:"ju367v2w"},1:{defaultClass:"ju367v2x"},2:{defaultClass:"ju367v2y"},3:{defaultClass:"ju367v2z"},4:{defaultClass:"ju367v30"},5:{defaultClass:"ju367v31"},6:{defaultClass:"ju367v32"},8:{defaultClass:"ju367v33"},10:{defaultClass:"ju367v34"},12:{defaultClass:"ju367v35"},14:{defaultClass:"ju367v36"},16:{defaultClass:"ju367v37"},18:{defaultClass:"ju367v38"},20:{defaultClass:"ju367v39"},24:{defaultClass:"ju367v3a"},28:{defaultClass:"ju367v3b"},32:{defaultClass:"ju367v3c"},36:{defaultClass:"ju367v3d"},44:{defaultClass:"ju367v3e"},64:{defaultClass:"ju367v3f"},"-1":{defaultClass:"ju367v3g"}}},marginLeft:{values:{0:{defaultClass:"ju367v3h"},1:{defaultClass:"ju367v3i"},2:{defaultClass:"ju367v3j"},3:{defaultClass:"ju367v3k"},4:{defaultClass:"ju367v3l"},5:{defaultClass:"ju367v3m"},6:{defaultClass:"ju367v3n"},8:{defaultClass:"ju367v3o"},10:{defaultClass:"ju367v3p"},12:{defaultClass:"ju367v3q"},14:{defaultClass:"ju367v3r"},16:{defaultClass:"ju367v3s"},18:{defaultClass:"ju367v3t"},20:{defaultClass:"ju367v3u"},24:{defaultClass:"ju367v3v"},28:{defaultClass:"ju367v3w"},32:{defaultClass:"ju367v3x"},36:{defaultClass:"ju367v3y"},44:{defaultClass:"ju367v3z"},64:{defaultClass:"ju367v40"},"-1":{defaultClass:"ju367v41"}}},marginRight:{values:{0:{defaultClass:"ju367v42"},1:{defaultClass:"ju367v43"},2:{defaultClass:"ju367v44"},3:{defaultClass:"ju367v45"},4:{defaultClass:"ju367v46"},5:{defaultClass:"ju367v47"},6:{defaultClass:"ju367v48"},8:{defaultClass:"ju367v49"},10:{defaultClass:"ju367v4a"},12:{defaultClass:"ju367v4b"},14:{defaultClass:"ju367v4c"},16:{defaultClass:"ju367v4d"},18:{defaultClass:"ju367v4e"},20:{defaultClass:"ju367v4f"},24:{defaultClass:"ju367v4g"},28:{defaultClass:"ju367v4h"},32:{defaultClass:"ju367v4i"},36:{defaultClass:"ju367v4j"},44:{defaultClass:"ju367v4k"},64:{defaultClass:"ju367v4l"},"-1":{defaultClass:"ju367v4m"}}},marginTop:{values:{0:{defaultClass:"ju367v4n"},1:{defaultClass:"ju367v4o"},2:{defaultClass:"ju367v4p"},3:{defaultClass:"ju367v4q"},4:{defaultClass:"ju367v4r"},5:{defaultClass:"ju367v4s"},6:{defaultClass:"ju367v4t"},8:{defaultClass:"ju367v4u"},10:{defaultClass:"ju367v4v"},12:{defaultClass:"ju367v4w"},14:{defaultClass:"ju367v4x"},16:{defaultClass:"ju367v4y"},18:{defaultClass:"ju367v4z"},20:{defaultClass:"ju367v50"},24:{defaultClass:"ju367v51"},28:{defaultClass:"ju367v52"},32:{defaultClass:"ju367v53"},36:{defaultClass:"ju367v54"},44:{defaultClass:"ju367v55"},64:{defaultClass:"ju367v56"},"-1":{defaultClass:"ju367v57"}}},maxWidth:{values:{1:{defaultClass:"ju367v58"},2:{defaultClass:"ju367v59"},4:{defaultClass:"ju367v5a"},8:{defaultClass:"ju367v5b"},12:{defaultClass:"ju367v5c"},20:{defaultClass:"ju367v5d"},24:{defaultClass:"ju367v5e"},28:{defaultClass:"ju367v5f"},30:{defaultClass:"ju367v5g"},32:{defaultClass:"ju367v5h"},34:{defaultClass:"ju367v5i"},36:{defaultClass:"ju367v5j"},40:{defaultClass:"ju367v5k"},44:{defaultClass:"ju367v5l"},48:{defaultClass:"ju367v5m"},54:{defaultClass:"ju367v5n"},60:{defaultClass:"ju367v5o"},200:{defaultClass:"ju367v5p"},full:{defaultClass:"ju367v5q"},max:{defaultClass:"ju367v5r"}}},minWidth:{values:{1:{defaultClass:"ju367v5s"},2:{defaultClass:"ju367v5t"},4:{defaultClass:"ju367v5u"},8:{defaultClass:"ju367v5v"},12:{defaultClass:"ju367v5w"},20:{defaultClass:"ju367v5x"},24:{defaultClass:"ju367v5y"},28:{defaultClass:"ju367v5z"},30:{defaultClass:"ju367v60"},32:{defaultClass:"ju367v61"},34:{defaultClass:"ju367v62"},36:{defaultClass:"ju367v63"},40:{defaultClass:"ju367v64"},44:{defaultClass:"ju367v65"},48:{defaultClass:"ju367v66"},54:{defaultClass:"ju367v67"},60:{defaultClass:"ju367v68"},200:{defaultClass:"ju367v69"},full:{defaultClass:"ju367v6a"},max:{defaultClass:"ju367v6b"}}},overflow:{values:{hidden:{defaultClass:"ju367v6c"}}},paddingBottom:{values:{0:{defaultClass:"ju367v6d"},1:{defaultClass:"ju367v6e"},2:{defaultClass:"ju367v6f"},3:{defaultClass:"ju367v6g"},4:{defaultClass:"ju367v6h"},5:{defaultClass:"ju367v6i"},6:{defaultClass:"ju367v6j"},8:{defaultClass:"ju367v6k"},10:{defaultClass:"ju367v6l"},12:{defaultClass:"ju367v6m"},14:{defaultClass:"ju367v6n"},16:{defaultClass:"ju367v6o"},18:{defaultClass:"ju367v6p"},20:{defaultClass:"ju367v6q"},24:{defaultClass:"ju367v6r"},28:{defaultClass:"ju367v6s"},32:{defaultClass:"ju367v6t"},36:{defaultClass:"ju367v6u"},44:{defaultClass:"ju367v6v"},64:{defaultClass:"ju367v6w"},"-1":{defaultClass:"ju367v6x"}}},paddingLeft:{values:{0:{defaultClass:"ju367v6y"},1:{defaultClass:"ju367v6z"},2:{defaultClass:"ju367v70"},3:{defaultClass:"ju367v71"},4:{defaultClass:"ju367v72"},5:{defaultClass:"ju367v73"},6:{defaultClass:"ju367v74"},8:{defaultClass:"ju367v75"},10:{defaultClass:"ju367v76"},12:{defaultClass:"ju367v77"},14:{defaultClass:"ju367v78"},16:{defaultClass:"ju367v79"},18:{defaultClass:"ju367v7a"},20:{defaultClass:"ju367v7b"},24:{defaultClass:"ju367v7c"},28:{defaultClass:"ju367v7d"},32:{defaultClass:"ju367v7e"},36:{defaultClass:"ju367v7f"},44:{defaultClass:"ju367v7g"},64:{defaultClass:"ju367v7h"},"-1":{defaultClass:"ju367v7i"}}},paddingRight:{values:{0:{defaultClass:"ju367v7j"},1:{defaultClass:"ju367v7k"},2:{defaultClass:"ju367v7l"},3:{defaultClass:"ju367v7m"},4:{defaultClass:"ju367v7n"},5:{defaultClass:"ju367v7o"},6:{defaultClass:"ju367v7p"},8:{defaultClass:"ju367v7q"},10:{defaultClass:"ju367v7r"},12:{defaultClass:"ju367v7s"},14:{defaultClass:"ju367v7t"},16:{defaultClass:"ju367v7u"},18:{defaultClass:"ju367v7v"},20:{defaultClass:"ju367v7w"},24:{defaultClass:"ju367v7x"},28:{defaultClass:"ju367v7y"},32:{defaultClass:"ju367v7z"},36:{defaultClass:"ju367v80"},44:{defaultClass:"ju367v81"},64:{defaultClass:"ju367v82"},"-1":{defaultClass:"ju367v83"}}},paddingTop:{values:{0:{defaultClass:"ju367v84"},1:{defaultClass:"ju367v85"},2:{defaultClass:"ju367v86"},3:{defaultClass:"ju367v87"},4:{defaultClass:"ju367v88"},5:{defaultClass:"ju367v89"},6:{defaultClass:"ju367v8a"},8:{defaultClass:"ju367v8b"},10:{defaultClass:"ju367v8c"},12:{defaultClass:"ju367v8d"},14:{defaultClass:"ju367v8e"},16:{defaultClass:"ju367v8f"},18:{defaultClass:"ju367v8g"},20:{defaultClass:"ju367v8h"},24:{defaultClass:"ju367v8i"},28:{defaultClass:"ju367v8j"},32:{defaultClass:"ju367v8k"},36:{defaultClass:"ju367v8l"},44:{defaultClass:"ju367v8m"},64:{defaultClass:"ju367v8n"},"-1":{defaultClass:"ju367v8o"}}},position:{values:{absolute:{defaultClass:"ju367v8p"},fixed:{defaultClass:"ju367v8q"},relative:{defaultClass:"ju367v8r"}}},WebkitUserSelect:{values:{none:{defaultClass:"ju367v8s"}}},right:{values:{0:{defaultClass:"ju367v8t"}}},transition:{values:{default:{defaultClass:"ju367v8u"},transform:{defaultClass:"ju367v8v"}}},userSelect:{values:{none:{defaultClass:"ju367v8w"}}},width:{values:{1:{defaultClass:"ju367v8x"},2:{defaultClass:"ju367v8y"},4:{defaultClass:"ju367v8z"},8:{defaultClass:"ju367v90"},12:{defaultClass:"ju367v91"},20:{defaultClass:"ju367v92"},24:{defaultClass:"ju367v93"},28:{defaultClass:"ju367v94"},30:{defaultClass:"ju367v95"},32:{defaultClass:"ju367v96"},34:{defaultClass:"ju367v97"},36:{defaultClass:"ju367v98"},40:{defaultClass:"ju367v99"},44:{defaultClass:"ju367v9a"},48:{defaultClass:"ju367v9b"},54:{defaultClass:"ju367v9c"},60:{defaultClass:"ju367v9d"},200:{defaultClass:"ju367v9e"},full:{defaultClass:"ju367v9f"},max:{defaultClass:"ju367v9g"}}},backdropFilter:{values:{modalOverlay:{defaultClass:"ju367v9h"}}}}}),VO={colors:{accentColor:"var(--rk-colors-accentColor)",accentColorForeground:"var(--rk-colors-accentColorForeground)",actionButtonBorder:"var(--rk-colors-actionButtonBorder)",actionButtonBorderMobile:"var(--rk-colors-actionButtonBorderMobile)",actionButtonSecondaryBackground:"var(--rk-colors-actionButtonSecondaryBackground)",closeButton:"var(--rk-colors-closeButton)",closeButtonBackground:"var(--rk-colors-closeButtonBackground)",connectButtonBackground:"var(--rk-colors-connectButtonBackground)",connectButtonBackgroundError:"var(--rk-colors-connectButtonBackgroundError)",connectButtonInnerBackground:"var(--rk-colors-connectButtonInnerBackground)",connectButtonText:"var(--rk-colors-connectButtonText)",connectButtonTextError:"var(--rk-colors-connectButtonTextError)",connectionIndicator:"var(--rk-colors-connectionIndicator)",downloadBottomCardBackground:"var(--rk-colors-downloadBottomCardBackground)",downloadTopCardBackground:"var(--rk-colors-downloadTopCardBackground)",error:"var(--rk-colors-error)",generalBorder:"var(--rk-colors-generalBorder)",generalBorderDim:"var(--rk-colors-generalBorderDim)",menuItemBackground:"var(--rk-colors-menuItemBackground)",modalBackdrop:"var(--rk-colors-modalBackdrop)",modalBackground:"var(--rk-colors-modalBackground)",modalBorder:"var(--rk-colors-modalBorder)",modalText:"var(--rk-colors-modalText)",modalTextDim:"var(--rk-colors-modalTextDim)",modalTextSecondary:"var(--rk-colors-modalTextSecondary)",profileAction:"var(--rk-colors-profileAction)",profileActionHover:"var(--rk-colors-profileActionHover)",profileForeground:"var(--rk-colors-profileForeground)",selectedOptionBorder:"var(--rk-colors-selectedOptionBorder)",standby:"var(--rk-colors-standby)"},fonts:{body:"var(--rk-fonts-body)"},radii:{actionButton:"var(--rk-radii-actionButton)",connectButton:"var(--rk-radii-connectButton)",menuButton:"var(--rk-radii-menuButton)",modal:"var(--rk-radii-modal)",modalMobile:"var(--rk-radii-modalMobile)"},shadows:{connectButton:"var(--rk-shadows-connectButton)",dialog:"var(--rk-shadows-dialog)",profileDetailsAction:"var(--rk-shadows-profileDetailsAction)",selectedOption:"var(--rk-shadows-selectedOption)",selectedWallet:"var(--rk-shadows-selectedWallet)",walletLogo:"var(--rk-shadows-walletLogo)"},blurs:{modalOverlay:"var(--rk-blurs-modalOverlay)"}},vce={shrink:"_12cbo8i6",shrinkSm:"_12cbo8i7"},bce="_12cbo8i3 ju367v8r",wce={grow:"_12cbo8i4",growLg:"_12cbo8i5"};function ja({active:t,hover:e}){return[bce,e&&wce[e],vce[t]]}var uH=he.createContext(null);function Sce(){const{adapter:t}=he.useContext(uH)??{};if(!t)throw new Error("No authentication adapter found");return t}function IA(){const t=he.useContext(uH);return(t==null?void 0:t.status)??null}function AR(){const t=IA(),{isConnected:e}=qc();return e?t&&(t==="loading"||t==="unauthenticated")?t:"connected":"disconnected"}function dH(){return typeof navigator<"u"&&/android/i.test(navigator.userAgent)}function Tce(){return typeof navigator<"u"&&/iPhone|iPod/.test(navigator.userAgent)}function Ece(){return typeof navigator<"u"&&(/iPad/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)}function m2(){return Tce()||Ece()}function Fa(){return dH()||m2()}var Ace="iekbcc0",Cce={a:"iekbcca",blockquote:"iekbcc2",button:"iekbcc9",input:"iekbcc8 iekbcc5 iekbcc4",mark:"iekbcc6",ol:"iekbcc1",q:"iekbcc2",select:"iekbcc7 iekbcc5 iekbcc4",table:"iekbcc3",textarea:"iekbcc5 iekbcc4",ul:"iekbcc1"},Mce=({reset:t,...e})=>{if(!t)return Lk(e);const n=Cce[t],s=Lk(e);return uV(Ace,n,s)},At=fe.forwardRef(({as:t="div",className:e,testId:n,...s},l)=>{const u={},p={};for(const v in s)Lk.properties.has(v)?u[v]=s[v]:p[v]=s[v];const r=Mce({reset:typeof t=="string"?t:"div",...u});return fe.createElement(t,{className:uV(r,e),...p,"data-testid":n?`rk-${n.replace(/^rk-/,"")}`:void 0,ref:l})});At.displayName="Box";var hH=new Map,aM=new Map;async function fH(t){const e=aM.get(t);if(e)return e;const n=async()=>t().then(async l=>(hH.set(t,l),l)),s=n().catch(l=>n().catch(u=>{aM.delete(t)}));return aM.set(t,s),s}async function Sp(...t){return await Promise.all(t.map(e=>typeof e=="function"?fH(e):e))}function kce(){const[,t]=he.useReducer(e=>e+1,0);return t}function PA(t){const e=typeof t=="function"?hH.get(t):void 0,n=kce();return he.useEffect(()=>{typeof t=="function"&&!e&&fH(t).then(n)},[t,e,n]),typeof t=="function"?e:t}function Sl({alt:t,background:e,borderColor:n,borderRadius:s,useAsImage:l,boxShadow:u,height:p,src:r,width:v,testId:w}){const E=m2(),T=PA(r),k=T&&/^http/.test(T),[R,D]=he.useReducer(()=>!0,!1);return fe.createElement(At,{"aria-label":t,borderRadius:s,boxShadow:u,height:typeof p=="string"?p:void 0,overflow:"hidden",position:"relative",role:"img",style:{background:e,height:typeof p=="number"?p:void 0,width:typeof v=="number"?v:void 0},width:typeof v=="string"?v:void 0,testId:w},fe.createElement(At,{...k?{"aria-hidden":!0,as:"img",onLoad:D,src:T}:{"aria-hidden":!0,as:"img",src:T},height:"full",position:"absolute",...E?{WebkitUserSelect:"none"}:{},style:{WebkitTouchCallout:"none",transition:"opacity .15s linear",userSelect:"none",...!l&&k?{opacity:R?1:0}:{}},width:"full"}),n?fe.createElement(At,{...typeof n=="object"&&"custom"in n?{style:{borderColor:n.custom}}:{borderColor:n},borderRadius:s,borderStyle:"solid",borderWidth:"1",height:"full",position:"relative",width:"full"}):null)}var Ice="_1luule42",Pce="_1luule43",Rce=t=>he.useMemo(()=>`${t}_${Math.round(Math.random()*1e9)}`,[t]),Cw=({height:t=21,width:e=21})=>{const n=Rce("spinner");return fe.createElement("svg",{className:Ice,fill:"none",height:t,viewBox:"0 0 21 21",width:e,xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Loading"),fe.createElement("clipPath",{id:n},fe.createElement("path",{d:"M10.5 3C6.35786 3 3 6.35786 3 10.5C3 14.6421 6.35786 18 10.5 18C11.3284 18 12 18.6716 12 19.5C12 20.3284 11.3284 21 10.5 21C4.70101 21 0 16.299 0 10.5C0 4.70101 4.70101 0 10.5 0C16.299 0 21 4.70101 21 10.5C21 11.3284 20.3284 12 19.5 12C18.6716 12 18 11.3284 18 10.5C18 6.35786 14.6421 3 10.5 3Z"})),fe.createElement("foreignObject",{clipPath:`url(#${n})`,height:"21",width:"21",x:"0",y:"0"},fe.createElement("div",{className:Pce})))},Bs=["#FC5C54","#FFD95A","#E95D72","#6A87C8","#5FD0F3","#75C06B","#FFDD86","#5FC6D4","#FF949A","#FF8024","#9BA1A4","#EC66FF","#FF8CBC","#FF9A23","#C5DADB","#A8CE63","#71ABFF","#FFE279","#B6B1B6","#FF6780","#A575FF","#4D82FF","#FFB35A"],HO=[{color:Bs[0],emoji:""},{color:Bs[1],emoji:""},{color:Bs[2],emoji:""},{color:Bs[3],emoji:""},{color:Bs[4],emoji:""},{color:Bs[0],emoji:""},{color:Bs[5],emoji:""},{color:Bs[6],emoji:""},{color:Bs[7],emoji:""},{color:Bs[8],emoji:""},{color:Bs[9],emoji:""},{color:Bs[10],emoji:""},{color:Bs[11],emoji:""},{color:Bs[12],emoji:""},{color:Bs[13],emoji:""},{color:Bs[8],emoji:""},{color:Bs[14],emoji:""},{color:Bs[0],emoji:""},{color:Bs[8],emoji:""},{color:Bs[1],emoji:""},{color:Bs[15],emoji:""},{color:Bs[16],emoji:""},{color:Bs[17],emoji:""},{color:Bs[18],emoji:""},{color:Bs[19],emoji:""},{color:Bs[1],emoji:""},{color:Bs[20],emoji:""},{color:Bs[15],emoji:""},{color:Bs[0],emoji:""},{color:Bs[17],emoji:""},{color:Bs[4],emoji:""},{color:Bs[21],emoji:""},{color:Bs[17],emoji:""},{color:Bs[8],emoji:""},{color:Bs[22],emoji:""}];function Nce(t){let e=0;if(t.length===0)return e;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e|=0}return e}function jce(t){const n=Math.abs(Nce((typeof t=="string"?t:"").toLowerCase())%HO.length);return HO[n??0]}var Dce=({address:t,ensImage:e,size:n})=>{const[s,l]=he.useState(!1);he.useEffect(()=>{if(e){const r=new Image;r.src=e,r.onload=()=>l(!0)}},[e]);const{color:u,emoji:p}=he.useMemo(()=>jce(t),[t]);return e?s?fe.createElement(At,{backgroundSize:"cover",borderRadius:"full",position:"absolute",style:{backgroundImage:`url(${e})`,backgroundPosition:"center",height:n,width:n}}):fe.createElement(At,{alignItems:"center",backgroundSize:"cover",borderRadius:"full",color:"modalText",display:"flex",justifyContent:"center",position:"absolute",style:{height:n,width:n}},fe.createElement(Cw,null)):fe.createElement(At,{alignItems:"center",display:"flex",justifyContent:"center",overflow:"hidden",style:{...!e&&{backgroundColor:u},height:n,width:n}},p)},pH=Dce,mH=he.createContext(pH);function gH({address:t,imageUrl:e,loading:n,size:s}){const l=he.useContext(mH);return fe.createElement(At,{"aria-hidden":!0,borderRadius:"full",overflow:"hidden",position:"relative",style:{height:`${s}px`,width:`${s}px`},userSelect:"none"},fe.createElement(At,{alignItems:"center",borderRadius:"full",display:"flex",justifyContent:"center",overflow:"hidden",position:"absolute",style:{fontSize:`${Math.round(s*.55)}px`,height:`${s}px`,transform:n?"scale(0.72)":void 0,transition:".25s ease",transitionDelay:n?void 0:".1s",width:`${s}px`,willChange:"transform"},userSelect:"none"},fe.createElement(l,{address:t,ensImage:e,size:s})),n&&fe.createElement(At,{color:"accentColor",display:"flex",height:"full",position:"absolute",width:"full"},fe.createElement(Cw,{height:"100%",width:"100%"})))}var GO=()=>fe.createElement("svg",{fill:"none",height:"7",width:"14",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Dropdown"),fe.createElement("path",{d:"M12.75 1.54001L8.51647 5.0038C7.77974 5.60658 6.72026 5.60658 5.98352 5.0038L1.75 1.54001",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",xmlns:"http://www.w3.org/2000/svg"})),$O={defaultLocale:"en",locale:"en"},Lce=class{constructor(t){this.listeners=new Set,this.defaultLocale=$O.defaultLocale,this.enableFallback=!1,this.locale=$O.locale,this.cachedLocales=[],this.translations={};for(const[e,n]of Object.entries(t))this.cachedLocales=[...this.cachedLocales,e],this.translations={...this.translations,...this.flattenTranslation(n,e)}}missingMessage(t){return`[missing: "${this.locale}.${t}" translation]`}flattenTranslation(t,e){const n={},s=(l,u)=>{for(const p of Object.keys(l)){const r=`${u}.${p}`,v=l[p];typeof v=="object"&&v!==null?s(v,r):n[r]=v}};return s(t,e),n}translateWithReplacements(t,e={}){let n=t;for(const s in e){const l=e[s];n=n.replace(`%{${s}}`,l)}return n}t(t,e,n){const s=`${this.locale}.${t}`,l=this.translations[s];if(!l){if(this.enableFallback){const u=`${this.defaultLocale}.${t}`,p=this.translations[u];if(p)return this.translateWithReplacements(p,e)}return n!=null&&n.rawKeyIfTranslationMissing?t:this.missingMessage(t)}return this.translateWithReplacements(l,e)}isLocaleCached(t){return this.cachedLocales.includes(t)}updateLocale(t){this.locale=t,this.notifyListeners()}setTranslations(t,e){this.isLocaleCached(t)||(this.cachedLocales=[...this.cachedLocales,t],this.translations={...this.translations,...this.flattenTranslation(e,t)}),this.locale=t,this.notifyListeners()}notifyListeners(){for(const t of this.listeners)t()}onChange(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}},th=new Lce({en:JSON.parse(Ck),"en-US":JSON.parse(Ck)});th.defaultLocale="en-US";th.locale="en-US";th.enableFallback=!0;var Oce=async t=>{switch(t){case"ar":case"ar-AR":return(await hr(async()=>{const{default:e}=await import("./ar_AR-CTNWGWSS-DlAFo0vZ.js");return{default:e}},[])).default;case"de":case"de-DE":return(await hr(async()=>{const{default:e}=await import("./de_DE-P43L3PR7-pJRS3eyz.js");return{default:e}},[])).default;case"en":case"en-US":return(await hr(async()=>{const{default:e}=await Promise.resolve().then(()=>I8);return{default:e}},void 0)).default;case"es":case"es-419":return(await hr(async()=>{const{default:e}=await import("./es_419-JBX5FS3Q-Bk-MlIq_.js");return{default:e}},[])).default;case"fr":case"fr-FR":return(await hr(async()=>{const{default:e}=await import("./fr_FR-CM2EDAQC-DvlCXiU9.js");return{default:e}},[])).default;case"hi":case"hi-IN":return(await hr(async()=>{const{default:e}=await import("./hi_IN-GYVCUYRD-CQnOa8U_.js");return{default:e}},[])).default;case"id":case"id-ID":return(await hr(async()=>{const{default:e}=await import("./id_ID-7ZWSMOOE-ZzIoBaiI.js");return{default:e}},[])).default;case"ja":case"ja-JP":return(await hr(async()=>{const{default:e}=await import("./ja_JP-CGMP6VLZ-BBxPp4Hq.js");return{default:e}},[])).default;case"ko":case"ko-KR":return(await hr(async()=>{const{default:e}=await import("./ko_KR-YCZDTF7X-4W342j3x.js");return{default:e}},[])).default;case"ms":case"ms-MY":return(await hr(async()=>{const{default:e}=await import("./ms_MY-5LHAYMS7-BUU8UB2I.js");return{default:e}},[])).default;case"pt":case"pt-BR":return(await hr(async()=>{const{default:e}=await import("./pt_BR-3JTS4PSK-Cou37HE0.js");return{default:e}},[])).default;case"ru":case"ru-RU":return(await hr(async()=>{const{default:e}=await import("./ru_RU-6J6XERHI-BEDPqa1p.js");return{default:e}},[])).default;case"th":case"th-TH":return(await hr(async()=>{const{default:e}=await import("./th_TH-STXOD4CR-DmwaGyKS.js");return{default:e}},[])).default;case"tr":case"tr-TR":return(await hr(async()=>{const{default:e}=await import("./tr_TR-P7QAUUZU-DHzPxq5a.js");return{default:e}},[])).default;case"ua":case"uk-UA":return(await hr(async()=>{const{default:e}=await import("./uk_UA-JTTBGJGQ-bEPIKyyu.js");return{default:e}},[])).default;case"vi":case"vi-VN":return(await hr(async()=>{const{default:e}=await import("./vi_VN-5XUUAVWW-DvcbUvCZ.js");return{default:e}},[])).default;case"zh":case"zh-CN":case"zh-Hans":return(await hr(async()=>{const{default:e}=await import("./zh_CN-RGMLPFEP-CPkk4IYh.js");return{default:e}},[])).default;case"zh-HK":return(await hr(async()=>{const{default:e}=await import("./zh_HK-YM3T6EI5-BYHcXtXC.js");return{default:e}},[])).default;case"zh-Hant":case"zh-TW":return(await hr(async()=>{const{default:e}=await import("./zh_TW-HAEH6VE5-r-nym7hs.js");return{default:e}},[])).default;default:return(await hr(async()=>{const{default:e}=await Promise.resolve().then(()=>I8);return{default:e}},void 0)).default}};async function WO(t){if(th.isLocaleCached(t)){th.updateLocale(t);return}const n=await Oce(t);th.setTranslations(t,JSON.parse(n))}var Fce=()=>{var t;if(typeof window<"u"&&typeof navigator<"u"){if((t=navigator.languages)!=null&&t.length)return navigator.languages[0];if(navigator.language)return navigator.language}},Ba=he.createContext({i18n:th}),Bce=({children:t,locale:e})=>{const[n,s]=he.useState(0),l=he.useMemo(()=>Fce(),[]);he.useEffect(()=>th.onChange(()=>{s(r=>r+1)}),[]),he.useEffect(()=>{e&&e!==th.locale?WO(e):!e&&l&&l!==th.locale&&WO(l)},[e,l]);const u=he.useMemo(()=>({t:(r,v)=>th.t(r,v),i18n:th}),[n]);return fe.createElement(Ba.Provider,{value:u},t)};function yH(t){return t!=null}var qO={iconBackground:"#7290CC",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./apechain-SX5YFU6N-q5qBv-mp.js");return{default:t}},[])).default},lM={iconBackground:"#96bedc",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./arbitrum-WURIBY6W-CqVkHBr5.js");return{default:t}},[])).default},XO={iconBackground:"#e84141",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./avalanche-KOMJD3XY-Dsn_JPR4.js");return{default:t}},[])).default},cM={iconBackground:"#0052ff",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./base-OAXLRA4F-CoYTVIiL.js");return{default:t}},[])).default},uM={iconBackground:"#814625",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./berachain-NJECWIVC-DumxnFvf.js");return{default:t}},[])).default},ZO={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./blast-V555OVXZ-BbhJh1tj.js");return{default:t}},[])).default},QO={iconBackground:"#ebac0e",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./bsc-N647EYR2-B2nLKXWV.js");return{default:t}},[])).default},KO={iconBackground:"#FCFF52",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./celo-GEP4TUHG-CenIBYLU.js");return{default:t}},[])).default},YO={iconBackground:"#002D74",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./cronos-HJPAQTAE-BEOvlOC4.js");return{default:t}},[])).default},zce={iconBackground:"#A36EFD",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./degen-FQQ4XGHB-CeHTs88l.js");return{default:t}},[])).default},u0={iconBackground:"#484c50",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./ethereum-RGGVA4PY-SWGOlkuk.js");return{default:t}},[])).default},JO={iconBackground:"transparent",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./flow-5FQJFCTK-CUie2reO.js");return{default:t}},[])).default},Uce={iconBackground:"#04795c",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./gnosis-37ZC4RBL-B137OtHZ.js");return{default:t}},[])).default},eF={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./gravity-J5YQHTYH-Bj6B0uod.js");return{default:t}},[])).default},Vce={iconBackground:"#f9f7ec",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./hardhat-TX56IT5N-CV1FY-wE.js");return{default:t}},[])).default},Hce={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./hyperevm-VKPAA4SA-CHwraEsx.js");return{default:t}},[])).default},tF={iconBackground:"#7132F5",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./ink-FZMYZWHG-62p-5IK5.js");return{default:t}},[])).default},nF={iconBackground:"transparent",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./kaia-65D2U3PU-JmuLQ4gC.js");return{default:t}},[])).default},dM={iconBackground:"#ffffff",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./linea-QRMVQ5DY-DuI3vv0d.js");return{default:t}},[])).default},hM={iconBackground:"#ffffff",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./manta-SI27YFEJ-CpVOKa06.js");return{default:t}},[])).default},rF={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./mantle-CKIUT334-DR2WgqzU.js");return{default:t}},[])).default},Gce={iconBackground:"transparent",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./monad-4KWC6TSS-DVXSkpiz.js");return{default:t}},[])).default},HS={iconBackground:"#ff5a57",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./optimism-HAF2GUT7-ec6Nqxs9.js");return{default:t}},[])).default},fM={iconBackground:"#9f71ec",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./polygon-WW6ZI7PM-DXlmm4L1.js");return{default:t}},[])).default},$ce={iconBackground:"#1273EA",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./ronin-EMCPYXZT-N-QBHZdV.js");return{default:t}},[])).default},Wce={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./sanko-RHQYXGM5-OX010CbN.js");return{default:t}},[])).default},qce={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./superposition-HG6MMR2Y-bRkgatRO.js");return{default:t}},[])).default},iF={iconBackground:"#FFEEDA",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./scroll-5OBGQVOV-DJFECiai.js");return{default:t}},[])).default},sF={iconBackground:"#F50DB4",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./unichain-C5BWO2ZY-BfguYsnu.js");return{default:t}},[])).default},oF={iconBackground:"#f9f7ec",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./xdc-KJ3TDBYO-DNV6zchh.js");return{default:t}},[])).default},aF={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./zetachain-TLDS5IPW-Udhyw16T.js");return{default:t}},[])).default},lF={iconBackground:"#f9f7ec",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./zksync-DH7HK5U4-Dt4usFw6.js");return{default:t}},[])).default},pM={iconBackground:"#000000",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./zora-FYL5H3IO-iB4wygST.js");return{default:t}},[])).default},Xce={apechain:{chainId:33139,name:"ApeChain",...qO},apechainCurtis:{chainId:33111,name:"ApeChain Curtis",...qO},arbitrum:{chainId:42161,name:"Arbitrum",...lM},arbitrumGoerli:{chainId:421613,...lM},arbitrumSepolia:{chainId:421614,...lM},avalanche:{chainId:43114,...XO},avalancheFuji:{chainId:43113,...XO},base:{chainId:8453,name:"Base",...cM},baseGoerli:{chainId:84531,...cM},baseSepolia:{chainId:84532,...cM},berachain:{chainId:80094,name:"Berachain",...uM},berachainArtio:{chainId:80085,name:"Berachain Artio",...uM},berachainBArtio:{chainId:80084,name:"Berachain bArtio",...uM},blast:{chainId:81457,name:"Blast",...ZO},blastSepolia:{chainId:168587773,...ZO},bsc:{chainId:56,name:"BSC",...QO},bscTestnet:{chainId:97,...QO},celo:{chainId:42220,name:"Celo",...KO},celoAlfajores:{chainId:44787,name:"Celo Alfajores",...KO},cronos:{chainId:25,...YO},cronosTestnet:{chainId:338,...YO},degen:{chainId:666666666,name:"Degen",...zce},flow:{chainId:747,...JO},flowTestnet:{chainId:545,...JO},gnosis:{chainId:100,name:"Gnosis",...Uce},goerli:{chainId:5,...u0},gravity:{chainId:1625,name:"Gravity",...eF},gravitySepolia:{chainId:13505,name:"Gravity Sepolia",...eF},hardhat:{chainId:31337,...Vce},holesky:{chainId:17e3,...u0},hyperevm:{chainId:999,...Hce},ink:{chainId:57073,...tF},inkSepolia:{chainId:763373,...tF},kaia:{chainId:8217,name:"Kaia",...nF},kairos:{chainId:1001,name:"Kairos",...nF},kovan:{chainId:42,...u0},linea:{chainId:59144,name:"Linea",...dM},lineaGoerli:{chainId:59140,name:"Linea Goerli",...dM},lineaSepolia:{chainId:59141,name:"Linea Sepolia",...dM},localhost:{chainId:1337,...u0},mainnet:{chainId:1,name:"Ethereum",...u0},manta:{chainId:169,name:"Manta",...hM},mantaSepolia:{chainId:3441006,...hM},mantaTestnet:{chainId:3441005,...hM},mantle:{chainId:5e3,...rF},mantleTestnet:{chainId:5001,...rF},monadTestnet:{chainId:10143,name:"Monad Testnet",...Gce},optimism:{chainId:10,name:"Optimism",...HS},optimismGoerli:{chainId:420,...HS},optimismKovan:{chainId:69,...HS},optimismSepolia:{chainId:11155420,...HS},polygon:{chainId:137,name:"Polygon",...fM},polygonAmoy:{chainId:80002,...fM},polygonMumbai:{chainId:80001,...fM},rinkeby:{chainId:4,...u0},ronin:{chainId:2020,...$ce},ropsten:{chainId:3,...u0},sanko:{chainId:1996,name:"Sanko",...Wce},scroll:{chainId:534352,...iF},scrollSepolia:{chainId:534351,...iF},sepolia:{chainId:11155111,...u0},superposition:{chainId:55244,name:"Superposition",...qce},unichain:{chainId:130,...sF},unichainSepolia:{chainId:1301,...sF},xdc:{chainId:50,name:"XDC",...oF},xdcTestnet:{chainId:51,...oF},zetachain:{chainId:7e3,name:"ZetaChain",...aF},zetachainAthensTestnet:{chainId:7001,name:"Zeta Athens",...aF},zkSync:{chainId:324,name:"zkSync",...lF},zkSyncTestnet:{chainId:280,...lF},zora:{chainId:7777777,name:"Zora",...pM},zoraSepolia:{chainId:999999999,...pM},zoraTestnet:{chainId:999,...pM}},Zce=Object.fromEntries(Object.values(Xce).filter(yH).map(({chainId:t,...e})=>[t,e])),Qce=t=>t.map(e=>{const n=Zce[e.id]??{};return{...e,name:n.name??e.name,iconUrl:e.iconUrl??n.iconUrl,iconBackground:e.iconBackground??n.iconBackground}}),CR=he.createContext({chains:[]});function Kce({children:t,initialChain:e}){const{chains:n}=Tl();return fe.createElement(CR.Provider,{value:he.useMemo(()=>({chains:Qce(n),initialChainId:typeof e=="number"?e:e==null?void 0:e.id}),[n,e])},t)}var Qx=()=>he.useContext(CR).chains,Yce=()=>he.useContext(CR).initialChainId,Jce=()=>{const t=Qx();return he.useMemo(()=>{const e={};for(const n of t)e[n.id]=n;return e},[t])},xH=he.createContext({showBalance:void 0,setShowBalance:()=>{}});function eue({children:t}){const[e,n]=he.useState();return fe.createElement(xH.Provider,{value:{showBalance:e,setShowBalance:n}},t)}var _H=()=>he.useContext(xH);function tue(){const[t,e]=he.useState(!1);return he.useEffect(()=>(e(!0),()=>{e(!1)}),[]),he.useCallback(()=>t,[t])}function vH(){const t=Qx(),e=_R.id;return t.some(s=>s.id===e)}function nue(t){const e=vH(),n=l=>{try{return rle(l)}catch{}},{data:s}=sae({chainId:_R.id,name:t?n(t):void 0,query:{enabled:e}});return s}async function Ly(t,e){if(e={headers:{},method:"get",...e,timeout:e.timeout??1e4},!t)throw new Error("rainbowFetch: Missing url argument");const n=new AbortController,s=setTimeout(()=>n.abort(),e.timeout),{body:l,params:u,headers:p,...r}=e,v=l&&typeof l=="object"?JSON.stringify(e.body):e.body,w=await fetch(`${t}${iue(u)}`,{...r,body:v,headers:{Accept:"application/json","Content-Type":"application/json",...p},signal:n.signal});clearTimeout(s);const E=await rue(w);if(w.ok){const{headers:R,status:D}=w;return{data:E,headers:R,status:D}}throw sue({requestBody:l,response:w,responseBody:typeof E=="string"?{error:E}:E})}function rue(t){const e=t.headers.get("Content-Type");return e!=null&&e.startsWith("application/json")?t.json():t.text()}function iue(t){return t&&Object.keys(t).length?`?${new URLSearchParams(t)}`:""}function sue({requestBody:t,response:e,responseBody:n}){const s=(n==null?void 0:n.error)||(e==null?void 0:e.statusText)||"There was an error with the request.",l=new Error(s);return l.response=e,l.responseBody=n,l.requestBody=t,l}var oue=class{constructor(t={}){const{baseUrl:e="",...n}=t;this.baseUrl=e,this.opts=n}get(t,e){return Ly(`${this.baseUrl}${t}`,{...this.opts,...e||{},method:"get"})}delete(t,e){return Ly(`${this.baseUrl}${t}`,{...this.opts,...e||{},method:"delete"})}head(t,e){return Ly(`${this.baseUrl}${t}`,{...this.opts,...e||{},method:"head"})}options(t,e){return Ly(`${this.baseUrl}${t}`,{...this.opts,...e||{},method:"options"})}post(t,e,n){return Ly(`${this.baseUrl}${t}`,{...this.opts,...n||{},body:e,method:"post"})}put(t,e,n){return Ly(`${this.baseUrl}${t}`,{...this.opts,...n||{},body:e,method:"put"})}patch(t,e,n){return Ly(`${this.baseUrl}${t}`,{...this.opts,...n||{},body:e,method:"patch"})}};function aue({baseUrl:t,headers:e,params:n,timeout:s}){return new oue({baseUrl:t,headers:e,params:n,timeout:s})}var lue=!!(typeof process<"u"&&typeof _E<"u"&&_E.RAINBOW_PROVIDER_API_KEY),cue=aue({baseUrl:"https://enhanced-provider.rainbow.me",headers:{"x-api-key":typeof process<"u"&&typeof _E<"u"&&_E.RAINBOW_PROVIDER_API_KEY||"LzbasoBiLqltex3VkcQ7LRmL4PtfiiZ1EMJrizrgfonWN6byJReu/l6yrUoo3zLW"}});function uue(t,e,n={}){return[t,e,n]}function UT(t){return`rk-ens-name-${t}`}function due(t){try{const e=t?JSON.parse(t):null;return typeof e=="object"?e:null}catch{return null}}function hue(t,e){if(!Oa(t))return;const n=new Date,s=new Date(n.getTime()+180*6e4);localStorage.setItem(UT(t),JSON.stringify({ensName:e,expires:s.getTime()}))}function fue(t){const e=due(localStorage.getItem(UT(t)));if(!e)return null;const{ensName:n,expires:s}=e;return typeof n!="string"||Number.isNaN(Number(s))||new Date().getTime()>Number(s)?(localStorage.removeItem(UT(t)),null):n}async function pue({address:t}){const e=fue(t);if(e)return e;const s=(await cue.get("/v1/resolve-ens",{params:{address:t}})).data.data;return s&&hue(t,s),s}function mue(t){const e=vH(),{data:n}=oae({chainId:_R.id,address:t,query:{enabled:e}}),{data:s}=eV({queryKey:uue("address",t),queryFn:()=>pue({address:t}),enabled:!e&&!!t&&lue,staleTime:10*(60*1e3),retry:1});return n||s}function bH({address:t,includeBalance:e}){const n=mue(t),s=nue(n),{data:l}=tV({address:e?t:void 0});return{ensName:n,ensAvatar:s,balance:l}}function MR(){const{chain:t}=qc();return(t==null?void 0:t.id)??null}var wH="rk-transactions";function gue(t){try{const e=t?JSON.parse(t):{};return typeof e=="object"?e:{}}catch{return{}}}function cF(){return gue(typeof localStorage<"u"?localStorage.getItem(wH):null)}var yue=/^0x([A-Fa-f0-9]{64})$/;function xue(t){const e=[];return yue.test(t.hash)||e.push("Invalid transaction hash"),typeof t.description!="string"&&e.push("Transaction must have a description"),typeof t.confirmations<"u"&&(!Number.isInteger(t.confirmations)||t.confirmations<1)&&e.push("Transaction confirmations must be a positiver integer"),e}function _ue({provider:t}){let e=cF(),n=t;const s=new Set,l=new Set,u=new Map;function p(X){n=X}function r(X,W){var K;return((K=e[X])==null?void 0:K[W])??[]}function v(X,W,K){const ne=xue(K);if(ne.length>0)throw new Error(["Unable to add transaction",...ne].join(`
`));k(X,W,te=>[{...K,status:"pending"},...te.filter(({hash:re})=>re!==K.hash)])}function w(X,W){k(X,W,()=>[])}function E(X,W,K,ne){k(X,W,te=>te.map(re=>re.hash===K?{...re,status:ne}:re))}async function T(X,W){await Promise.all(r(X,W).filter(K=>K.status==="pending").map(async K=>{const{confirmations:ne,hash:te}=K,re=u.get(te);if(re)return await re;const xe=n.waitForTransactionReceipt({confirmations:ne,hash:te,timeout:3e5}).then(({status:ae})=>{u.delete(te),ae!==void 0&&(E(X,W,te,ae===0||ae==="reverted"?"failed":"confirmed"),O(ae))}).catch(()=>{E(X,W,te,"failed")});return u.set(te,xe),await xe}))}function k(X,W,K){e=cF(),e[X]=e[X]??{};let ne=0;const te=10,re=K(e[X][W]??[]).filter(({status:xe})=>xe==="pending"?!0:ne++<=te);e[X][W]=re.length>0?re:void 0,R(),D(),T(X,W)}function R(){localStorage.setItem(wH,JSON.stringify(e))}function D(){for(const X of s)X()}function O(X){for(const W of l)W(X)}function F(X){return s.add(X),()=>{s.delete(X)}}function U(X){return l.add(X),()=>{l.delete(X)}}return{addTransaction:v,clearTransactions:w,getTransactions:r,onTransactionStatus:U,onChange:F,setProvider:p,waitForPendingTransactions:T}}var uF,SH=fe.createContext(null);function vue({children:t}){const e=aae(),{address:n}=qc(),s=MR(),{refetch:l}=tV({address:n,query:{enabled:!1}}),[u]=fe.useState(()=>uF??(uF=_ue({provider:e}))),p=fe.useCallback(r=>{r==="success"&&l()},[l]);return fe.useEffect(()=>{u.setProvider(e)},[u,e]),fe.useEffect(()=>{n&&s&&u.waitForPendingTransactions(n,s)},[u,n,s]),fe.useEffect(()=>{if(u&&n&&s)return u.onTransactionStatus(p)},[u,n,s,p]),fe.createElement(SH.Provider,{value:u},t)}function TH(){const t=fe.useContext(SH);if(!t)throw new Error("Transaction hooks must be used within RainbowKitProvider");return t}function EH(){const t=TH(),{address:e}=qc(),n=MR(),[s,l]=he.useState(()=>t&&e&&n?t.getTransactions(e,n):[]);return he.useEffect(()=>{if(t&&e&&n)return l(t.getTransactions(e,n)),t.onChange(()=>{l(t.getTransactions(e,n))})},[t,e,n]),s}var dF=t=>typeof t=="function"?t():t;function bue(t,{extends:e}={}){const n={...RO(VO,dF(t))};if(!e)return n;const s=RO(VO,dF(e));return Object.fromEntries(Object.entries(n).filter(([u,p])=>p!==s[u]))}function hF(t,e={}){return Object.entries(bue(t,e)).map(([n,s])=>`${n}:${s.replace(/[:;{}</>]/g,"")};`).join("")}var AH={appName:void 0,disclaimer:void 0,learnMoreUrl:"https://learn.rainbow.me/understanding-web3?utm_source=rainbowkit&utm_campaign=learnmore"},g2=he.createContext(AH),CH=he.createContext(!1);function wue(t,e){let n;return()=>{n&&clearTimeout(n),n=setTimeout(()=>{n=null,t()},e)}}var MH=()=>{const[t,e]=he.useState({height:void 0,width:void 0});return he.useEffect(()=>{const n=wue(()=>{e({height:window.innerHeight,width:window.innerWidth})},500);return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),t},y2=he.createContext({connector:null,setConnector:()=>{}});function Sue({children:t}){const[e,n]=he.useState(null);return fe.createElement(y2.Provider,{value:he.useMemo(()=>({connector:e,setConnector:n}),[e])},t)}var x2={COMPACT:"compact",WIDE:"wide"},RA=he.createContext(x2.WIDE);function Tue({children:t,modalSize:e}){const{width:n}=MH(),s=n&&n<_ce,{connector:l}=he.useContext(y2);return fe.createElement(RA.Provider,{value:s||l?x2.COMPACT:e},t)}var kR=he.createContext(!1),Eue="rk-version";function Aue({version:t}){localStorage.setItem(Eue,t)}function Cue(){const t=he.useCallback(()=>{Aue({version:"2.2.9"})},[]);he.useEffect(()=>{t()},[t])}function Mue(t,e){const n={};for(const s of t){const l=e(s);l&&(n[l]=s)}return n}function IR(){return typeof navigator<"u"&&typeof navigator.userAgent<"u"&&/Version\/([0-9._]+).*Safari/.test(navigator.userAgent)}function kue(){return typeof document<"u"&&getComputedStyle(document.body).getPropertyValue("--arc-palette-focus")!==""}function PR(){var e,n;if(typeof navigator>"u")return"Browser";const t=(e=navigator.userAgent)==null?void 0:e.toLowerCase();return(n=navigator.brave)!=null&&n.isBrave?"Brave":(t==null?void 0:t.indexOf("edg/"))>-1?"Edge":(t==null?void 0:t.indexOf("op"))>-1?"Opera":kue()?"Arc":(t==null?void 0:t.indexOf("chrome"))>-1?"Chrome":(t==null?void 0:t.indexOf("firefox"))>-1?"Firefox":IR()?"Safari":"Browser"}var Iue=Wle.UAParser(),{os:RR}=Iue;function Pue(){return RR.name==="Windows"}function Rue(){return RR.name==="Mac OS"}function Nue(){return["Ubuntu","Mint","Fedora","Debian","Arch","Linux"].includes(RR.name)}function NR(){return Pue()?"Windows":Rue()?"macOS":Nue()?"Linux":"Desktop"}var jue=t=>{var n,s,l,u,p,r,v,w,E,T,k;const e=PR();return{Arc:(n=t==null?void 0:t.downloadUrls)==null?void 0:n.chrome,Brave:(s=t==null?void 0:t.downloadUrls)==null?void 0:s.chrome,Chrome:(l=t==null?void 0:t.downloadUrls)==null?void 0:l.chrome,Edge:((u=t==null?void 0:t.downloadUrls)==null?void 0:u.edge)||((p=t==null?void 0:t.downloadUrls)==null?void 0:p.chrome),Firefox:(r=t==null?void 0:t.downloadUrls)==null?void 0:r.firefox,Opera:((v=t==null?void 0:t.downloadUrls)==null?void 0:v.opera)||((w=t==null?void 0:t.downloadUrls)==null?void 0:w.chrome),Safari:(E=t==null?void 0:t.downloadUrls)==null?void 0:E.safari,Browser:(T=t==null?void 0:t.downloadUrls)==null?void 0:T.browserExtension}[e]??((k=t==null?void 0:t.downloadUrls)==null?void 0:k.browserExtension)},Due=t=>{var n,s,l;return(m2()?(n=t==null?void 0:t.downloadUrls)==null?void 0:n.ios:(s=t==null?void 0:t.downloadUrls)==null?void 0:s.android)??((l=t==null?void 0:t.downloadUrls)==null?void 0:l.mobile)},Lue=t=>{var n,s,l,u,p;const e=NR();return{Windows:(n=t==null?void 0:t.downloadUrls)==null?void 0:n.windows,macOS:(s=t==null?void 0:t.downloadUrls)==null?void 0:s.macos,Linux:(l=t==null?void 0:t.downloadUrls)==null?void 0:l.linux,Desktop:(u=t==null?void 0:t.downloadUrls)==null?void 0:u.desktop}[e]??((p=t==null?void 0:t.downloadUrls)==null?void 0:p.desktop)},kH=(t,e)=>t.some(n=>n.id===e),Oue=t=>!!t.isRainbowKitConnector,fF=t=>{var e;return!!(!t.isRainbowKitConnector&&((e=t.icon)!=null&&e.replace(/\n/g,"").startsWith("data:image"))&&t.uid&&t.name)},Fue=(t,e)=>t.id==="walletConnect"&&e?{...t,walletConnectModalConnector:e}:t,Bue=({wallets:t,recentWallets:e})=>[...e,...t.filter(n=>!kH(e,n.id))],IH="rk-recent";function zue(t){try{const e=t?JSON.parse(t):[];return Array.isArray(e)?e:[]}catch{return[]}}function PH(){return typeof localStorage<"u"?zue(localStorage.getItem(IH)):[]}function Uue(t){return[...new Set(t)]}function Vue(t){const e=Uue([t,...PH()]);localStorage.setItem(IH,JSON.stringify(e))}function Mw(t=!1){var K,ne,te;const e=Qx(),n=Yce(),{connectAsync:s,connectors:l}=rae(),u=l,{setIsWalletConnectModalOpen:p}=nG(),r=u.map(re=>({...re,...re.rkDetails||{}}));async function v(re,xe){var ye,Ce;const ae=await re.getChainId(),ce=await s({...xe,chainId:(xe==null?void 0:xe.chainId)??n??((ye=e.find(({id:Me})=>Me===ae))==null?void 0:ye.id)??((Ce=e[0])==null?void 0:Ce.id),connector:re});return ce&&Vue(re.id),ce}async function w(re){try{p(!0),await v(re),p(!1)}catch(xe){const ae=xe.name==="UserRejectedRequestError"||xe.message==="Connection request reset. Please try again.";if(p(!1),!ae)throw xe}}const E=async(re,xe)=>{const ae=await re.getProvider();return re.id==="coinbase"?ae.qrUrl:new Promise(ce=>ae.once("display_uri",ye=>{ce(xe(ye))}))},T=r.find(re=>re.id==="walletConnect"&&re.isWalletConnectModalConnector),k=r.filter(fF).map(re=>({...re,groupIndex:0})),R=r.filter(Oue).filter(re=>!re.isWalletConnectModalConnector).filter(re=>t?!k.some(ae=>ae.id===re.rdns):!0).map(re=>Fue(re,T)),D=[...k,...R],O=Mue(D,re=>re.id),U=PH().map(re=>O[re]).filter(Boolean).slice(0,3),X=[],W=Bue({wallets:D,recentWallets:U});for(const re of W){if(!re)continue;const xe=fF(re),ae=kH(U,re.id);if(xe){X.push({...re,iconUrl:re.icon,ready:!0,connect:v.bind(null,re),groupName:"Installed",recent:ae});continue}X.push({...re,ready:re.installed??!0,connect:v.bind(null,re),desktopDownloadUrl:Lue(re),extensionDownloadUrl:jue(re),groupName:re.groupName,mobileDownloadUrl:Due(re),getQrCodeUri:(K=re.qrCode)!=null&&K.getUri?()=>E(re,re.qrCode.getUri):void 0,getDesktopUri:(ne=re.desktop)!=null&&ne.getUri?()=>E(re,re.desktop.getUri):void 0,getMobileUri:(te=re.mobile)!=null&&te.getUri?()=>{var ce;return E(re,(ce=re.mobile)==null?void 0:ce.getUri)}:void 0,recent:ae,showWalletConnectModal:re.walletConnectModalConnector?()=>w(re.walletConnectModalConnector):void 0})}return X}var RH=async()=>(await hr(async()=>{const{default:t}=await import("./assets-Q6ZU7ZJ5-P8HioiAD.js");return{default:t}},[])).default,Hue=()=>Sp(RH),Gue=()=>fe.createElement(Sl,{background:"#d0d5de",borderRadius:"10",height:"48",src:RH,width:"48"}),NH=async()=>(await hr(async()=>{const{default:t}=await import("./login-UP3DZBGS-Db_wM5oQ.js");return{default:t}},[])).default,$ue=()=>Sp(NH),Wue=()=>fe.createElement(Sl,{background:"#d0d5de",borderRadius:"10",height:"48",src:NH,width:"48"}),_i=fe.forwardRef(({as:t="div",children:e,className:n,color:s,display:l,font:u="body",id:p,size:r="16",style:v,tabIndex:w,textAlign:E="inherit",weight:T="regular",testId:k},R)=>fe.createElement(At,{as:t,className:n,color:s,display:l,fontFamily:u,fontSize:r,fontWeight:T,id:p,ref:R,style:v,tabIndex:w,textAlign:E,testId:k},e));_i.displayName="Text";var que={large:{fontSize:"16",paddingX:"24",paddingY:"10"},medium:{fontSize:"14",height:"28",paddingX:"12",paddingY:"4"},small:{fontSize:"14",paddingX:"10",paddingY:"5"}};function Gc({disabled:t=!1,href:e,label:n,onClick:s,rel:l="noreferrer noopener",size:u="medium",target:p="_blank",testId:r,type:v="primary"}){const w=v==="primary",E=u!=="large",T=Fa(),k=t?"actionButtonSecondaryBackground":w?"accentColor":E?"actionButtonSecondaryBackground":null,{fontSize:R,height:D,paddingX:O,paddingY:F}=que[u],U=!T||!E;return fe.createElement(At,{...e?t?{}:{as:"a",href:e,rel:l,target:p}:{as:"button",type:"button"},onClick:t?void 0:s,...U?{borderColor:T&&!E&&!w?"actionButtonBorderMobile":"actionButtonBorder",borderStyle:"solid",borderWidth:"1"}:{},borderRadius:"actionButton",className:!t&&ja({active:"shrinkSm",hover:"grow"}),display:"block",paddingX:O,paddingY:F,style:{willChange:"transform"},testId:r,textAlign:"center",transition:"transform",...k?{background:k}:{},...D?{height:D}:{}},fe.createElement(_i,{color:t?"modalTextSecondary":w?"accentColorForeground":"accentColor",size:R,weight:"bold"},n))}var Xue=()=>Fa()?fe.createElement("svg",{"aria-hidden":!0,fill:"none",height:"11.5",viewBox:"0 0 11.5 11.5",width:"11.5",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Close"),fe.createElement("path",{d:"M2.13388 0.366117C1.64573 -0.122039 0.854272 -0.122039 0.366117 0.366117C-0.122039 0.854272 -0.122039 1.64573 0.366117 2.13388L3.98223 5.75L0.366117 9.36612C-0.122039 9.85427 -0.122039 10.6457 0.366117 11.1339C0.854272 11.622 1.64573 11.622 2.13388 11.1339L5.75 7.51777L9.36612 11.1339C9.85427 11.622 10.6457 11.622 11.1339 11.1339C11.622 10.6457 11.622 9.85427 11.1339 9.36612L7.51777 5.75L11.1339 2.13388C11.622 1.64573 11.622 0.854272 11.1339 0.366117C10.6457 -0.122039 9.85427 -0.122039 9.36612 0.366117L5.75 3.98223L2.13388 0.366117Z",fill:"currentColor"})):fe.createElement("svg",{"aria-hidden":!0,fill:"none",height:"10",viewBox:"0 0 10 10",width:"10",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Close"),fe.createElement("path",{d:"M1.70711 0.292893C1.31658 -0.0976311 0.683417 -0.0976311 0.292893 0.292893C-0.0976311 0.683417 -0.0976311 1.31658 0.292893 1.70711L3.58579 5L0.292893 8.29289C-0.0976311 8.68342 -0.0976311 9.31658 0.292893 9.70711C0.683417 10.0976 1.31658 10.0976 1.70711 9.70711L5 6.41421L8.29289 9.70711C8.68342 10.0976 9.31658 10.0976 9.70711 9.70711C10.0976 9.31658 10.0976 8.68342 9.70711 8.29289L6.41421 5L9.70711 1.70711C10.0976 1.31658 10.0976 0.683417 9.70711 0.292893C9.31658 -0.0976311 8.68342 -0.0976311 8.29289 0.292893L5 3.58579L1.70711 0.292893Z",fill:"currentColor"})),Vx=({"aria-label":t="Close",onClose:e})=>{const n=Fa();return fe.createElement(At,{alignItems:"center","aria-label":t,as:"button",background:"closeButtonBackground",borderColor:"actionButtonBorder",borderRadius:"full",borderStyle:"solid",borderWidth:n?"0":"1",className:ja({active:"shrinkSm",hover:"growLg"}),color:"closeButton",display:"flex",height:n?"30":"28",justifyContent:"center",onClick:e,style:{willChange:"transform"},transition:"default",type:"button",width:n?"30":"28"},fe.createElement(Xue,null))},jH=async()=>(await hr(async()=>{const{default:t}=await import("./sign-A7IJEUT5-CGsRnPrd.js");return{default:t}},[])).default;function Zue({onClose:t,onCloseModal:e}){const{i18n:n}=he.useContext(Ba),[{status:s,...l},u]=fe.useState({status:"idle"}),p=Sce(),r=he.useCallback(async()=>{try{const D=await p.getNonce();u(O=>({...O,nonce:D}))}catch{u(D=>({...D,errorMessage:n.t("sign_in.message.preparing_error"),status:"idle"}))}},[p,n.t]),v=he.useRef(!1);fe.useEffect(()=>{v.current||(v.current=!0,r())},[r]);const w=Fa(),{address:E,chain:T}=qc(),{signMessageAsync:k}=lae(),R=async()=>{try{const D=T==null?void 0:T.id,{nonce:O}=l;if(!E||!D||!O)return;u(X=>({...X,errorMessage:void 0,status:"signing"}));const F=p.createMessage({address:E,chainId:D,nonce:O});let U;try{U=await k({message:F})}catch(X){return X instanceof ao?u(W=>({...W,status:"idle"})):u(W=>({...W,errorMessage:n.t("sign_in.signature.signing_error"),status:"idle"}))}u(X=>({...X,status:"verifying"}));try{if(await p.verify({message:F,signature:U})){e();return}throw new Error}catch{return u(X=>({...X,errorMessage:n.t("sign_in.signature.verifying_error"),status:"idle"}))}}catch{u({errorMessage:n.t("sign_in.signature.oops_error"),status:"idle"})}};return fe.createElement(At,{position:"relative"},fe.createElement(At,{display:"flex",paddingRight:"16",paddingTop:"16",position:"absolute",right:"0"},fe.createElement(Vx,{onClose:t})),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:w?"32":"24",padding:"24",paddingX:"18",style:{paddingTop:w?"60px":"36px"}},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:w?"6":"4",style:{maxWidth:w?320:280}},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:w?"32":"16"},fe.createElement(Sl,{height:40,src:jH,width:40}),fe.createElement(_i,{color:"modalText",size:w?"20":"18",textAlign:"center",weight:"heavy"},n.t("sign_in.label"))),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:w?"16":"12"},fe.createElement(_i,{color:"modalTextSecondary",size:w?"16":"14",textAlign:"center"},n.t("sign_in.description")),s==="idle"&&l.errorMessage?fe.createElement(_i,{color:"error",size:w?"16":"14",textAlign:"center",weight:"bold"},l.errorMessage):null)),fe.createElement(At,{alignItems:w?void 0:"center",display:"flex",flexDirection:"column",gap:"8",width:"full"},fe.createElement(Gc,{disabled:!l.nonce||s==="signing"||s==="verifying",label:l.nonce?s==="signing"?n.t("sign_in.signature.waiting"):s==="verifying"?n.t("sign_in.signature.verifying"):n.t("sign_in.message.send"):n.t("sign_in.message.preparing"),onClick:R,size:w?"large":"medium",testId:"auth-message-button"}),w?fe.createElement(Gc,{label:"Cancel",onClick:t,size:"large",type:"secondary"}):fe.createElement(At,{as:"button",borderRadius:"full",className:ja({active:"shrink",hover:"grow"}),display:"block",onClick:t,paddingX:"10",paddingY:"5",rel:"noreferrer",style:{willChange:"transform"},target:"_blank",transition:"default"},fe.createElement(_i,{color:"closeButton",size:w?"16":"14",weight:"bold"},n.t("sign_in.message.cancel"))))))}function Que(){const t=Qx(),e=Mw(),n=IA()==="unauthenticated",s=he.useCallback(()=>{Sp(...e.map(l=>l.iconUrl),...t.map(l=>l.iconUrl).filter(yH)),Fa()||(Hue(),$ue()),n&&Sp(jH)},[e,t,n]);he.useEffect(()=>{s()},[s])}var DH="WALLETCONNECT_DEEPLINK_CHOICE";function Kue({mobileUri:t,name:e}){localStorage.setItem(DH,JSON.stringify({href:t.split("?")[0],name:e}))}function Yue(){localStorage.removeItem(DH)}var LH=he.createContext(void 0),Ok="data-rk",OH=t=>({[Ok]:t||""}),Jue=t=>{if(t&&!/^[a-zA-Z0-9_]+$/.test(t))throw new Error(`Invalid ID: ${t}`);return t?`[${Ok}="${t}"]`:`[${Ok}]`},ede=()=>{const t=he.useContext(LH);return OH(t)},tde=oV();function nde({appInfo:t,avatar:e,children:n,coolMode:s=!1,id:l,initialChain:u,locale:p,modalSize:r=x2.WIDE,showRecentTransactions:v=!1,theme:w=tde}){if(Que(),Cue(),z9({onDisconnect:Yue}),typeof w=="function")throw new Error('A theme function was provided to the "theme" prop instead of a theme object. You must execute this function to get the resulting theme object.');const E=Jue(l),T={...AH,...t},k=e??pH;return fe.createElement(Kce,{initialChain:u},fe.createElement(Sue,null,fe.createElement(Bce,{locale:p},fe.createElement(CH.Provider,{value:s},fe.createElement(Tue,{modalSize:r},fe.createElement(kR.Provider,{value:v},fe.createElement(vue,null,fe.createElement(mH.Provider,{value:k},fe.createElement(g2.Provider,{value:T},fe.createElement(LH.Provider,{value:l},fe.createElement(eue,null,fe.createElement(ghe,null,w?fe.createElement("div",{...OH(l)},fe.createElement("style",{dangerouslySetInnerHTML:{__html:[`${E}{${hF("lightMode"in w?w.lightMode:w)}}`,"darkMode"in w?`@media(prefers-color-scheme:dark){${E}{${hF(w.darkMode,{extends:w.lightMode})}}}`:null].join("")}}),n):n))))))))))))}var rde="_9pm4ki5 ju367va ju367v15 ju367v8r",ide="_9pm4ki3 ju367v9h ju367vb3 ju367va ju367v2q ju367v8q",pF=(t,e)=>{const n=t.querySelectorAll("button:not(:disabled), a[href]");n.length!==0&&n[e==="end"?n.length-1:0].focus()};function sde(t){const e=he.useRef(null);return he.useEffect(()=>{const n=document.activeElement;return()=>{var s;(s=n.focus)==null||s.call(n)}},[]),he.useEffect(()=>{if(e.current){const n=e.current.querySelector("[data-auto-focus]");n?n.focus():e.current.focus()}},[]),fe.createElement(fe.Fragment,null,fe.createElement("div",{onFocus:he.useCallback(()=>e.current&&pF(e.current,"end"),[]),tabIndex:0}),fe.createElement("div",{ref:e,style:{outline:"none"},tabIndex:-1,...t}),fe.createElement("div",{onFocus:he.useCallback(()=>e.current&&pF(e.current,"start"),[]),tabIndex:0}))}var ode=t=>t.stopPropagation();function vE({children:t,onClose:e,open:n,titleId:s}){he.useEffect(()=>{const w=E=>n&&E.key==="Escape"&&e();return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[n,e]);const[l,u]=he.useState(!0);he.useEffect(()=>{u(getComputedStyle(window.document.body).overflow!=="hidden")},[]);const p=he.useCallback(()=>e(),[e]),r=ede(),v=Fa();return fe.createElement(fe.Fragment,null,n?IV.createPortal(fe.createElement(aH,{enabled:l},fe.createElement(At,{...r},fe.createElement(At,{...r,alignItems:v?"flex-end":"center","aria-labelledby":s,"aria-modal":!0,className:ide,onClick:p,position:"fixed",role:"dialog"},fe.createElement(sde,{className:rde,onClick:ode,role:"document"},t)))),document.body):null)}var ade="_1ckjpok7",lde="_1ckjpok1 ju367vb6 ju367vdr ju367vp ju367vt ju367vv ju367vel ju367va ju367v15 ju367v6c ju367v8r",cde="_1ckjpok4 _1ckjpok1 ju367vb6 ju367vdr ju367vp ju367vt ju367vv ju367vel ju367va ju367v15 ju367v6c ju367v8r",ude="_1ckjpok6 ju367vq",dde="_1ckjpok3 _1ckjpok1 ju367vb6 ju367vdr ju367vp ju367vt ju367vv ju367vel ju367va ju367v15 ju367v6c ju367v8r",hde="_1ckjpok2 _1ckjpok1 ju367vb6 ju367vdr ju367vp ju367vt ju367vv ju367vel ju367va ju367v15 ju367v6c ju367v8r";function bE({bottomSheetOnMobile:t=!1,children:e,marginTop:n,padding:s="16",paddingBottom:l,wide:u=!1}){const p=Fa(),v=he.useContext(RA)===x2.COMPACT;return fe.createElement(At,{marginTop:n},fe.createElement(At,{className:[u?p?hde:v?cde:dde:lde,p?ude:null,p&&t?ade:null].join(" ")},fe.createElement(At,{padding:s,paddingBottom:l??s},e)))}var mF=["k","m","b","t"];function GS(t,e=1){return t.toString().replace(new RegExp(`(.+\\.\\d{${e}})\\d+`),"$1").replace(/(\.[1-9]*)0+$/,"$1").replace(/\.$/,"")}function FH(t){if(t<1)return GS(t,3);if(t<10**2)return GS(t,2);if(t<10**4)return new Intl.NumberFormat().format(Number.parseFloat(GS(t,1)));const e=10**1;let n=String(t);for(let s=mF.length-1;s>=0;s--){const l=10**((s+1)*3);if(l<=t){t=t*e/l/e,n=GS(t,1)+mF[s];break}}return n}function BH(t){return t.length<8?t:`${t.substring(0,4)}${t.substring(t.length-4)}`}function zH(t){if(!t)return"";const e=t.split("."),n=e.pop();return e.join(".").length>24?`${e.join(".").substring(0,24)}...`:`${e.join(".")}.${n}`}var fde=()=>fe.createElement("svg",{fill:"none",height:"13",viewBox:"0 0 13 13",width:"13",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Copied"),fe.createElement("path",{d:"M4.94568 12.2646C5.41052 12.2646 5.77283 12.0869 6.01892 11.7109L12.39 1.96973C12.5677 1.69629 12.6429 1.44336 12.6429 1.2041C12.6429 0.561523 12.1644 0.0966797 11.5082 0.0966797C11.057 0.0966797 10.7767 0.260742 10.5033 0.691406L4.9115 9.50977L2.07458 5.98926C1.82166 5.68848 1.54822 5.55176 1.16541 5.55176C0.502319 5.55176 0.0238037 6.02344 0.0238037 6.66602C0.0238037 6.95312 0.112671 7.20605 0.358765 7.48633L3.88611 11.7588C4.18005 12.1074 4.50818 12.2646 4.94568 12.2646Z",fill:"currentColor"})),pde=()=>fe.createElement("svg",{fill:"none",height:"16",viewBox:"0 0 17 16",width:"17",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Copy"),fe.createElement("path",{d:"M3.04236 12.3027H4.18396V13.3008C4.18396 14.8525 5.03845 15.7002 6.59705 15.7002H13.6244C15.183 15.7002 16.0375 14.8525 16.0375 13.3008V6.24609C16.0375 4.69434 15.183 3.84668 13.6244 3.84668H12.4828V2.8418C12.4828 1.29688 11.6283 0.442383 10.0697 0.442383H3.04236C1.48376 0.442383 0.629272 1.29004 0.629272 2.8418V9.90332C0.629272 11.4551 1.48376 12.3027 3.04236 12.3027ZM3.23376 10.5391C2.68689 10.5391 2.39294 10.2656 2.39294 9.68457V3.06055C2.39294 2.47949 2.68689 2.21289 3.23376 2.21289H9.8783C10.4252 2.21289 10.7191 2.47949 10.7191 3.06055V3.84668H6.59705C5.03845 3.84668 4.18396 4.69434 4.18396 6.24609V10.5391H3.23376ZM6.78845 13.9365C6.24158 13.9365 5.94763 13.6699 5.94763 13.0889V6.45801C5.94763 5.87695 6.24158 5.61035 6.78845 5.61035H13.433C13.9799 5.61035 14.2738 5.87695 14.2738 6.45801V13.0889C14.2738 13.6699 13.9799 13.9365 13.433 13.9365H6.78845Z",fill:"currentColor"})),mde=()=>fe.createElement("svg",{fill:"none",height:"16",viewBox:"0 0 18 16",width:"18",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Disconnect"),fe.createElement("path",{d:"M2.67834 15.5908H9.99963C11.5514 15.5908 12.399 14.7432 12.399 13.1777V10.2656H10.6354V12.9863C10.6354 13.5332 10.3688 13.8271 9.78772 13.8271H2.89026C2.3092 13.8271 2.0426 13.5332 2.0426 12.9863V3.15625C2.0426 2.60254 2.3092 2.30859 2.89026 2.30859H9.78772C10.3688 2.30859 10.6354 2.60254 10.6354 3.15625V5.89746H12.399V2.95801C12.399 1.39941 11.5514 0.544922 9.99963 0.544922H2.67834C1.12659 0.544922 0.278931 1.39941 0.278931 2.95801V13.1777C0.278931 14.7432 1.12659 15.5908 2.67834 15.5908ZM7.43616 8.85059H14.0875L15.0924 8.78906L14.566 9.14453L13.6842 9.96484C13.5406 10.1016 13.4586 10.2861 13.4586 10.4844C13.4586 10.8398 13.7321 11.168 14.1217 11.168C14.3199 11.168 14.4635 11.0928 14.6002 10.9561L16.7809 8.68652C16.986 8.48145 17.0543 8.27637 17.0543 8.06445C17.0543 7.85254 16.986 7.64746 16.7809 7.43555L14.6002 5.17285C14.4635 5.03613 14.3199 4.9541 14.1217 4.9541C13.7321 4.9541 13.4586 5.27539 13.4586 5.6377C13.4586 5.83594 13.5406 6.02734 13.6842 6.15723L14.566 6.98438L15.0924 7.33984L14.0875 7.27148H7.43616C7.01917 7.27148 6.65686 7.62012 6.65686 8.06445C6.65686 8.50195 7.01917 8.85059 7.43616 8.85059Z",fill:"currentColor"}));function gde(){const t=TH(),{address:e}=qc(),n=MR();return he.useCallback(()=>{if(!e||!n)throw new Error("No address or chain ID found");t.clearTransactions(e,n)},[t,e,n])}var UH=t=>{var e,n;return(n=(e=t==null?void 0:t.blockExplorers)==null?void 0:e.default)==null?void 0:n.url},VH=()=>fe.createElement("svg",{fill:"none",height:"19",viewBox:"0 0 20 19",width:"20",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Link"),fe.createElement("path",{d:"M10 18.9443C15.0977 18.9443 19.2812 14.752 19.2812 9.6543C19.2812 4.56543 15.0889 0.373047 10 0.373047C4.90234 0.373047 0.71875 4.56543 0.71875 9.6543C0.71875 14.752 4.91113 18.9443 10 18.9443ZM10 16.6328C6.1416 16.6328 3.03906 13.5215 3.03906 9.6543C3.03906 5.7959 6.13281 2.68457 10 2.68457C13.8584 2.68457 16.9697 5.7959 16.9697 9.6543C16.9785 13.5215 13.8672 16.6328 10 16.6328ZM12.7158 12.1416C13.2432 12.1416 13.5684 11.7549 13.5684 11.1836V7.19336C13.5684 6.44629 13.1377 6.05957 12.417 6.05957H8.40918C7.8291 6.05957 7.45117 6.38477 7.45117 6.91211C7.45117 7.43945 7.8291 7.77344 8.40918 7.77344H9.69238L10.7207 7.63281L9.53418 8.67871L6.73047 11.4912C6.53711 11.6758 6.41406 11.9395 6.41406 12.2031C6.41406 12.7832 6.85352 13.1699 7.39844 13.1699C7.68848 13.1699 7.92578 13.0732 8.1543 12.8623L10.9316 10.0762L11.9775 8.89844L11.8545 9.98828V11.1836C11.8545 11.7725 12.1885 12.1416 12.7158 12.1416Z",fill:"currentColor"})),yde=()=>fe.createElement("svg",{fill:"none",height:"19",viewBox:"0 0 20 19",width:"20",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Cancel"),fe.createElement("path",{d:"M10 18.9443C15.0977 18.9443 19.2812 14.752 19.2812 9.6543C19.2812 4.56543 15.0889 0.373047 10 0.373047C4.90234 0.373047 0.71875 4.56543 0.71875 9.6543C0.71875 14.752 4.91113 18.9443 10 18.9443ZM10 16.6328C6.1416 16.6328 3.03906 13.5215 3.03906 9.6543C3.03906 5.7959 6.13281 2.68457 10 2.68457C13.8584 2.68457 16.9697 5.7959 16.9697 9.6543C16.9785 13.5215 13.8672 16.6328 10 16.6328ZM7.29297 13.3018C7.58301 13.3018 7.81152 13.2139 7.99609 13.0205L10 11.0166L12.0127 13.0205C12.1973 13.2051 12.4258 13.3018 12.707 13.3018C13.2432 13.3018 13.6562 12.8887 13.6562 12.3525C13.6562 12.0977 13.5508 11.8691 13.3662 11.6934L11.3535 9.67188L13.375 7.6416C13.5596 7.44824 13.6562 7.22852 13.6562 6.98242C13.6562 6.44629 13.2432 6.0332 12.7158 6.0332C12.4346 6.0332 12.2148 6.12109 12.0215 6.31445L10 8.32715L7.9873 6.32324C7.80273 6.12988 7.58301 6.04199 7.29297 6.04199C6.76562 6.04199 6.35254 6.45508 6.35254 6.99121C6.35254 7.2373 6.44922 7.46582 6.63379 7.6416L8.65527 9.67188L6.63379 11.6934C6.44922 11.8691 6.35254 12.1064 6.35254 12.3525C6.35254 12.8887 6.76562 13.3018 7.29297 13.3018Z",fill:"currentColor"})),xde=()=>fe.createElement("svg",{fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Success"),fe.createElement("path",{d:"M10 19.4443C15.0977 19.4443 19.2812 15.252 19.2812 10.1543C19.2812 5.06543 15.0889 0.873047 10 0.873047C4.90234 0.873047 0.71875 5.06543 0.71875 10.1543C0.71875 15.252 4.91113 19.4443 10 19.4443ZM10 17.1328C6.1416 17.1328 3.03906 14.0215 3.03906 10.1543C3.03906 6.2959 6.13281 3.18457 10 3.18457C13.8584 3.18457 16.9697 6.2959 16.9697 10.1543C16.9785 14.0215 13.8672 17.1328 10 17.1328ZM9.07715 14.3379C9.4375 14.3379 9.7627 14.1533 9.97363 13.8369L13.7441 8.00977C13.8848 7.79883 13.9814 7.5791 13.9814 7.36816C13.9814 6.84961 13.5244 6.48926 13.0322 6.48926C12.707 6.48926 12.4258 6.66504 12.2148 7.0166L9.05957 12.0967L7.5918 10.2949C7.37207 10.0225 7.13477 9.9082 6.84473 9.9082C6.33496 9.9082 5.92188 10.3125 5.92188 10.8223C5.92188 11.0684 6.00098 11.2793 6.18555 11.5078L8.1543 13.8545C8.40918 14.1709 8.70801 14.3379 9.07715 14.3379Z",fill:"currentColor"})),_de=t=>{switch(t){case"pending":return Cw;case"confirmed":return xde;case"failed":return yde;default:return Cw}};function vde({tx:t}){const e=Fa(),n=_de(t.status),s=t.status==="failed"?"error":"accentColor",{chain:l}=qc(),u=t.status==="confirmed"?"Confirmed":t.status==="failed"?"Failed":"Pending",p=UH(l);return fe.createElement(fe.Fragment,null,fe.createElement(At,{...p?{as:"a",background:{hover:"profileForeground"},borderRadius:"menuButton",className:ja({active:"shrink"}),href:`${p}/tx/${t.hash}`,rel:"noreferrer noopener",target:"_blank",transition:"default"}:{},color:"modalText",display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"8",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:e?"16":"14"},fe.createElement(At,{color:s},fe.createElement(n,null)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:e?"3":"1"},fe.createElement(At,null,fe.createElement(_i,{color:"modalText",font:"body",size:e?"16":"14",weight:"bold"},t==null?void 0:t.description)),fe.createElement(At,null,fe.createElement(_i,{color:t.status==="pending"?"modalTextSecondary":s,font:"body",size:"14",weight:e?"medium":"regular"},u)))),p&&fe.createElement(At,{alignItems:"center",color:"modalTextDim",display:"flex"},fe.createElement(VH,null))))}var bde=3;function wde({address:t}){const e=EH(),n=gde(),{chain:s}=qc(),l=UH(s),u=e.slice(0,bde),p=u.length>0,r=Fa(),{appName:v}=he.useContext(g2),{i18n:w}=he.useContext(Ba);return fe.createElement(fe.Fragment,null,fe.createElement(At,{display:"flex",flexDirection:"column",gap:"10",paddingBottom:"2",paddingTop:"16",paddingX:r?"8":"18"},p&&fe.createElement(At,{paddingBottom:r?"4":"0",paddingTop:"8",paddingX:r?"12":"6"},fe.createElement(At,{display:"flex",justifyContent:"space-between"},fe.createElement(_i,{color:"modalTextSecondary",size:r?"16":"14",weight:"semibold"},w.t("profile.transactions.recent.title")),fe.createElement(At,{style:{marginBottom:-6,marginLeft:-10,marginRight:-10,marginTop:-6}},fe.createElement(At,{as:"button",background:{hover:"profileForeground"},borderRadius:"actionButton",className:ja({active:"shrink"}),onClick:n,paddingX:r?"8":"12",paddingY:r?"4":"5",transition:"default",type:"button"},fe.createElement(_i,{color:"modalTextSecondary",size:r?"16":"14",weight:"semibold"},w.t("profile.transactions.clear.label")))))),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},p?u.map(E=>fe.createElement(vde,{key:E.hash,tx:E})):fe.createElement(fe.Fragment,null,fe.createElement(At,{padding:r?"12":"8"},fe.createElement(_i,{color:"modalTextDim",size:r?"16":"14",weight:r?"medium":"bold"},v?w.t("profile.transactions.description",{appName:v}):w.t("profile.transactions.description_fallback"))),r&&fe.createElement(At,{background:"generalBorderDim",height:"1",marginX:"12",marginY:"8"})))),l&&fe.createElement(At,{paddingBottom:"18",paddingX:r?"8":"18"},fe.createElement(At,{alignItems:"center",as:"a",background:{hover:"profileForeground"},borderRadius:"menuButton",className:ja({active:"shrink"}),color:"modalTextDim",display:"flex",flexDirection:"row",href:`${l}/address/${t}`,justifyContent:"space-between",paddingX:"8",paddingY:"12",rel:"noreferrer noopener",style:{willChange:"transform"},target:"_blank",transition:"default",width:"full",...r?{paddingLeft:"12"}:{}},fe.createElement(_i,{color:"modalText",font:"body",size:r?"16":"14",weight:r?"semibold":"bold"},w.t("profile.explorer.label")),fe.createElement(VH,null))))}function gF({action:t,icon:e,label:n,testId:s,url:l}){const u=Fa();return fe.createElement(At,{...l?{as:"a",href:l,rel:"noreferrer noopener",target:"_blank"}:{as:"button",type:"button"},background:{base:"profileAction",...u?{}:{hover:"profileActionHover"}},borderRadius:"menuButton",boxShadow:"profileDetailsAction",className:ja({active:"shrinkSm",hover:u?void 0:"grow"}),display:"flex",onClick:t,padding:u?"6":"8",style:{willChange:"transform"},testId:s,transition:"default",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"1",justifyContent:"center",paddingTop:"2",width:"full"},fe.createElement(At,{color:"modalText",height:"max"},e),fe.createElement(At,null,fe.createElement(_i,{color:"modalText",size:u?"12":"13",weight:"semibold"},n))))}function Sde({address:t,ensAvatar:e,ensName:n,balance:s,onClose:l,onDisconnect:u}){const p=he.useContext(kR),[r,v]=he.useState(!1),w=he.useCallback(()=>{t&&(navigator.clipboard.writeText(t),v(!0))},[t]);if(he.useEffect(()=>{if(r){const F=setTimeout(()=>{v(!1)},1500);return()=>clearTimeout(F)}},[r]),!t)return null;const E=n?zH(n):BH(t),T=s==null?void 0:s.formatted,k=T?FH(Number.parseFloat(T)):void 0,R="rk_profile_title",D=Fa(),{i18n:O}=he.useContext(Ba);return fe.createElement(fe.Fragment,null,fe.createElement(At,{display:"flex",flexDirection:"column"},fe.createElement(At,{background:"profileForeground",padding:"16"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:D?"16":"12",justifyContent:"center",margin:"8",style:{textAlign:"center"}},fe.createElement(At,{style:{position:"absolute",right:16,top:16,willChange:"transform"}},fe.createElement(Vx,{onClose:l}))," ",fe.createElement(At,{marginTop:D?"24":"0"},fe.createElement(gH,{address:t,imageUrl:e,size:D?82:74})),fe.createElement(At,{display:"flex",flexDirection:"column",gap:D?"4":"0",textAlign:"center"},fe.createElement(At,{textAlign:"center"},fe.createElement(_i,{as:"h1",color:"modalText",id:R,size:D?"20":"18",weight:"heavy"},E)),!!s&&fe.createElement(At,{textAlign:"center"},fe.createElement(_i,{as:"h1",color:"modalTextSecondary",id:R,size:D?"16":"14",weight:"semibold"},k," ",s.symbol)))),fe.createElement(At,{display:"flex",flexDirection:"row",gap:"8",margin:"2",marginTop:"16"},fe.createElement(gF,{action:w,icon:r?fe.createElement(fde,null):fe.createElement(pde,null),label:r?O.t("profile.copy_address.copied"):O.t("profile.copy_address.label")}),fe.createElement(gF,{action:u,icon:fe.createElement(mde,null),label:O.t("profile.disconnect.label"),testId:"disconnect-button"}))),p&&fe.createElement(fe.Fragment,null,fe.createElement(At,{background:"generalBorder",height:"1",marginTop:"-1"}),fe.createElement(At,null,fe.createElement(wde,{address:t})))))}function Tde({onClose:t,open:e}){const{address:n}=qc(),{balance:s,ensAvatar:l,ensName:u}=bH({address:n,includeBalance:e}),{disconnect:p}=EA();return n?fe.createElement(fe.Fragment,null,n&&fe.createElement(vE,{onClose:t,open:e,titleId:"rk_account_modal_title"},fe.createElement(bE,{bottomSheetOnMobile:!0,padding:"0"},fe.createElement(Sde,{address:n,ensAvatar:l,ensName:u,balance:s,onClose:t,onDisconnect:p})))):null}var Ede=({size:t})=>fe.createElement("svg",{fill:"none",height:t,viewBox:"0 0 28 28",width:t,xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Disconnect"),fe.createElement("path",{d:"M6.742 22.195h8.367c1.774 0 2.743-.968 2.743-2.758V16.11h-2.016v3.11c0 .625-.305.96-.969.96H6.984c-.664 0-.968-.335-.968-.96V7.984c0-.632.304-.968.968-.968h7.883c.664 0 .969.336.969.968v3.133h2.016v-3.36c0-1.78-.97-2.757-2.743-2.757H6.742C4.97 5 4 5.977 4 7.758v11.68c0 1.789.969 2.757 2.742 2.757Zm5.438-7.703h7.601l1.149-.07-.602.406-1.008.938a.816.816 0 0 0-.258.593c0 .407.313.782.758.782.227 0 .39-.086.547-.243l2.492-2.593c.235-.235.313-.47.313-.711 0-.242-.078-.477-.313-.719l-2.492-2.586c-.156-.156-.32-.25-.547-.25-.445 0-.758.367-.758.781 0 .227.094.446.258.594l1.008.945.602.407-1.149-.079H12.18a.904.904 0 0 0 0 1.805Z",fill:"currentColor"})),Ade="v9horb0",jR=fe.forwardRef(({children:t,currentlySelected:e=!1,onClick:n,testId:s,...l},u)=>{const p=Fa();return fe.createElement(At,{as:"button",borderRadius:"menuButton",disabled:e,display:"flex",onClick:n,ref:u,testId:s,type:"button"},fe.createElement(At,{borderRadius:"menuButton",className:[p?Ade:void 0,!e&&ja({active:"shrink"})],padding:p?"8":"6",transition:"default",width:"full",...e?{background:"accentColor",borderColor:"selectedOptionBorder",borderStyle:"solid",borderWidth:"1",boxShadow:"selectedOption",color:"accentColorForeground"}:{background:{hover:"menuItemBackground"},color:"modalText",transition:"default"},...l},t))});jR.displayName="MenuButton";var Cde=({chainId:t,currentChainId:e,switchChain:n,chainIconSize:s,isLoading:l,src:u,name:p,iconBackground:r,idx:v})=>{const w=Fa(),{i18n:E}=he.useContext(Ba),T=Qx(),k=e===t;return fe.createElement(he.Fragment,null,fe.createElement(jR,{currentlySelected:k,onClick:k?void 0:()=>n({chainId:t}),testId:`chain-option-${t}`},fe.createElement(At,{fontFamily:"body",fontSize:"16",fontWeight:"bold"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"space-between"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"4",height:s},u&&fe.createElement(At,{height:"full",marginRight:"8"},fe.createElement(Sl,{alt:p,background:r,borderRadius:"full",height:s,src:u,width:s,testId:`chain-option-${t}-icon`})),fe.createElement("div",null,p??p)),k&&fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",marginRight:"6"},fe.createElement(_i,{color:"accentColorForeground",size:"14",weight:"medium"},E.t("chains.connected")),fe.createElement(At,{background:"connectionIndicator",borderColor:"selectedOptionBorder",borderRadius:"full",borderStyle:"solid",borderWidth:"1",height:"8",marginLeft:"8",width:"8"})),l&&fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",marginRight:"6"},fe.createElement(_i,{color:"modalText",size:"14",weight:"medium"},E.t("chains.confirm")),fe.createElement(At,{background:"standby",borderRadius:"full",height:"8",marginLeft:"8",width:"8"}))))),w&&v<T.length-1&&fe.createElement(At,{background:"generalBorderDim",height:"1",marginX:"8"}))},Mde=Cde,kde="_18dqw9x0",Ide="_18dqw9x1";function Pde({onClose:t,open:e}){const{chainId:n}=qc(),{chains:s}=Tl(),[l,u]=he.useState(null),{switchChain:p}=cae({mutation:{onMutate:({chainId:D})=>{u(D)},onSuccess:()=>{l&&u(null)},onError:()=>{l&&u(null)},onSettled:()=>{t()}}}),{i18n:r}=he.useContext(Ba),{disconnect:v}=EA(),w="rk_chain_modal_title",E=Fa(),T=s.some(D=>D.id===n),k=E?"36":"28",R=Qx();return n?fe.createElement(vE,{onClose:t,open:e,titleId:w},fe.createElement(bE,{bottomSheetOnMobile:!0,paddingBottom:"0"},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"14"},fe.createElement(At,{display:"flex",flexDirection:"row",justifyContent:"space-between"},E&&fe.createElement(At,{width:"30"}),fe.createElement(At,{paddingBottom:"0",paddingLeft:"8",paddingTop:"4"},fe.createElement(_i,{as:"h1",color:"modalText",id:w,size:E?"20":"18",weight:"heavy"},r.t("chains.title"))),fe.createElement(Vx,{onClose:t})),!T&&fe.createElement(At,{marginX:"8",textAlign:E?"center":"left"},fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},r.t("chains.wrong_network"))),fe.createElement(At,{className:E?Ide:kde,display:"flex",flexDirection:"column",gap:"4",padding:"2",paddingBottom:"16"},R.map(({iconBackground:D,iconUrl:O,id:F,name:U},X)=>fe.createElement(Mde,{key:F,chainId:F,currentChainId:n,switchChain:p,chainIconSize:k,isLoading:l===F,src:O,name:U,iconBackground:D,idx:X})),!T&&fe.createElement(fe.Fragment,null,fe.createElement(At,{background:"generalBorderDim",height:"1",marginX:"8"}),fe.createElement(jR,{onClick:()=>v(),testId:"chain-option-disconnect"},fe.createElement(At,{color:"error",fontFamily:"body",fontSize:"16",fontWeight:"bold"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"space-between"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"4",height:k},fe.createElement(At,{alignItems:"center",color:"error",height:k,justifyContent:"center",marginRight:"8"},fe.createElement(Ede,{size:Number(k)})),fe.createElement("div",null,r.t("chains.disconnect"))))))))))):null}function Rde(t,e){const n={};for(const s of t){const l=e(s);l&&(n[l]||(n[l]=[]),n[l].push(s))}return n}var DR=({children:t,href:e})=>fe.createElement(At,{as:"a",color:"accentColor",href:e,rel:"noreferrer",target:"_blank"},t),LR=({children:t})=>fe.createElement(_i,{color:"modalTextSecondary",size:"12",weight:"medium"},t);function yF({compactModeEnabled:t=!1,getWallet:e}){const{disclaimer:n,learnMoreUrl:s}=he.useContext(g2),{i18n:l}=he.useContext(Ba);return fe.createElement(fe.Fragment,null,fe.createElement(At,{alignItems:"center",color:"accentColor",display:"flex",flexDirection:"column",height:"full",justifyContent:"space-around"},fe.createElement(At,{marginBottom:"10"},!t&&fe.createElement(_i,{color:"modalText",size:"18",weight:"heavy"},l.t("intro.title"))),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"32",justifyContent:"center",marginY:"20",style:{maxWidth:312}},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16"},fe.createElement(At,{borderRadius:"6",height:"48",minWidth:"48",width:"48"},fe.createElement(Gue,null)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},l.t("intro.digital_asset.title")),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},l.t("intro.digital_asset.description")))),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16"},fe.createElement(At,{borderRadius:"6",height:"48",minWidth:"48",width:"48"},fe.createElement(Wue,null)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},l.t("intro.login.title")),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},l.t("intro.login.description"))))),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"12",justifyContent:"center",margin:"10"},fe.createElement(Gc,{label:l.t("intro.get.label"),onClick:e}),fe.createElement(At,{as:"a",className:ja({active:"shrink",hover:"grow"}),display:"block",href:s,paddingX:"12",paddingY:"4",rel:"noreferrer",style:{willChange:"transform"},target:"_blank",transition:"default"},fe.createElement(_i,{color:"accentColor",size:"14",weight:"bold"},l.t("intro.learn_more.label")))),n&&!t&&fe.createElement(At,{marginBottom:"8",marginTop:"12",textAlign:"center"},fe.createElement(n,{Link:DR,Text:LR}))))}var HH=()=>fe.createElement("svg",{fill:"none",height:"17",viewBox:"0 0 11 17",width:"11",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Back"),fe.createElement("path",{d:"M0.99707 8.6543C0.99707 9.08496 1.15527 9.44531 1.51562 9.79688L8.16016 16.3096C8.43262 16.5732 8.74902 16.7051 9.13574 16.7051C9.90918 16.7051 10.5508 16.0811 10.5508 15.3076C10.5508 14.9121 10.3838 14.5605 10.0938 14.2705L4.30176 8.64551L10.0938 3.0293C10.3838 2.74805 10.5508 2.3877 10.5508 2.00098C10.5508 1.23633 9.90918 0.603516 9.13574 0.603516C8.74902 0.603516 8.43262 0.735352 8.16016 0.999023L1.51562 7.51172C1.15527 7.85449 1.00586 8.21484 0.99707 8.6543Z",fill:"currentColor"})),Nde=()=>fe.createElement("svg",{fill:"none",height:"12",viewBox:"0 0 8 12",width:"8",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("title",null,"Info"),fe.createElement("path",{d:"M3.64258 7.99609C4.19336 7.99609 4.5625 7.73828 4.68555 7.24609C4.69141 7.21094 4.70312 7.16406 4.70898 7.13477C4.80859 6.60742 5.05469 6.35547 6.04492 5.76367C7.14648 5.10156 7.67969 4.3457 7.67969 3.24414C7.67969 1.39844 6.17383 0.255859 3.95898 0.255859C2.32422 0.255859 1.05859 0.894531 0.548828 1.86719C0.396484 2.14844 0.320312 2.44727 0.320312 2.74023C0.314453 3.37305 0.742188 3.79492 1.42188 3.79492C1.91406 3.79492 2.33594 3.54883 2.53516 3.11523C2.78711 2.47656 3.23242 2.21289 3.83594 2.21289C4.55664 2.21289 5.10742 2.65234 5.10742 3.29102C5.10742 3.9707 4.7793 4.29883 3.81836 4.87891C3.02148 5.36523 2.50586 5.92773 2.50586 6.76562V6.90039C2.50586 7.55664 2.96289 7.99609 3.64258 7.99609ZM3.67188 11.4473C4.42773 11.4473 5.04297 10.8672 5.04297 10.1406C5.04297 9.41406 4.42773 8.83984 3.67188 8.83984C2.91602 8.83984 2.30664 9.41406 2.30664 10.1406C2.30664 10.8672 2.91602 11.4473 3.67188 11.4473Z",fill:"currentColor"})),jde=({"aria-label":t="Info",onClick:e})=>{const n=Fa();return fe.createElement(At,{alignItems:"center","aria-label":t,as:"button",background:"closeButtonBackground",borderColor:"actionButtonBorder",borderRadius:"full",borderStyle:"solid",borderWidth:n?"0":"1",className:ja({active:"shrinkSm",hover:"growLg"}),color:"closeButton",display:"flex",height:n?"30":"28",justifyContent:"center",onClick:e,style:{willChange:"transform"},transition:"default",type:"button",width:n?"30":"28"},fe.createElement(Nde,null))},GH=t=>{const e=he.useRef(null),n=he.useContext(CH),s=PA(t);return he.useEffect(()=>{if(n&&e.current&&s)return Lde(e.current,s)},[n,s]),e},Dde=()=>{const t="_rk_coolMode",e=document.getElementById(t);if(e)return e;const n=document.createElement("div");return n.setAttribute("id",t),n.setAttribute("style",["overflow:hidden","position:fixed","height:100%","top:0","left:0","right:0","bottom:0","pointer-events:none","z-index:2147483647"].join(";")),document.body.appendChild(n),n},xF=0;function Lde(t,e){xF++;const n=[15,20,25,35,45],s=35;let l=[],u=!1,p=0,r=0;const v=Dde();function w(){const K=n[Math.floor(Math.random()*n.length)],ne=Math.random()*10,te=Math.random()*25,re=Math.random()*360,xe=Math.random()*35*(Math.random()<=.5?-1:1),ae=r-K/2,ce=p-K/2,ye=Math.random()<=.5?-1:1,Ce=document.createElement("div");Ce.innerHTML=`<img src="${e}" width="${K}" height="${K}" style="border-radius: 25%">`,Ce.setAttribute("style",["position:absolute","will-change:transform",`top:${ae}px`,`left:${ce}px`,`transform:rotate(${re}deg)`].join(";")),v.appendChild(Ce),l.push({direction:ye,element:Ce,left:ce,size:K,speedHorz:ne,speedUp:te,spinSpeed:xe,spinVal:re,top:ae})}function E(){for(const K of l)K.left=K.left-K.speedHorz*K.direction,K.top=K.top-K.speedUp,K.speedUp=Math.min(K.size,K.speedUp-1),K.spinVal=K.spinVal+K.spinSpeed,K.top>=Math.max(window.innerHeight,document.body.clientHeight)+K.size&&(l=l.filter(ne=>ne!==K),K.element.remove()),K.element.setAttribute("style",["position:absolute","will-change:transform",`top:${K.top}px`,`left:${K.left}px`,`transform:rotate(${K.spinVal}deg)`].join(";"))}let T;function k(){u&&l.length<s&&w(),E(),T=requestAnimationFrame(k)}k();const R="ontouchstart"in window||navigator.msMaxTouchPoints,D=R?"touchstart":"mousedown",O=R?"touchend":"mouseup",F=R?"touchmove":"mousemove",U=K=>{var ne,te;"touches"in K?(p=(ne=K.touches)==null?void 0:ne[0].clientX,r=(te=K.touches)==null?void 0:te[0].clientY):(p=K.clientX,r=K.clientY)},X=K=>{U(K),u=!0},W=()=>{u=!1};return t.addEventListener(F,U,{passive:!1}),t.addEventListener(D,X),t.addEventListener(O,W),t.addEventListener("mouseleave",W),()=>{t.removeEventListener(F,U),t.removeEventListener(D,X),t.removeEventListener(O,W),t.removeEventListener("mouseleave",W);const K=setInterval(()=>{T&&l.length===0&&(cancelAnimationFrame(T),clearInterval(K),--xF===0&&v.remove())},500)}}var Ode="g5kl0l0",$H=({as:t="button",currentlySelected:e=!1,iconBackground:n,iconUrl:s,name:l,onClick:u,ready:p,recent:r,testId:v,isRainbowKitConnector:w,...E})=>{const T=GH(s),[k,R]=fe.useState(!1),{i18n:D}=fe.useContext(Ba);return fe.createElement(At,{display:"flex",flexDirection:"column",onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),ref:T},fe.createElement(At,{as:t,borderRadius:"menuButton",borderStyle:"solid",borderWidth:"1",className:e?void 0:[Ode,ja({active:"shrink"})],disabled:e,onClick:u,padding:"5",style:{willChange:"transform"},testId:v,transition:"default",width:"full",...e?{background:"accentColor",borderColor:"selectedOptionBorder",boxShadow:"selectedWallet"}:{background:{hover:"menuItemBackground"}},...E},fe.createElement(At,{color:e?"accentColorForeground":"modalText",disabled:!p,fontFamily:"body",fontSize:"16",fontWeight:"bold",transition:"default"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"12"},fe.createElement(Sl,{background:n,...!k&&w?{borderColor:"actionButtonBorder"}:{},useAsImage:!w,borderRadius:"6",height:"28",src:s,width:"28"}),fe.createElement(At,null,fe.createElement(At,{style:{marginTop:r?-2:void 0},maxWidth:"200"},l),r&&fe.createElement(_i,{color:e?"accentColorForeground":"accentColor",size:"12",style:{lineHeight:1,marginTop:-1},weight:"medium"},D.t("connect.recent")))))))};$H.displayName="ModalSelection";var Fde="rk-latest-id";function Bde(t){localStorage.setItem(Fde,t)}var mM=(t,e=1)=>{let n=t.replace("#","");n.length===3&&(n=`${n[0]}${n[0]}${n[1]}${n[1]}${n[2]}${n[2]}`);const s=Number.parseInt(n.substring(0,2),16),l=Number.parseInt(n.substring(2,4),16),u=Number.parseInt(n.substring(4,6),16);return e>1&&e<=100&&(e=e/100),`rgba(${s},${l},${u},${e})`},zde=t=>t?[mM(t,.2),mM(t,.14),mM(t,.1)]:null,Ude=t=>/^#([0-9a-f]{3}){1,2}$/i.test(t),WH=async()=>(await hr(async()=>{const{default:t}=await import("./connect-UA7M4XW6-IY3X6Bmr.js");return{default:t}},[])).default,Vde=()=>Sp(WH),Hde=()=>fe.createElement(Sl,{background:"#515a70",borderColor:"generalBorder",borderRadius:"10",height:"48",src:WH,width:"48"}),qH=async()=>(await hr(async()=>{const{default:t}=await import("./create-FASO7PVG-D_rvSpre.js");return{default:t}},[])).default,XH=()=>Sp(qH),Gde=()=>fe.createElement(Sl,{background:"#e3a5e8",borderColor:"generalBorder",borderRadius:"10",height:"48",src:qH,width:"48"}),ZH=async()=>(await hr(async()=>{const{default:t}=await import("./refresh-S4T5V5GX-CwqIaaxK.js");return{default:t}},[])).default,$de=()=>Sp(ZH),Wde=()=>fe.createElement(Sl,{background:"#515a70",borderColor:"generalBorder",borderRadius:"10",height:"48",src:ZH,width:"48"}),QH=async()=>(await hr(async()=>{const{default:t}=await import("./scan-4UYSQ56Q-CjMz6-XC.js");return{default:t}},[])).default,KH=()=>Sp(QH),qde=()=>fe.createElement(Sl,{background:"#515a70",borderColor:"generalBorder",borderRadius:"10",height:"48",src:QH,width:"48"}),Xde="_1vwt0cg0",Zde="_1vwt0cg2 ju367v7a ju367v7v",Qde="_1vwt0cg3",Kde="_1vwt0cg4";function YH({ecc:t="medium",logoBackground:e,logoSize:n=50,logoUrl:s,size:l=200,uri:u}){const r=l-Number.parseInt("20",10)*2,v=PA(s);return fe.createElement(At,{borderColor:"generalBorder",borderRadius:"menuButton",borderStyle:"solid",borderWidth:"1",className:Xde,padding:"20",width:"max"},fe.createElement(At,{style:{height:r,userSelect:"none",width:r},userSelect:"none"},fe.createElement(mp.Root,{errorCorrection:t,size:r,value:u},fe.createElement(mp.Cells,{radius:1}),fe.createElement(mp.Finder,{radius:.25}),v&&fe.createElement(mp.Arena,null,fe.createElement("img",{alt:"Wallet Logo",src:v,style:{objectFit:"cover",height:"88%",width:"88%",borderRadius:"22.5%",backgroundColor:e}})))))}var JH=async()=>{switch(PR()){case"Arc":return(await hr(async()=>{const{default:e}=await import("./Arc-VDBY7LNS-BChRXCXW.js");return{default:e}},[])).default;case"Brave":return(await hr(async()=>{const{default:e}=await import("./Brave-BRAKJXDS-mq-Xo37j.js");return{default:e}},[])).default;case"Chrome":return(await hr(async()=>{const{default:e}=await import("./Chrome-65Q5P54Y-DR9MQEVr.js");return{default:e}},[])).default;case"Edge":return(await hr(async()=>{const{default:e}=await import("./Edge-XSPUTORV-DEoZslQE.js");return{default:e}},[])).default;case"Firefox":return(await hr(async()=>{const{default:e}=await import("./Firefox-AAHGJQIP-Bp_Hm04m.js");return{default:e}},[])).default;case"Opera":return(await hr(async()=>{const{default:e}=await import("./Opera-KQZLSACL-Cwv5MDFy.js");return{default:e}},[])).default;case"Safari":return(await hr(async()=>{const{default:e}=await import("./Safari-ZPL37GXR-C4Ggg6rz.js");return{default:e}},[])).default;default:return(await hr(async()=>{const{default:e}=await import("./Browser-76IHF3Y2-BMhRaC5Z.js");return{default:e}},[])).default}},Yde=()=>Sp(JH),eG=async()=>{switch(NR()){case"Windows":return(await hr(async()=>{const{default:e}=await import("./Windows-PPTHQER6-BlyV2p7Y.js");return{default:e}},[])).default;case"macOS":return(await hr(async()=>{const{default:e}=await import("./Macos-MW4AE7LN-Vvm8Drw3.js");return{default:e}},[])).default;case"Linux":return(await hr(async()=>{const{default:e}=await import("./Linux-OO4TNCLJ-B0aw93n9.js");return{default:e}},[])).default;default:return(await hr(async()=>{const{default:e}=await import("./Linux-OO4TNCLJ-B0aw93n9.js");return{default:e}},[])).default}},Jde=()=>Sp(eG);function ehe({getWalletDownload:t,compactModeEnabled:e}){const s=Mw().filter(u=>u.isRainbowKitConnector).splice(0,5),{i18n:l}=he.useContext(Ba);return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",height:"full",marginTop:"18",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"28",height:"full",width:"full"},s==null?void 0:s.filter(u=>{var p;return u.extensionDownloadUrl||u.desktopDownloadUrl||u.qrCode&&((p=u.downloadUrls)==null?void 0:p.qrCode)}).map(u=>{const{downloadUrls:p,iconBackground:r,iconUrl:v,id:w,name:E,qrCode:T}=u,k=(p==null?void 0:p.qrCode)&&T,R=!!u.extensionDownloadUrl,D=(p==null?void 0:p.qrCode)&&R,O=(p==null?void 0:p.qrCode)&&!!u.desktopDownloadUrl;return fe.createElement(At,{alignItems:"center",display:"flex",gap:"16",justifyContent:"space-between",key:u.id,width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16"},fe.createElement(Sl,{background:r,borderColor:"actionButtonBorder",borderRadius:"10",height:"48",src:v,width:"48"}),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"2"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},E),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},D?l.t("get.mobile_and_extension.description"):O?l.t("get.mobile_and_desktop.description"):k?l.t("get.mobile.description"):R?l.t("get.extension.description"):null))),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(Gc,{label:l.t("get.action.label"),onClick:()=>t(w),type:"secondary"})))})),fe.createElement(At,{alignItems:"center",borderRadius:"10",display:"flex",flexDirection:"column",gap:"8",justifyContent:"space-between",marginBottom:"4",paddingY:"8",style:{maxWidth:275,textAlign:"center"}},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},l.t("get.looking_for.title")),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},e?l.t("get.looking_for.desktop.compact_description"):l.t("get.looking_for.desktop.wide_description"))))}var gM="44";function the({changeWalletStep:t,compactModeEnabled:e,connectionError:n,onClose:s,qrCodeUri:l,reconnect:u,wallet:p}){const{downloadUrls:r,iconBackground:v,iconUrl:w,name:E,qrCode:T,ready:k,showWalletConnectModal:R,getDesktopUri:D}=p,O=!!D,F=IR(),{i18n:U}=he.useContext(Ba),X=!!p.extensionDownloadUrl,W=(r==null?void 0:r.qrCode)&&X,K=(r==null?void 0:r.qrCode)&&!!p.desktopDownloadUrl,ne=T&&l,te=async()=>{const ce=await(D==null?void 0:D());window.open(ce,F?"_blank":"_self")},re=R?{description:e?U.t("connect.walletconnect.description.compact"):U.t("connect.walletconnect.description.full"),label:U.t("connect.walletconnect.open.label"),onClick:()=>{s(),R()}}:ne?{description:U.t("connect.secondary_action.get.description",{wallet:E}),label:U.t("connect.secondary_action.get.label"),onClick:()=>t(W||K?"DOWNLOAD_OPTIONS":"DOWNLOAD")}:null,{width:xe}=MH(),ae=xe&&xe<768;return he.useEffect(()=>{Yde(),Jde()},[]),fe.createElement(At,{display:"flex",flexDirection:"column",height:"full",width:"full"},ne?fe.createElement(At,{alignItems:"center",display:"flex",height:"full",justifyContent:"center"},fe.createElement(YH,{logoBackground:v,logoSize:e?60:72,logoUrl:w,size:e?318:ae?Math.max(280,Math.min(xe-308,382)):382,uri:l})):fe.createElement(At,{alignItems:"center",display:"flex",justifyContent:"center",style:{flexGrow:1}},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"8"},fe.createElement(At,{borderRadius:"10",height:gM,overflow:"hidden"},fe.createElement(Sl,{useAsImage:!p.isRainbowKitConnector,height:gM,src:w,width:gM})),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"4",paddingX:"32",style:{textAlign:"center"}},fe.createElement(_i,{color:"modalText",size:"18",weight:"bold"},k?U.t("connect.status.opening",{wallet:E}):X?U.t("connect.status.not_installed",{wallet:E}):U.t("connect.status.not_available",{wallet:E})),!k&&X?fe.createElement(At,{paddingTop:"20"},fe.createElement(Gc,{href:p.extensionDownloadUrl,label:U.t("connect.secondary_action.install.label"),type:"secondary"})):null,k&&!ne&&fe.createElement(fe.Fragment,null,fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"},fe.createElement(_i,{color:"modalTextSecondary",size:"14",textAlign:"center",weight:"medium"},U.t("connect.status.confirm"))),fe.createElement(At,{alignItems:"center",color:"modalText",display:"flex",flexDirection:"row",height:"32",marginTop:"8"},n?fe.createElement(Gc,{label:U.t("connect.secondary_action.retry.label"),onClick:async()=>{O&&te(),u(p)}}):fe.createElement(At,{color:"modalTextSecondary"},fe.createElement(Cw,null))))))),fe.createElement(At,{alignItems:"center",borderRadius:"10",display:"flex",flexDirection:"row",gap:"8",height:"28",justifyContent:"space-between",marginTop:"12"},k&&re&&fe.createElement(fe.Fragment,null,fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},re.description),fe.createElement(Gc,{label:re.label,onClick:re.onClick,type:"secondary"}))))}var yM=({actionLabel:t,description:e,iconAccent:n,iconBackground:s,iconUrl:l,isCompact:u,onAction:p,title:r,url:v,variant:w})=>{const E=w==="browser",T=!E&&n&&zde(n);return fe.createElement(At,{alignItems:"center",borderRadius:"13",display:"flex",justifyContent:"center",overflow:"hidden",paddingX:u?"18":"44",position:"relative",style:{flex:1,isolation:"isolate"},width:"full"},fe.createElement(At,{borderColor:"actionButtonBorder",borderRadius:"13",borderStyle:"solid",borderWidth:"1",style:{bottom:"0",left:"0",position:"absolute",right:"0",top:"0",zIndex:1}}),E&&fe.createElement(At,{background:"downloadTopCardBackground",height:"full",position:"absolute",style:{zIndex:0},width:"full"},fe.createElement(At,{display:"flex",flexDirection:"row",justifyContent:"space-between",style:{bottom:"0",filter:"blur(20px)",left:"0",position:"absolute",right:"0",top:"0",transform:"translate3d(0, 0, 0)"}},fe.createElement(At,{style:{filter:"blur(100px)",marginLeft:-27,marginTop:-20,opacity:.6,transform:"translate3d(0, 0, 0)"}},fe.createElement(Sl,{borderRadius:"full",height:"200",src:l,width:"200"})),fe.createElement(At,{style:{filter:"blur(100px)",marginRight:0,marginTop:105,opacity:.6,overflow:"auto",transform:"translate3d(0, 0, 0)"}},fe.createElement(Sl,{borderRadius:"full",height:"200",src:l,width:"200"})))),!E&&T&&fe.createElement(At,{background:"downloadBottomCardBackground",style:{bottom:"0",left:"0",position:"absolute",right:"0",top:"0"}},fe.createElement(At,{position:"absolute",style:{background:`radial-gradient(50% 50% at 50% 50%, ${T[0]} 0%, ${T[1]} 25%, rgba(0,0,0,0) 100%)`,height:564,left:-215,top:-197,transform:"translate3d(0, 0, 0)",width:564}}),fe.createElement(At,{position:"absolute",style:{background:`radial-gradient(50% 50% at 50% 50%, ${T[2]} 0%, rgba(0, 0, 0, 0) 100%)`,height:564,left:-1,top:-76,transform:"translate3d(0, 0, 0)",width:564}})),fe.createElement(At,{alignItems:"flex-start",display:"flex",flexDirection:"row",gap:"24",height:"max",justifyContent:"center",style:{zIndex:1}},fe.createElement(At,null,fe.createElement(Sl,{height:"60",src:l,width:"60",...s?{background:s,borderColor:"generalBorder",borderRadius:"10"}:null})),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4",style:{flex:1},width:"full"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},r),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},e),fe.createElement(At,{marginTop:"14",width:"max"},fe.createElement(Gc,{href:v,label:t,onClick:p,size:"medium"})))))};function nhe({changeWalletStep:t,wallet:e}){const n=PR(),s=NR(),u=he.useContext(RA)==="compact",{desktop:p,desktopDownloadUrl:r,extension:v,extensionDownloadUrl:w,mobileDownloadUrl:E}=e,{i18n:T}=he.useContext(Ba);return he.useEffect(()=>{XH(),KH(),$de(),Vde()},[]),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"24",height:"full",marginBottom:"8",marginTop:"4",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"8",height:"full",justifyContent:"center",width:"full"},w&&fe.createElement(yM,{actionLabel:T.t("get_options.extension.download.label",{browser:n}),description:T.t("get_options.extension.description"),iconUrl:JH,isCompact:u,onAction:()=>t(v!=null&&v.instructions?"INSTRUCTIONS_EXTENSION":"CONNECT"),title:T.t("get_options.extension.title",{wallet:e.name,browser:n}),url:w,variant:"browser"}),r&&fe.createElement(yM,{actionLabel:T.t("get_options.desktop.download.label",{platform:s}),description:T.t("get_options.desktop.description"),iconUrl:eG,isCompact:u,onAction:()=>t(p!=null&&p.instructions?"INSTRUCTIONS_DESKTOP":"CONNECT"),title:T.t("get_options.desktop.title",{wallet:e.name,platform:s}),url:r,variant:"desktop"}),E&&fe.createElement(yM,{actionLabel:T.t("get_options.mobile.download.label",{wallet:e.name}),description:T.t("get_options.mobile.description"),iconAccent:e.iconAccent,iconBackground:e.iconBackground,iconUrl:e.iconUrl,isCompact:u,onAction:()=>{t("DOWNLOAD")},title:T.t("get_options.mobile.title",{wallet:e.name}),variant:"app"})))}function rhe({changeWalletStep:t,wallet:e}){const{downloadUrls:n,qrCode:s}=e,{i18n:l}=he.useContext(Ba);return he.useEffect(()=>{XH(),KH()},[]),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"24",height:"full",width:"full"},fe.createElement(At,{style:{maxWidth:220,textAlign:"center"}},fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"semibold"},l.t("get_mobile.description"))),fe.createElement(At,{height:"full"},n!=null&&n.qrCode?fe.createElement(YH,{logoSize:0,size:268,uri:n.qrCode}):null),fe.createElement(At,{alignItems:"center",borderRadius:"10",display:"flex",flexDirection:"row",gap:"8",height:"34",justifyContent:"space-between",marginBottom:"12",paddingY:"8"},fe.createElement(Gc,{label:l.t("get_mobile.continue.label"),onClick:()=>t(s!=null&&s.instructions?"INSTRUCTIONS_MOBILE":"CONNECT")})))}var Wm={connect:()=>fe.createElement(Hde,null),create:()=>fe.createElement(Gde,null),install:t=>fe.createElement(Sl,{background:t.iconBackground,borderColor:"generalBorder",borderRadius:"10",height:"48",src:t.iconUrl,width:"48"}),refresh:()=>fe.createElement(Wde,null),scan:()=>fe.createElement(qde,null)};function ihe({connectWallet:t,wallet:e}){var s,l,u,p;const{i18n:n}=he.useContext(Ba);return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",height:"full",width:"full"},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"28",height:"full",justifyContent:"center",paddingY:"32",style:{maxWidth:320}},(l=(s=e==null?void 0:e.qrCode)==null?void 0:s.instructions)==null?void 0:l.steps.map((r,v)=>{var w;return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16",key:v},fe.createElement(At,{borderRadius:"10",height:"48",minWidth:"48",overflow:"hidden",position:"relative",width:"48"},(w=Wm[r.step])==null?void 0:w.call(Wm,e)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},n.t(r.title,void 0,{rawKeyIfTranslationMissing:!0})),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},n.t(r.description,void 0,{rawKeyIfTranslationMissing:!0}))))})),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"12",justifyContent:"center",marginBottom:"16"},fe.createElement(Gc,{label:n.t("get_instructions.mobile.connect.label"),onClick:()=>t(e)}),fe.createElement(At,{as:"a",className:ja({active:"shrink",hover:"grow"}),display:"block",href:(p=(u=e==null?void 0:e.qrCode)==null?void 0:u.instructions)==null?void 0:p.learnMoreUrl,paddingX:"12",paddingY:"4",rel:"noreferrer",style:{willChange:"transform"},target:"_blank",transition:"default"},fe.createElement(_i,{color:"accentColor",size:"14",weight:"bold"},n.t("get_instructions.mobile.learn_more.label")))))}function she({wallet:t}){var n,s,l,u;const{i18n:e}=he.useContext(Ba);return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",height:"full",width:"full"},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"28",height:"full",justifyContent:"center",paddingY:"32",style:{maxWidth:320}},(s=(n=t==null?void 0:t.extension)==null?void 0:n.instructions)==null?void 0:s.steps.map((p,r)=>{var v;return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16",key:r},fe.createElement(At,{borderRadius:"10",height:"48",minWidth:"48",overflow:"hidden",position:"relative",width:"48"},(v=Wm[p.step])==null?void 0:v.call(Wm,t)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},e.t(p.title,void 0,{rawKeyIfTranslationMissing:!0})),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},e.t(p.description,void 0,{rawKeyIfTranslationMissing:!0}))))})),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"12",justifyContent:"center",marginBottom:"16"},fe.createElement(Gc,{label:e.t("get_instructions.extension.refresh.label"),onClick:window.location.reload.bind(window.location)}),fe.createElement(At,{as:"a",className:ja({active:"shrink",hover:"grow"}),display:"block",href:(u=(l=t==null?void 0:t.extension)==null?void 0:l.instructions)==null?void 0:u.learnMoreUrl,paddingX:"12",paddingY:"4",rel:"noreferrer",style:{willChange:"transform"},target:"_blank",transition:"default"},fe.createElement(_i,{color:"accentColor",size:"14",weight:"bold"},e.t("get_instructions.extension.learn_more.label")))))}function ohe({connectWallet:t,wallet:e}){var s,l,u,p;const{i18n:n}=he.useContext(Ba);return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",height:"full",width:"full"},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"28",height:"full",justifyContent:"center",paddingY:"32",style:{maxWidth:320}},(l=(s=e==null?void 0:e.desktop)==null?void 0:s.instructions)==null?void 0:l.steps.map((r,v)=>{var w;return fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"16",key:v},fe.createElement(At,{borderRadius:"10",height:"48",minWidth:"48",overflow:"hidden",position:"relative",width:"48"},(w=Wm[r.step])==null?void 0:w.call(Wm,e)),fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},fe.createElement(_i,{color:"modalText",size:"14",weight:"bold"},n.t(r.title,void 0,{rawKeyIfTranslationMissing:!0})),fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},n.t(r.description,void 0,{rawKeyIfTranslationMissing:!0}))))})),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"12",justifyContent:"center",marginBottom:"16"},fe.createElement(Gc,{label:n.t("get_instructions.desktop.connect.label"),onClick:()=>t(e)}),fe.createElement(At,{as:"a",className:ja({active:"shrink",hover:"grow"}),display:"block",href:(p=(u=e==null?void 0:e.desktop)==null?void 0:u.instructions)==null?void 0:p.learnMoreUrl,paddingX:"12",paddingY:"4",rel:"noreferrer",style:{willChange:"transform"},target:"_blank",transition:"default"},fe.createElement(_i,{color:"accentColor",size:"14",weight:"bold"},n.t("get_instructions.desktop.learn_more.label")))))}function ahe({onClose:t}){const e="rk_connect_title",[n,s]=he.useState(),[l,u]=he.useState(),[p,r]=he.useState(),v=!!(l!=null&&l.qrCode)&&p,[w,E]=he.useState(!1),k=he.useContext(RA)===x2.COMPACT,{disclaimer:R}=he.useContext(g2),{i18n:D}=he.useContext(Ba),O=IR(),F=he.useRef(!1),{connector:U}=he.useContext(y2),W=Mw(!U).filter(yt=>yt.ready||!!yt.extensionDownloadUrl).sort((yt,Vt)=>yt.groupIndex-Vt.groupIndex),K=Mw(),ne=Rde(W,yt=>yt.groupName),te=["Recommended","Other","Popular","More","Others","Installed"];he.useEffect(()=>{U&&!F.current&&(Me("CONNECT"),ce(U),F.current=!0)},[U]);const re=yt=>{var Vt,_t;E(!1),yt.ready&&((_t=(Vt=yt==null?void 0:yt.connect)==null?void 0:Vt.call(yt))==null||_t.catch(()=>{E(!0)}))},xe=async yt=>{const Vt=W.find(_t=>yt.id===_t.id);Vt!=null&&Vt.getDesktopUri&&setTimeout(async()=>{var vt;const _t=await((vt=Vt==null?void 0:Vt.getDesktopUri)==null?void 0:vt.call(Vt));_t&&window.open(_t,O?"_blank":"_self")},0)},ae=async yt=>{var vt;const Vt=W.find(qt=>yt.id===qt.id),_t=await((vt=Vt==null?void 0:Vt.getQrCodeUri)==null?void 0:vt.call(Vt));r(_t),setTimeout(()=>{u(Vt),Me("CONNECT")},_t?0:50)},ce=async yt=>{Bde(yt.id),yt.ready&&(ae(yt),xe(yt)),re(yt),s(yt.id),yt.ready||(u(yt),Me(yt!=null&&yt.extensionDownloadUrl?"DOWNLOAD_OPTIONS":"CONNECT"))},ye=yt=>{var kt;const Vt=K.find(on=>yt===on.id),_t=(kt=Vt==null?void 0:Vt.downloadUrls)==null?void 0:kt.qrCode,vt=!!(Vt!=null&&Vt.desktopDownloadUrl),qt=!!(Vt!=null&&Vt.extensionDownloadUrl);u(Vt),Me(_t&&(qt||vt)?"DOWNLOAD_OPTIONS":_t?"DOWNLOAD":vt?"INSTRUCTIONS_DESKTOP":"INSTRUCTIONS_EXTENSION")},Ce=()=>{s(void 0),u(void 0),r(void 0)},Me=(yt,Vt=!1)=>{Vt&&yt==="GET"&&Ke==="GET"?Ce():!Vt&&yt==="GET"?ke("GET"):!Vt&&yt==="CONNECT"&&ke("CONNECT"),$e(yt)},[Ke,ke]=he.useState("NONE"),[je,$e]=he.useState("NONE");let Ae=null,He=null,qe=null,Le;he.useEffect(()=>{E(!1)},[je,l]);const bt=!!(!!(l!=null&&l.extensionDownloadUrl)&&(l!=null&&l.mobileDownloadUrl));switch(je){case"NONE":Ae=fe.createElement(yF,{getWallet:()=>Me("GET")});break;case"LEARN_COMPACT":Ae=fe.createElement(yF,{compactModeEnabled:k,getWallet:()=>Me("GET")}),He=D.t("intro.title"),qe="NONE";break;case"GET":Ae=fe.createElement(ehe,{getWalletDownload:ye,compactModeEnabled:k}),He=D.t("get.title"),qe=k?"LEARN_COMPACT":"NONE";break;case"CONNECT":Ae=l&&fe.createElement(the,{changeWalletStep:Me,compactModeEnabled:k,connectionError:w,onClose:t,qrCodeUri:p,reconnect:re,wallet:l}),He=v&&(l.name==="WalletConnect"?D.t("connect_scan.fallback_title"):D.t("connect_scan.title",{wallet:l.name})),qe=k?U?null:"NONE":null,Le=k?U?()=>{}:Ce:()=>{};break;case"DOWNLOAD_OPTIONS":Ae=l&&fe.createElement(nhe,{changeWalletStep:Me,wallet:l}),He=l&&D.t("get_options.short_title",{wallet:l.name}),qe=U?"CONNECT":k?"NONE":Ke;break;case"DOWNLOAD":Ae=l&&fe.createElement(rhe,{changeWalletStep:Me,wallet:l}),He=l&&D.t("get_mobile.title",{wallet:l.name}),qe=bt?"DOWNLOAD_OPTIONS":Ke;break;case"INSTRUCTIONS_MOBILE":Ae=l&&fe.createElement(ihe,{connectWallet:ce,wallet:l}),He=l&&D.t("get_options.title",{wallet:k&&l.shortName||l.name}),qe="DOWNLOAD";break;case"INSTRUCTIONS_EXTENSION":Ae=l&&fe.createElement(she,{wallet:l}),He=l&&D.t("get_options.title",{wallet:k&&l.shortName||l.name}),qe="DOWNLOAD_OPTIONS";break;case"INSTRUCTIONS_DESKTOP":Ae=l&&fe.createElement(ohe,{connectWallet:ce,wallet:l}),He=l&&D.t("get_options.title",{wallet:k&&l.shortName||l.name}),qe="DOWNLOAD_OPTIONS";break}return fe.createElement(At,{display:"flex",flexDirection:"row",style:{maxHeight:k?468:504}},(k?je==="NONE":!0)&&fe.createElement(At,{className:k?Kde:Qde,display:"flex",flexDirection:"column",marginTop:"16"},fe.createElement(At,{display:"flex",justifyContent:"space-between"},k&&R&&fe.createElement(At,{marginLeft:"16",width:"28"},fe.createElement(jde,{onClick:()=>Me("LEARN_COMPACT")})),k&&!R&&fe.createElement(At,{marginLeft:"16",width:"28"}),fe.createElement(At,{marginLeft:k?"0":"6",paddingBottom:"8",paddingTop:"2",paddingX:"18"},fe.createElement(_i,{as:"h1",color:"modalText",id:e,size:"18",weight:"heavy",testId:"connect-header-label"},D.t("connect.title"))),k&&fe.createElement(At,{marginRight:"16"},fe.createElement(Vx,{onClose:t}))),fe.createElement(At,{className:Zde,paddingBottom:"18"},Object.entries(ne).map(([yt,Vt],_t)=>Vt.length>0&&fe.createElement(he.Fragment,{key:_t},yt?fe.createElement(At,{marginBottom:"8",marginTop:"16",marginX:"6"},fe.createElement(_i,{color:yt==="Installed"?"accentColor":"modalTextSecondary",size:"14",weight:"bold"},te.includes(yt)?D.t(`connector_group.${yt.toLowerCase()}`):yt)):null,fe.createElement(At,{display:"flex",flexDirection:"column",gap:"4"},Vt.map(vt=>fe.createElement($H,{currentlySelected:vt.id===n,iconBackground:vt.iconBackground,iconUrl:vt.iconUrl,key:vt.id,name:vt.name,onClick:()=>ce(vt),ready:vt.ready,recent:vt.recent,testId:`wallet-option-${vt.id}`,isRainbowKitConnector:vt.isRainbowKitConnector})))))),k&&fe.createElement(fe.Fragment,null,fe.createElement(At,{background:"generalBorder",height:"1",marginTop:"-1"}),R?fe.createElement(At,{paddingX:"24",paddingY:"16",textAlign:"center"},fe.createElement(R,{Link:DR,Text:LR})):fe.createElement(At,{alignItems:"center",display:"flex",justifyContent:"space-between",paddingX:"24",paddingY:"16"},fe.createElement(At,{paddingY:"4"},fe.createElement(_i,{color:"modalTextSecondary",size:"14",weight:"medium"},D.t("connect.new_to_ethereum.description"))),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"row",gap:"4",justifyContent:"center"},fe.createElement(At,{className:ja({active:"shrink",hover:"grow"}),cursor:"pointer",onClick:()=>Me("LEARN_COMPACT"),paddingY:"4",style:{willChange:"transform"},transition:"default"},fe.createElement(_i,{color:"accentColor",size:"14",weight:"bold"},D.t("connect.new_to_ethereum.learn_more.label"))))))),(k?je!=="NONE":!0)&&fe.createElement(fe.Fragment,null,!k&&fe.createElement(At,{background:"generalBorder",minWidth:"1",width:"1"}),fe.createElement(At,{display:"flex",flexDirection:"column",margin:"16",style:{flexGrow:1}},fe.createElement(At,{alignItems:"center",display:"flex",justifyContent:"space-between",marginBottom:"12"},fe.createElement(At,{width:"28"},qe&&fe.createElement(At,{as:"button",className:ja({active:"shrinkSm",hover:"growLg"}),color:"accentColor",onClick:()=>{qe&&Me(qe,!0),Le==null||Le()},paddingX:"8",paddingY:"4",style:{boxSizing:"content-box",height:17,willChange:"transform"},transition:"default",type:"button"},fe.createElement(HH,null))),fe.createElement(At,{display:"flex",justifyContent:"center",style:{flexGrow:1}},He&&fe.createElement(_i,{color:"modalText",size:"18",textAlign:"center",weight:"heavy"},He)),fe.createElement(Vx,{onClose:t})),fe.createElement(At,{display:"flex",flexDirection:"column",style:{minHeight:k?396:432}},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"6",height:"full",justifyContent:"center",marginX:"8"},Ae)))))}var lhe="_1am14412",che="_1am14410",uhe="_1am14413",dhe=({wallet:t})=>fe.createElement("svg",{className:uhe,viewBox:"0 0 86 86",width:"86",height:"86"},fe.createElement("title",null,"Loading"),fe.createElement("rect",{x:"3",y:"3",width:80,height:80,rx:20,ry:20,strokeDasharray:`${160/3} ${320/3}`,strokeDashoffset:160,className:lhe,style:{stroke:(t==null?void 0:t.iconAccent)||"#0D3887"}}));function tG({onClose:t,wallet:e,connecting:n}){const{connect:s,iconBackground:l,iconUrl:u,id:p,name:r,getMobileUri:v,ready:w,shortName:E,showWalletConnectModal:T}=e,k=GH(u),R=he.useRef(!1),{i18n:D}=he.useContext(Ba),O=he.useCallback(async()=>{if(p!=="walletConnect"&&(async()=>{const U=await(v==null?void 0:v());if(U)if(U&&Kue({mobileUri:U,name:r}),U.startsWith("http")){const X=document.createElement("a");X.href=U,X.target="_blank",X.rel="noreferrer noopener",X.click()}else window.location.href=U})(),T){T(),t==null||t();return}try{await(s==null?void 0:s())}catch{}},[s,v,T,t,r,p]);return he.useEffect(()=>{n&&!R.current&&(O(),R.current=!0)},[n,O]),fe.createElement(At,{as:"button",color:w?"modalText":"modalTextSecondary",disabled:!w,fontFamily:"body",key:p,onClick:O,ref:k,style:{overflow:"visible",textAlign:"center"},testId:`wallet-option-${p}`,type:"button",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"},fe.createElement(At,{display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:"8",paddingTop:"10",position:"relative"},n?fe.createElement(dhe,{wallet:e}):null,fe.createElement(Sl,{background:l,borderRadius:"13",boxShadow:"walletLogo",height:"60",src:u,width:"60"})),n?null:fe.createElement(At,{display:"flex",flexDirection:"column",textAlign:"center"},fe.createElement(_i,{as:"h2",color:e.ready?"modalText":"modalTextSecondary",size:"13",weight:"medium"},fe.createElement(At,{as:"span",position:"relative"},E??r,!e.ready&&" (unsupported)")),e.recent&&fe.createElement(_i,{color:"accentColor",size:"12",weight:"medium"},D.t("connect.recent")))))}function hhe({onClose:t}){var R;const e="rk_connect_title",n=Mw().filter(D=>D.isRainbowKitConnector),{disclaimer:s,learnMoreUrl:l}=he.useContext(g2);let u=null,p=null,r=!1,v=null;const[w,E]=he.useState("CONNECT"),{i18n:T}=he.useContext(Ba),k=m2();switch(w){case"CONNECT":{u=T.t("connect.title"),r=!0,p=fe.createElement(At,null,fe.createElement(At,{background:"profileForeground",className:che,display:"flex",paddingBottom:"20",paddingTop:"6"},fe.createElement(At,{display:"flex",style:{margin:"0 auto"}},n.filter(D=>D.ready).map(D=>fe.createElement(At,{key:D.id,paddingX:"20"},fe.createElement(At,{width:"60"},fe.createElement(tG,{onClose:t,wallet:D})))))),fe.createElement(At,{background:"generalBorder",height:"1",marginBottom:"32",marginTop:"-1"}),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"32",paddingX:"32",style:{textAlign:"center"}},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"8",textAlign:"center"},fe.createElement(_i,{color:"modalText",size:"16",weight:"bold"},T.t("intro.title")),fe.createElement(_i,{color:"modalTextSecondary",size:"16"},T.t("intro.description")))),fe.createElement(At,{paddingTop:"32",paddingX:"20"},fe.createElement(At,{display:"flex",gap:"14",justifyContent:"center"},fe.createElement(Gc,{label:T.t("intro.get.label"),onClick:()=>E("GET"),size:"large",type:"secondary"}),fe.createElement(Gc,{href:l,label:T.t("intro.learn_more.label"),size:"large",type:"secondary"}))),s&&fe.createElement(At,{marginTop:"28",marginX:"32",textAlign:"center"},fe.createElement(s,{Link:DR,Text:LR})));break}case"GET":{u=T.t("get.title"),v="CONNECT";const D=(R=n==null?void 0:n.filter(O=>{var F,U,X;return((F=O.downloadUrls)==null?void 0:F.ios)||((U=O.downloadUrls)==null?void 0:U.android)||((X=O.downloadUrls)==null?void 0:X.mobile)}))==null?void 0:R.splice(0,3);p=fe.createElement(At,null,fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",height:"full",marginBottom:"36",marginTop:"5",paddingTop:"12",width:"full"},D.map((O,F)=>{const{downloadUrls:U,iconBackground:X,iconUrl:W,name:K}=O;return!(U!=null&&U.ios)&&!(U!=null&&U.android)&&!(U!=null&&U.mobile)?null:fe.createElement(At,{display:"flex",gap:"16",key:O.id,paddingX:"20",width:"full"},fe.createElement(At,{style:{minHeight:48,minWidth:48}},fe.createElement(Sl,{background:X,borderColor:"generalBorder",borderRadius:"10",height:"48",src:W,width:"48"})),fe.createElement(At,{display:"flex",flexDirection:"column",width:"full"},fe.createElement(At,{alignItems:"center",display:"flex",height:"48"},fe.createElement(At,{width:"full"},fe.createElement(_i,{color:"modalText",size:"18",weight:"bold"},K)),fe.createElement(Gc,{href:(k?U==null?void 0:U.ios:U==null?void 0:U.android)||(U==null?void 0:U.mobile),label:T.t("get.action.label"),size:"small",type:"secondary"})),F<D.length-1&&fe.createElement(At,{background:"generalBorderDim",height:"1",marginY:"10",width:"full"})))})),fe.createElement(At,{style:{marginBottom:"42px"}}),fe.createElement(At,{alignItems:"center",display:"flex",flexDirection:"column",gap:"36",paddingX:"36",style:{textAlign:"center"}},fe.createElement(At,{display:"flex",flexDirection:"column",gap:"12",textAlign:"center"},fe.createElement(_i,{color:"modalText",size:"16",weight:"bold"},T.t("get.looking_for.title")),fe.createElement(_i,{color:"modalTextSecondary",size:"16"},T.t("get.looking_for.mobile.description")))));break}}return fe.createElement(At,{display:"flex",flexDirection:"column",paddingBottom:"36"},fe.createElement(At,{background:r?"profileForeground":"modalBackground",display:"flex",flexDirection:"column",paddingBottom:"4",paddingTop:"14"},fe.createElement(At,{display:"flex",justifyContent:"center",paddingBottom:"6",paddingX:"20",position:"relative"},v&&fe.createElement(At,{display:"flex",position:"absolute",style:{left:0,marginBottom:-20,marginTop:-20}},fe.createElement(At,{alignItems:"center",as:"button",className:ja({active:"shrinkSm",hover:"growLg"}),color:"accentColor",display:"flex",marginLeft:"4",marginTop:"20",onClick:()=>E(v),padding:"16",style:{height:17,willChange:"transform"},transition:"default",type:"button"},fe.createElement(HH,null))),fe.createElement(At,{marginTop:"4",textAlign:"center",width:"full"},fe.createElement(_i,{as:"h1",color:"modalText",id:e,size:"20",weight:"bold"},u)),fe.createElement(At,{alignItems:"center",display:"flex",height:"32",paddingRight:"14",position:"absolute",right:"0"},fe.createElement(At,{style:{marginBottom:-20,marginTop:-20}},fe.createElement(Vx,{onClose:t}))))),fe.createElement(At,{display:"flex",flexDirection:"column"},p))}var fhe=({onClose:t})=>{const{connector:e}=he.useContext(y2),{i18n:n}=he.useContext(Ba),s=(e==null?void 0:e.name)||"";return fe.createElement(At,null,fe.createElement(At,{display:"flex",paddingBottom:"32",justifyContent:"center",alignItems:"center",background:"profileForeground",flexDirection:"column"},fe.createElement(At,{width:"full",display:"flex",justifyContent:"flex-end",marginTop:"18",marginRight:"24"},fe.createElement(Vx,{onClose:t})),fe.createElement(At,{width:"60"},fe.createElement(tG,{onClose:t,wallet:e,connecting:!0})),fe.createElement(At,{marginTop:"20"},fe.createElement(_i,{textAlign:"center",color:"modalText",size:"18",weight:"semibold"},n.t("connect.status.connect_mobile",{wallet:s}))),fe.createElement(At,{maxWidth:"full",marginTop:"8"},fe.createElement(_i,{textAlign:"center",color:"modalText",size:"16",weight:"medium"},n.t("connect.status.confirm_mobile",{wallet:s})))))};function phe({onClose:t}){const{connector:e}=he.useContext(y2);return Fa()?e?fe.createElement(fhe,{onClose:t}):fe.createElement(hhe,{onClose:t}):fe.createElement(ahe,{onClose:t})}function mhe({onClose:t,open:e}){const n="rk_connect_title",s=AR(),{disconnect:l}=EA(),{isConnecting:u}=qc(),p=fe.useCallback(()=>{t(),l()},[t,l]),r=fe.useCallback(()=>{u&&l(),t()},[t,l,u]);return s==="disconnected"?fe.createElement(vE,{onClose:r,open:e,titleId:n},fe.createElement(bE,{bottomSheetOnMobile:!0,padding:"0",wide:!0},fe.createElement(phe,{onClose:r}))):s==="unauthenticated"?fe.createElement(vE,{onClose:p,open:e,titleId:n},fe.createElement(bE,{bottomSheetOnMobile:!0,padding:"0"},fe.createElement(Zue,{onClose:p,onCloseModal:t}))):null}function xM(){const[t,e]=he.useState(!1);return{closeModal:he.useCallback(()=>e(!1),[]),isModalOpen:t,openModal:he.useCallback(()=>e(!0),[])}}var _b=he.createContext({accountModalOpen:!1,chainModalOpen:!1,connectModalOpen:!1,isWalletConnectModalOpen:!1,setIsWalletConnectModalOpen:()=>{}});function ghe({children:t}){const{closeModal:e,isModalOpen:n,openModal:s}=xM(),{closeModal:l,isModalOpen:u,openModal:p}=xM(),{closeModal:r,isModalOpen:v,openModal:w}=xM(),[E,T]=he.useState(!1),k=AR(),{chainId:R}=qc(),{chains:D}=Tl(),O=D.some(X=>X.id===R),F=he.useCallback(({keepConnectModalOpen:X=!1}={})=>{X||e(),l(),r()},[e,l,r]),U=IA()==="unauthenticated";return z9({onConnect:()=>F({keepConnectModalOpen:U}),onDisconnect:()=>F()}),he.useEffect(()=>{U&&F()},[U,F]),fe.createElement(_b.Provider,{value:he.useMemo(()=>({accountModalOpen:u,chainModalOpen:v,connectModalOpen:n,isWalletConnectModalOpen:E,openAccountModal:O&&k==="connected"?p:void 0,openChainModal:k==="connected"?w:void 0,openConnectModal:k==="disconnected"||k==="unauthenticated"?s:void 0,setIsWalletConnectModalOpen:T}),[k,u,v,n,p,w,s,O,E])},t,fe.createElement(mhe,{onClose:e,open:n}),fe.createElement(Tde,{onClose:l,open:u}),fe.createElement(Pde,{onClose:r,open:v}))}function yhe(){const{accountModalOpen:t,chainModalOpen:e,connectModalOpen:n}=he.useContext(_b);return{accountModalOpen:t,chainModalOpen:e,connectModalOpen:n}}function xhe(){const{accountModalOpen:t,openAccountModal:e}=he.useContext(_b);return{accountModalOpen:t,openAccountModal:e}}function _he(){const{chainModalOpen:t,openChainModal:e}=he.useContext(_b);return{chainModalOpen:t,openChainModal:e}}function nG(){const{isWalletConnectModalOpen:t,setIsWalletConnectModalOpen:e}=he.useContext(_b);return{isWalletConnectModalOpen:t,setIsWalletConnectModalOpen:e}}function vhe(){const{connectModalOpen:t,openConnectModal:e}=he.useContext(_b),{isWalletConnectModalOpen:n}=nG();return{connectModalOpen:t||n,openConnectModal:e}}var _M=()=>{};function OR({children:t}){const e=tue(),{address:n}=qc(),{chainId:s}=qc(),{chains:l}=Tl(),u=l.some(Ce=>Ce.id===s),p=Jce(),r=IA()??void 0,v=s?p[s]:void 0,w=(v==null?void 0:v.name)??void 0,E=(v==null?void 0:v.iconUrl)??void 0,T=(v==null?void 0:v.iconBackground)??void 0,k=PA(E),R=he.useContext(kR),D=EH().some(({status:Ce})=>Ce==="pending")&&R,{showBalance:O}=_H(),U=typeof O=="boolean"?O:O?cH(O)[Fa()?"smallScreen":"largeScreen"]:!0,{balance:X,ensAvatar:W,ensName:K}=bH({address:n,includeBalance:U}),ne=X?`${FH(Number.parseFloat(X.formatted))} ${X.symbol}`:void 0,{openConnectModal:te}=vhe(),{openChainModal:re}=_he(),{openAccountModal:xe}=xhe(),{accountModalOpen:ae,chainModalOpen:ce,connectModalOpen:ye}=yhe();return fe.createElement(fe.Fragment,null,t({account:n?{address:n,balanceDecimals:X==null?void 0:X.decimals,balanceFormatted:X==null?void 0:X.formatted,balanceSymbol:X==null?void 0:X.symbol,displayBalance:ne,displayName:K?zH(K):BH(n),ensAvatar:W??void 0,ensName:K??void 0,hasPendingTransactions:D}:void 0,accountModalOpen:ae,authenticationStatus:r,chain:s?{hasIcon:!!E,iconBackground:T,iconUrl:k,id:s,name:w,unsupported:!u}:void 0,chainModalOpen:ce,connectModalOpen:ye,mounted:e(),openAccountModal:xe??_M,openChainModal:re??_M,openConnectModal:te??_M}))}OR.displayName="ConnectButton.Custom";var O1={accountStatus:"full",chainStatus:{largeScreen:"full",smallScreen:"icon"},label:"Connect Wallet",showBalance:{largeScreen:!0,smallScreen:!1}};function FR({accountStatus:t=O1.accountStatus,chainStatus:e=O1.chainStatus,label:n=O1.label,showBalance:s=O1.showBalance}){const l=Qx(),u=AR(),{setShowBalance:p}=_H(),[r,v]=he.useState(!1),{i18n:w}=he.useContext(Ba);return he.useEffect(()=>{p(s),r||v(!0)},[s,p]),r?fe.createElement(OR,null,({account:E,chain:T,mounted:k,openAccountModal:R,openChainModal:D,openConnectModal:O})=>{const F=k&&u!=="loading",U=(T==null?void 0:T.unsupported)??!1;return fe.createElement(At,{display:"flex",gap:"12",...!F&&{"aria-hidden":!0,style:{opacity:0,pointerEvents:"none",userSelect:"none"}}},F&&E&&u==="connected"?fe.createElement(fe.Fragment,null,T&&(l.length>1||U)&&fe.createElement(At,{alignItems:"center","aria-label":"Chain Selector",as:"button",background:U?"connectButtonBackgroundError":"connectButtonBackground",borderRadius:"connectButton",boxShadow:"connectButton",className:ja({active:"shrink",hover:"grow"}),color:U?"connectButtonTextError":"connectButtonText",display:H_(e,X=>X==="none"?"none":"flex"),fontFamily:"body",fontWeight:"bold",gap:"6",key:U?"unsupported":"supported",onClick:D,paddingX:"10",paddingY:"8",testId:U?"wrong-network-button":"chain-button",transition:"default",type:"button"},U?fe.createElement(At,{alignItems:"center",display:"flex",height:"24",paddingX:"4"},w.t("connect_wallet.wrong_network.label")):fe.createElement(At,{alignItems:"center",display:"flex",gap:"6"},T.hasIcon?fe.createElement(At,{display:H_(e,X=>X==="full"||X==="icon"?"block":"none"),height:"24",width:"24"},fe.createElement(Sl,{alt:T.name??"Chain icon",background:T.iconBackground,borderRadius:"full",height:"24",src:T.iconUrl,width:"24"})):null,fe.createElement(At,{display:H_(e,X=>X==="icon"&&!T.iconUrl||X==="full"||X==="name"?"block":"none")},T.name??T.id)),fe.createElement(GO,null)),!U&&fe.createElement(At,{alignItems:"center",as:"button",background:"connectButtonBackground",borderRadius:"connectButton",boxShadow:"connectButton",className:ja({active:"shrink",hover:"grow"}),color:"connectButtonText",display:"flex",fontFamily:"body",fontWeight:"bold",onClick:R,testId:"account-button",transition:"default",type:"button"},E.displayBalance&&fe.createElement(At,{display:H_(s,X=>X?"block":"none"),padding:"8",paddingLeft:"12"},E.displayBalance),fe.createElement(At,{background:cH(s)[Fa()?"smallScreen":"largeScreen"]?"connectButtonInnerBackground":"connectButtonBackground",borderColor:"connectButtonBackground",borderRadius:"connectButton",borderStyle:"solid",borderWidth:"2",color:"connectButtonText",fontFamily:"body",fontWeight:"bold",paddingX:"8",paddingY:"6",transition:"default"},fe.createElement(At,{alignItems:"center",display:"flex",gap:"6",height:"24"},fe.createElement(At,{display:H_(t,X=>X==="full"||X==="avatar"?"block":"none")},fe.createElement(gH,{address:E.address,imageUrl:E.ensAvatar,loading:E.hasPendingTransactions,size:24})),fe.createElement(At,{alignItems:"center",display:"flex",gap:"6"},fe.createElement(At,{display:H_(t,X=>X==="full"||X==="address"?"block":"none")},E.displayName),fe.createElement(GO,null)))))):fe.createElement(At,{as:"button",background:"accentColor",borderRadius:"connectButton",boxShadow:"connectButton",className:ja({active:"shrink",hover:"grow"}),color:"accentColorForeground",fontFamily:"body",fontWeight:"bold",height:"40",key:"connect",onClick:O,paddingX:"14",testId:"connect-button",transition:"default",type:"button"},k&&n==="Connect Wallet"?w.t("connect_wallet.label"):n))}):fe.createElement(fe.Fragment,null)}FR.__defaultProps=O1;FR.Custom=OR;var rG=({appName:t,appDescription:e,appUrl:n,appIcon:s})=>({name:t,description:e??t,url:n??(typeof window<"u"?window.location.origin:""),icons:[...s?[s]:[]]});function bhe(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==void 0))}function whe(t,e){const n=[];for(const s of t)n.some(l=>l[e]===s[e])||n.push(s);return n}var She=(t,{projectId:e,walletConnectParameters:n,appName:s,appDescription:l,appUrl:u,appIcon:p})=>{if(!t.length)throw new Error("No wallet list was provided");for(const{wallets:R,groupName:D}of t)if(!R.length)throw new Error(`No wallets provided for group: ${D}`);let r=-1;const v=[],w=[],E=[],T=rG({appName:s,appDescription:l,appUrl:u,appIcon:p});for(const[R,{groupName:D,wallets:O}]of t.entries())for(const F of O){r++;const U=F({projectId:e,appName:s,appIcon:p,options:{metadata:T,...n},walletConnectParameters:{metadata:T,...n}});if(U!=null&&U.iconAccent&&!Ude(U==null?void 0:U.iconAccent))throw new Error(`Property \`iconAccent\` is not a hex value for wallet: ${U.name}`);const X={...U,groupIndex:R+1,groupName:D,index:r};typeof U.hidden=="function"?E.push(X):w.push(X)}const k=whe([...w,...E],"id");for(const{createConnector:R,groupIndex:D,groupName:O,hidden:F,...U}of k){if(typeof F=="function"&&F())continue;const X=ne=>({rkDetails:bhe({...U,groupIndex:D,groupName:O,isRainbowKitConnector:!0,...ne||{}})});U.id==="walletConnect"&&v.push(R(X({isWalletConnectModalConnector:!0,showQrModal:!0})));const K=R(X());v.push(K)}return v},_F=new Map,The=({projectId:t,walletConnectParameters:e,rkDetailsShowQrModal:n,rkDetailsIsWalletConnectModalConnector:s})=>{let l={...e||{},projectId:t,showQrModal:!1};n&&(l={...l,showQrModal:!0}),"customStoragePrefix"in l||(l={...l,customStoragePrefix:s?"clientOne":"clientTwo"});const u=JSON.stringify(l),p=_F.get(u);if(p)return p;const r=ER(l);return _F.set(u,r),r};function Ehe({projectId:t,walletDetails:e,walletConnectParameters:n}){return s=>({...The({projectId:t,walletConnectParameters:n,rkDetailsShowQrModal:e.rkDetails.showQrModal,rkDetailsIsWalletConnectModalConnector:e.rkDetails.isWalletConnectModalConnector})(s),...e})}function BR({projectId:t,walletConnectParameters:e}){const n="21fef48091f12692cad574a6f7753643";if(!t||t==="")throw new Error("No projectId found. Every dApp must now provide a WalletConnect Cloud projectId to enable WalletConnect v2 https://www.rainbowkit.com/docs/installation#configure");return t==="YOUR_PROJECT_ID"&&(t=n),s=>Ehe({projectId:t,walletDetails:s,walletConnectParameters:e})}function iG(t){const e=typeof window<"u"?window:void 0;if(typeof e>"u"||typeof e.ethereum>"u")return;const n=e.ethereum.providers;return n?n.find(s=>s[t]):e.ethereum[t]?e.ethereum:void 0}function sG(t){const e=(n,s)=>{const[l,...u]=s.split("."),p=n[l];if(p)return u.length===0?p:e(p,u.join("."))};if(typeof window<"u")return e(window,t)}function Ahe({flag:t,namespace:e}){return!!(e&&typeof sG(e)<"u"||typeof iG(t)<"u")}function Che({flag:t,namespace:e}){var l;const n=typeof window<"u"?window:void 0;if(typeof n>"u")return;if(e){const u=sG(e);if(u)return u}const s=(l=n.ethereum)==null?void 0:l.providers;{const u=iG(t);if(u)return u}return typeof s<"u"&&s.length>0?s[0]:n.ethereum}function Mhe(t){return e=>{const n=t?{target:()=>({id:e.rkDetails.id,name:e.rkDetails.name,provider:t})}:{};return s=>({...SA(n)(s),...e})}}function khe({flag:t,namespace:e,target:n}){const s=n||Che({flag:t,namespace:e});return Mhe(s)}var oG=({appName:t,appIcon:e})=>({id:"baseAccount",name:"Base Account",shortName:"Base Account",rdns:"app.base.account",iconUrl:async()=>(await hr(async()=>{const{default:n}=await import("./baseAccount-44UITRK7-CsjdbWCf.js");return{default:n}},[])).default,iconAccent:"#0000FF",iconBackground:"#0000FF",installed:!0,createConnector:n=>{const{...s}=oG,l=hce({appName:t,appLogoUrl:e,...s});return u=>({...l(u),...n})}});function Ihe(t){return!(!(t!=null&&t.isMetaMask)||t.isBraveWallet&&!t._events&&!t._state||t.isApexWallet||t.isAvalanche||t.isBackpack||t.isBifrost||t.isBitKeep||t.isBitski||t.isBlockWallet||t.isCoinbaseWallet||t.isDawn||t.isEnkrypt||t.isExodus||t.isFrame||t.isFrontier||t.isGamestop||t.isHyperPay||t.isImToken||t.isKuCoinWallet||t.isMathWallet||t.isNestWallet||t.isOkxWallet||t.isOKExWallet||t.isOneInchIOSWallet||t.isOneInchAndroidWallet||t.isOpera||t.isPhantom||t.isPortal||t.isRabby||t.isRainbow||t.isStatus||t.isTalisman||t.isTally||t.isTokenPocket||t.isTokenary||t.isTrust||t.isTrustWallet||t.isXDEFI||t.isZeal||t.isZerion||t.__seif)}var Phe=({projectId:t,walletConnectParameters:e})=>{const n=typeof window<"u"?Ihe(window.ethereum):!1,s=!n&&!Fa(),l=n||Fa();return{id:"metaMask",name:"MetaMask",rdns:"io.metamask",iconUrl:async()=>(await hr(async()=>{const{default:u}=await import("./metaMaskWallet-SITXT2FV-BlemcphV.js");return{default:u}},[])).default,iconAccent:"#f6851a",iconBackground:"#fff",installed:n||void 0,downloadUrls:{android:"https://play.google.com/store/apps/details?id=io.metamask",ios:"https://apps.apple.com/us/app/metamask/id1438144202",mobile:"https://metamask.io/download",qrCode:"https://metamask.io/download",chrome:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn",edge:"https://microsoftedge.microsoft.com/addons/detail/metamask/ejbalbakoplchlghecdalmeeeajnimhm",firefox:"https://addons.mozilla.org/firefox/addon/ether-metamask",opera:"https://addons.opera.com/extensions/details/metamask-10",browserExtension:"https://metamask.io/download"},mobile:{getUri:l?u=>u:void 0},qrCode:s?{getUri:u=>`https://metamask.app.link/wc?uri=${encodeURIComponent(u)}`,instructions:{learnMoreUrl:"https://metamask.io/faqs/",steps:[{description:"wallet_connectors.metamask.qr_code.step1.description",step:"install",title:"wallet_connectors.metamask.qr_code.step1.title"},{description:"wallet_connectors.metamask.qr_code.step2.description",step:"create",title:"wallet_connectors.metamask.qr_code.step2.title"},{description:"wallet_connectors.metamask.qr_code.step3.description",step:"refresh",title:"wallet_connectors.metamask.qr_code.step3.title"}]}}:void 0,extension:{instructions:{learnMoreUrl:"https://metamask.io/faqs/",steps:[{description:"wallet_connectors.metamask.extension.step1.description",step:"install",title:"wallet_connectors.metamask.extension.step1.title"},{description:"wallet_connectors.metamask.extension.step2.description",step:"create",title:"wallet_connectors.metamask.extension.step2.title"},{description:"wallet_connectors.metamask.extension.step3.description",step:"refresh",title:"wallet_connectors.metamask.extension.step3.title"}]}},createConnector:s?BR({projectId:t,walletConnectParameters:e}):(u=>p=>{var v,w,E;const r=SR({dappMetadata:{connector:"rainbowkit",name:(v=e==null?void 0:e.metadata)==null?void 0:v.name,iconUrl:(w=e==null?void 0:e.metadata)==null?void 0:w.icons[0],url:(E=e==null?void 0:e.metadata)==null?void 0:E.url},headless:!0,checkInstallationImmediately:!1,enableAnalytics:!1})(p);return{...r,...u,getChainId:async()=>{var T;try{return await r.getChainId()}catch{return((T=p.chains[0])==null?void 0:T.id)??1}}}})}},Rhe=({projectId:t,walletConnectParameters:e})=>{const n=Ahe({flag:"isRainbow"}),s=!n,l=u=>dH()?u:m2()?`rainbow://wc?uri=${encodeURIComponent(u)}&connector=rainbowkit`:`https://rnbwapp.com/wc?uri=${encodeURIComponent(u)}&connector=rainbowkit`;return{id:"rainbow",name:"Rainbow",rdns:"me.rainbow",iconUrl:async()=>(await hr(async()=>{const{default:u}=await import("./rainbowWallet-O26YNBMX-DUhYus-9.js");return{default:u}},[])).default,iconBackground:"#0c2f78",installed:s?void 0:n,downloadUrls:{android:"https://play.google.com/store/apps/details?id=me.rainbow&referrer=utm_source%3Drainbowkit&utm_source=rainbowkit",ios:"https://apps.apple.com/app/apple-store/id1457119021?pt=119997837&ct=rainbowkit&mt=8",mobile:"https://rainbow.download?utm_source=rainbowkit",qrCode:"https://rainbow.download?utm_source=rainbowkit&utm_medium=qrcode",browserExtension:"https://rainbow.me/extension?utm_source=rainbowkit"},mobile:{getUri:s?l:void 0},qrCode:s?{getUri:l,instructions:{learnMoreUrl:"https://learn.rainbow.me/connect-to-a-website-or-app?utm_source=rainbowkit&utm_medium=connector&utm_campaign=learnmore",steps:[{description:"wallet_connectors.rainbow.qr_code.step1.description",step:"install",title:"wallet_connectors.rainbow.qr_code.step1.title"},{description:"wallet_connectors.rainbow.qr_code.step2.description",step:"create",title:"wallet_connectors.rainbow.qr_code.step2.title"},{description:"wallet_connectors.rainbow.qr_code.step3.description",step:"scan",title:"wallet_connectors.rainbow.qr_code.step3.title"}]}}:void 0,createConnector:s?BR({projectId:t,walletConnectParameters:e}):khe({flag:"isRainbow"})}},Nhe=()=>({id:"safe",name:"Safe",iconAccent:"#12ff80",iconBackground:"#fff",iconUrl:async()=>(await hr(async()=>{const{default:t}=await import("./safeWallet-5MNKTR5Z-D-5imDLD.js");return{default:t}},[])).default,installed:!(typeof window>"u")&&(window==null?void 0:window.parent)!==window,downloadUrls:{},createConnector:t=>e=>({...TR()(e),...t})}),jhe=({projectId:t,options:e})=>({id:"walletConnect",name:"WalletConnect",installed:void 0,iconUrl:async()=>(await hr(async()=>{const{default:s}=await import("./walletConnectWallet-YHWKVTDY-D3lyiczV.js");return{default:s}},[])).default,iconBackground:"#3b99fc",qrCode:{getUri:s=>s},createConnector:BR({projectId:t,walletConnectParameters:e})}),Dhe=t=>t.reduce((n,s)=>{const l=s.id;return n[l]=f2(),n},{}),Lhe=({appName:t,appDescription:e,appUrl:n,appIcon:s,wallets:l,projectId:u,...p})=>{const{transports:r,chains:v,...w}=p,E=rG({appName:t,appDescription:e,appUrl:n,appIcon:s}),T=She(l||[{groupName:"Popular",wallets:[Nhe,Rhe,oG,Phe,jhe]}],{projectId:u,appName:t,appDescription:e,appUrl:n,appIcon:s,walletConnectParameters:{metadata:E}});return Xse({connectors:T,chains:v,transports:r||Dhe(v),...w})};const Ohe=Lhe({appName:"TripX",projectId:"tripx_default_project_id",chains:[Ux],ssr:!1}),Fhe=new Ioe,Bhe=({children:t})=>f.jsx(Kse,{config:Ohe,children:f.jsx(Hoe,{client:Fhe,children:f.jsx(nde,{theme:iV({accentColor:"#ffffff",accentColorForeground:"#000000",borderRadius:"large",overlayBlur:"small"}),children:t})})}),aG=he.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),NA=he.createContext({}),jA=he.createContext(null),DA=typeof document<"u",zR=DA?he.useLayoutEffect:he.useEffect,lG=he.createContext({strict:!1}),UR=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),zhe="framerAppearId",cG="data-"+UR(zhe);function Uhe(t,e,n,s){const{visualElement:l}=he.useContext(NA),u=he.useContext(lG),p=he.useContext(jA),r=he.useContext(aG).reducedMotion,v=he.useRef();s=s||u.renderer,!v.current&&s&&(v.current=s(t,{visualState:e,parent:l,props:n,presenceContext:p,blockInitialAnimation:p?p.initial===!1:!1,reducedMotionConfig:r}));const w=v.current;he.useInsertionEffect(()=>{w&&w.update(n,p)});const E=he.useRef(!!(n[cG]&&!window.HandoffComplete));return zR(()=>{w&&(w.render(),E.current&&w.animationState&&w.animationState.animateChanges())}),he.useEffect(()=>{w&&(w.updateFeatures(),!E.current&&w.animationState&&w.animationState.animateChanges(),E.current&&(E.current=!1,window.HandoffComplete=!0))}),w}function _v(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Vhe(t,e,n){return he.useCallback(s=>{s&&t.mount&&t.mount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):_v(n)&&(n.current=s))},[e])}function kw(t){return typeof t=="string"||Array.isArray(t)}function LA(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const VR=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],HR=["initial",...VR];function OA(t){return LA(t.animate)||HR.some(e=>kw(t[e]))}function uG(t){return!!(OA(t)||t.variants)}function Hhe(t,e){if(OA(t)){const{initial:n,animate:s}=t;return{initial:n===!1||kw(n)?n:void 0,animate:kw(s)?s:void 0}}return t.inherit!==!1?e:{}}function Ghe(t){const{initial:e,animate:n}=Hhe(t,he.useContext(NA));return he.useMemo(()=>({initial:e,animate:n}),[vF(e),vF(n)])}function vF(t){return Array.isArray(t)?t.join(" "):t}const bF={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Iw={};for(const t in bF)Iw[t]={isEnabled:e=>bF[t].some(n=>!!e[n])};function $he(t){for(const e in t)Iw[e]={...Iw[e],...t[e]}}const GR=he.createContext({}),dG=he.createContext({}),Whe=Symbol.for("motionComponentSymbol");function qhe({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:s,Component:l}){t&&$he(t);function u(r,v){let w;const E={...he.useContext(aG),...r,layoutId:Xhe(r)},{isStatic:T}=E,k=Ghe(r),R=s(r,T);if(!T&&DA){k.visualElement=Uhe(l,R,E,e);const D=he.useContext(dG),O=he.useContext(lG).strict;k.visualElement&&(w=k.visualElement.loadFeatures(E,O,t,D))}return he.createElement(NA.Provider,{value:k},w&&k.visualElement?he.createElement(w,{visualElement:k.visualElement,...E}):null,n(l,r,Vhe(R,k.visualElement,v),R,T,k.visualElement))}const p=he.forwardRef(u);return p[Whe]=l,p}function Xhe({layoutId:t}){const e=he.useContext(GR).id;return e&&t!==void 0?e+"-"+t:t}function Zhe(t){function e(s,l={}){return qhe(t(s,l))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(s,l)=>(n.has(l)||n.set(l,e(l)),n.get(l))})}const Qhe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function $R(t){return typeof t!="string"||t.includes("-")?!1:!!(Qhe.indexOf(t)>-1||/[A-Z]/.test(t))}const wE={};function Khe(t){Object.assign(wE,t)}const _2=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Kx=new Set(_2);function hG(t,{layout:e,layoutId:n}){return Kx.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!wE[t]||t==="opacity")}const Tu=t=>!!(t&&t.getVelocity),Yhe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Jhe=_2.length;function efe(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},s,l){let u="";for(let p=0;p<Jhe;p++){const r=_2[p];if(t[r]!==void 0){const v=Yhe[r]||r;u+=`${v}(${t[r]}) `}}return e&&!t.z&&(u+="translateZ(0)"),u=u.trim(),l?u=l(t,s?"":u):n&&s&&(u="none"),u}const fG=t=>e=>typeof e=="string"&&e.startsWith(t),pG=fG("--"),Fk=fG("var(--"),tfe=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,nfe=(t,e)=>e&&typeof t=="number"?e.transform(t):t,H0=(t,e,n)=>Math.min(Math.max(n,t),e),Yx={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},G1={...Yx,transform:t=>H0(0,1,t)},$S={...Yx,default:1},$1=t=>Math.round(t*1e5)/1e5,FA=/(-)?([\d]*\.?[\d])+/g,mG=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,rfe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function v2(t){return typeof t=="string"}const b2=t=>({test:e=>v2(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),v0=b2("deg"),_p=b2("%"),Ki=b2("px"),ife=b2("vh"),sfe=b2("vw"),wF={..._p,parse:t=>_p.parse(t)/100,transform:t=>_p.transform(t*100)},SF={...Yx,transform:Math.round},gG={borderWidth:Ki,borderTopWidth:Ki,borderRightWidth:Ki,borderBottomWidth:Ki,borderLeftWidth:Ki,borderRadius:Ki,radius:Ki,borderTopLeftRadius:Ki,borderTopRightRadius:Ki,borderBottomRightRadius:Ki,borderBottomLeftRadius:Ki,width:Ki,maxWidth:Ki,height:Ki,maxHeight:Ki,size:Ki,top:Ki,right:Ki,bottom:Ki,left:Ki,padding:Ki,paddingTop:Ki,paddingRight:Ki,paddingBottom:Ki,paddingLeft:Ki,margin:Ki,marginTop:Ki,marginRight:Ki,marginBottom:Ki,marginLeft:Ki,rotate:v0,rotateX:v0,rotateY:v0,rotateZ:v0,scale:$S,scaleX:$S,scaleY:$S,scaleZ:$S,skew:v0,skewX:v0,skewY:v0,distance:Ki,translateX:Ki,translateY:Ki,translateZ:Ki,x:Ki,y:Ki,z:Ki,perspective:Ki,transformPerspective:Ki,opacity:G1,originX:wF,originY:wF,originZ:Ki,zIndex:SF,fillOpacity:G1,strokeOpacity:G1,numOctaves:SF};function WR(t,e,n,s){const{style:l,vars:u,transform:p,transformOrigin:r}=t;let v=!1,w=!1,E=!0;for(const T in e){const k=e[T];if(pG(T)){u[T]=k;continue}const R=gG[T],D=nfe(k,R);if(Kx.has(T)){if(v=!0,p[T]=D,!E)continue;k!==(R.default||0)&&(E=!1)}else T.startsWith("origin")?(w=!0,r[T]=D):l[T]=D}if(e.transform||(v||s?l.transform=efe(t.transform,n,E,s):l.transform&&(l.transform="none")),w){const{originX:T="50%",originY:k="50%",originZ:R=0}=r;l.transformOrigin=`${T} ${k} ${R}`}}const qR=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function yG(t,e,n){for(const s in e)!Tu(e[s])&&!hG(s,n)&&(t[s]=e[s])}function ofe({transformTemplate:t},e,n){return he.useMemo(()=>{const s=qR();return WR(s,e,{enableHardwareAcceleration:!n},t),Object.assign({},s.vars,s.style)},[e])}function afe(t,e,n){const s=t.style||{},l={};return yG(l,s,t),Object.assign(l,ofe(t,e,n)),t.transformValues?t.transformValues(l):l}function lfe(t,e,n){const s={},l=afe(t,e,n);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=l,s}const cfe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function SE(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||cfe.has(t)}let xG=t=>!SE(t);function ufe(t){t&&(xG=e=>e.startsWith("on")?!SE(e):t(e))}try{ufe(require("@emotion/is-prop-valid").default)}catch{}function dfe(t,e,n){const s={};for(const l in t)l==="values"&&typeof t.values=="object"||(xG(l)||n===!0&&SE(l)||!e&&!SE(l)||t.draggable&&l.startsWith("onDrag"))&&(s[l]=t[l]);return s}function TF(t,e,n){return typeof t=="string"?t:Ki.transform(e+n*t)}function hfe(t,e,n){const s=TF(e,t.x,t.width),l=TF(n,t.y,t.height);return`${s} ${l}`}const ffe={offset:"stroke-dashoffset",array:"stroke-dasharray"},pfe={offset:"strokeDashoffset",array:"strokeDasharray"};function mfe(t,e,n=1,s=0,l=!0){t.pathLength=1;const u=l?ffe:pfe;t[u.offset]=Ki.transform(-s);const p=Ki.transform(e),r=Ki.transform(n);t[u.array]=`${p} ${r}`}function XR(t,{attrX:e,attrY:n,attrScale:s,originX:l,originY:u,pathLength:p,pathSpacing:r=1,pathOffset:v=0,...w},E,T,k){if(WR(t,w,E,k),T){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:R,style:D,dimensions:O}=t;R.transform&&(O&&(D.transform=R.transform),delete R.transform),O&&(l!==void 0||u!==void 0||D.transform)&&(D.transformOrigin=hfe(O,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(R.x=e),n!==void 0&&(R.y=n),s!==void 0&&(R.scale=s),p!==void 0&&mfe(R,p,r,v,!1)}const _G=()=>({...qR(),attrs:{}}),ZR=t=>typeof t=="string"&&t.toLowerCase()==="svg";function gfe(t,e,n,s){const l=he.useMemo(()=>{const u=_G();return XR(u,e,{enableHardwareAcceleration:!1},ZR(s),t.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(t.style){const u={};yG(u,t.style,t),l.style={...u,...l.style}}return l}function yfe(t=!1){return(n,s,l,{latestValues:u},p)=>{const v=($R(n)?gfe:lfe)(s,u,p,n),E={...dfe(s,typeof n=="string",t),...v,ref:l},{children:T}=s,k=he.useMemo(()=>Tu(T)?T.get():T,[T]);return he.createElement(n,{...E,children:k})}}function vG(t,{style:e,vars:n},s,l){Object.assign(t.style,e,l&&l.getProjectionStyles(s));for(const u in n)t.style.setProperty(u,n[u])}const bG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function wG(t,e,n,s){vG(t,e,void 0,s);for(const l in e.attrs)t.setAttribute(bG.has(l)?l:UR(l),e.attrs[l])}function QR(t,e){const{style:n}=t,s={};for(const l in n)(Tu(n[l])||e.style&&Tu(e.style[l])||hG(l,t))&&(s[l]=n[l]);return s}function SG(t,e){const n=QR(t,e);for(const s in t)if(Tu(t[s])||Tu(e[s])){const l=_2.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;n[l]=t[s]}return n}function KR(t,e,n,s={},l={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,s,l)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,s,l)),e}function TG(t){const e=he.useRef(null);return e.current===null&&(e.current=t()),e.current}const TE=t=>Array.isArray(t),xfe=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),_fe=t=>TE(t)?t[t.length-1]||0:t;function VT(t){const e=Tu(t)?t.get():t;return xfe(e)?e.toValue():e}function vfe({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},s,l,u){const p={latestValues:bfe(s,l,u,t),renderState:e()};return n&&(p.mount=r=>n(s,r,p)),p}const EG=t=>(e,n)=>{const s=he.useContext(NA),l=he.useContext(jA),u=()=>vfe(t,e,s,l);return n?u():TG(u)};function bfe(t,e,n,s){const l={},u=s(t,{});for(const k in u)l[k]=VT(u[k]);let{initial:p,animate:r}=t;const v=OA(t),w=uG(t);e&&w&&!v&&t.inherit!==!1&&(p===void 0&&(p=e.initial),r===void 0&&(r=e.animate));let E=n?n.initial===!1:!1;E=E||p===!1;const T=E?r:p;return T&&typeof T!="boolean"&&!LA(T)&&(Array.isArray(T)?T:[T]).forEach(R=>{const D=KR(t,R);if(!D)return;const{transitionEnd:O,transition:F,...U}=D;for(const X in U){let W=U[X];if(Array.isArray(W)){const K=E?W.length-1:0;W=W[K]}W!==null&&(l[X]=W)}for(const X in O)l[X]=O[X]}),l}const ya=t=>t;class EF{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const n=this.order.indexOf(e);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function wfe(t){let e=new EF,n=new EF,s=0,l=!1,u=!1;const p=new WeakSet,r={schedule:(v,w=!1,E=!1)=>{const T=E&&l,k=T?e:n;return w&&p.add(v),k.add(v)&&T&&l&&(s=e.order.length),v},cancel:v=>{n.remove(v),p.delete(v)},process:v=>{if(l){u=!0;return}if(l=!0,[e,n]=[n,e],n.clear(),s=e.order.length,s)for(let w=0;w<s;w++){const E=e.order[w];E(v),p.has(E)&&(r.schedule(E),t())}l=!1,u&&(u=!1,r.process(v))}};return r}const WS=["prepare","read","update","preRender","render","postRender"],Sfe=40;function Tfe(t,e){let n=!1,s=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=WS.reduce((T,k)=>(T[k]=wfe(()=>n=!0),T),{}),p=T=>u[T].process(l),r=()=>{const T=performance.now();n=!1,l.delta=s?1e3/60:Math.max(Math.min(T-l.timestamp,Sfe),1),l.timestamp=T,l.isProcessing=!0,WS.forEach(p),l.isProcessing=!1,n&&e&&(s=!1,t(r))},v=()=>{n=!0,s=!0,l.isProcessing||t(r)};return{schedule:WS.reduce((T,k)=>{const R=u[k];return T[k]=(D,O=!1,F=!1)=>(n||v(),R.schedule(D,O,F)),T},{}),cancel:T=>WS.forEach(k=>u[k].cancel(T)),state:l,steps:u}}const{schedule:Co,cancel:rg,state:fc,steps:vM}=Tfe(typeof requestAnimationFrame<"u"?requestAnimationFrame:ya,!0),Efe={useVisualState:EG({scrapeMotionValuesFromProps:SG,createRenderState:_G,onMount:(t,e,{renderState:n,latestValues:s})=>{Co.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Co.render(()=>{XR(n,s,{enableHardwareAcceleration:!1},ZR(e.tagName),t.transformTemplate),wG(e,n)})}})},Afe={useVisualState:EG({scrapeMotionValuesFromProps:QR,createRenderState:qR})};function Cfe(t,{forwardMotionProps:e=!1},n,s){return{...$R(t)?Efe:Afe,preloadedFeatures:n,useRender:yfe(e),createVisualElement:s,Component:t}}function Um(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}const AG=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function BA(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const Mfe=t=>e=>AG(e)&&t(e,BA(e));function qm(t,e,n,s){return Um(t,e,Mfe(n),s)}const kfe=(t,e)=>n=>e(t(n)),O0=(...t)=>t.reduce(kfe);function CG(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const AF=CG("dragHorizontal"),CF=CG("dragVertical");function MG(t){let e=!1;if(t==="y")e=CF();else if(t==="x")e=AF();else{const n=AF(),s=CF();n&&s?e=()=>{n(),s()}:(n&&n(),s&&s())}return e}function kG(){const t=MG(!0);return t?(t(),!1):!0}class Y0{constructor(e){this.isMounted=!1,this.node=e}update(){}}function MF(t,e){const n="pointer"+(e?"enter":"leave"),s="onHover"+(e?"Start":"End"),l=(u,p)=>{if(u.pointerType==="touch"||kG())return;const r=t.getProps();t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",e),r[s]&&Co.update(()=>r[s](u,p))};return qm(t.current,n,l,{passive:!t.getProps()[s]})}class Ife extends Y0{mount(){this.unmount=O0(MF(this.node,!0),MF(this.node,!1))}unmount(){}}class Pfe extends Y0{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=O0(Um(this.node.current,"focus",()=>this.onFocus()),Um(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const IG=(t,e)=>e?t===e?!0:IG(t,e.parentElement):!1;function bM(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,BA(n))}class Rfe extends Y0{constructor(){super(...arguments),this.removeStartListeners=ya,this.removeEndListeners=ya,this.removeAccessibleListeners=ya,this.startPointerPress=(e,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),u=qm(window,"pointerup",(r,v)=>{if(!this.checkPressEnd())return;const{onTap:w,onTapCancel:E,globalTapTarget:T}=this.node.getProps();Co.update(()=>{!T&&!IG(this.node.current,r.target)?E&&E(r,v):w&&w(r,v)})},{passive:!(s.onTap||s.onPointerUp)}),p=qm(window,"pointercancel",(r,v)=>this.cancelPress(r,v),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=O0(u,p),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=u=>{if(u.key!=="Enter"||this.isPressing)return;const p=r=>{r.key!=="Enter"||!this.checkPressEnd()||bM("up",(v,w)=>{const{onTap:E}=this.node.getProps();E&&Co.update(()=>E(v,w))})};this.removeEndListeners(),this.removeEndListeners=Um(this.node.current,"keyup",p),bM("down",(r,v)=>{this.startPress(r,v)})},n=Um(this.node.current,"keydown",e),s=()=>{this.isPressing&&bM("cancel",(u,p)=>this.cancelPress(u,p))},l=Um(this.node.current,"blur",s);this.removeAccessibleListeners=O0(n,l)}}startPress(e,n){this.isPressing=!0;const{onTapStart:s,whileTap:l}=this.node.getProps();l&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&Co.update(()=>s(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!kG()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&Co.update(()=>s(e,n))}mount(){const e=this.node.getProps(),n=qm(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),s=Um(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=O0(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Bk=new WeakMap,wM=new WeakMap,Nfe=t=>{const e=Bk.get(t.target);e&&e(t)},jfe=t=>{t.forEach(Nfe)};function Dfe({root:t,...e}){const n=t||document;wM.has(n)||wM.set(n,{});const s=wM.get(n),l=JSON.stringify(e);return s[l]||(s[l]=new IntersectionObserver(jfe,{root:t,...e})),s[l]}function Lfe(t,e,n){const s=Dfe(e);return Bk.set(t,n),s.observe(t),()=>{Bk.delete(t),s.unobserve(t)}}const Ofe={some:0,all:1};class Ffe extends Y0{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:l="some",once:u}=e,p={root:n?n.current:void 0,rootMargin:s,threshold:typeof l=="number"?l:Ofe[l]},r=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:E,onViewportLeave:T}=this.node.getProps(),k=w?E:T;k&&k(v)};return Lfe(this.node.current,p,r)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(Bfe(e,n))&&this.startObserver()}unmount(){}}function Bfe({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const zfe={inView:{Feature:Ffe},tap:{Feature:Rfe},focus:{Feature:Pfe},hover:{Feature:Ife}};function PG(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function Ufe(t){const e={};return t.values.forEach((n,s)=>e[s]=n.get()),e}function Vfe(t){const e={};return t.values.forEach((n,s)=>e[s]=n.getVelocity()),e}function zA(t,e,n){const s=t.getProps();return KR(s,e,n!==void 0?n:s.custom,Ufe(t),Vfe(t))}let YR=ya;const wx=t=>t*1e3,Xm=t=>t/1e3,Hfe={current:!1},RG=t=>Array.isArray(t)&&typeof t[0]=="number";function NG(t){return!!(!t||typeof t=="string"&&jG[t]||RG(t)||Array.isArray(t)&&t.every(NG))}const F1=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,jG={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:F1([0,.65,.55,1]),circOut:F1([.55,0,1,.45]),backIn:F1([.31,.01,.66,-.59]),backOut:F1([.33,1.53,.69,.99])};function DG(t){if(t)return RG(t)?F1(t):Array.isArray(t)?t.map(DG):jG[t]}function Gfe(t,e,n,{delay:s=0,duration:l,repeat:u=0,repeatType:p="loop",ease:r,times:v}={}){const w={[e]:n};v&&(w.offset=v);const E=DG(r);return Array.isArray(E)&&(w.easing=E),t.animate(w,{delay:s,duration:l,easing:Array.isArray(E)?"linear":E,fill:"both",iterations:u+1,direction:p==="reverse"?"alternate":"normal"})}function $fe(t,{repeat:e,repeatType:n="loop"}){const s=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[s]}const LG=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,Wfe=1e-7,qfe=12;function Xfe(t,e,n,s,l){let u,p,r=0;do p=e+(n-e)/2,u=LG(p,s,l)-t,u>0?n=p:e=p;while(Math.abs(u)>Wfe&&++r<qfe);return p}function w2(t,e,n,s){if(t===e&&n===s)return ya;const l=u=>Xfe(u,0,1,t,n);return u=>u===0||u===1?u:LG(l(u),e,s)}const Zfe=w2(.42,0,1,1),Qfe=w2(0,0,.58,1),OG=w2(.42,0,.58,1),Kfe=t=>Array.isArray(t)&&typeof t[0]!="number",FG=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,BG=t=>e=>1-t(1-e),JR=t=>1-Math.sin(Math.acos(t)),zG=BG(JR),Yfe=FG(JR),UG=w2(.33,1.53,.69,.99),eN=BG(UG),Jfe=FG(eN),epe=t=>(t*=2)<1?.5*eN(t):.5*(2-Math.pow(2,-10*(t-1))),tpe={linear:ya,easeIn:Zfe,easeInOut:OG,easeOut:Qfe,circIn:JR,circInOut:Yfe,circOut:zG,backIn:eN,backInOut:Jfe,backOut:UG,anticipate:epe},kF=t=>{if(Array.isArray(t)){YR(t.length===4);const[e,n,s,l]=t;return w2(e,n,s,l)}else if(typeof t=="string")return tpe[t];return t},tN=(t,e)=>n=>!!(v2(n)&&rfe.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),VG=(t,e,n)=>s=>{if(!v2(s))return s;const[l,u,p,r]=s.match(FA);return{[t]:parseFloat(l),[e]:parseFloat(u),[n]:parseFloat(p),alpha:r!==void 0?parseFloat(r):1}},npe=t=>H0(0,255,t),SM={...Yx,transform:t=>Math.round(npe(t))},ax={test:tN("rgb","red"),parse:VG("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+SM.transform(t)+", "+SM.transform(e)+", "+SM.transform(n)+", "+$1(G1.transform(s))+")"};function rpe(t){let e="",n="",s="",l="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),l=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),l=t.substring(4,5),e+=e,n+=n,s+=s,l+=l),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:l?parseInt(l,16)/255:1}}const zk={test:tN("#"),parse:rpe,transform:ax.transform},vv={test:tN("hsl","hue"),parse:VG("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+_p.transform($1(e))+", "+_p.transform($1(n))+", "+$1(G1.transform(s))+")"},Bc={test:t=>ax.test(t)||zk.test(t)||vv.test(t),parse:t=>ax.test(t)?ax.parse(t):vv.test(t)?vv.parse(t):zk.parse(t),transform:t=>v2(t)?t:t.hasOwnProperty("red")?ax.transform(t):vv.transform(t)},Ko=(t,e,n)=>-n*t+n*e+t;function TM(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function ipe({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let l=0,u=0,p=0;if(!e)l=u=p=n;else{const r=n<.5?n*(1+e):n+e-n*e,v=2*n-r;l=TM(v,r,t+1/3),u=TM(v,r,t),p=TM(v,r,t-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(p*255),alpha:s}}const EM=(t,e,n)=>{const s=t*t;return Math.sqrt(Math.max(0,n*(e*e-s)+s))},spe=[zk,ax,vv],ope=t=>spe.find(e=>e.test(t));function IF(t){const e=ope(t);let n=e.parse(t);return e===vv&&(n=ipe(n)),n}const HG=(t,e)=>{const n=IF(t),s=IF(e),l={...n};return u=>(l.red=EM(n.red,s.red,u),l.green=EM(n.green,s.green,u),l.blue=EM(n.blue,s.blue,u),l.alpha=Ko(n.alpha,s.alpha,u),ax.transform(l))};function ape(t){var e,n;return isNaN(t)&&v2(t)&&(((e=t.match(FA))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(mG))===null||n===void 0?void 0:n.length)||0)>0}const GG={regex:tfe,countKey:"Vars",token:"${v}",parse:ya},$G={regex:mG,countKey:"Colors",token:"${c}",parse:Bc.parse},WG={regex:FA,countKey:"Numbers",token:"${n}",parse:Yx.parse};function AM(t,{regex:e,countKey:n,token:s,parse:l}){const u=t.tokenised.match(e);u&&(t["num"+n]=u.length,t.tokenised=t.tokenised.replace(e,s),t.values.push(...u.map(l)))}function EE(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&AM(n,GG),AM(n,$G),AM(n,WG),n}function qG(t){return EE(t).values}function XG(t){const{values:e,numColors:n,numVars:s,tokenised:l}=EE(t),u=e.length;return p=>{let r=l;for(let v=0;v<u;v++)v<s?r=r.replace(GG.token,p[v]):v<s+n?r=r.replace($G.token,Bc.transform(p[v])):r=r.replace(WG.token,$1(p[v]));return r}}const lpe=t=>typeof t=="number"?0:t;function cpe(t){const e=qG(t);return XG(t)(e.map(lpe))}const G0={test:ape,parse:qG,createTransformer:XG,getAnimatableNone:cpe},ZG=(t,e)=>n=>`${n>0?e:t}`;function QG(t,e){return typeof t=="number"?n=>Ko(t,e,n):Bc.test(t)?HG(t,e):t.startsWith("var(")?ZG(t,e):YG(t,e)}const KG=(t,e)=>{const n=[...t],s=n.length,l=t.map((u,p)=>QG(u,e[p]));return u=>{for(let p=0;p<s;p++)n[p]=l[p](u);return n}},upe=(t,e)=>{const n={...t,...e},s={};for(const l in n)t[l]!==void 0&&e[l]!==void 0&&(s[l]=QG(t[l],e[l]));return l=>{for(const u in s)n[u]=s[u](l);return n}},YG=(t,e)=>{const n=G0.createTransformer(e),s=EE(t),l=EE(e);return s.numVars===l.numVars&&s.numColors===l.numColors&&s.numNumbers>=l.numNumbers?O0(KG(s.values,l.values),n):ZG(t,e)},Pw=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s},PF=(t,e)=>n=>Ko(t,e,n);function dpe(t){return typeof t=="number"?PF:typeof t=="string"?Bc.test(t)?HG:YG:Array.isArray(t)?KG:typeof t=="object"?upe:PF}function hpe(t,e,n){const s=[],l=n||dpe(t[0]),u=t.length-1;for(let p=0;p<u;p++){let r=l(t[p],t[p+1]);if(e){const v=Array.isArray(e)?e[p]||ya:e;r=O0(v,r)}s.push(r)}return s}function JG(t,e,{clamp:n=!0,ease:s,mixer:l}={}){const u=t.length;if(YR(u===e.length),u===1)return()=>e[0];t[0]>t[u-1]&&(t=[...t].reverse(),e=[...e].reverse());const p=hpe(e,s,l),r=p.length,v=w=>{let E=0;if(r>1)for(;E<t.length-2&&!(w<t[E+1]);E++);const T=Pw(t[E],t[E+1],w);return p[E](T)};return n?w=>v(H0(t[0],t[u-1],w)):v}function fpe(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const l=Pw(0,e,s);t.push(Ko(n,1,l))}}function ppe(t){const e=[0];return fpe(e,t.length-1),e}function mpe(t,e){return t.map(n=>n*e)}function gpe(t,e){return t.map(()=>e||OG).splice(0,t.length-1)}function AE({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const l=Kfe(s)?s.map(kF):kF(s),u={done:!1,value:e[0]},p=mpe(n&&n.length===e.length?n:ppe(e),t),r=JG(p,e,{ease:Array.isArray(l)?l:gpe(e,l)});return{calculatedDuration:t,next:v=>(u.value=r(v),u.done=v>=t,u)}}function e$(t,e){return e?t*(1e3/e):0}const ype=5;function t$(t,e,n){const s=Math.max(e-ype,0);return e$(n-t(s),e-s)}const CM=.001,xpe=.01,_pe=10,vpe=.05,bpe=1;function wpe({duration:t=800,bounce:e=.25,velocity:n=0,mass:s=1}){let l,u,p=1-e;p=H0(vpe,bpe,p),t=H0(xpe,_pe,Xm(t)),p<1?(l=w=>{const E=w*p,T=E*t,k=E-n,R=Uk(w,p),D=Math.exp(-T);return CM-k/R*D},u=w=>{const T=w*p*t,k=T*n+n,R=Math.pow(p,2)*Math.pow(w,2)*t,D=Math.exp(-T),O=Uk(Math.pow(w,2),p);return(-l(w)+CM>0?-1:1)*((k-R)*D)/O}):(l=w=>{const E=Math.exp(-w*t),T=(w-n)*t+1;return-CM+E*T},u=w=>{const E=Math.exp(-w*t),T=(n-w)*(t*t);return E*T});const r=5/t,v=Tpe(l,u,r);if(t=wx(t),isNaN(v))return{stiffness:100,damping:10,duration:t};{const w=Math.pow(v,2)*s;return{stiffness:w,damping:p*2*Math.sqrt(s*w),duration:t}}}const Spe=12;function Tpe(t,e,n){let s=n;for(let l=1;l<Spe;l++)s=s-t(s)/e(s);return s}function Uk(t,e){return t*Math.sqrt(1-e*e)}const Epe=["duration","bounce"],Ape=["stiffness","damping","mass"];function RF(t,e){return e.some(n=>t[n]!==void 0)}function Cpe(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!RF(t,Ape)&&RF(t,Epe)){const n=wpe(t);e={...e,...n,mass:1},e.isResolvedFromDuration=!0}return e}function n$({keyframes:t,restDelta:e,restSpeed:n,...s}){const l=t[0],u=t[t.length-1],p={done:!1,value:l},{stiffness:r,damping:v,mass:w,duration:E,velocity:T,isResolvedFromDuration:k}=Cpe({...s,velocity:-Xm(s.velocity||0)}),R=T||0,D=v/(2*Math.sqrt(r*w)),O=u-l,F=Xm(Math.sqrt(r/w)),U=Math.abs(O)<5;n||(n=U?.01:2),e||(e=U?.005:.5);let X;if(D<1){const W=Uk(F,D);X=K=>{const ne=Math.exp(-D*F*K);return u-ne*((R+D*F*O)/W*Math.sin(W*K)+O*Math.cos(W*K))}}else if(D===1)X=W=>u-Math.exp(-F*W)*(O+(R+F*O)*W);else{const W=F*Math.sqrt(D*D-1);X=K=>{const ne=Math.exp(-D*F*K),te=Math.min(W*K,300);return u-ne*((R+D*F*O)*Math.sinh(te)+W*O*Math.cosh(te))/W}}return{calculatedDuration:k&&E||null,next:W=>{const K=X(W);if(k)p.done=W>=E;else{let ne=R;W!==0&&(D<1?ne=t$(X,W,K):ne=0);const te=Math.abs(ne)<=n,re=Math.abs(u-K)<=e;p.done=te&&re}return p.value=p.done?u:K,p}}}function NF({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:p,min:r,max:v,restDelta:w=.5,restSpeed:E}){const T=t[0],k={done:!1,value:T},R=xe=>r!==void 0&&xe<r||v!==void 0&&xe>v,D=xe=>r===void 0?v:v===void 0||Math.abs(r-xe)<Math.abs(v-xe)?r:v;let O=n*e;const F=T+O,U=p===void 0?F:p(F);U!==F&&(O=U-T);const X=xe=>-O*Math.exp(-xe/s),W=xe=>U+X(xe),K=xe=>{const ae=X(xe),ce=W(xe);k.done=Math.abs(ae)<=w,k.value=k.done?U:ce};let ne,te;const re=xe=>{R(k.value)&&(ne=xe,te=n$({keyframes:[k.value,D(k.value)],velocity:t$(W,xe,k.value),damping:l,stiffness:u,restDelta:w,restSpeed:E}))};return re(0),{calculatedDuration:null,next:xe=>{let ae=!1;return!te&&ne===void 0&&(ae=!0,K(xe),re(xe)),ne!==void 0&&xe>ne?te.next(xe-ne):(!ae&&K(xe),k)}}}const Mpe=t=>{const e=({timestamp:n})=>t(n);return{start:()=>Co.update(e,!0),stop:()=>rg(e),now:()=>fc.isProcessing?fc.timestamp:performance.now()}},jF=2e4;function DF(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<jF;)e+=n,s=t.next(e);return e>=jF?1/0:e}const kpe={decay:NF,inertia:NF,tween:AE,keyframes:AE,spring:n$};function CE({autoplay:t=!0,delay:e=0,driver:n=Mpe,keyframes:s,type:l="keyframes",repeat:u=0,repeatDelay:p=0,repeatType:r="loop",onPlay:v,onStop:w,onComplete:E,onUpdate:T,...k}){let R=1,D=!1,O,F;const U=()=>{F=new Promise(Le=>{O=Le})};U();let X;const W=kpe[l]||AE;let K;W!==AE&&typeof s[0]!="number"&&(K=JG([0,100],s,{clamp:!1}),s=[0,100]);const ne=W({...k,keyframes:s});let te;r==="mirror"&&(te=W({...k,keyframes:[...s].reverse(),velocity:-(k.velocity||0)}));let re="idle",xe=null,ae=null,ce=null;ne.calculatedDuration===null&&u&&(ne.calculatedDuration=DF(ne));const{calculatedDuration:ye}=ne;let Ce=1/0,Me=1/0;ye!==null&&(Ce=ye+p,Me=Ce*(u+1)-p);let Ke=0;const ke=Le=>{if(ae===null)return;R>0&&(ae=Math.min(ae,Le)),R<0&&(ae=Math.min(Le-Me/R,ae)),xe!==null?Ke=xe:Ke=Math.round(Le-ae)*R;const st=Ke-e*(R>=0?1:-1),bt=R>=0?st<0:st>Me;Ke=Math.max(st,0),re==="finished"&&xe===null&&(Ke=Me);let yt=Ke,Vt=ne;if(u){const kt=Math.min(Ke,Me)/Ce;let on=Math.floor(kt),mn=kt%1;!mn&&kt>=1&&(mn=1),mn===1&&on--,on=Math.min(on,u+1),!!(on%2)&&(r==="reverse"?(mn=1-mn,p&&(mn-=p/Ce)):r==="mirror"&&(Vt=te)),yt=H0(0,1,mn)*Ce}const _t=bt?{done:!1,value:s[0]}:Vt.next(yt);K&&(_t.value=K(_t.value));let{done:vt}=_t;!bt&&ye!==null&&(vt=R>=0?Ke>=Me:Ke<=0);const qt=xe===null&&(re==="finished"||re==="running"&&vt);return T&&T(_t.value),qt&&Ae(),_t},je=()=>{X&&X.stop(),X=void 0},$e=()=>{re="idle",je(),O(),U(),ae=ce=null},Ae=()=>{re="finished",E&&E(),je(),O()},He=()=>{if(D)return;X||(X=n(ke));const Le=X.now();v&&v(),xe!==null?ae=Le-xe:(!ae||re==="finished")&&(ae=Le),re==="finished"&&U(),ce=ae,xe=null,re="running",X.start()};t&&He();const qe={then(Le,st){return F.then(Le,st)},get time(){return Xm(Ke)},set time(Le){Le=wx(Le),Ke=Le,xe!==null||!X||R===0?xe=Le:ae=X.now()-Le/R},get duration(){const Le=ne.calculatedDuration===null?DF(ne):ne.calculatedDuration;return Xm(Le)},get speed(){return R},set speed(Le){Le===R||!X||(R=Le,qe.time=Xm(Ke))},get state(){return re},play:He,pause:()=>{re="paused",xe=Ke},stop:()=>{D=!0,re!=="idle"&&(re="idle",w&&w(),$e())},cancel:()=>{ce!==null&&ke(ce),$e()},complete:()=>{re="finished"},sample:Le=>(ae=0,ke(Le))};return qe}function Ipe(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ppe=Ipe(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Rpe=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),qS=10,Npe=2e4,jpe=(t,e)=>e.type==="spring"||t==="backgroundColor"||!NG(e.ease);function Dpe(t,e,{onUpdate:n,onComplete:s,...l}){if(!(Ppe()&&Rpe.has(e)&&!l.repeatDelay&&l.repeatType!=="mirror"&&l.damping!==0&&l.type!=="inertia"))return!1;let p=!1,r,v,w=!1;const E=()=>{v=new Promise(W=>{r=W})};E();let{keyframes:T,duration:k=300,ease:R,times:D}=l;if(jpe(e,l)){const W=CE({...l,repeat:0,delay:0});let K={done:!1,value:T[0]};const ne=[];let te=0;for(;!K.done&&te<Npe;)K=W.sample(te),ne.push(K.value),te+=qS;D=void 0,T=ne,k=te-qS,R="linear"}const O=Gfe(t.owner.current,e,T,{...l,duration:k,ease:R,times:D}),F=()=>{w=!1,O.cancel()},U=()=>{w=!0,Co.update(F),r(),E()};return O.onfinish=()=>{w||(t.set($fe(T,l)),s&&s(),U())},{then(W,K){return v.then(W,K)},attachTimeline(W){return O.timeline=W,O.onfinish=null,ya},get time(){return Xm(O.currentTime||0)},set time(W){O.currentTime=wx(W)},get speed(){return O.playbackRate},set speed(W){O.playbackRate=W},get duration(){return Xm(k)},play:()=>{p||(O.play(),rg(F))},pause:()=>O.pause(),stop:()=>{if(p=!0,O.playState==="idle")return;const{currentTime:W}=O;if(W){const K=CE({...l,autoplay:!1});t.setWithVelocity(K.sample(W-qS).value,K.sample(W).value,qS)}U()},complete:()=>{w||O.finish()},cancel:U}}function Lpe({keyframes:t,delay:e,onUpdate:n,onComplete:s}){const l=()=>(n&&n(t[t.length-1]),s&&s(),{time:0,speed:1,duration:0,play:ya,pause:ya,stop:ya,then:u=>(u(),Promise.resolve()),cancel:ya,complete:ya});return e?CE({keyframes:[0,1],duration:0,delay:e,onComplete:l}):l()}const Ope={type:"spring",stiffness:500,damping:25,restSpeed:10},Fpe=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Bpe={type:"keyframes",duration:.8},zpe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Upe=(t,{keyframes:e})=>e.length>2?Bpe:Kx.has(t)?t.startsWith("scale")?Fpe(e[1]):Ope:zpe,Vk=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(G0.test(e)||e==="0")&&!e.startsWith("url(")),Vpe=new Set(["brightness","contrast","saturate","opacity"]);function Hpe(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(FA)||[];if(!s)return t;const l=n.replace(s,"");let u=Vpe.has(e)?1:0;return s!==n&&(u*=100),e+"("+u+l+")"}const Gpe=/([a-z-]*)\(.*?\)/g,Hk={...G0,getAnimatableNone:t=>{const e=t.match(Gpe);return e?e.map(Hpe).join(" "):t}},$pe={...gG,color:Bc,backgroundColor:Bc,outlineColor:Bc,fill:Bc,stroke:Bc,borderColor:Bc,borderTopColor:Bc,borderRightColor:Bc,borderBottomColor:Bc,borderLeftColor:Bc,filter:Hk,WebkitFilter:Hk},nN=t=>$pe[t];function r$(t,e){let n=nN(t);return n!==Hk&&(n=G0),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const i$=t=>/^0[^.\s]+$/.test(t);function Wpe(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||i$(t)}function qpe(t,e,n,s){const l=Vk(e,n);let u;Array.isArray(n)?u=[...n]:u=[null,n];const p=s.from!==void 0?s.from:t.get();let r;const v=[];for(let w=0;w<u.length;w++)u[w]===null&&(u[w]=w===0?p:u[w-1]),Wpe(u[w])&&v.push(w),typeof u[w]=="string"&&u[w]!=="none"&&u[w]!=="0"&&(r=u[w]);if(l&&v.length&&r)for(let w=0;w<v.length;w++){const E=v[w];u[E]=r$(e,r)}return u}function Xpe({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:l,repeat:u,repeatType:p,repeatDelay:r,from:v,elapsed:w,...E}){return!!Object.keys(E).length}function rN(t,e){return t[e]||t.default||t}const Zpe={skipAnimations:!1},iN=(t,e,n,s={})=>l=>{const u=rN(s,t)||{},p=u.delay||s.delay||0;let{elapsed:r=0}=s;r=r-wx(p);const v=qpe(e,t,n,u),w=v[0],E=v[v.length-1],T=Vk(t,w),k=Vk(t,E);let R={keyframes:v,velocity:e.getVelocity(),ease:"easeOut",...u,delay:-r,onUpdate:D=>{e.set(D),u.onUpdate&&u.onUpdate(D)},onComplete:()=>{l(),u.onComplete&&u.onComplete()}};if(Xpe(u)||(R={...R,...Upe(t,R)}),R.duration&&(R.duration=wx(R.duration)),R.repeatDelay&&(R.repeatDelay=wx(R.repeatDelay)),!T||!k||Hfe.current||u.type===!1||Zpe.skipAnimations)return Lpe(R);if(!s.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const D=Dpe(e,t,R);if(D)return D}return CE(R)};function ME(t){return!!(Tu(t)&&t.add)}const s$=t=>/^\-?\d*\.?\d+$/.test(t);function sN(t,e){t.indexOf(e)===-1&&t.push(e)}function oN(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class aN{constructor(){this.subscriptions=[]}add(e){return sN(this.subscriptions,e),()=>oN(this.subscriptions,e)}notify(e,n,s){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,n,s);else for(let u=0;u<l;u++){const p=this.subscriptions[u];p&&p(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Qpe=t=>!isNaN(parseFloat(t));class Kpe{constructor(e,n={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(s,l=!0)=>{this.prev=this.current,this.current=s;const{delta:u,timestamp:p}=fc;this.lastUpdated!==p&&(this.timeDelta=u,this.lastUpdated=p,Co.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Co.postRender(this.velocityCheck),this.velocityCheck=({timestamp:s})=>{s!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=Qpe(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new aN);const s=this.events[e].add(n);return e==="change"?()=>{s(),Co.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,s){this.set(n),this.prev=e,this.timeDelta=s}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?e$(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function eb(t,e){return new Kpe(t,e)}const o$=t=>e=>e.test(t),Ype={test:t=>t==="auto",parse:t=>t},a$=[Yx,Ki,_p,v0,sfe,ife,Ype],E1=t=>a$.find(o$(t)),Jpe=[...a$,Bc,G0],eme=t=>Jpe.find(o$(t));function tme(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,eb(n))}function nme(t,e){const n=zA(t,e);let{transitionEnd:s={},transition:l={},...u}=n?t.makeTargetAnimatable(n,!1):{};u={...u,...s};for(const p in u){const r=_fe(u[p]);tme(t,p,r)}}function rme(t,e,n){var s,l;const u=Object.keys(e).filter(r=>!t.hasValue(r)),p=u.length;if(p)for(let r=0;r<p;r++){const v=u[r],w=e[v];let E=null;Array.isArray(w)&&(E=w[0]),E===null&&(E=(l=(s=n[v])!==null&&s!==void 0?s:t.readValue(v))!==null&&l!==void 0?l:e[v]),E!=null&&(typeof E=="string"&&(s$(E)||i$(E))?E=parseFloat(E):!eme(E)&&G0.test(w)&&(E=r$(v,w)),t.addValue(v,eb(E,{owner:t})),n[v]===void 0&&(n[v]=E),E!==null&&t.setBaseTarget(v,E))}}function ime(t,e){return e?(e[t]||e.default||e).from:void 0}function sme(t,e,n){const s={};for(const l in t){const u=ime(l,e);if(u!==void 0)s[l]=u;else{const p=n.getValue(l);p&&(s[l]=p.get())}}return s}function ome({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function ame(t,e){const n=t.get();if(Array.isArray(e)){for(let s=0;s<e.length;s++)if(e[s]!==n)return!0}else return n!==e}function l$(t,e,{delay:n=0,transitionOverride:s,type:l}={}){let{transition:u=t.getDefaultTransition(),transitionEnd:p,...r}=t.makeTargetAnimatable(e);const v=t.getValue("willChange");s&&(u=s);const w=[],E=l&&t.animationState&&t.animationState.getState()[l];for(const T in r){const k=t.getValue(T),R=r[T];if(!k||R===void 0||E&&ome(E,T))continue;const D={delay:n,elapsed:0,...rN(u||{},T)};if(window.HandoffAppearAnimations){const U=t.getProps()[cG];if(U){const X=window.HandoffAppearAnimations(U,T,k,Co);X!==null&&(D.elapsed=X,D.isHandoff=!0)}}let O=!D.isHandoff&&!ame(k,R);if(D.type==="spring"&&(k.getVelocity()||D.velocity)&&(O=!1),k.animation&&(O=!1),O)continue;k.start(iN(T,k,R,t.shouldReduceMotion&&Kx.has(T)?{type:!1}:D));const F=k.animation;ME(v)&&(v.add(T),F.then(()=>v.remove(T))),w.push(F)}return p&&Promise.all(w).then(()=>{p&&nme(t,p)}),w}function Gk(t,e,n={}){const s=zA(t,e,n.custom);let{transition:l=t.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(l=n.transitionOverride);const u=s?()=>Promise.all(l$(t,s,n)):()=>Promise.resolve(),p=t.variantChildren&&t.variantChildren.size?(v=0)=>{const{delayChildren:w=0,staggerChildren:E,staggerDirection:T}=l;return lme(t,e,w+v,E,T,n)}:()=>Promise.resolve(),{when:r}=l;if(r){const[v,w]=r==="beforeChildren"?[u,p]:[p,u];return v().then(()=>w())}else return Promise.all([u(),p(n.delay)])}function lme(t,e,n=0,s=0,l=1,u){const p=[],r=(t.variantChildren.size-1)*s,v=l===1?(w=0)=>w*s:(w=0)=>r-w*s;return Array.from(t.variantChildren).sort(cme).forEach((w,E)=>{w.notify("AnimationStart",e),p.push(Gk(w,e,{...u,delay:n+v(E)}).then(()=>w.notify("AnimationComplete",e)))}),Promise.all(p)}function cme(t,e){return t.sortNodePosition(e)}function ume(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const l=e.map(u=>Gk(t,u,n));s=Promise.all(l)}else if(typeof e=="string")s=Gk(t,e,n);else{const l=typeof e=="function"?zA(t,e,n.custom):e;s=Promise.all(l$(t,l,n))}return s.then(()=>t.notify("AnimationComplete",e))}const dme=[...VR].reverse(),hme=VR.length;function fme(t){return e=>Promise.all(e.map(({animation:n,options:s})=>ume(t,n,s)))}function pme(t){let e=fme(t);const n=gme();let s=!0;const l=(v,w)=>{const E=zA(t,w);if(E){const{transition:T,transitionEnd:k,...R}=E;v={...v,...R,...k}}return v};function u(v){e=v(t)}function p(v,w){const E=t.getProps(),T=t.getVariantContext(!0)||{},k=[],R=new Set;let D={},O=1/0;for(let U=0;U<hme;U++){const X=dme[U],W=n[X],K=E[X]!==void 0?E[X]:T[X],ne=kw(K),te=X===w?W.isActive:null;te===!1&&(O=U);let re=K===T[X]&&K!==E[X]&&ne;if(re&&s&&t.manuallyAnimateOnMount&&(re=!1),W.protectedKeys={...D},!W.isActive&&te===null||!K&&!W.prevProp||LA(K)||typeof K=="boolean")continue;let ae=mme(W.prevProp,K)||X===w&&W.isActive&&!re&&ne||U>O&&ne,ce=!1;const ye=Array.isArray(K)?K:[K];let Ce=ye.reduce(l,{});te===!1&&(Ce={});const{prevResolvedValues:Me={}}=W,Ke={...Me,...Ce},ke=je=>{ae=!0,R.has(je)&&(ce=!0,R.delete(je)),W.needsAnimating[je]=!0};for(const je in Ke){const $e=Ce[je],Ae=Me[je];if(D.hasOwnProperty(je))continue;let He=!1;TE($e)&&TE(Ae)?He=!PG($e,Ae):He=$e!==Ae,He?$e!==void 0?ke(je):R.add(je):$e!==void 0&&R.has(je)?ke(je):W.protectedKeys[je]=!0}W.prevProp=K,W.prevResolvedValues=Ce,W.isActive&&(D={...D,...Ce}),s&&t.blockInitialAnimation&&(ae=!1),ae&&(!re||ce)&&k.push(...ye.map(je=>({animation:je,options:{type:X,...v}})))}if(R.size){const U={};R.forEach(X=>{const W=t.getBaseTarget(X);W!==void 0&&(U[X]=W)}),k.push({animation:U})}let F=!!k.length;return s&&(E.initial===!1||E.initial===E.animate)&&!t.manuallyAnimateOnMount&&(F=!1),s=!1,F?e(k):Promise.resolve()}function r(v,w,E){var T;if(n[v].isActive===w)return Promise.resolve();(T=t.variantChildren)===null||T===void 0||T.forEach(R=>{var D;return(D=R.animationState)===null||D===void 0?void 0:D.setActive(v,w)}),n[v].isActive=w;const k=p(E,v);for(const R in n)n[R].protectedKeys={};return k}return{animateChanges:p,setActive:r,setAnimateFunction:u,getState:()=>n}}function mme(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!PG(e,t):!1}function Oy(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function gme(){return{animate:Oy(!0),whileInView:Oy(),whileHover:Oy(),whileTap:Oy(),whileDrag:Oy(),whileFocus:Oy(),exit:Oy()}}class yme extends Y0{constructor(e){super(e),e.animationState||(e.animationState=pme(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),LA(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let xme=0;class _me extends Y0{constructor(){super(...arguments),this.id=xme++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n,custom:s}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===l)return;const u=this.node.animationState.setActive("exit",!e,{custom:s??this.node.getProps().custom});n&&!e&&u.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const vme={animation:{Feature:yme},exit:{Feature:_me}},LF=(t,e)=>Math.abs(t-e);function bme(t,e){const n=LF(t.x,e.x),s=LF(t.y,e.y);return Math.sqrt(n**2+s**2)}class c${constructor(e,n,{transformPagePoint:s,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const T=kM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,R=bme(T.offset,{x:0,y:0})>=3;if(!k&&!R)return;const{point:D}=T,{timestamp:O}=fc;this.history.push({...D,timestamp:O});const{onStart:F,onMove:U}=this.handlers;k||(F&&F(this.lastMoveEvent,T),this.startEvent=this.lastMoveEvent),U&&U(this.lastMoveEvent,T)},this.handlePointerMove=(T,k)=>{this.lastMoveEvent=T,this.lastMoveEventInfo=MM(k,this.transformPagePoint),Co.update(this.updatePoint,!0)},this.handlePointerUp=(T,k)=>{this.end();const{onEnd:R,onSessionEnd:D,resumeAnimation:O}=this.handlers;if(this.dragSnapToOrigin&&O&&O(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const F=kM(T.type==="pointercancel"?this.lastMoveEventInfo:MM(k,this.transformPagePoint),this.history);this.startEvent&&R&&R(T,F),D&&D(T,F)},!AG(e))return;this.dragSnapToOrigin=u,this.handlers=n,this.transformPagePoint=s,this.contextWindow=l||window;const p=BA(e),r=MM(p,this.transformPagePoint),{point:v}=r,{timestamp:w}=fc;this.history=[{...v,timestamp:w}];const{onSessionStart:E}=n;E&&E(e,kM(r,this.history)),this.removeListeners=O0(qm(this.contextWindow,"pointermove",this.handlePointerMove),qm(this.contextWindow,"pointerup",this.handlePointerUp),qm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),rg(this.updatePoint)}}function MM(t,e){return e?{point:e(t.point)}:t}function OF(t,e){return{x:t.x-e.x,y:t.y-e.y}}function kM({point:t},e){return{point:t,delta:OF(t,u$(e)),offset:OF(t,wme(e)),velocity:Sme(e,.1)}}function wme(t){return t[0]}function u$(t){return t[t.length-1]}function Sme(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const l=u$(t);for(;n>=0&&(s=t[n],!(l.timestamp-s.timestamp>wx(e)));)n--;if(!s)return{x:0,y:0};const u=Xm(l.timestamp-s.timestamp);if(u===0)return{x:0,y:0};const p={x:(l.x-s.x)/u,y:(l.y-s.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function pd(t){return t.max-t.min}function $k(t,e=0,n=.01){return Math.abs(t-e)<=n}function FF(t,e,n,s=.5){t.origin=s,t.originPoint=Ko(e.min,e.max,t.origin),t.scale=pd(n)/pd(e),($k(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Ko(n.min,n.max,t.origin)-t.originPoint,($k(t.translate)||isNaN(t.translate))&&(t.translate=0)}function W1(t,e,n,s){FF(t.x,e.x,n.x,s?s.originX:void 0),FF(t.y,e.y,n.y,s?s.originY:void 0)}function BF(t,e,n){t.min=n.min+e.min,t.max=t.min+pd(e)}function Tme(t,e,n){BF(t.x,e.x,n.x),BF(t.y,e.y,n.y)}function zF(t,e,n){t.min=e.min-n.min,t.max=t.min+pd(e)}function q1(t,e,n){zF(t.x,e.x,n.x),zF(t.y,e.y,n.y)}function Eme(t,{min:e,max:n},s){return e!==void 0&&t<e?t=s?Ko(e,t,s.min):Math.max(t,e):n!==void 0&&t>n&&(t=s?Ko(n,t,s.max):Math.min(t,n)),t}function UF(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function Ame(t,{top:e,left:n,bottom:s,right:l}){return{x:UF(t.x,n,l),y:UF(t.y,e,s)}}function VF(t,e){let n=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,s]=[s,n]),{min:n,max:s}}function Cme(t,e){return{x:VF(t.x,e.x),y:VF(t.y,e.y)}}function Mme(t,e){let n=.5;const s=pd(t),l=pd(e);return l>s?n=Pw(e.min,e.max-s,t.min):s>l&&(n=Pw(t.min,t.max-l,e.min)),H0(0,1,n)}function kme(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Wk=.35;function Ime(t=Wk){return t===!1?t=0:t===!0&&(t=Wk),{x:HF(t,"left","right"),y:HF(t,"top","bottom")}}function HF(t,e,n){return{min:GF(t,e),max:GF(t,n)}}function GF(t,e){return typeof t=="number"?t:t[e]||0}const $F=()=>({translate:0,scale:1,origin:0,originPoint:0}),bv=()=>({x:$F(),y:$F()}),WF=()=>({min:0,max:0}),Pa=()=>({x:WF(),y:WF()});function Xd(t){return[t("x"),t("y")]}function d$({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function Pme({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function Rme(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function IM(t){return t===void 0||t===1}function qk({scale:t,scaleX:e,scaleY:n}){return!IM(t)||!IM(e)||!IM(n)}function qy(t){return qk(t)||h$(t)||t.z||t.rotate||t.rotateX||t.rotateY}function h$(t){return qF(t.x)||qF(t.y)}function qF(t){return t&&t!=="0%"}function kE(t,e,n){const s=t-n,l=e*s;return n+l}function XF(t,e,n,s,l){return l!==void 0&&(t=kE(t,l,s)),kE(t,n,s)+e}function Xk(t,e=0,n=1,s,l){t.min=XF(t.min,e,n,s,l),t.max=XF(t.max,e,n,s,l)}function f$(t,{x:e,y:n}){Xk(t.x,e.translate,e.scale,e.originPoint),Xk(t.y,n.translate,n.scale,n.originPoint)}function Nme(t,e,n,s=!1){const l=n.length;if(!l)return;e.x=e.y=1;let u,p;for(let r=0;r<l;r++){u=n[r],p=u.projectionDelta;const v=u.instance;v&&v.style&&v.style.display==="contents"||(s&&u.options.layoutScroll&&u.scroll&&u!==u.root&&wv(t,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,f$(t,p)),s&&qy(u.latestValues)&&wv(t,u.latestValues))}e.x=ZF(e.x),e.y=ZF(e.y)}function ZF(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function b0(t,e){t.min=t.min+e,t.max=t.max+e}function QF(t,e,[n,s,l]){const u=e[l]!==void 0?e[l]:.5,p=Ko(t.min,t.max,u);Xk(t,e[n],e[s],p,e.scale)}const jme=["x","scaleX","originX"],Dme=["y","scaleY","originY"];function wv(t,e){QF(t.x,e,jme),QF(t.y,e,Dme)}function p$(t,e){return d$(Rme(t.getBoundingClientRect(),e))}function Lme(t,e,n){const s=p$(t,n),{scroll:l}=e;return l&&(b0(s.x,l.offset.x),b0(s.y,l.offset.y)),s}const m$=({current:t})=>t?t.ownerDocument.defaultView:null,Ome=new WeakMap;class Fme{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Pa(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const l=E=>{const{dragSnapToOrigin:T}=this.getProps();T?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(BA(E,"page").point)},u=(E,T)=>{const{drag:k,dragPropagation:R,onDragStart:D}=this.getProps();if(k&&!R&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=MG(k),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Xd(F=>{let U=this.getAxisMotionValue(F).get()||0;if(_p.test(U)){const{projection:X}=this.visualElement;if(X&&X.layout){const W=X.layout.layoutBox[F];W&&(U=pd(W)*(parseFloat(U)/100))}}this.originPoint[F]=U}),D&&Co.update(()=>D(E,T),!1,!0);const{animationState:O}=this.visualElement;O&&O.setActive("whileDrag",!0)},p=(E,T)=>{const{dragPropagation:k,dragDirectionLock:R,onDirectionLock:D,onDrag:O}=this.getProps();if(!k&&!this.openGlobalLock)return;const{offset:F}=T;if(R&&this.currentDirection===null){this.currentDirection=Bme(F),this.currentDirection!==null&&D&&D(this.currentDirection);return}this.updateAxis("x",T.point,F),this.updateAxis("y",T.point,F),this.visualElement.render(),O&&O(E,T)},r=(E,T)=>this.stop(E,T),v=()=>Xd(E=>{var T;return this.getAnimationState(E)==="paused"&&((T=this.getAxisMotionValue(E).animation)===null||T===void 0?void 0:T.play())}),{dragSnapToOrigin:w}=this.getProps();this.panSession=new c$(e,{onSessionStart:l,onStart:u,onMove:p,onSessionEnd:r,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:w,contextWindow:m$(this.visualElement)})}stop(e,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:l}=n;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&Co.update(()=>u(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,s){const{drag:l}=this.getProps();if(!s||!XS(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let p=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(p=Eme(p,this.constraints[e],this.elastic[e])),u.set(p)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:s}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;n&&_v(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&l?this.constraints=Ame(l.layoutBox,n):this.constraints=!1,this.elastic=Ime(s),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Xd(p=>{this.getAxisMotionValue(p)&&(this.constraints[p]=kme(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!_v(e))return!1;const s=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=Lme(s,l.root,this.visualElement.getTransformPagePoint());let p=Cme(l.layout.layoutBox,u);if(n){const r=n(Pme(p));this.hasMutatedConstraints=!!r,r&&(p=d$(r))}return p}startAnimation(e){const{drag:n,dragMomentum:s,dragElastic:l,dragTransition:u,dragSnapToOrigin:p,onDragTransitionEnd:r}=this.getProps(),v=this.constraints||{},w=Xd(E=>{if(!XS(E,n,this.currentDirection))return;let T=v&&v[E]||{};p&&(T={min:0,max:0});const k=l?200:1e6,R=l?40:1e7,D={type:"inertia",velocity:s?e[E]:0,bounceStiffness:k,bounceDamping:R,timeConstant:750,restDelta:1,restSpeed:10,...u,...T};return this.startAxisValueAnimation(E,D)});return Promise.all(w).then(r)}startAxisValueAnimation(e,n){const s=this.getAxisMotionValue(e);return s.start(iN(e,s,0,n))}stopAnimation(){Xd(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Xd(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n="_drag"+e.toUpperCase(),s=this.visualElement.getProps(),l=s[n];return l||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Xd(n=>{const{drag:s}=this.getProps();if(!XS(n,s,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(n);if(l&&l.layout){const{min:p,max:r}=l.layout.layoutBox[n];u.set(e[n]-Ko(p,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!_v(n)||!s||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Xd(p=>{const r=this.getAxisMotionValue(p);if(r){const v=r.get();l[p]=Mme({min:v,max:v},this.constraints[p])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Xd(p=>{if(!XS(p,e,null))return;const r=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];r.set(Ko(v,w,l[p]))})}addListeners(){if(!this.visualElement.current)return;Ome.set(this.visualElement,this);const e=this.visualElement.current,n=qm(e,"pointerdown",v=>{const{drag:w,dragListener:E=!0}=this.getProps();w&&E&&this.start(v)}),s=()=>{const{dragConstraints:v}=this.getProps();_v(v)&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",s);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),s();const p=Um(window,"resize",()=>this.scalePositionWithinConstraints()),r=l.addEventListener("didUpdate",(({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(Xd(E=>{const T=this.getAxisMotionValue(E);T&&(this.originPoint[E]+=v[E].translate,T.set(T.get()+v[E].translate))}),this.visualElement.render())}));return()=>{p(),n(),u(),r&&r()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:p=Wk,dragMomentum:r=!0}=e;return{...e,drag:n,dragDirectionLock:s,dragPropagation:l,dragConstraints:u,dragElastic:p,dragMomentum:r}}}function XS(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function Bme(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class zme extends Y0{constructor(e){super(e),this.removeGroupControls=ya,this.removeListeners=ya,this.controls=new Fme(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ya}unmount(){this.removeGroupControls(),this.removeListeners()}}const KF=t=>(e,n)=>{t&&Co.update(()=>t(e,n))};class Ume extends Y0{constructor(){super(...arguments),this.removePointerDownListener=ya}onPointerDown(e){this.session=new c$(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:m$(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:s,onPanEnd:l}=this.node.getProps();return{onSessionStart:KF(e),onStart:KF(n),onMove:s,onEnd:(u,p)=>{delete this.session,l&&Co.update(()=>l(u,p))}}}mount(){this.removePointerDownListener=qm(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Vme(){const t=he.useContext(jA);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:s}=t,l=he.useId();return he.useEffect(()=>s(l),[]),!e&&n?[!1,()=>n&&n(l)]:[!0]}const HT={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function YF(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const A1={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Ki.test(t))t=parseFloat(t);else return t;const n=YF(t,e.target.x),s=YF(t,e.target.y);return`${n}% ${s}%`}},Hme={correct:(t,{treeScale:e,projectionDelta:n})=>{const s=t,l=G0.parse(t);if(l.length>5)return s;const u=G0.createTransformer(t),p=typeof l[0]!="number"?1:0,r=n.x.scale*e.x,v=n.y.scale*e.y;l[0+p]/=r,l[1+p]/=v;const w=Ko(r,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=w),typeof l[3+p]=="number"&&(l[3+p]/=w),u(l)}};class Gme extends fe.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s,layoutId:l}=this.props,{projection:u}=e;Khe($me),u&&(n.group&&n.group.add(u),s&&s.register&&l&&s.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),HT.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:s,drag:l,isPresent:u}=this.props,p=s.projection;return p&&(p.isPresent=u,l||e.layoutDependency!==n||n===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?p.promote():p.relegate()||Co.postRender(()=>{const r=p.getStack();(!r||!r.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(l),s&&s.deregister&&s.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function g$(t){const[e,n]=Vme(),s=he.useContext(GR);return fe.createElement(Gme,{...t,layoutGroup:s,switchLayoutGroup:he.useContext(dG),isPresent:e,safeToRemove:n})}const $me={borderRadius:{...A1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:A1,borderTopRightRadius:A1,borderBottomLeftRadius:A1,borderBottomRightRadius:A1,boxShadow:Hme},y$=["TopLeft","TopRight","BottomLeft","BottomRight"],Wme=y$.length,JF=t=>typeof t=="string"?parseFloat(t):t,eB=t=>typeof t=="number"||Ki.test(t);function qme(t,e,n,s,l,u){l?(t.opacity=Ko(0,n.opacity!==void 0?n.opacity:1,Xme(s)),t.opacityExit=Ko(e.opacity!==void 0?e.opacity:1,0,Zme(s))):u&&(t.opacity=Ko(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let p=0;p<Wme;p++){const r=`border${y$[p]}Radius`;let v=tB(e,r),w=tB(n,r);if(v===void 0&&w===void 0)continue;v||(v=0),w||(w=0),v===0||w===0||eB(v)===eB(w)?(t[r]=Math.max(Ko(JF(v),JF(w),s),0),(_p.test(w)||_p.test(v))&&(t[r]+="%")):t[r]=w}(e.rotate||n.rotate)&&(t.rotate=Ko(e.rotate||0,n.rotate||0,s))}function tB(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const Xme=x$(0,.5,zG),Zme=x$(.5,.95,ya);function x$(t,e,n){return s=>s<t?0:s>e?1:n(Pw(t,e,s))}function nB(t,e){t.min=e.min,t.max=e.max}function Wd(t,e){nB(t.x,e.x),nB(t.y,e.y)}function rB(t,e,n,s,l){return t-=e,t=kE(t,1/n,s),l!==void 0&&(t=kE(t,1/l,s)),t}function Qme(t,e=0,n=1,s=.5,l,u=t,p=t){if(_p.test(e)&&(e=parseFloat(e),e=Ko(p.min,p.max,e/100)-p.min),typeof e!="number")return;let r=Ko(u.min,u.max,s);t===u&&(r-=e),t.min=rB(t.min,e,n,r,l),t.max=rB(t.max,e,n,r,l)}function iB(t,e,[n,s,l],u,p){Qme(t,e[n],e[s],e[l],e.scale,u,p)}const Kme=["x","scaleX","originX"],Yme=["y","scaleY","originY"];function sB(t,e,n,s){iB(t.x,e,Kme,n?n.x:void 0,s?s.x:void 0),iB(t.y,e,Yme,n?n.y:void 0,s?s.y:void 0)}function oB(t){return t.translate===0&&t.scale===1}function _$(t){return oB(t.x)&&oB(t.y)}function Jme(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function v$(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function aB(t){return pd(t.x)/pd(t.y)}class ege{constructor(){this.members=[]}add(e){sN(this.members,e),e.scheduleRender()}remove(e){if(oN(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(l=>e===l);if(n===0)return!1;let s;for(let l=n;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){s=u;break}}return s?(this.promote(s),!0):!1}promote(e,n){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,n&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:s}=e;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function lB(t,e,n){let s="";const l=t.x.translate/e.x,u=t.y.translate/e.y;if((l||u)&&(s=`translate3d(${l}px, ${u}px, 0) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:v,rotateX:w,rotateY:E}=n;v&&(s+=`rotate(${v}deg) `),w&&(s+=`rotateX(${w}deg) `),E&&(s+=`rotateY(${E}deg) `)}const p=t.x.scale*e.x,r=t.y.scale*e.y;return(p!==1||r!==1)&&(s+=`scale(${p}, ${r})`),s||"none"}const tge=(t,e)=>t.depth-e.depth;class nge{constructor(){this.children=[],this.isDirty=!1}add(e){sN(this.children,e),this.isDirty=!0}remove(e){oN(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(tge),this.isDirty=!1,this.children.forEach(e)}}function rge(t,e){const n=performance.now(),s=({timestamp:l})=>{const u=l-n;u>=e&&(rg(s),t(u-e))};return Co.read(s,!0),()=>rg(s)}function ige(t){window.MotionDebug&&window.MotionDebug.record(t)}function sge(t){return t instanceof SVGElement&&t.tagName!=="svg"}function oge(t,e,n){const s=Tu(t)?t:eb(t);return s.start(iN("",s,e,n)),s.animation}const cB=["","X","Y","Z"],age={visibility:"hidden"},uB=1e3;let lge=0;const Xy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function b$({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:s,resetTransform:l}){return class{constructor(p={},r=e==null?void 0:e()){this.id=lge++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Xy.totalNodes=Xy.resolvedTargetDeltas=Xy.recalculatedProjection=0,this.nodes.forEach(dge),this.nodes.forEach(gge),this.nodes.forEach(yge),this.nodes.forEach(hge),ige(Xy)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new nge)}addEventListener(p,r){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new aN),this.eventHandlers.get(p).add(r)}notifyListeners(p,...r){const v=this.eventHandlers.get(p);v&&v.notify(...r)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,r=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=sge(p),this.instance=p;const{layoutId:v,layout:w,visualElement:E}=this.options;if(E&&!E.current&&E.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(w||v)&&(this.isLayoutDirty=!0),t){let T;const k=()=>this.root.updateBlockedByResize=!1;t(p,()=>{this.root.updateBlockedByResize=!0,T&&T(),T=rge(k,250),HT.hasAnimatedSinceResize&&(HT.hasAnimatedSinceResize=!1,this.nodes.forEach(hB))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&E&&(v||w)&&this.addEventListener("didUpdate",({delta:T,hasLayoutChanged:k,hasRelativeTargetChanged:R,layout:D})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const O=this.options.transition||E.getDefaultTransition()||wge,{onLayoutAnimationStart:F,onLayoutAnimationComplete:U}=E.getProps(),X=!this.targetLayout||!v$(this.targetLayout,D)||R,W=!k&&R;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||W||k&&(X||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(T,W);const K={...rN(O,"layout"),onPlay:F,onComplete:U};(E.shouldReduceMotion||this.options.layoutRoot)&&(K.delay=0,K.type=!1),this.startAnimation(K)}else k||hB(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=D})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,rg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(xge),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let E=0;E<this.path.length;E++){const T=this.path[E];T.shouldResetTransform=!0,T.updateScroll("snapshot"),T.options.layoutRoot&&T.willUpdate(!1)}const{layoutId:r,layout:v}=this.options;if(r===void 0&&!v)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(dB);return}this.isUpdating||this.nodes.forEach(pge),this.isUpdating=!1,this.nodes.forEach(mge),this.nodes.forEach(cge),this.nodes.forEach(uge),this.clearAllSnapshots();const r=performance.now();fc.delta=H0(0,1e3/60,r-fc.timestamp),fc.timestamp=r,fc.isProcessing=!0,vM.update.process(fc),vM.preRender.process(fc),vM.render.process(fc),fc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(fge),this.sharedNodes.forEach(_ge)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Co.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Co.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Pa(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:r}=this.options;r&&r.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let r=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(r=!1),r&&(this.scroll={animationId:this.root.animationId,phase:p,isRoot:s(this.instance),offset:n(this.instance)})}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform,r=this.projectionDelta&&!_$(this.projectionDelta),v=this.getTransformTemplate(),w=v?v(this.latestValues,""):void 0,E=w!==this.prevTransformTemplateValue;p&&(r||qy(this.latestValues)||E)&&(l(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const r=this.measurePageBox();let v=this.removeElementScroll(r);return p&&(v=this.removeTransform(v)),Sge(v),{animationId:this.root.animationId,measuredBox:r,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:p}=this.options;if(!p)return Pa();const r=p.measureViewportBox(),{scroll:v}=this.root;return v&&(b0(r.x,v.offset.x),b0(r.y,v.offset.y)),r}removeElementScroll(p){const r=Pa();Wd(r,p);for(let v=0;v<this.path.length;v++){const w=this.path[v],{scroll:E,options:T}=w;if(w!==this.root&&E&&T.layoutScroll){if(E.isRoot){Wd(r,p);const{scroll:k}=this.root;k&&(b0(r.x,-k.offset.x),b0(r.y,-k.offset.y))}b0(r.x,E.offset.x),b0(r.y,E.offset.y)}}return r}applyTransform(p,r=!1){const v=Pa();Wd(v,p);for(let w=0;w<this.path.length;w++){const E=this.path[w];!r&&E.options.layoutScroll&&E.scroll&&E!==E.root&&wv(v,{x:-E.scroll.offset.x,y:-E.scroll.offset.y}),qy(E.latestValues)&&wv(v,E.latestValues)}return qy(this.latestValues)&&wv(v,this.latestValues),v}removeTransform(p){const r=Pa();Wd(r,p);for(let v=0;v<this.path.length;v++){const w=this.path[v];if(!w.instance||!qy(w.latestValues))continue;qk(w.latestValues)&&w.updateSnapshot();const E=Pa(),T=w.measurePageBox();Wd(E,T),sB(r,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,E)}return qy(this.latestValues)&&sB(r,this.latestValues),r}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==fc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var r;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==v;if(!(p||w&&this.isSharedProjectionDirty||this.isProjectionDirty||!((r=this.parent)===null||r===void 0)&&r.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:T,layoutId:k}=this.options;if(!(!this.layout||!(T||k))){if(this.resolvedRelativeTargetAt=fc.timestamp,!this.targetDelta&&!this.relativeTarget){const R=this.getClosestProjectingParent();R&&R.layout&&this.animationProgress!==1?(this.relativeParent=R,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pa(),this.relativeTargetOrigin=Pa(),q1(this.relativeTargetOrigin,this.layout.layoutBox,R.layout.layoutBox),Wd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Pa(),this.targetWithTransforms=Pa()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Tme(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Wd(this.target,this.layout.layoutBox),f$(this.target,this.targetDelta)):Wd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const R=this.getClosestProjectingParent();R&&!!R.resumingFrom==!!this.resumingFrom&&!R.options.layoutScroll&&R.target&&this.animationProgress!==1?(this.relativeParent=R,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pa(),this.relativeTargetOrigin=Pa(),q1(this.relativeTargetOrigin,this.target,R.target),Wd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Xy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||qk(this.parent.latestValues)||h$(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const r=this.getLead(),v=!!this.resumingFrom||this!==r;let w=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(w=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===fc.timestamp&&(w=!1),w)return;const{layout:E,layoutId:T}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(E||T))return;Wd(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,R=this.treeScale.y;Nme(this.layoutCorrected,this.treeScale,this.path,v),r.layout&&!r.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(r.target=r.layout.layoutBox);const{target:D}=r;if(!D){this.projectionTransform&&(this.projectionDelta=bv(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=bv(),this.projectionDeltaWithTransform=bv());const O=this.projectionTransform;W1(this.projectionDelta,this.layoutCorrected,D,this.latestValues),this.projectionTransform=lB(this.projectionDelta,this.treeScale),(this.projectionTransform!==O||this.treeScale.x!==k||this.treeScale.y!==R)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",D)),Xy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),p){const r=this.getStack();r&&r.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(p,r=!1){const v=this.snapshot,w=v?v.latestValues:{},E={...this.latestValues},T=bv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!r;const k=Pa(),R=v?v.source:void 0,D=this.layout?this.layout.source:void 0,O=R!==D,F=this.getStack(),U=!F||F.members.length<=1,X=!!(O&&!U&&this.options.crossfade===!0&&!this.path.some(bge));this.animationProgress=0;let W;this.mixTargetDelta=K=>{const ne=K/1e3;fB(T.x,p.x,ne),fB(T.y,p.y,ne),this.setTargetDelta(T),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(q1(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),vge(this.relativeTarget,this.relativeTargetOrigin,k,ne),W&&Jme(this.relativeTarget,W)&&(this.isProjectionDirty=!1),W||(W=Pa()),Wd(W,this.relativeTarget)),O&&(this.animationValues=E,qme(E,w,this.latestValues,ne,X,U)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(rg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Co.update(()=>{HT.hasAnimatedSinceResize=!0,this.currentAnimation=oge(0,uB,{...p,onUpdate:r=>{this.mixTargetDelta(r),p.onUpdate&&p.onUpdate(r)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(uB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:r,target:v,layout:w,latestValues:E}=p;if(!(!r||!v||!w)){if(this!==p&&this.layout&&w&&w$(this.options.animationType,this.layout.layoutBox,w.layoutBox)){v=this.target||Pa();const T=pd(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+T;const k=pd(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+k}Wd(r,v),wv(r,E),W1(this.projectionDeltaWithTransform,this.layoutCorrected,r,E)}}registerSharedNode(p,r){this.sharedNodes.has(p)||this.sharedNodes.set(p,new ege),this.sharedNodes.get(p).add(r);const w=r.options.initialPromotionConfig;r.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(r):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:r}=this.options;return r?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:r}=this.options;return r?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:r,preserveFollowOpacity:v}={}){const w=this.getStack();w&&w.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),r&&this.setOptions({transition:r})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetRotation(){const{visualElement:p}=this.options;if(!p)return;let r=!1;const{latestValues:v}=p;if((v.rotate||v.rotateX||v.rotateY||v.rotateZ)&&(r=!0),!r)return;const w={};for(let E=0;E<cB.length;E++){const T="rotate"+cB[E];v[T]&&(w[T]=v[T],p.setStaticValue(T,0))}p.render();for(const E in w)p.setStaticValue(E,w[E]);p.scheduleRender()}getProjectionStyles(p){var r,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return age;const w={visibility:""},E=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,w.opacity="",w.pointerEvents=VT(p==null?void 0:p.pointerEvents)||"",w.transform=E?E(this.latestValues,""):"none",w;const T=this.getLead();if(!this.projectionDelta||!this.layout||!T.target){const O={};return this.options.layoutId&&(O.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,O.pointerEvents=VT(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!qy(this.latestValues)&&(O.transform=E?E({},""):"none",this.hasProjected=!1),O}const k=T.animationValues||T.latestValues;this.applyTransformsToTarget(),w.transform=lB(this.projectionDeltaWithTransform,this.treeScale,k),E&&(w.transform=E(k,w.transform));const{x:R,y:D}=this.projectionDelta;w.transformOrigin=`${R.origin*100}% ${D.origin*100}% 0`,T.animationValues?w.opacity=T===this?(v=(r=k.opacity)!==null&&r!==void 0?r:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:w.opacity=T===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const O in wE){if(k[O]===void 0)continue;const{correct:F,applyTo:U}=wE[O],X=w.transform==="none"?k[O]:F(k[O],T);if(U){const W=U.length;for(let K=0;K<W;K++)w[U[K]]=X}else w[O]=X}return this.options.layoutId&&(w.pointerEvents=T===this?VT(p==null?void 0:p.pointerEvents)||"":"none"),w}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var r;return(r=p.currentAnimation)===null||r===void 0?void 0:r.stop()}),this.root.nodes.forEach(dB),this.root.sharedNodes.clear()}}}function cge(t){t.updateLayout()}function uge(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:l}=t.layout,{animationType:u}=t.options,p=n.source!==t.layout.source;u==="size"?Xd(T=>{const k=p?n.measuredBox[T]:n.layoutBox[T],R=pd(k);k.min=s[T].min,k.max=k.min+R}):w$(u,n.layoutBox,s)&&Xd(T=>{const k=p?n.measuredBox[T]:n.layoutBox[T],R=pd(s[T]);k.max=k.min+R,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[T].max=t.relativeTarget[T].min+R)});const r=bv();W1(r,s,n.layoutBox);const v=bv();p?W1(v,t.applyTransform(l,!0),n.measuredBox):W1(v,s,n.layoutBox);const w=!_$(r);let E=!1;if(!t.resumeFrom){const T=t.getClosestProjectingParent();if(T&&!T.resumeFrom){const{snapshot:k,layout:R}=T;if(k&&R){const D=Pa();q1(D,n.layoutBox,k.layoutBox);const O=Pa();q1(O,s,R.layoutBox),v$(D,O)||(E=!0),T.options.layoutRoot&&(t.relativeTarget=O,t.relativeTargetOrigin=D,t.relativeParent=T)}}}t.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:v,layoutDelta:r,hasLayoutChanged:w,hasRelativeTargetChanged:E})}else if(t.isLead()){const{onExitComplete:s}=t.options;s&&s()}t.options.transition=void 0}function dge(t){Xy.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function hge(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function fge(t){t.clearSnapshot()}function dB(t){t.clearMeasurements()}function pge(t){t.isLayoutDirty=!1}function mge(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function hB(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function gge(t){t.resolveTargetDelta()}function yge(t){t.calcProjection()}function xge(t){t.resetRotation()}function _ge(t){t.removeLeadSnapshot()}function fB(t,e,n){t.translate=Ko(e.translate,0,n),t.scale=Ko(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function pB(t,e,n,s){t.min=Ko(e.min,n.min,s),t.max=Ko(e.max,n.max,s)}function vge(t,e,n,s){pB(t.x,e.x,n.x,s),pB(t.y,e.y,n.y,s)}function bge(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const wge={duration:.45,ease:[.4,0,.1,1]},mB=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),gB=mB("applewebkit/")&&!mB("chrome/")?Math.round:ya;function yB(t){t.min=gB(t.min),t.max=gB(t.max)}function Sge(t){yB(t.x),yB(t.y)}function w$(t,e,n){return t==="position"||t==="preserve-aspect"&&!$k(aB(e),aB(n),.2)}const Tge=b$({attachResizeListener:(t,e)=>Um(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),PM={current:void 0},S$=b$({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!PM.current){const t=new Tge({});t.mount(window),t.setOptions({layoutScroll:!0}),PM.current=t}return PM.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Ege={pan:{Feature:Ume},drag:{Feature:zme,ProjectionNode:S$,MeasureLayout:g$}},Age=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Cge(t){const e=Age.exec(t);if(!e)return[,];const[,n,s]=e;return[n,s]}function Zk(t,e,n=1){const[s,l]=Cge(t);if(!s)return;const u=window.getComputedStyle(e).getPropertyValue(s);if(u){const p=u.trim();return s$(p)?parseFloat(p):p}else return Fk(l)?Zk(l,e,n+1):l}function Mge(t,{...e},n){const s=t.current;if(!(s instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(l=>{const u=l.get();if(!Fk(u))return;const p=Zk(u,s);p&&l.set(p)});for(const l in e){const u=e[l];if(!Fk(u))continue;const p=Zk(u,s);p&&(e[l]=p,n||(n={}),n[l]===void 0&&(n[l]=u))}return{target:e,transitionEnd:n}}const kge=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),T$=t=>kge.has(t),Ige=t=>Object.keys(t).some(T$),xB=t=>t===Yx||t===Ki,_B=(t,e)=>parseFloat(t.split(", ")[e]),vB=(t,e)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const l=s.match(/^matrix3d\((.+)\)$/);if(l)return _B(l[1],e);{const u=s.match(/^matrix\((.+)\)$/);return u?_B(u[1],t):0}},Pge=new Set(["x","y","z"]),Rge=_2.filter(t=>!Pge.has(t));function Nge(t){const e=[];return Rge.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const tb={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:vB(4,13),y:vB(5,14)};tb.translateX=tb.x;tb.translateY=tb.y;const jge=(t,e,n)=>{const s=e.measureViewportBox(),l=e.current,u=getComputedStyle(l),{display:p}=u,r={};p==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(w=>{r[w]=tb[w](s,u)}),e.render();const v=e.measureViewportBox();return n.forEach(w=>{const E=e.getValue(w);E&&E.jump(r[w]),t[w]=tb[w](v,u)}),t},Dge=(t,e,n={},s={})=>{e={...e},s={...s};const l=Object.keys(e).filter(T$);let u=[],p=!1;const r=[];if(l.forEach(v=>{const w=t.getValue(v);if(!t.hasValue(v))return;let E=n[v],T=E1(E);const k=e[v];let R;if(TE(k)){const D=k.length,O=k[0]===null?1:0;E=k[O],T=E1(E);for(let F=O;F<D&&k[F]!==null;F++)R?YR(E1(k[F])===R):R=E1(k[F])}else R=E1(k);if(T!==R)if(xB(T)&&xB(R)){const D=w.get();typeof D=="string"&&w.set(parseFloat(D)),typeof k=="string"?e[v]=parseFloat(k):Array.isArray(k)&&R===Ki&&(e[v]=k.map(parseFloat))}else T!=null&&T.transform&&(R!=null&&R.transform)&&(E===0||k===0)?E===0?w.set(R.transform(E)):e[v]=T.transform(k):(p||(u=Nge(t),p=!0),r.push(v),s[v]=s[v]!==void 0?s[v]:e[v],w.jump(k))}),r.length){const v=r.indexOf("height")>=0?window.pageYOffset:null,w=jge(e,t,r);return u.length&&u.forEach(([E,T])=>{t.getValue(E).set(T)}),t.render(),DA&&v!==null&&window.scrollTo({top:v}),{target:w,transitionEnd:s}}else return{target:e,transitionEnd:s}};function Lge(t,e,n,s){return Ige(e)?Dge(t,e,n,s):{target:e,transitionEnd:s}}const Oge=(t,e,n,s)=>{const l=Mge(t,e,s);return e=l.target,s=l.transitionEnd,Lge(t,e,n,s)},Qk={current:null},E$={current:!1};function Fge(){if(E$.current=!0,!!DA)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Qk.current=t.matches;t.addListener(e),e()}else Qk.current=!1}function Bge(t,e,n){const{willChange:s}=e;for(const l in e){const u=e[l],p=n[l];if(Tu(u))t.addValue(l,u),ME(s)&&s.add(l);else if(Tu(p))t.addValue(l,eb(u,{owner:t})),ME(s)&&s.remove(l);else if(p!==u)if(t.hasValue(l)){const r=t.getValue(l);!r.hasAnimated&&r.set(u)}else{const r=t.getStaticValue(l);t.addValue(l,eb(r!==void 0?r:u,{owner:t}))}}for(const l in n)e[l]===void 0&&t.removeValue(l);return e}const bB=new WeakMap,A$=Object.keys(Iw),zge=A$.length,wB=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Uge=HR.length;class Vge{constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:l,visualState:u},p={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Co.render(this.render,!1,!0);const{latestValues:r,renderState:v}=u;this.latestValues=r,this.baseTarget={...r},this.initialValues=n.initial?{...r}:{},this.renderState=v,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=p,this.isControllingVariants=OA(n),this.isVariantNode=uG(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:w,...E}=this.scrapeMotionValuesFromProps(n,{});for(const T in E){const k=E[T];r[T]!==void 0&&Tu(k)&&(k.set(r[T],!1),ME(w)&&w.add(T))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){this.current=e,bB.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),E$.current||Fge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Qk.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){bB.delete(this.current),this.projection&&this.projection.unmount(),rg(this.notifyUpdate),rg(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,n){const s=Kx.has(e),l=n.on("change",p=>{this.latestValues[e]=p,this.props.onUpdate&&Co.update(this.notifyUpdate,!1,!0),s&&this.projection&&(this.projection.isTransformDirty=!0)}),u=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{l(),u()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},s,l,u){let p,r;for(let v=0;v<zge;v++){const w=A$[v],{isEnabled:E,Feature:T,ProjectionNode:k,MeasureLayout:R}=Iw[w];k&&(p=k),E(n)&&(!this.features[w]&&T&&(this.features[w]=new T(this)),R&&(r=R))}if((this.type==="html"||this.type==="svg")&&!this.projection&&p){this.projection=new p(this.latestValues,this.parent&&this.parent.projection);const{layoutId:v,layout:w,drag:E,dragConstraints:T,layoutScroll:k,layoutRoot:R}=n;this.projection.setOptions({layoutId:v,layout:w,alwaysMeasureLayout:!!E||T&&_v(T),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof w=="string"?w:"both",initialPromotionConfig:u,layoutScroll:k,layoutRoot:R})}return r}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Pa()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<wB.length;s++){const l=wB[s];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u=e["on"+l];u&&(this.propEventSubscriptions[l]=this.on(l,u))}this.prevMotionValues=Bge(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const n={};for(let s=0;s<Uge;s++){const l=HR[s],u=this.props[l];(kw(u)||u===!1)&&(n[l]=u)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=eb(n,{owner:this}),this.addValue(e,s)),s}readValue(e){var n;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:s}=this.props,l=typeof s=="string"||typeof s=="object"?(n=KR(this.props,s))===null||n===void 0?void 0:n[e]:void 0;if(s&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!Tu(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new aN),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class C$ extends Vge{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...s},{transformValues:l},u){let p=sme(s,e||{},this);if(l&&(n&&(n=l(n)),s&&(s=l(s)),p&&(p=l(p))),u){rme(this,s,p);const r=Oge(this,s,p,n);n=r.transitionEnd,s=r.target}return{transition:e,transitionEnd:n,...s}}}function Hge(t){return window.getComputedStyle(t)}class Gge extends C${constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,n){if(Kx.has(n)){const s=nN(n);return s&&s.default||0}else{const s=Hge(e),l=(pG(n)?s.getPropertyValue(n):s[n])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:n}){return p$(e,n)}build(e,n,s,l){WR(e,n,s,l.transformTemplate)}scrapeMotionValuesFromProps(e,n){return QR(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Tu(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,s,l){vG(e,n,s,l)}}class $ge extends C${constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Kx.has(n)){const s=nN(n);return s&&s.default||0}return n=bG.has(n)?n:UR(n),e.getAttribute(n)}measureInstanceViewportBox(){return Pa()}scrapeMotionValuesFromProps(e,n){return SG(e,n)}build(e,n,s,l){XR(e,n,s,this.isSVGTag,l.transformTemplate)}renderInstance(e,n,s,l){wG(e,n,s,l)}mount(e){this.isSVGTag=ZR(e.tagName),super.mount(e)}}const Wge=(t,e)=>$R(t)?new $ge(e,{enableHardwareAcceleration:!1}):new Gge(e,{enableHardwareAcceleration:!0}),qge={layout:{ProjectionNode:S$,MeasureLayout:g$}},Xge={...vme,...zfe,...Ege,...qge},it=Zhe((t,e)=>Cfe(t,e,Xge,Wge));function M$(){const t=he.useRef(!1);return zR(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function Zge(){const t=M$(),[e,n]=he.useState(0),s=he.useCallback(()=>{t.current&&n(e+1)},[e]);return[he.useCallback(()=>Co.postRender(s),[s]),e]}class Qge extends he.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Kge({children:t,isPresent:e}){const n=he.useId(),s=he.useRef(null),l=he.useRef({width:0,height:0,top:0,left:0});return he.useInsertionEffect(()=>{const{width:u,height:p,top:r,left:v}=l.current;if(e||!s.current||!u||!p)return;s.current.dataset.motionPopId=n;const w=document.createElement("style");return document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${p}px !important;
            top: ${r}px !important;
            left: ${v}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[e]),he.createElement(Qge,{isPresent:e,childRef:s,sizeRef:l},he.cloneElement(t,{ref:s}))}const RM=({children:t,initial:e,isPresent:n,onExitComplete:s,custom:l,presenceAffectsLayout:u,mode:p})=>{const r=TG(Yge),v=he.useId(),w=he.useMemo(()=>({id:v,initial:e,isPresent:n,custom:l,onExitComplete:E=>{r.set(E,!0);for(const T of r.values())if(!T)return;s&&s()},register:E=>(r.set(E,!1),()=>r.delete(E))}),u?void 0:[n]);return he.useMemo(()=>{r.forEach((E,T)=>r.set(T,!1))},[n]),he.useEffect(()=>{!n&&!r.size&&s&&s()},[n]),p==="popLayout"&&(t=he.createElement(Kge,{isPresent:n},t)),he.createElement(jA.Provider,{value:w},t)};function Yge(){return new Map}function Jge(t){return he.useEffect(()=>()=>t(),[])}const Zy=t=>t.key||"";function e0e(t,e){t.forEach(n=>{const s=Zy(n);e.set(s,n)})}function t0e(t){const e=[];return he.Children.forEach(t,n=>{he.isValidElement(n)&&e.push(n)}),e}const Xc=({children:t,custom:e,initial:n=!0,onExitComplete:s,exitBeforeEnter:l,presenceAffectsLayout:u=!0,mode:p="sync"})=>{const r=he.useContext(GR).forceRender||Zge()[0],v=M$(),w=t0e(t);let E=w;const T=he.useRef(new Map).current,k=he.useRef(E),R=he.useRef(new Map).current,D=he.useRef(!0);if(zR(()=>{D.current=!1,e0e(w,R),k.current=E}),Jge(()=>{D.current=!0,R.clear(),T.clear()}),D.current)return he.createElement(he.Fragment,null,E.map(X=>he.createElement(RM,{key:Zy(X),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:u,mode:p},X)));E=[...E];const O=k.current.map(Zy),F=w.map(Zy),U=O.length;for(let X=0;X<U;X++){const W=O[X];F.indexOf(W)===-1&&!T.has(W)&&T.set(W,void 0)}return p==="wait"&&T.size&&(E=[]),T.forEach((X,W)=>{if(F.indexOf(W)!==-1)return;const K=R.get(W);if(!K)return;const ne=O.indexOf(W);let te=X;if(!te){const re=()=>{T.delete(W);const xe=Array.from(R.keys()).filter(ae=>!F.includes(ae));if(xe.forEach(ae=>R.delete(ae)),k.current=w.filter(ae=>{const ce=Zy(ae);return ce===W||xe.includes(ce)}),!T.size){if(v.current===!1)return;r(),s&&s()}};te=he.createElement(RM,{key:Zy(K),isPresent:!1,onExitComplete:re,custom:e,presenceAffectsLayout:u,mode:p},K),T.set(W,te)}E.splice(ne,0,te)}),E=E.map(X=>{const W=X.key;return T.has(W)?X:he.createElement(RM,{key:Zy(X),isPresent:!0,presenceAffectsLayout:u,mode:p},X)}),he.createElement(he.Fragment,null,T.size?E:E.map(X=>he.cloneElement(X)))};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var n0e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0e=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Nr=(t,e)=>{const n=he.forwardRef(({color:s="currentColor",size:l=24,strokeWidth:u=2,absoluteStrokeWidth:p,className:r="",children:v,...w},E)=>he.createElement("svg",{ref:E,...n0e,width:l,height:l,stroke:s,strokeWidth:p?Number(u)*24/Number(l):u,className:["lucide",`lucide-${r0e(t)}`,r].join(" "),...w},[...e.map(([T,k])=>he.createElement(T,k)),...Array.isArray(v)?v:[v]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lN=Nr("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kk=Nr("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i0e=Nr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=Nr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vl=Nr("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0e=Nr("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cN=Nr("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=Nr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0e=Nr("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0e=Nr("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=Nr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=Nr("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=Nr("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rw=Nr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=Nr("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=Nr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uN=Nr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S2=Nr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T2=Nr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=Nr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0e=Nr("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=Nr("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c0e=Nr("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G_=Nr("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u0e=Nr("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IE=Nr("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=Nr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UA=Nr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=Nr("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k$=Nr("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ep=Nr("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I$=Nr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=Nr("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d0e=Nr("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0e=Nr("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f0e=Nr("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vp=Nr("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PE=Nr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0e=Nr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dN=Nr("Hotel",[["path",{d:"M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z",key:"p9z69c"}],["path",{d:"m9 16 .348-.24c1.465-1.013 3.84-1.013 5.304 0L15 16",key:"1bvcvh"}],["path",{d:"M8 7h.01",key:"1vti4s"}],["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M12 7h.01",key:"1ivr5q"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M10 22v-6.5m4 0V22",key:"16gs4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m0e=Nr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g0e=Nr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y0e=Nr("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x0e=Nr("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0e=Nr("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=Nr("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hN=Nr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=Nr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=Nr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=Nr("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=Nr("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=Nr("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kB=Nr("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jM=Nr("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v0e=Nr("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=Nr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b0e=Nr("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P$=Nr("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w0e=Nr("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RE=Nr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R$=Nr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nb=Nr("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HA=Nr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0e=Nr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hx=Nr("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yk=Nr("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IB=Nr("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=Nr("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=Nr("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=Nr("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0e=Nr("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0e=Nr("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nw=Nr("TramFront",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h0",key:"q9eq1f"}],["path",{d:"M16 15h0",key:"pzrbjg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E2=Nr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0e=Nr("Trees",[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16v0H5v0h0a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"yh07w9"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N$=Nr("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=Nr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=Nr("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j$=Nr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=Nr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jw=Nr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NE=Nr("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=Nr("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fN=Nr("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=Nr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=Nr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),C0e=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class pN extends Error{constructor(e,n="FunctionsError",s){super(e),this.name=n,this.context=s}}class M0e extends pN{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class RB extends pN{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class NB extends pN{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Jk;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Jk||(Jk={}));class k0e{constructor(e,{headers:n={},customFetch:s,region:l=Jk.Any}={}){this.url=e,this.headers=n,this.region=l,this.fetch=C0e(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return yi(this,arguments,void 0,function*(n,s={}){var l;let u,p;try{const{headers:r,method:v,body:w,signal:E,timeout:T}=s;let k={},{region:R}=s;R||(R=this.region);const D=new URL(`${this.url}/${n}`);R&&R!=="any"&&(k["x-region"]=R,D.searchParams.set("forceFunctionRegion",R));let O;w&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)?typeof Blob<"u"&&w instanceof Blob||w instanceof ArrayBuffer?(k["Content-Type"]="application/octet-stream",O=w):typeof w=="string"?(k["Content-Type"]="text/plain",O=w):typeof FormData<"u"&&w instanceof FormData?O=w:(k["Content-Type"]="application/json",O=JSON.stringify(w)):O=w;let F=E;T&&(p=new AbortController,u=setTimeout(()=>p.abort(),T),E?(F=p.signal,E.addEventListener("abort",()=>p.abort())):F=p.signal);const U=yield this.fetch(D.toString(),{method:v||"POST",headers:Object.assign(Object.assign(Object.assign({},k),this.headers),r),body:O,signal:F}).catch(ne=>{throw new M0e(ne)}),X=U.headers.get("x-relay-error");if(X&&X==="true")throw new RB(U);if(!U.ok)throw new NB(U);let W=((l=U.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),K;return W==="application/json"?K=yield U.json():W==="application/octet-stream"||W==="application/pdf"?K=yield U.blob():W==="text/event-stream"?K=U:W==="multipart/form-data"?K=yield U.formData():K=yield U.text(),{data:K,error:null,response:U}}catch(r){return{data:null,error:r,response:r instanceof NB||r instanceof RB?r.context:void 0}}finally{u&&clearTimeout(u)}})}}var uc={};const vb=vK(ale);var ZS={},QS={},KS={},YS={},JS={},eT={},jB;function D$(){if(jB)return eT;jB=1,Object.defineProperty(eT,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return eT.default=t,eT}var DB;function L$(){if(DB)return JS;DB=1,Object.defineProperty(JS,"__esModule",{value:!0});const e=vb.__importDefault(D$());class n{constructor(l){var u,p;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(p=l.isMaybeSingle)!==null&&p!==void 0?p:!1,l.fetch?this.fetch=l.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const p=this.fetch;let r=p(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var w,E,T,k;let R=null,D=null,O=null,F=v.status,U=v.statusText;if(v.ok){if(this.method!=="HEAD"){const ne=await v.text();ne===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((w=this.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?D=ne:D=JSON.parse(ne))}const W=(E=this.headers.get("Prefer"))===null||E===void 0?void 0:E.match(/count=(exact|planned|estimated)/),K=(T=v.headers.get("content-range"))===null||T===void 0?void 0:T.split("/");W&&K&&K.length>1&&(O=parseInt(K[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(D)&&(D.length>1?(R={code:"PGRST116",details:`Results contain ${D.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},D=null,O=null,F=406,U="Not Acceptable"):D.length===1?D=D[0]:D=null)}else{const W=await v.text();try{R=JSON.parse(W),Array.isArray(R)&&v.status===404&&(D=[],R=null,F=200,U="OK")}catch{v.status===404&&W===""?(F=204,U="No Content"):R={message:W}}if(R&&this.isMaybeSingle&&(!((k=R==null?void 0:R.details)===null||k===void 0)&&k.includes("0 rows"))&&(R=null,F=200,U="OK"),R&&this.shouldThrowOnError)throw new e.default(R)}return{error:R,data:D,count:O,status:F,statusText:U}});return this.shouldThrowOnError||(r=r.catch(v=>{var w,E,T,k,R,D;let O="";const F=v==null?void 0:v.cause;if(F){const U=(w=F==null?void 0:F.message)!==null&&w!==void 0?w:"",X=(E=F==null?void 0:F.code)!==null&&E!==void 0?E:"";O=`${(T=v==null?void 0:v.name)!==null&&T!==void 0?T:"FetchError"}: ${v==null?void 0:v.message}`,O+=`

Caused by: ${(k=F==null?void 0:F.name)!==null&&k!==void 0?k:"Error"}: ${U}`,X&&(O+=` (${X})`),F!=null&&F.stack&&(O+=`
${F.stack}`)}else O=(R=v==null?void 0:v.stack)!==null&&R!==void 0?R:"";return{error:{message:`${(D=v==null?void 0:v.name)!==null&&D!==void 0?D:"FetchError"}: ${v==null?void 0:v.message}`,details:O,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(l,u)}returns(){return this}overrideTypes(){return this}}return JS.default=n,JS}var LB;function O$(){if(LB)return YS;LB=1,Object.defineProperty(YS,"__esModule",{value:!0});const e=vb.__importDefault(L$());class n extends e.default{select(l){let u=!1;const p=(l??"*").split("").map(r=>/\s/.test(r)&&!u?"":(r==='"'&&(u=!u),r)).join("");return this.url.searchParams.set("select",p),this.headers.append("Prefer","return=representation"),this}order(l,{ascending:u=!0,nullsFirst:p,foreignTable:r,referencedTable:v=r}={}){const w=v?`${v}.order`:"order",E=this.url.searchParams.get(w);return this.url.searchParams.set(w,`${E?`${E},`:""}${l}.${u?"asc":"desc"}${p===void 0?"":p?".nullsfirst":".nullslast"}`),this}limit(l,{foreignTable:u,referencedTable:p=u}={}){const r=typeof p>"u"?"limit":`${p}.limit`;return this.url.searchParams.set(r,`${l}`),this}range(l,u,{foreignTable:p,referencedTable:r=p}={}){const v=typeof r>"u"?"offset":`${r}.offset`,w=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(v,`${l}`),this.url.searchParams.set(w,`${u-l+1}`),this}abortSignal(l){return this.signal=l,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:l=!1,verbose:u=!1,settings:p=!1,buffers:r=!1,wal:v=!1,format:w="text"}={}){var E;const T=[l?"analyze":null,u?"verbose":null,p?"settings":null,r?"buffers":null,v?"wal":null].filter(Boolean).join("|"),k=(E=this.headers.get("Accept"))!==null&&E!==void 0?E:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${w}; for="${k}"; options=${T};`),w==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(l){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${l}`),this}}return YS.default=n,YS}var OB;function mN(){if(OB)return KS;OB=1,Object.defineProperty(KS,"__esModule",{value:!0});const e=vb.__importDefault(O$()),n=new RegExp("[,()]");class s extends e.default{eq(u,p){return this.url.searchParams.append(u,`eq.${p}`),this}neq(u,p){return this.url.searchParams.append(u,`neq.${p}`),this}gt(u,p){return this.url.searchParams.append(u,`gt.${p}`),this}gte(u,p){return this.url.searchParams.append(u,`gte.${p}`),this}lt(u,p){return this.url.searchParams.append(u,`lt.${p}`),this}lte(u,p){return this.url.searchParams.append(u,`lte.${p}`),this}like(u,p){return this.url.searchParams.append(u,`like.${p}`),this}likeAllOf(u,p){return this.url.searchParams.append(u,`like(all).{${p.join(",")}}`),this}likeAnyOf(u,p){return this.url.searchParams.append(u,`like(any).{${p.join(",")}}`),this}ilike(u,p){return this.url.searchParams.append(u,`ilike.${p}`),this}ilikeAllOf(u,p){return this.url.searchParams.append(u,`ilike(all).{${p.join(",")}}`),this}ilikeAnyOf(u,p){return this.url.searchParams.append(u,`ilike(any).{${p.join(",")}}`),this}regexMatch(u,p){return this.url.searchParams.append(u,`match.${p}`),this}regexIMatch(u,p){return this.url.searchParams.append(u,`imatch.${p}`),this}is(u,p){return this.url.searchParams.append(u,`is.${p}`),this}isDistinct(u,p){return this.url.searchParams.append(u,`isdistinct.${p}`),this}in(u,p){const r=Array.from(new Set(p)).map(v=>typeof v=="string"&&n.test(v)?`"${v}"`:`${v}`).join(",");return this.url.searchParams.append(u,`in.(${r})`),this}contains(u,p){return typeof p=="string"?this.url.searchParams.append(u,`cs.${p}`):Array.isArray(p)?this.url.searchParams.append(u,`cs.{${p.join(",")}}`):this.url.searchParams.append(u,`cs.${JSON.stringify(p)}`),this}containedBy(u,p){return typeof p=="string"?this.url.searchParams.append(u,`cd.${p}`):Array.isArray(p)?this.url.searchParams.append(u,`cd.{${p.join(",")}}`):this.url.searchParams.append(u,`cd.${JSON.stringify(p)}`),this}rangeGt(u,p){return this.url.searchParams.append(u,`sr.${p}`),this}rangeGte(u,p){return this.url.searchParams.append(u,`nxl.${p}`),this}rangeLt(u,p){return this.url.searchParams.append(u,`sl.${p}`),this}rangeLte(u,p){return this.url.searchParams.append(u,`nxr.${p}`),this}rangeAdjacent(u,p){return this.url.searchParams.append(u,`adj.${p}`),this}overlaps(u,p){return typeof p=="string"?this.url.searchParams.append(u,`ov.${p}`):this.url.searchParams.append(u,`ov.{${p.join(",")}}`),this}textSearch(u,p,{config:r,type:v}={}){let w="";v==="plain"?w="pl":v==="phrase"?w="ph":v==="websearch"&&(w="w");const E=r===void 0?"":`(${r})`;return this.url.searchParams.append(u,`${w}fts${E}.${p}`),this}match(u){return Object.entries(u).forEach(([p,r])=>{this.url.searchParams.append(p,`eq.${r}`)}),this}not(u,p,r){return this.url.searchParams.append(u,`not.${p}.${r}`),this}or(u,{foreignTable:p,referencedTable:r=p}={}){const v=r?`${r}.or`:"or";return this.url.searchParams.append(v,`(${u})`),this}filter(u,p,r){return this.url.searchParams.append(u,`${p}.${r}`),this}}return KS.default=s,KS}var FB;function F$(){if(FB)return QS;FB=1,Object.defineProperty(QS,"__esModule",{value:!0});const e=vb.__importDefault(mN());class n{constructor(l,{headers:u={},schema:p,fetch:r}){this.url=l,this.headers=new Headers(u),this.schema=p,this.fetch=r}select(l,u){const{head:p=!1,count:r}=u??{},v=p?"HEAD":"GET";let w=!1;const E=(l??"*").split("").map(T=>/\s/.test(T)&&!w?"":(T==='"'&&(w=!w),T)).join("");return this.url.searchParams.set("select",E),r&&this.headers.append("Prefer",`count=${r}`),new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(l,{count:u,defaultToNull:p=!0}={}){var r;const v="POST";if(u&&this.headers.append("Prefer",`count=${u}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(l)){const w=l.reduce((E,T)=>E.concat(Object.keys(T)),[]);if(w.length>0){const E=[...new Set(w)].map(T=>`"${T}"`);this.url.searchParams.set("columns",E.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:l,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(l,{onConflict:u,ignoreDuplicates:p=!1,count:r,defaultToNull:v=!0}={}){var w;const E="POST";if(this.headers.append("Prefer",`resolution=${p?"ignore":"merge"}-duplicates`),u!==void 0&&this.url.searchParams.set("on_conflict",u),r&&this.headers.append("Prefer",`count=${r}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(l)){const T=l.reduce((k,R)=>k.concat(Object.keys(R)),[]);if(T.length>0){const k=[...new Set(T)].map(R=>`"${R}"`);this.url.searchParams.set("columns",k.join(","))}}return new e.default({method:E,url:this.url,headers:this.headers,schema:this.schema,body:l,fetch:(w=this.fetch)!==null&&w!==void 0?w:fetch})}update(l,{count:u}={}){var p;const r="PATCH";return u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:l,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}delete({count:l}={}){var u;const p="DELETE";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return QS.default=n,QS}var BB;function I0e(){if(BB)return ZS;BB=1,Object.defineProperty(ZS,"__esModule",{value:!0});const t=vb,e=t.__importDefault(F$()),n=t.__importDefault(mN());class s{constructor(u,{headers:p={},schema:r,fetch:v}={}){this.url=u,this.headers=new Headers(p),this.schemaName=r,this.fetch=v}from(u){if(!u||typeof u!="string"||u.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const p=new URL(`${this.url}/${u}`);return new e.default(p,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(u){return new s(this.url,{headers:this.headers,schema:u,fetch:this.fetch})}rpc(u,p={},{head:r=!1,get:v=!1,count:w}={}){var E;let T;const k=new URL(`${this.url}/rpc/${u}`);let R;r||v?(T=r?"HEAD":"GET",Object.entries(p).filter(([O,F])=>F!==void 0).map(([O,F])=>[O,Array.isArray(F)?`{${F.join(",")}}`:`${F}`]).forEach(([O,F])=>{k.searchParams.append(O,F)})):(T="POST",R=p);const D=new Headers(this.headers);return w&&D.set("Prefer",`count=${w}`),new n.default({method:T,url:k,headers:D,schema:this.schemaName,body:R,fetch:(E=this.fetch)!==null&&E!==void 0?E:fetch})}}return ZS.default=s,ZS}var zB;function P0e(){if(zB)return uc;zB=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.PostgrestError=uc.PostgrestBuilder=uc.PostgrestTransformBuilder=uc.PostgrestFilterBuilder=uc.PostgrestQueryBuilder=uc.PostgrestClient=void 0;const t=vb,e=t.__importDefault(I0e());uc.PostgrestClient=e.default;const n=t.__importDefault(F$());uc.PostgrestQueryBuilder=n.default;const s=t.__importDefault(mN());uc.PostgrestFilterBuilder=s.default;const l=t.__importDefault(O$());uc.PostgrestTransformBuilder=l.default;const u=t.__importDefault(L$());uc.PostgrestBuilder=u.default;const p=t.__importDefault(D$());return uc.PostgrestError=p.default,uc.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:l.default,PostgrestBuilder:u.default,PostgrestError:p.default},uc}var B$=P0e();const z$=Wx(B$),R0e=_K({__proto__:null,default:z$},[B$]),{PostgrestClient:N0e,PostgrestQueryBuilder:w3e,PostgrestFilterBuilder:S3e,PostgrestTransformBuilder:T3e,PostgrestBuilder:E3e,PostgrestError:A3e}=z$||R0e;class j0e{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const s=n.node,l=parseInt(s.replace(/^v/,"").split(".")[0]);return l>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${l} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${l} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const s=this.getWebSocketConstructor();return new s(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const D0e="2.86.0",L0e=`realtime-js/${D0e}`,U$="1.0.0",O0e="2.0.0",UB=U$,eI=1e4,F0e=1e3,B0e=100;var Yy;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Yy||(Yy={}));var qa;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(qa||(qa={}));var af;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(af||(af={}));var tI;(function(t){t.websocket="websocket"})(tI||(tI={}));var Jy;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Jy||(Jy={}));class z0e{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,s;const l=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,l)}_encodeJsonUserBroadcastPush(e){var n,s;const l=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:{},p=new TextEncoder().encode(JSON.stringify(l)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,p)}_encodeUserBroadcastPush(e,n,s){var l,u;const p=e.topic,r=(l=e.ref)!==null&&l!==void 0?l:"",v=(u=e.join_ref)!==null&&u!==void 0?u:"",w=e.payload.event,E=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},T=Object.keys(E).length===0?"":JSON.stringify(E);if(v.length>255)throw new Error(`joinRef length ${v.length} exceeds maximum of 255`);if(r.length>255)throw new Error(`ref length ${r.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`topic length ${p.length} exceeds maximum of 255`);if(w.length>255)throw new Error(`userEvent length ${w.length} exceeds maximum of 255`);if(T.length>255)throw new Error(`metadata length ${T.length} exceeds maximum of 255`);const k=this.USER_BROADCAST_PUSH_META_LENGTH+v.length+r.length+p.length+w.length+T.length,R=new ArrayBuffer(this.HEADER_LENGTH+k);let D=new DataView(R),O=0;D.setUint8(O++,this.KINDS.userBroadcastPush),D.setUint8(O++,v.length),D.setUint8(O++,r.length),D.setUint8(O++,p.length),D.setUint8(O++,w.length),D.setUint8(O++,T.length),D.setUint8(O++,n),Array.from(v,U=>D.setUint8(O++,U.charCodeAt(0))),Array.from(r,U=>D.setUint8(O++,U.charCodeAt(0))),Array.from(p,U=>D.setUint8(O++,U.charCodeAt(0))),Array.from(w,U=>D.setUint8(O++,U.charCodeAt(0))),Array.from(T,U=>D.setUint8(O++,U.charCodeAt(0)));var F=new Uint8Array(R.byteLength+s.byteLength);return F.set(new Uint8Array(R),0),F.set(new Uint8Array(s),R.byteLength),F.buffer}decode(e,n){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return n(s)}if(typeof e=="string"){const s=JSON.parse(e),[l,u,p,r,v]=s;return n({join_ref:l,ref:u,topic:p,event:r,payload:v})}return n({})}_binaryDecode(e){const n=new DataView(e),s=n.getUint8(0),l=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,l)}}_decodeUserBroadcast(e,n,s){const l=n.getUint8(1),u=n.getUint8(2),p=n.getUint8(3),r=n.getUint8(4);let v=this.HEADER_LENGTH+4;const w=s.decode(e.slice(v,v+l));v=v+l;const E=s.decode(e.slice(v,v+u));v=v+u;const T=s.decode(e.slice(v,v+p));v=v+p;const k=e.slice(v,e.byteLength),R=r===this.JSON_ENCODING?JSON.parse(s.decode(k)):k,D={type:this.BROADCAST_EVENT,event:E,payload:R};return p>0&&(D.meta=JSON.parse(T)),{join_ref:null,ref:null,topic:w,event:this.BROADCAST_EVENT,payload:D}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>n.includes(s)))}}class V${constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ao;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ao||(Ao={}));const VB=(t,e,n={})=>{var s;const l=(s=n.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((u,p)=>(u[p]=U0e(p,t,e,l),u),{}):{}},U0e=(t,e,n,s)=>{const l=e.find(r=>r.name===t),u=l==null?void 0:l.type,p=n[t];return u&&!s.includes(u)?H$(u,p):nI(p)},H$=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return $0e(e,n)}switch(t){case Ao.bool:return V0e(e);case Ao.float4:case Ao.float8:case Ao.int2:case Ao.int4:case Ao.int8:case Ao.numeric:case Ao.oid:return H0e(e);case Ao.json:case Ao.jsonb:return G0e(e);case Ao.timestamp:return W0e(e);case Ao.abstime:case Ao.date:case Ao.daterange:case Ao.int4range:case Ao.int8range:case Ao.money:case Ao.reltime:case Ao.text:case Ao.time:case Ao.timestamptz:case Ao.timetz:case Ao.tsrange:case Ao.tstzrange:return nI(e);default:return nI(e)}},nI=t=>t,V0e=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},H0e=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},G0e=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},$0e=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,s=t[n];if(t[0]==="{"&&s==="}"){let u;const p=t.slice(1,n);try{u=JSON.parse("["+p+"]")}catch{u=p?p.split(","):[]}return u.map(r=>H$(e,r))}return t},W0e=t=>typeof t=="string"?t.replace(" ","T"):t,G$=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class LM{constructor(e,n,s={},l=eI){this.channel=e,this.event=n,this.payload=s,this.timeout=l,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var s;return this._hasReceived(e)&&n((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var HB;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(HB||(HB={}));class X1{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},l=>{const{onJoin:u,onLeave:p,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=X1.syncState(this.state,l,u,p),this.pendingDiffs.forEach(v=>{this.state=X1.syncDiff(this.state,v,u,p)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},l=>{const{onJoin:u,onLeave:p,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(l):(this.state=X1.syncDiff(this.state,l,u,p),r())}),this.onJoin((l,u,p)=>{this.channel._trigger("presence",{event:"join",key:l,currentPresences:u,newPresences:p})}),this.onLeave((l,u,p)=>{this.channel._trigger("presence",{event:"leave",key:l,currentPresences:u,leftPresences:p})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,s,l){const u=this.cloneDeep(e),p=this.transformState(n),r={},v={};return this.map(u,(w,E)=>{p[w]||(v[w]=E)}),this.map(p,(w,E)=>{const T=u[w];if(T){const k=E.map(F=>F.presence_ref),R=T.map(F=>F.presence_ref),D=E.filter(F=>R.indexOf(F.presence_ref)<0),O=T.filter(F=>k.indexOf(F.presence_ref)<0);D.length>0&&(r[w]=D),O.length>0&&(v[w]=O)}else r[w]=E}),this.syncDiff(u,{joins:r,leaves:v},s,l)}static syncDiff(e,n,s,l){const{joins:u,leaves:p}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return s||(s=()=>{}),l||(l=()=>{}),this.map(u,(r,v)=>{var w;const E=(w=e[r])!==null&&w!==void 0?w:[];if(e[r]=this.cloneDeep(v),E.length>0){const T=e[r].map(R=>R.presence_ref),k=E.filter(R=>T.indexOf(R.presence_ref)<0);e[r].unshift(...k)}s(r,E,v)}),this.map(p,(r,v)=>{let w=e[r];if(!w)return;const E=v.map(T=>T.presence_ref);w=w.filter(T=>E.indexOf(T.presence_ref)<0),e[r]=w,l(r,w,v),w.length===0&&delete e[r]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(s=>n(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,s)=>{const l=e[s];return"metas"in l?n[s]=l.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):n[s]=l,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var GB;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(GB||(GB={}));var Z1;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Z1||(Z1={}));var Nm;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Nm||(Nm={}));class gN{constructor(e,n={config:{}},s){var l,u;if(this.topic=e,this.params=n,this.socket=s,this.bindings={},this.state=qa.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new LM(this,af.join,this.params,this.timeout),this.rejoinTimer=new V$(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qa.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(p=>p.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qa.closed,this.socket._remove(this)}),this._onError(p=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,p),this.state=qa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",p=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,p),this.state=qa.errored,this.rejoinTimer.scheduleTimeout())}),this._on(af.reply,{},(p,r)=>{this._trigger(this._replyEventName(r),p)}),this.presence=new X1(this),this.broadcastEndpointURL=G$(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(l=this.params.config)===null||l===void 0?void 0:l.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var s,l,u;if(this.socket.isConnected()||this.socket.connect(),this.state==qa.closed){const{config:{broadcast:p,presence:r,private:v}}=this.params,w=(l=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(R=>R.filter))!==null&&l!==void 0?l:[],E=!!this.bindings[Z1.PRESENCE]&&this.bindings[Z1.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,T={},k={broadcast:p,presence:Object.assign(Object.assign({},r),{enabled:E}),postgres_changes:w,private:v};this.socket.accessTokenValue&&(T.access_token=this.socket.accessTokenValue),this._onError(R=>e==null?void 0:e(Nm.CHANNEL_ERROR,R)),this._onClose(()=>e==null?void 0:e(Nm.CLOSED)),this.updateJoinPayload(Object.assign({config:k},T)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:R})=>{var D;if(this.socket.setAuth(),R===void 0){e==null||e(Nm.SUBSCRIBED);return}else{const O=this.bindings.postgres_changes,F=(D=O==null?void 0:O.length)!==null&&D!==void 0?D:0,U=[];for(let X=0;X<F;X++){const W=O[X],{filter:{event:K,schema:ne,table:te,filter:re}}=W,xe=R&&R[X];if(xe&&xe.event===K&&xe.schema===ne&&xe.table===te&&xe.filter===re)U.push(Object.assign(Object.assign({},W),{id:xe.id}));else{this.unsubscribe(),this.state=qa.errored,e==null||e(Nm.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=U,e&&e(Nm.SUBSCRIBED);return}}).receive("error",R=>{this.state=qa.errored,e==null||e(Nm.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(R).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Nm.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,s){return this.state===qa.joined&&e===Z1.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,s)}async httpSend(e,n,s={}){var l;const u=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const p={method:"POST",headers:{Authorization:u,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},r=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(l=s.timeout)!==null&&l!==void 0?l:this.timeout);if(r.status===202)return{success:!0};let v=r.statusText;try{const w=await r.json();v=w.error||w.message||v}catch{}return Promise.reject(new Error(v))}async send(e,n={}){var s,l;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:p}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:p,private:this.private}]})};try{const w=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);return await((l=w.body)===null||l===void 0?void 0:l.cancel()),w.ok?"ok":"error"}catch(w){return w.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var p,r,v;const w=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(r=(p=this.params)===null||p===void 0?void 0:p.config)===null||r===void 0?void 0:r.broadcast)===null||v===void 0)&&v.ack)&&u("ok"),w.receive("ok",()=>u("ok")),w.receive("error",()=>u("error")),w.receive("timeout",()=>u("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qa.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(af.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(l=>{s=new LM(this,af.leave,{},e),s.receive("ok",()=>{n(),l("ok")}).receive("timeout",()=>{n(),l("timed out")}).receive("error",()=>{l("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qa.closed,this.bindings={}}async _fetchWithTimeout(e,n,s){const l=new AbortController,u=setTimeout(()=>l.abort(),s),p=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:l.signal}));return clearTimeout(u),p}_push(e,n,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let l=new LM(this,e,n,s);return this._canPush()?l.send():this._addToPushBuffer(l),l}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>B0e){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,s){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,s){var l,u;const p=e.toLocaleLowerCase(),{close:r,error:v,leave:w,join:E}=af;if(s&&[r,v,w,E].indexOf(p)>=0&&s!==this._joinRef())return;let k=this._onMessage(p,n,s);if(n&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(p)?(l=this.bindings.postgres_changes)===null||l===void 0||l.filter(R=>{var D,O,F;return((D=R.filter)===null||D===void 0?void 0:D.event)==="*"||((F=(O=R.filter)===null||O===void 0?void 0:O.event)===null||F===void 0?void 0:F.toLocaleLowerCase())===p}).map(R=>R.callback(k,s)):(u=this.bindings[p])===null||u===void 0||u.filter(R=>{var D,O,F,U,X,W;if(["broadcast","presence","postgres_changes"].includes(p))if("id"in R){const K=R.id,ne=(D=R.filter)===null||D===void 0?void 0:D.event;return K&&((O=n.ids)===null||O===void 0?void 0:O.includes(K))&&(ne==="*"||(ne==null?void 0:ne.toLocaleLowerCase())===((F=n.data)===null||F===void 0?void 0:F.type.toLocaleLowerCase()))}else{const K=(X=(U=R==null?void 0:R.filter)===null||U===void 0?void 0:U.event)===null||X===void 0?void 0:X.toLocaleLowerCase();return K==="*"||K===((W=n==null?void 0:n.event)===null||W===void 0?void 0:W.toLocaleLowerCase())}else return R.type.toLocaleLowerCase()===p}).map(R=>{if(typeof k=="object"&&"ids"in k){const D=k.data,{schema:O,table:F,commit_timestamp:U,type:X,errors:W}=D;k=Object.assign(Object.assign({},{schema:O,table:F,commit_timestamp:U,eventType:X,new:{},old:{},errors:W}),this._getPayloadRecords(D))}R.callback(k,s)})}_isClosed(){return this.state===qa.closed}_isJoined(){return this.state===qa.joined}_isJoining(){return this.state===qa.joining}_isLeaving(){return this.state===qa.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,s){const l=e.toLocaleLowerCase(),u={type:l,filter:n,callback:s};return this.bindings[l]?this.bindings[l].push(u):this.bindings[l]=[u],this}_off(e,n){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(l=>{var u;return!(((u=l.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===s&&gN.isEqual(l.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(e[s]!==n[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(af.close,{},e)}_onError(e){this._on(af.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qa.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=VB(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=VB(e.columns,e.old_record)),n}}const OM=()=>{},tT={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},q0e=[1e3,2e3,5e3,1e4],X0e=1e4,Z0e=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Q0e{constructor(e,n){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=eI,this.transport=null,this.heartbeatIntervalMs=tT.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=OM,this.ref=0,this.reconnectTimer=null,this.vsn=UB,this.logger=OM,this.conn=null,this.sendBuffer=[],this.serializer=new z0e,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=l=>l?(...u)=>l(...u):(...u)=>fetch(...u),!(!((s=n==null?void 0:n.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${tI.websocket}`,this.httpEndpoint=G$(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=j0e.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,s){this.logger(e,n,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Yy.connecting:return Jy.Connecting;case Yy.open:return Jy.Open;case Yy.closing:return Jy.Closing;default:return Jy.Closed}}isConnected(){return this.connectionState()===Jy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const s=`realtime:${e}`,l=this.getChannels().find(u=>u.topic===s);if(l)return l;{const u=new gN(`realtime:${e}`,n,this);return this.channels.push(u),u}}push(e){const{topic:n,event:s,payload:l,ref:u}=e,p=()=>{this.encode(e,r=>{var v;(v=this.conn)===null||v===void 0||v.send(r)})};this.log("push",`${n} ${s} (${u})`,l),this.isConnected()?p():this.sendBuffer.push(p)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(F0e,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},tT.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(w){this.log("error","error in heartbeat callback",w)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:l,payload:u,ref:p}=n,r=p?`(${p})`:"",v=u.status||"";this.log("receive",`${v} ${s} ${l} ${r}`.trim(),u),this.channels.filter(w=>w._isMember(s)).forEach(w=>w._trigger(l,u,p)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Yy.open||this.conn.readyState===Yy.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(af.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const s=e.match(/\?/)?"&":"?",l=new URLSearchParams(n);return`${e}${s}${l}`}_workerObjectUrl(e){let n;if(e)n=e;else{const s=new Blob([Z0e],{type:"application/javascript"});n=URL.createObjectURL(s)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const l={access_token:n,version:L0e};n&&s.updateJoinPayload(l),s.joinedOnce&&s._isJoined()&&s._push(af.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(n)}catch(l){this.log("error",`error in ${e} callback`,l)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new V$(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},tT.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,s,l,u,p,r,v,w,E,T,k,R;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:eI,this.heartbeatIntervalMs=(l=e==null?void 0:e.heartbeatIntervalMs)!==null&&l!==void 0?l:tT.HEARTBEAT_INTERVAL,this.worker=(u=e==null?void 0:e.worker)!==null&&u!==void 0?u:!1,this.accessToken=(p=e==null?void 0:e.accessToken)!==null&&p!==void 0?p:null,this.heartbeatCallback=(r=e==null?void 0:e.heartbeatCallback)!==null&&r!==void 0?r:OM,this.vsn=(v=e==null?void 0:e.vsn)!==null&&v!==void 0?v:UB,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(w=e==null?void 0:e.reconnectAfterMs)!==null&&w!==void 0?w:(D=>q0e[D-1]||X0e),this.vsn){case U$:this.encode=(E=e==null?void 0:e.encode)!==null&&E!==void 0?E:((D,O)=>O(JSON.stringify(D))),this.decode=(T=e==null?void 0:e.decode)!==null&&T!==void 0?T:((D,O)=>O(JSON.parse(D)));break;case O0e:this.encode=(k=e==null?void 0:e.encode)!==null&&k!==void 0?k:this.serializer.encode.bind(this.serializer),this.decode=(R=e==null?void 0:e.decode)!==null&&R!==void 0?R:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class GA extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Qo(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class K0e extends GA{constructor(e,n,s){super(e),this.name="StorageApiError",this.status=n,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class rI extends GA{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const yN=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Y0e=()=>Response,iI=t=>{if(Array.isArray(t))return t.map(n=>iI(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,s])=>{const l=n.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));e[l]=iI(s)}),e},J0e=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},eye=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t),FM=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},tye=(t,e,n)=>yi(void 0,void 0,void 0,function*(){const s=yield Y0e();t instanceof s&&!(n!=null&&n.noResolveJson)?t.json().then(l=>{const u=t.status||500,p=(l==null?void 0:l.statusCode)||u+"";e(new K0e(FM(l),u,p))}).catch(l=>{e(new rI(FM(l),l))}):e(new rI(FM(t),t))}),nye=(t,e,n,s)=>{const l={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!s?l:(J0e(s)?(l.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),l.body=JSON.stringify(s)):l.body=s,e!=null&&e.duplex&&(l.duplex=e.duplex),Object.assign(Object.assign({},l),n))};function A2(t,e,n,s,l,u){return yi(this,void 0,void 0,function*(){return new Promise((p,r)=>{t(n,nye(e,s,l,u)).then(v=>{if(!v.ok)throw v;return s!=null&&s.noResolveJson?v:v.json()}).then(v=>p(v)).catch(v=>tye(v,r,s))})})}function Dw(t,e,n,s){return yi(this,void 0,void 0,function*(){return A2(t,"GET",e,n,s)})}function rf(t,e,n,s,l){return yi(this,void 0,void 0,function*(){return A2(t,"POST",e,s,l,n)})}function sI(t,e,n,s,l){return yi(this,void 0,void 0,function*(){return A2(t,"PUT",e,s,l,n)})}function rye(t,e,n,s){return yi(this,void 0,void 0,function*(){return A2(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),s)})}function xN(t,e,n,s,l){return yi(this,void 0,void 0,function*(){return A2(t,"DELETE",e,s,l,n)})}class iye{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return yi(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Qo(e))return{data:null,error:e};throw e}})}}var $$;class sye{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[$$]="BlobDownloadBuilder",this.promise=null}asStream(){return new iye(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return yi(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Qo(e))return{data:null,error:e};throw e}})}}$$=Symbol.toStringTag;const oye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$B={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class aye{constructor(e,n={},s,l){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=s,this.fetch=yN(l)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,s,l){return yi(this,void 0,void 0,function*(){try{let u;const p=Object.assign(Object.assign({},$B),l);let r=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(p.upsert)});const v=p.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",p.cacheControl),v&&u.append("metadata",this.encodeMetadata(v)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",p.cacheControl),v&&!u.has("metadata")&&u.append("metadata",this.encodeMetadata(v))):(u=s,r["cache-control"]=`max-age=${p.cacheControl}`,r["content-type"]=p.contentType,v&&(r["x-metadata"]=this.toBase64(this.encodeMetadata(v))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!p.duplex&&(p.duplex="half")),l!=null&&l.headers&&(r=Object.assign(Object.assign({},r),l.headers));const w=this._removeEmptyFolders(n),E=this._getFinalPath(w),T=yield(e=="PUT"?sI:rf)(this.fetch,`${this.url}/object/${E}`,u,Object.assign({headers:r},p!=null&&p.duplex?{duplex:p.duplex}:{}));return{data:{path:w,id:T.Id,fullPath:T.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Qo(u))return{data:null,error:u};throw u}})}upload(e,n,s){return yi(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,s)})}uploadToSignedUrl(e,n,s,l){return yi(this,void 0,void 0,function*(){const u=this._removeEmptyFolders(e),p=this._getFinalPath(u),r=new URL(this.url+`/object/upload/sign/${p}`);r.searchParams.set("token",n);try{let v;const w=Object.assign({upsert:$B.upsert},l),E=Object.assign(Object.assign({},this.headers),{"x-upsert":String(w.upsert)});typeof Blob<"u"&&s instanceof Blob?(v=new FormData,v.append("cacheControl",w.cacheControl),v.append("",s)):typeof FormData<"u"&&s instanceof FormData?(v=s,v.append("cacheControl",w.cacheControl)):(v=s,E["cache-control"]=`max-age=${w.cacheControl}`,E["content-type"]=w.contentType);const T=yield sI(this.fetch,r.toString(),v,{headers:E});return{data:{path:u,fullPath:T.Key},error:null}}catch(v){if(this.shouldThrowOnError)throw v;if(Qo(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,n){return yi(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const l=Object.assign({},this.headers);n!=null&&n.upsert&&(l["x-upsert"]="true");const u=yield rf(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:l}),p=new URL(this.url+u.url),r=p.searchParams.get("token");if(!r)throw new GA("No token returned by API");return{data:{signedUrl:p.toString(),path:e,token:r},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qo(s))return{data:null,error:s};throw s}})}update(e,n,s){return yi(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,s)})}move(e,n,s){return yi(this,void 0,void 0,function*(){try{return{data:yield rf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}copy(e,n,s){return yi(this,void 0,void 0,function*(){try{return{data:{path:(yield rf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}createSignedUrl(e,n,s){return yi(this,void 0,void 0,function*(){try{let l=this._getFinalPath(e),u=yield rf(this.fetch,`${this.url}/object/sign/${l}`,Object.assign({expiresIn:n},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const p=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${this.url}${u.signedURL}${p}`)},{data:u,error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}createSignedUrls(e,n,s){return yi(this,void 0,void 0,function*(){try{const l=yield rf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),u=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:l.map(p=>Object.assign(Object.assign({},p),{signedUrl:p.signedURL?encodeURI(`${this.url}${p.signedURL}${u}`):null})),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}download(e,n){const l=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",u=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),p=u?`?${u}`:"",r=this._getFinalPath(e),v=()=>Dw(this.fetch,`${this.url}/${l}/${r}${p}`,{headers:this.headers,noResolveJson:!0});return new sye(v,this.shouldThrowOnError)}info(e){return yi(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const s=yield Dw(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:iI(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qo(s))return{data:null,error:s};throw s}})}exists(e){return yi(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield rye(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qo(s)&&s instanceof rI){const l=s.originalError;if([400,404].includes(l==null?void 0:l.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,n){const s=this._getFinalPath(e),l=[],u=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";u!==""&&l.push(u);const r=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",v=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});v!==""&&l.push(v);let w=l.join("&");return w!==""&&(w=`?${w}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${s}${w}`)}}}remove(e){return yi(this,void 0,void 0,function*(){try{return{data:yield xN(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}list(e,n,s){return yi(this,void 0,void 0,function*(){try{const l=Object.assign(Object.assign(Object.assign({},oye),n),{prefix:e||""});return{data:yield rf(this.fetch,`${this.url}/object/list/${this.bucketId}`,l,{headers:this.headers},s),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}listV2(e,n){return yi(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield rf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qo(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const W$="2.86.0",q$={"X-Client-Info":`storage-js/${W$}`};class lye{constructor(e,n={},s,l){this.shouldThrowOnError=!1;const u=new URL(e);l!=null&&l.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},q$),n),this.fetch=yN(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return yi(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield Dw(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}getBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield Dw(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}createBucket(e){return yi(this,arguments,void 0,function*(n,s={public:!1}){try{return{data:yield rf(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Qo(l))return{data:null,error:l};throw l}})}updateBucket(e,n){return yi(this,void 0,void 0,function*(){try{return{data:yield sI(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qo(s))return{data:null,error:s};throw s}})}emptyBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield rf(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}deleteBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield xN(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}var Lw=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function cye(t,e,n){const s=new URL(e,t);if(n)for(const[l,u]of Object.entries(n))u!==void 0&&s.searchParams.set(l,u);return s.toString()}async function uye(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function dye(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:s,query:l,body:u,headers:p}){const r=cye(t.baseUrl,s,l),v=await uye(t.auth),w=await e(r,{method:n,headers:{...u?{"Content-Type":"application/json"}:{},...v,...p},body:u?JSON.stringify(u):void 0}),E=await w.text(),T=(w.headers.get("content-type")||"").includes("application/json"),k=T&&E?JSON.parse(E):E;if(!w.ok){const R=T?k:void 0,D=R==null?void 0:R.error;throw new Lw((D==null?void 0:D.message)??`Request failed with status ${w.status}`,{status:w.status,icebergType:D==null?void 0:D.type,icebergCode:D==null?void 0:D.code,details:R})}return{status:w.status,headers:w.headers,data:k}}}}function nT(t){return t.join("")}var hye=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:nT(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${nT(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${nT(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${nT(t.namespace)}`}),!0}catch(e){if(e instanceof Lw&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof Lw&&n.status===409)return;throw n}}};function $_(t){return t.join("")}var fye=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${$_(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof Lw&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof Lw&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},pye=class{constructor(t){var s;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=dye({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(s=t.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new hye(this.client,e),this.tableOps=new fye(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}};class mye{constructor(e,n={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},q$),n),this.fetch=yN(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield rf(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}listBuckets(e){return yi(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const s=n.toString(),l=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield Dw(this.fetch,l,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}deleteBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield xN(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qo(n))return{data:null,error:n};throw n}})}from(e){if(!eye(e))throw new GA("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");return new pye({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>yi(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch})}}const _N={"X-Client-Info":`storage-js/${W$}`,"Content-Type":"application/json"};class X$ extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function sd(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class BM extends X${constructor(e,n,s){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class gye extends X${constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var WB;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(WB||(WB={}));const vN=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),yye=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},qB=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),xye=(t,e,n)=>yi(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const l=t.status||500,u=t;if(typeof u.json=="function")u.json().then(p=>{const r=(p==null?void 0:p.statusCode)||(p==null?void 0:p.code)||l+"";e(new BM(qB(p),l,r))}).catch(()=>{const p=l+"",r=u.statusText||`HTTP ${l} error`;e(new BM(r,l,p))});else{const p=l+"",r=u.statusText||`HTTP ${l} error`;e(new BM(r,l,p))}}else e(new gye(qB(t),t))}),_ye=(t,e,n,s)=>{const l={method:t,headers:(e==null?void 0:e.headers)||{}};return s?(yye(s)?(l.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),l.body=JSON.stringify(s)):l.body=s,Object.assign(Object.assign({},l),n)):l};function vye(t,e,n,s,l,u){return yi(this,void 0,void 0,function*(){return new Promise((p,r)=>{t(n,_ye(e,s,l,u)).then(v=>{if(!v.ok)throw v;if(s!=null&&s.noResolveJson)return v;const w=v.headers.get("content-type");return!w||!w.includes("application/json")?{}:v.json()}).then(v=>p(v)).catch(v=>xye(v,r,s))})})}function od(t,e,n,s,l){return yi(this,void 0,void 0,function*(){return vye(t,"POST",e,s,l,n)})}class bye{constructor(e,n={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_N),n),this.fetch=vN(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return yi(this,void 0,void 0,function*(){try{return{data:(yield od(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}getIndex(e,n){return yi(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(sd(s))return{data:null,error:s};throw s}})}listIndexes(e){return yi(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return yi(this,void 0,void 0,function*(){try{return{data:(yield od(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(sd(s))return{data:null,error:s};throw s}})}}class wye{constructor(e,n={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_N),n),this.fetch=vN(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return yi(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield od(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}getVectors(e){return yi(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}listVectors(e){return yi(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield od(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}queryVectors(e){return yi(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}deleteVectors(e){return yi(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield od(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}}class Sye{constructor(e,n={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_N),n),this.fetch=vN(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:(yield od(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}getBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}listBuckets(){return yi(this,arguments,void 0,function*(e={}){try{return{data:yield od(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}deleteBucket(e){return yi(this,void 0,void 0,function*(){try{return{data:(yield od(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sd(n))return{data:null,error:n};throw n}})}}class Tye extends Sye{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new Eye(this.url,this.headers,e,this.fetch)}createBucket(e){const n=Object.create(null,{createBucket:{get:()=>super.createBucket}});return yi(this,void 0,void 0,function*(){return n.createBucket.call(this,e)})}getBucket(e){const n=Object.create(null,{getBucket:{get:()=>super.getBucket}});return yi(this,void 0,void 0,function*(){return n.getBucket.call(this,e)})}listBuckets(){const e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return yi(this,arguments,void 0,function*(n={}){return e.listBuckets.call(this,n)})}deleteBucket(e){const n=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return yi(this,void 0,void 0,function*(){return n.deleteBucket.call(this,e)})}}class Eye extends bye{constructor(e,n,s,l){super(e,n,l),this.vectorBucketName=s}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return yi(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return yi(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return yi(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return yi(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Aye(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Aye extends wye{constructor(e,n,s,l,u){super(e,n,u),this.vectorBucketName=s,this.indexName=l}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return yi(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return yi(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return yi(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return yi(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return yi(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Cye extends lye{constructor(e,n={},s,l){super(e,n,s,l)}from(e){return new aye(this.url,this.headers,e,this.fetch)}get vectors(){return new Tye(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new mye(this.url+"/iceberg",this.headers,this.fetch)}}const Mye="2.86.0";let B1="";typeof Deno<"u"?B1="deno":typeof document<"u"?B1="web":typeof navigator<"u"&&navigator.product==="ReactNative"?B1="react-native":B1="node";const kye={"X-Client-Info":`supabase-js-${B1}/${Mye}`},Iye={headers:kye},Pye={schema:"public"},Rye={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nye={},jye=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Dye=()=>Headers,Lye=(t,e,n)=>{const s=jye(n),l=Dye();return async(u,p)=>{var r;const v=(r=await e())!==null&&r!==void 0?r:t;let w=new l(p==null?void 0:p.headers);return w.has("apikey")||w.set("apikey",t),w.has("Authorization")||w.set("Authorization",`Bearer ${v}`),s(u,Object.assign(Object.assign({},p),{headers:w}))}};function Oye(t){return t.endsWith("/")?t:t+"/"}function Fye(t,e){var n,s;const{db:l,auth:u,realtime:p,global:r}=t,{db:v,auth:w,realtime:E,global:T}=e,k={db:Object.assign(Object.assign({},v),l),auth:Object.assign(Object.assign({},w),u),realtime:Object.assign(Object.assign({},E),p),storage:{},global:Object.assign(Object.assign(Object.assign({},T),r),{headers:Object.assign(Object.assign({},(n=T==null?void 0:T.headers)!==null&&n!==void 0?n:{}),(s=r==null?void 0:r.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?k.accessToken=t.accessToken:delete k.accessToken,k}function Bye(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Oye(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Z$="2.86.0",pv=30*1e3,oI=3,zM=oI*pv,zye="http://localhost:9999",Uye="supabase.auth.token",Vye={"X-Client-Info":`gotrue-js/${Z$}`},aI="X-Supabase-Api-Version",Q$={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Hye=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Gye=600*1e3;class Ow extends Error{constructor(e,n,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=s}}function Ti(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class $ye extends Ow{constructor(e,n,s){super(e,n,s),this.name="AuthApiError",this.status=n,this.code=s}}function Wye(t){return Ti(t)&&t.name==="AuthApiError"}class ex extends Ow{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class J0 extends Ow{constructor(e,n,s,l){super(e,s,l),this.name=n,this.status=s}}class Yu extends J0{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qye(t){return Ti(t)&&t.name==="AuthSessionMissingError"}class W_ extends J0{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class rT extends J0{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class iT extends J0{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Xye(t){return Ti(t)&&t.name==="AuthImplicitGrantRedirectError"}class XB extends J0{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class lI extends J0{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function UM(t){return Ti(t)&&t.name==="AuthRetryableFetchError"}class ZB extends J0{constructor(e,n,s){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=s}}class cI extends J0{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const jE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),QB=` 	
\r=`.split(""),Zye=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<QB.length;e+=1)t[QB[e].charCodeAt(0)]=-2;for(let e=0;e<jE.length;e+=1)t[jE[e].charCodeAt(0)]=e;return t})();function KB(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(jE[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(jE[s]),e.queuedBits-=6}}function K$(t,e,n){const s=Zye[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function YB(t){const e=[],n=p=>{e.push(String.fromCodePoint(p))},s={utf8seq:0,codepoint:0},l={queue:0,queuedBits:0},u=p=>{Yye(p,s,n)};for(let p=0;p<t.length;p+=1)K$(t.charCodeAt(p),l,u);return e.join("")}function Qye(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Kye(t,e){for(let n=0;n<t.length;n+=1){let s=t.charCodeAt(n);if(s>55295&&s<=56319){const l=(s-55296)*1024&65535;s=(t.charCodeAt(n+1)-56320&65535|l)+65536,n+=1}Qye(s,e)}}function Yye(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let s=1;s<6;s+=1)if((t>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function kv(t){const e=[],n={queue:0,queuedBits:0},s=l=>{e.push(l)};for(let l=0;l<t.length;l+=1)K$(t.charCodeAt(l),n,s);return new Uint8Array(e)}function Jye(t){const e=[];return Kye(t,n=>e.push(n)),new Uint8Array(e)}function lx(t){const e=[],n={queue:0,queuedBits:0},s=l=>{e.push(l)};return t.forEach(l=>KB(l,n,s)),KB(null,n,s),e.join("")}function exe(t){return Math.round(Date.now()/1e3)+t}function txe(){return Symbol("auth-callback")}const Ul=()=>typeof window<"u"&&typeof document<"u",Fy={tested:!1,writable:!1},Y$=()=>{if(!Ul())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Fy.tested)return Fy.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Fy.tested=!0,Fy.writable=!0}catch{Fy.tested=!0,Fy.writable=!1}return Fy.writable};function nxe(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((l,u)=>{e[u]=l})}catch{}return n.searchParams.forEach((s,l)=>{e[l]=s}),e}const J$=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),rxe=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",mv=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},By=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},d0=async(t,e)=>{await t.removeItem(e)};class $A{constructor(){this.promise=new $A.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}$A.promiseConstructor=Promise;function VM(t){const e=t.split(".");if(e.length!==3)throw new cI("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Hye.test(e[s]))throw new cI("JWT not in base64url format");return{header:JSON.parse(YB(e[0])),payload:JSON.parse(YB(e[1])),signature:kv(e[2]),raw:{header:e[0],payload:e[1]}}}async function ixe(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function sxe(t,e){return new Promise((s,l)=>{(async()=>{for(let u=0;u<1/0;u++)try{const p=await t(u);if(!e(u,null,p)){s(p);return}}catch(p){if(!e(u,p)){l(p);return}}})()})}function oxe(t){return("0"+t.toString(16)).substr(-2)}function axe(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=n.length;let l="";for(let u=0;u<56;u++)l+=n.charAt(Math.floor(Math.random()*s));return l}return crypto.getRandomValues(e),Array.from(e,oxe).join("")}async function lxe(t){const n=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",n),l=new Uint8Array(s);return Array.from(l).map(u=>String.fromCharCode(u)).join("")}async function cxe(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await lxe(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function q_(t,e,n=!1){const s=axe();let l=s;n&&(l+="/PASSWORD_RECOVERY"),await mv(t,`${e}-code-verifier`,l);const u=await cxe(s);return[u,s===u?"plain":"s256"]}const uxe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function dxe(t){const e=t.headers.get(aI);if(!e||!e.match(uxe))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function hxe(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function fxe(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const pxe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function X_(t){if(!pxe.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function HM(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function mxe(t,e){return new Proxy(t,{get:(n,s,l)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const u=s.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,s,l)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,s,l)}})}function JB(t){return JSON.parse(JSON.stringify(t))}const Qy=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),gxe=[502,503,504];async function ez(t){var e;if(!rxe(t))throw new lI(Qy(t),0);if(gxe.includes(t.status))throw new lI(Qy(t),t.status);let n;try{n=await t.json()}catch(u){throw new ex(Qy(u),u)}let s;const l=dxe(t);if(l&&l.getTime()>=Q$["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?s=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(s=n.error_code),s){if(s==="weak_password")throw new ZB(Qy(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Yu}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((u,p)=>u&&typeof p=="string",!0))throw new ZB(Qy(n),t.status,n.weak_password.reasons);throw new $ye(Qy(n),t.status||500,s)}const yxe=(t,e,n,s)=>{const l={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?l:(l.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),l.body=JSON.stringify(s),Object.assign(Object.assign({},l),n))};async function Zi(t,e,n,s){var l;const u=Object.assign({},s==null?void 0:s.headers);u[aI]||(u[aI]=Q$["2024-01-01"].name),s!=null&&s.jwt&&(u.Authorization=`Bearer ${s.jwt}`);const p=(l=s==null?void 0:s.query)!==null&&l!==void 0?l:{};s!=null&&s.redirectTo&&(p.redirect_to=s.redirectTo);const r=Object.keys(p).length?"?"+new URLSearchParams(p).toString():"",v=await xxe(t,e,n+r,{headers:u,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(v):{data:Object.assign({},v),error:null}}async function xxe(t,e,n,s,l,u){const p=yxe(e,s,l,u);let r;try{r=await t(n,Object.assign({},p))}catch(v){throw console.error(v),new lI(Qy(v),0)}if(r.ok||await ez(r),s!=null&&s.noResolveJson)return r;try{return await r.json()}catch(v){await ez(v)}}function nf(t){var e;let n=null;bxe(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=exe(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:s},error:null}}function tz(t){const e=nf(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function S0(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function _xe(t){return{data:t,error:null}}function vxe(t){const{action_link:e,email_otp:n,hashed_token:s,redirect_to:l,verification_type:u}=t,p=K0(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),r={action_link:e,email_otp:n,hashed_token:s,redirect_to:l,verification_type:u},v=Object.assign({},p);return{data:{properties:r,user:v},error:null}}function nz(t){return t}function bxe(t){return t.access_token&&t.refresh_token&&t.expires_in}const GM=["global","local","others"];class wxe{constructor({url:e="",headers:n={},fetch:s}){this.url=e,this.headers=n,this.fetch=J$(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=GM[0]){if(GM.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${GM.join(", ")}`);try{return await Zi(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ti(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,n={}){try{return await Zi(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:S0})}catch(s){if(Ti(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:n}=e,s=K0(e,["options"]),l=Object.assign(Object.assign({},s),n);return"newEmail"in s&&(l.new_email=s==null?void 0:s.newEmail,delete l.newEmail),await Zi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:l,headers:this.headers,xform:vxe,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Ti(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Zi(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:S0})}catch(n){if(Ti(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,s,l,u,p,r,v;try{const w={nextPage:null,lastPage:0,total:0},E=await Zi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(u=(l=e==null?void 0:e.perPage)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""},xform:nz});if(E.error)throw E.error;const T=await E.json(),k=(p=E.headers.get("x-total-count"))!==null&&p!==void 0?p:0,R=(v=(r=E.headers.get("link"))===null||r===void 0?void 0:r.split(","))!==null&&v!==void 0?v:[];return R.length>0&&(R.forEach(D=>{const O=parseInt(D.split(";")[0].split("=")[1].substring(0,1)),F=JSON.parse(D.split(";")[1].split("=")[1]);w[`${F}Page`]=O}),w.total=parseInt(k)),{data:Object.assign(Object.assign({},T),w),error:null}}catch(w){if(Ti(w))return{data:{users:[]},error:w};throw w}}async getUserById(e){X_(e);try{return await Zi(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:S0})}catch(n){if(Ti(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){X_(e);try{return await Zi(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:S0})}catch(s){if(Ti(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,n=!1){X_(e);try{return await Zi(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:S0})}catch(s){if(Ti(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){X_(e.userId);try{const{data:n,error:s}=await Zi(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:l=>({data:{factors:l},error:null})});return{data:n,error:s}}catch(n){if(Ti(n))return{data:null,error:n};throw n}}async _deleteFactor(e){X_(e.userId),X_(e.id);try{return{data:await Zi(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ti(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,s,l,u,p,r,v;try{const w={nextPage:null,lastPage:0,total:0},E=await Zi(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(u=(l=e==null?void 0:e.perPage)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""},xform:nz});if(E.error)throw E.error;const T=await E.json(),k=(p=E.headers.get("x-total-count"))!==null&&p!==void 0?p:0,R=(v=(r=E.headers.get("link"))===null||r===void 0?void 0:r.split(","))!==null&&v!==void 0?v:[];return R.length>0&&(R.forEach(D=>{const O=parseInt(D.split(";")[0].split("=")[1].substring(0,1)),F=JSON.parse(D.split(";")[1].split("=")[1]);w[`${F}Page`]=O}),w.total=parseInt(k)),{data:Object.assign(Object.assign({},T),w),error:null}}catch(w){if(Ti(w))return{data:{clients:[]},error:w};throw w}}async _createOAuthClient(e){try{return await Zi(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ti(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Zi(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ti(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Zi(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ti(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await Zi(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ti(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Zi(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ti(n))return{data:null,error:n};throw n}}}function rz(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Z_={debug:!!(globalThis&&Y$()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class eW extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Sxe extends eW{}async function Txe(t,e,n){Z_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Z_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async l=>{if(l){Z_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,l.name);try{return await n()}finally{Z_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,l.name)}}else{if(e===0)throw Z_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Sxe(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Z_.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function Exe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function tW(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Axe(t){return parseInt(t,16)}function Cxe(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Mxe(t){var e;const{chainId:n,domain:s,expirationTime:l,issuedAt:u=new Date,nonce:p,notBefore:r,requestId:v,resources:w,scheme:E,uri:T,version:k}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(p&&p.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${p}`);if(!T)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(k!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${k}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const R=tW(t.address),D=E?`${E}://${s}`:s,O=t.statement?`${t.statement}
`:"",F=`${D} wants you to sign in with your Ethereum account:
${R}

${O}`;let U=`URI: ${T}
Version: ${k}
Chain ID: ${n}${p?`
Nonce: ${p}`:""}
Issued At: ${u.toISOString()}`;if(l&&(U+=`
Expiration Time: ${l.toISOString()}`),r&&(U+=`
Not Before: ${r.toISOString()}`),v&&(U+=`
Request ID: ${v}`),w){let X=`
Resources:`;for(const W of w){if(!W||typeof W!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${W}`);X+=`
- ${W}`}U+=X}return`${F}
${U}`}class Ra extends Error{constructor({message:e,code:n,cause:s,name:l}){var u;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(u=l??(s instanceof Error?s.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=n}}class DE extends Ra{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function kxe({error:t,options:e}){var n,s,l;const{publicKey:u}=e;if(!u)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ra({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=u.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Ra({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=u.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ra({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Ra({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Ra({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Ra({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return u.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new Ra({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Ra({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const p=window.location.hostname;if(nW(p)){if(u.rp.id!==p)return new Ra({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ra({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Ra({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Ra({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ra({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Ixe({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ra({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Ra({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(nW(s)){if(n.rpId!==s)return new Ra({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ra({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Ra({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ra({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Pxe{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Rxe=new Pxe;function Nxe(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:s}=t,l=K0(t,["challenge","user","excludeCredentials"]),u=kv(e).buffer,p=Object.assign(Object.assign({},n),{id:kv(n.id).buffer}),r=Object.assign(Object.assign({},l),{challenge:u,user:p});if(s&&s.length>0){r.excludeCredentials=new Array(s.length);for(let v=0;v<s.length;v++){const w=s[v];r.excludeCredentials[v]=Object.assign(Object.assign({},w),{id:kv(w.id).buffer,type:w.type||"public-key",transports:w.transports})}}return r}function jxe(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,s=K0(t,["challenge","allowCredentials"]),l=kv(e).buffer,u=Object.assign(Object.assign({},s),{challenge:l});if(n&&n.length>0){u.allowCredentials=new Array(n.length);for(let p=0;p<n.length;p++){const r=n[p];u.allowCredentials[p]=Object.assign(Object.assign({},r),{id:kv(r.id).buffer,type:r.type||"public-key",transports:r.transports})}}return u}function Dxe(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:lx(new Uint8Array(t.response.attestationObject)),clientDataJSON:lx(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Lxe(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,s=t.getClientExtensionResults(),l=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:lx(new Uint8Array(l.authenticatorData)),clientDataJSON:lx(new Uint8Array(l.clientDataJSON)),signature:lx(new Uint8Array(l.signature)),userHandle:l.userHandle?lx(new Uint8Array(l.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function nW(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function iz(){var t,e;return!!(Ul()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Oxe(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new DE("Browser returned unexpected credential type",e)}:{data:null,error:new DE("Empty credential response",e)}}catch(e){return{data:null,error:kxe({error:e,options:t})}}}async function Fxe(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new DE("Browser returned unexpected credential type",e)}:{data:null,error:new DE("Empty credential response",e)}}catch(e){return{data:null,error:Ixe({error:e,options:t})}}}const Bxe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},zxe={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function LE(...t){const e=l=>l!==null&&typeof l=="object"&&!Array.isArray(l),n=l=>l instanceof ArrayBuffer||ArrayBuffer.isView(l),s={};for(const l of t)if(l)for(const u in l){const p=l[u];if(p!==void 0)if(Array.isArray(p))s[u]=p;else if(n(p))s[u]=p;else if(e(p)){const r=s[u];e(r)?s[u]=LE(r,p):s[u]=LE(p)}else s[u]=p}return s}function Uxe(t,e){return LE(Bxe,t,e||{})}function Vxe(t,e){return LE(zxe,t,e||{})}class Hxe{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:s,signal:l},u){try{const{data:p,error:r}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!p)return{data:null,error:r};const v=l??Rxe.createNewAbortSignal();if(p.webauthn.type==="create"){const{user:w}=p.webauthn.credential_options.publicKey;w.name||(w.name=`${w.id}:${s}`),w.displayName||(w.displayName=w.name)}switch(p.webauthn.type){case"create":{const w=Uxe(p.webauthn.credential_options.publicKey,u==null?void 0:u.create),{data:E,error:T}=await Oxe({publicKey:w,signal:v});return E?{data:{factorId:e,challengeId:p.id,webauthn:{type:p.webauthn.type,credential_response:E}},error:null}:{data:null,error:T}}case"request":{const w=Vxe(p.webauthn.credential_options.publicKey,u==null?void 0:u.request),{data:E,error:T}=await Fxe(Object.assign(Object.assign({},p.webauthn.credential_options),{publicKey:w,signal:v}));return E?{data:{factorId:e,challengeId:p.id,webauthn:{type:p.webauthn.type,credential_response:E}},error:null}:{data:null,error:T}}}}catch(p){return Ti(p)?{data:null,error:p}:{data:null,error:new ex("Unexpected error in challenge",p)}}}async _verify({challengeId:e,factorId:n,webauthn:s}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},u){if(!n)return{data:null,error:new Ow("rpId is required for WebAuthn authentication")};try{if(!iz())return{data:null,error:new ex("Browser does not support WebAuthn",null)};const{data:p,error:r}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:s},signal:l},{request:u});if(!p)return{data:null,error:r};const{webauthn:v}=p;return this._verify({factorId:e,challengeId:p.challengeId,webauthn:{type:v.type,rpId:n,rpOrigins:s,credential_response:v.credential_response}})}catch(p){return Ti(p)?{data:null,error:p}:{data:null,error:new ex("Unexpected error in authenticate",p)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},u){if(!n)return{data:null,error:new Ow("rpId is required for WebAuthn registration")};try{if(!iz())return{data:null,error:new ex("Browser does not support WebAuthn",null)};const{data:p,error:r}=await this._enroll({friendlyName:e});if(!p)return await this.client.mfa.listFactors().then(E=>{var T;return(T=E.data)===null||T===void 0?void 0:T.all.find(k=>k.factor_type==="webauthn"&&k.friendly_name===e&&k.status!=="unverified")}).then(E=>E?this.client.mfa.unenroll({factorId:E==null?void 0:E.id}):void 0),{data:null,error:r};const{data:v,error:w}=await this._challenge({factorId:p.id,friendlyName:p.friendly_name,webauthn:{rpId:n,rpOrigins:s},signal:l},{create:u});return v?this._verify({factorId:p.id,challengeId:v.challengeId,webauthn:{rpId:n,rpOrigins:s,type:v.webauthn.type,credential_response:v.webauthn.credential_response}}):{data:null,error:w}}catch(p){return Ti(p)?{data:null,error:p}:{data:null,error:new ex("Unexpected error in register",p)}}}}Exe();const Gxe={url:zye,storageKey:Uye,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vye,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function sz(t,e,n){return await n()}const Q_={};class Fw{get jwks(){var e,n;return(n=(e=Q_[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Q_[this.storageKey]=Object.assign(Object.assign({},Q_[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Q_[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Q_[this.storageKey]=Object.assign(Object.assign({},Q_[this.storageKey]),{cachedAt:e})}constructor(e){var n,s,l;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},Gxe),e);if(this.storageKey=u.storageKey,this.instanceID=(n=Fw.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Fw.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&Ul()){const p=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(p),this.logDebugMessages&&console.trace(p)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new wxe({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=J$(u.fetch),this.lock=u.lock||sz,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:Ul()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Txe:this.lock=sz,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Hxe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Y$()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=rz(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=rz(this.memoryStorage)),Ul()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(p){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",p)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async p=>{this._debug("received broadcast notification from other tab or client",p),await this._notifyAllSubscribers(p.data.event,p.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Z$}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},s="none";if(Ul()&&(n=nxe(window.location.href),this._isImplicitGrantCallback(n)?s="implicit":await this._isPKCECallback(n)&&(s="pkce")),Ul()&&this.detectSessionInUrl&&s!=="none"){const{data:l,error:u}=await this._getSessionFromURL(n,s);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),Xye(u)){const v=(e=u.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:p,redirectType:r}=l;return this._debug("#_initialize()","detected session in URL",p,"redirect type",r),await this._saveSession(p),setTimeout(async()=>{r==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",p):await this._notifyAllSubscribers("SIGNED_IN",p)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ti(n)?this._returnResult({error:n}):this._returnResult({error:new ex("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,s,l;try{const u=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(l=e==null?void 0:e.options)===null||l===void 0?void 0:l.captchaToken}},xform:nf}),{data:p,error:r}=u;if(r||!p)return this._returnResult({data:{user:null,session:null},error:r});const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(u){if(Ti(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(e){var n,s,l;try{let u;if("email"in e){const{email:E,password:T,options:k}=e;let R=null,D=null;this.flowType==="pkce"&&([R,D]=await q_(this.storage,this.storageKey)),u=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:k==null?void 0:k.emailRedirectTo,body:{email:E,password:T,data:(n=k==null?void 0:k.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken},code_challenge:R,code_challenge_method:D},xform:nf})}else if("phone"in e){const{phone:E,password:T,options:k}=e;u=await Zi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:E,password:T,data:(s=k==null?void 0:k.data)!==null&&s!==void 0?s:{},channel:(l=k==null?void 0:k.channel)!==null&&l!==void 0?l:"sms",gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken}},xform:nf})}else throw new rT("You must provide either an email or phone number and a password");const{data:p,error:r}=u;if(r||!p)return this._returnResult({data:{user:null,session:null},error:r});const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(u){if(Ti(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(e){try{let n;if("email"in e){const{email:u,password:p,options:r}=e;n=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:p,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:tz})}else if("phone"in e){const{phone:u,password:p,options:r}=e;n=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:p,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:tz})}else throw new rT("You must provide either an email or phone number and a password");const{data:s,error:l}=n;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!s||!s.session||!s.user){const u=new W_;return this._returnResult({data:{user:null,session:null},error:u})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:l})}catch(n){if(Ti(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,s,l,u;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:(u=e.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,s,l,u,p,r,v,w,E,T,k;let R,D;if("message"in e)R=e.message,D=e.signature;else{const{chain:O,wallet:F,statement:U,options:X}=e;let W;if(Ul())if(typeof F=="object")W=F;else{const ae=window;if("ethereum"in ae&&typeof ae.ethereum=="object"&&"request"in ae.ethereum&&typeof ae.ethereum.request=="function")W=ae.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof F!="object"||!(X!=null&&X.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");W=F}const K=new URL((n=X==null?void 0:X.url)!==null&&n!==void 0?n:window.location.href),ne=await W.request({method:"eth_requestAccounts"}).then(ae=>ae).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!ne||ne.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const te=tW(ne[0]);let re=(s=X==null?void 0:X.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!re){const ae=await W.request({method:"eth_chainId"});re=Axe(ae)}const xe={domain:K.host,address:te,statement:U,uri:K.href,version:"1",chainId:re,nonce:(l=X==null?void 0:X.signInWithEthereum)===null||l===void 0?void 0:l.nonce,issuedAt:(p=(u=X==null?void 0:X.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&p!==void 0?p:new Date,expirationTime:(r=X==null?void 0:X.signInWithEthereum)===null||r===void 0?void 0:r.expirationTime,notBefore:(v=X==null?void 0:X.signInWithEthereum)===null||v===void 0?void 0:v.notBefore,requestId:(w=X==null?void 0:X.signInWithEthereum)===null||w===void 0?void 0:w.requestId,resources:(E=X==null?void 0:X.signInWithEthereum)===null||E===void 0?void 0:E.resources};R=Mxe(xe),D=await W.request({method:"personal_sign",params:[Cxe(R),te]})}try{const{data:O,error:F}=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:R,signature:D},!((T=e.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:(k=e.options)===null||k===void 0?void 0:k.captchaToken}}:null),xform:nf});if(F)throw F;if(!O||!O.session||!O.user){const U=new W_;return this._returnResult({data:{user:null,session:null},error:U})}return O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:Object.assign({},O),error:F})}catch(O){if(Ti(O))return this._returnResult({data:{user:null,session:null},error:O});throw O}}async signInWithSolana(e){var n,s,l,u,p,r,v,w,E,T,k,R;let D,O;if("message"in e)D=e.message,O=e.signature;else{const{chain:F,wallet:U,statement:X,options:W}=e;let K;if(Ul())if(typeof U=="object")K=U;else{const te=window;if("solana"in te&&typeof te.solana=="object"&&("signIn"in te.solana&&typeof te.solana.signIn=="function"||"signMessage"in te.solana&&typeof te.solana.signMessage=="function"))K=te.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!(W!=null&&W.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=U}const ne=new URL((n=W==null?void 0:W.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in K&&K.signIn){const te=await K.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},W==null?void 0:W.signInWithSolana),{version:"1",domain:ne.host,uri:ne.href}),X?{statement:X}:null));let re;if(Array.isArray(te)&&te[0]&&typeof te[0]=="object")re=te[0];else if(te&&typeof te=="object"&&"signedMessage"in te&&"signature"in te)re=te;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in re&&"signature"in re&&(typeof re.signedMessage=="string"||re.signedMessage instanceof Uint8Array)&&re.signature instanceof Uint8Array)D=typeof re.signedMessage=="string"?re.signedMessage:new TextDecoder().decode(re.signedMessage),O=re.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in K)||typeof K.signMessage!="function"||!("publicKey"in K)||typeof K!="object"||!K.publicKey||!("toBase58"in K.publicKey)||typeof K.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");D=[`${ne.host} wants you to sign in with your Solana account:`,K.publicKey.toBase58(),...X?["",X,""]:[""],"Version: 1",`URI: ${ne.href}`,`Issued At: ${(l=(s=W==null?void 0:W.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&l!==void 0?l:new Date().toISOString()}`,...!((u=W==null?void 0:W.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${W.signInWithSolana.notBefore}`]:[],...!((p=W==null?void 0:W.signInWithSolana)===null||p===void 0)&&p.expirationTime?[`Expiration Time: ${W.signInWithSolana.expirationTime}`]:[],...!((r=W==null?void 0:W.signInWithSolana)===null||r===void 0)&&r.chainId?[`Chain ID: ${W.signInWithSolana.chainId}`]:[],...!((v=W==null?void 0:W.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${W.signInWithSolana.nonce}`]:[],...!((w=W==null?void 0:W.signInWithSolana)===null||w===void 0)&&w.requestId?[`Request ID: ${W.signInWithSolana.requestId}`]:[],...!((T=(E=W==null?void 0:W.signInWithSolana)===null||E===void 0?void 0:E.resources)===null||T===void 0)&&T.length?["Resources",...W.signInWithSolana.resources.map(re=>`- ${re}`)]:[]].join(`
`);const te=await K.signMessage(new TextEncoder().encode(D),"utf8");if(!te||!(te instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");O=te}}try{const{data:F,error:U}=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:D,signature:lx(O)},!((k=e.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:(R=e.options)===null||R===void 0?void 0:R.captchaToken}}:null),xform:nf});if(U)throw U;if(!F||!F.session||!F.user){const X=new W_;return this._returnResult({data:{user:null,session:null},error:X})}return F.session&&(await this._saveSession(F.session),await this._notifyAllSubscribers("SIGNED_IN",F.session)),this._returnResult({data:Object.assign({},F),error:U})}catch(F){if(Ti(F))return this._returnResult({data:{user:null,session:null},error:F});throw F}}async _exchangeCodeForSession(e){const n=await By(this.storage,`${this.storageKey}-code-verifier`),[s,l]=(n??"").split("/");try{const{data:u,error:p}=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:nf});if(await d0(this.storage,`${this.storageKey}-code-verifier`),p)throw p;if(!u||!u.session||!u.user){const r=new W_;return this._returnResult({data:{user:null,session:null,redirectType:null},error:r})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:l??null}),error:p})}catch(u){if(Ti(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(e){try{const{options:n,provider:s,token:l,access_token:u,nonce:p}=e,r=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:l,access_token:u,nonce:p,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:nf}),{data:v,error:w}=r;if(w)return this._returnResult({data:{user:null,session:null},error:w});if(!v||!v.session||!v.user){const E=new W_;return this._returnResult({data:{user:null,session:null},error:E})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:v,error:w})}catch(n){if(Ti(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,s,l,u,p;try{if("email"in e){const{email:r,options:v}=e;let w=null,E=null;this.flowType==="pkce"&&([w,E]=await q_(this.storage,this.storageKey));const{error:T}=await Zi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:(n=v==null?void 0:v.data)!==null&&n!==void 0?n:{},create_user:(s=v==null?void 0:v.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:w,code_challenge_method:E},redirectTo:v==null?void 0:v.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:T})}if("phone"in e){const{phone:r,options:v}=e,{data:w,error:E}=await Zi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:r,data:(l=v==null?void 0:v.data)!==null&&l!==void 0?l:{},create_user:(u=v==null?void 0:v.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},channel:(p=v==null?void 0:v.channel)!==null&&p!==void 0?p:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:w==null?void 0:w.message_id},error:E})}throw new rT("You must provide either an email or phone number.")}catch(r){if(Ti(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async verifyOtp(e){var n,s;try{let l,u;"options"in e&&(l=(n=e.options)===null||n===void 0?void 0:n.redirectTo,u=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:p,error:r}=await Zi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:u}}),redirectTo:l,xform:nf});if(r)throw r;if(!p)throw new Error("An error occurred on token verification.");const v=p.session,w=p.user;return v!=null&&v.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(l){if(Ti(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithSSO(e){var n,s,l,u,p;try{let r=null,v=null;this.flowType==="pkce"&&([r,v]=await q_(this.storage,this.storageKey));const w=await Zi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&s!==void 0?s:void 0}),!((l=e==null?void 0:e.options)===null||l===void 0)&&l.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:v}),headers:this.headers,xform:_xe});return!((u=w.data)===null||u===void 0)&&u.url&&Ul()&&!(!((p=e.options)===null||p===void 0)&&p.skipBrowserRedirect)&&window.location.assign(w.data.url),this._returnResult(w)}catch(r){if(Ti(r))return this._returnResult({data:null,error:r});throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;if(s)throw s;if(!n)throw new Yu;const{error:l}=await Zi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:l})})}catch(e){if(Ti(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:s,type:l,options:u}=e,{error:p}=await Zi(this.fetch,"POST",n,{headers:this.headers,body:{email:s,type:l,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},redirectTo:u==null?void 0:u.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}else if("phone"in e){const{phone:s,type:l,options:u}=e,{data:p,error:r}=await Zi(this.fetch,"POST",n,{headers:this.headers,body:{phone:s,type:l,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:p==null?void 0:p.message_id},error:r})}throw new rT("You must provide either an email or phone number and a type")}catch(n){if(Ti(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),l=(async()=>(await s,await n()))();return this.pendingInLock.push((async()=>{try{await l}catch{}})()),l}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=n();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const l=[...this.pendingInLock];await Promise.all(l),this.pendingInLock.splice(0,l.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await By(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<zM:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const p=await By(this.userStorage,this.storageKey+"-user");p!=null&&p.user?e.user=p.user:e.user=HM()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const p={value:this.suppressGetSessionWarning};e.user=mxe(e.user,p),p.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:l,error:u}=await this._callRefreshToken(e.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:l},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Zi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:S0}):await this._useSession(async n=>{var s,l,u;const{data:p,error:r}=n;if(r)throw r;return!(!((s=p.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yu}:await Zi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(l=p.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0,xform:S0})})}catch(n){if(Ti(n))return qye(n)&&(await this._removeSession(),await d0(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async s=>{const{data:l,error:u}=s;if(u)throw u;if(!l.session)throw new Yu;const p=l.session;let r=null,v=null;this.flowType==="pkce"&&e.email!=null&&([r,v]=await q_(this.storage,this.storageKey));const{data:w,error:E}=await Zi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:r,code_challenge_method:v}),jwt:p.access_token,xform:S0});if(E)throw E;return p.user=w.user,await this._saveSession(p),await this._notifyAllSubscribers("USER_UPDATED",p),this._returnResult({data:{user:p.user},error:null})})}catch(s){if(Ti(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yu;const n=Date.now()/1e3;let s=n,l=!0,u=null;const{payload:p}=VM(e.access_token);if(p.exp&&(s=p.exp,l=s<=n),l){const{data:r,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return this._returnResult({data:{user:null,session:null},error:v});if(!r)return{data:{user:null,session:null},error:null};u=r}else{const{data:r,error:v}=await this._getUser(e.access_token);if(v)throw v;u={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-n,expires_at:s},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(n){if(Ti(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var s;if(!e){const{data:p,error:r}=n;if(r)throw r;e=(s=p.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Yu;const{data:l,error:u}=await this._callRefreshToken(e.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):l?this._returnResult({data:{user:l.user,session:l},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ti(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Ul())throw new iT("No browser detected.");if(e.error||e.error_description||e.error_code)throw new iT(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new XB("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new iT("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new XB("No code detected.");const{data:X,error:W}=await this._exchangeCodeForSession(e.code);if(W)throw W;const K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:X.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:l,access_token:u,refresh_token:p,expires_in:r,expires_at:v,token_type:w}=e;if(!u||!r||!p||!w)throw new iT("No session defined in URL");const E=Math.round(Date.now()/1e3),T=parseInt(r);let k=E+T;v&&(k=parseInt(v));const R=k-E;R*1e3<=pv&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${R}s, should have been closer to ${T}s`);const D=k-T;E-D>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",D,k,E):E-D<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",D,k,E);const{data:O,error:F}=await this._getUser(u);if(F)throw F;const U={provider_token:s,provider_refresh_token:l,access_token:u,expires_in:T,expires_at:k,refresh_token:p,token_type:w,user:O.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:U,redirectType:e.type},error:null})}catch(s){if(Ti(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await By(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var s;const{data:l,error:u}=n;if(u)return this._returnResult({error:u});const p=(s=l.session)===null||s===void 0?void 0:s.access_token;if(p){const{error:r}=await this.admin.signOut(p,e);if(r&&!(Wye(r)&&(r.status===404||r.status===401||r.status===403)))return this._returnResult({error:r})}return e!=="others"&&(await this._removeSession(),await d0(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=txe(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async n=>{var s,l;try{const{data:{session:u},error:p}=n;if(p)throw p;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",e,"session",u)}catch(u){await((l=this.stateChangeEmitters.get(e))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",u),console.error(u)}})}async resetPasswordForEmail(e,n={}){let s=null,l=null;this.flowType==="pkce"&&([s,l]=await q_(this.storage,this.storageKey,!0));try{return await Zi(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:l,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(u){if(Ti(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var e;try{const{data:n,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:s,error:l}=await this._useSession(async u=>{var p,r,v,w,E;const{data:T,error:k}=u;if(k)throw k;const R=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(p=e.options)===null||p===void 0?void 0:p.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await Zi(this.fetch,"GET",R,{headers:this.headers,jwt:(E=(w=T.session)===null||w===void 0?void 0:w.access_token)!==null&&E!==void 0?E:void 0})});if(l)throw l;return Ul()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(Ti(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var s;try{const{error:l,data:{session:u}}=n;if(l)throw l;const{options:p,provider:r,token:v,access_token:w,nonce:E}=e,T=await Zi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=u==null?void 0:u.access_token)!==null&&s!==void 0?s:void 0,body:{provider:r,id_token:v,access_token:w,nonce:E,link_identity:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:nf}),{data:k,error:R}=T;return R?this._returnResult({data:{user:null,session:null},error:R}):!k||!k.session||!k.user?this._returnResult({data:{user:null,session:null},error:new W_}):(k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("USER_UPDATED",k.session)),this._returnResult({data:k,error:R}))}catch(l){if(Ti(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var s,l;const{data:u,error:p}=n;if(p)throw p;return await Zi(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0})})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const s=Date.now();return await sxe(async l=>(l>0&&await ixe(200*Math.pow(2,l-1)),this._debug(n,"refreshing attempt",l),await Zi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:nf})),(l,u)=>{const p=200*Math.pow(2,l);return u&&UM(u)&&Date.now()+p-s<pv})}catch(s){if(this._debug(n,"error",s),Ti(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",s),Ul()&&!n.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,n;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const l=await By(this.storage,this.storageKey);if(l&&this.userStorage){let p=await By(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!p&&(p={user:l.user},await mv(this.userStorage,this.storageKey+"-user",p)),l.user=(e=p==null?void 0:p.user)!==null&&e!==void 0?e:HM()}else if(l&&!l.user&&!l.user){const p=await By(this.storage,this.storageKey+"-user");p&&(p!=null&&p.user)?(l.user=p.user,await d0(this.storage,this.storageKey+"-user"),await mv(this.storage,this.storageKey,l)):l.user=HM()}if(this._debug(s,"session from storage",l),!this._isValidSession(l)){this._debug(s,"session is not valid"),l!==null&&await this._removeSession();return}const u=((n=l.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<zM;if(this._debug(s,`session has${u?"":" not"} expired with margin of ${zM}s`),u){if(this.autoRefreshToken&&l.refresh_token){const{error:p}=await this._callRefreshToken(l.refresh_token);p&&(console.error(p),UM(p)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",p),await this._removeSession()))}}else if(l.user&&l.user.__isUserNotAvailableProxy===!0)try{const{data:p,error:r}=await this._getUser(l.access_token);!r&&(p!=null&&p.user)?(l.user=p.user,await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(p){console.error("Error getting user data:",p),this._debug(s,"error getting user data, skipping SIGNED_IN notification",p)}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(s,"error",l),console.error(l);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var n,s;if(!e)throw new Yu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const l=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(l,"begin");try{this.refreshingDeferred=new $A;const{data:u,error:p}=await this._refreshAccessToken(e);if(p)throw p;if(!u.session)throw new Yu;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const r={data:u.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(u){if(this._debug(l,"error",u),Ti(u)){const p={data:null,error:u};return UM(u)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(p),p}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(u),u}finally{this.refreshingDeferred=null,this._debug(l,"end")}}async _notifyAllSubscribers(e,n,s=!0){const l=`#_notifyAllSubscribers(${e})`;this._debug(l,"begin",n,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:n});const u=[],p=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,n)}catch(v){u.push(v)}});if(await Promise.all(p),u.length>0){for(let r=0;r<u.length;r+=1)console.error(u[r]);throw u[0]}}finally{this._debug(l,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),s=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&n.user&&await mv(this.userStorage,this.storageKey+"-user",{user:n.user});const l=Object.assign({},n);delete l.user;const u=JB(l);await mv(this.storage,this.storageKey,u)}else{const l=JB(n);await mv(this.storage,this.storageKey,l)}}async _removeSession(){this._debug("#_removeSession()"),await d0(this.storage,this.storageKey),await d0(this.storage,this.storageKey+"-code-verifier"),await d0(this.storage,this.storageKey+"-user"),this.userStorage&&await d0(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ul()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pv);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:s}}=n;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const l=Math.floor((s.expires_at*1e3-e)/pv);this._debug("#_autoRefreshTokenTick()",`access token expires in ${l} ticks, a tick lasts ${pv}ms, refresh threshold is ${oI} ticks`),l<=oI&&await this._callRefreshToken(s.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof eW)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ul()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,s){const l=[`provider=${encodeURIComponent(n)}`];if(s!=null&&s.redirectTo&&l.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&l.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[u,p]=await q_(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(p)}`});l.push(r.toString())}if(s!=null&&s.queryParams){const u=new URLSearchParams(s.queryParams);l.push(u.toString())}return s!=null&&s.skipBrowserRedirect&&l.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${l.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var s;const{data:l,error:u}=n;return u?this._returnResult({data:null,error:u}):await Zi(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=l==null?void 0:l.session)===null||s===void 0?void 0:s.access_token})})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var s,l;const{data:u,error:p}=n;if(p)return this._returnResult({data:null,error:p});const r=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:v,error:w}=await Zi(this.fetch,"POST",`${this.url}/factors`,{body:r,headers:this.headers,jwt:(s=u==null?void 0:u.session)===null||s===void 0?void 0:s.access_token});return w?this._returnResult({data:null,error:w}):(e.factorType==="totp"&&v.type==="totp"&&(!((l=v==null?void 0:v.totp)===null||l===void 0)&&l.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),this._returnResult({data:v,error:null}))})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:l,error:u}=n;if(u)return this._returnResult({data:null,error:u});const p=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Dxe(e.webauthn.credential_response):Lxe(e.webauthn.credential_response)})}:{code:e.code}),{data:r,error:v}=await Zi(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:p,headers:this.headers,jwt:(s=l==null?void 0:l.session)===null||s===void 0?void 0:s.access_token});return v?this._returnResult({data:null,error:v}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),this._returnResult({data:r,error:v}))})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:l,error:u}=n;if(u)return this._returnResult({data:null,error:u});const p=await Zi(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=l==null?void 0:l.session)===null||s===void 0?void 0:s.access_token});if(p.error)return p;const{data:r}=p;if(r.type!=="webauthn")return{data:r,error:null};switch(r.webauthn.type){case"create":return{data:Object.assign(Object.assign({},r),{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_options:Object.assign(Object.assign({},r.webauthn.credential_options),{publicKey:Nxe(r.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},r),{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_options:Object.assign(Object.assign({},r.webauthn.credential_options),{publicKey:jxe(r.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:s}=await this.getUser();if(s)return{data:null,error:s};const l={all:[],phone:[],totp:[],webauthn:[]};for(const u of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])l.all.push(u),u.status==="verified"&&l[u.factor_type].push(u);return{data:l,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:s},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=VM(s.access_token);let p=null;u.aal&&(p=u.aal);let r=p;((n=(e=s.user.factors)===null||e===void 0?void 0:e.filter(E=>E.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(r="aal2");const w=u.amr||[];return{data:{currentLevel:p,nextLevel:r,currentAuthenticationMethods:w},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:s},error:l}=n;return l?this._returnResult({data:null,error:l}):s?await Zi(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Yu})})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:l},error:u}=s;if(u)return this._returnResult({data:null,error:u});if(!l)return this._returnResult({data:null,error:new Yu});const p=await Zi(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"approve"},xform:r=>({data:r,error:null})});return p.data&&p.data.redirect_url&&Ul()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(p.data.redirect_url),p})}catch(s){if(Ti(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:l},error:u}=s;if(u)return this._returnResult({data:null,error:u});if(!l)return this._returnResult({data:null,error:new Yu});const p=await Zi(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"deny"},xform:r=>({data:r,error:null})});return p.data&&p.data.redirect_url&&Ul()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(p.data.redirect_url),p})}catch(s){if(Ti(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;return s?this._returnResult({data:null,error:s}):n?await Zi(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new Yu})})}catch(e){if(Ti(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:s},error:l}=n;return l?this._returnResult({data:null,error:l}):s?(await Zi(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Yu})})}catch(n){if(Ti(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let s=n.keys.find(r=>r.kid===e);if(s)return s;const l=Date.now();if(s=this.jwks.keys.find(r=>r.kid===e),s&&this.jwks_cached_at+Gye>l)return s;const{data:u,error:p}=await Zi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(p)throw p;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=l,s=u.keys.find(r=>r.kid===e),!s)?null:s}async getClaims(e,n={}){try{let s=e;if(!s){const{data:R,error:D}=await this.getSession();if(D||!R.session)return this._returnResult({data:null,error:D});s=R.session.access_token}const{header:l,payload:u,signature:p,raw:{header:r,payload:v}}=VM(s);n!=null&&n.allowExpired||hxe(u.exp);const w=!l.alg||l.alg.startsWith("HS")||!l.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(l.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!w){const{error:R}=await this.getUser(s);if(R)throw R;return{data:{claims:u,header:l,signature:p},error:null}}const E=fxe(l.alg),T=await crypto.subtle.importKey("jwk",w,E,!0,["verify"]);if(!await crypto.subtle.verify(E,T,p,Jye(`${r}.${v}`)))throw new cI("Invalid JWT signature");return{data:{claims:u,header:l,signature:p},error:null}}catch(s){if(Ti(s))return this._returnResult({data:null,error:s});throw s}}}Fw.nextInstanceID={};const $xe=Fw;class Wxe extends $xe{constructor(e){super(e)}}class qxe{constructor(e,n,s){var l,u,p;this.supabaseUrl=e,this.supabaseKey=n;const r=Bye(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const v=`sb-${r.hostname.split(".")[0]}-auth-token`,w={db:Pye,realtime:Nye,auth:Object.assign(Object.assign({},Rye),{storageKey:v}),global:Iye},E=Fye(s??{},w);this.storageKey=(l=E.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(u=E.global.headers)!==null&&u!==void 0?u:{},E.accessToken?(this.accessToken=E.accessToken,this.auth=new Proxy({},{get:(T,k)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(k)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((p=E.auth)!==null&&p!==void 0?p:{},this.headers,E.global.fetch),this.fetch=Lye(n,this._getAccessToken.bind(this),E.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},E.realtime)),this.accessToken&&this.accessToken().then(T=>this.realtime.setAuth(T)).catch(T=>console.warn("Failed to set initial Realtime auth token:",T)),this.rest=new N0e(new URL("rest/v1",r).href,{headers:this.headers,schema:E.db.schema,fetch:this.fetch}),this.storage=new Cye(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),E.accessToken||this._listenForAuthEvents()}get functions(){return new k0e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,s)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(n=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:s,storage:l,userStorage:u,storageKey:p,flowType:r,lock:v,debug:w,throwOnError:E},T,k){const R={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Wxe({url:this.authUrl.href,headers:Object.assign(Object.assign({},R),T),storageKey:p,autoRefreshToken:e,persistSession:n,detectSessionInUrl:s,storage:l,userStorage:u,flowType:r,lock:v,debug:w,throwOnError:E,fetch:k,hasCustomAuthorizationHeader:Object.keys(this.headers).some(D=>D.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Q0e(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,s)=>{this._handleTokenChanged(n,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,n,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const oz=(t,e,n)=>new qxe(t,e,n);function Xxe(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Xxe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const $M="https://jjzksgzieuguuolfcekk.supabase.co",WM="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqemtzZ3ppZXVndXVvbGZjZWtrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NjEyODcsImV4cCI6MjA3OTIzNzI4N30.2QCl1hX5Ltx9Vo7YUGKHxjGzfVsbuTJu3OJryzO9-hM";let uI;try{$M&&WM&&$M!==""&&WM!==""&&(uI=oz($M,WM))}catch(t){console.error("Bd inicjalizacji Supabase:",t),uI=oz("https://placeholder.supabase.co","placeholder-key")}const Kt=uI;function az(){return typeof window>"u"?null:navigator.userAgent||null}async function rW(t,e){var n,s;if(!t)return null;try{console.log("[UserService] Looking for user with wallet:",t.toLowerCase());const{data:l,error:u}=await Kt.from("users").select("*").eq("wallet_address",t.toLowerCase()).maybeSingle();if(u&&u.code!=="PGRST116"&&console.warn("[UserService] Error fetching user:",u),l){console.log("[UserService] Found existing user:",l.id);const w=az(),{error:E}=await Kt.rpc("update_user_login_tracking",{p_user_id:l.id,p_login_ip:e||null,p_user_agent:w});return E&&console.warn("[UserService] Error updating login tracking:",E),l}if(console.log("[UserService] No existing user found, creating new..."),(u==null?void 0:u.code)==="PGRST301"||(n=u==null?void 0:u.message)!=null&&n.includes("401"))return console.warn("Supabase authentication required - user creation skipped"),null;const p=az(),{data:r,error:v}=await Kt.from("users").insert({wallet_address:t.toLowerCase(),total_xp:0,level:1,passport_tier:"bronze",quests_completed:0,total_tokens_earned:0,registration_at:new Date().toISOString(),registration_ip:e||null,user_agent:p,login_count:1,last_login_at:new Date().toISOString(),last_login_ip:e||null,last_user_agent:p}).select().single();return v?(v.code==="PGRST301"||(s=v.message)!=null&&s.includes("401")?console.warn("Supabase authentication required - user creation skipped"):console.warn("Error creating user (non-critical):",v),null):r}catch(l){return console.warn("User service error (non-critical):",l),null}}async function bN(t){if(!t)return null;const{data:e,error:n}=await Kt.from("users").select("*").eq("id",t).maybeSingle();return n?(console.error("Error fetching user:",n),null):e}async function $T(t,e){const{data:n}=await Kt.from("users").select("total_xp, level").eq("id",t).single();if(!n)return{levelUp:!1,newLevel:1,oldLevel:1};const s=n.level||1,l=(n.total_xp||0)+e,u=iW(l),p=u>s;if(await Kt.from("users").update({total_xp:l,level:u,passport_tier:sW(u)}).eq("id",t),p){const{updateAllAchievementProgress:r,checkAchievements:v}=await hr(async()=>{const{updateAllAchievementProgress:w,checkAchievements:E}=await Promise.resolve().then(()=>ZW);return{updateAllAchievementProgress:w,checkAchievements:E}},void 0);await r(t),await v(t)}return{levelUp:p,newLevel:u,oldLevel:s}}function iW(t){return Math.floor(Math.sqrt(t/100))+1}function sW(t){return t>=15?"platinum":t>=10?"gold":t>=5?"silver":"bronze"}async function WT(t){const{error:e}=await Kt.rpc("increment_quests_completed",{user_id:t});if(e){const{data:n}=await Kt.from("users").select("quests_completed").eq("id",t).single();n&&await Kt.from("users").update({quests_completed:(n.quests_completed||0)+1}).eq("id",t)}}const Zxe=Object.freeze(Object.defineProperty({__proto__:null,calculateLevel:iW,getOrCreateUser:rW,getPassportTier:sW,getUser:bN,incrementQuestsCompleted:WT,updateUserXP:$T},Symbol.toStringTag,{value:"Module"})),z1="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd",qT="0xFc22556bb4ae5740610bE43457d46AdA5200b994",Qxe="0x9258af220b9bc65e136ee69e8988c46e3b67d16fd4a2c8cf8deb04cd90f7a28c",oW=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],type:"function"},{constant:!1,inputs:[{name:"_value",type:"uint256"}],name:"burn",outputs:[],type:"function"}],Kxe=[{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{name:"",type:"string"}],type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{name:"",type:"address"}],type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],type:"function"}],XT=[...Kxe,{constant:!1,inputs:[{name:"to",type:"address"},{name:"metadataURI",type:"string"},{name:"tier",type:"string"}],name:"mint",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"tokenId",type:"uint256"},{name:"metadataURI",type:"string"},{name:"tier",type:"string"}],name:"updateMetadata",outputs:[],type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"getTier",outputs:[{name:"",type:"string"}],type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getTokenId",outputs:[{name:"",type:"uint256"}],type:"function"}],sT=["https://ethereum-sepolia.publicnode.com","https://rpc.sepolia.org","https://ethereum-sepolia-rpc.publicnode.com","https://1rpc.io/sepolia"],Yxe="https://ethereum-sepolia.publicnode.com",dI=new Map,Jxe=300*1e3,qM=lR({chain:Ux,transport:f2(Yxe,{timeout:15e3,fetchOptions:{signal:AbortSignal.timeout(15e3)}})});function wN(){const t=xce(Qxe);return cse({account:t,chain:Ux,transport:f2("https://ethereum-sepolia.publicnode.com")})}async function Tx(t){if(!t)return 0;const e=`${t}_${z1}`,n=dI.get(e);if(n&&Date.now()-n.timestamp<Jxe)return console.log("[TPX Balance] Returning cached balance:",n.balance),n.balance;for(let s=0;s<sT.length;s++){const l=sT[s];console.log(`[TPX Balance] Trying RPC ${s+1}/${sT.length}: ${l}`);try{const u=lR({chain:Ux,transport:f2(l,{timeout:15e3,fetchOptions:{signal:AbortSignal.timeout(15e3)}})}),p=await u.getBytecode({address:z1});if(!p||p==="0x")return console.warn(`[TPX Balance] Contract not deployed at ${z1}`),0;const r=await u.readContract({address:z1,abi:oW,functionName:"balanceOf",args:[t]}),v=parseFloat(n2(r,18));return dI.set(e,{balance:v,timestamp:Date.now()}),console.log(`[TPX Balance] Success! Balance: ${v} TPX`),v}catch(u){if(console.warn(`[TPX Balance] RPC ${l} failed:`,u.message),s===sT.length-1)return console.error("[TPX Balance] All RPCs failed"),0;continue}}return 0}function w0(){dI.clear(),console.log("[TPX Balance] Cache cleared")}async function aW(t,e,n="bronze"){try{console.log("[mintNFTPassport] Admin minting NFT for user:",t);const l=await wN().writeContract({address:qT,abi:XT,functionName:"mint",args:[t,e,n]});return console.log("[mintNFTPassport] Transaction sent by admin:",l),{success:!0,tokenId:Math.floor(Math.random()*1e5)+1,txHash:l}}catch(s){return console.error("[mintNFTPassport] Error:",s),{success:!1,error:s.message||"Failed to mint passport"}}}async function lW(t){try{const e=await qM.readContract({address:qT,abi:XT,functionName:"balanceOf",args:[t]});if(Number(e)===0)return null;const s=await qM.readContract({address:qT,abi:XT,functionName:"getTokenId",args:[t]}),l=Number(s);if(l===0)return null;try{const p=(await qM.readContract({address:qT,abi:XT,functionName:"ownerOf",args:[l]})).toLowerCase(),r=t.toLowerCase();return p!==r?(console.warn("[getNFTPassportTokenId] Token ownership mismatch:",{tokenId:l,owner:p,wallet:r}),null):l}catch(u){return console.warn("[getNFTPassportTokenId] Could not verify ownership:",u),null}}catch(e){return console.error("Error getting NFT Passport token ID:",e),null}}async function SN(t,e){try{console.log("[claimTokens] Transferring",e,"TPX to",t);const n=wN(),s=nie(e.toString(),18),l=await n.writeContract({address:z1,abi:oW,functionName:"transfer",args:[t,s]});return console.log("[claimTokens] Transaction sent:",l),w0(),console.log("[claimTokens]  Transaction submitted successfully"),{success:!0,txHash:l}}catch(n){return console.error("[claimTokens] Error:",n),{success:!1,error:n.message||"Failed to claim tokens"}}}async function TN(t,e,n){const s="0x110D62545d416d3DFEfA12D0298aBf197CF0e828";try{console.log("[mintAchievementNFT] Minting for",t);const u=await wN().writeContract({address:s,abi:[{constant:!1,inputs:[{name:"to",type:"address"},{name:"metadataURI",type:"string"},{name:"questId",type:"string"}],name:"mint",outputs:[{name:"",type:"uint256"}],type:"function"}],functionName:"mint",args:[t,e,n]});return console.log("[mintAchievementNFT] Transaction sent:",u),{success:!0,tokenId:Math.floor(Math.random()*1e5)+1,txHash:u}}catch(l){return console.error("[mintAchievementNFT] Error:",l),{success:!1,error:l.message||"Failed to mint achievement"}}}const e_e=Object.freeze(Object.defineProperty({__proto__:null,claimTokens:SN,clearTPXBalanceCache:w0,getNFTPassportTokenId:lW,getTPXBalance:Tx,mintAchievementNFT:TN,mintNFTPassport:aW},Symbol.toStringTag,{value:"Module"}));function t_e(){try{const t=document.createElement("canvas"),e=t.getContext("2d");return e?(t.width=200,t.height=50,e.textBaseline="top",e.font="14px Arial",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText("Fingerprint",2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText("Fingerprint",4,17),t.toDataURL()):null}catch{return null}}function n_e(){try{const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return null;const n=e.getExtension("WEBGL_debug_renderer_info");if(!n)return null;const s=e.getParameter(n.UNMASKED_VENDOR_WEBGL),l=e.getParameter(n.UNMASKED_RENDERER_WEBGL);return`${s}|${l}`}catch{return null}}function r_e(){const t=navigator.userAgent;let e="Unknown",n="Unknown",s="Unknown";if(t.includes("Windows"))e="Windows",t.includes("Windows NT 10.0")?n="10":t.includes("Windows NT 6.3")?n="8.1":t.includes("Windows NT 6.2")?n="8":t.includes("Windows NT 6.1")?n="7":t.includes("Windows NT 6.0")?n="Vista":t.includes("Windows NT 5.1")&&(n="XP");else if(t.includes("Mac OS X")){e="macOS";const l=t.match(/Mac OS X (\d+[._]\d+)/);l&&(n=l[1].replace("_","."))}else if(t.includes("Linux")){e="Linux";const l=t.match(/Linux ([^;)]+)/);l&&(n=l[1])}else if(t.includes("Android")){e="Android";const l=t.match(/Android (\d+\.\d+)/);l&&(n=l[1])}else if(t.includes("iOS")||t.includes("iPhone")||t.includes("iPad")){e="iOS";const l=t.match(/OS (\d+[._]\d+)/);l&&(n=l[1].replace("_","."))}return navigator.userAgentData&&navigator.userAgentData.platform?s=navigator.userAgentData.platform:t.includes("x64")||t.includes("x86_64")||t.includes("Win64")?s="x64":t.includes("x86")||t.includes("Win32")?s="x86":t.includes("ARM")&&(s="ARM"),{name:e,version:n,architecture:s}}function i_e(){const t=navigator.userAgent;let e="Unknown",n="Unknown",s="Unknown";if(t.includes("Chrome")&&!t.includes("Edg")&&!t.includes("OPR")){e="Chrome";const l=t.match(/Chrome\/(\d+\.\d+)/);l&&(n=l[1]),s="Blink"}else if(t.includes("Firefox")){e="Firefox";const l=t.match(/Firefox\/(\d+\.\d+)/);l&&(n=l[1]),s="Gecko"}else if(t.includes("Safari")&&!t.includes("Chrome")){e="Safari";const l=t.match(/Version\/(\d+\.\d+)/);l&&(n=l[1]),s="WebKit"}else if(t.includes("Edg")){e="Edge";const l=t.match(/Edg\/(\d+\.\d+)/);l&&(n=l[1]),s="Blink"}else if(t.includes("OPR")){e="Opera";const l=t.match(/OPR\/(\d+\.\d+)/);l&&(n=l[1]),s="Blink"}return{name:e,version:n,engine:s}}function s_e(){try{return Array.from(navigator.plugins).map(t=>t.name)}catch{return[]}}function cW(){return{screen:{width:screen.width,height:screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,languages:navigator.languages||[navigator.language],platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency||0,deviceMemory:navigator.deviceMemory||void 0,maxTouchPoints:navigator.maxTouchPoints||0,canvas:t_e(),webgl:n_e(),plugins:s_e(),userAgent:navigator.userAgent,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack||null,vendor:navigator.vendor,vendorSub:navigator.vendorSub,product:navigator.product,productSub:navigator.productSub}}function uW(){return r_e()}function dW(){return i_e()}function o_e(){const t=cW(),e=uW(),n=dW(),s=`${t.screen.width}x${t.screen.height}_${t.timezone}_${t.language}_${e.name}_${n.name}_${t.hardwareConcurrency}`;let l=0;for(let u=0;u<s.length;u++){const p=s.charCodeAt(u);l=(l<<5)-l+p,l=l&l}return Math.abs(l).toString(16)}function a_e(){const t=navigator.userAgent;return/tablet|ipad|playbook|silk/i.test(t)?"tablet":/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(t)?"mobile":"desktop"}const WA="tripx_session_token",hW="tripx_session_start";async function fW(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip||null}catch(t){return console.warn("Failed to get IP address:",t),null}}async function pW(t){try{const n=await(await fetch(`https://ipapi.co/${t}/json/`)).json();return{country:n.country_name||void 0,city:n.city||void 0}}catch(e){return console.warn("Failed to get location from IP:",e),{}}}async function EN(){if(typeof window>"u")return{fingerprint:"",fingerprintHash:"",fingerprintData:{},userAgent:"",os:"Unknown",osInfo:{name:"Unknown",version:"Unknown",architecture:"Unknown"},browser:"Unknown",browserInfo:{name:"Unknown",version:"Unknown",engine:"Unknown"},deviceType:"Unknown",deviceInfo:{}};const t=cW(),e=o_e(),n=uW(),s=dW(),l=a_e(),u=JSON.stringify(t),p={screen:t.screen,hardwareConcurrency:t.hardwareConcurrency,deviceMemory:t.deviceMemory,maxTouchPoints:t.maxTouchPoints,timezone:t.timezone,language:t.language,languages:t.languages,platform:t.platform,vendor:t.vendor,cookieEnabled:t.cookieEnabled,doNotTrack:t.doNotTrack},r=navigator.userAgent,v=n.name,w=s.name;let E,T,k;try{if(E=await fW()||void 0,E){const R=await pW(E);T=R.country,k=R.city}}catch(R){console.warn("Failed to get IP/location:",R)}return{fingerprint:u,fingerprintHash:e,fingerprintData:t,userAgent:r,os:v,osInfo:n,browser:w,browserInfo:s,deviceType:l,deviceInfo:p,ipAddress:E,country:T,city:k}}async function mW(t,e,n){try{const s=await EN(),{data:l,error:u}=await Kt.rpc("create_user_session",{p_user_id:t,p_wallet_address:e||null,p_email:n||null,p_fingerprint:s.fingerprintHash,p_user_agent:s.userAgent,p_os:s.os,p_browser:s.browser,p_device_type:s.deviceType,p_ip_address:s.ipAddress||null,p_country:s.country||null,p_city:s.city||null,p_session_duration_hours:24});if(u)return console.error("Error creating session:",u),null;const p=l;typeof window<"u"&&(localStorage.setItem(WA,p),localStorage.setItem(hW,Date.now().toString()),sessionStorage.setItem("tripx_full_fingerprint",JSON.stringify(s.fingerprintData)),sessionStorage.setItem("tripx_os_info",JSON.stringify(s.osInfo)),sessionStorage.setItem("tripx_browser_info",JSON.stringify(s.browserInfo)),sessionStorage.setItem("tripx_device_info",JSON.stringify(s.deviceInfo)));try{const r=await Kt.from("user_activity_events").insert({user_id:t,event_type:"session_start",event_data:{session_token:p,fingerprint_hash:s.fingerprintHash,device_type:s.deviceType,os:s.os,browser:s.browser},ip_address:s.ipAddress||null,user_agent:s.userAgent,fingerprint:s.fingerprint,fingerprint_hash:s.fingerprintHash,country:s.country||null,city:s.city||null,device_type:s.deviceType,device_info:s.deviceInfo,os_info:s.osInfo,browser_info:s.browserInfo});r.error?console.warn("Failed to log session activity to user_activity_events:",r.error):console.log("[SessionService] Activity logged to user_activity_events"),await Kt.from("admin_activity_log").insert({user_id:t,action_type:"session_start",action_details:{session_token:p,fingerprint_hash:s.fingerprintHash,device_type:s.deviceType,os:s.os,browser:s.browser},ip_address:s.ipAddress||null,user_agent:s.userAgent,fingerprint:s.fingerprint,fingerprint_hash:s.fingerprintHash,country:s.country||null,city:s.city||null,device_type:s.deviceType,device_info:s.deviceInfo,os_info:s.osInfo,browser_info:s.browserInfo}).catch(v=>console.warn("Failed to log to admin_activity_log:",v))}catch(r){console.warn("Failed to log activity:",r)}return p}catch(s){return console.error("Error creating session:",s),null}}async function ZT(t,e,n,s){try{let l=s;l||(l=await EN());const u=typeof window<"u"?localStorage.getItem(WA):null,p=await Kt.rpc("log_user_activity_event",{p_user_id:t,p_event_type:e,p_event_data:n,p_ip_address:l.ipAddress||null,p_user_agent:l.userAgent,p_fingerprint:l.fingerprint,p_fingerprint_hash:l.fingerprintHash,p_country:l.country||null,p_city:l.city||null,p_device_type:l.deviceType,p_device_info:l.deviceInfo,p_os_info:l.osInfo,p_browser_info:l.browserInfo,p_session_id:null});if(p.error){console.log("[SessionService] RPC failed, using direct insert:",p.error);const r=await Kt.from("user_activity_events").insert({user_id:t,event_type:e,event_data:n,ip_address:l.ipAddress||null,user_agent:l.userAgent,fingerprint:l.fingerprint,fingerprint_hash:l.fingerprintHash,country:l.country||null,city:l.city||null,device_type:l.deviceType,device_info:l.deviceInfo,os_info:l.osInfo,browser_info:l.browserInfo});r.error?console.error("[SessionService] Direct insert also failed:",r.error):console.log("[SessionService] Activity logged successfully via direct insert"),await Kt.from("admin_activity_log").insert({user_id:t,action_type:e,action_details:n,ip_address:l.ipAddress||null,user_agent:l.userAgent,fingerprint:l.fingerprint,fingerprint_hash:l.fingerprintHash,country:l.country||null,city:l.city||null,device_type:l.deviceType,device_info:l.deviceInfo,os_info:l.osInfo,browser_info:l.browserInfo}).catch(v=>console.warn("Failed to log to admin_activity_log:",v))}else console.log("[SessionService] Activity logged successfully via RPC")}catch(l){console.warn("Failed to log activity:",l)}}async function OE(t="logout"){if(typeof window>"u")return;const e=localStorage.getItem(WA);if(e)try{await Kt.rpc("delete_session",{p_session_token:e,p_end_reason:t})}catch(n){console.error("Error deleting session:",n)}Q1()}function Q1(){typeof window<"u"&&(localStorage.removeItem(WA),localStorage.removeItem(hW))}function AN(){if(typeof window>"u")return()=>{};const t=()=>{typeof window<"u"&&sessionStorage.setItem("tripx_session_closing","true")},e=()=>{document.hidden&&typeof window<"u"&&sessionStorage.setItem("tripx_session_closing","true")};return window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",e)}}const l_e=Object.freeze(Object.defineProperty({__proto__:null,clearSession:Q1,collectSessionData:EN,createSession:mW,deleteSession:OE,getIPAddress:fW,getLocationFromIP:pW,logActivity:ZT,setupSessionCleanup:AN},Symbol.toStringTag,{value:"Module"}));function ba(){const{address:t,isConnected:e}=qc(),[n,s]=he.useState(null),[l,u]=he.useState(0),[p,r]=he.useState(!1);he.useEffect(()=>AN(),[]),he.useEffect(()=>{(async()=>{typeof window<"u"&&sessionStorage.removeItem("tripx_session_closing");const{data:{session:k}}=await Kt.auth.getSession();console.log("[WalletAuth] Existing Supabase session:",k?"Active":"None"),k&&console.log("[WalletAuth] Session preserved from previous load")})()},[]);const[v,w]=he.useState(!1);he.useEffect(()=>{var O,F;if(v&&(!e||!t)){console.log("[WalletAuth] Wallet disconnected - performing full cleanup"),s(null),u(0),Q1(),w0(),Kt.auth.signOut().catch(U=>{console.warn("[WalletAuth] Error signing out on disconnect:",U)}),w(!1);return}if(e&&t&&w(!0),n&&((O=n.wallet_address)==null?void 0:O.toLowerCase())===t.toLowerCase()&&!p){console.log("[WalletAuth] User already loaded for this address, skipping");return}(!n||((F=n.wallet_address)==null?void 0:F.toLowerCase())!==t.toLowerCase())&&(console.log("[WalletAuth] New wallet address detected or user mismatch:",t),s(null),u(0)),(async()=>{var U,X,W;r(!0);try{const K=typeof window<"u"?navigator.userAgent:null;console.log("[WalletAuth] Loading user profile for wallet:",t);const ne=await rW(t);if(!ne){console.error("[WalletAuth] Failed to load user profile"),r(!1);return}if(console.log("[WalletAuth] User profile loaded:",{id:ne.id,wallet:ne.wallet_address,xp:ne.total_xp,quests:ne.quests_completed}),ne.id){const{error:ye}=await Kt.rpc("update_user_login_tracking",{p_user_id:ne.id,p_login_ip:null,p_user_agent:K});ye&&console.warn("Error updating login tracking:",ye)}console.log("[WalletAuth] Creating Supabase auth session...");const te=`${t.toLowerCase()}@wallet.tripx.local`,re=`tripx_${t.toLowerCase()}_2025`;let{data:xe,error:ae}=await Kt.auth.signInWithPassword({email:te,password:re});if(ae&&((U=ae.message)!=null&&U.includes("Invalid login credentials"))){console.log("[WalletAuth] Creating new auth user for wallet...");const{data:ye,error:Ce}=await Kt.auth.signUp({email:te,password:re,options:{data:{wallet_address:t.toLowerCase(),user_id:ne.id},emailRedirectTo:void 0}});Ce?console.error("[WalletAuth] Auth signup failed:",Ce):(xe=ye,console.log("[WalletAuth] Auth user created:",(X=ye.session)==null?void 0:X.user.id))}else ae?console.error("[WalletAuth] Auth signin failed:",ae):console.log("[WalletAuth] Auth session restored:",(W=xe.session)==null?void 0:W.user.id);s(ne),ne.id&&t&&(console.log("[WalletAuth] Creating session with tracking..."),await mW(ne.id,t.toLowerCase(),ne.email||void 0)),w0();const ce=await Tx(t);u(ce),console.log("[WalletAuth] TPX Balance loaded:",ce)}catch(K){console.error("Error loading user data:",K)}finally{r(!1)}})();const k=setInterval(async()=>{if(t){w0();const U=await Tx(t);u(U)}},3e4),R=async U=>{var X;if(console.log("[WalletAuth] Balance update event received:",U.detail),t&&((X=U.detail.walletAddress)==null?void 0:X.toLowerCase())===t.toLowerCase()){console.log("[WalletAuth] Refreshing TPX balance..."),w0();const W=await Tx(t);u(W),console.log("[WalletAuth] TPX balance updated:",W)}},D=async U=>{var X;if(console.log("[WalletAuth] User data update event received:",U.detail),t&&((X=U.detail.walletAddress)==null?void 0:X.toLowerCase())===t.toLowerCase()){console.log("[WalletAuth] Refreshing user data (XP, level)...");try{const{getOrCreateUser:W}=await hr(async()=>{const{getOrCreateUser:ne}=await Promise.resolve().then(()=>Zxe);return{getOrCreateUser:ne}},void 0),K=await W(t);K&&(s(K),console.log("[WalletAuth] User data updated:",{xp:K.total_xp,level:K.level,quests:K.quests_completed}))}catch(W){console.error("[WalletAuth] Error refreshing user data:",W)}}};return window.addEventListener("tpxBalanceUpdated",R),window.addEventListener("userDataUpdated",D),()=>{clearInterval(k),window.removeEventListener("tpxBalanceUpdated",R),window.removeEventListener("userDataUpdated",D)}},[t,e]);const E=he.useCallback(async()=>{try{console.log("[WalletAuth] Signing out..."),s(null),u(0),Q1(),w0(),OE("logout").catch(T=>{console.warn("[WalletAuth] Error deleting session (continuing):",T)}),Kt.auth.signOut().then(({error:T})=>{T?console.warn("[WalletAuth] Error signing out from Supabase:",T):console.log("[WalletAuth] Supabase session cleared")}).catch(T=>{console.warn("[WalletAuth] Exception during Supabase signOut:",T)}),console.log("[WalletAuth] Signed out successfully (local state cleared)")}catch(T){console.error("[WalletAuth] Error signing out:",T),s(null),u(0),Q1(),w0()}},[]);return{user:n,tpxBalance:l,loading:p,isConnected:e,address:t,signOut:E}}function El(){const[t,e]=he.useState(null),[n,s]=he.useState(0),[l,u]=he.useState(!1),[p,r]=he.useState(null);he.useEffect(()=>AN(),[]),he.useEffect(()=>{(async()=>{typeof window<"u"&&sessionStorage.removeItem("tripx_session_closing");const{data:{session:T}}=await Kt.auth.getSession();console.log("[EmailAuth] Existing Supabase session:",T?"Active":"None"),T&&console.log("[EmailAuth] Session preserved from previous load")})()},[]),he.useEffect(()=>{Kt.auth.getSession().then(({data:{session:T}})=>{var k,R;if((R=(k=T==null?void 0:T.user)==null?void 0:k.email)!=null&&R.endsWith("@wallet.tripx.local")){console.log("[EmailAuth] Ignoring wallet user session on mount");return}T&&(console.log("[EmailAuth] Email user session found on mount"),r(T.user),v(T.user))});const{data:{subscription:E}}=Kt.auth.onAuthStateChange(async(T,k)=>{var R,D,O,F;if(console.log("[EmailAuth] Auth state changed:",T,"user:",(R=k==null?void 0:k.user)==null?void 0:R.email),(O=(D=k==null?void 0:k.user)==null?void 0:D.email)!=null&&O.endsWith("@wallet.tripx.local")){console.log("[EmailAuth] Ignoring wallet user session");return}k!=null&&k.user?(console.log("[EmailAuth] Email user session detected - loading user data"),r(k.user),await v(k.user)):p&&!((F=p.email)!=null&&F.endsWith("@wallet.tripx.local"))&&(console.log("[EmailAuth] Email user logged out - clearing all data"),await OE("logout"),r(null),e(null),s(0))});return()=>E.unsubscribe()},[]);const v=async E=>{if(E){u(!0);try{const T=typeof window<"u"?navigator.userAgent:null,{data:k,error:R}=await Kt.rpc("get_or_create_user_by_email",{user_email:E.email,auth_uuid:E.id});if(R){console.error("Error getting user:",R);const{data:D}=await Kt.from("users").select("*").eq("email",E.email).maybeSingle();if(D){const{error:O}=await Kt.rpc("update_user_login_tracking",{p_user_id:D.id,p_login_ip:null,p_user_agent:T});O&&console.warn("Error updating login tracking:",O),e(D)}return}if(k){const{error:D}=await Kt.rpc("update_user_login_tracking",{p_user_id:k.id,p_login_ip:null,p_user_agent:T});D&&console.warn("Error updating login tracking:",D),e(k);const O=await Tx(k.wallet_address||k.email||"");s(O);const F=async X=>{if(console.log("[EmailAuth] Balance update event received:",X.detail),k.id===X.detail.userId){console.log("[EmailAuth] Refreshing TPX balance...");const{clearTPXBalanceCache:W}=await hr(async()=>{const{clearTPXBalanceCache:ne}=await Promise.resolve().then(()=>e_e);return{clearTPXBalanceCache:ne}},void 0);W();const K=await Tx(k.wallet_address||k.email||"");s(K),console.log("[EmailAuth] TPX balance updated:",K)}},U=async X=>{if(console.log("[EmailAuth] User data update event received:",X.detail),k.id===X.detail.userId){console.log("[EmailAuth] Refreshing user data (XP, level)...");try{const{data:W,error:K}=await Kt.from("users").select("*").eq("id",k.id).single();K?console.error("[EmailAuth] Error fetching updated user data:",K):W&&(e(W),console.log("[EmailAuth] User data updated:",{xp:W.total_xp,level:W.level,quests:W.quests_completed}))}catch(W){console.error("[EmailAuth] Error refreshing user data:",W)}}};return window.addEventListener("tpxBalanceUpdated",F),window.addEventListener("userDataUpdated",U),()=>{window.removeEventListener("tpxBalanceUpdated",F),window.removeEventListener("userDataUpdated",U)}}}catch(T){console.error("Error loading user data:",T)}finally{u(!1)}}},w=()=>{console.log("[EmailAuth] Signing out..."),e(null),r(null),s(0),hr(async()=>{const{clearSession:E}=await Promise.resolve().then(()=>l_e);return{clearSession:E}},void 0).then(({clearSession:E})=>{E()}),OE("logout").catch(E=>{console.warn("[EmailAuth] Error deleting session:",E)}),Kt.auth.signOut().then(({error:E})=>{E?console.error("[EmailAuth] Error signing out from Supabase:",E):console.log("[EmailAuth] Signed out successfully")}).catch(E=>{console.error("[EmailAuth] Exception during signOut:",E)})};return{user:t,tpxBalance:n,loading:l,isAuthenticated:!!p,email:(p==null?void 0:p.email)||null,signOut:w}}const lz="0x6819143a95aeed963348b5f1e9c9405999bd1588";function Ap(){const{address:t,user:e,isConnected:n,loading:s}=ba(),[l,u]=he.useState(!1),[p,r]=he.useState(null),[v,w]=he.useState(!0);return he.useEffect(()=>{const E=setTimeout(()=>{w(!1)},500);return()=>clearTimeout(E)},[]),he.useEffect(()=>{if(!v)if(n&&t){const E=t.toLowerCase(),T=lz.toLowerCase();console.log("[useAdminAuth] Checking admin access:",{currentAddress:E,adminAddress:T,match:E===T,isConnected:n,hasUser:!!e}),E===T?(console.log("[useAdminAuth] Admin access granted"),u(!0),r(e)):(u(!1),r(null))}else u(!1),r(null)},[t,n,e,v]),{isAdmin:l,adminUser:p,adminWalletAddress:lz,loading:v||s}}const c_e=[{id:"dashboard",label:"Dashboard",icon:c0e,requiresAuth:!1},{id:"spooky",label:"Spooky Destinations",icon:f0e,requiresAuth:!1},{id:"transit",label:"Transit",icon:Nw,requiresAuth:!1},{id:"create",label:"Create Trip",icon:Ho,requiresAuth:!1},{id:"trips",label:"My Trips",icon:a0e,requiresAuth:!0},{id:"quests",label:"My Quests",icon:VA,requiresAuth:!0},{id:"profile",label:"Profile",icon:GT,requiresAuth:!0},{id:"leaderboard",label:"Leaderboard",icon:Ja,requiresAuth:!1},{id:"achievements",label:"Achievements",icon:Vl,requiresAuth:!1}],u_e=({currentPage:t,onNavigate:e})=>{const{isConnected:n}=ba(),{isAuthenticated:s}=El(),{isAdmin:l,loading:u}=Ap(),p=n||s;let r=c_e.filter(E=>!E.requiresAuth||p);!u&&l&&(r=[...r,{id:"admin",label:"Admin Panel",icon:Hx,requiresAuth:!0}]);const v=he.useRef(null),w=he.useRef(null);return he.useEffect(()=>{v.current&&(v.current.style.setProperty("background-color","rgba(0, 0, 0, 0.03)","important"),v.current.style.setProperty("backdrop-filter","blur(2px)","important"),v.current.style.setProperty("-webkit-backdrop-filter","blur(2px)","important"),v.current.style.setProperty("border-radius","0","important")),w.current&&(w.current.style.setProperty("background-color","rgba(0, 0, 0, 0.03)","important"),w.current.style.setProperty("backdrop-filter","blur(2px)","important"),w.current.style.setProperty("-webkit-backdrop-filter","blur(2px)","important"),w.current.style.setProperty("border-radius","0","important"))},[]),f.jsxs(f.Fragment,{children:[f.jsxs(it.aside,{ref:v,initial:{x:-300,opacity:0},animate:{x:0,opacity:1},transition:{duration:.6,ease:[.22,1,.36,1]},className:"fixed left-0 top-0 h-screen w-64 backdrop-blur-[2px] border-r-0 hidden lg:flex flex-col z-40 shadow-none overflow-hidden",children:[f.jsx(it.div,{animate:{opacity:[.05,.15,.05],y:[-200,200,-200]},transition:{duration:25,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-to-b from-white/[0.08] via-transparent to-white/[0.04] pointer-events-none"}),f.jsx("div",{className:"relative p-6 border-b-0",children:f.jsxs(it.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative group",children:[f.jsx(it.div,{animate:{opacity:[.15,.3,.15],scale:[1,1.15,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"},className:"absolute -inset-8 rounded-full pointer-events-none",style:{background:"radial-gradient(circle, rgba(255,250,220,0.3) 0%, rgba(255,200,100,0.15) 30%, rgba(255,150,50,0.05) 60%, transparent 80%)",filter:"blur(20px)"}}),f.jsx(it.div,{animate:{opacity:[.3,.5,.3],scale:[1,1.1,1]},transition:{duration:4,repeat:1/0,ease:"easeInOut",delay:.5},className:"absolute -inset-5 rounded-full pointer-events-none",style:{background:"radial-gradient(circle, rgba(255,255,240,0.5) 0%, rgba(255,220,150,0.3) 40%, rgba(255,180,100,0.1) 70%, transparent 90%)",filter:"blur(12px)"}}),f.jsx(it.div,{animate:{opacity:[.5,.8,.5],scale:[1,1.05,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute -inset-3 rounded-xl pointer-events-none",style:{background:"radial-gradient(circle, rgba(255,255,255,0.7) 0%, rgba(255,240,200,0.4) 50%, transparent 80%)",filter:"blur(8px)"}}),f.jsx(it.div,{animate:{opacity:[.2,.4,.2],rotate:[0,180,360]},transition:{opacity:{duration:5,repeat:1/0,ease:"easeInOut"},rotate:{duration:30,repeat:1/0,ease:"linear"}},className:"absolute -inset-6 pointer-events-none",style:{background:"conic-gradient(from 0deg, transparent 0%, rgba(255,250,220,0.15) 10%, transparent 20%, rgba(255,250,220,0.1) 30%, transparent 40%, rgba(255,250,220,0.15) 50%, transparent 60%, rgba(255,250,220,0.1) 70%, transparent 80%, rgba(255,250,220,0.15) 90%, transparent 100%)",filter:"blur(6px)"}}),f.jsx(it.div,{whileHover:{rotate:[0,-10,10,-10,10,0],scale:1.1,boxShadow:"0 0 50px rgba(255, 250, 220, 0.6), 0 0 80px rgba(255, 200, 100, 0.3)"},whileTap:{scale:.95},transition:{rotate:{duration:.5,ease:"easeInOut"},scale:{duration:.3,ease:[.22,1,.36,1]},boxShadow:{duration:.3}},className:"w-12 h-12 bg-gradient-to-br from-white via-yellow-50 to-amber-50 rounded-xl flex items-center justify-center cursor-pointer relative z-10",style:{boxShadow:"0 0 30px rgba(255, 250, 220, 0.4), 0 0 60px rgba(255, 200, 100, 0.2), 0 8px 32px rgba(0,0,0,0.3)"},children:f.jsx(md,{className:"w-7 h-7 text-amber-900",fill:"currentColor"})})]}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"TripX"}),f.jsx("p",{className:"text-xs text-white/90 font-medium",style:{textShadow:"0 1px 5px rgba(0,0,0,0.5)"},children:"Travel. Earn. Explore."})]})]})}),f.jsx("nav",{className:"relative flex-1 p-4 space-y-1",style:{backgroundColor:"transparent"},children:r.map((E,T)=>{const k=E.icon,R=t===E.id;return f.jsxs(it.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+T*.05},whileHover:{x:4},onClick:()=>e(E.id),className:`w-full group relative overflow-hidden rounded-xl transition-all duration-300 ${R?"text-white":"text-white/90 hover:text-white"}`,style:{textShadow:"0 1px 3px rgba(0,0,0,0.5)",backdropFilter:R?"blur(5px)":"blur(2px)",backgroundColor:R?"rgba(255, 255, 255, 0.03)":"transparent"},children:[R&&f.jsx(it.div,{layoutId:"activeTab",className:"absolute inset-0 rounded-xl border border-white/[0.06]",style:{backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.03)",boxShadow:"0 2px 8px rgba(255, 255, 255, 0.03), inset 0 1px 0 rgba(255, 255, 255, 0.06)"},transition:{type:"spring",bounce:.2,duration:.6}}),f.jsxs("div",{className:"relative flex items-center gap-3 px-4 py-3.5",children:[f.jsx(it.div,{animate:R?{scale:[1,1.2,1]}:{},transition:{duration:.3},children:f.jsx(k,{className:`w-5 h-5 transition-all duration-300 ${R?"text-white":"text-white/90 group-hover:text-white group-hover:scale-110"}`})}),E.id==="spooky"?f.jsx(it.span,{className:"font-medium font-spooky",animate:{textShadow:["none","0 0 8px rgba(250, 103, 1, 0.6)","none","0 0 8px rgba(250, 103, 1, 0.6)","0 0 8px rgba(250, 103, 1, 0.6), 0 0 16px rgba(250, 103, 1, 0.4), 0 0 20px rgba(255, 0, 84, 0.2)","0 0 8px rgba(250, 103, 1, 0.6), 0 0 16px rgba(250, 103, 1, 0.4), 0 0 20px rgba(255, 0, 84, 0.2)"],color:["#ffffff","#fa6701","#ffffff","#fa6701","#fa6701","#fa6701"]},transition:{duration:4,repeat:1/0,ease:"linear",times:[0,.03,.06,.09,.6,1]},children:E.label}):f.jsx("span",{className:"font-medium",children:E.label}),R&&f.jsx(it.div,{initial:{scale:0},animate:{scale:1},className:"absolute right-4 w-2 h-2 bg-white rounded-full shadow-lg shadow-white/50"})]})]},E.id)})})]}),f.jsx(it.div,{ref:w,initial:{y:100,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,ease:[.22,1,.36,1]},className:"lg:hidden fixed bottom-0 left-0 right-0 backdrop-blur-[2px] border-t-0 z-50 shadow-none",children:f.jsx("div",{className:"flex items-center justify-around px-4 py-4",children:r.slice(0,5).map(E=>{const T=E.icon,k=t===E.id;return f.jsxs(it.button,{whileTap:{scale:.9},onClick:()=>e(E.id),className:`flex flex-col items-center gap-1 transition-all duration-300 relative ${k?"text-white":"text-white/50"}`,children:[f.jsxs("div",{className:"relative",children:[f.jsx(T,{className:"w-6 h-6"}),k&&f.jsx(it.div,{layoutId:"mobileActive",className:"absolute -inset-2 bg-white/10 rounded-xl -z-10",transition:{type:"spring",bounce:.2,duration:.6}})]}),f.jsx("span",{className:"text-xs font-medium",children:E.label.split(" ")[0]})]},E.id)})})})]})};async function bb(t,e,n,s="info",l,u,p){try{const{data:r,error:v}=await Kt.rpc("create_notification",{p_user_id:t,p_title:e,p_message:n,p_type:s,p_action_url:l||null,p_metadata:u||{},p_expires_in_hours:p||null});return v?(console.error("Error creating notification:",v),null):(console.log("Notification created:",r),window.dispatchEvent(new CustomEvent("notificationCreated",{detail:{notificationId:r,userId:t}})),r)}catch(r){return console.error("Exception creating notification:",r),null}}async function gW(t,e=!0){try{let n=Kt.from("notifications").select("*").eq("user_id",t).order("created_at",{ascending:!1});e||(n=n.eq("read",!1));const{data:s,error:l}=await n;if(l)return console.error("Error fetching notifications:",l),[];const u=new Date;return(s||[]).filter(p=>!p.expires_at||new Date(p.expires_at)>u)}catch(n){return console.error("Exception fetching notifications:",n),[]}}async function yW(t){try{const{data:e,error:n}=await Kt.rpc("get_unread_notification_count",{p_user_id:t});return n?(console.error("Error fetching unread count:",n),0):e||0}catch(e){return console.error("Exception fetching unread count:",e),0}}async function xW(t){try{await Kt.rpc("mark_notification_read",{p_notification_id:t}),window.dispatchEvent(new CustomEvent("notificationRead",{detail:{notificationId:t}}))}catch(e){console.error("Error marking notification as read:",e)}}async function _W(t){try{await Kt.rpc("mark_all_notifications_read",{p_user_id:t}),window.dispatchEvent(new CustomEvent("allNotificationsRead",{detail:{userId:t}}))}catch(e){console.error("Error marking all notifications as read:",e)}}async function vW(t){try{await Kt.from("notifications").delete().eq("id",t),window.dispatchEvent(new CustomEvent("notificationDeleted",{detail:{notificationId:t}}))}catch(e){console.error("Error deleting notification:",e)}}async function Ex(t,e,n,s){await bb(t,"Quest Completed!",`You completed "${e}" and earned ${n} XP and ${s} TPX!`,"quest","/quests",{questTitle:e,rewardXP:n,rewardTokens:s},48)}async function d_e(t,e,n){await bb(t,"Trip Created!",`Your trip to ${e} has been created with ${n} quests to complete.`,"trip","/trips",{destination:e,questsCount:n},24)}async function h_e(t,e,n,s){await bb(t,"Achievement Unlocked!",`You unlocked "${e}"! Reward: ${n} XP and ${s} TPX.`,"achievement","/achievements",{achievementTitle:e,rewardXP:n,rewardTokens:s},72)}async function Ax(t,e,n){await bb(t,"TPX Tokens Claimed!",`Successfully claimed ${e} TPX tokens.`,"token",void 0,{amount:e,txHash:n},72)}async function rb(t,e,n,s){const l=e==="passport"?"NFT Passport Minted!":"Achievement NFT Minted!",u=e==="passport"?`Your NFT Passport #${n} has been minted!`:`Achievement NFT #${n} has been minted!`;await bb(t,l,u,"nft","/profile",{nftType:e,tokenId:n,txHash:s},72)}const CN=Object.freeze(Object.defineProperty({__proto__:null,createNotification:bb,deleteNotification:vW,getUnreadNotificationCount:yW,getUserNotifications:gW,markAllNotificationsAsRead:_W,markNotificationAsRead:xW,notifyAchievementUnlocked:h_e,notifyNFTMinted:rb,notifyQuestCompleted:Ex,notifyTokensClaimed:Ax,notifyTripCreated:d_e},Symbol.toStringTag,{value:"Module"}));function f_e(t){const[e,n]=he.useState([]),[s,l]=he.useState(0),[u,p]=he.useState(!1),r=he.useCallback(async()=>{if(!t){n([]),l(0);return}p(!0);try{const[T,k]=await Promise.all([gW(t,!0),yW(t)]);n(T),l(k)}catch(T){console.error("Error loading notifications:",T)}finally{p(!1)}},[t]);he.useEffect(()=>{r()},[r]),he.useEffect(()=>{if(!t)return;const T=O=>{O.detail.userId===t&&(console.log("New notification created, reloading..."),r())},k=()=>{console.log("Notification marked as read, reloading..."),r()},R=O=>{O.detail.userId===t&&(console.log("All notifications marked as read, reloading..."),r())},D=()=>{console.log("Notification deleted, reloading..."),r()};return window.addEventListener("notificationCreated",T),window.addEventListener("notificationRead",k),window.addEventListener("allNotificationsRead",R),window.addEventListener("notificationDeleted",D),()=>{window.removeEventListener("notificationCreated",T),window.removeEventListener("notificationRead",k),window.removeEventListener("allNotificationsRead",R),window.removeEventListener("notificationDeleted",D)}},[t,r]),he.useEffect(()=>{if(!t)return;const T=setInterval(()=>{r()},3e4);return()=>clearInterval(T)},[t,r]);const v=he.useCallback(async T=>{await xW(T)},[]),w=he.useCallback(async()=>{t&&await _W(t)},[t]),E=he.useCallback(async T=>{await vW(T)},[]);return{notifications:e,unreadCount:s,loading:u,refresh:r,markAsRead:v,markAllAsRead:w,deleteNotif:E}}const bW=({isOpen:t,onClose:e})=>{const[n,s]=he.useState(!1),[l,u]=he.useState(null),p=async()=>{s(!0),u(null);try{const{error:r}=await Kt.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}`,queryParams:{access_type:"offline",prompt:"consent"}}});if(r)throw r}catch(r){u(r.message||"Failed to sign in with Google"),s(!1)}};return t?f.jsx(Xc,{children:t&&f.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},onClick:e,className:"absolute inset-0 bg-black/70 backdrop-blur-md"}),f.jsxs(it.div,{initial:{opacity:0,scale:.8,y:40},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:40},transition:{type:"spring",damping:25,stiffness:300,duration:.4},onClick:r=>r.stopPropagation(),className:"relative w-full max-w-sm rounded-2xl p-8 shadow-2xl",style:{background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[f.jsx(it.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:r=>{r.preventDefault(),r.stopPropagation(),e()},className:"absolute -top-2 -right-2 w-10 h-10 rounded-full bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-2xl font-bold flex items-center justify-center transition-all cursor-pointer shadow-xl border-2 border-white/20 z-[10000]",type:"button",style:{lineHeight:"1"},title:"Close",children:""}),f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Sign In"}),f.jsx("p",{className:"text-slate-400 text-sm",children:"Sign in with your Gmail account"})]}),l&&f.jsx(it.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:l}),f.jsx(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:p,disabled:n,className:"w-full px-6 py-4 rounded-xl text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:n?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-5 h-5 animate-spin"}),f.jsx("span",{children:"Connecting..."})]}):f.jsxs(f.Fragment,{children:[f.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:[f.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),f.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),f.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),f.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),f.jsx("span",{children:"Sign in with Gmail"})]})})]})]})}):null},p_e=({onNavigate:t})=>{const e=ba(),{user:n,tpxBalance:s,isConnected:l,signOut:u}=e,{user:p,tpxBalance:r,signOut:v,isAuthenticated:w}=El(),{isAdmin:E}=Ap(),{disconnect:T}=EA(),k=n||p,R=s||r||0,[D,O]=he.useState(!1),[F,U]=he.useState(!1),X=he.useRef(null),{notifications:W,unreadCount:K,markAsRead:ne,markAllAsRead:te,deleteNotif:re}=f_e(k==null?void 0:k.id),xe=(k==null?void 0:k.total_xp)||0,ae=Math.floor(Math.sqrt(xe/100))+1,ce={tokens:R,xp:xe,level:ae};return he.useEffect(()=>{X.current&&(X.current.style.setProperty("background-color","rgba(0, 0, 0, 0.03)","important"),X.current.style.setProperty("backdrop-filter","blur(2px)","important"),X.current.style.setProperty("-webkit-backdrop-filter","blur(2px)","important"),X.current.style.setProperty("border-radius","0","important"))},[]),f.jsxs(it.header,{ref:X,initial:{y:-100,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,ease:[.22,1,.36,1]},className:"sticky top-0 z-30 backdrop-blur-[2px] border-b-0 relative overflow-visible shadow-none",children:[f.jsx(it.div,{animate:{opacity:[.05,.15,.05],x:[-200,200,-200]},transition:{duration:20,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-to-r from-white/[0.08] via-transparent to-white/[0.08] pointer-events-none"}),f.jsx("div",{className:"relative px-4 md:px-8 py-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("div",{className:"flex items-center gap-4",children:l&&f.jsx(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"hidden md:block",children:f.jsxs("div",{className:"backdrop-blur-xl rounded-2xl px-6 py-3 border border-white/10 flex items-center gap-4 shadow-[0_8px_32px_rgba(0,0,0,0.2)]",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl flex items-center justify-center shadow-lg",children:f.jsx(Ya,{className:"w-6 h-6 text-black"})}),f.jsx("div",{className:"absolute -inset-1 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl blur opacity-20"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-white/90 font-medium",style:{textShadow:"0 1px 3px rgba(0,0,0,0.5)"},children:"TPX Balance"}),f.jsx("p",{className:"text-xl font-bold text-white",style:{textShadow:"0 2px 8px rgba(0,0,0,0.5)"},children:ce.tokens.toFixed(0)})]})]}),f.jsx("div",{className:"w-px h-10 bg-white/10"}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-white to-white/80 rounded-xl flex items-center justify-center shadow-lg",children:f.jsx(sg,{className:"w-6 h-6 text-black"})}),f.jsx("div",{className:"absolute -inset-1 bg-white rounded-xl blur opacity-20"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-white/90 font-medium",style:{textShadow:"0 1px 3px rgba(0,0,0,0.5)"},children:"Total XP"}),f.jsx("p",{className:"text-xl font-bold text-white",style:{textShadow:"0 2px 8px rgba(0,0,0,0.5)"},children:ce.xp.toLocaleString()})]})]}),f.jsx("div",{className:"w-px h-10 bg-white/10"}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"relative",children:f.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-white/20 to-white/10 rounded-xl flex items-center justify-center shadow-lg border border-white/20",children:f.jsx(Vl,{className:"w-6 h-6 text-white"})})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-white/90 font-medium",style:{textShadow:"0 1px 3px rgba(0,0,0,0.5)"},children:"Level"}),f.jsx("p",{className:"text-xl font-bold text-white",style:{textShadow:"0 2px 8px rgba(0,0,0,0.5)"},children:ce.level})]})]})]})})}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative",children:[f.jsxs(it.button,{whileHover:{scale:1.05,rotate:[0,-10,10,0]},whileTap:{scale:.95},onClick:()=>O(!D),className:"relative p-3 rounded-xl backdrop-blur-xl border border-white/10 transition-all duration-300",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[f.jsx(SB,{className:"w-5 h-5 text-white"}),K>0&&f.jsx(it.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 bg-gradient-to-br from-red-500 to-red-600 rounded-full shadow-lg shadow-red-400/50 flex items-center justify-center",children:f.jsx("span",{className:"text-[10px] font-bold text-white",children:K>99?"99+":K})})]}),f.jsx(Xc,{children:D&&f.jsxs(it.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:"absolute right-0 top-full mt-2 w-96 rounded-2xl backdrop-blur-xl border border-white/[0.08] shadow-2xl z-[100] overflow-hidden",style:{backdropFilter:"blur(12px)",backgroundColor:"rgba(0, 0, 0, 0.3)"},children:[f.jsxs("div",{className:"p-4 border-b border-white/[0.05] flex items-center justify-between",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Powiadomienia",K>0&&f.jsxs("span",{className:"ml-2 text-sm text-cyan-400",children:["(",K,")"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[K>0&&f.jsx("button",{onClick:ye=>{ye.stopPropagation(),te()},className:"p-1.5 rounded-lg hover:bg-green-500/20 transition-colors group",title:"Oznacz wszystkie jako przeczytane",children:f.jsx(uN,{className:"w-4 h-4 text-green-400 group-hover:text-green-300"})}),f.jsx("button",{onClick:()=>O(!1),className:"p-1.5 rounded-lg hover:bg-slate-800/50 transition-colors",children:f.jsx(Qa,{className:"w-4 h-4 text-slate-400"})})]})]}),f.jsx("div",{className:"max-h-96 overflow-y-auto",children:W.length>0?W.map((ye,Ce)=>f.jsx(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Ce*.05},className:`p-4 border-b border-white/[0.03] hover:bg-white/[0.05] transition-colors cursor-pointer group relative ${ye.read?"":"bg-white/[0.03]"}`,onClick:()=>{if(ye.read||ne(ye.id),ye.action_url&&t){const Me=ye.action_url.replace("/","");t(Me),O(!1)}},children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${ye.type==="success"||ye.type==="quest"||ye.type==="achievement"?"bg-green-400":ye.type==="warning"?"bg-yellow-400":ye.type==="error"?"bg-red-400":ye.type==="transaction"||ye.type==="token"?"bg-amber-400":ye.type==="nft"?"bg-purple-400":ye.type==="trip"?"bg-blue-400":"bg-cyan-400"}`}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-sm font-semibold text-white mb-1",children:ye.title}),f.jsx("p",{className:"text-xs text-slate-400 line-clamp-2",children:ye.message}),f.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:new Date(ye.created_at).toLocaleDateString("pl-PL",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]}),f.jsx("button",{onClick:Me=>{Me.stopPropagation(),re(ye.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-red-500/20 transition-all",title:"Usu powiadomienie",children:f.jsx(E2,{className:"w-3.5 h-3.5 text-red-400"})})]})},ye.id)):f.jsxs("div",{className:"p-8 text-center",children:[f.jsx(SB,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),f.jsx("p",{className:"text-slate-400 text-sm",children:"Brak powiadomie"})]})})]})})]}),E&&f.jsxs(it.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{t&&t("admin")},className:"px-3 py-2 rounded-xl backdrop-blur-xl border border-cyan-500/30 text-cyan-400 text-sm font-medium cursor-pointer transition-all duration-300 flex items-center gap-2",style:{backgroundColor:"rgba(6, 182, 212, 0.1)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},title:"Admin Panel",children:[f.jsx(Hx,{className:"w-4 h-4"}),f.jsx("span",{className:"hidden md:inline",children:"Admin"})]}),f.jsx(FR.Custom,{children:({account:ye,chain:Ce,openAccountModal:Me,openChainModal:Ke,openConnectModal:ke,mounted:je})=>{const $e=je,Ae=$e&&ye&&Ce;return f.jsx("div",{...!$e&&{"aria-hidden":!0,style:{opacity:0,pointerEvents:"none",userSelect:"none"}},children:Ae?f.jsxs("div",{className:"flex gap-2 items-center",children:[!l&&f.jsxs(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>U(!0),className:"px-4 py-2 rounded-xl backdrop-blur-xl border border-white/10 text-white text-sm font-medium cursor-pointer transition-all duration-300 flex items-center gap-2",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[f.jsx(NM,{className:"w-4 h-4"}),"Sign In"]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:Me,className:"px-4 py-2 rounded-xl backdrop-blur-xl border border-white/10 text-white text-sm font-medium cursor-pointer transition-all duration-300 flex items-center gap-2",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[ye.displayName,ye.displayBalance?` (${ye.displayBalance})`:""]}),f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:async()=>{console.log("[Header] LOGOUT CLICKED"),Object.keys(localStorage).forEach(He=>{(He.startsWith("wagmi.")||He.startsWith("wc@")||He.startsWith("walletconnect"))&&localStorage.removeItem(He)}),sessionStorage.clear(),u&&await u(),T(),console.log("[Header] LOGOUT COMPLETE - state cleared, wallet disconnected"),setTimeout(()=>{window.location.reload()},300)},className:"p-2 rounded-xl backdrop-blur-xl border border-red-500/30 text-red-400 hover:text-red-300 hover:border-red-500/50 transition-all duration-300 flex items-center justify-center",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},title:"Disconnect Wallet",children:f.jsx(CB,{className:"w-4 h-4"})})]})]}):f.jsx(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:ke,className:"px-4 py-2 rounded-xl backdrop-blur-xl border border-white/10 text-white text-sm font-medium cursor-pointer transition-all duration-300",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:"Connect Wallet"})})}}),!l&&!k&&f.jsxs(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>U(!0),className:"px-4 py-2 rounded-xl backdrop-blur-xl border border-white/10 text-white text-sm font-medium cursor-pointer transition-all duration-300 flex items-center gap-2",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[f.jsx(NM,{className:"w-4 h-4"}),"Sign In with Gmail"]}),w&&!l&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs(it.div,{className:"px-4 py-2 rounded-xl backdrop-blur-xl border border-white/10 text-white text-sm font-medium flex items-center gap-2",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:[f.jsx(NM,{className:"w-4 h-4"}),(p==null?void 0:p.email)||"Signed In"]}),f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{console.log("[Header] EMAIL LOGOUT CLICKED"),v()},className:"p-2 rounded-xl backdrop-blur-xl border border-red-500/30 text-red-400 hover:text-red-300 hover:border-red-500/50 transition-all duration-300 flex items-center justify-center",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},title:"Sign Out",children:f.jsx(CB,{className:"w-4 h-4"})})]})]})]})}),f.jsx(bW,{isOpen:F,onClose:()=>U(!1)})]})},m_e=({children:t,currentPage:e,onNavigate:n})=>f.jsxs("div",{className:"min-h-screen bg-transparent relative overflow-hidden",children:[f.jsx(it.div,{animate:{scale:[1,1.2,1],opacity:[.15,.3,.15],x:[0,100,0],y:[0,-50,0]},transition:{duration:12,repeat:1/0,ease:"easeInOut"},className:"fixed top-0 right-0 w-[900px] h-[900px] bg-gradient-to-br from-white/10 via-white/5 to-transparent rounded-full blur-3xl pointer-events-none z-1"}),f.jsx(it.div,{animate:{scale:[1.2,1,1.2],opacity:[.1,.25,.1],x:[0,-80,0],y:[0,60,0]},transition:{duration:15,repeat:1/0,ease:"easeInOut"},className:"fixed bottom-0 left-0 w-[700px] h-[700px] bg-gradient-to-tr from-white/10 via-white/5 to-transparent rounded-full blur-3xl pointer-events-none z-1"}),f.jsx(it.div,{animate:{scale:[1,1.3,1],opacity:[.1,.2,.1],x:[0,-60,0],y:[0,80,0]},transition:{duration:18,repeat:1/0,ease:"easeInOut"},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[1000px] h-[1000px] bg-gradient-to-br from-white/5 via-white/3 to-transparent rounded-full blur-3xl pointer-events-none z-1"}),f.jsx("div",{className:"fixed inset-0 bg-[linear-gradient(rgba(255,255,255,.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,.02)_1px,transparent_1px)] bg-[size:80px_80px] [mask-image:radial-gradient(ellipse_80%_60%_at_50%_50%,#000,transparent)] pointer-events-none z-[2]"}),f.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-slate-900/10 via-transparent to-slate-800/10 backdrop-blur-[0.5px] pointer-events-none z-[3]"}),f.jsxs("div",{className:"relative flex min-h-screen z-10",style:{pointerEvents:"none"},children:[f.jsx("div",{style:{pointerEvents:"auto"},children:f.jsx(u_e,{currentPage:e,onNavigate:n})}),f.jsxs("div",{className:"flex-1 flex flex-col lg:ml-64",style:{pointerEvents:"none"},children:[f.jsx("div",{style:{pointerEvents:"auto"},children:f.jsx(p_e,{onNavigate:n})}),f.jsx(it.main,{initial:{opacity:0,y:20,filter:"blur(10px)"},animate:{opacity:1,y:0,filter:"blur(0px)"},exit:{opacity:0,y:-20,filter:"blur(10px)"},transition:{duration:.6,ease:[.22,1,.36,1]},className:"flex-1 p-4 md:p-8 pb-24 lg:pb-8 relative z-10",style:{backgroundColor:"transparent",pointerEvents:"auto"},children:t},e)]})]})]}),FE={inlineStyles:{glass:{backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",MozBackdropFilter:"blur(12px)",backgroundColor:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.08)"},glassStrong:{backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",MozBackdropFilter:"blur(16px)",backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"}}};async function g_e(t,e=50,n){const{data:s,error:l}=await Kt.from("token_transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(e);l&&console.error("Error fetching token transactions from database:",l);const u=s||[];if(n)try{const{getBlockchainTokenTransactions:p}=await hr(async()=>{const{getBlockchainTokenTransactions:E}=await import("./blockchainTransactionService-CuBcSn_K.js");return{getBlockchainTokenTransactions:E}},[]),r=await p(n,e),v=new Map;for(const E of u)E.tx_hash&&v.set(E.tx_hash.toLowerCase(),E);for(const E of r){const T=E.txHash.toLowerCase();if(!v.has(T)){const k={id:`blockchain_${E.txHash}`,user_id:t,quest_id:null,transaction_type:"reward",amount:E.amount,tx_hash:E.txHash,status:"confirmed",blockchain_confirmed_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():void 0,contract_address:E.contractAddress,from_address:E.from,to_address:E.to,block_number:Number(E.blockNumber),metadata:{source:"blockchain",timestamp:E.timestamp},created_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():new Date().toISOString(),updated_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():new Date().toISOString()};v.set(T,k)}}return Array.from(v.values()).sort((E,T)=>{const k=new Date(E.created_at).getTime();return new Date(T.created_at).getTime()-k}).slice(0,e)}catch(p){return console.error("Error fetching blockchain transactions:",p),u}return u}function hI(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}function y_e(t){return{claim:"Claimed",burn:"Burned",reward:"Reward Earned",transfer:"Transfer"}[t]||t}function x_e(t){return{claim:"green",burn:"red",reward:"cyan",transfer:"purple"}[t]||"gray"}const wW=()=>{const{user:t,address:e}=ba(),{user:n}=El(),s=t||n,[l,u]=he.useState([]),[p,r]=he.useState(!0);he.useEffect(()=>{console.log("[TokenTransactionHistory] User changed:",s==null?void 0:s.id,"address:",e),u([]),r(!0),s!=null&&s.id?(console.log("[TokenTransactionHistory] Loading transactions for user:",s.id),v()):(console.log("[TokenTransactionHistory] No user - clearing transactions"),r(!1))},[s==null?void 0:s.id,e]);const v=async()=>{if(s){r(!0);try{const k=e||s.wallet_address,R=await g_e(s.id,50,k);console.log("[TokenTransactionHistory] Loaded transactions:",R.length),u(R)}catch(k){console.error("Error loading transactions:",k)}finally{r(!1)}}},w=k=>{switch(k){case"claim":return sg;case"burn":return N$;case"reward":return Vl;default:return Vl}},E=k=>{switch(k){case"confirmed":return f.jsx($0,{className:"w-4 h-4 text-green-400"});case"pending":return f.jsx(nh,{className:"w-4 h-4 text-yellow-400"});case"failed":return f.jsx(fN,{className:"w-4 h-4 text-red-400"});default:return null}},T=k=>{const R=new Date(k),O=new Date().getTime()-R.getTime(),F=Math.floor(O/6e4),U=Math.floor(O/36e5),X=Math.floor(O/864e5);return F<1?"Just now":F<60?`${F}m ago`:U<24?`${U}h ago`:X<7?`${X}d ago`:R.toLocaleDateString()};return s?p?f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8",children:f.jsx("div",{className:"flex items-center justify-center",children:f.jsx(va,{className:"w-8 h-8 text-white/40 animate-spin"})})}):l.length===0?f.jsxs("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8 text-center",children:[f.jsx(Vl,{className:"w-12 h-12 text-white/30 mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Transactions Yet"}),f.jsx("p",{className:"text-white/60 text-sm",children:"Complete quests to earn TPX tokens and see your transaction history here"})]}):f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Transaction History"}),f.jsx("div",{className:"space-y-3",children:l.map((k,R)=>{const D=w(k.transaction_type),O=x_e(k.transaction_type),F=k.transaction_type==="claim"||k.transaction_type==="reward";return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.05},className:"rounded-xl backdrop-blur-xl bg-white/5 border border-white/10 p-4 hover:bg-white/8 transition-all",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[f.jsx("div",{className:`w-12 h-12 rounded-full bg-${O}-500/20 border border-${O}-500/30 flex items-center justify-center`,children:f.jsx(D,{className:`w-6 h-6 text-${O}-400`})}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h4",{className:"text-white font-semibold",children:y_e(k.transaction_type)}),E(k.status)]}),f.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/60 flex-wrap",children:[f.jsx("span",{children:T(k.created_at)}),k.blockchain_confirmed_at&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsx("span",{className:"text-xs",children:new Date(k.blockchain_confirmed_at).toLocaleTimeString()})]}),k.tx_hash&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${k.tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-cyan-400 hover:text-cyan-300 transition-colors",title:"View on Etherscan",children:[f.jsxs("span",{className:"text-xs font-mono",children:[k.tx_hash.slice(0,6),"...",k.tx_hash.slice(-4)]}),f.jsx(Jo,{className:"w-3 h-3"})]})]}),e&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsxs("a",{href:`https://sepolia.etherscan.io/address/${e}#tokentxns`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-purple-400 hover:text-purple-300 transition-colors text-xs",title:"View Your Token Transactions",children:["Your Wallet",f.jsx(Jo,{className:"w-3 h-3"})]})]})]})]})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:`text-xl font-bold ${F?"text-green-400":"text-red-400"}`,children:[F?"+":"-",hI(Math.abs(k.amount))]}),f.jsx("div",{className:"text-white/40 text-xs",children:"TPX"})]})]}),k.metadata&&Object.keys(k.metadata).length>0&&f.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:f.jsxs("details",{className:"text-xs text-white/60",children:[f.jsx("summary",{className:"cursor-pointer hover:text-white/80 transition-colors",children:"View Details"}),f.jsx("pre",{className:"mt-2 p-2 rounded bg-black/20 overflow-x-auto",children:JSON.stringify(k.metadata,null,2)})]})})]},k.id)})}),l.length>=50&&f.jsx("p",{className:"text-center text-white/40 text-sm pt-4",children:"Showing latest 50 transactions"})]}):null};function __e(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const v_e=t=>{switch(t){case"success":return S_e;case"info":return E_e;case"warning":return T_e;case"error":return A_e;default:return null}},b_e=Array(12).fill(0),w_e=({visible:t,className:e})=>fe.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},fe.createElement("div",{className:"sonner-spinner"},b_e.map((n,s)=>fe.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),S_e=fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),T_e=fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},fe.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),E_e=fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fe.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),A_e=fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fe.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),C_e=fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},fe.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),fe.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),M_e=()=>{const[t,e]=fe.useState(document.hidden);return fe.useEffect(()=>{const n=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t};let fI=1;class k_e{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const n=this.subscribers.indexOf(e);this.subscribers.splice(n,1)}),this.publish=e=>{this.subscribers.forEach(n=>n(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var n;const{message:s,...l}=e,u=typeof(e==null?void 0:e.id)=="number"||((n=e.id)==null?void 0:n.length)>0?e.id:fI++,p=this.toasts.find(v=>v.id===u),r=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),p?this.toasts=this.toasts.map(v=>v.id===u?(this.publish({...v,...e,id:u,title:s}),{...v,...e,id:u,dismissible:r,title:s}):v):this.addToast({title:s,...l,dismissible:r,id:u}),u},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(n=>n({id:e,dismiss:!0})))):this.toasts.forEach(n=>{this.subscribers.forEach(s=>s({id:n.id,dismiss:!0}))}),e),this.message=(e,n)=>this.create({...n,message:e}),this.error=(e,n)=>this.create({...n,message:e,type:"error"}),this.success=(e,n)=>this.create({...n,type:"success",message:e}),this.info=(e,n)=>this.create({...n,type:"info",message:e}),this.warning=(e,n)=>this.create({...n,type:"warning",message:e}),this.loading=(e,n)=>this.create({...n,type:"loading",message:e}),this.promise=(e,n)=>{if(!n)return;let s;n.loading!==void 0&&(s=this.create({...n,promise:e,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));const l=Promise.resolve(e instanceof Function?e():e);let u=s!==void 0,p;const r=l.then(async w=>{if(p=["resolve",w],fe.isValidElement(w))u=!1,this.create({id:s,type:"default",message:w});else if(P_e(w)&&!w.ok){u=!1;const T=typeof n.error=="function"?await n.error(`HTTP error! status: ${w.status}`):n.error,k=typeof n.description=="function"?await n.description(`HTTP error! status: ${w.status}`):n.description,D=typeof T=="object"&&!fe.isValidElement(T)?T:{message:T};this.create({id:s,type:"error",description:k,...D})}else if(w instanceof Error){u=!1;const T=typeof n.error=="function"?await n.error(w):n.error,k=typeof n.description=="function"?await n.description(w):n.description,D=typeof T=="object"&&!fe.isValidElement(T)?T:{message:T};this.create({id:s,type:"error",description:k,...D})}else if(n.success!==void 0){u=!1;const T=typeof n.success=="function"?await n.success(w):n.success,k=typeof n.description=="function"?await n.description(w):n.description,D=typeof T=="object"&&!fe.isValidElement(T)?T:{message:T};this.create({id:s,type:"success",description:k,...D})}}).catch(async w=>{if(p=["reject",w],n.error!==void 0){u=!1;const E=typeof n.error=="function"?await n.error(w):n.error,T=typeof n.description=="function"?await n.description(w):n.description,R=typeof E=="object"&&!fe.isValidElement(E)?E:{message:E};this.create({id:s,type:"error",description:T,...R})}}).finally(()=>{u&&(this.dismiss(s),s=void 0),n.finally==null||n.finally.call(n)}),v=()=>new Promise((w,E)=>r.then(()=>p[0]==="reject"?E(p[1]):w(p[1])).catch(E));return typeof s!="string"&&typeof s!="number"?{unwrap:v}:Object.assign(s,{unwrap:v})},this.custom=(e,n)=>{const s=(n==null?void 0:n.id)||fI++;return this.create({jsx:e(s),id:s,...n}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const yu=new k_e,I_e=(t,e)=>{const n=(e==null?void 0:e.id)||fI++;return yu.addToast({title:t,...e,id:n}),n},P_e=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",R_e=I_e,N_e=()=>yu.toasts,j_e=()=>yu.getActiveToasts(),dr=Object.assign(R_e,{success:yu.success,info:yu.info,warning:yu.warning,error:yu.error,custom:yu.custom,message:yu.message,promise:yu.promise,dismiss:yu.dismiss,loading:yu.loading},{getHistory:N_e,getToasts:j_e});__e("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function oT(t){return t.label!==void 0}const D_e=3,L_e="24px",O_e="16px",cz=4e3,F_e=356,B_e=14,z_e=45,U_e=200;function cp(...t){return t.filter(Boolean).join(" ")}function V_e(t){const[e,n]=t.split("-"),s=[];return e&&s.push(e),n&&s.push(n),s}const H_e=t=>{var e,n,s,l,u,p,r,v,w;const{invert:E,toast:T,unstyled:k,interacting:R,setHeights:D,visibleToasts:O,heights:F,index:U,toasts:X,expanded:W,removeToast:K,defaultRichColors:ne,closeButton:te,style:re,cancelButtonStyle:xe,actionButtonStyle:ae,className:ce="",descriptionClassName:ye="",duration:Ce,position:Me,gap:Ke,expandByDefault:ke,classNames:je,icons:$e,closeButtonAriaLabel:Ae="Close toast"}=t,[He,qe]=fe.useState(null),[Le,st]=fe.useState(null),[bt,yt]=fe.useState(!1),[Vt,_t]=fe.useState(!1),[vt,qt]=fe.useState(!1),[kt,on]=fe.useState(!1),[mn,Hr]=fe.useState(!1),[Un,$r]=fe.useState(0),[ht,Lr]=fe.useState(0),Br=fe.useRef(T.duration||Ce||cz),wn=fe.useRef(null),Nn=fe.useRef(null),mr=U===0,Qn=U+1<=O,Nt=T.type,et=T.dismissible!==!1,Oe=T.className||"",Bt=T.descriptionClassName||"",En=fe.useMemo(()=>F.findIndex(ln=>ln.toastId===T.id)||0,[F,T.id]),Dn=fe.useMemo(()=>{var ln;return(ln=T.closeButton)!=null?ln:te},[T.closeButton,te]),rn=fe.useMemo(()=>T.duration||Ce||cz,[T.duration,Ce]),wr=fe.useRef(0),cr=fe.useRef(0),Jn=fe.useRef(0),ir=fe.useRef(null),[bn,In]=Me.split("-"),Zr=fe.useMemo(()=>F.reduce((ln,Tr,ni)=>ni>=En?ln:ln+Tr.height,0),[F,En]),Vr=M_e(),qn=T.invert||E,Kn=Nt==="loading";cr.current=fe.useMemo(()=>En*Ke+Zr,[En,Zr]),fe.useEffect(()=>{Br.current=rn},[rn]),fe.useEffect(()=>{yt(!0)},[]),fe.useEffect(()=>{const ln=Nn.current;if(ln){const Tr=ln.getBoundingClientRect().height;return Lr(Tr),D(ni=>[{toastId:T.id,height:Tr,position:T.position},...ni]),()=>D(ni=>ni.filter(Yi=>Yi.toastId!==T.id))}},[D,T.id]),fe.useLayoutEffect(()=>{if(!bt)return;const ln=Nn.current,Tr=ln.style.height;ln.style.height="auto";const ni=ln.getBoundingClientRect().height;ln.style.height=Tr,Lr(ni),D(Yi=>Yi.find(Ht=>Ht.toastId===T.id)?Yi.map(Ht=>Ht.toastId===T.id?{...Ht,height:ni}:Ht):[{toastId:T.id,height:ni,position:T.position},...Yi])},[bt,T.title,T.description,D,T.id,T.jsx,T.action,T.cancel]);const St=fe.useCallback(()=>{_t(!0),$r(cr.current),D(ln=>ln.filter(Tr=>Tr.toastId!==T.id)),setTimeout(()=>{K(T)},U_e)},[T,K,D,cr]);fe.useEffect(()=>{if(T.promise&&Nt==="loading"||T.duration===1/0||T.type==="loading")return;let ln;return W||R||Vr?(()=>{if(Jn.current<wr.current){const Yi=new Date().getTime()-wr.current;Br.current=Br.current-Yi}Jn.current=new Date().getTime()})():(()=>{Br.current!==1/0&&(wr.current=new Date().getTime(),ln=setTimeout(()=>{T.onAutoClose==null||T.onAutoClose.call(T,T),St()},Br.current))})(),()=>clearTimeout(ln)},[W,R,T,Nt,Vr,St]),fe.useEffect(()=>{T.delete&&(St(),T.onDismiss==null||T.onDismiss.call(T,T))},[St,T.delete]);function Gn(){var ln;if($e!=null&&$e.loading){var Tr;return fe.createElement("div",{className:cp(je==null?void 0:je.loader,T==null||(Tr=T.classNames)==null?void 0:Tr.loader,"sonner-loader"),"data-visible":Nt==="loading"},$e.loading)}return fe.createElement(w_e,{className:cp(je==null?void 0:je.loader,T==null||(ln=T.classNames)==null?void 0:ln.loader),visible:Nt==="loading"})}const er=T.icon||($e==null?void 0:$e[Nt])||v_e(Nt);var gr,nr;return fe.createElement("li",{tabIndex:0,ref:Nn,className:cp(ce,Oe,je==null?void 0:je.toast,T==null||(e=T.classNames)==null?void 0:e.toast,je==null?void 0:je.default,je==null?void 0:je[Nt],T==null||(n=T.classNames)==null?void 0:n[Nt]),"data-sonner-toast":"","data-rich-colors":(gr=T.richColors)!=null?gr:ne,"data-styled":!(T.jsx||T.unstyled||k),"data-mounted":bt,"data-promise":!!T.promise,"data-swiped":mn,"data-removed":Vt,"data-visible":Qn,"data-y-position":bn,"data-x-position":In,"data-index":U,"data-front":mr,"data-swiping":vt,"data-dismissible":et,"data-type":Nt,"data-invert":qn,"data-swipe-out":kt,"data-swipe-direction":Le,"data-expanded":!!(W||ke&&bt),"data-testid":T.testId,style:{"--index":U,"--toasts-before":U,"--z-index":X.length-U,"--offset":`${Vt?Un:cr.current}px`,"--initial-height":ke?"auto":`${ht}px`,...re,...T.style},onDragEnd:()=>{qt(!1),qe(null),ir.current=null},onPointerDown:ln=>{ln.button!==2&&(Kn||!et||(wn.current=new Date,$r(cr.current),ln.target.setPointerCapture(ln.pointerId),ln.target.tagName!=="BUTTON"&&(qt(!0),ir.current={x:ln.clientX,y:ln.clientY})))},onPointerUp:()=>{var ln,Tr,ni;if(kt||!et)return;ir.current=null;const Yi=Number(((ln=Nn.current)==null?void 0:ln.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),ns=Number(((Tr=Nn.current)==null?void 0:Tr.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ht=new Date().getTime()-((ni=wn.current)==null?void 0:ni.getTime()),cs=He==="x"?Yi:ns,rl=Math.abs(cs)/Ht;if(Math.abs(cs)>=z_e||rl>.11){$r(cr.current),T.onDismiss==null||T.onDismiss.call(T,T),st(He==="x"?Yi>0?"right":"left":ns>0?"down":"up"),St(),on(!0);return}else{var ho,Qr;(ho=Nn.current)==null||ho.style.setProperty("--swipe-amount-x","0px"),(Qr=Nn.current)==null||Qr.style.setProperty("--swipe-amount-y","0px")}Hr(!1),qt(!1),qe(null)},onPointerMove:ln=>{var Tr,ni,Yi;if(!ir.current||!et||((Tr=window.getSelection())==null?void 0:Tr.toString().length)>0)return;const Ht=ln.clientY-ir.current.y,cs=ln.clientX-ir.current.x;var rl;const ho=(rl=t.swipeDirections)!=null?rl:V_e(Me);!He&&(Math.abs(cs)>1||Math.abs(Ht)>1)&&qe(Math.abs(cs)>Math.abs(Ht)?"x":"y");let Qr={x:0,y:0};const Rs=ea=>1/(1.5+Math.abs(ea)/20);if(He==="y"){if(ho.includes("top")||ho.includes("bottom"))if(ho.includes("top")&&Ht<0||ho.includes("bottom")&&Ht>0)Qr.y=Ht;else{const ea=Ht*Rs(Ht);Qr.y=Math.abs(ea)<Math.abs(Ht)?ea:Ht}}else if(He==="x"&&(ho.includes("left")||ho.includes("right")))if(ho.includes("left")&&cs<0||ho.includes("right")&&cs>0)Qr.x=cs;else{const ea=cs*Rs(cs);Qr.x=Math.abs(ea)<Math.abs(cs)?ea:cs}(Math.abs(Qr.x)>0||Math.abs(Qr.y)>0)&&Hr(!0),(ni=Nn.current)==null||ni.style.setProperty("--swipe-amount-x",`${Qr.x}px`),(Yi=Nn.current)==null||Yi.style.setProperty("--swipe-amount-y",`${Qr.y}px`)}},Dn&&!T.jsx&&Nt!=="loading"?fe.createElement("button",{"aria-label":Ae,"data-disabled":Kn,"data-close-button":!0,onClick:Kn||!et?()=>{}:()=>{St(),T.onDismiss==null||T.onDismiss.call(T,T)},className:cp(je==null?void 0:je.closeButton,T==null||(s=T.classNames)==null?void 0:s.closeButton)},(nr=$e==null?void 0:$e.close)!=null?nr:C_e):null,(Nt||T.icon||T.promise)&&T.icon!==null&&(($e==null?void 0:$e[Nt])!==null||T.icon)?fe.createElement("div",{"data-icon":"",className:cp(je==null?void 0:je.icon,T==null||(l=T.classNames)==null?void 0:l.icon)},T.promise||T.type==="loading"&&!T.icon?T.icon||Gn():null,T.type!=="loading"?er:null):null,fe.createElement("div",{"data-content":"",className:cp(je==null?void 0:je.content,T==null||(u=T.classNames)==null?void 0:u.content)},fe.createElement("div",{"data-title":"",className:cp(je==null?void 0:je.title,T==null||(p=T.classNames)==null?void 0:p.title)},T.jsx?T.jsx:typeof T.title=="function"?T.title():T.title),T.description?fe.createElement("div",{"data-description":"",className:cp(ye,Bt,je==null?void 0:je.description,T==null||(r=T.classNames)==null?void 0:r.description)},typeof T.description=="function"?T.description():T.description):null),fe.isValidElement(T.cancel)?T.cancel:T.cancel&&oT(T.cancel)?fe.createElement("button",{"data-button":!0,"data-cancel":!0,style:T.cancelButtonStyle||xe,onClick:ln=>{oT(T.cancel)&&et&&(T.cancel.onClick==null||T.cancel.onClick.call(T.cancel,ln),St())},className:cp(je==null?void 0:je.cancelButton,T==null||(v=T.classNames)==null?void 0:v.cancelButton)},T.cancel.label):null,fe.isValidElement(T.action)?T.action:T.action&&oT(T.action)?fe.createElement("button",{"data-button":!0,"data-action":!0,style:T.actionButtonStyle||ae,onClick:ln=>{oT(T.action)&&(T.action.onClick==null||T.action.onClick.call(T.action,ln),!ln.defaultPrevented&&St())},className:cp(je==null?void 0:je.actionButton,T==null||(w=T.classNames)==null?void 0:w.actionButton)},T.action.label):null)};function uz(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function G_e(t,e){const n={};return[t,e].forEach((s,l)=>{const u=l===1,p=u?"--mobile-offset":"--offset",r=u?O_e:L_e;function v(w){["top","right","bottom","left"].forEach(E=>{n[`${p}-${E}`]=typeof w=="number"?`${w}px`:w})}typeof s=="number"||typeof s=="string"?v(s):typeof s=="object"?["top","right","bottom","left"].forEach(w=>{s[w]===void 0?n[`${p}-${w}`]=r:n[`${p}-${w}`]=typeof s[w]=="number"?`${s[w]}px`:s[w]}):v(r)}),n}const $_e=fe.forwardRef(function(e,n){const{id:s,invert:l,position:u="bottom-right",hotkey:p=["altKey","KeyT"],expand:r,closeButton:v,className:w,offset:E,mobileOffset:T,theme:k="light",richColors:R,duration:D,style:O,visibleToasts:F=D_e,toastOptions:U,dir:X=uz(),gap:W=B_e,icons:K,containerAriaLabel:ne="Notifications"}=e,[te,re]=fe.useState([]),xe=fe.useMemo(()=>s?te.filter(bt=>bt.toasterId===s):te.filter(bt=>!bt.toasterId),[te,s]),ae=fe.useMemo(()=>Array.from(new Set([u].concat(xe.filter(bt=>bt.position).map(bt=>bt.position)))),[xe,u]),[ce,ye]=fe.useState([]),[Ce,Me]=fe.useState(!1),[Ke,ke]=fe.useState(!1),[je,$e]=fe.useState(k!=="system"?k:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ae=fe.useRef(null),He=p.join("+").replace(/Key/g,"").replace(/Digit/g,""),qe=fe.useRef(null),Le=fe.useRef(!1),st=fe.useCallback(bt=>{re(yt=>{var Vt;return(Vt=yt.find(_t=>_t.id===bt.id))!=null&&Vt.delete||yu.dismiss(bt.id),yt.filter(({id:_t})=>_t!==bt.id)})},[]);return fe.useEffect(()=>yu.subscribe(bt=>{if(bt.dismiss){requestAnimationFrame(()=>{re(yt=>yt.map(Vt=>Vt.id===bt.id?{...Vt,delete:!0}:Vt))});return}setTimeout(()=>{CA.flushSync(()=>{re(yt=>{const Vt=yt.findIndex(_t=>_t.id===bt.id);return Vt!==-1?[...yt.slice(0,Vt),{...yt[Vt],...bt},...yt.slice(Vt+1)]:[bt,...yt]})})})}),[te]),fe.useEffect(()=>{if(k!=="system"){$e(k);return}if(k==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?$e("dark"):$e("light")),typeof window>"u")return;const bt=window.matchMedia("(prefers-color-scheme: dark)");try{bt.addEventListener("change",({matches:yt})=>{$e(yt?"dark":"light")})}catch{bt.addListener(({matches:Vt})=>{try{$e(Vt?"dark":"light")}catch(_t){console.error(_t)}})}},[k]),fe.useEffect(()=>{te.length<=1&&Me(!1)},[te]),fe.useEffect(()=>{const bt=yt=>{var Vt;if(p.every(qt=>yt[qt]||yt.code===qt)){var vt;Me(!0),(vt=Ae.current)==null||vt.focus()}yt.code==="Escape"&&(document.activeElement===Ae.current||(Vt=Ae.current)!=null&&Vt.contains(document.activeElement))&&Me(!1)};return document.addEventListener("keydown",bt),()=>document.removeEventListener("keydown",bt)},[p]),fe.useEffect(()=>{if(Ae.current)return()=>{qe.current&&(qe.current.focus({preventScroll:!0}),qe.current=null,Le.current=!1)}},[Ae.current]),fe.createElement("section",{ref:n,"aria-label":`${ne} ${He}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ae.map((bt,yt)=>{var Vt;const[_t,vt]=bt.split("-");return xe.length?fe.createElement("ol",{key:bt,dir:X==="auto"?uz():X,tabIndex:-1,ref:Ae,className:w,"data-sonner-toaster":!0,"data-sonner-theme":je,"data-y-position":_t,"data-x-position":vt,style:{"--front-toast-height":`${((Vt=ce[0])==null?void 0:Vt.height)||0}px`,"--width":`${F_e}px`,"--gap":`${W}px`,...O,...G_e(E,T)},onBlur:qt=>{Le.current&&!qt.currentTarget.contains(qt.relatedTarget)&&(Le.current=!1,qe.current&&(qe.current.focus({preventScroll:!0}),qe.current=null))},onFocus:qt=>{qt.target instanceof HTMLElement&&qt.target.dataset.dismissible==="false"||Le.current||(Le.current=!0,qe.current=qt.relatedTarget)},onMouseEnter:()=>Me(!0),onMouseMove:()=>Me(!0),onMouseLeave:()=>{Ke||Me(!1)},onDragEnd:()=>Me(!1),onPointerDown:qt=>{qt.target instanceof HTMLElement&&qt.target.dataset.dismissible==="false"||ke(!0)},onPointerUp:()=>ke(!1)},xe.filter(qt=>!qt.position&&yt===0||qt.position===bt).map((qt,kt)=>{var on,mn;return fe.createElement(H_e,{key:qt.id,icons:K,index:kt,toast:qt,defaultRichColors:R,duration:(on=U==null?void 0:U.duration)!=null?on:D,className:U==null?void 0:U.className,descriptionClassName:U==null?void 0:U.descriptionClassName,invert:l,visibleToasts:F,closeButton:(mn=U==null?void 0:U.closeButton)!=null?mn:v,interacting:Ke,position:bt,style:U==null?void 0:U.style,unstyled:U==null?void 0:U.unstyled,classNames:U==null?void 0:U.classNames,cancelButtonStyle:U==null?void 0:U.cancelButtonStyle,actionButtonStyle:U==null?void 0:U.actionButtonStyle,closeButtonAriaLabel:U==null?void 0:U.closeButtonAriaLabel,removeToast:st,toasts:xe.filter(Hr=>Hr.position==qt.position),heights:ce.filter(Hr=>Hr.position==qt.position),setHeights:ye,expandByDefault:r,gap:W,expanded:Ce,swipeDirections:e.swipeDirections})})):null}))});async function W_e(t,e,n,s){var l,u;try{if(console.log("[claimQuestRewardAPI] Claiming reward for quest:",e,"amount:",s,"TPX"),s<=0)return{success:!1,error:"No reward amount specified"};const{data:p,error:r}=await Kt.from("user_quests").select("*, quests(reward_tokens)").eq("user_id",t).eq("quest_id",e).in("status",["completed","verified"]).maybeSingle();if(r||!p)return console.error("[claimQuestRewardAPI] Quest not found or not completed:",r),{success:!1,error:"Quest not found or not completed"};if(p.tokens_claimed)return console.log("[claimQuestRewardAPI] Tokens already claimed for this quest"),{success:!1,error:"Tokens already claimed for this quest"};const v=((l=p.quests)==null?void 0:l.reward_tokens)||s;console.log("[claimQuestRewardAPI] Actual reward from quest:",v,"TPX"),console.log("[claimQuestRewardAPI] Executing blockchain transfer:",v,"TPX to",n);const w=await SN(n,v);if(!w.success)return console.error("[claimQuestRewardAPI] Blockchain transfer failed:",w.error),{success:!1,error:w.error||"Failed to transfer tokens on blockchain"};console.log("[claimQuestRewardAPI]  Blockchain transfer successful:",w.txHash);const E="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd",{error:T}=await Kt.from("token_transactions").insert({user_id:t,quest_id:e,transaction_type:"claim",amount:v,tx_hash:w.txHash,contract_address:E,from_address:"0x0000000000000000000000000000000000000000",to_address:n,status:"confirmed",blockchain_confirmed_at:new Date().toISOString()});T&&console.error("[claimQuestRewardAPI] Failed to log transaction:",T);const{error:k}=await Kt.from("user_quests").update({tokens_claimed:!0,claimed_at:new Date().toISOString()}).eq("user_id",t).eq("quest_id",e);k&&console.error("[claimQuestRewardAPI] Failed to mark quest as claimed:",k);const{data:R}=await Kt.from("users").select("total_tokens_claimed").eq("id",t).single(),D=(parseFloat(((u=R==null?void 0:R.total_tokens_claimed)==null?void 0:u.toString())||"0")||0)+v;return await Kt.from("users").update({total_tokens_claimed:D}).eq("id",t),{success:!0,data:{amount:v,txHash:w.txHash,message:`Successfully claimed ${v} TPX tokens for quest`}}}catch(p){return console.error("[claimQuestRewardAPI] Error:",p),{success:!1,error:p.message||"Failed to claim quest reward"}}}async function SW(t,e,n="bronze"){try{console.log("[mintPassportAPI] Starting mint for user:",t,"wallet:",e,"tier:",n);const{data:s,error:l}=await Kt.from("nft_passports").select("token_id, user_id, tier").eq("user_id",t).eq("tier",n).maybeSingle();if(s&&s.token_id)return console.log("[mintPassportAPI] User already has",n,"passport in DB:",s.token_id),{success:!1,error:`You already have a ${n} NFT Passport`};const{data:u,error:p}=await Kt.from("users").select("*").eq("id",t).single();if(p||!u)return console.error("[mintPassportAPI] User not found:",p),{success:!1,error:"User not found"};const r={name:`TripX Passport - ${u.username||"Explorer"}`,description:`Travel NFT Passport for ${e}`,image:`https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/passport-${n}.png`,attributes:[{trait_type:"Tier",value:n},{trait_type:"Level",value:u.level||1},{trait_type:"XP",value:u.total_xp||0},{trait_type:"Quests Completed",value:u.quests_completed||0}]},v=`data:application/json;base64,${btoa(JSON.stringify(r))}`;console.log("[mintPassportAPI] Calling web3Service.mintNFTPassport...");const w=await aW(e,v,n);if(console.log("[mintPassportAPI] web3Service.mintNFTPassport result:",w),!w.success)return console.error("[mintPassportAPI] Mint failed:",w.error),{success:!1,error:w.error||"Failed to mint passport"};console.log("[mintPassportAPI] Mint successful, tokenId:",w.tokenId,"txHash:",w.txHash);let E=w.tokenId;if(!E&&w.txHash){console.log("[mintPassportAPI] Token ID not available yet, trying to fetch from blockchain...");try{await new Promise(F=>setTimeout(F,3e3));const O=await lW(e);O&&O>0&&(E=O,console.log("[mintPassportAPI] Token ID fetched from blockchain:",E))}catch(O){console.warn("[mintPassportAPI] Could not fetch token ID yet:",O)}}const{error:T}=await Kt.from("users").update({nft_passport_token_id:w.tokenId,passport_token_id:w.tokenId,passport_tier:n}).eq("id",t);T&&console.warn("[mintPassportAPI] Failed to update user record:",T);const{error:k}=await Kt.from("nft_passports").upsert({user_id:t,token_id:E||null,tier:n,tx_hash:w.txHash,metadata_uri:v,countries_visited:u.countries_visited||[],quests_completed:u.quests_completed||0,total_xp:u.total_xp||0,minted_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"user_id,tier"});k?console.warn("[mintPassportAPI] Failed to insert nft_passports record:",k):console.log("[mintPassportAPI]  nft_passports record created/updated");const R="0xFc22556bb4ae5740610bE43457d46AdA5200b994",{error:D}=await Kt.from("nft_transactions").insert({user_id:t,nft_type:"passport",token_id:E||null,tx_hash:w.txHash,contract_address:R,to_address:e,status:E?"confirmed":"pending",blockchain_confirmed_at:E?new Date().toISOString():null});if(D&&console.warn("[mintPassportAPI] Failed to log NFT transaction:",D),E)try{const{notifyNFTMinted:O}=await hr(async()=>{const{notifyNFTMinted:F}=await Promise.resolve().then(()=>CN);return{notifyNFTMinted:F}},void 0);await O(t,"passport",E,w.txHash)}catch(O){console.error("Failed to create NFT minted notification:",O)}return{success:!0,data:{tokenId:E||void 0,txHash:w.txHash,message:E?`Successfully minted ${n} passport NFT`:"NFT Passport mint transaction sent! Token ID will be available once confirmed."}}}catch(s){return console.error("[mintPassportAPI] Error:",s),{success:!1,error:s.message||"Failed to mint passport"}}}async function q_e(t,e,n){try{console.log("[mintAchievementAPI] Minting achievement for user:",t,"achievement:",e);let s=null,l=!1;const{data:u,error:p}=await Kt.from("achievements").select("*").eq("id",e).maybeSingle();if(u)s=u,console.log("[mintAchievementAPI] Found achievement:",u.name);else{const{data:F,error:U}=await Kt.from("quests").select("*").eq("id",e).maybeSingle();F&&(s=F,l=!0,console.log("[mintAchievementAPI] Found quest:",F.title))}if(!s)return console.error("[mintAchievementAPI] Achievement/Quest not found for ID:",e),{success:!1,error:"Achievement not found"};const{data:r}=await Kt.from("nft_transactions").select("token_id, tx_hash").eq("user_id",t).eq("quest_id",e).eq("nft_type","achievement").maybeSingle();if(r&&r.token_id)return console.log("[mintAchievementAPI] NFT already minted:",r.token_id),{success:!1,error:"Achievement NFT already minted"};if(l){const{data:F}=await Kt.from("user_quests").select("*").eq("user_id",t).eq("quest_id",e).in("status",["completed","verified"]).maybeSingle();if(!F)return{success:!1,error:"Quest not completed"};if(F.nft_minted||F.nft_token_id)return{success:!1,error:"Achievement NFT already minted for this quest"}}else{const{data:F}=await Kt.from("user_achievements").select("*").eq("user_id",t).eq("achievement_id",e).eq("unlocked",!0).maybeSingle();if(!F)return{success:!1,error:"Achievement not unlocked"};if(F.nft_minted||F.nft_token_id)return{success:!1,error:"Achievement NFT already minted"}}const v=s.name||s.title||"Achievement",w=s.description||`Achievement: ${v}`,E=s.image_url||s.icon_url||"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/achievement-default.png",T={name:`TripX Achievement - ${v}`,description:w,image:E,attributes:[{trait_type:"Achievement",value:v},{trait_type:"Type",value:l?"Quest":"Badge"},{trait_type:"Category",value:s.category||"General"}]},k=`data:application/json;base64,${btoa(JSON.stringify(T))}`,R=await TN(n,k,e);if(!R.success)return console.error("[mintAchievementAPI] Mint failed:",R.error),{success:!1,error:R.error||"Failed to mint achievement"};if(console.log("[mintAchievementAPI] Mint successful, tokenId:",R.tokenId,"txHash:",R.txHash),l){const{error:F}=await Kt.from("user_quests").update({nft_minted:!0,nft_token_id:R.tokenId,nft_tx_hash:R.txHash,nft_minted_at:new Date().toISOString()}).eq("user_id",t).eq("quest_id",e);F&&console.warn("[mintAchievementAPI] Failed to update user_quests:",F)}else{const{error:F}=await Kt.from("user_achievements").update({nft_minted:!0,nft_token_id:R.tokenId,nft_tx_hash:R.txHash}).eq("user_id",t).eq("achievement_id",e);F&&console.warn("[mintAchievementAPI] Failed to update user_achievements:",F)}const D="0x110D62545d416d3DFEfA12D0298aBf197CF0e828",{error:O}=await Kt.from("nft_transactions").insert({user_id:t,quest_id:e,nft_type:"achievement",token_id:R.tokenId,tx_hash:R.txHash,contract_address:D,to_address:n,status:"confirmed",blockchain_confirmed_at:new Date().toISOString()});return O&&console.warn("[mintAchievementAPI] Failed to log NFT transaction:",O),{success:!0,data:{tokenId:R.tokenId,txHash:R.txHash,message:`Successfully minted achievement NFT for ${questData.title}`}}}catch(s){return console.error("[mintAchievementAPI] Error:",s),{success:!1,error:s.message||"Failed to mint achievement"}}}const BE=Object.freeze(Object.defineProperty({__proto__:null,claimQuestRewardAPI:W_e,mintAchievementAPI:q_e,mintPassportAPI:SW},Symbol.toStringTag,{value:"Module"})),ib="R9M5EMRC7438QH2HGBZJJFXFF68ZIPQH8H",X_e="11155111",MN=`https://api.etherscan.io/v2/api?chainid=${X_e}`,TW="https://sepolia.etherscan.io",dz="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd";async function qA(){try{const t=`${MN}&module=proxy&action=eth_blockNumber&apikey=${ib}`;console.log("[etherscanMonitor] Getting block number from:",t.replace(ib,"***"));const n=await(await fetch(t)).json();if(console.log("[etherscanMonitor] Block number response:",n),n.result){const s=parseInt(n.result,16);return console.log("[etherscanMonitor] Current block:",s),s}return 0}catch(t){return console.error("[etherscanMonitor] Error getting current block number:",t),0}}function kN(t){return`${TW}/address/${t}#tokentxnsErc721`}function Cx(t){return`${TW}/tx/${t}`}async function C2(t,e,n,s,l=30,u){console.log("[etherscanMonitor] Starting NFT transaction monitoring for:",t),console.log("[etherscanMonitor] Contract filter:",s),console.log("[etherscanMonitor] Start block:",u);let p=0;const r=2e3;return new Promise(v=>{const w=async()=>{var E,T,k,R,D;p++,console.log(`[etherscanMonitor] Check attempt ${p}/${l}`),n&&n(p);try{let O=`${MN}&module=account&action=tokennfttx&address=${t}&page=1&offset=10&sort=desc&apikey=${ib}`;u&&(O+=`&startblock=${u}`),console.log("[etherscanMonitor] Fetching from:",O.replace(ib,"***"));const U=await(await fetch(O)).json();if(console.log("[etherscanMonitor] API Response:",{status:U.status,message:U.message,resultCount:((E=U.result)==null?void 0:E.length)||0}),U.status==="1"&&U.result&&U.result.length>0){console.log("[etherscanMonitor] Found",U.result.length,"NFT transactions"),console.log("[etherscanMonitor] First transaction:",U.result[0]);for(const X of U.result){if(console.log("[etherscanMonitor] Checking tx:",{hash:(T=X.hash)==null?void 0:T.substring(0,10),contract:(k=X.contractAddress)==null?void 0:k.substring(0,10),to:(R=X.to)==null?void 0:R.substring(0,10),from:(D=X.from)==null?void 0:D.substring(0,10),tokenID:X.tokenID}),s&&X.contractAddress.toLowerCase()!==s.toLowerCase()){console.log("[etherscanMonitor]  Contract mismatch");continue}if(X.to.toLowerCase()===t.toLowerCase()){const W={found:!0,transactionHash:X.hash,blockNumber:parseInt(X.blockNumber),tokenId:parseInt(X.tokenID),from:X.from,to:X.to,contractAddress:X.contractAddress,timestamp:parseInt(X.timeStamp)};console.log("[etherscanMonitor]  NFT transaction found:",W),e(W),v(W);return}else console.log("[etherscanMonitor]  Recipient mismatch:",X.to,"vs",t)}console.log("[etherscanMonitor]  No matching transaction in results")}else console.log("[etherscanMonitor] No transactions found or API error");p<l?setTimeout(w,r):(console.log("[etherscanMonitor]  Max attempts reached, transaction not found"),v({found:!1}))}catch(O){console.error("[etherscanMonitor] Error checking transaction:",O),p<l?setTimeout(w,r):v({found:!1})}};w()})}async function EW(t,e,n,s=30,l){console.log("[etherscanMonitor] Starting TPX transaction monitoring for:",t),console.log("[etherscanMonitor] Start block:",l);let u=0;const p=2e3;return new Promise(r=>{const v=async()=>{var w,E,T,k,R;u++,console.log(`[etherscanMonitor] TPX Check attempt ${u}/${s}`),n&&n(u);try{let D=`${MN}&module=account&action=tokentx&address=${t}&page=1&offset=10&sort=desc&apikey=${ib}`;l&&(D+=`&startblock=${l}`),console.log("[etherscanMonitor] TPX Fetching from:",D.replace(ib,"***"));const F=await(await fetch(D)).json();if(console.log("[etherscanMonitor] TPX API Response:",{status:F.status,message:F.message,resultCount:((w=F.result)==null?void 0:w.length)||0}),F.status==="1"&&F.result&&F.result.length>0){console.log("[etherscanMonitor] Found",F.result.length,"token transactions"),console.log("[etherscanMonitor] First transaction:",F.result[0]);for(const U of F.result){if(console.log("[etherscanMonitor] Checking TPX tx:",{hash:(E=U.hash)==null?void 0:E.substring(0,10),contract:(T=U.contractAddress)==null?void 0:T.substring(0,10),to:(k=U.to)==null?void 0:k.substring(0,10),from:(R=U.from)==null?void 0:R.substring(0,10),value:U.value,tokenSymbol:U.tokenSymbol}),dz&&U.contractAddress.toLowerCase()!==dz.toLowerCase()){console.log("[etherscanMonitor]  TPX Contract mismatch");continue}if(U.to.toLowerCase()===t.toLowerCase()){const X={found:!0,transactionHash:U.hash,blockNumber:parseInt(U.blockNumber),value:U.value,from:U.from,to:U.to,contractAddress:U.contractAddress,timestamp:parseInt(U.timeStamp)};console.log("[etherscanMonitor]  TPX transaction found:",X),e(X),r(X);return}else console.log("[etherscanMonitor]  TPX Recipient mismatch:",U.to,"vs",t)}console.log("[etherscanMonitor]  No matching TPX transaction in results")}else console.log("[etherscanMonitor] No TPX transactions found or API error");u<s?setTimeout(v,p):(console.log("[etherscanMonitor]  Max attempts reached, TPX transaction not found"),r({found:!1}))}catch(D){console.error("[etherscanMonitor] Error checking TPX transaction:",D),u<s?setTimeout(v,p):r({found:!1})}};v()})}const AW=({isOpen:t,onClose:e,onAddToWallet:n,nftType:s,tokenId:l,contractAddress:u,txHash:p,questTitle:r,imageUrl:v,refreshOnClose:w=!1})=>{const E=`https://sepolia.etherscan.io/tx/${p}`,T=`https://sepolia.etherscan.io/nft/${u}/${l}`,k=()=>{e(),w&&window.location.reload()};return f.jsx(Xc,{children:t&&f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:k,children:f.jsxs(it.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:R=>R.stopPropagation(),className:"bg-gradient-to-br from-gray-900 to-black border border-white/20 rounded-2xl p-6 max-w-md w-full shadow-2xl",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center",children:f.jsx(la,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-bold text-white",children:"NFT Minted!"}),f.jsx("p",{className:"text-sm text-white/60",children:s==="passport"?"Travel Passport":r||"Achievement"})]})]}),f.jsx("button",{onClick:k,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:f.jsx(Qa,{className:"w-5 h-5 text-white/60"})})]}),v&&f.jsx("div",{className:"mb-6 flex justify-center",children:f.jsxs("div",{className:"relative w-48 h-48 rounded-xl overflow-hidden border-2 border-purple-500/50 shadow-lg shadow-purple-500/20",children:[f.jsx("img",{src:v,alt:r||"NFT",className:"w-full h-full object-cover",onError:R=>{R.target.src="https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/achievement-default.png"}}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),f.jsx("div",{className:"absolute bottom-2 left-2 right-2 text-center",children:f.jsxs("span",{className:"text-xs font-semibold text-white/90 bg-black/40 px-2 py-1 rounded-full",children:["#",l]})})]})}),f.jsx("div",{className:"mb-6 p-4 rounded-xl bg-white/5 border border-white/10",children:f.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 mb-1",children:"Token ID"}),f.jsxs("p",{className:"text-white font-mono",children:["#",l]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 mb-1",children:"Network"}),f.jsx("p",{className:"text-white",children:"Sepolia"})]}),f.jsxs("div",{className:"col-span-2",children:[f.jsx("p",{className:"text-white/60 mb-1",children:"Contract"}),f.jsx("p",{className:"text-white font-mono text-xs break-all",children:u})]})]})}),f.jsx("div",{className:"mb-6 p-4 rounded-xl bg-green-500/10 border border-green-500/30",children:f.jsx("p",{className:"text-green-400 text-center font-medium",children:" Your NFT has been minted successfully!"})}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs(it.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>{n()},className:"w-full py-3 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold flex items-center justify-center gap-2 shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transition-all duration-300",children:[f.jsx(NE,{className:"w-5 h-5"}),"Add NFT to Wallet"]}),f.jsx("p",{className:"text-xs text-white/40 text-center mt-2",children:" If MetaMask doesn't show the NFT, view it on Etherscan below"}),f.jsx("a",{href:T,target:"_blank",rel:"noopener noreferrer",className:"block",children:f.jsxs(it.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},className:"w-full py-3 rounded-xl bg-white/10 border border-white/20 text-white font-semibold flex items-center justify-center gap-2 hover:bg-white/20 transition-all duration-300",children:[f.jsx(Jo,{className:"w-5 h-5"}),"View on Etherscan"]})}),f.jsx("button",{onClick:k,className:"w-full py-3 rounded-xl bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-semibold hover:opacity-90 transition-all duration-300",children:w?"Done - Close & Refresh":"Close"})]}),f.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:f.jsxs("a",{href:E,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 flex items-center justify-center gap-1",children:["View transaction",f.jsx(Jo,{className:"w-3 h-3"})]})})]})})})};async function CW(t,e=50,n){console.log("[getNFTTransactions] Fetching transactions for user:",t,"limit:",e);const{data:s,error:l}=await Kt.from("nft_transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(e);l&&(console.error("[getNFTTransactions] Error fetching NFT transactions from database:",l),console.error("[getNFTTransactions] Error details:",{code:l.code,message:l.message,details:l.details,hint:l.hint}));const u=s||[];if(console.log("[getNFTTransactions] Found",u.length,"transactions in database"),u.length>0&&(console.log("[getNFTTransactions] Transaction types:",u.map(p=>p.nft_type)),console.log("[getNFTTransactions] Transaction IDs:",u.map(p=>p.id))),n)try{const{getBlockchainNFTTransactions:p}=await hr(async()=>{const{getBlockchainNFTTransactions:E}=await import("./blockchainTransactionService-CuBcSn_K.js");return{getBlockchainNFTTransactions:E}},[]),r=await p(n,e),v=new Map;for(const E of u)E.tx_hash&&v.set(E.tx_hash.toLowerCase(),E);for(const E of r){const T=E.txHash.toLowerCase();if(!v.has(T)){const k=E.contractAddress.toLowerCase(),R="0xFc22556bb4ae5740610bE43457d46AdA5200b994".toLowerCase(),D="0x110D62545d416d3DFEfA12D0298aBf197CF0e828".toLowerCase();let O="achievement";R&&k===R?O="passport":O="achievement";const F={id:`blockchain_${E.txHash}`,user_id:t,nft_type:O,token_id:E.tokenId,contract_address:E.contractAddress,tx_hash:E.txHash,from_address:E.from,to_address:E.to,status:"confirmed",block_number:Number(E.blockNumber),blockchain_confirmed_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():void 0,metadata:{source:"blockchain",timestamp:E.timestamp,contract_address:E.contractAddress},created_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():new Date().toISOString(),updated_at:E.timestamp?new Date(E.timestamp*1e3).toISOString():new Date().toISOString()};v.set(T,F)}}const w=Array.from(v.values()).sort((E,T)=>{const k=new Date(E.created_at).getTime();return new Date(T.created_at).getTime()-k});return console.log("[getNFTTransactions] Total unique transactions after merge:",w.length),console.log("[getNFTTransactions] Returning",Math.min(w.length,e),"transactions"),w.slice(0,e)}catch(p){return console.error("Error fetching blockchain NFT transactions:",p),u}return u}function Z_e(t){return{achievement:"Achievement NFT",passport:"Passport NFT",quest_reward:"Quest Reward NFT"}[t]||t}function Q_e(t){return{achievement:"purple",passport:"cyan",quest_reward:"pink"}[t]||"gray"}const MW="nft_added_to_metamask";function kW(){try{const t=localStorage.getItem(MW);if(t)return new Set(JSON.parse(t))}catch(t){console.error("[AddNFTToWallet] Error reading localStorage:",t)}return new Set}function Zm(t,e){try{const n=kW(),s=`${e.toLowerCase()}_${t}`;n.add(s),localStorage.setItem(MW,JSON.stringify(Array.from(n))),console.log("[AddNFTToWallet] Marked NFT as added:",s)}catch(n){console.error("[AddNFTToWallet] Error saving to localStorage:",n)}}const K_e=({className:t=""})=>{const{user:e,address:n}=ba(),{user:s}=El(),l=e||s,[u,p]=he.useState([]),[r,v]=he.useState(!1),[w,E]=he.useState(!1),[T,k]=he.useState(!0);he.useEffect(()=>{if(!(l!=null&&l.id)||!n){k(!1);return}R()},[l==null?void 0:l.id,n]);const R=async()=>{if(!(!(l!=null&&l.id)||!n)){k(!0);try{console.log("[AddNFTToWallet] Loading NFTs for user:",l.id);const F=(await CW(l.id,100,n)).filter(K=>K.status==="confirmed"&&K.token_id&&K.token_id>0&&K.contract_address&&(K.nft_type==="passport"||K.nft_type==="achievement"));console.log("[AddNFTToWallet] Found",F.length,"confirmed NFTs");const U=kW(),X=[];for(const K of F){const ne=`${K.contract_address.toLowerCase()}_${K.token_id}`;U.has(ne)||X.push({tokenId:K.token_id,contractAddress:K.contract_address,nftType:K.nft_type,txHash:K.tx_hash})}const W=Array.from(new Map(X.map(K=>[`${K.contractAddress}_${K.tokenId}`,K])).values());console.log("[AddNFTToWallet] NFTs to add:",W.length),p(W)}catch(O){console.error("[AddNFTToWallet] Error loading NFTs:",O),p([])}finally{k(!1)}}},D=async()=>{var O;if(!window.ethereum){const F=u[0];F&&window.open(`https://sepolia.etherscan.io/token/${F.contractAddress}?a=${n}`,"_blank");return}if(u.length!==0){v(!0);try{console.log("[AddNFTToWallet] Adding",u.length,"NFTs to MetaMask...");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0xaa36a7"}]})}catch(X){X.code===4902&&await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0xaa36a7",chainName:"Sepolia Testnet",nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},rpcUrls:["https://ethereum-sepolia.publicnode.com"],blockExplorerUrls:["https://sepolia.etherscan.io"]}]})}let F=0;const U=[];for(const X of u)try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:X.contractAddress,tokenId:X.tokenId.toString()}}})?(console.log("[AddNFTToWallet]  Added NFT:",X.tokenId,"from",X.contractAddress),Zm(X.tokenId,X.contractAddress),F++):(console.log("[AddNFTToWallet] User declined to add NFT:",X.tokenId),U.push(X))}catch(W){console.warn("[AddNFTToWallet] wallet_watchAsset failed for NFT",X.tokenId,":",W.message),W.code===-32602||(O=W.message)!=null&&O.includes("not supported")?(console.log("[AddNFTToWallet] ERC721 watchAsset not supported, marking as added"),Zm(X.tokenId,X.contractAddress),F++):U.push(X)}if(U.length>0&&F===0){const W=`https://sepolia.etherscan.io/token/${U[0].contractAddress}?a=${n}`;window.confirm(`MetaMask doesn't fully support viewing NFTs directly.

Would you like to view your NFTs on Etherscan instead?`)&&window.open(W,"_blank"),U.forEach(ne=>Zm(ne.tokenId,ne.contractAddress)),F=U.length}console.log("[AddNFTToWallet]  Added",F,"out of",u.length,"NFTs"),F>0&&(E(!0),await R(),setTimeout(()=>E(!1),3e3))}catch(F){console.error("[AddNFTToWallet] Error adding NFTs:",F),F.code!==4001&&alert(`Failed to add NFTs: ${F.message||"Please try again"}`)}finally{v(!1)}}};return!l||!n||T||u.length===0?null:f.jsx(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:D,disabled:r||w,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-all backdrop-blur-xl ${t}`,style:{background:"linear-gradient(135deg, rgba(20, 20, 20, 0.7) 0%, rgba(40, 40, 40, 0.7) 100%)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",border:"1px solid rgba(139, 92, 246, 0.3)",color:"white",boxShadow:"0 8px 32px 0 rgba(139, 92, 246, 0.15)"},children:w?f.jsxs(f.Fragment,{children:[f.jsx(uN,{className:"w-4 h-4"}),f.jsx("span",{children:"Added to MetaMask!"})]}):r?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-4 h-4 animate-spin"}),f.jsxs("span",{children:["Adding ",u.length," NFT",u.length>1?"s":"","..."]})]}):f.jsxs(f.Fragment,{children:[f.jsx(Ho,{className:"w-4 h-4"}),f.jsxs("span",{children:["Add ",u.length," NFT",u.length>1?"s":""," to Wallet"]})]})})},Y_e={deepPurple:"#1a0a2e",midnightBlue:"#0d1b2a",bloodOrange:"#ff6b35"},J_e={ghostlyWhite:"#f0e6ff",pumpkinOrange:"#ff9500",toxicGreen:"#39ff14"},eve={spookyNight:"linear-gradient(135deg, #1a0a2e 0%, #0d1b2a 50%, #1a0a2e 100%)",hauntedGlow:"linear-gradient(180deg, #ff6b35 0%, #ff9500 100%)",mysticalPurple:"linear-gradient(45deg, #1a0a2e 0%, #f0e6ff 100%)",toxicShimmer:"linear-gradient(90deg, #39ff14 0%, #ff9500 50%, #39ff14 100%)"},gs={colors:{primary:Y_e,accent:J_e,gradients:eve}},tve={gemini:{name:"Google Gemini 2.5 Pro",icon:"",link:"https://ai.google.dev/",color:"#4285F4"},ethereum:{name:"Ethereum Sepolia",icon:"",link:"https://ethereum.org/",color:"#627EEA"},supabase:{name:"Supabase",icon:"",link:"https://supabase.com/",color:"#3ECF8E"},mapbox:{name:"Mapbox GL",icon:"",link:"https://www.mapbox.com/",color:"#4264FB"},"google-maps":{name:"Google Maps",icon:"",link:"https://developers.google.com/maps",color:"#4285F4"},rainbowkit:{name:"RainbowKit",icon:"",link:"https://www.rainbowkit.com/",color:"#7B3FE4"},react:{name:"React 18",icon:"",link:"https://react.dev/",color:"#61DAFB"},vite:{name:"Vite",icon:"",link:"https://vitejs.dev/",color:"#646CFF"}},nve=({technology:t,variant:e="badge",showLink:n=!0,className:s=""})=>{const l=tve[t];return e==="inline"?f.jsxs("span",{className:`inline-flex items-center gap-1 text-xs text-slate-400 ${s}`,children:[f.jsx("span",{children:l.icon}),f.jsxs("span",{children:["Powered by ",l.name]}),n&&f.jsx("a",{href:l.link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-slate-300 transition-colors","aria-label":`Learn more about ${l.name}`,children:f.jsx(Jo,{size:10})})]}):e==="footer"?f.jsxs(it.a,{href:l.link,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 transition-colors ${s}`,whileHover:{scale:1.02},"aria-label":`Powered by ${l.name}`,children:[f.jsx("span",{className:"text-lg",children:l.icon}),f.jsx("span",{className:"text-xs text-slate-400",children:l.name})]}):f.jsxs(it.div,{className:`inline-flex items-center gap-2 px-4 py-2 rounded-xl backdrop-blur-md border transition-all ${s}`,style:{background:`linear-gradient(135deg, ${gs.colors.primary.deepPurple}80, ${gs.colors.primary.midnightBlue}90)`,borderColor:`${l.color}40`,boxShadow:`0 0 20px ${l.color}20`},whileHover:{scale:1.02,boxShadow:`0 0 30px ${l.color}40`},children:[f.jsx("span",{className:"text-xl",children:l.icon}),f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider",children:"Powered by"}),f.jsx("span",{className:"text-sm font-medium text-slate-200",children:l.name})]}),n&&f.jsx("a",{href:l.link,target:"_blank",rel:"noopener noreferrer",className:"ml-2 p-1 rounded-full hover:bg-white/10 transition-colors","aria-label":`Learn more about ${l.name}`,children:f.jsx(Jo,{size:14,className:"text-slate-400"})})]})},aT={bronze:"from-orange-700 to-orange-900",silver:"from-gray-400 to-gray-600",gold:"from-yellow-400 to-yellow-600",platinum:"from-purple-400 to-purple-600"},hz={bronze:"",silver:"",gold:"",platinum:""},fz={bronze:{level:1,xp:0},silver:{level:5,xp:1600},gold:{level:10,xp:8100},platinum:{level:15,xp:19600}},rve=["bronze","silver","gold","platinum"],ive=({className:t=""})=>{const{user:e,address:n,isConnected:s}=ba(),{user:l}=El(),u=e||l,[p,r]=he.useState(u),v=p||u;he.useEffect(()=>{u&&r(u)},[u]);const[w,E]=he.useState({totalXP:0,level:1,questsCompleted:0,countriesVisited:[]}),[T,k]=he.useState([]),[R,D]=he.useState(!1),[O,F]=he.useState(null),[U,X]=he.useState(!1),[W,K]=he.useState(null),ne=he.useRef(new Set);he.useEffect(()=>{s&&n&&(v!=null&&v.id)?(D(!0),te()):!(v!=null&&v.id)&&!s&&(E({totalXP:0,level:1,questsCompleted:0,countriesVisited:[]}),k([]),D(!1))},[v==null?void 0:v.id,n,s]);const te=async()=>{if(v!=null&&v.id)try{const{data:ce,error:ye}=await Kt.from("users").select("*").eq("id",v.id).single();if(ye||!ce){console.error("[NFTPassportCard] Error fetching user:",ye);return}const Ce=ce.total_xp||0,Me=Math.floor(Math.sqrt(Ce/100))+1;E({totalXP:Ce,level:Me,questsCompleted:ce.quests_completed||0,countriesVisited:ce.countries_visited||[]});const{data:Ke,error:ke}=await Kt.from("nft_passports").select("*").eq("user_id",v.id),je=new Map;!ke&&Ke&&Ke.forEach(Ae=>{Ae.tier&&Ae.token_id&&je.set(Ae.tier,{tokenId:Ae.token_id,txHash:Ae.tx_hash})});const $e=rve.map(Ae=>{const He=fz[Ae],qe=je.has(Ae),Le=je.get(Ae);return{tier:Ae,minted:qe,tokenId:Le==null?void 0:Le.tokenId,txHash:Le==null?void 0:Le.txHash,unlocked:Ce>=He.xp,requiredXP:He.xp,requiredLevel:He.level}});k($e)}catch(ce){console.error("[NFTPassportCard] Error:",ce)}finally{D(!1)}},re=async ce=>{if(ne.current.has(ce)){dr.info(`${ce} passport already minted in this session`);return}if(!n||!(v!=null&&v.id)){dr.error("Please connect your wallet");return}const ye=T.find(Me=>Me.tier===ce);if(!(ye!=null&&ye.unlocked)){dr.error(`You need ${fz[ce].xp} XP to mint ${ce} passport`);return}if(ye.minted){dr.info(`${ce} passport already minted!`);return}F(ce);const Ce=dr.loading(`Minting ${ce} NFT Passport...`);try{const Me=await SW(v.id,n,ce);if(Me.success&&Me.data){ne.current.add(ce);const Ke="0xFc22556bb4ae5740610bE43457d46AdA5200b994",ke=Me.data.txHash;dr.dismiss(Ce);const je=dr.loading(" Monitoring blockchain...",{duration:12e4});C2(n,async $e=>{dr.dismiss(je);const Ae=kN($e.transactionHash||ke);dr.success(` ${ce} Passport minted!`,{description:f.jsx("a",{href:Ae,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"View on Etherscan "}),duration:1e4});const He=`https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/passport-${ce}.png`;K({tokenId:Me.data.tokenId,txHash:$e.transactionHash||ke,contractAddress:Ke,imageUrl:He,tier:ce}),await Kt.from("nft_passports").upsert({user_id:v.id,token_id:Me.data.tokenId,tier:ce,tx_hash:$e.transactionHash||ke,total_xp:w.totalXP,quests_completed:w.questsCompleted,countries_visited:w.countriesVisited},{onConflict:"user_id,tier"}),rb(v.id,"passport",Me.data.tokenId,$e.transactionHash||ke).catch(console.warn),X(!0),F(null),te()},()=>{},Ke,100,0).then($e=>{$e.found||(dr.dismiss(je),dr.warning("Transaction verification timeout"),F(null),te())})}else dr.dismiss(Ce),dr.error(Me.error||"Mint failed"),F(null)}catch(Me){dr.dismiss(Ce),dr.error(Me.message||"Mint failed"),F(null)}},xe=async()=>{if(!(!W||!window.ethereum)){try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:W.contractAddress,tokenId:W.tokenId.toString()}}}),Zm(W.tokenId,W.contractAddress)}catch(ce){console.log("[NFTPassportCard] MetaMask error:",ce.message),Zm(W.tokenId,W.contractAddress)}X(!1)}};if(!s||!n)return null;const ae=w.level>=15?"platinum":w.level>=10?"gold":w.level>=5?"silver":"bronze";return f.jsxs("div",{className:`relative ${t}`,children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-2xl p-6 backdrop-blur-xl border border-white/10 relative overflow-hidden",style:FE.inlineStyles.glassStrong,children:[f.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${aT[ae]} opacity-10`}),f.jsxs("div",{className:"relative z-10",children:[f.jsx("div",{className:"flex items-center justify-between mb-6",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${aT[ae]} flex items-center justify-center`,children:f.jsx(Vl,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-bold text-white",children:"NFT Passport Collection"}),f.jsxs("p",{className:"text-sm text-slate-400",children:["Current Tier: ",f.jsx("span",{className:"capitalize text-white",children:ae})," ",hz[ae]]})]})]})}),f.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[f.jsx(F0,{className:"w-4 h-4 text-teal-400"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:w.totalXP.toLocaleString()})]}),f.jsx("p",{className:"text-xs text-slate-400",children:"Total XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[f.jsx($0,{className:"w-4 h-4 text-teal-400"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:w.questsCompleted})]}),f.jsx("p",{className:"text-xs text-slate-400",children:"Quests"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[f.jsx(Mo,{className:"w-4 h-4 text-teal-400"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:w.countriesVisited.length})]}),f.jsx("p",{className:"text-xs text-slate-400",children:"Countries"})]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Mint NFT for each tier you've unlocked:"}),T.map(ce=>f.jsx("div",{className:`rounded-xl p-4 border ${ce.unlocked?"bg-white/5 border-white/20":"bg-white/[0.02] border-white/5 opacity-60"}`,children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:`w-10 h-10 rounded-lg bg-gradient-to-br ${aT[ce.tier]} flex items-center justify-center`,children:f.jsx("span",{className:"text-xl",children:hz[ce.tier]})}),f.jsxs("div",{children:[f.jsxs("p",{className:"font-semibold text-white capitalize",children:[ce.tier," Passport"]}),f.jsx("p",{className:"text-xs text-slate-400",children:ce.unlocked?ce.minted?`Minted  Token #${ce.tokenId}`:"Ready to mint!":`Requires ${ce.requiredXP.toLocaleString()} XP (Level ${ce.requiredLevel})`})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[ce.minted&&ce.tokenId&&f.jsx("a",{href:`https://sepolia.etherscan.io/token/undefined?a=${ce.tokenId}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",title:"View on Etherscan",children:f.jsx(Jo,{className:"w-4 h-4 text-cyan-400"})}),ce.unlocked?ce.minted?f.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-green-500/20 text-green-400 text-sm font-medium flex items-center gap-1",children:[f.jsx($0,{className:"w-4 h-4"}),"Minted"]}):f.jsx(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>re(ce.tier),disabled:O!==null,className:`px-4 py-2 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r ${aT[ce.tier]} text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2`,children:O===ce.tier?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-4 h-4 animate-spin"}),"Minting..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Ho,{className:"w-4 h-4"}),"Mint"]})}):f.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-white/5 text-slate-500 text-sm font-medium flex items-center gap-1",children:[f.jsx(hN,{className:"w-4 h-4"}),"Locked"]})]})]})},ce.tier))]}),f.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:f.jsx(nve,{technology:"ethereum",variant:"inline"})})]})]}),W&&f.jsx(AW,{isOpen:U,onClose:()=>X(!1),onAddToWallet:xe,nftType:"passport",tokenId:W.tokenId,contractAddress:W.contractAddress,txHash:W.txHash,imageUrl:W.imageUrl,refreshOnClose:!0})]})},IW=({address:t,className:e=""})=>{const[n,s]=he.useState(!1),[l,u]=he.useState(!1),p=async()=>{if(!window.ethereum){alert("MetaMask is not installed. Please install MetaMask to add TPX token.");return}s(!0);try{const r="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd";console.log("[AddTPXToMetaMask] Adding TPX token to MetaMask..."),console.log("[AddTPXToMetaMask] Contract Address:",r),console.log("[AddTPXToMetaMask] Network: Ethereum Sepolia Testnet (Chain ID: 11155111)");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0xaa36a7"}]}),console.log("[AddTPXToMetaMask] Switched to Sepolia network")}catch(w){if(w.code===4902)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0xaa36a7",chainName:"Sepolia Testnet",nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},rpcUrls:["https://ethereum-sepolia.publicnode.com"],blockExplorerUrls:["https://sepolia.etherscan.io"]}]}),console.log("[AddTPXToMetaMask] Added Sepolia network")}catch(E){throw console.error("[AddTPXToMetaMask] Error adding Sepolia network:",E),new Error("Please add Sepolia testnet to MetaMask manually")}else console.log("[AddTPXToMetaMask] User declined network switch or already on Sepolia")}await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:r,symbol:"TPX",decimals:18,image:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/info/logo.png"}}})?(console.log("[AddTPXToMetaMask]  TPX token added successfully to MetaMask!"),u(!0),setTimeout(()=>u(!1),3e3)):console.log("[AddTPXToMetaMask] User declined to add token")}catch(r){console.error("[AddTPXToMetaMask] Error adding token:",r),r.code!==4001&&alert(`Failed to add TPX token: ${r.message||"Please ensure you are on Sepolia testnet"}`)}finally{s(!1)}};return f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:p,disabled:n||l,className:`flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-amber-500 to-yellow-500 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-all ${e}`,children:l?f.jsxs(f.Fragment,{children:[f.jsx(uN,{className:"w-4 h-4"}),"Added to MetaMask!"]}):n?f.jsxs(f.Fragment,{children:[f.jsx(NE,{className:"w-4 h-4 animate-pulse"}),"Adding..."]}):f.jsxs(f.Fragment,{children:[f.jsx(NE,{className:"w-4 h-4"}),"Add TPX to MetaMask"]})})};async function sve(t="all-time",e=20,n=0){let s=t;if(t==="monthly"){const w=new Date;s=`monthly-${w.getFullYear()}-${w.getMonth()+1}`}else if(t==="weekly"){const w=new Date,E=Math.ceil(w.getDate()/7);s=`weekly-${w.getFullYear()}-${w.getMonth()+1}-${E}`}console.log(`[getLeaderboard] Fetching leaderboard for season: ${s}, limit: ${e}, offset: ${n}`),await ove(s),await pI(s);const l=n,u=n+e-1;console.log(`[getLeaderboard] Query range: ${l} to ${u} (limit: ${e})`);const{data:p,error:r}=await Kt.from("leaderboard").select(`
      *,
      users (
        id,
        username,
        wallet_address,
        level,
        total_xp,
        quests_completed,
        total_tokens_earned
      )
    `).eq("season",s).order("rank",{ascending:!0}).range(l,u);if(r)return console.error("[getLeaderboard] Error fetching leaderboard:",r),console.error("[getLeaderboard] Error details:",JSON.stringify(r,null,2)),[];const v=(p||[]).map(w=>{const E=Array.isArray(w.users)?w.users[0]:w.users;return{...w,total_xp:(E==null?void 0:E.total_xp)??w.total_xp??0,quests_completed:(E==null?void 0:E.quests_completed)??w.quests_completed??0,tokens_earned:(E==null?void 0:E.total_tokens_earned)??w.tokens_earned??0,users:E}});return console.log(`[getLeaderboard] Found ${v.length} entries`),v}async function ove(t){try{const{data:e,error:n}=await Kt.from("users").select("id, total_xp, quests_completed, total_tokens_earned").or("total_xp.gt.0,quests_completed.gt.0");if(n){console.error("[ensureAllUsersInLeaderboard] Error fetching users:",n);return}if(!e||e.length===0){console.log("[ensureAllUsersInLeaderboard] No users with activity found");return}const{data:s,error:l}=await Kt.from("leaderboard").select("user_id").eq("season",t);if(l){console.error("[ensureAllUsersInLeaderboard] Error fetching existing entries:",l);return}const u=new Set((s||[]).map(w=>w.user_id)),p=e.filter(w=>!u.has(w.id));if(p.length===0){console.log("[ensureAllUsersInLeaderboard] All active users already in leaderboard");return}console.log(`[ensureAllUsersInLeaderboard] Adding ${p.length} missing users to leaderboard`);const r=p.map(w=>({user_id:w.id,season:t,total_xp:w.total_xp||0,quests_completed:w.quests_completed||0,tokens_earned:w.total_tokens_earned||0,updated_at:new Date().toISOString()})),{error:v}=await Kt.from("leaderboard").upsert(r,{onConflict:"user_id,season"});v?console.error("[ensureAllUsersInLeaderboard] Error inserting new entries:",v):console.log(`[ensureAllUsersInLeaderboard] Successfully added ${p.length} users`)}catch(e){console.error("[ensureAllUsersInLeaderboard] Error:",e)}}async function PW(t){try{console.log(`[updateLeaderboard] Updating leaderboard for user: ${t}`);const{data:e,error:n}=await Kt.from("users").select("total_xp, quests_completed, total_tokens_earned").eq("id",t).single();if(n){console.error("[updateLeaderboard] Error fetching user stats for leaderboard:",n);return}if(!e){console.warn("[updateLeaderboard] User not found for leaderboard update:",t);return}console.log("[updateLeaderboard] User stats:",{total_xp:e.total_xp,quests_completed:e.quests_completed,total_tokens_earned:e.total_tokens_earned}),await XM(t,"all-time",e);const s=new Date,l=`monthly-${s.getFullYear()}-${s.getMonth()+1}`;await XM(t,l,e);const u=Math.ceil(s.getDate()/7),p=`weekly-${s.getFullYear()}-${s.getMonth()+1}-${u}`;await XM(t,p,e),console.log(`[updateLeaderboard] Successfully updated leaderboard for user: ${t}`)}catch(e){console.error("[updateLeaderboard] Error updating leaderboard:",e)}}async function XM(t,e,n){try{console.log(`[updateSeasonLeaderboard] Updating season ${e} for user ${t}`);const s=typeof n.total_tokens_earned=="string"?parseFloat(n.total_tokens_earned):n.total_tokens_earned||0,l=n.total_xp||0,u=n.quests_completed||0;console.log(`[updateSeasonLeaderboard] Season ${e} stats:`,{total_xp:l,quests_completed:u,tokens_earned:s});const{error:p}=await Kt.from("leaderboard").upsert({user_id:t,season:e,total_xp:l,quests_completed:u,tokens_earned:s,updated_at:new Date().toISOString()},{onConflict:"user_id,season"});if(p){console.error(`[updateSeasonLeaderboard] Error upserting leaderboard for season ${e}:`,p);return}console.log(`[updateSeasonLeaderboard] Successfully upserted entry for season ${e}`);try{const{error:r}=await Kt.rpc("recalculate_leaderboard_ranks",{p_season:e});r?(console.warn(`[updateSeasonLeaderboard] RPC recalculate_leaderboard_ranks not available, using fallback for ${e}:`,r),await pI(e)):console.log(`[updateSeasonLeaderboard] Successfully recalculated ranks using RPC for season ${e}`)}catch(r){console.warn("[updateSeasonLeaderboard] Error using RPC for rank recalculation, using fallback:",r),await pI(e)}}catch(s){console.error(`[updateSeasonLeaderboard] Error updating season leaderboard for ${e}:`,s)}}async function pI(t){try{console.log(`[recalculateRanksManually] Recalculating ranks for season: ${t}`);const{data:e,error:n}=await Kt.from("leaderboard").select(`
        id,
        user_id,
        total_xp,
        quests_completed,
        tokens_earned,
        users (
          total_xp,
          quests_completed,
          total_tokens_earned
        )
      `).eq("season",t);if(n){console.error(`[recalculateRanksManually] Error fetching leaderboard entries for season ${t}:`,n);return}if(!e||e.length===0){console.log(`[recalculateRanksManually] No entries found for season ${t}`);return}const s=e.map(async r=>{const v=Array.isArray(r.users)?r.users[0]:r.users;if(v){const w=Number(v.total_xp??0),E=Number(v.quests_completed??0),T=Number(v.total_tokens_earned??0);if(w!==r.total_xp||E!==r.quests_completed||T!==Number(r.tokens_earned))return Kt.from("leaderboard").update({total_xp:w,quests_completed:E,tokens_earned:T,updated_at:new Date().toISOString()}).eq("id",r.id)}return null});await Promise.all(s.filter(r=>r!==null));const l=[...e].sort((r,v)=>{const w=Array.isArray(r.users)?r.users[0]:r.users,E=Array.isArray(v.users)?v.users[0]:v.users,T=Number((w==null?void 0:w.total_xp)??r.total_xp??0),k=Number((E==null?void 0:E.total_xp)??v.total_xp??0);if(k!==T)return k-T;const R=Number((w==null?void 0:w.quests_completed)??r.quests_completed??0),D=Number((E==null?void 0:E.quests_completed)??v.quests_completed??0);if(D!==R)return D-R;const O=Number((w==null?void 0:w.total_tokens_earned)??r.tokens_earned??0);return Number((E==null?void 0:E.total_tokens_earned)??v.tokens_earned??0)-O});l.length>0&&console.log("[recalculateRanksManually] Sample sorted entries (first 3):",l.slice(0,3).map((r,v)=>{var E;const w=Array.isArray(r.users)?r.users[0]:r.users;return{rank:v+1,user_id:(E=r.user_id)==null?void 0:E.slice(0,8),xp:Number((w==null?void 0:w.total_xp)??r.total_xp??0),quests:Number((w==null?void 0:w.quests_completed)??r.quests_completed??0)}})),console.log(`[recalculateRanksManually] Sorted ${l.length} entries for season ${t}`);const u=l.map((r,v)=>({id:r.id,rank:v+1})),p=50;for(let r=0;r<u.length;r+=p){const w=u.slice(r,r+p).map(k=>Kt.from("leaderboard").update({rank:k.rank}).eq("id",k.id)),T=(await Promise.all(w)).filter(k=>k.error);T.length>0&&console.error(`[recalculateRanksManually] Errors updating ranks for batch ${r/p+1}:`,T)}console.log(`[recalculateRanksManually] Successfully recalculated ranks for season ${t}`)}catch(e){console.error(`[recalculateRanksManually] Error recalculating ranks for season ${t}:`,e)}}async function ave(t,e="all-time"){let n=e;if(e==="monthly"){const u=new Date;n=`monthly-${u.getFullYear()}-${u.getMonth()+1}`}else if(e==="weekly"){const u=new Date,p=Math.ceil(u.getDate()/7);n=`weekly-${u.getFullYear()}-${u.getMonth()+1}-${p}`}console.log(`[getUserRank] Fetching rank for user: ${t}, season: ${n}`);const{data:s,error:l}=await Kt.from("leaderboard").select("rank, total_xp, quests_completed, tokens_earned").eq("user_id",t).eq("season",n).maybeSingle();if(l)return console.error("[getUserRank] Error fetching user rank:",l),null;if(!s){console.warn(`[getUserRank] No leaderboard entry found for user ${t} in season ${n}`);try{console.log(`[getUserRank] Attempting to create leaderboard entry for user ${t}`),await PW(t);const{data:u}=await Kt.from("leaderboard").select("rank").eq("user_id",t).eq("season",n).maybeSingle();return(u==null?void 0:u.rank)||null}catch(u){return console.error("[getUserRank] Error updating leaderboard:",u),null}}return console.log(`[getUserRank] User rank found: ${s.rank}`),s.rank||null}async function lve(t="all-time"){let e=t;if(t==="monthly"){const l=new Date;e=`monthly-${l.getFullYear()}-${l.getMonth()+1}`}else if(t==="weekly"){const l=new Date,u=Math.ceil(l.getDate()/7);e=`weekly-${l.getFullYear()}-${l.getMonth()+1}-${u}`}console.log(`[getLeaderboardCount] Fetching count for season: ${e}`);const{count:n,error:s}=await Kt.from("leaderboard").select("*",{count:"exact",head:!0}).eq("season",e);return s?(console.error("[getLeaderboardCount] Error fetching count:",s),console.error("[getLeaderboardCount] Error details:",JSON.stringify(s,null,2)),0):(console.log(`[getLeaderboardCount] Found ${n||0} entries for season ${e}`),n||0)}async function RW(t,e){const{data:n,error:s}=await Kt.from("user_quests").select("user_id").eq("id",t).single();if(s)throw new Error(`Quest not found: ${s.message}`);if(n.user_id!==e)throw new Error("You do not have permission to delete this quest");const{error:l}=await Kt.from("user_quests").delete().eq("id",t).eq("user_id",e);if(l)throw new Error(`Failed to delete quest: ${l.message}`)}async function NW(){const{data:t,error:e}=await Kt.from("quests").select("*").eq("is_permanent",!0).eq("is_active",!0).order("reward_xp",{ascending:!1});return e?(console.error("Error fetching global quests:",e),[]):t||[]}async function jW(t,e){const{data:n,error:s}=await Kt.from("trips").select("id").eq("user_id",t);if(s||!n||n.length===0)return[];const l=n.map(r=>r.id),{data:u,error:p}=await Kt.from("quests").select("*").eq("is_permanent",!1).eq("is_active",!0).in("trip_id",l).order("created_at",{ascending:!1});return p?(console.error("Error fetching trip quests:",p),[]):u||[]}async function DW(t){console.log("[getQuestById] Fetching quest:",t);const{data:e,error:n}=await Kt.from("quests").select("*").eq("id",t).maybeSingle();return n?(console.error("[getQuestById] Error fetching quest:",n),null):e?(console.log("[getQuestById] Quest found:",{id:e.id,title:e.title}),e):(console.warn("[getQuestById] No quest found with ID:",t),null)}async function IN(t,e){console.log("[startQuest] Starting quest:",{userId:t,questId:e});const n=await DW(e);if(console.log("[startQuest] Quest lookup result:",n?{id:n.id,title:n.title}:"null"),!n)throw console.error("[startQuest] Quest not found in database:",e),new Error("Quest not found");const{data:s}=await Kt.from("users").select("level").eq("id",t).maybeSingle();if(console.log("[startQuest] User level:",s==null?void 0:s.level,"Required:",n.min_level),s&&n.min_level&&s.level<n.min_level)throw new Error(`You need to be level ${n.min_level} to start this quest`);const{data:l}=await Kt.from("user_quests").select("id").eq("user_id",t).eq("quest_id",e).maybeSingle();if(l)throw console.log("[startQuest] Quest already started"),new Error("You have already started this quest");console.log("[startQuest] Inserting into user_quests...");const{error:u}=await Kt.from("user_quests").insert({user_id:t,quest_id:e,status:"in_progress",created_at:new Date().toISOString()});if(u)throw console.error("[startQuest] Insert error:",u),new Error(`Failed to start quest: ${u.message}`);console.log("[startQuest] Quest started successfully!")}async function cve(t,e){console.log("[addQuestToUser] Adding quest:",e.id,"for user:",t);const{data:n}=await Kt.from("quests").select("id").eq("id",e.id).maybeSingle();if(!n){console.log("[addQuestToUser] Creating new quest in database:",e.id);const u={easy:1,medium:2,hard:3,legendary:4},{error:p}=await Kt.from("quests").insert({id:e.id,title:e.title,description:e.description,location:e.location,latitude:e.latitude,longitude:e.longitude,difficulty:u[e.difficulty]||2,reward_tokens:e.token_reward,reward_xp:e.xp_reward,nft_reward:e.nft_reward,quest_type:"halloween",is_active:!0,is_permanent:!1,completion_requirements:{requirements:e.requirements},created_at:new Date().toISOString()});p&&console.error("[addQuestToUser] Error creating quest:",p)}const{data:s}=await Kt.from("user_quests").select("id").eq("user_id",t).eq("quest_id",e.id).maybeSingle();if(s){console.log("[addQuestToUser] User already has this quest");return}const{error:l}=await Kt.from("user_quests").insert({user_id:t,quest_id:e.id,status:"in_progress",created_at:new Date().toISOString()});if(l)throw console.error("[addQuestToUser] Error adding quest to user:",l),new Error(`Failed to add quest: ${l.message}`);console.log("[addQuestToUser] Quest added successfully!")}const uve=Object.freeze(Object.defineProperty({__proto__:null,addQuestToUser:cve,deleteUserQuest:RW,getGlobalQuests:NW,getQuestById:DW,getTripQuests:jW,startQuest:IN},Symbol.toStringTag,{value:"Module"})),LW=({quest:t,onClose:e,onShowOnMap:n,onAcceptQuest:s})=>{const{user:l}=ba(),{user:u}=El(),p=l||u,[r,v]=he.useState(!1),[w,E]=he.useState(!1),[T,k]=he.useState(null);he.useEffect(()=>{const X=W=>{W.key==="Escape"&&!r&&e()};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[e,r]);const R=async()=>{if(!p||!t){k({type:"error",message:"Please connect your wallet or sign in to accept quests"}),setTimeout(()=>k(null),3e3);return}console.log("[QuestDetailsModal] Accepting quest:",{userId:p.id,questId:t.id,questTitle:t.title}),v(!0);try{await IN(p.id,t.id),console.log("[QuestDetailsModal] Quest accepted successfully!"),s&&s(t),k({type:"success",message:' Quest accepted! Check "My Quests" to track your progress.'}),setTimeout(()=>{k(null),e()},2e3)}catch(X){console.error("[QuestDetailsModal] Error accepting quest:",X),k({type:"error",message:X.message||"Failed to accept quest. Please try again."}),setTimeout(()=>k(null),4e3)}finally{v(!1)}},D=()=>{t&&n&&(e(),setTimeout(()=>{n(t),window.scrollTo({top:0,behavior:"smooth"})},200))},O=()=>{t&&(window.dispatchEvent(new CustomEvent("navigateToTransit",{detail:{to:t.location,toCoords:{lat:t.latitude,lng:t.longitude}}})),e())},F=()=>{if(t&&t.latitude&&t.longitude){const X=`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t.latitude},${t.longitude}`;window.open(X,"_blank")}};if(!t)return null;const U=["from-green-500/30 to-emerald-500/30 border-green-400/40 text-green-300","from-blue-500/30 to-cyan-500/30 border-blue-400/40 text-blue-300","from-yellow-500/30 to-amber-500/30 border-yellow-400/40 text-yellow-300","from-orange-500/30 to-red-500/30 border-orange-400/40 text-orange-300","from-red-500/30 to-pink-500/30 border-red-400/40 text-red-300"];return f.jsx("div",{className:"fixed inset-0 z-[9999] overflow-y-auto bg-black/80 backdrop-blur-sm",onClick:e,style:{display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:"2rem",paddingBottom:"2rem"},children:f.jsxs("div",{className:"relative w-full max-w-2xl bg-gradient-to-br from-slate-900/98 via-slate-800/98 to-slate-900/98 rounded-3xl border border-white/30 shadow-2xl mx-4",style:{maxHeight:"calc(100vh - 4rem)",overflowY:"auto",marginTop:`${window.scrollY}px`},onClick:X=>X.stopPropagation(),children:[f.jsx("button",{onClick:e,className:"absolute top-4 right-4 z-20 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/30 flex items-center justify-center text-white transition-all",children:f.jsx(Qa,{className:"w-5 h-5"})}),f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"pb-3 border-b border-white/20 mb-4",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-3 pr-12",children:t.title}),t.nft_reward&&f.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-purple-500/40 to-pink-500/40 border border-purple-400/50 mb-2",children:[f.jsx(Ho,{className:"w-4 h-4 text-purple-200"}),f.jsx("span",{className:"text-sm font-bold text-purple-200",children:"NFT Reward Available"})]}),f.jsxs("div",{className:"flex items-center gap-2 text-white/70",children:[f.jsx(Mo,{className:"w-4 h-4 text-cyan-400"}),f.jsx("span",{className:"text-sm font-medium",children:t.location})]})]}),f.jsx("div",{className:"bg-white/10 rounded-xl p-4 border border-white/20 mb-4",children:f.jsx("p",{className:"text-white/80 leading-relaxed text-sm",children:t.description})}),f.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[f.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-amber-500/20 to-yellow-500/10 border border-amber-400/30",children:f.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[f.jsx(Ya,{className:"w-5 h-5 text-amber-400"}),f.jsx("p",{className:"text-sm font-bold text-white",children:t.reward_tokens}),f.jsx("p",{className:"text-xs text-amber-200/80",children:"TPX"})]})}),f.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/10 border border-cyan-400/30",children:f.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[f.jsx(md,{className:"w-5 h-5 text-cyan-400"}),f.jsx("p",{className:"text-sm font-bold text-white",children:t.reward_xp}),f.jsx("p",{className:"text-xs text-cyan-200/80",children:"XP"})]})}),f.jsxs("div",{className:`p-3 rounded-xl border flex flex-col items-center justify-center bg-gradient-to-br ${U[Math.min(t.difficulty-1,4)]}`,children:[f.jsx(Ja,{className:"w-5 h-5"}),f.jsxs("p",{className:"text-xs font-semibold mt-1.5",children:["Level ",t.difficulty]})]})]}),f.jsxs("div",{className:"space-y-3 pt-3 border-t border-white/20",children:[n&&f.jsxs("button",{onClick:D,className:"w-full py-3 px-4 rounded-xl font-semibold text-white bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 hover:border-blue-400/40 transition-all flex items-center justify-center gap-2 text-sm",children:[f.jsx(Mv,{className:"w-4 h-4"}),f.jsx("span",{children:"View on Map"})]}),t.latitude&&t.longitude&&f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("button",{onClick:O,className:"py-3 px-3 rounded-xl font-semibold text-white bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 hover:border-green-400/40 transition-all flex items-center justify-center gap-2 text-sm",children:[f.jsx(Mv,{className:"w-4 h-4"}),f.jsx("span",{children:"Get Route"})]}),f.jsxs("button",{onClick:F,className:"py-3 px-3 rounded-xl font-semibold text-white bg-purple-500/20 hover:bg-purple-500/30 border border-purple-400/30 hover:border-purple-400/40 transition-all flex items-center justify-center gap-2 text-sm",children:[f.jsx(Ep,{className:"w-4 h-4"}),f.jsx("span",{children:"Street View"})]})]}),f.jsx("button",{onClick:R,disabled:r,className:"w-full py-4 px-4 rounded-xl font-bold text-lg text-white bg-gradient-to-r from-emerald-500/90 to-cyan-500/90 hover:from-emerald-500 hover:to-cyan-500 border border-emerald-400/50 hover:border-emerald-400/70 transition-all flex items-center justify-center gap-2 shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed",children:r?f.jsxs(f.Fragment,{children:[f.jsx(Mv,{className:"w-5 h-5 animate-spin"}),f.jsx("span",{children:"Accepting Quest..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(la,{className:"w-5 h-5"}),f.jsx("span",{children:p?"Accept Quest":"Sign In to Accept"})]})})]})]}),T&&f.jsx("div",{className:`absolute bottom-4 left-4 right-4 p-4 rounded-xl backdrop-blur-2xl border shadow-2xl ${T.type==="success"?"bg-gradient-to-r from-emerald-500/90 to-green-500/90 border-emerald-400/50":"bg-gradient-to-r from-red-500/90 to-rose-500/90 border-red-400/50"}`,children:f.jsx("p",{className:"text-white font-semibold text-sm text-center",children:T.message})})]})})};var QT={exports:{}},dve=QT.exports,pz;function hve(){return pz||(pz=1,(function(t,e){(function(n,s){t.exports=s()})(dve,(function(){var n,s,l;function u(r,v){if(!n)n=v;else if(!s)s=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",E={};n(E),l=v(E),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],(function(r){var v=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function E(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=a*x-m*h;return _?(c[0]=x*(_=1/_),c[1]=-h*_,c[2]=-m*_,c[3]=a*_,c):null}function T(){var c=new w(9);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function k(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=i[4],A=i[5],P=i[6],N=i[7],V=i[8];return c[0]=_*V-A*N,c[1]=m*N-h*V,c[2]=h*A-m*_,c[3]=A*P-x*V,c[4]=a*V-m*P,c[5]=m*x-a*A,c[6]=x*N-_*P,c[7]=h*P-a*N,c[8]=a*_-h*x,c}function R(c,i,a){var h=i[0],m=i[1],x=i[2],_=i[3],A=i[4],P=i[5],N=i[6],V=i[7],H=i[8],G=a[0],Y=a[1],J=a[2],oe=a[3],ue=a[4],pe=a[5],we=a[6],Te=a[7],Ie=a[8];return c[0]=G*h+Y*_+J*N,c[1]=G*m+Y*A+J*V,c[2]=G*x+Y*P+J*H,c[3]=oe*h+ue*_+pe*N,c[4]=oe*m+ue*A+pe*V,c[5]=oe*x+ue*P+pe*H,c[6]=we*h+Te*_+Ie*N,c[7]=we*m+Te*A+Ie*V,c[8]=we*x+Te*P+Ie*H,c}function D(){var c=new w(16);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function O(c){var i=new w(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i}function F(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function U(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=i[4],A=i[5],P=i[6],N=i[7],V=i[8],H=i[9],G=i[10],Y=i[11],J=i[12],oe=i[13],ue=i[14],pe=i[15],we=a*A-h*_,Te=a*P-m*_,Ie=a*N-x*_,Ze=h*P-m*A,Ve=h*N-x*A,Ye=m*N-x*P,nt=V*oe-H*J,ot=V*ue-G*J,Ot=V*pe-Y*J,pt=H*ue-G*oe,Ut=H*pe-Y*oe,Zt=G*pe-Y*ue,en=we*Zt-Te*Ut+Ie*pt+Ze*Ot-Ve*ot+Ye*nt;return en?(c[0]=(A*Zt-P*Ut+N*pt)*(en=1/en),c[1]=(m*Ut-h*Zt-x*pt)*en,c[2]=(oe*Ye-ue*Ve+pe*Ze)*en,c[3]=(G*Ve-H*Ye-Y*Ze)*en,c[4]=(P*Ot-_*Zt-N*ot)*en,c[5]=(a*Zt-m*Ot+x*ot)*en,c[6]=(ue*Ie-J*Ye-pe*Te)*en,c[7]=(V*Ye-G*Ie+Y*Te)*en,c[8]=(_*Ut-A*Ot+N*nt)*en,c[9]=(h*Ot-a*Ut-x*nt)*en,c[10]=(J*Ve-oe*Ie+pe*we)*en,c[11]=(H*Ie-V*Ve-Y*we)*en,c[12]=(A*ot-_*pt-P*nt)*en,c[13]=(a*pt-h*ot+m*nt)*en,c[14]=(oe*Te-J*Ze-ue*we)*en,c[15]=(V*Ze-H*Te+G*we)*en,c):null}function X(c,i,a){var h=i[0],m=i[1],x=i[2],_=i[3],A=i[4],P=i[5],N=i[6],V=i[7],H=i[8],G=i[9],Y=i[10],J=i[11],oe=i[12],ue=i[13],pe=i[14],we=i[15],Te=a[0],Ie=a[1],Ze=a[2],Ve=a[3];return c[0]=Te*h+Ie*A+Ze*H+Ve*oe,c[1]=Te*m+Ie*P+Ze*G+Ve*ue,c[2]=Te*x+Ie*N+Ze*Y+Ve*pe,c[3]=Te*_+Ie*V+Ze*J+Ve*we,c[4]=(Te=a[4])*h+(Ie=a[5])*A+(Ze=a[6])*H+(Ve=a[7])*oe,c[5]=Te*m+Ie*P+Ze*G+Ve*ue,c[6]=Te*x+Ie*N+Ze*Y+Ve*pe,c[7]=Te*_+Ie*V+Ze*J+Ve*we,c[8]=(Te=a[8])*h+(Ie=a[9])*A+(Ze=a[10])*H+(Ve=a[11])*oe,c[9]=Te*m+Ie*P+Ze*G+Ve*ue,c[10]=Te*x+Ie*N+Ze*Y+Ve*pe,c[11]=Te*_+Ie*V+Ze*J+Ve*we,c[12]=(Te=a[12])*h+(Ie=a[13])*A+(Ze=a[14])*H+(Ve=a[15])*oe,c[13]=Te*m+Ie*P+Ze*G+Ve*ue,c[14]=Te*x+Ie*N+Ze*Y+Ve*pe,c[15]=Te*_+Ie*V+Ze*J+Ve*we,c}function W(c,i,a){var h,m,x,_,A,P,N,V,H,G,Y,J,oe=a[0],ue=a[1],pe=a[2];return i===c?(c[12]=i[0]*oe+i[4]*ue+i[8]*pe+i[12],c[13]=i[1]*oe+i[5]*ue+i[9]*pe+i[13],c[14]=i[2]*oe+i[6]*ue+i[10]*pe+i[14],c[15]=i[3]*oe+i[7]*ue+i[11]*pe+i[15]):(m=i[1],x=i[2],_=i[3],A=i[4],P=i[5],N=i[6],V=i[7],H=i[8],G=i[9],Y=i[10],J=i[11],c[0]=h=i[0],c[1]=m,c[2]=x,c[3]=_,c[4]=A,c[5]=P,c[6]=N,c[7]=V,c[8]=H,c[9]=G,c[10]=Y,c[11]=J,c[12]=h*oe+A*ue+H*pe+i[12],c[13]=m*oe+P*ue+G*pe+i[13],c[14]=x*oe+N*ue+Y*pe+i[14],c[15]=_*oe+V*ue+J*pe+i[15]),c}function K(c,i,a){var h=a[0],m=a[1],x=a[2];return c[0]=i[0]*h,c[1]=i[1]*h,c[2]=i[2]*h,c[3]=i[3]*h,c[4]=i[4]*m,c[5]=i[5]*m,c[6]=i[6]*m,c[7]=i[7]*m,c[8]=i[8]*x,c[9]=i[9]*x,c[10]=i[10]*x,c[11]=i[11]*x,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c}function ne(c,i,a){var h=Math.sin(a),m=Math.cos(a),x=i[4],_=i[5],A=i[6],P=i[7],N=i[8],V=i[9],H=i[10],G=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=x*m+N*h,c[5]=_*m+V*h,c[6]=A*m+H*h,c[7]=P*m+G*h,c[8]=N*m-x*h,c[9]=V*m-_*h,c[10]=H*m-A*h,c[11]=G*m-P*h,c}function te(c,i,a){var h=Math.sin(a),m=Math.cos(a),x=i[0],_=i[1],A=i[2],P=i[3],N=i[8],V=i[9],H=i[10],G=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=x*m-N*h,c[1]=_*m-V*h,c[2]=A*m-H*h,c[3]=P*m-G*h,c[8]=x*h+N*m,c[9]=_*h+V*m,c[10]=A*h+H*m,c[11]=P*h+G*m,c}function re(c,i,a){var h=Math.sin(a),m=Math.cos(a),x=i[0],_=i[1],A=i[2],P=i[3],N=i[4],V=i[5],H=i[6],G=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=x*m+N*h,c[1]=_*m+V*h,c[2]=A*m+H*h,c[3]=P*m+G*h,c[4]=N*m-x*h,c[5]=V*m-_*h,c[6]=H*m-A*h,c[7]=G*m-P*h,c}function xe(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ae(c,i,a){var h,m,x,_=a[0],A=a[1],P=a[2],N=Math.sqrt(_*_+A*A+P*P);return N<v?null:(_*=N=1/N,A*=N,P*=N,h=Math.sin(i),m=Math.cos(i),c[0]=_*_*(x=1-m)+m,c[1]=A*_*x+P*h,c[2]=P*_*x-A*h,c[3]=0,c[4]=_*A*x-P*h,c[5]=A*A*x+m,c[6]=P*A*x+_*h,c[7]=0,c[8]=_*P*x+A*h,c[9]=A*P*x-_*h,c[10]=P*P*x+m,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function ce(c,i){var a=i[0],h=i[1],m=i[2],x=i[4],_=i[5],A=i[6],P=i[8],N=i[9],V=i[10];return c[0]=Math.sqrt(a*a+h*h+m*m),c[1]=Math.sqrt(x*x+_*_+A*A),c[2]=Math.sqrt(P*P+N*N+V*V),c}function ye(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=a+a,A=h+h,P=m+m,N=a*_,V=h*_,H=h*A,G=m*_,Y=m*A,J=m*P,oe=x*_,ue=x*A,pe=x*P;return c[0]=1-H-J,c[1]=V+pe,c[2]=G-ue,c[3]=0,c[4]=V-pe,c[5]=1-N-J,c[6]=Y+oe,c[7]=0,c[8]=G+ue,c[9]=Y-oe,c[10]=1-N-H,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}var Ce=X;function Me(){var c=new w(3);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Ke(c){var i=new w(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i}function ke(c){var i=c[0],a=c[1],h=c[2];return Math.sqrt(i*i+a*a+h*h)}function je(c,i,a){var h=new w(3);return h[0]=c,h[1]=i,h[2]=a,h}function $e(c,i,a,h){return c[0]=i,c[1]=a,c[2]=h,c}function Ae(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c[2]=i[2]+a[2],c}function He(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c[2]=i[2]-a[2],c}function qe(c,i,a){return c[0]=i[0]*a[0],c[1]=i[1]*a[1],c[2]=i[2]*a[2],c}function Le(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c}function st(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c}function bt(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c}function yt(c,i,a,h){return c[0]=i[0]+a[0]*h,c[1]=i[1]+a[1]*h,c[2]=i[2]+a[2]*h,c}function Vt(c,i){var a=i[0]-c[0],h=i[1]-c[1],m=i[2]-c[2];return Math.sqrt(a*a+h*h+m*m)}function _t(c,i){var a=i[0]-c[0],h=i[1]-c[1],m=i[2]-c[2];return a*a+h*h+m*m}function vt(c){var i=c[0],a=c[1],h=c[2];return i*i+a*a+h*h}function qt(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c}function kt(c,i){var a=i[0],h=i[1],m=i[2],x=a*a+h*h+m*m;return x>0&&(x=1/Math.sqrt(x)),c[0]=i[0]*x,c[1]=i[1]*x,c[2]=i[2]*x,c}function on(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]}function mn(c,i,a){var h=i[0],m=i[1],x=i[2],_=a[0],A=a[1],P=a[2];return c[0]=m*P-x*A,c[1]=x*_-h*P,c[2]=h*A-m*_,c}function Hr(c,i,a,h){var m=i[0],x=i[1],_=i[2];return c[0]=m+h*(a[0]-m),c[1]=x+h*(a[1]-x),c[2]=_+h*(a[2]-_),c}function Un(c,i,a){var h=i[0],m=i[1],x=i[2],_=a[3]*h+a[7]*m+a[11]*x+a[15];return c[0]=(a[0]*h+a[4]*m+a[8]*x+a[12])/(_=_||1),c[1]=(a[1]*h+a[5]*m+a[9]*x+a[13])/_,c[2]=(a[2]*h+a[6]*m+a[10]*x+a[14])/_,c}function $r(c,i,a){var h=i[0],m=i[1],x=i[2];return c[0]=h*a[0]+m*a[3]+x*a[6],c[1]=h*a[1]+m*a[4]+x*a[7],c[2]=h*a[2]+m*a[5]+x*a[8],c}function ht(c,i,a){var h=a[0],m=a[1],x=a[2],_=a[3],A=i[0],P=i[1],N=i[2],V=m*N-x*P,H=x*A-h*N,G=h*P-m*A;return c[0]=A+_*(V+=V)+m*(G+=G)-x*(H+=H),c[1]=P+_*H+x*V-h*G,c[2]=N+_*G+h*H-m*V,c}function Lr(c){return c[0]=0,c[1]=0,c[2]=0,c}function Br(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]}var wn=He,Nn=qe,mr=ke;function Qn(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Nt(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c[3]=i[3]*a,c}function et(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=a*a+h*h+m*m+x*x;return _>0&&(_=1/Math.sqrt(_)),c[0]=a*_,c[1]=h*_,c[2]=m*_,c[3]=x*_,c}function Oe(c,i,a){var h=i[0],m=i[1],x=i[2],_=i[3];return c[0]=a[0]*h+a[4]*m+a[8]*x+a[12]*_,c[1]=a[1]*h+a[5]*m+a[9]*x+a[13]*_,c[2]=a[2]*h+a[6]*m+a[10]*x+a[14]*_,c[3]=a[3]*h+a[7]*m+a[11]*x+a[15]*_,c}function Bt(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function En(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Dn(c,i,a){a*=.5;var h=i[0],m=i[1],x=i[2],_=i[3],A=Math.sin(a),P=Math.cos(a);return c[0]=h*P+_*A,c[1]=m*P+x*A,c[2]=x*P-m*A,c[3]=_*P-h*A,c}function rn(c,i,a){a*=.5;var h=i[0],m=i[1],x=i[2],_=i[3],A=Math.sin(a),P=Math.cos(a);return c[0]=h*P-x*A,c[1]=m*P+_*A,c[2]=x*P+h*A,c[3]=_*P-m*A,c}Me(),Qn();var wr,cr,Jn,ir=et,bn=(wr=Me(),cr=je(1,0,0),Jn=je(0,1,0),function(c,i,a){var h=on(i,a);return h<-.999999?(mn(wr,cr,i),mr(wr)<1e-6&&mn(wr,Jn,i),kt(wr,wr),(function(m,x,_){_*=.5;var A=Math.sin(_);m[0]=A*x[0],m[1]=A*x[1],m[2]=A*x[2],m[3]=Math.cos(_)})(c,wr,Math.PI),c):h>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(mn(wr,i,a),c[0]=wr[0],c[1]=wr[1],c[2]=wr[2],c[3]=1+h,ir(c,c))});function In(){var c=new w(2);return w!=Float32Array&&(c[0]=0,c[1]=0),c}function Zr(c,i){var a=new w(2);return a[0]=c,a[1]=i,a}function Vr(c,i,a){return c[0]=i,c[1]=a,c}function qn(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c}function Kn(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c}function St(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c}function Gn(c){var i=c[0],a=c[1];return Math.sqrt(i*i+a*a)}function er(c,i){var a=i[0],h=i[1],m=a*a+h*h;return m>0&&(m=1/Math.sqrt(m)),c[0]=i[0]*m,c[1]=i[1]*m,c}function gr(c,i){return c[0]*i[0]+c[1]*i[1]}Bt(),Bt(),T();var nr,ln,Tr=Kn;function ni(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}In();var Yi=(function(){if(ln)return nr;function c(i,a,h,m){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=h,this.p2y=m}return ln=1,nr=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,m=0;m<8;m++){var x=this.sampleCurveX(h)-i;if(Math.abs(x)<a)return h;var _=this.sampleCurveDerivativeX(h);if(Math.abs(_)<1e-6)break;h-=x/_}var A=0,P=1;for(h=i,m=0;m<20&&(x=this.sampleCurveX(h),!(Math.abs(x-i)<a));m++)i>x?A=h:P=h,h=.5*(P-A)+A;return h},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},nr})(),ns=ni(Yi);function Ht(c,i){this.x=c,this.y=i}function cs(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!cs(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const a in c)if(!cs(c[a],i[a]))return!1;return!0}return c===i}Ht.prototype={clone(){return new Ht(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,i){return this.clone()._rotateAround(c,i)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const i=c.x-this.x,a=c.y-this.y;return i*i+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,i){return Math.atan2(this.x*i-this.y*c,this.x*c+this.y*i)},_matMult(c){const i=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=i,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const i=Math.cos(c),a=Math.sin(c),h=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=h,this},_rotateAround(c,i){const a=Math.cos(c),h=Math.sin(c),m=i.y+h*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-h*(this.y-i.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ht},Ht.convert=function(c){if(c instanceof Ht)return c;if(Array.isArray(c))return new Ht(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new Ht(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const rl=Math.PI/180,ho=180/Math.PI;function Qr(c){return c*rl}function Rs(c){return c*ho}const ea=[[0,0],[1,0],[1,1],[0,1]];function Hl(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,a=i*c;return 4*(c<.5?a:3*(c-i)+a-.75)}function ut(c,i,a,h){const m=new ns(c,i,a,h);return function(x){return m.solve(x)}}const me=ut(.25,.1,.25,1);function ve(c,i,a){return Math.min(a,Math.max(i,c))}function Fe(c,i,a){return(a=ve((a-c)/(i-c),0,1))*a*(3-2*a)}function tt(c,i,a){const h=a-i,m=((c-i)%h+h)%h+i;return m===i?a:m}function Je(c,i,a){if(!c.length)return a(null,[]);let h=c.length;const m=new Array(c.length);let x=null;c.forEach(((_,A)=>{i(_,((P,N)=>{P&&(x=P),m[A]=N,--h==0&&a(x,m)}))}))}let at=1;function Pt(){return at++}function ct(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log2(c)))}function Ct(c,i){c.forEach((a=>{i[a]&&(i[a]=i[a].bind(i))}))}function un(c,i,a){const h={};for(const m in c)h[m]=i.call(this,c[m],m,c);return h}function tn(c,i,a){const h={};for(const m in c)i.call(this,c[m],m,c)&&(h[m]=c[m]);return h}function Re(c){return Array.isArray(c)?c.map(Re):typeof c=="object"&&c?un(c,Re):c}function gt(c,i){for(let a=0;a<c.length;a++)if(i.indexOf(c[a])>=0)return!0;return!1}const wt={};function It(c){wt[c]||(typeof console<"u"&&console.warn(c),wt[c]=!0)}function Et(c,i,a){return(a.y-c.y)*(i.x-c.x)>(i.y-c.y)*(a.x-c.x)}function Sn(c){let i=0;for(let a,h,m=0,x=c.length,_=x-1;m<x;_=m++)a=c[m],h=c[_],i+=(h.x-a.x)*(a.y+h.y);return i}function Hn([c,i,a]){const h=Qr(i+90),m=Qr(a);return{x:c*Math.cos(h)*Math.sin(m),y:c*Math.sin(h)*Math.sin(m),z:c*Math.cos(m),azimuthal:i,polar:a}}function xr(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function vr(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,h,m,x)=>{const _=m||x;return i[h]=!_||_.toLowerCase(),""})),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let jr=null;function Er(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function fr(c,i,a,h){for(;i<a;){const m=i+a>>1;c[m]<h?i=m+1:a=m}return i}function ur(c,i,a,h){for(;i<a;){const m=i+a>>1;c[m]<=h?i=m+1:a=m}return i}function ai(c){return c>0?1/(1.001-c):1+c}function vi(c){return c>0?1-1/(1.001-c):-c}function li(c,i,a){return(c-i.min)*(a.max-a.min)/(i.max-i.min)+a.min}const ii={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ii.API_URL)return null;try{const c=new URL(ii.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Or(c){return ii.API_URL_REGEX.test(c)}function Qi(c){return ii.API_SPRITE_REGEX.test(c)}let Ni,ko,Gs,Zs,mo,ds;function Is(){return Ni==null&&(Ni=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ni}const eo={now:()=>Zs!==void 0?Zs:performance.now(),setNow(c){Zs=c},restoreNow(){Zs=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:a,height:h}=c;mo||(mo=document.createElement("canvas"));const m=mo.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(a>mo.width||h>mo.height)&&(mo.width=a,mo.height=h),m.clearRect(-i,-i,a+2*i,h+2*i),m.drawImage(c,0,0,a,h),m.getImageData(-i,-i,a+2*i,h+2*i)},resolveURL:c=>(ko||(ko=document.createElement("a")),ko.href=c,ko.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Gs==null&&(Gs=window.matchMedia("(prefers-reduced-motion: reduce)")),Gs.matches)},hasCanvasFingerprintNoise(){if(ds!==void 0)return ds;if(!Is())return ds=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let m=0;m<c.width;++m)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(m,0,1,1);const h=i.getImageData(0,0,c.width,c.height);a=0;for(let m=0;m<h.data.length;++m)if(m%4!=3&&a++!==h.data[m])return ds=!0,!0;return ds=!1,!1}};function wo(c,i){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(i).toString()}`;const h=new URLSearchParams(c.slice(a));for(const m in i)h.set(m,i[m]);return`${c.slice(0,a)}?${h.toString()}`}function ji(c,i={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const h=new URLSearchParams,m=new URLSearchParams(c.slice(a));for(const _ of i.persistentParams){const A=m.get(_);A&&h.set(_,A)}const x=h.toString();return`${c.slice(0,a)}${x.length>0?`?${x}`:""}`}const Zc="mapbox-tiles";let il=500,ca=50;const Gl=["language","worldview","jobid"];let ua,sl;function mc(){try{return caches}catch{}}function Qc(){const c=mc();c&&ua==null&&(ua=c.open(Zc))}let gc=1/0;const yc={supported:!1,testSupport:function(c){!ch&&$l&&(Cu?hg(c):da=c)}};let da,$l,ch=!1,Cu=!1;const Wl=typeof self<"u"?self:{};function hg(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,$l),c.isContextLost())return;yc.supported=!0}catch{}c.deleteTexture(i),ch=!0}Wl.document&&($l=Wl.document.createElement("img"),$l.onload=function(){da&&hg(da),da=null,Cu=!0},$l.onerror=function(){ch=!0,da=null},$l.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const xc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(xc);class uh extends Error{constructor(i,a,h){a===401&&Or(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fg=xr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xd=function(c,i){if(!(/^file:/.test(a=c.url)||/^file:/.test(fg())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(h,m){const x=new AbortController,_=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:fg(),referrerPolicy:h.referrerPolicy,signal:x.signal});let A=!1,P=!1;const N=(V=_.url).indexOf("sku=")>0&&Or(V);var V;h.type==="json"&&_.headers.set("Accept","application/json");const H=(Y,J,oe)=>{if(P)return;if(Y&&Y.message!=="SecurityError"&&It(Y.toString()),J&&oe)return G(J);const ue=Date.now();fetch(_).then((pe=>{if(pe.ok){const we=N?pe.clone():null;return G(pe,we,ue)}return m(new uh(pe.statusText,pe.status,h.url))})).catch((pe=>{pe.name!=="AbortError"&&m(new Error(`${pe.message} ${h.url}`))}))},G=(Y,J,oe)=>{(h.type==="arrayBuffer"?Y.arrayBuffer():h.type==="json"?Y.json():Y.text()).then((ue=>{P||(J&&oe&&(function(pe,we,Te){if(Qc(),ua==null)return;const Ie=vr(we.headers.get("Cache-Control")||"");if(Ie["no-store"])return;const Ze={status:we.status,statusText:we.statusText,headers:new Headers};we.headers.forEach(((nt,ot)=>Ze.headers.set(ot,nt))),Ie["max-age"]&&Ze.headers.set("Expires",new Date(Te+1e3*Ie["max-age"]).toUTCString());const Ve=Ze.headers.get("Expires");if(!Ve||new Date(Ve).getTime()-Te<42e4)return;let Ye=ji(pe.url,{persistentParams:Gl});if(we.status===206){const nt=pe.headers.get("Range");if(!nt)return;Ze.status=200,Ye=wo(Ye,{range:nt})}(function(nt,ot){if(sl===void 0)try{new Response(new ReadableStream),sl=!0}catch{sl=!1}sl?ot(nt.body):nt.blob().then(ot).catch((Ot=>It(Ot.message)))})(we,(nt=>{const ot=new Response((Ot=we.status)!==200&&Ot!==404&&[101,103,204,205,304].includes(Ot)?null:nt,Ze);var Ot;Qc(),ua!=null&&ua.then((pt=>pt.put(Ye,ot))).catch((pt=>It(pt.message)))}))})(_,J,oe),A=!0,m(null,ue,Y.headers))})).catch((ue=>{P||m(new Error(ue.message))}))};return N?(function(Y,J){if(Qc(),ua==null)return J(null);ua.then((oe=>{let ue=ji(Y.url,{persistentParams:Gl});const pe=Y.headers.get("Range");pe&&(ue=wo(ue,{range:pe})),oe.match(ue).then((we=>{const Te=(function(Ie){if(!Ie)return!1;const Ze=new Date(Ie.headers.get("Expires")||0),Ve=vr(Ie.headers.get("Cache-Control")||"");return Number(Ze)>Date.now()&&!Ve["no-cache"]})(we);oe.delete(ue).catch(J),Te&&oe.put(ue,we.clone()).catch(J),J(null,we,Te)})).catch(J)})).catch(J)})(_,H):H(null,null),{cancel:()=>{P=!0,A||x.abort()}}})(c,i);if(xr(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var a;return(function(h,m){const x=new XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const _ in h.headers)x.setRequestHeader(_,h.headers[_]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let _=x.response;if(h.type==="json")try{_=JSON.parse(x.response)}catch(P){return m(P)}const A=new Headers;x.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((P=>{const N=P.split(": "),V=N.shift(),H=N.join(": ");A.append(V,H)})),m(null,_,A)}else m(new uh(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}})(c,i)},dh=function(c,i){return xd(Object.assign(c,{type:"arrayBuffer"}),i)};function Di(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const hh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mu,Kc;Mu=[],Kc=0;const gf=function(c,i){if(yc.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Kc>=ii.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Mu.push(x),x}Kc++;let a=!1;const h=()=>{if(!a)for(a=!0,Kc--;Mu.length&&Kc<ii.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Mu.shift(),{requestParameters:_,callback:A,cancelled:P}=x;P||(x.cancel=gf(_,A).cancel)}},m=dh(c,((x,_,A)=>{h(),x?i(x):_&&(self.createImageBitmap?(function(P,N){const V=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(V).then((H=>{N(null,H)})).catch((H=>{N(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((P,N)=>i(P,N,A))):(function(P,N){const V=new Image;V.onload=()=>{N(null,V),URL.revokeObjectURL(V.src),V.onload=null,requestAnimationFrame((()=>{V.src=hh}))},V.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(P)],{type:"image/png"});V.src=P.byteLength?URL.createObjectURL(H):hh})(_,((P,N)=>i(P,N,A))))}));return{cancel:()=>{m.cancel(),h()}}};var Cp,Mp,fh,Yc={exports:{}},pg={exports:{}},kp={exports:{}},_d=(function(){if(fh)return Yc.exports;fh=1;var c=(Cp||(Cp=1,pg.exports=function(a,h){var m,x,_,A,P,N,V,H;for(x=a.length-(m=3&a.length),_=h,P=3432918353,N=461845907,H=0;H<x;)V=255&a.charCodeAt(H)|(255&a.charCodeAt(++H))<<8|(255&a.charCodeAt(++H))<<16|(255&a.charCodeAt(++H))<<24,++H,_=27492+(65535&(A=5*(65535&(_=(_^=V=(65535&(V=(V=(65535&V)*P+(((V>>>16)*P&65535)<<16)&4294967295)<<15|V>>>17))*N+(((V>>>16)*N&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(V=0,m){case 3:V^=(255&a.charCodeAt(H+2))<<16;case 2:V^=(255&a.charCodeAt(H+1))<<8;case 1:_^=V=(65535&(V=(V=(65535&(V^=255&a.charCodeAt(H)))*P+(((V>>>16)*P&65535)<<16)&4294967295)<<15|V>>>17))*N+(((V>>>16)*N&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),pg.exports),i=(Mp||(Mp=1,kp.exports=function(a,h){for(var m,x=a.length,_=h^x,A=0;x>=4;)m=1540483477*(65535&(m=255&a.charCodeAt(A)|(255&a.charCodeAt(++A))<<8|(255&a.charCodeAt(++A))<<16|(255&a.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++A;switch(x){case 3:_^=(255&a.charCodeAt(A+2))<<16;case 2:_^=(255&a.charCodeAt(A+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(A)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),kp.exports);return Yc.exports=c,Yc.exports.murmur3=c,Yc.exports.murmur2=i,Yc.exports})(),ph=ni(_d);class wa{constructor(i,...a){Object.assign(this,a[0]||{}),this.type=i}}class yf extends wa{constructor(i,a={}){super("error",Object.assign({error:i},a))}}function ku(c,i,a){a[c]&&a[c].indexOf(i)!==-1||(a[c]=a[c]||[],a[c].push(i))}function vd(c,i,a){if(a&&a[c]){const h=a[c].indexOf(i);h!==-1&&a[c].splice(h,1)}}class Jc{on(i,a){return this._listeners=this._listeners||{},ku(i,a,this._listeners),this}off(i,a){return vd(i,a,this._listeners),vd(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},ku(i,a,this._oneTimeListeners),this):new Promise((h=>{this.once(i,h)}))}fire(i,a){const h=typeof i=="string"?new wa(i,a):i,m=h.type;if(this.listens(m)){h.target=this;const x=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const P of x)P.call(this,h);const _=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const P of _)vd(m,P,this._oneTimeListeners),P.call(this,h);const A=this._eventedParent;if(A){const P=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,P),A.fire(h)}}else h instanceof yf&&console.error(h.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}class bs{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new bs(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[a,h]=i.split("");return new bs({name:a,iconsetId:h})}static isEqual(i,a){return i.name===a.name&&i.iconsetId===a.iconsetId}toString(){return bs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var bd,Ip={},mh=(function(){if(bd)return Ip;bd=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(x){return(x=Math.round(x))<0?0:x>255?255:x}function a(x){return i(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function h(x){return(_=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:_>1?1:_;var _}function m(x,_,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?x+(_-x)*A*6:2*A<1?_:3*A<2?x+(_-x)*(2/3-A)*6:x}try{Ip.parseCSSColor=function(x){var _,A=x.replace(/ /g,"").toLowerCase();if(A in c)return c[A].slice();if(A[0]==="#")return A.length===4?(_=parseInt(A.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:A.length===7&&(_=parseInt(A.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var P=A.indexOf("("),N=A.indexOf(")");if(P!==-1&&N+1===A.length){var V=A.substr(0,P),H=A.substr(P+1,N-(P+1)).split(","),G=1;switch(V){case"rgba":if(H.length!==4)return null;G=h(H.pop());case"rgb":return H.length!==3?null:[a(H[0]),a(H[1]),a(H[2]),G];case"hsla":if(H.length!==4)return null;G=h(H.pop());case"hsl":if(H.length!==3)return null;var Y=(parseFloat(H[0])%360+360)%360/360,J=h(H[1]),oe=h(H[2]),ue=oe<=.5?oe*(J+1):oe+J-oe*J,pe=2*oe-ue;return[i(255*m(pe,ue,Y+1/3)),i(255*m(pe,ue,Y)),i(255*m(pe,ue,Y-1/3)),G];default:return null}}return null}}catch{}return Ip})();class Wi{constructor(i,a,h,m=1){this.r=i,this.g=a,this.b=h,this.a=m}static parse(i){if(!i)return;if(i instanceof Wi)return i;if(typeof i!="string")return;const a=mh.parseCSSColor(i);return a?new Wi(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[i,a,h,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*h)},${m})`}toNonPremultipliedRenderColor(i){const{r:a,g:h,b:m,a:x}=this;return new mg(i,a,h,m,x)}toPremultipliedRenderColor(i){const{r:a,g:h,b:m,a:x}=this;return new xf(i,a*x,h*x,m*x,x)}clone(){return new Wi(this.r,this.g,this.b,this.a)}}class Pp{constructor(i,a,h,m,x,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const A=i.image.height,P=A*A;this.premultiplied?(a=x===0?0:a/x*(A-1),h=x===0?0:h/x*(A-1),m=x===0?0:m/x*(A-1)):(a*=A-1,h*=A-1,m*=A-1);const N=Math.floor(a),V=Math.floor(h),H=Math.floor(m),G=Math.ceil(a),Y=Math.ceil(h),J=Math.ceil(m),oe=a-N,ue=h-V,pe=m-H,we=i.image.data,Te=4*(N+V*P+H*A),Ie=4*(N+V*P+J*A),Ze=4*(N+Y*P+H*A),Ve=4*(N+Y*P+J*A),Ye=4*(G+V*P+H*A),nt=4*(G+V*P+J*A),ot=4*(G+Y*P+H*A),Ot=4*(G+Y*P+J*A);if(Te<0||Ot>=we.length)throw new Error("out of range");this.r=Ar(Ar(Ar(we[Te],we[Ie],pe),Ar(we[Ze],we[Ve],pe),ue),Ar(Ar(we[Ye],we[nt],pe),Ar(we[ot],we[Ot],pe),ue),oe)/255*(this.premultiplied?x:1),this.g=Ar(Ar(Ar(we[Te+1],we[Ie+1],pe),Ar(we[Ze+1],we[Ve+1],pe),ue),Ar(Ar(we[Ye+1],we[nt+1],pe),Ar(we[ot+1],we[Ot+1],pe),ue),oe)/255*(this.premultiplied?x:1),this.b=Ar(Ar(Ar(we[Te+2],we[Ie+2],pe),Ar(we[Ze+2],we[Ve+2],pe),ue),Ar(Ar(we[Ye+2],we[nt+2],pe),Ar(we[ot+2],we[Ot+2],pe),ue),oe)/255*(this.premultiplied?x:1),this.a=x}else this.r=a,this.g=h,this.b=m,this.a=x}toArray(){const{r:i,g:a,b:h,a:m}=this;return[255*i,255*a,255*h,m]}toHslaArray(){let{r:i,g:a,b:h,a:m}=this;if(this.premultiplied){if(m===0)return[0,0,0,0];const J=1/m;i*=J,a*=J,h*=J}const x=Math.min(Math.max(i,0),1),_=Math.min(Math.max(a,0),1),A=Math.min(Math.max(h,0),1),P=Math.min(x,_,A),N=Math.max(x,_,A),V=N-P,H=.5*(P+N);if(V===0)return[0,0,100*H,m];const G=H>.5?V/(2-N-P):V/(N+P);let Y;switch(N){case x:Y=60*((_-A)/V+(_<A?6:0));break;case _:Y=60*((A-x)/V+2);break;default:Y=60*((x-_)/V+4)}return[Y,100*G,100*H,m]}toArray01(){const{r:i,g:a,b:h,a:m}=this;return[i,a,h,m]}toArray01Scaled(i){const{r:a,g:h,b:m}=this;return[a*i,h*i,m*i]}toArray01Linear(){const{r:i,g:a,b:h,a:m}=this;return[Math.pow(i,2.2),Math.pow(a,2.2),Math.pow(h,2.2),m]}}class mg extends Pp{constructor(i,a,h,m,x){super(i,a,h,m,x,!1)}}class xf extends Pp{constructor(i,a,h,m,x){super(i,a,h,m,x,!0)}}function Ar(c,i,a){return c*(1-a)+i*a}function _f(c,i,a){return c.map(((h,m)=>Ar(h,i[m],a)))}Wi.black=new Wi(0,0,0,1),Wi.white=new Wi(1,1,1,1),Wi.transparent=new Wi(0,0,0,0),Wi.red=new Wi(1,0,0,1),Wi.blue=new Wi(0,0,1,1);var Iu=Object.freeze({__proto__:null,array:_f,color:function(c,i,a){return new Wi(Ar(c.r,i.r,a),Ar(c.g,i.g,a),Ar(c.b,i.b,a),Ar(c.a,i.a,a))},number:Ar});class ql extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Xl{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[h,m]of a)this.bindings[h]=m}concat(i){return new Xl(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const wd={kind:"null"},sr={kind:"number"},Ii={kind:"string"},Ui={kind:"boolean"},ol={kind:"color"},vf={kind:"object"},qi={kind:"value"},Rp={kind:"collator"},gh={kind:"formatted"},Np={kind:"resolvedImage"};function Bo(c,i){return{kind:"array",itemType:c,N:i}}function io(c){if(c.kind==="array"){const i=io(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const Mb=[wd,sr,Ii,Ui,ol,gh,vf,Bo(qi),Np];function jp(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!jp(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const a of Mb)if(!jp(a,i))return null}}return`Expected ${io(c)} but found ${io(i)} instead.`}function ey(c,i){return i.some((a=>a.kind===c.kind))}function bf(c,i){return i.some((a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c))}function gg(c,i){return c.kind==="array"&&i.kind==="array"?c.N===i.N&&gg(c.itemType,i.itemType):c.kind===i.kind}class ty{constructor(i,a,h){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dp{constructor(i,a,h,m,x){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=h,this.fontStack=m,this.textColor=x}}class Io{constructor(i){this.sections=i}static fromString(i){return new Io([new Dp(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((i=>i.text.length!==0||!!i.image&&i.image.hasPrimary()))}static factory(i){return i instanceof Io?i:Io.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map((i=>i.text)).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){const m=a.image.getPrimary().id.toString();i.push(["image",m]);continue}i.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(h)}return i}}class Pu{constructor(i,a={}){if(this.id=bs.from(i),this.options=Object.assign({},a),a.transform){const{a:h,b:m,c:x,d:_,e:A,f:P}=a.transform;this.options.transform=new DOMMatrix([h,m,x,_,A,P])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:a,c:h,d:m,e:x,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:a,c:h,d:m,e:x,f:_}})}static parse(i){let a,h,m,x;try{({name:a,iconsetId:h,params:m,transform:x}=JSON.parse(i)||{})}catch{return null}if(!a)return null;const{a:_,b:A,c:P,d:N,e:V,f:H}=x||{};return new Pu({name:a,iconsetId:h},{params:m,transform:new DOMMatrix([_,A,P,N,V,H])})}scaleSelf(i,a){return this.options.transform.scaleSelf(i,a),this}}class za{constructor(i,a,h,m,x=!1){this.primaryId=bs.from(i),this.primaryOptions=a,h&&(this.secondaryId=bs.from(h)),this.secondaryOptions=m,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Pu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Pu(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?za.build({name:i}):i}static build(i,a,h,m){return!i||typeof i=="object"&&!("name"in i)?null:new za(i,h,a,m)}}function yg(c,i,a,h){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,i,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,i,a,h]:[c,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sd(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Wi||c instanceof ty||c instanceof Io||c instanceof za)return!0;if(Array.isArray(c)){for(const i of c)if(!Sd(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!Sd(c[i]))return!1;return!0}return!1}function so(c){if(c===null)return wd;if(typeof c=="string")return Ii;if(typeof c=="boolean")return Ui;if(typeof c=="number")return sr;if(c instanceof Wi)return ol;if(c instanceof ty)return Rp;if(c instanceof Io)return gh;if(c instanceof za)return Np;if(Array.isArray(c)){const i=c.length;let a;for(const h of c){const m=so(h);if(a){if(a===m)continue;a=qi;break}a=m}return Bo(a||qi,i)}return vf}function eu(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof Io||c instanceof za||c instanceof Wi?c.toString():JSON.stringify(c)}class tu{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Sd(i[1]))return a.error("invalid value");const h=i[1];let m=so(h);const x=a.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new tu(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Wi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Io?this.value.serialize():this.value}}class $s{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const si={string:Ii,number:sr,boolean:Ui,object:vf};class Xn{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let h,m=1;const x=i[0];if(x==="array"){let A,P;if(i.length>2){const N=i[1];if(typeof N!="string"||!(N in si)||N==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);A=si[N],m++}else A=qi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);P=i[2],m++}h=Bo(A,P)}else h=si[x];const _=[];for(;m<i.length;m++){const A=a.parse(i[m],m,qi);if(!A)return null;_.push(A)}return new Xn(h,_)}evaluate(i){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(i);if(!jp(this.type,so(h)))return h;if(a===this.args.length-1)throw new $s(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${io(so(h))} but was expected to be of type ${io(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);const m=i.N;(typeof m=="number"||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map((h=>h.serialize())))}}class Td{constructor(i){this.type=gh,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const m=[];let x=!1;for(let _=1;_<=i.length-1;++_){const A=i[_];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let P=null;if(A["font-scale"]&&(P=a.parseObjectValue(A["font-scale"],_,"font-scale",sr),!P))return null;let N=null;if(A["text-font"]&&(N=a.parseObjectValue(A["text-font"],_,"text-font",Bo(Ii)),!N))return null;let V=null;if(A["text-color"]&&(V=a.parseObjectValue(A["text-color"],_,"text-color",ol),!V))return null;const H=m[m.length-1];H.scale=P,H.font=N,H.textColor=V}else{const P=a.parse(i[_],_,qi);if(!P)return null;const N=P.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:P,scale:null,font:null,textColor:null})}}return new Td(m)}evaluate(i){return new Io(this.sections.map((a=>{const h=a.content.evaluate(i);return gg(so(h),Np)?new Dp("",h,null,null,null):new Dp(eu(h),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)})))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),i.push(h)}return i}}class Cr{constructor(i,a,h,m){this._imageWarnHistory={},this.type=Np,this.namePrimary=i,this.nameSecondary=a,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let h=1;const m=[];function x(){if(h<i.length){const A=a.parse(i[h],h++,Ii);return A?(m.push({image:A,options:{}}),!0):(a.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(h<i.length){const P=i[h];if((A=P)===null||typeof A!="object"||Array.isArray(A))return!0;const N=P.params,V=P.iconset,H=a.concat(h);if(!N&&!V)return h++,!0;if(N){if(typeof N!="object"||N.constructor!==Object)return H.error('Image options "params" should be an object'),!1;const G={},Y=H.concat(void 0,"params");for(const J in N){if(!J)return Y.error("Image parameter name should be non-empty"),!1;const oe=Y.concat(void 0,J).parse(N[J],void 0,ol,void 0,{typeAnnotation:"coerce"});if(!oe)return!1;G[J]=oe}m[m.length-1].options.params=G}if(V){if(typeof V!="object"||V.constructor!==Object)return H.error('Image options "iconset" should be an object'),!1;if(!V.id)return H.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=V}return h++,!0}var A;return!0}for(let A=0;A<2;A++)if(!x()||!_())return;return new Cr(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(i,a){const h={};if(a){for(const m in a)if(a[m])try{h[m]=a[m].evaluate(i)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(i){const a={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,m=za.build(a,h,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(m&&i.availableImages){const x=m.getPrimary().id;if(m.available=i.availableImages.some((_=>bs.isEqual(_,x))),m.available){const _=m.getSecondary()?m.getSecondary().id:null;_&&(m.available=i.availableImages.some((A=>bs.isEqual(A,_))))}}return m}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&i(this.paramsPrimary[a]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&i(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(i,a){const h={};if(a&&(h.iconset={id:a}),i){h.params={};for(const m in i)i[m]&&(h.params[m]=i[m].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&i.push(a)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&i.push(a)}return i}}function wf(c){return Dr(c)?"string":Sf(c)?"number":Lp(c)?"boolean":Array.isArray(c)?"array":c===null?"null":xg(c)?"object":typeof c}function xg(c){return c!=null&&!Array.isArray(c)&&typeof c!="function"&&!(c instanceof String||c instanceof Number||c instanceof Boolean)&&typeof c=="object"}function Dr(c){return typeof c=="string"||c instanceof String}function Sf(c){return typeof c=="number"||c instanceof Number}function Lp(c){return typeof c=="boolean"||c instanceof Boolean}const Tf={"to-boolean":Ui,"to-color":ol,"to-number":sr,"to-string":Ii};class al{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const h=i[0],m=[];let x=wd;if(h==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);x=Bo(a.expectedType.itemType,_)}else{if(!(_>0&&Sd(i[1][0])))return null;x=Bo(so(i[1][0]),_)}for(let A=0;A<_;A++){const P=i[1][A];let N;if(Array.isArray(P))N=a.parse(P,void 0,x.itemType);else{const V=wf(P);if(V!==x.itemType.kind)return a.error(`Expected ${x.itemType.kind} but found ${V}.`);N=a.registry.literal.parse(["literal",P===void 0?null:P],a)}if(!N)return null;m.push(N)}}else{if((h==="to-boolean"||h==="to-string")&&i.length!==2)return a.error("Expected one argument.");x=Tf[h];for(let _=1;_<i.length;_++){const A=a.parse(i[_],_,qi);if(!A)return null;m.push(A)}}return new al(x,m)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,h;for(const m of this.args){if(a=m.evaluate(i),h=null,a instanceof Wi)return a;if(typeof a=="string"){const x=i.parseColor(a);if(x)return x}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:yg(a[0],a[1],a[2],a[3]),!h))return new Wi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new $s(h||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(i),a===null)return 0;const m=Number(a);if(!isNaN(m))return m}throw new $s(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Io.fromString(eu(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?za.build(eu(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map((a=>a.evaluate(i))):eu(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Td([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Cr(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((a=>{i.push(a.serialize())})),i}}const _g=["Unknown","Point","LineString","Polygon"];class go{constructor(i,a,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_g[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:h,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*a-i[0])+this.featureDistanceData.bearing[1]*(m*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Wi.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class ha{constructor(i,a,h,m,x){this.name=i,this.type=a,this._evaluate=h,this.args=m,this._overloadIndex=x}evaluate(i){if(!this._evaluate){const a=ha.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((i=>i.serialize())))}static parse(i,a){const h=i[0],m=ha.definitions[h];if(!m)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(m)?m[0]:m.type,_=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,A=[];let P=null,N=-1;for(const[V,H]of _){if(Array.isArray(V)&&V.length!==i.length-1)continue;A.push(V),N++,P=new Nd(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const G=[];let Y=!1;for(let J=1;J<i.length;J++){const oe=i[J],ue=Array.isArray(V)?V[J-1]:V.type,pe=P.parse(oe,1+G.length,ue);if(!pe){Y=!0;break}G.push(pe)}if(!Y)if(Array.isArray(V)&&V.length!==G.length)P.error(`Expected ${V.length} arguments, but found ${G.length} instead.`);else{for(let J=0;J<G.length;J++){const oe=Array.isArray(V)?V[J]:V.type,ue=G[J];P.concat(J+1).checkSubtype(oe,ue.type)}if(P.errors.length===0)return new ha(h,x,H,G,N)}}if(A.length===1)a.errors.push(...P.errors);else{const V=(A.length?A:_.map((([G])=>G))).map(Ed).join(" | "),H=[];for(let G=1;G<i.length;G++){const Y=a.parse(i[G],1+H.length);if(!Y)return null;H.push(io(Y.type))}a.error(`Expected arguments of type ${V}, but found (${H.join(", ")}) instead.`)}return null}static register(i,a){ha.definitions=a;for(const h in a)i[h]=ha}}function Ed(c){return Array.isArray(c)?`(${c.map(io).join(", ")})`:`(${io(c.type)}...)`}class Ad{constructor(i,a,h){this.type=Rp,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const m=h["case-sensitive"]===void 0?a.parse(!1,1,Ui):a.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Ui);if(!m)return null;const x=h["diacritic-sensitive"]===void 0?a.parse(!1,1,Ui):a.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Ui);if(!x)return null;let _=null;return h.locale&&(_=a.parseObjectValue(h.locale,1,"locale",Ii),!_)?null:new Ad(m,x,_)}evaluate(i){return new ty(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function _c(c,i,a=0,h=c.length-1,m=e_){for(;h>a;){if(h-a>600){const P=h-a+1,N=i-a+1,V=Math.log(P),H=.5*Math.exp(2*V/3),G=.5*Math.sqrt(V*H*(P-H)/P)*(N-P/2<0?-1:1);_c(c,i,Math.max(a,Math.floor(i-N*H/P+G)),Math.min(h,Math.floor(i+(P-N)*H/P+G)),m)}const x=c[i];let _=a,A=h;for(Po(c,a,i),m(c[h],x)>0&&Po(c,a,h);_<A;){for(Po(c,_,A),_++,A--;m(c[_],x)<0;)_++;for(;m(c[A],x)>0;)A--}m(c[a],x)===0?Po(c,a,A):(A++,Po(c,A,h)),A<=i&&(a=A+1),i<=A&&(h=A-1)}}function Po(c,i,a){const h=c[i];c[i]=c[a],c[a]=h}function e_(c,i){return c<i?-1:c>i?1:0}function t_(c){let i=0;for(let a,h,m=0,x=c.length,_=x-1;m<x;_=m++)a=c[m],h=c[_],i+=(h.x-a.x)*(a.y+h.y);return i}function Op(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function Cd(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function n_(c,i,a){const h=c[0]-i[0],m=c[1]-i[1],x=c[0]-a[0],_=c[1]-a[1];return h*_-x*m==0&&h*x<=0&&m*_<=0}function Zl(c,i,a=!1){let h=!1;for(let A=0,P=i.length;A<P;A++){const N=i[A];for(let V=0,H=N.length,G=H-1;V<H;G=V++){const Y=N[G],J=N[V];if(n_(c,Y,J))return a;(x=Y)[1]>(m=c)[1]!=(_=J)[1]>m[1]&&m[0]<(_[0]-x[0])*(m[1]-x[1])/(_[1]-x[1])+x[0]&&(h=!h)}}var m,x,_;return h}function r_(c,i,a,h){const m=h[0]-a[0],x=h[1]-a[1],_=(c[0]-a[0])*x-m*(c[1]-a[1]),A=(i[0]-a[0])*x-m*(i[1]-a[1]);return _>0&&A<0||_<0&&A>0}function ll(c,i,a,h){return(m=[h[0]-a[0],h[1]-a[1]])[0]*(x=[i[0]-c[0],i[1]-c[1]])[1]-m[1]*x[0]!=0&&!(!r_(c,i,a,h)||!r_(a,h,c,i));var m,x}function Ru(c){const i=new Ht(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Ht(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of c[0])i.x>h.x&&(i.x=h.x),i.y>h.y&&(i.y=h.y),a.x<h.x&&(a.x=h.x),a.y<h.y&&(a.y=h.y);return{min:i,max:a}}const Nu=8192;function i_(c,i){const a=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(a*m*Nu),Math.round(h*m*Nu)]}function ny(c,i){for(let a=0;a<i.length;a++)if(Zl(c,i[a]))return!0;return!1}function s_(c,i,a){for(const h of a)for(let m=0,x=h.length,_=x-1;m<x;_=m++)if(ll(c,i,h[_],h[m]))return!0;return!1}function nu(c,i){for(let a=0;a<c.length;++a)if(!Zl(c[a],i))return!1;for(let a=0;a<c.length-1;++a)if(s_(c[a],c[a+1],i))return!1;return!0}function kb(c,i){for(let a=0;a<i.length;a++)if(nu(c,i[a]))return!0;return!1}function ry(c,i,a){const h=[];for(let m=0;m<c.length;m++){const x=[];for(let _=0;_<c[m].length;_++){const A=i_(c[m][_],a);Op(i,A),x.push(A)}h.push(x)}return h}function ju(c,i,a){const h=[];for(let m=0;m<c.length;m++){const x=ry(c[m],i,a);h.push(x)}return h}function Fp(c,i,a,h){if(c[0]<a[0]||c[0]>a[2]){const m=.5*h;let x=c[0]-a[0]>m?-h:a[0]-c[0]>m?h:0;x===0&&(x=c[0]-a[2]>m?-h:a[2]-c[0]>m?h:0),c[0]+=x}Op(i,c)}function yh(c,i,a,h){const m=Math.pow(2,h.z)*Nu,x=[h.x*Nu,h.y*Nu],_=[];if(!c)return _;for(const A of c)for(const P of A){const N=[P.x+x[0],P.y+x[1]];Fp(N,i,a,m),_.push(N)}return _}function cl(c,i,a,h){const m=Math.pow(2,h.z)*Nu,x=[h.x*Nu,h.y*Nu],_=[];if(!c)return _;for(const P of c){const N=[];for(const V of P){const H=[V.x+x[0],V.y+x[1]];Op(i,H),N.push(H)}_.push(N)}if(i[2]-i[0]<=m/2){(A=i)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of _)for(const N of P)Fp(N,i,a,m)}var A;return _}class Md{constructor(i,a){this.type=Ui,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Sd(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let m=0;m<h.features.length;++m){const x=h.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Md(h,h.features[m].geometry)}else if(h.type==="Feature"){const m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Md(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Md(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(a,h){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const A=ry(h.coordinates,x,_),P=yh(a.geometry(),m,x,_);if(!Cd(m,x))return!1;for(const N of P)if(!Zl(N,A))return!1}if(h.type==="MultiPolygon"){const A=ju(h.coordinates,x,_),P=yh(a.geometry(),m,x,_);if(!Cd(m,x))return!1;for(const N of P)if(!ny(N,A))return!1}return!0})(i,this.geometries);if(i.geometryType()==="LineString")return(function(a,h){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const A=ry(h.coordinates,x,_),P=cl(a.geometry(),m,x,_);if(!Cd(m,x))return!1;for(const N of P)if(!nu(N,A))return!1}if(h.type==="MultiPolygon"){const A=ju(h.coordinates,x,_),P=cl(a.geometry(),m,x,_);if(!Cd(m,x))return!1;for(const N of P)if(!kb(N,A))return!1}return!0})(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const kd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Id=1/298.257223563,Bp=Id*(2-Id),xh=Math.PI/180;class Du{static fromTile(i,a,h){const m=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),x=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/xh;return new Du(x,h)}static get units(){return kd}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!kd[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(kd).join(", ")}`);const h=6378.137*xh*(a?kd[a]:1),m=Math.cos(i*xh),x=1/(1-Bp*(1-m*m)),_=Math.sqrt(x);this.kx=h*_*m,this.ky=h*_*x*(1-Bp)}distance(i,a){const h=ul(i[0]-a[0])*this.kx,m=(i[1]-a[1])*this.ky;return Math.sqrt(h*h+m*m)}bearing(i,a){const h=ul(a[0]-i[0])*this.kx;return Math.atan2(h,(a[1]-i[1])*this.ky)/xh}destination(i,a,h){const m=h*xh;return this.offset(i,Math.sin(m)*a,Math.cos(m)*a)}offset(i,a,h){return[i[0]+a/this.kx,i[1]+h/this.ky]}lineDistance(i){let a=0;for(let h=0;h<i.length-1;h++)a+=this.distance(i[h],i[h+1]);return a}area(i){let a=0;for(let h=0;h<i.length;h++){const m=i[h];for(let x=0,_=m.length,A=_-1;x<_;A=x++)a+=ul(m[x][0]-m[A][0])*(m[x][1]+m[A][1])*(h?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let h=0;if(a<=0)return i[0];for(let m=0;m<i.length-1;m++){const x=i[m],_=i[m+1],A=this.distance(x,_);if(h+=A,h>a)return zp(x,_,(a-(h-A))/A)}return i[i.length-1]}pointToSegmentDistance(i,a,h){let[m,x]=a,_=ul(h[0]-m)*this.kx,A=(h[1]-x)*this.ky;if(_!==0||A!==0){const P=(ul(i[0]-m)*this.kx*_+(i[1]-x)*this.ky*A)/(_*_+A*A);P>1?(m=h[0],x=h[1]):P>0&&(m+=_/this.kx*P,x+=A/this.ky*P)}return _=ul(i[0]-m)*this.kx,A=(i[1]-x)*this.ky,Math.sqrt(_*_+A*A)}pointOnLine(i,a){let h=1/0,m=i[0][0],x=i[0][1],_=0,A=0;for(let P=0;P<i.length-1;P++){let N=i[P][0],V=i[P][1],H=ul(i[P+1][0]-N)*this.kx,G=(i[P+1][1]-V)*this.ky,Y=0;H===0&&G===0||(Y=(ul(a[0]-N)*this.kx*H+(a[1]-V)*this.ky*G)/(H*H+G*G),Y>1?(N=i[P+1][0],V=i[P+1][1]):Y>0&&(N+=H/this.kx*Y,V+=G/this.ky*Y)),H=ul(a[0]-N)*this.kx,G=(a[1]-V)*this.ky;const J=H*H+G*G;J<h&&(h=J,m=N,x=V,_=P,A=Y)}return{point:[m,x],index:_,t:Math.max(0,Math.min(1,A))}}lineSlice(i,a,h){let m=this.pointOnLine(h,i),x=this.pointOnLine(h,a);if(m.index>x.index||m.index===x.index&&m.t>x.t){const N=m;m=x,x=N}const _=[m.point],A=m.index+1,P=x.index;!vg(h[A],_[0])&&A<=P&&_.push(h[A]);for(let N=A+1;N<=P;N++)_.push(h[N]);return vg(h[P],x.point)||_.push(x.point),_}lineSliceAlong(i,a,h){let m=0;const x=[];for(let _=0;_<h.length-1;_++){const A=h[_],P=h[_+1],N=this.distance(A,P);if(m+=N,m>i&&x.length===0&&x.push(zp(A,P,(i-(m-N))/N)),m>=a)return x.push(zp(A,P,(a-(m-N))/N)),x;m>i&&x.push(P)}return x}bufferPoint(i,a){const h=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-h,i[0]+m,i[1]+h]}bufferBBox(i,a){const h=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-h,i[2]+m,i[3]+h]}insideBBox(i,a){return ul(i[0]-a[0])>=0&&ul(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function vg(c,i){return c[0]===i[0]&&c[1]===i[1]}function zp(c,i,a){const h=ul(i[0]-c[0]);return[c[0]+h*a,c[1]+(i[1]-c[1])*a]}function ul(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Up{constructor(i=[],a=((h,m)=>h<m?-1:h>m?1:0)){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:h}=this,m=a[i];for(;i>0;){const x=i-1>>1,_=a[x];if(h(m,_)>=0)break;a[i]=_,i=x}a[i]=m}_down(i){const{data:a,compare:h}=this,m=this.length>>1,x=a[i];for(;i<m;){let _=1+(i<<1);const A=_+1;if(A<this.length&&h(a[A],a[_])<0&&(_=A),h(a[_],x)>=0)break;a[i]=a[_],i=_}a[i]=x}}var xn=8192;function bg(c,i){return i.dist-c.dist}const Al=100,Pd=50;function _h(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==c[a])return!1;return!0}function Vp(c){return c[1]-c[0]+1}function ru(c,i){const a=c[1]>=c[0]&&c[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function Rd(c,i){if(c[0]>c[1])return[null,null];const a=Vp(c);if(i){if(a===2)return[c,null];const h=Math.floor(a/2);return[[c[0],c[0]+h],[c[0]+h,c[1]]]}{if(a===1)return[c,null];const h=Math.floor(a/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}}function Ql(c,i){const a=[1/0,1/0,-1/0,-1/0];if(!ru(i,c.length))return a;for(let h=i[0];h<=i[1];++h)Op(a,c[h]);return a}function xi(c){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let h=0;h<c[a].length;++h)Op(i,c[a][h]);return i}function vh(c,i,a){if(_h(c)||_h(i))return NaN;let h=0,m=0;return c[2]<i[0]&&(h=i[0]-c[2]),c[0]>i[2]&&(h=c[0]-i[2]),c[1]>i[3]&&(m=c[1]-i[3]),c[3]<i[1]&&(m=i[1]-c[3]),a.distance([0,0],[h,m])}function co(c){return 360*c-180}function iy(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function bh(c,i){const a=Math.pow(2,i.z),h=(c.y/xn+i.y)/a;return[co((c.x/xn+i.x)/a),iy(h)]}function Hp(c,i){const a=[];for(let h=0;h<c.length;++h)a.push(bh(c[h],i));return a}function Es(c,i,a){const h=a.pointOnLine(i,c).point;return a.distance(c,h)}function wg(c,i,a,h,m){const x=a.slice(h[0],h[1]+1);let _=1/0;for(let A=i[0];A<=i[1];++A)if((_=Math.min(_,Es(c[A],x,m)))===0)return 0;return _}function wh(c,i,a,h,m){const x=Math.min(m.pointToSegmentDistance(c,a,h),m.pointToSegmentDistance(i,a,h)),_=Math.min(m.pointToSegmentDistance(a,c,i),m.pointToSegmentDistance(h,c,i));return Math.min(x,_)}function Sg(c,i,a,h,m){if(!ru(i,c.length)||!ru(h,a.length))return NaN;let x=1/0;for(let _=i[0];_<i[1];++_)for(let A=h[0];A<h[1];++A){if(ll(c[_],c[_+1],a[A],a[A+1]))return 0;x=Math.min(x,wh(c[_],c[_+1],a[A],a[A+1],m))}return x}function Ef(c,i,a,h,m){if(!ru(i,c.length)||!ru(h,a.length))return NaN;let x=1/0;for(let _=i[0];_<=i[1];++_)for(let A=h[0];A<=h[1];++A)if((x=Math.min(x,m.distance(c[_],a[A])))===0)return x;return x}function o_(c,i,a){if(Zl(c,i,!0))return 0;let h=1/0;for(const m of i){const x=m.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[x-1]&&(h=Math.min(h,a.pointToSegmentDistance(c,m[x-1],m[0])))===0||(h=Math.min(h,Es(c,m,a)))===0)return h}return h}function Ib(c,i,a,h){if(!ru(i,c.length))return NaN;for(let x=i[0];x<=i[1];++x)if(Zl(c[x],a,!0))return 0;let m=1/0;for(let x=i[0];x<i[1];++x)for(const _ of a)for(let A=0,P=_.length,N=P-1;A<P;N=A++){if(ll(c[x],c[x+1],_[N],_[A]))return 0;m=Math.min(m,wh(c[x],c[x+1],_[N],_[A],h))}return m}function a_(c,i){for(const a of c)for(let h=0;h<=a.length-1;++h)if(Zl(a[h],i,!0))return!0;return!1}function l_(c,i,a,h=1/0){const m=xi(c),x=xi(i);if(h!==1/0&&vh(m,x,a)>=h)return h;if(Cd(m,x)){if(a_(c,i))return 0}else if(a_(i,c))return 0;let _=h;for(const A of c)for(let P=0,N=A.length,V=N-1;P<N;V=P++)for(const H of i)for(let G=0,Y=H.length,J=Y-1;G<Y;J=G++){if(ll(A[V],A[P],H[J],H[G]))return 0;_=Math.min(_,wh(A[V],A[P],H[J],H[G],a))}return _}function Sh(c,i,a,h,m,x,_){if(x===null||_===null)return;const A=vh(Ql(h,x),Ql(m,_),a);A<i&&c.push({dist:A,range1:x,range2:_})}function Tg(c,i,a,h,m=1/0){let x=Math.min(h.distance(c[0],a[0][0]),m);if(x===0)return x;const _=new Up([{dist:0,range1:[0,c.length-1],range2:[0,0]}],bg),A=i?Pd:Al,P=xi(a);for(;_.length;){const N=_.pop();if(N.dist>=x)continue;const V=N.range1;if(Vp(V)<=A){if(!ru(V,c.length))return NaN;if(i){const H=Ib(c,V,a,h);if((x=Math.min(x,H))===0)return x}else for(let H=V[0];H<=V[1];++H){const G=o_(c[H],a,h);if((x=Math.min(x,G))===0)return x}}else{const H=Rd(V,i);if(H[0]!==null){const G=vh(Ql(c,H[0]),P,h);G<x&&_.push({dist:G,range1:H[0],range2:[0,0]})}if(H[1]!==null){const G=vh(Ql(c,H[1]),P,h);G<x&&_.push({dist:G,range1:H[1],range2:[0,0]})}}}return x}function Eg(c,i,a,h,m,x=1/0){let _=Math.min(x,m.distance(c[0],a[0]));if(_===0)return _;const A=new Up([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],bg),P=i?Pd:Al,N=h?Pd:Al;for(;A.length;){const V=A.pop();if(V.dist>=_)continue;const H=V.range1,G=V.range2;if(Vp(H)<=P&&Vp(G)<=N){if(!ru(H,c.length)||!ru(G,a.length))return NaN;if(i&&h?_=Math.min(_,Sg(c,H,a,G,m)):i||h?i&&!h?_=Math.min(_,wg(a,G,c,H,m)):!i&&h&&(_=Math.min(_,wg(c,H,a,G,m))):_=Math.min(_,Ef(c,H,a,G,m)),_===0)return _}else{const Y=Rd(H,i),J=Rd(G,h);Sh(A,_,m,c,a,Y[0],J[0]),Sh(A,_,m,c,a,Y[0],J[1]),Sh(A,_,m,c,a,Y[1],J[0]),Sh(A,_,m,c,a,Y[1],J[1])}}return _}function Gp(c,i,a,h,m=1/0){let x=m;const _=Ql(c,[0,c.length-1]);for(const A of a)if(!(x!==1/0&&vh(_,Ql(A,[0,A.length-1]),h)>=x)&&(x=Math.min(x,Eg(c,i,A,!0,h,x)),x===0))return x;return x}function Af(c,i,a,h,m=1/0){let x=m;const _=Ql(c,[0,c.length-1]);for(const A of a){if(x!==1/0&&vh(_,xi(A),h)>=x)continue;const P=Tg(c,i,A,h,x);if(isNaN(P))return P;if((x=Math.min(x,P))===0)return x}return x}function $p(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Th{constructor(i,a){this.type=sr,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Sd(i[1])){const h=i[1];if(h.type==="FeatureCollection"){for(let m=0;m<h.features.length;++m)if($p(h.features[m].geometry.type))return new Th(h,h.features[m].geometry)}else if(h.type==="Feature"){if($p(h.geometry.type))return new Th(h,h.geometry)}else if($p(h.type))return new Th(h,h)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),h=i.canonicalID();if(a!=null&&h!=null){if(i.geometryType()==="Point")return(function(m,x,_){const A=[];for(const N of m)for(const V of N)A.push(bh(V,x));const P=new Du(A[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Eg(A,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",P):_.type==="MultiLineString"?Gp(A,!1,_.coordinates,P):_.type==="Polygon"||_.type==="MultiPolygon"?Af(A,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,P):null})(a,h,this.geometries);if(i.geometryType()==="LineString")return(function(m,x,_){const A=[];for(const N of m){const V=[];for(const H of N)V.push(bh(H,x));A.push(V)}const P=new Du(A[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Gp(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A,P);if(_.type==="MultiLineString"){let N=1/0;for(let V=0;V<_.coordinates.length;V++){const H=Gp(_.coordinates[V],!0,A,P,N);if(isNaN(H))return H;if((N=Math.min(N,H))===0)return N}return N}if(_.type==="Polygon"||_.type==="MultiPolygon"){let N=1/0;for(let V=0;V<A.length;V++){const H=Af(A[V],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,P,N);if(isNaN(H))return H;if((N=Math.min(N,H))===0)return N}return N}return null})(a,h,this.geometries);if(i.geometryType()==="Polygon")return(function(m,x,_){const A=[];for(const N of(function(V,H){const G=V.length;if(G<=1)return[V];const Y=[];let J,oe;for(let ue=0;ue<G;ue++){const pe=t_(V[ue]);pe!==0&&(V[ue].area=Math.abs(pe),oe===void 0&&(oe=pe<0),oe===pe<0?(J&&Y.push(J),J=[V[ue]]):J.push(V[ue]))}return J&&Y.push(J),Y})(m)){const V=[];for(let H=0;H<N.length;++H)V.push(Hp(N[H],x));A.push(V)}const P=new Du(A[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Af(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A,P);if(_.type==="MultiLineString"){let N=1/0;for(let V=0;V<_.coordinates.length;V++){const H=Af(_.coordinates[V],!0,A,P,N);if(isNaN(H))return H;if((N=Math.min(N,H))===0)return N}return N}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(N,V,H){let G=1/0;for(const Y of N)for(const J of V){const oe=l_(Y,J,H,G);if(isNaN(oe))return oe;if((G=Math.min(G,oe))===0)return G}return G})(_.type==="Polygon"?[_.coordinates]:_.coordinates,A,P):null})(a,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Eh(c){if(c instanceof ha&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Md||c instanceof Th)return!1;if(c instanceof vc)return c.featureConstant;let i=!0;return c.eachChild((a=>{i&&!Eh(a)&&(i=!1)})),i}function Wp(c){if(c instanceof ha&&c.name==="feature-state")return!1;let i=!0;return c.eachChild((a=>{i&&!Wp(a)&&(i=!1)})),i}function Cf(c,i){if(c instanceof ha&&i.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild((h=>{a&&!Cf(h,i)&&(a=!1)})),a}function Ag(c,i,a){return[c,i,a].filter(Boolean).join("")}function iu(c,i){switch(c){case"string":return eu(i);case"number":return+i;case"boolean":return!!i;case"color":return Wi.parse(i);case"formatted":return Io.fromString(eu(i));case"resolvedImage":return za.build(eu(i))}return i}function sy(c,i,a,h){return h!==void 0&&(c=h*Math.round(c/h)),i!==void 0&&c<i&&(c=i),a!==void 0&&c>a&&(c=a),c}class vc{constructor(i,a,h,m=!1){this.type=i,this.key=a,this.scope=h,this.featureConstant=m}static parse(i,a){let h=a.expectedType;if(h==null&&(h=qi),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const m=a.parse(i[1],1);if(!(m instanceof tu))return a.error("Key name of 'config' expression must be a string literal.");let x,_=!0;const A=eu(m.value);if(i.length>=3){const P=a.parse(i[2],2);if(!(P instanceof tu))return a.error("Scope of 'config' expression must be a string literal.");x=eu(P.value)}if(a.options){const P=Ag(A,x,a._scope),N=a.options.get(P);N&&(_=Eh(N.value||N.default))}return new vc(h,A,x,_)}evaluate(i){const a=Ag(this.key,this.scope,i.scope),h=i.getConfig(a);if(!h)return null;const{type:m,value:x,values:_,minValue:A,maxValue:P,stepValue:N}=h,V=h.default.evaluate(i);let H=V;if(x){const G=i.scope;i.scope=(G||"").split("").slice(1).join(""),H=x.evaluate(i),i.scope=G}return m&&(H=iu(m,H)),H===void 0||A===void 0&&P===void 0&&N===void 0||(typeof H=="number"?H=sy(H,A,P,N):Array.isArray(H)&&(H=H.map((G=>typeof G=="number"?sy(G,A,P,N):G)))),x!==void 0&&H!==void 0&&_&&!_.includes(H)&&(H=V,m&&(H=iu(m,H))),(m&&m!==this.type||H!==void 0&&!gg(so(H),this.type))&&(H=iu(this.type.kind,H)),H}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class Cl{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=i[1];return a.scope.has(h)?new Cl(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Nd{constructor(i,a=[],h,m=new Xl,x=[],_,A,P){this.registry=i,this.path=a,this.key=a.map((N=>typeof N=="string"?`['${N}']`:`[${N}]`)).join(""),this.scope=m,this.errors=x,this.expectedType=h,this._scope=_,this.options=A,this.iconImageUseTheme=P}parse(i,a,h,m,x={}){return a||h?this.concat(a,null,h,m)._parse(i,x):this._parse(i,x)}parseObjectValue(i,a,h,m,x,_={}){return this.concat(a,h,m,x)._parse(i,_)}_parse(i,a){function h(m,x,_){return _==="assert"?new Xn(x,[m]):_==="coerce"?new al(x,[m]):m}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(m){let x=m.parse(i,this);if(!x)return null;if(this.expectedType){const _=this.expectedType,A=x.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||A.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(_,A))return null}else x=h(x,_,a.typeAnnotation||"coerce");else x=h(x,_,a.typeAnnotation||"assert")}if(!(x instanceof tu)&&x.type.kind!=="resolvedImage"&&bc(x)){const _=new go(this._scope,this.options,this.iconImageUseTheme);try{x=new tu(x.type,x.evaluate(_))}catch(A){return this.error(A.message),null}}return x}return al.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,h,m){let x=typeof i=="number"?this.path.concat(i):this.path;x=typeof a=="string"?x.concat(a):x;const _=m?this.scope.concat(m):this.scope;return new Nd(this.registry,x,h||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(i,...a){const h=`${this.key}${a.map((m=>`[${m}]`)).join("")}`;this.errors.push(new ql(h,i))}checkSubtype(i,a){const h=jp(i,a);return h&&this.error(h),h}}function bc(c){if(c instanceof Cl)return bc(c.boundExpression);if(c instanceof ha&&c.name==="error"||c instanceof Ad||c instanceof Md||c instanceof Th||c instanceof vc)return!1;const i=c instanceof al||c instanceof Xn;let a=!0;return c.eachChild((h=>{a=i?a&&bc(h):a&&h instanceof tu})),!!a&&Eh(c)&&Cf(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Mf(c,i){const a=c.length-1;let h,m,x=0,_=a,A=0;for(;x<=_;)if(A=Math.floor((x+_)/2),h=c[A],m=c[A+1],h<=i){if(A===a||i<m)return A;x=A+1}else{if(!(h>i))throw new $s("Input is not a number.");_=A-1}return 0}class qp{constructor(i,a,h){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[m,x]of h)this.labels.push(m),this.outputs.push(x)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(i[1],1,sr);if(!h)return null;const m=[];let x=null;a.expectedType&&a.expectedType.kind!=="value"&&(x=a.expectedType);for(let _=1;_<i.length;_+=2){const A=_===1?-1/0:i[_],P=i[_+1],N=_,V=_+1;if(typeof A!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(m.length&&m[m.length-1][0]>=A)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const H=a.parse(P,V,x);if(!H)return null;x=x||H.type,m.push([A,H])}return new qp(x,h,m)}evaluate(i){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return h[0].evaluate(i);const x=a.length;return m>=a[x-1]?h[x-1].evaluate(i):h[Mf(a,m)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const c_=.95047,jd=1.08883,kf=4/29,wc=6/29,Ah=3*wc*wc,oy=wc*wc*wc,Ch=Math.PI/180,Dd=180/Math.PI;function to(c){return c>oy?Math.pow(c,1/3):c/Ah+kf}function Qs(c){return c>wc?c*c*c:Ah*(c-kf)}function Sc(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Go(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function zo(c){const i=Go(c.r),a=Go(c.g),h=Go(c.b),m=to((.4124564*i+.3575761*a+.1804375*h)/c_),x=to((.2126729*i+.7151522*a+.072175*h)/1);return{l:116*x-16,a:500*(m-x),b:200*(x-to((.0193339*i+.119192*a+.9503041*h)/jd)),alpha:c.a}}function Lu(c){let i=(c.l+16)/116,a=isNaN(c.a)?i:i+c.a/500,h=isNaN(c.b)?i:i-c.b/200;return i=1*Qs(i),a=c_*Qs(a),h=jd*Qs(h),new Wi(Sc(3.2404542*a-1.5371385*i-.4985314*h),Sc(-.969266*a+1.8760108*i+.041556*h),Sc(.0556434*a-.2040259*i+1.0572252*h),c.alpha)}function Mh(c,i,a){const h=i-c;return c+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const ta={forward:zo,reverse:Lu,interpolate:function(c,i,a){return{l:Ar(c.l,i.l,a),a:Ar(c.a,i.a,a),b:Ar(c.b,i.b,a),alpha:Ar(c.alpha,i.alpha,a)}}},su={forward:function(c){const{l:i,a,b:h}=zo(c),m=Math.atan2(h,a)*Dd;return{h:m<0?m+360:m,c:Math.sqrt(a*a+h*h),l:i,alpha:c.a}},reverse:function(c){const i=c.h*Ch,a=c.c;return Lu({l:c.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:c.alpha})},interpolate:function(c,i,a){return{h:Mh(c.h,i.h,a),c:Ar(c.c,i.c,a),l:Ar(c.l,i.l,a),alpha:Ar(c.alpha,i.alpha,a)}}};var Xp=Object.freeze({__proto__:null,hcl:su,lab:ta});class dl{constructor(i,a,h,m,x){this.type=i,this.operator=a,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[_,A]of x)this.labels.push(_),this.outputs.push(A)}static interpolationFactor(i,a,h,m){let x=0;if(i.name==="exponential")x=If(a,i.base,h,m);else if(i.name==="linear")x=If(a,1,h,m);else if(i.name==="cubic-bezier"){const _=i.controlPoints;x=new ns(_[0],_[1],_[2],_[3]).solve(If(a,1,h,m))}return x}static parse(i,a){let[h,m,x,..._]=i;if(!Array.isArray(m)||m.length===0)return a.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const N=m[1];if(typeof N!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:N}}else{if(m[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const N=m.slice(1);if(N.length!==4||N.some((V=>typeof V!="number"||V<0||V>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:N}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(x=a.parse(x,2,sr),!x)return null;const A=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=ol:a.expectedType&&a.expectedType.kind!=="value"&&(P=a.expectedType);for(let N=0;N<_.length;N+=2){const V=_[N],H=_[N+1],G=N+3,Y=N+4;if(typeof V!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(A.length&&A[A.length-1][0]>=V)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const J=a.parse(H,Y,P);if(!J)return null;P=P||J.type,A.push([V,J])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new dl(P,h,m,x,A):a.error(`Type ${io(P)} is not interpolatable.`)}evaluate(i){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return h[0].evaluate(i);const x=a.length;if(m>=a[x-1])return h[x-1].evaluate(i);const _=Mf(a,m),A=dl.interpolationFactor(this.interpolation,m,a[_],a[_+1]),P=h[_].evaluate(i),N=h[_+1].evaluate(i);return this.operator==="interpolate"?Iu[this.type.kind.toLowerCase()](P,N,A):this.operator==="interpolate-hcl"?su.reverse(su.interpolate(su.forward(P),su.forward(N),A)):ta.reverse(ta.interpolate(ta.forward(P),ta.forward(N),A))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function If(c,i,a,h){const m=h-a,x=c-a;return m===0?0:i===1?x/m:(Math.pow(i,x)-1)/(Math.pow(i,m)-1)}class Pf{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let h=null;const m=a.expectedType;m&&m.kind!=="value"&&(h=m);const x=[];for(const A of i.slice(1)){const P=a.parse(A,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,x.push(P)}const _=m&&x.some((A=>jp(m,A.type)));return new Pf(_?qi:h,x)}evaluate(i){let a,h=null,m=0;for(const x of this.args){if(m++,h=x.evaluate(i),h&&h instanceof za&&!h.available&&(a||(a=h),h=null,m===this.args.length))return a;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}serialize(){const i=["coalesce"];return this.eachChild((a=>{i.push(a.serialize())})),i}}class Ml{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let x=1;x<i.length-1;x+=2){const _=i[x];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,x);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=a.parse(i[x+1],x+1);if(!A)return null;h.push([_,A])}const m=a.parse(i[i.length-1],i.length-1,a.expectedType,h);return m?new Ml(h,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,h]of this.bindings)i.push(a,h.serialize());return i.push(this.result.serialize()),i}}class Rf{constructor(i,a,h){this.type=i,this.index=a,this.input=h}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,sr),m=a.parse(i[2],2,Bo(a.expectedType||qi));return h&&m?new Rf(m.type.itemType,h,m):null}evaluate(i){const a=this.index.evaluate(i),h=this.input.evaluate(i);if(a<0)throw new $s("Array index out of bounds: negative index");if(a>=h.length)throw new $s("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new $s("Array index must be an integer. Use at-interpolated for fractional indices");return h[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zp{constructor(i,a,h){this.type=i,this.index=a,this.input=h}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,sr),m=a.parse(i[2],2,Bo(a.expectedType||qi));return h&&m?new Zp(m.type.itemType,h,m):null}evaluate(i){const a=this.index.evaluate(i),h=this.input.evaluate(i);if(a<0)throw new $s(`Array index out of bounds: ${a} < 0.`);if(a>h.length-1)throw new $s(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a===Math.floor(a))return h[a];const m=Math.floor(a),x=Math.ceil(a),_=h[m],A=h[x];if(typeof _!="number"||typeof A!="number")throw new $s(`Cannot interpolate between non-number values at index ${a}.`);const P=a-m;return _*(1-P)+A*P}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Cg{constructor(i,a){this.type=Ui,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,qi),m=a.parse(i[2],2,qi);return h&&m?ey(h.type,[Ui,Ii,sr,wd,qi])?new Cg(h,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(h.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(h==null)return!1;if(!bf(a,["boolean","string","number","null"]))throw new $s(`Expected first argument to be of type boolean, string, number or null, but found ${io(so(a))} instead.`);if(!bf(h,["string","array"]))throw new $s(`Expected second argument to be of type array or string, but found ${io(so(h))} instead.`);return h.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qp{constructor(i,a,h){this.type=sr,this.needle=i,this.haystack=a,this.fromIndex=h}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,qi),m=a.parse(i[2],2,qi);if(!h||!m)return null;if(!ey(h.type,[Ui,Ii,sr,wd,qi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(h.type)} instead`);if(i.length===4){const x=a.parse(i[3],3,sr);return x?new Qp(h,m,x):null}return new Qp(h,m)}evaluate(i){const a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!bf(a,["boolean","string","number","null"]))throw new $s(`Expected first argument to be of type boolean, string, number or null, but found ${io(so(a))} instead.`);if(!bf(h,["string","array"]))throw new $s(`Expected second argument to be of type array or string, but found ${io(so(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return h.indexOf(a,m)}return h.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Tc{constructor(i,a,h,m,x,_){this.inputType=i,this.type=a,this.input=h,this.cases=m,this.outputs=x,this.otherwise=_}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let h,m;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);const x={},_=[];for(let N=2;N<i.length-1;N+=2){let V=i[N];const H=i[N+1];Array.isArray(V)||(V=[V]);const G=a.concat(N);if(V.length===0)return G.error("Expected at least one branch label.");for(const J of V){if(typeof J!="number"&&typeof J!="string")return G.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return G.error("Numeric branch labels must be integer values.");if(h){if(G.checkSubtype(h,so(J)))return null}else h=so(J);if(x[String(J)]!==void 0)return G.error("Branch labels must be unique.");x[String(J)]=_.length}const Y=a.parse(H,N,m);if(!Y)return null;m=m||Y.type,_.push(Y)}const A=a.parse(i[1],1,qi);if(!A)return null;const P=a.parse(i[i.length-1],i.length-1,m);return P?A.type.kind!=="value"&&a.concat(1).checkSubtype(h,A.type)?null:new Tc(h,m,A,x,_,P):null}evaluate(i){const a=this.input.evaluate(i);return(gg(so(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],m={};for(const _ of a){const A=m[this.cases[_]];A===void 0?(m[this.cases[_]]=h.length,h.push([this.cases[_],[_]])):h[A][1].push(_)}const x=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,A]of h)i.push(A.length===1?x(A[0]):A.map(x)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class Ec{constructor(i,a,h){this.type=i,this.branches=a,this.otherwise=h}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const m=[];for(let _=1;_<i.length-1;_+=2){const A=a.parse(i[_],_,Ui);if(!A)return null;const P=a.parse(i[_+1],_+1,h);if(!P)return null;m.push([A,P]),h=h||P.type}const x=a.parse(i[i.length-1],i.length-1,h);return x?new Ec(h,m,x):null}evaluate(i){for(const[a,h]of this.branches)if(a.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,h]of this.branches)i(a),i(h);i(this.otherwise)}outputDefined(){return this.branches.every((([i,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild((a=>{i.push(a.serialize())})),i}}class Ou{constructor(i,a,h,m){this.type=i,this.input=a,this.beginIndex=h,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,qi),m=a.parse(i[2],2,sr);if(!h||!m)return null;if(!ey(h.type,[Bo(qi),Ii,qi]))return a.error(`Expected first argument to be of type array or string, but found ${io(h.type)} instead`);if(i.length===4){const x=a.parse(i[3],3,sr);return x?new Ou(h.type,h,m,x):null}return new Ou(h.type,h,m)}evaluate(i){const a=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!bf(a,["string","array"]))throw new $s(`Expected first argument to be of type array or string, but found ${io(so(a))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return a.slice(h,m)}return a.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class kh{constructor(i,a){this.type=Bo(Ii),this.str=i,this.delimiter=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,Ii),m=a.parse(i[2],2,Ii);return h&&m?new kh(h,m):void 0}evaluate(i){const a=this.str.evaluate(i),h=this.delimiter.evaluate(i);return a.split(h)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Kp(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function kl(c,i,a,h){return h.compare(i,a)===0}function fa(c,i,a){const h=c!=="=="&&c!=="!=";return class OW{constructor(x,_,A){this.type=Ui,this.lhs=x,this.rhs=_,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||_.type.kind==="value"}static parse(x,_){if(x.length!==3&&x.length!==4)return _.error("Expected two or three arguments.");const A=x[0];let P=_.parse(x[1],1,qi);if(!P)return null;if(!Kp(A,P.type))return _.concat(1).error(`"${A}" comparisons are not supported for type '${io(P.type)}'.`);let N=_.parse(x[2],2,qi);if(!N)return null;if(!Kp(A,N.type))return _.concat(2).error(`"${A}" comparisons are not supported for type '${io(N.type)}'.`);if(P.type.kind!==N.type.kind&&P.type.kind!=="value"&&N.type.kind!=="value")return _.error(`Cannot compare types '${io(P.type)}' and '${io(N.type)}'.`);h&&(P.type.kind==="value"&&N.type.kind!=="value"?P=new Xn(N.type,[P]):P.type.kind!=="value"&&N.type.kind==="value"&&(N=new Xn(P.type,[N])));let V=null;if(x.length===4){if(P.type.kind!=="string"&&N.type.kind!=="string"&&P.type.kind!=="value"&&N.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(V=_.parse(x[3],3,Rp),!V)return null}return new OW(P,N,V)}evaluate(x){const _=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const P=so(_),N=so(A);if(P.kind!==N.kind||P.kind!=="string"&&P.kind!=="number")throw new $s(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${P.kind}, ${N.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=so(_),N=so(A);if(P.kind!=="string"||N.kind!=="string")return i(x,_,A)}return this.collator?a(x,_,A,this.collator.evaluate(x)):i(x,_,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[c];return this.eachChild((_=>{x.push(_.serialize())})),x}}}const Ld=fa("==",(function(c,i,a){return i===a}),kl),ou=fa("!=",(function(c,i,a){return i!==a}),(function(c,i,a,h){return!kl(0,i,a,h)})),Fu=fa("<",(function(c,i,a){return i<a}),(function(c,i,a,h){return h.compare(i,a)<0})),Ih=fa(">",(function(c,i,a){return i>a}),(function(c,i,a,h){return h.compare(i,a)>0})),u_=fa("<=",(function(c,i,a){return i<=a}),(function(c,i,a,h){return h.compare(i,a)<=0})),Nf=fa(">=",(function(c,i,a){return i>=a}),(function(c,i,a,h){return h.compare(i,a)>=0}));class Yp{constructor(i,a,h,m,x,_){this.type=Ii,this.number=i,this.locale=a,this.currency=h,this.unit=m,this.minFractionDigits=x,this.maxFractionDigits=_}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const h=a.parse(i[1],1,sr);if(!h)return null;const m=i[2];if(typeof m!="object"||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let x=null;if(m.locale&&(x=a.parseObjectValue(m.locale,2,"locale",Ii),!x))return null;let _=null;if(m.currency&&(_=a.parseObjectValue(m.currency,2,"currency",Ii),!_))return null;let A=null;if(m.unit&&(A=a.parseObjectValue(m.unit,2,"unit",Ii),!A))return null;let P=null;if(m["min-fraction-digits"]&&(P=a.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",sr),!P))return null;let N=null;return m["max-fraction-digits"]&&(N=a.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",sr),!N)?null:new Yp(h,x,_,A,P,N)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Ua{constructor(i){this.type=sr,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=a.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${io(h.type)} instead.`):new Ua(h):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new $s(`Expected value to be of type string or array, but found ${io(so(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild((a=>{i.push(a.serialize())})),i}}function hl(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const Ws={"==":Ld,"!=":ou,">":Ih,"<":Fu,">=":Nf,"<=":u_,array:Xn,at:Rf,"at-interpolated":Zp,boolean:Xn,case:Ec,coalesce:Pf,collator:Ad,format:Td,image:Cr,in:Cg,"index-of":Qp,interpolate:dl,"interpolate-hcl":dl,"interpolate-lab":dl,length:Ua,let:Ml,literal:tu,match:Tc,number:Xn,"number-format":Yp,object:Xn,slice:Ou,step:qp,string:Xn,"to-boolean":al,"to-color":al,"to-number":al,"to-string":al,var:Cl,within:Md,distance:Th,config:vc,split:kh};function Il(c,[i,a,h,m]){i=i.evaluate(c),a=a.evaluate(c),h=h.evaluate(c);const x=m?m.evaluate(c):1,_=yg(i,a,h,x);if(_)throw new $s(_);return new Wi(i/255,a/255,h/255,x)}function ay(c,[i,a,h,m]){i=i.evaluate(c),a=a.evaluate(c),h=h.evaluate(c);const x=m?m.evaluate(c):1,_=(function(N,V,H,G){return typeof N=="number"&&N>=0&&N<=360?typeof V=="number"&&V>=0&&V<=100&&typeof H=="number"&&H>=0&&H<=100?G===void 0||typeof G=="number"&&G>=0&&G<=1?null:`Invalid hsla value [${[N,V,H,G].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof G=="number"?[N,V,H,G]:[N,V,H]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof G=="number"?[N,V,H,G]:[N,V,H]).join(", ")}]: 'h' must be between 0 and 360.`})(i,a,h,x);if(_)throw new $s(_);const A=`hsla(${i}, ${a}%, ${h}%, ${x})`,P=Wi.parse(A);if(!P)throw new $s(`Failed to parse HSLA color: ${A}`);return P}function ly(c,i){return c in i}function jf(c,i){const a=i[c];return a===void 0?null:a}function Ac(c){return{type:c}}function Df(c){if(c instanceof vc)return new Set([c.key]);let i=new Set;return c.eachChild((a=>{i=new Set([...i,...Df(a)])})),i}function Ph(c){if(c instanceof ha&&c.name==="is-active-floor")return!0;let i=!1;return c.eachChild((a=>{!i&&Ph(a)&&(i=!0)})),i}function Od(c){return{result:"success",value:c}}function Pl(c){return{result:"error",value:c}}function Jp(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function Mg(c){return c["property-type"]==="data-driven"}function Rh(c){return Jp(c.expression,"measure-light")}function Lf(c){return Jp(c.expression,"zoom")}function em(c){return!!c.expression&&c.expression.interpolated}function tm(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Fd(c){return c}function nm(c,i){const a=i.type==="color",h=c.stops&&typeof c.stops[0][0]=="object",m=h||!(h||c.property!==void 0),x=c.type||(em(i)?"exponential":"interval");if(a&&((c=Object.assign({},c)).stops&&(c.stops=c.stops.map((N=>[N[0],Wi.parse(N[1])]))),c.default=Wi.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Xp[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _,A,P;if(x==="exponential")_=Ig;else if(x==="interval")_=Rl;else if(x==="categorical"){_=kg,A=Object.create(null);for(const N of c.stops)A[N[0]]=N[1];P=typeof c.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);_=cy}if(h){const N={},V=[];for(let Y=0;Y<c.stops.length;Y++){const J=c.stops[Y],oe=J[0].zoom;N[oe]===void 0&&(N[oe]={zoom:oe,type:c.type,property:c.property,default:c.default,stops:[]},V.push(oe)),N[oe].stops.push([J[0].value,J[1]])}const H=[];for(const Y of V)H.push([N[Y].zoom,nm(N[Y],i)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:dl.interpolationFactor.bind(void 0,G),zoomStops:H.map((Y=>Y[0])),evaluate:({zoom:Y},J)=>Ig({stops:H,base:c.base},i,Y).evaluate(Y,J)}}if(m){const N=x==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:dl.interpolationFactor.bind(void 0,N),zoomStops:c.stops.map((V=>V[0])),evaluate:({zoom:V})=>_(c,i,V,A,P)}}return{kind:"source",evaluate(N,V){const H=V&&V.properties?V.properties[c.property]:void 0;return H===void 0?Bu(c.default,i.default):_(c,i,H,A,P)}}}function Bu(c,i,a){return c!==void 0?c:i!==void 0?i:a!==void 0?a:void 0}function kg(c,i,a,h,m){return Bu(typeof a===m?h[a]:void 0,c.default,i.default)}function Rl(c,i,a){if(!Sf(a))return Bu(c.default,i.default);const h=c.stops.length;if(h===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[h-1][0])return c.stops[h-1][1];const m=Mf(c.stops.map((x=>x[0])),a);return c.stops[m][1]}function Ig(c,i,a){const h=c.base!==void 0?c.base:1;if(!Sf(a))return Bu(c.default,i.default);const m=c.stops.length;if(m===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[m-1][0])return c.stops[m-1][1];const x=Mf(c.stops.map((V=>V[0])),a),_=(function(V,H,G,Y){const J=Y-G,oe=V-G;return J===0?0:H===1?oe/J:(Math.pow(H,oe)-1)/(Math.pow(H,J)-1)})(a,h,c.stops[x][0],c.stops[x+1][0]),A=c.stops[x][1],P=c.stops[x+1][1];let N=Iu[i.type]||Fd;if(c.colorSpace&&c.colorSpace!=="rgb"){const V=Xp[c.colorSpace];N=(H,G)=>V.reverse(V.interpolate(V.forward(H),V.forward(G),_))}return typeof A.evaluate=="function"?{evaluate(...V){const H=A.evaluate.apply(void 0,V),G=P.evaluate.apply(void 0,V);if(H!==void 0&&G!==void 0)return N(H,G,_)}}:N(A,P,_)}function cy(c,i,a){return i.type==="color"?a=Wi.parse(a):i.type==="formatted"?a=Io.fromString(a.toString()):i.type==="resolvedImage"?a=za.build(a.toString()):wf(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Bu(a,c.default,i.default)}ha.register(Ws,{error:[{kind:"error"},[Ii],(c,[i])=>{throw new $s(i.evaluate(c))}],typeof:[Ii,[qi],(c,[i])=>io(so(i.evaluate(c)))],"to-rgba":[Bo(sr,4),[ol],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Bo(sr,4),[ol],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ol,[sr,sr,sr],Il],rgba:[ol,[sr,sr,sr,sr],Il],hsl:[ol,[sr,sr,sr],ay],hsla:[ol,[sr,sr,sr,sr],ay],has:{type:Ui,overloads:[[[Ii],(c,[i])=>ly(i.evaluate(c),c.properties())],[[Ii,vf],(c,[i,a])=>ly(i.evaluate(c),a.evaluate(c))]]},get:{type:qi,overloads:[[[Ii],(c,[i])=>jf(i.evaluate(c),c.properties())],[[Ii,vf],(c,[i,a])=>jf(i.evaluate(c),a.evaluate(c))]]},"feature-state":[qi,[Ii],(c,[i])=>jf(i.evaluate(c),c.featureState||{})],properties:[vf,[],c=>c.properties()],"geometry-type":[Ii,[],c=>c.geometryType()],worldview:[Ii,[],c=>c.globals.worldview||""],"is-active-floor":[Ui,Ac(Ii),(c,i)=>{if(!(c.globals.activeFloors&&c.globals.activeFloors.size>0))return!1;const a=c.globals.activeFloors;return i.some((h=>{const m=h.evaluate(c);return a.has(m)}))}],id:[qi,[],c=>c.id()],zoom:[sr,[],c=>c.globals.zoom],pitch:[sr,[],c=>c.globals.pitch||0],"distance-from-center":[sr,[],c=>c.distanceFromCenter()],"measure-light":[sr,[Ii],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[sr,[],c=>c.globals.heatmapDensity||0],"line-progress":[sr,[],c=>c.globals.lineProgress||0],"raster-value":[sr,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[sr,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[sr,[],c=>c.globals.skyRadialProgress||0],accumulated:[qi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[sr,Ac(sr),(c,i)=>{let a=0;for(const h of i)a+=h.evaluate(c);return a}],"*":[sr,Ac(sr),(c,i)=>{let a=1;for(const h of i)a*=h.evaluate(c);return a}],"-":{type:sr,overloads:[[[sr,sr],(c,[i,a])=>i.evaluate(c)-a.evaluate(c)],[[sr],(c,[i])=>-i.evaluate(c)]]},"/":[sr,[sr,sr],(c,[i,a])=>i.evaluate(c)/a.evaluate(c)],"%":[sr,[sr,sr],(c,[i,a])=>i.evaluate(c)%a.evaluate(c)],ln2:[sr,[],()=>Math.LN2],pi:[sr,[],()=>Math.PI],e:[sr,[],()=>Math.E],"^":[sr,[sr,sr],(c,[i,a])=>Math.pow(i.evaluate(c),a.evaluate(c))],sqrt:[sr,[sr],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[sr,[sr],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[sr,[sr],(c,[i])=>Math.log(i.evaluate(c))],log2:[sr,[sr],(c,[i])=>Math.log2(i.evaluate(c))],sin:[sr,[sr],(c,[i])=>Math.sin(i.evaluate(c))],cos:[sr,[sr],(c,[i])=>Math.cos(i.evaluate(c))],tan:[sr,[sr],(c,[i])=>Math.tan(i.evaluate(c))],asin:[sr,[sr],(c,[i])=>Math.asin(i.evaluate(c))],acos:[sr,[sr],(c,[i])=>Math.acos(i.evaluate(c))],atan:[sr,[sr],(c,[i])=>Math.atan(i.evaluate(c))],min:[sr,Ac(sr),(c,i)=>Math.min(...i.map((a=>a.evaluate(c))))],max:[sr,Ac(sr),(c,i)=>Math.max(...i.map((a=>a.evaluate(c))))],abs:[sr,[sr],(c,[i])=>Math.abs(i.evaluate(c))],round:[sr,[sr],(c,[i])=>{const a=i.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[sr,[sr],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[sr,[sr],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[Ui,[Ii,qi],(c,[i,a])=>c.properties()[i.value]===a.value],"filter-id-==":[Ui,[qi],(c,[i])=>c.id()===i.value],"filter-type-==":[Ui,[Ii],(c,[i])=>c.geometryType()===i.value],"filter-<":[Ui,[Ii,qi],(c,[i,a])=>{const h=c.properties()[i.value],m=a.value;return typeof h==typeof m&&h<m}],"filter-id-<":[Ui,[qi],(c,[i])=>{const a=c.id(),h=i.value;return typeof a==typeof h&&a<h}],"filter->":[Ui,[Ii,qi],(c,[i,a])=>{const h=c.properties()[i.value],m=a.value;return typeof h==typeof m&&h>m}],"filter-id->":[Ui,[qi],(c,[i])=>{const a=c.id(),h=i.value;return typeof a==typeof h&&a>h}],"filter-<=":[Ui,[Ii,qi],(c,[i,a])=>{const h=c.properties()[i.value],m=a.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[Ui,[qi],(c,[i])=>{const a=c.id(),h=i.value;return typeof a==typeof h&&a<=h}],"filter->=":[Ui,[Ii,qi],(c,[i,a])=>{const h=c.properties()[i.value],m=a.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[Ui,[qi],(c,[i])=>{const a=c.id(),h=i.value;return typeof a==typeof h&&a>=h}],"filter-has":[Ui,[qi],(c,[i])=>i.value in c.properties()],"filter-has-id":[Ui,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ui,[Bo(Ii)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ui,[Bo(qi)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[Ui,[Ii,Bo(qi)],(c,[i,a])=>a.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[Ui,[Ii,Bo(qi)],(c,[i,a])=>(function(h,m,x,_){for(;x<=_;){const A=x+_>>1;if(m[A]===h)return!0;m[A]>h?_=A-1:x=A+1}return!1})(c.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Ui,overloads:[[[Ui,Ui],(c,[i,a])=>i.evaluate(c)&&a.evaluate(c)],[Ac(Ui),(c,i)=>{for(const a of i)if(!a.evaluate(c))return!1;return!0}]]},any:{type:Ui,overloads:[[[Ui,Ui],(c,[i,a])=>i.evaluate(c)||a.evaluate(c)],[Ac(Ui),(c,i)=>{for(const a of i)if(a.evaluate(c))return!0;return!1}]]},"!":[Ui,[Ui],(c,[i])=>!i.evaluate(c)],"is-supported-script":[Ui,[Ii],(c,[i])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(i.evaluate(c))}],upcase:[Ii,[Ii],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[Ii,[Ii],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[Ii,Ac(qi),(c,i)=>i.map((a=>eu(a.evaluate(c)))).join("")],"resolved-locale":[Ii,[Rp],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[sr,[sr,sr,qi],(c,i)=>{const[a,h,m]=i.map((_=>_.evaluate(c)));if(a>h||a===h)return a;let x;if(typeof m=="string")x=(function(_){let A=0;if(_.length===0)return A;for(let P=0;P<_.length;P++)A=(A<<5)-A+_.charCodeAt(P),A|=0;return A})(m);else{if(typeof m!="number")throw new $s(`Invalid seed input: ${m}`);x=m}return a+hl(x)()*(h-a)}]});class Of{constructor(i,a,h,m,x){this.expression=i,this._warningHistory={},this._scope=h,this._options=m,this._iconImageUseTheme=x,this._evaluator=new go(h,m,x),this._defaultValue=a?(function(_){return _.type==="color"&&(tm(_.default)||Array.isArray(_.default))?new Wi(0,0,0,0):_.type==="color"?Wi.parse(_.default)||null:_.default===void 0?null:_.default})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=Df(i),this.isIndoorDependent=Ph(i)}evaluateWithoutErrorHandling(i,a,h,m,x,_,A,P){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,h,m,x,_,A,P,N){this._evaluator||(this._evaluator=new go(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this._evaluator.iconImageUseTheme=N||null;try{const V=this.expression.evaluate(this._evaluator);if(V==null||typeof V=="number"&&V!=V)return this._defaultValue;if(this._enumValues&&!(V in this._enumValues))throw new $s(`Expected value to be one of ${Object.keys(this._enumValues).map((H=>JSON.stringify(H))).join(", ")}, but found ${JSON.stringify(V)} instead.`);return V}catch(V){return this._warningHistory[V.message]||(this._warningHistory[V.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${V.message}`)),this._defaultValue}}}function Ff(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Ws}function Va(c,i,a,h,m){const x=new Nd(Ws,[],i?(function(A){const P={color:ol,string:Ii,number:sr,enum:Ii,boolean:Ui,formatted:gh,resolvedImage:Np};return A.type==="array"?Bo(P[A.value]||qi,A.length):P[A.type]})(i):void 0,void 0,void 0,a,h,m),_=x.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Od(new Of(_,i,a,h,m)):Pl(x.errors)}class Sa{constructor(i,a,h,m){this.kind=i,this._styleExpression=a,this.isLightConstant=h,this.isLineProgressConstant=m,this.isStateDependent=i!=="constant"&&!Wp(a.expression),this.configDependencies=Df(a.expression),this.isIndoorDependent=Ph(a.expression)}evaluateWithoutErrorHandling(i,a,h,m,x,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,m,x,_)}evaluate(i,a,h,m,x,_,A){return this._styleExpression.evaluate(i,a,h,m,x,_,void 0,void 0,A)}}class fl{constructor(i,a,h,m,x,_){this.kind=i,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!Wp(a.expression),this.isIndoorDependent=Ph(a.expression),this.isLightConstant=x,this.isLineProgressConstant=_,this.configDependencies=Df(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,h,m,x,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,m,x,_)}evaluate(i,a,h,m,x,_){return this._styleExpression.evaluate(i,a,h,m,x,_)}interpolationFactor(i,a,h){return this.interpolationType?dl.interpolationFactor(this.interpolationType,i,a,h):0}}function rm(c,i,a,h,m){if((c=Va(c,i,a,h,m)).result==="error")return c;const x=c.value.expression,_=Eh(x);if(!_&&!Mg(i))return Pl([new ql("","data expressions not supported")]);const A=Cf(x,["zoom","pitch","distance-from-center"]);if(!A&&!Lf(i))return Pl([new ql("","zoom expressions not supported")]);const P=Cf(x,["measure-light"]);if(!P&&!Rh(i))return Pl([new ql("","measure-light expression not supported")]);const N=Cf(x,["line-progress"]);if(!N&&!(function(G){return Jp(G.expression,"line-progress")})(i))return Pl([new ql("","line-progress expression not supported")]);const V=i.expression&&i.expression.relaxZoomRestriction,H=Kl(x);return H||A||V?H instanceof ql?Pl([H]):H instanceof dl&&!em(i)?Pl([new ql("",'"interpolate" expressions cannot be used with this property')]):Od(H?new fl(_&&N?"camera":"composite",c.value,H.labels,H instanceof dl?H.interpolation:void 0,P,N):new Sa(_&&N?"constant":"source",c.value,P,N)):Pl([new ql("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class im{constructor(i,a){this._parameters=i,this._specification=a,Object.assign(this,nm(this._parameters,this._specification))}static deserialize(i){return new im(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Kl(c){let i=null;if(c instanceof Ml)i=Kl(c.result);else if(c instanceof Pf){for(const a of c.args)if(i=Kl(a),i)break}else(c instanceof qp||c instanceof dl)&&c.input instanceof ha&&c.input.name==="zoom"&&(i=c);return i instanceof ql||c.eachChild((a=>{const h=Kl(a);h instanceof ql?i=h:i&&h&&i!==h&&(i=new ql("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}var Yl,Bf,uy=(function(){if(Bf)return Yl;Bf=1,Yl=i;var c=3;function i(a,h,m){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(h=_[1])+2*(m=_[2]);for(var A=0;A<this.d*this.d;A++){var P=_[c+A],N=_[c+A+1];x.push(P===N?null:_.subarray(P,N))}var V=_[c+x.length+1];this.keys=_.subarray(_[c+x.length],V),this.bboxes=_.subarray(V),this.insert=this._insertReadonly}else{this.d=h+2*m;for(var H=0;H<this.d*this.d;H++)x.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=m,this.scale=h/a,this.uid=0;var G=m/h*a;this.min=-G,this.max=a+G}return i.prototype.insert=function(a,h,m,x,_){this._forEachCell(h,m,x,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,h,m,x,_,A){this.cells[_].push(A)},i.prototype.query=function(a,h,m,x,_){var A=this.min,P=this.max;if(a<=A&&h<=A&&P<=m&&P<=x&&!_)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,h,m,x,this._queryCell,N,{},_),N},i.prototype._queryCell=function(a,h,m,x,_,A,P,N){var V=this.cells[_];if(V!==null)for(var H=this.keys,G=this.bboxes,Y=0;Y<V.length;Y++){var J=V[Y];if(P[J]===void 0){var oe=4*J;(N?N(G[oe+0],G[oe+1],G[oe+2],G[oe+3]):a<=G[oe+2]&&h<=G[oe+3]&&m>=G[oe+0]&&x>=G[oe+1])?(P[J]=!0,A.push(H[J])):P[J]=!1}}},i.prototype._forEachCell=function(a,h,m,x,_,A,P,N){for(var V=this._convertToCellCoord(a),H=this._convertToCellCoord(h),G=this._convertToCellCoord(m),Y=this._convertToCellCoord(x),J=V;J<=G;J++)for(var oe=H;oe<=Y;oe++){var ue=this.d*oe+J;if((!N||N(this._convertFromCellCoord(J),this._convertFromCellCoord(oe),this._convertFromCellCoord(J+1),this._convertFromCellCoord(oe+1)))&&_.call(this,a,h,m,x,ue,A,P,N))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=c+this.cells.length+1+1,m=0,x=0;x<this.cells.length;x++)m+=this.cells[x].length;var _=new Int32Array(h+m+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var A=h,P=0;P<a.length;P++){var N=a[P];_[c+P]=A,_.set(N,A),A+=N.length}return _[c+a.length]=A,_.set(this.keys,A),_[c+a.length+1]=A+=this.keys.length,_.set(this.bboxes,A),A+=this.bboxes.length,_.buffer},Yl})(),Ha=ni(uy);const Nl={};function Fn(c,i,a={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),Nl[i]={klass:c,omit:a.omit||[]}}Fn(Object,"Object"),Ha.serialize=function(c,i){const a=c.toArrayBuffer();return i&&i.add(a),{buffer:a}},Ha.deserialize=function(c){return new Ha(c.buffer)},Object.defineProperty(Ha,"name",{value:"Grid"}),Fn(Ha,"Grid"),delete Ht.prototype.constructor,typeof DOMMatrix<"u"&&Fn(DOMMatrix,"DOMMatrix"),Fn(Wi,"Color"),Fn(Error,"Error"),Fn(Io,"Formatted"),Fn(Dp,"FormattedSection"),Fn(uh,"AJAXError"),Fn(za,"ResolvedImage"),Fn(im,"StylePropertyFunction"),Fn(Of,"StyleExpression",{omit:["_evaluator"]}),Fn(bs,"ImageId"),Fn(Pu,"ImageVariant"),Fn(fl,"ZoomDependentExpression"),Fn(Sa,"ZoomConstantExpression"),Fn(ha,"CompoundExpression",{omit:["_evaluate"]});for(const c in Ws)Nl[Ws[c]._classRegistryKey]||Fn(Ws[c],`Expression${c}`);function Pg(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Jl(c){return self.ImageBitmap&&c instanceof ImageBitmap}function zu(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Pg(c)||Jl(c))return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const h of c)a.push(zu(h,i));return a}if(c instanceof Map){const a={$name:"Map",entries:[]};for(const[h,m]of c.entries())a.entries.push(zu(h),zu(m,i));return a}if(c instanceof Set){const a={$name:"Set"};let h=0;for(const m of c.values())a[++h]=zu(m);return a}if(c instanceof DOMMatrix){const a={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of h)a[m]=c[m];return a}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const a=c.constructor,h=a._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const m=a.serialize?a.serialize(c,i):{};if(!a.serialize){for(const x in c)c.hasOwnProperty(x)&&(Nl[h].omit.indexOf(x)>=0||(m[x]=zu(c[x],i)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof c)}function ec(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Pg(c)||Jl(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ec);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const m=c.entries||[],x=new Map;for(let _=0;_<m.length;_+=2)x.set(ec(m[_]),ec(m[_+1]));return x}if(i==="Set"){const m=new Set;for(const x of Object.keys(c))x!=="$name"&&m.add(ec(c[x]));return m}if(i==="DOMMatrix"){let m;return m=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(m)}if(i==="BigInt")return BigInt(c.value);const{klass:a}=Nl[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(c);const h=Object.create(a.prototype);for(const m of Object.keys(c))m!=="$name"&&(h[m]=ec(c[m]));return h}throw new Error("can't deserialize object of type "+typeof c)}const pr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function Nh(c){for(const i of c)if(Uf(i.charCodeAt(0)))return!0;return!1}function zf(c){for(const i of c)if(!au(i.charCodeAt(0)))return!1;return!0}function au(c){return!(pr.Arabic(c)||pr["Arabic Supplement"](c)||pr["Arabic Extended-A"](c)||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c))}function Uf(c){return!(c!==746&&c!==747&&(c<4352||!(pr["Bopomofo Extended"](c)||pr.Bopomofo(c)||pr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||pr["CJK Compatibility Ideographs"](c)||pr["CJK Compatibility"](c)||pr["CJK Radicals Supplement"](c)||pr["CJK Strokes"](c)||!(!pr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||pr["CJK Unified Ideographs Extension A"](c)||pr["CJK Unified Ideographs"](c)||pr["Enclosed CJK Letters and Months"](c)||pr["Hangul Compatibility Jamo"](c)||pr["Hangul Jamo Extended-A"](c)||pr["Hangul Jamo Extended-B"](c)||pr["Hangul Jamo"](c)||pr["Hangul Syllables"](c)||pr.Hiragana(c)||pr["Ideographic Description Characters"](c)||pr.Kanbun(c)||pr["Kangxi Radicals"](c)||pr["Katakana Phonetic Extensions"](c)||pr.Katakana(c)&&c!==12540||!(!pr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!pr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||pr["Unified Canadian Aboriginal Syllabics"](c)||pr["Unified Canadian Aboriginal Syllabics Extended"](c)||pr["Vertical Forms"](c)||pr["Yijing Hexagram Symbols"](c)||pr["Yi Syllables"](c)||pr["Yi Radicals"](c))))}function Bd(c){return!(Uf(c)||(function(i){return!!(pr["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||pr["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||pr["Letterlike Symbols"](i)||pr["Number Forms"](i)||pr["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||pr["Control Pictures"](i)&&i!==9251||pr["Optical Character Recognition"](i)||pr["Enclosed Alphanumerics"](i)||pr["Geometric Shapes"](i)||pr["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||pr["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||pr["CJK Symbols and Punctuation"](i)||pr.Katakana(i)||pr["Private Use Area"](i)||pr["CJK Compatibility Forms"](i)||pr["Small Form Variants"](i)||pr["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)})(c))}function Rg(c){return pr.Arabic(c)||pr["Arabic Supplement"](c)||pr["Arabic Extended-A"](c)||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c)}function Ng(c){return c>=1424&&c<=2303||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c)}function yo(c,i){return!(!i&&Ng(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||pr.Khmer(c))}function jg(c){for(const i of c)if(Ng(i.charCodeAt(0)))return!0;return!1}const Ta={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let sm=null,$o=Ta.unavailable,lu=null;const zd=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&($o=Ta.error),sm&&sm(c)};function uo(){Ro.fire(new wa("pluginStateChange",{pluginStatus:$o,pluginURL:lu}))}const Ro=new Jc,Uo=function(){return $o},Vf=function(){if($o!==Ta.deferred||!lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$o=Ta.loading,uo(),lu&&dh({url:lu},(c=>{c?zd(c):($o=Ta.loaded,uo())}))},na={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$o===Ta.loaded||na.applyArabicShaping!=null,isLoading:()=>$o===Ta.loading,setState(c){$o=c.pluginStatus,lu=c.pluginURL},isParsing:()=>$o===Ta.parsing,isParsed:()=>$o===Ta.parsed,getPluginURL:()=>lu};class rs{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return(function(a,h){for(const m of a)if(!yo(m.charCodeAt(0),h))return!1;return!0})(i,na.isLoaded())}}class om{constructor(i,a,h,m,x){this.property=i,this.value=a,this.expression=(function(_,A,P,N,V){if(tm(_))return new im(_,A);if(Ff(_)||Array.isArray(_)&&_.length>0){const H=rm(_,A,P,N,V);if(H.result==="error")throw new Error(H.value.map((G=>`${G.key}: ${G.message}`)).join(", "));return H.value}{let H=_;return typeof _=="string"&&A.type==="color"&&(H=Wi.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>H}}})(a===void 0?i.specification.default:a,i.specification,h,m,x)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,h,m){return this.property.possiblyEvaluate(this,i,a,h,m)}}class No{constructor(i,a,h,m){this.property=i,this.value=new om(i,void 0,a,h,m)}transitioned(i,a){return new Lg(this.property,this.value,a,Object.assign({},i.transition,this.transition),i.now)}untransitioned(){return new Lg(this.property,this.value,null,{},0)}}class Dg{constructor(i,a,h,m){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return Re(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new No(this._values[i].property,this._scope,this._options,this._iconImageUseTheme)),this._values[i].value=new om(this._values[i].property,a===null?void 0:Re(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].value.isIndoorDependent())}setTransitionOrValue(i,a){a&&(this._options=a);const h=this._properties.properties;if(i)for(const m in i){const x=i[m];if(m.endsWith("-transition")){const _=m.slice(0,-11);h[_]&&this.setTransition(_,x)}else h.hasOwnProperty(m)&&this.setValue(m,x)}}getTransition(i){return Re(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new No(this._values[i].property)),this._values[i].transition=Re(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(i[a]=h);const m=this.getTransition(a);m!==void 0&&(i[`${a}-transition`]=m)}return i}transitioned(i,a){const h=new Cc(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(i,a._values[m]);return h}untransitioned(){const i=new Cc(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}isIndoorDependent(){return this._isIndoorDependent}}class Lg{constructor(i,a,h,m,x){const _=m.delay||0,A=m.duration||0;x=x||0,this.property=i,this.value=a,this.begin=x+_,this.end=this.begin+A,i.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(i,a,h){const m=i.now||0,x=this.value.possiblyEvaluate(i,a,h),_=this.prior;if(_){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return _.possiblyEvaluate(i,a,h);{const A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,a,h),x,Hl(A))}}return x}}class Cc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,h){const m=new Mc(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].possiblyEvaluate(i,a,h);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class tc{constructor(i,a,h,m){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return Re(this._values[i].value)}setValue(i,a){this._values[i]=new om(this._values[i].property,a===null?void 0:Re(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].isIndoorDependent())}serialize(){const i={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(i[a]=h)}return i}possiblyEvaluate(i,a,h,m){const x=new Mc(this._properties);for(const _ of Object.keys(this._values))x._values[_]=this._values[_].possiblyEvaluate(i,a,h,m);return x}isIndoorDependent(){return this._isIndoorDependent}}class xo{constructor(i,a,h,m){this.property=i,this.value=a,this.parameters=h,this.iconImageUseTheme=m}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,h,m){return this.property.evaluate(this.value,this.parameters,i,a,h,m,this.iconImageUseTheme)}}class Mc{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class dn{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,h){const m=Iu[this.specification.type];return m?m(i,a,h):i}}class Pn{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,h,m,x){return i.expression.kind==="constant"||i.expression.kind==="camera"?new xo(this,{kind:"constant",value:i.expression.evaluate(a,null,{},h,m,void 0,x)},a):new xo(this,i.expression,a,x)}interpolate(i,a,h){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},i.parameters);const m=Iu[this.specification.type];return m?new xo(this,{kind:"constant",value:m(i.value.value,a.value.value,h)},i.parameters):i}evaluate(i,a,h,m,x,_,A){return i.kind==="constant"?i.value:i.evaluate(a,h,m,x,_,void 0,A)}}class jh{constructor(i){this.specification=i}possiblyEvaluate(i,a,h,m){return!!i.expression.evaluate(a,null,{},h,m)}interpolate(){return!1}}class Ns{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new rs(0,{});for(const h in i){const m=i[h];m.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new om(m,void 0),_=this.defaultTransitionablePropertyValues[h]=new No(m);this.defaultTransitioningPropertyValues[h]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(a)}}}Fn(Pn,"DataDrivenProperty"),Fn(dn,"DataConstantProperty"),Fn(jh,"ColorRampProperty");var ft=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Og(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Dh(c){if(Array.isArray(c))return c.map(Dh);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const a in c)i[a]=Dh(c[a]);return i}return Og(c)}function Lh(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Lh(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function am(c,i="",a=null,h="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lh(c)||(c=Ga(c));const m=c;let x=!0;try{x=(function(V){if(!Oh(V))return V;let H=Dh(V);return cu(H),H=lm(H),H})(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let _=null,A=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){A=ft[`filter_${h}`];const V=Va(x,A,i,a);if(V.result==="error")throw new Error(V.value.map((H=>`${H.key}: ${H.message}`)).join(", "));_=(H,G,Y)=>V.value.evaluate(H,G,{},Y)}let P=null,N=null;if(x!==m){const V=Va(m,A,i,a);if(V.result==="error")throw new Error(V.value.map((H=>`${H.key}: ${H.message}`)).join(", "));P=(H,G,Y,J,oe)=>V.value.evaluate(H,G,{},Y,void 0,void 0,J,oe),N=!Eh(V.value.expression)}return{filter:_,dynamicFilter:P||void 0,needGeometry:dy(x),needFeature:!!N}}function lm(c){if(!Array.isArray(c))return c;const i=(function(a){if(Fg.has(a[0])){for(let h=1;h<a.length;h++)if(Oh(a[h]))return!0}return a})(c);return i===!0?i:i.map((a=>lm(a)))}function cu(c){let i=!1;const a=[];if(c[0]==="case"){for(let h=1;h<c.length-1;h+=2)i=i||Oh(c[h]),a.push(c[h+1]);a.push(c[c.length-1])}else if(c[0]==="match"){i=i||Oh(c[1]);for(let h=2;h<c.length-1;h+=2)a.push(c[h+1]);a.push(c[c.length-1])}else if(c[0]==="step"){i=i||Oh(c[1]);for(let h=1;h<c.length-1;h+=2)a.push(c[h+1])}i&&(c.length=0,c.push("any",...a));for(let h=1;h<c.length;h++)cu(c[h])}function Oh(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<c.length;a++)if(Oh(c[a]))return!0;return!1}const Fg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cm(c,i){return c<i?-1:c>i?1:0}function dy(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(dy(c[i]))return!0;return!1}function Ga(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?Bg(c[1],c[2],"=="):i==="!="?um(Bg(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Bg(c[1],c[2],i):i==="any"?(a=c.slice(1),["any"].concat(a.map(Ga))):i==="all"?["all"].concat(c.slice(1).map(Ga)):i==="none"?["all"].concat(c.slice(1).map(Ga).map(um)):i==="in"?zg(c[1],c.slice(2)):i==="!in"?um(zg(c[1],c.slice(2))):i==="has"?hy(c[1]):i!=="!has"||um(hy(c[1]));var a}function Bg(c,i,a){switch(c){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,c,i]}}function zg(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some((a=>typeof a!=typeof i[0]))?["filter-in-large",c,["literal",i.sort(cm)]]:["filter-in-small",c,["literal",i]]}}function hy(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function um(c){return["!",c]}const Fh="";function Ud(c,i){return i?`${c}${Fh}${i}`:c}let fy;const py=()=>fy||(fy=new Ns({"icon-size":new Pn(ft.layout_symbol["icon-size"]),"icon-image":new Pn(ft.layout_symbol["icon-image"]),"icon-rotate":new Pn(ft.layout_symbol["icon-rotate"]),"icon-offset":new Pn(ft.layout_symbol["icon-offset"])}));class Pb{constructor(i,a,h,m,x,_){this.cachedIconPrimary=null;const A=Va(i,ft.appearance.condition);if(A.result==="success"&&(this.condition=A.value),this.name=a,h){this.properties=new Mc(py()),this.unevaluatedLayout=new tc(py(),m,x,_);for(const P in h)this.unevaluatedLayout.setValue(P,h[P])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(i){this.cachedIconPrimary=i}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(i){return!(this.condition||!i.isHidden||this.name!=="hidden")||this.condition.evaluate(i.globals,i.feature,i.featureState,i.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(i){return this.properties.get(i)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(i,a,h){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(i,void 0,a,h))}serialize(){const i={};return i.condition=this.condition.expression.serialize(),this.name&&(i.name=this.name),this.unevaluatedLayout&&(i.properties=this.unevaluatedLayout.serialize()),i}}const my="-transition",Rb=new Set(["fill","line","background","hillshade","raster"]);class pa extends Jc{constructor(i,a,h,m,x,_){if(super(),this.id=i.id,this.fqid=Ud(this.id,h),this.type=i.type,this.scope=h,this.lut=m,this.options=x,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const A=Va(this.filter,ft[`filter_${i.type}`]);A.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...A.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||A.value.isIndoorDependent)}if(i.slot&&(this.slot=i.slot),i.appearances&&this.setAppearances(i.appearances),a.layout&&(this._unevaluatedLayout=new tc(a.layout,this.scope,x,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new Dg(a.paint,this.scope,x);for(const A in i.paint)this.setPaintProperty(A,i.paint[A]);for(const A in i.layout)this.setLayoutProperty(A,i.layout[A]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mc(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&Rb.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const h=this._unevaluatedLayout;h._properties.properties[i]&&(h.setValue(i,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),i==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(i){this.appearances=[],i.forEach((a=>{this.appearances.push(new Pb(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(my)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}isPaintProperty(i){return!!this._transitionablePaint._properties.properties[i]}setPaintProperty(i,a){const h=this._transitionablePaint,m=h._properties.properties;if(i.endsWith(my)){const H=i.slice(0,-11);return m[H]&&h.setTransition(H,a||void 0),!1}if(!m[i])return!1;const x=h._values[i],_=x.value.isDataDriven(),A=x.value;h.setValue(i,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(i);const P=h._values[i].value,N=P.isDataDriven(),V=i.endsWith("pattern")||i==="line-dasharray";return N||_||V||this._handleOverridablePaintPropertyUpdate(i,A,P)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,h){return null}_handleOverridablePaintPropertyUpdate(i,a,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(i.appearances=this.appearances.map((a=>a.serialize()))),tn(i,((a,h)=>!(a===void 0||h==="layout"&&!Object.keys(a).length||h==="paint"&&!Object.keys(a).length)))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof xo&&Mg(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const i of this.appearances)if(!Wp(i.condition.expression))return!0;return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=am(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(i,a,h){return{}}queryRadius(i){}queryIntersectsFeature(i,a,h,m,x,_,A,P,N){}}const d_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hf{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hs{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&a.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function di(c,i=1){let a=0,h=0;return{members:c.map((m=>{const x=d_[m.type].BYTES_PER_ELEMENT,_=a=gy(a,Math.max(i,x)),A=m.components||1;return h=Math.max(h,x),a+=x*A,{name:m.name,type:m.type,components:A,offset:_}})),size:gy(a,Math.max(h,i)),alignment:i}}function gy(c,i){return Math.ceil(c/i)*i}class $a extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const m=2*i;return this.int16[m+0]=a,this.int16[m+1]=h,i}}$a.prototype.bytesPerElement=4,Fn($a,"StructArrayLayout2i4");class Bh extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,h)}emplace(i,a,h,m){const x=3*i;return this.int16[x+0]=a,this.int16[x+1]=h,this.int16[x+2]=m,i}}Bh.prototype.bytesPerElement=6,Fn(Bh,"StructArrayLayout3i6");class Ea extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,h,m)}emplace(i,a,h,m,x){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=m,this.int16[_+3]=x,i}}Ea.prototype.bytesPerElement=8,Fn(Ea,"StructArrayLayout4i8");class kc extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}kc.prototype.bytesPerElement=4,Fn(kc,"StructArrayLayout1f4");class Gf extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,h)}emplace(i,a,h,m){const x=4*i,_=2*i;return this.int16[x+0]=a,this.int16[x+1]=h,this.float32[_+1]=m,i}}Gf.prototype.bytesPerElement=8,Fn(Gf,"StructArrayLayout2i1f8");class Ug extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,h)}emplace(i,a,h,m){const x=4*i;return this.int16[x+0]=a,this.int16[x+1]=h,this.int16[x+2]=m,i}}Ug.prototype.bytesPerElement=8,Fn(Ug,"StructArrayLayout3i8");class dm extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,m,x)}emplace(i,a,h,m,x,_){const A=5*i;return this.int16[A+0]=a,this.int16[A+1]=h,this.int16[A+2]=m,this.int16[A+3]=x,this.int16[A+4]=_,i}}dm.prototype.bytesPerElement=10,Fn(dm,"StructArrayLayout5i10");class hm extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,h,m,x,_,A)}emplace(i,a,h,m,x,_,A,P){const N=6*i,V=12*i,H=3*i;return this.int16[N+0]=a,this.int16[N+1]=h,this.uint8[V+4]=m,this.uint8[V+5]=x,this.uint8[V+6]=_,this.uint8[V+7]=A,this.float32[H+2]=P,i}}hm.prototype.bytesPerElement=12,Fn(hm,"StructArrayLayout2i4ub1f12");class Wa extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,h)}emplace(i,a,h,m){const x=3*i;return this.float32[x+0]=a,this.float32[x+1]=h,this.float32[x+2]=m,i}}Wa.prototype.bytesPerElement=12,Fn(Wa,"StructArrayLayout3f12");class jl extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,m,x)}emplace(i,a,h,m,x,_){const A=6*i,P=3*i;return this.uint16[A+0]=a,this.uint16[A+1]=h,this.uint16[A+2]=m,this.uint16[A+3]=x,this.float32[P+2]=_,i}}jl.prototype.bytesPerElement=12,Fn(jl,"StructArrayLayout4ui1f12");class Uu extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,h,m)}emplace(i,a,h,m,x){const _=4*i;return this.uint16[_+0]=a,this.uint16[_+1]=h,this.uint16[_+2]=m,this.uint16[_+3]=x,i}}Uu.prototype.bytesPerElement=8,Fn(Uu,"StructArrayLayout4ui8");class $f extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,h,m,x,_)}emplace(i,a,h,m,x,_,A){const P=6*i;return this.int16[P+0]=a,this.int16[P+1]=h,this.int16[P+2]=m,this.int16[P+3]=x,this.int16[P+4]=_,this.int16[P+5]=A,i}}$f.prototype.bytesPerElement=12,Fn($f,"StructArrayLayout6i12");class Vg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H,G){const Y=this.length;return this.resize(Y+1),this.emplace(Y,i,a,h,m,x,_,A,P,N,V,H,G)}emplace(i,a,h,m,x,_,A,P,N,V,H,G,Y){const J=12*i;return this.int16[J+0]=a,this.int16[J+1]=h,this.int16[J+2]=m,this.int16[J+3]=x,this.uint16[J+4]=_,this.uint16[J+5]=A,this.uint16[J+6]=P,this.uint16[J+7]=N,this.int16[J+8]=V,this.int16[J+9]=H,this.int16[J+10]=G,this.int16[J+11]=Y,i}}Vg.prototype.bytesPerElement=24,Fn(Vg,"StructArrayLayout4i4ui4i24");class zh extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,h,m,x,_)}emplace(i,a,h,m,x,_,A){const P=10*i,N=5*i;return this.int16[P+0]=a,this.int16[P+1]=h,this.int16[P+2]=m,this.float32[N+2]=x,this.float32[N+3]=_,this.float32[N+4]=A,i}}zh.prototype.bytesPerElement=20,Fn(zh,"StructArrayLayout3i3f20");class Vu extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,h,m)}emplace(i,a,h,m,x){const _=4*i;return this.float32[_+0]=a,this.float32[_+1]=h,this.float32[_+2]=m,this.float32[_+3]=x,i}}Vu.prototype.bytesPerElement=16,Fn(Vu,"StructArrayLayout4f16");class Hg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}Hg.prototype.bytesPerElement=4,Fn(Hg,"StructArrayLayout1ul4");class Dl extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const m=2*i;return this.uint16[m+0]=a,this.uint16[m+1]=h,i}}Dl.prototype.bytesPerElement=4,Fn(Dl,"StructArrayLayout2ui4");class Gg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H,G,Y){const J=this.length;return this.resize(J+1),this.emplace(J,i,a,h,m,x,_,A,P,N,V,H,G,Y)}emplace(i,a,h,m,x,_,A,P,N,V,H,G,Y,J){const oe=20*i,ue=10*i;return this.int16[oe+0]=a,this.int16[oe+1]=h,this.int16[oe+2]=m,this.int16[oe+3]=x,this.int16[oe+4]=_,this.float32[ue+3]=A,this.float32[ue+4]=P,this.float32[ue+5]=N,this.float32[ue+6]=V,this.int16[oe+14]=H,this.uint32[ue+8]=G,this.uint16[oe+18]=Y,this.uint16[oe+19]=J,i}}Gg.prototype.bytesPerElement=40,Fn(Gg,"StructArrayLayout5i4f1i1ul2ui40");class $g extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,h,m,x,_,A)}emplace(i,a,h,m,x,_,A,P){const N=8*i;return this.int16[N+0]=a,this.int16[N+1]=h,this.int16[N+2]=m,this.int16[N+4]=x,this.int16[N+5]=_,this.int16[N+6]=A,this.int16[N+7]=P,i}}$g.prototype.bytesPerElement=16,Fn($g,"StructArrayLayout3i2i2i16");class Wo extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,m,x)}emplace(i,a,h,m,x,_){const A=4*i,P=8*i;return this.float32[A+0]=a,this.float32[A+1]=h,this.float32[A+2]=m,this.int16[P+6]=x,this.int16[P+7]=_,i}}Wo.prototype.bytesPerElement=16,Fn(Wo,"StructArrayLayout2f1f2i16");class Vo extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,h,m,x,_)}emplace(i,a,h,m,x,_,A){const P=20*i,N=5*i;return this.uint8[P+0]=a,this.uint8[P+1]=h,this.float32[N+1]=m,this.float32[N+2]=x,this.float32[N+3]=_,this.float32[N+4]=A,i}}Vo.prototype.bytesPerElement=20,Fn(Vo,"StructArrayLayout2ub4f20");class ys extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,h)}emplace(i,a,h,m){const x=3*i;return this.uint16[x+0]=a,this.uint16[x+1]=h,this.uint16[x+2]=m,i}}ys.prototype.bytesPerElement=6,Fn(ys,"StructArrayLayout3ui6");class Uh extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze)}emplace(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze,Ve){const Ye=30*i,nt=15*i,ot=60*i;return this.int16[Ye+0]=a,this.int16[Ye+1]=h,this.int16[Ye+2]=m,this.float32[nt+2]=x,this.float32[nt+3]=_,this.uint16[Ye+8]=A,this.uint16[Ye+9]=P,this.uint32[nt+5]=N,this.uint32[nt+6]=V,this.uint32[nt+7]=H,this.uint16[Ye+16]=G,this.uint16[Ye+17]=Y,this.uint16[Ye+18]=J,this.float32[nt+10]=oe,this.float32[nt+11]=ue,this.uint8[ot+48]=pe,this.uint8[ot+49]=we,this.uint8[ot+50]=Te,this.uint32[nt+13]=Ie,this.int16[Ye+28]=Ze,this.uint8[ot+58]=Ve,i}}Uh.prototype.bytesPerElement=60,Fn(Uh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze,Ve,Ye,nt,ot,Ot,pt,Ut,Zt,en,vn,an,Qt){const sn=this.length;return this.resize(sn+1),this.emplace(sn,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze,Ve,Ye,nt,ot,Ot,pt,Ut,Zt,en,vn,an,Qt)}emplace(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze,Ve,Ye,nt,ot,Ot,pt,Ut,Zt,en,vn,an,Qt,sn){const jt=20*i,Rt=40*i,nn=80*i;return this.float32[jt+0]=a,this.float32[jt+1]=h,this.int16[Rt+4]=m,this.int16[Rt+5]=x,this.int16[Rt+6]=_,this.int16[Rt+7]=A,this.int16[Rt+8]=P,this.int16[Rt+9]=N,this.int16[Rt+10]=V,this.int16[Rt+11]=H,this.int16[Rt+12]=G,this.uint16[Rt+13]=Y,this.uint16[Rt+14]=J,this.uint16[Rt+15]=oe,this.uint16[Rt+16]=ue,this.uint16[Rt+17]=pe,this.uint16[Rt+18]=we,this.uint16[Rt+19]=Te,this.uint16[Rt+20]=Ie,this.uint16[Rt+21]=Ze,this.uint16[Rt+22]=Ve,this.uint16[Rt+23]=Ye,this.uint16[Rt+24]=nt,this.uint16[Rt+25]=ot,this.uint16[Rt+26]=Ot,this.uint16[Rt+27]=pt,this.uint32[jt+14]=Ut,this.float32[jt+15]=Zt,this.float32[jt+16]=en,this.float32[jt+17]=vn,this.float32[jt+18]=an,this.uint8[nn+76]=Qt,this.uint16[Rt+39]=sn,i}}Wg.prototype.bytesPerElement=80,Fn(Wg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class qg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,h,m,x,_)}emplace(i,a,h,m,x,_,A){const P=6*i;return this.float32[P+0]=a,this.float32[P+1]=h,this.float32[P+2]=m,this.float32[P+3]=x,this.float32[P+4]=_,this.float32[P+5]=A,i}}qg.prototype.bytesPerElement=24,Fn(qg,"StructArrayLayout6f24");class Vd extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,m,x)}emplace(i,a,h,m,x,_){const A=5*i;return this.float32[A+0]=a,this.float32[A+1]=h,this.float32[A+2]=m,this.float32[A+3]=x,this.float32[A+4]=_,i}}Vd.prototype.bytesPerElement=20,Fn(Vd,"StructArrayLayout5f20");class fm extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,h,m,x,_,A)}emplace(i,a,h,m,x,_,A,P){const N=7*i;return this.float32[N+0]=a,this.float32[N+1]=h,this.float32[N+2]=m,this.float32[N+3]=x,this.float32[N+4]=_,this.float32[N+5]=A,this.float32[N+6]=P,i}}fm.prototype.bytesPerElement=28,Fn(fm,"StructArrayLayout7f28");class Wf extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H){const G=this.length;return this.resize(G+1),this.emplace(G,i,a,h,m,x,_,A,P,N,V,H)}emplace(i,a,h,m,x,_,A,P,N,V,H,G){const Y=11*i;return this.float32[Y+0]=a,this.float32[Y+1]=h,this.float32[Y+2]=m,this.float32[Y+3]=x,this.float32[Y+4]=_,this.float32[Y+5]=A,this.float32[Y+6]=P,this.float32[Y+7]=N,this.float32[Y+8]=V,this.float32[Y+9]=H,this.float32[Y+10]=G,i}}Wf.prototype.bytesPerElement=44,Fn(Wf,"StructArrayLayout11f44");class pm extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N){const V=this.length;return this.resize(V+1),this.emplace(V,i,a,h,m,x,_,A,P,N)}emplace(i,a,h,m,x,_,A,P,N,V){const H=9*i;return this.float32[H+0]=a,this.float32[H+1]=h,this.float32[H+2]=m,this.float32[H+3]=x,this.float32[H+4]=_,this.float32[H+5]=A,this.float32[H+6]=P,this.float32[H+7]=N,this.float32[H+8]=V,i}}pm.prototype.bytesPerElement=36,Fn(pm,"StructArrayLayout9f36");class Hu extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const m=2*i;return this.float32[m+0]=a,this.float32[m+1]=h,i}}Hu.prototype.bytesPerElement=8,Fn(Hu,"StructArrayLayout2f8");class Xg extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,h,m)}emplace(i,a,h,m,x){const _=6*i;return this.uint32[3*i+0]=a,this.uint16[_+2]=h,this.uint16[_+3]=m,this.uint16[_+4]=x,i}}Xg.prototype.bytesPerElement=12,Fn(Xg,"StructArrayLayout1ul3ui12");class qf extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}qf.prototype.bytesPerElement=2,Fn(qf,"StructArrayLayout1ui2");class Xf extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue){const pe=this.length;return this.resize(pe+1),this.emplace(pe,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue)}emplace(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe){const we=16*i;return this.float32[we+0]=a,this.float32[we+1]=h,this.float32[we+2]=m,this.float32[we+3]=x,this.float32[we+4]=_,this.float32[we+5]=A,this.float32[we+6]=P,this.float32[we+7]=N,this.float32[we+8]=V,this.float32[we+9]=H,this.float32[we+10]=G,this.float32[we+11]=Y,this.float32[we+12]=J,this.float32[we+13]=oe,this.float32[we+14]=ue,this.float32[we+15]=pe,i}}Xf.prototype.bytesPerElement=64,Fn(Xf,"StructArrayLayout16f64");class Vh extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,m,x,_,A){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,h,m,x,_,A)}emplace(i,a,h,m,x,_,A,P){const N=10*i,V=5*i;return this.uint16[N+0]=a,this.uint16[N+1]=h,this.uint16[N+2]=m,this.uint16[N+3]=x,this.float32[V+2]=_,this.float32[V+3]=A,this.float32[V+4]=P,i}}Vh.prototype.bytesPerElement=20,Fn(Vh,"StructArrayLayout4ui3f20");class mm extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}mm.prototype.bytesPerElement=2,Fn(mm,"StructArrayLayout1i2");class Hh extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}Hh.prototype.bytesPerElement=1,Fn(Hh,"StructArrayLayout1ub1");class yy extends Hf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}yy.prototype.size=40;class xy extends Gg{get(i){return new yy(this,i)}}Fn(xy,"CollisionBoxArray");class Zf extends Hf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Zf.prototype.size=60;class Qf extends Uh{get(i){return new Zf(this,i)}}Fn(Qf,"PlacedSymbolArray");class Kf extends Hf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Kf.prototype.size=80;class uu extends Wg{get(i){return new Kf(this,i)}}Fn(uu,"SymbolInstanceArray");class _y extends kc{getoffsetX(i){return this.float32[1*i+0]}}Fn(_y,"GlyphOffsetArray");class vy extends $a{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Fn(vy,"SymbolLineVertexArray");class Yf extends Hf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yf.prototype.size=12;class by extends Xg{get(i){return new Yf(this,i)}}Fn(by,"FeatureIndexArray");class wy extends Dl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Fn(wy,"FillExtrusionCentroidArray");class Jf extends Hf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Jf.prototype.size=6;class ma extends Bh{get(i){return new Jf(this,i)}}Fn(ma,"FillExtrusionWallArray");const h_=di([{name:"a_pos",components:2,type:"Int16"}],4),Nb=di([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Zg=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Li{constructor(i=[]){this.segments=i}_prepareSegment(i,a,h,m){let x=this.segments[this.segments.length-1];return i>Li.MAX_VERTEX_ARRAY_LENGTH&&It(`Max vertices per segment is ${Li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!x||x.vertexLength+i>Li.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:a,primitiveOffset:h,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x}prepareSegment(i,a,h,m){return this._prepareSegment(i,a.length,h.length,m)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,h,m){return new Li([{vertexOffset:i,primitiveOffset:a,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function f_(c,i){return 256*(c=ve(Math.floor(c),0,255))+ve(Math.floor(i),0,255)}Li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn(Li,"SegmentVector");const oi=di([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ep=di([{name:"a_pattern_b",components:4,type:"Uint16"}]),Sy=di([{name:"a_dash",components:4,type:"Uint16"}]);class tp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,h,m){this.ids.push(gm(i)),this.positions.push(a,h,m)}eachPosition(i,a){const h=gm(i);let m=0,x=this.ids.length-1;for(;m<x;){const _=m+x>>1;this.ids[_]>=h?x=_:m=_+1}for(;this.ids[m]===h;)a(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(i,a){const h=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Gh(h,m,0,h.length-1),a&&(a.add(h.buffer),a.add(m.buffer)),{ids:h,positions:m}}static deserialize(i){const a=new tp;let h;a.ids=i.ids,a.positions=i.positions;for(const m of a.ids)m!==h&&a.uniqueIds.push(m),h=m;return a.indexed=!0,a}}function gm(c){const i=+c;return Number.isSafeInteger(i)?i:ph(String(c))}function Gh(c,i,a,h){for(;a<h;){const m=c[a+h>>1];let x=a-1,_=h+1;for(;;){do x++;while(c[x]<m);do _--;while(c[_]>m);if(x>=_)break;$h(c,x,_),$h(i,3*x,3*_),$h(i,3*x+1,3*_+1),$h(i,3*x+2,3*_+2)}_-a<h-_?(Gh(c,i,a,_),a=_+1):(Gh(c,i,_+1,h),h=_)}}function $h(c,i,a){const h=c[i];c[i]=c[a],c[a]=h}Fn(tp,"FeaturePositionMap");class pl{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ym extends pl{constructor(i){super(i),this.current=0}set(i,a,h){this.fetchUniformLocation(i,a)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class Ks extends pl{constructor(i){super(i),this.current=0}set(i,a,h){this.fetchUniformLocation(i,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Ic extends pl{constructor(i){super(i),this.current=[0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Hd extends pl{constructor(i){super(i),this.current=[0,0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Wh extends pl{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class qo extends pl{constructor(i){super(i),this.current=Wi.transparent.toPremultipliedRenderColor(null)}set(i,a,h){this.fetchUniformLocation(i,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const nc=new Float32Array(16);class rc extends pl{constructor(i){super(i),this.current=nc}set(i,a,h){if(this.fetchUniformLocation(i,a)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let m=1;m<16;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const p_=new Float32Array(9),Ty=new Float32Array(4);class Ll extends pl{constructor(i){super(i),this.current=Ty}set(i,a,h){if(this.fetchUniformLocation(i,a)){for(let m=0;m<4;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Qg(c){return[f_(255*c.r,255*c.g),f_(255*c.b,255*c.a)]}function Ol(c,i,a,h,m,x,_,A){return!!c&&(c.kind==="composite"||c.kind==="source"?c.evaluate(new rs(0,{brightness:x,worldview:A}),i,a,m,h,_)==="none":c.value==="none")}class Kg{constructor(i,a,h,m){this.value=i,this.uniformNames=a.map((x=>`u_${x}`)),this.type=h,this.context=m}setUniform(i,a,h,m,x){const _=m.constantOr(this.value);a.set(i,x,_ instanceof Wi?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,a){return this.type==="color"?new qo(i):new Ks(i)}}class np{constructor(i,a){this.uniformNames=a.map((h=>`u_${h}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,a){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(i,a,h,m,x){let _=null;x!=="u_pattern"&&x!=="u_dash"||(_=this.pattern),x==="u_pattern_b"&&(_=this.patternTransition),x==="u_pixel_ratio"&&(_=this.pixelRatio),_&&a.set(i,x,_)}getBinding(i,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new Wh(i):new Ks(i)}}class du{constructor(i,a,h,m){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new m}populatePaintArray(i,a,h,m,x,_,A,P){const N=this.paintVertexArray.length,V=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new rs(0,{brightness:_,worldview:P}),a,{},x,m,A):this.expression.kind==="constant"&&this.expression.value,H=Ol(this.lutExpression,a,{},m,x,_,A,P);this.paintVertexArray.resize(i),this._setPaintValue(N,i,V,H?null:this.context.lut)}updatePaintArray(i,a,h,m,x,_,A,P){const N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:A,worldview:P},h,m,void 0,x):this.expression.kind==="constant"&&this.expression.value,V=Ol(this.lutExpression,h,m,x,void 0,A,void 0,P);this._setPaintValue(i,a,N,V?null:this.context.lut)}_setPaintValue(i,a,h,m){if(this.type==="color"){const x=Qg(h.toPremultipliedRenderColor(m));for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,x[0],x[1])}else{for(let x=i;x<a;x++)this.paintVertexArray.emplace(x,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ic{constructor(i,a,h,m,x,_){this.expression=i,this.uniformNames=a.map((A=>`u_${A}_t`)),this.type=h,this.useIntegerZoom=m,this.context=x,this.maxValue=0,this.paintVertexAttributes=a.map((A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(i,a,h,m,x,_,A,P){const N=this.expression.evaluate(new rs(this.context.zoom,{brightness:_,worldview:P}),a,{},x,m,A),V=this.expression.evaluate(new rs(this.context.zoom+1,{brightness:_,worldview:P}),a,{},x,m,A),H=Ol(this.lutExpression,a,{},m,x,_,A,P),G=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(G,i,N,V,H?null:this.context.lut)}updatePaintArray(i,a,h,m,x,_,A,P){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:A,worldview:P},h,m,void 0,x),V=this.expression.evaluate({zoom:this.context.zoom+1,brightness:A,worldview:P},h,m,void 0,x),H=Ol(this.lutExpression,h,m,x,void 0,A,void 0,P);this._setPaintValue(i,a,N,V,H?null:this.context.lut)}_setPaintValue(i,a,h,m,x){if(this.type==="color"){const _=Qg(h.toPremultipliedRenderColor(x)),A=Qg(h.toPremultipliedRenderColor(x));for(let P=i;P<a;P++)this.paintVertexArray.emplace(P,_[0],_[1],A[0],A[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,h,m,x){const _=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,A=ve(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(i,x,A)}getBinding(i,a){return new Ks(i)}}class Xo{constructor(i,a,h,m,x){this.expression=i,this.layerId=x,this.paintVertexAttributes=(h==="array"?Sy:oi).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new m,this.paintTransitionVertexArray=new Uu}populatePaintArray(i,a,h,m){const x=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(x,i,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(i,a,h,m,x,_,A){this._setPaintValues(i,a,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(i,a,h,m){if(!m||!h)return;const x=m[h[0]],_=m[h[1]];if(x){if(x){const{tl:A,br:P,pixelRatio:N}=x;for(let V=i;V<a;V++)this.paintVertexArray.emplace(V,A[0],A[1],P[0],P[1],N)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:A,br:P}=_;for(let N=i;N<a;N++)this.paintTransitionVertexArray.emplace(N,A[0],A[1],P[0],P[1])}}}upload(i){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,ep.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Gu{constructor(i,a,h=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const m=[];for(const x in i.paint._values){const _=i.paint.get(x);if(x.endsWith("-use-theme")||!h(x)||!(_ instanceof xo&&Mg(_.property.specification)))continue;const A=sc(x,i.type),P=_.value,N=_.property.specification.type,V=!!_.property.useIntegerZoom,H=x==="line-dasharray"||x.endsWith("pattern"),G=i.paint.get(`${x}-use-theme`),Y=x==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||G&&G.value.kind!=="constant";if(P.kind!=="constant"||Y)if(P.kind==="source"||Y||H){const J=So(x,N,"source");this.binders[x]=H?new Xo(P,A,N,J,i.id):new du(P,A,N,J),m.push(`/a_${x}`)}else{const J=So(x,N,"composite");this.binders[x]=new ic(P,A,N,V,a,J),m.push(`/z_${x}`)}else this.binders[x]=H?new np(P.value,A):new Kg(P.value,A,N,a),m.push(`/u_${x}`);G&&(this.binders[x].lutExpression=G.value)}this.cacheKey=m.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof du||a instanceof ic?a.maxValue:0}populatePaintArrays(i,a,h,m,x,_,A,P){for(const N in this.binders){const V=this.binders[N];V.context=this.context,(V instanceof du||V instanceof ic||V instanceof Xo)&&V.populatePaintArray(i,a,h,m,x,_,A,P)}}setConstantPatternPositions(i,a){for(const h in this.binders){const m=this.binders[h];m instanceof np&&m.setConstantPatternPositions(i,a)}}getPatternTransitionVertexBuffer(i){const a=this.binders[i];return a instanceof Xo?a.paintTransitionVertexBuffer:null}updatePaintArrays(i,a,h,m,x,_,A,P,N,V){let H=!1;const G=Object.keys(i),Y=G.length!==0&&!P,J=Y?G:a.uniqueIds;this.context.lut=x.lut;for(const oe in this.binders){const ue=this.binders[oe];if(ue.context=this.context,(ue instanceof du||ue instanceof ic||ue instanceof Xo)&&ue.expression&&ue.expression.kind&&ue.expression.kind!=="constant"&&(ue.expression.isStateDependent===!0||ue.expression.isLightConstant===!1)){const pe=x.paint.get(oe);ue.expression=pe.value;for(const we of J){const Te=i[we.toString()];a.eachPosition(we,((Ie,Ze,Ve)=>{const Ye=m.feature(Ie);ue.updatePaintArray(Ze,Ve,Ye,Te,_,A,N,V)}))}if(!Y)for(const we of h.uniqueIds){const Te=i[we.toString()];h.eachPosition(we,((Ie,Ze,Ve)=>{const Ye=m.feature(Ie);ue.updatePaintArray(Ze,Ve,Ye,Te,_,A,N,V)}))}H=!0}}return H}defines(){const i=[];for(const a in this.binders){const h=this.binders[a];(h instanceof Kg||h instanceof np)&&i.push(...h.uniformNames.map((m=>`#define HAS_UNIFORM_${m}`)))}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Kg||m instanceof np||m instanceof ic)for(const x of m.uniformNames)a.push({name:x,property:h,binding:m.getBinding(i,x)})}return a}setUniforms(i,a,h,m,x){for(const{name:_,property:A,binding:P}of h)this.binders[A].setUniform(i,P,x,m.get(A),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof du||a instanceof ic||a instanceof Xo)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof Xo&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(i){for(const a in this.binders){const h=this.binders[a];(h instanceof du||h instanceof ic||h instanceof Xo)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof du||a instanceof ic||a instanceof Xo)&&a.destroy()}}}class ml{constructor(i,a,h=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new Gu(m,a,h);this.needsUpload=!1,this._featureMap=new tp,this._featureMapWithoutIds=new tp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,h,m,x,_,A,P,N){for(const V in this.programConfigurations)this.programConfigurations[V].populatePaintArrays(i,a,m,x,_,A,P,N);a.id!==void 0?this._featureMap.add(a.id,h,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,h,m,x,_,A,P){for(const N of h)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,N,m,x,_,A||0,P)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Ey={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function sc(c,i){return Ey[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const Ps={"line-pattern":{source:jl,composite:jl},"fill-pattern":{source:jl,composite:jl},"fill-extrusion-pattern":{source:jl,composite:jl},"line-dasharray":{source:Uu,composite:Uu}},ra={color:{source:Hu,composite:Vu},number:{source:kc,composite:Hu}};function So(c,i,a){const h=Ps[c];return h&&h[a]||ra[i][a]}Fn(Kg,"ConstantBinder"),Fn(np,"PatternConstantBinder"),Fn(du,"SourceExpressionBinder"),Fn(Xo,"PatternCompositeBinder"),Fn(ic,"CompositeExpressionBinder"),Fn(Gu,"ProgramConfiguration",{omit:["_buffers"]}),Fn(ml,"ProgramConfigurationSet");const Ls=xn/Math.PI/2,g=5,o=6,d=16383,y=64,S=[y,32,16],C=-Ls,I=Ls;function j(c,i,a,h=Ls){return a=Qr(a),[c*Math.sin(a)*h,-i*h,c*Math.cos(a)*h]}function z(c,i,a){return j(Math.cos(Qr(c)),Math.sin(Qr(c)),i,a)}const $=63710088e-1,q=2*Math.PI*$;class ee{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ee(tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,h=this.lat*a,m=i.lat*a,x=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((i.lng-this.lng)*a);return $*Math.acos(Math.min(x,1))}toBounds(i=0){const a=360*i/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new Q({lng:this.lng-h,lat:this.lat-a},{lng:this.lng+h,lat:this.lat+a})}toEcef(i){return z(this.lat,this.lng,Ls+i*Ls/$)}static convert(i){if(i instanceof ee)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new ee(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new ee(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Q{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):Array.isArray(i)&&i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof ee?new ee(i.lng,i.lat):ee.convert(i),this}setSouthWest(i){return this._sw=i instanceof ee?new ee(i.lng,i.lat):ee.convert(i),this}extend(i){const a=this._sw,h=this._ne;let m,x;if(i instanceof ee)m=i,x=i;else{if(!(i instanceof Q))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Q.convert(i)):this.extend(ee.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(ee.convert(i)):this;if(m=i._sw,x=i._ne,!m||!x)return this}return a||h?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new ee(m.lng,m.lat),this._ne=new ee(x.lng,x.lat)),this}getCenter(){return new ee((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ee(this.getWest(),this.getNorth())}getSouthEast(){return new ee(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:h}=ee.convert(i);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(i){if(i)return i instanceof Q?i:new Q(i)}}const ie=0,le=25.5;function de(c){return q*Math.cos(c*Math.PI/180)}function be(c){return(180+c)/360}function _e(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Se(c,i){return c/de(i)}function Pe(c){return 360*c-180}function Ee(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function We(c,i){return c*de(Ee(i))}const Ne=85.051129;function Xe(c){return Math.cos(Qr(ve(c,-Ne,Ne)))}function ze(c,i){const a=ve(i,ie,le),h=Math.pow(2,a);return Xe(c)*q/(512*h)}function De(c){return 1/Math.cos(c*Math.PI/180)}function Qe(c,i=0){const a=Math.exp(Math.PI*(1-(c.y+i/xn)/(1<<c.z)*2));return 80150034*a/(a*a+1)/xn/(1<<c.z)}class dt{constructor(i,a,h=0){this.x=+i,this.y=+a,this.z=+h}static fromLngLat(i,a=0){const h=ee.convert(i);return new dt(be(h.lng),_e(h.lat),Se(a,h.lat))}toLngLat(){return new ee(Pe(this.x),Ee(this.y))}toAltitude(){return We(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/q*De(Ee(this.y))}}function lt(c,i,a,h,m,x,_,A,P){const N=(i+h)/2,V=(a+m)/2,H=new Ht(N,V);A(H),(function(G,Y,J,oe,ue,pe){const we=J-ue,Te=oe-pe;return Math.abs((oe-Y)*we-(J-G)*Te)/Math.hypot(we,Te)})(H.x,H.y,x.x,x.y,_.x,_.y)>=P?(lt(c,i,a,N,V,x,H,A,P),lt(c,N,V,h,m,H,_,A,P)):c.push(_)}function Lt(c,i,a){let h=c[0],m=h.x,x=h.y;i(h);const _=[h];for(let A=1;A<c.length;A++){const P=c[A],{x:N,y:V}=P;i(P),lt(_,m,x,N,V,h,P,i,a),m=N,x=V,h=P}return _}function Tt(c,i,a,h){if(h(i,a)){const m=i.add(a)._mult(.5);Tt(c,i,m,h),Tt(c,m,a,h)}else c.push(a)}function Gt(c,i){let a=c[0];const h=[a];for(let m=1;m<c.length;m++){const x=c[m];Tt(h,a,x,i),a=x}return h}const hn=Math.pow(2,14)-1,mt=-hn-1;function rt(c,i){const a=Math.round(c.x*i),h=Math.round(c.y*i);return c.x=ve(a,mt,hn),c.y=ve(h,mt,hn),(a<c.x||a>c.x+1||h<c.y||h>c.y+1)&&It("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function zt(c,i,a){const h=c.loadGeometry(),m=c.extent,x=xn/m;if(i&&a&&a.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:A,x:P,y:N,projection:V}=a,H=G=>{const Y=Pe((i.x+G.x/m)/_),J=Ee((i.y+G.y/m)/_),oe=V.project(Y,J);G.x=(oe.x*A-P)*m,G.y=(oe.y*A-N)*m};for(let G=0;G<h.length;G++)if(c.type!==1)h[G]=Lt(h[G],H,1);else{const Y=[];for(const J of h[G])J.x<0||J.x>=m||J.y<0||J.y>=m||(H(J),Y.push(J));h[G]=Y}}for(const _ of h)for(const A of _)rt(A,x);return h}function Mt(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?zt(c):[]}}class Jt{constructor(i,a,h,m,x){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=m,this._values=x,i.readFields(_n,this,a)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos,h=[];let m,x=1,_=0,A=0,P=0;for(;i.pos<a;){if(_<=0){const N=i.readVarint();x=7&N,_=N>>3}if(_--,x===1||x===2)A+=i.readSVarint(),P+=i.readSVarint(),x===1&&(m&&h.push(m),m=[]),m&&m.push(new Ht(A,P));else{if(x!==7)throw new Error(`unknown command ${x}`);m&&m.push(m[0].clone())}}return m&&h.push(m),h}bbox(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos;let h=1,m=0,x=0,_=0,A=1/0,P=-1/0,N=1/0,V=-1/0;for(;i.pos<a;){if(m<=0){const H=i.readVarint();h=7&H,m=H>>3}if(m--,h===1||h===2)x+=i.readSVarint(),_+=i.readSVarint(),x<A&&(A=x),x>P&&(P=x),_<N&&(N=_),_>V&&(V=_);else if(h!==7)throw new Error(`unknown command ${h}`)}return[A,N,P,V]}toGeoJSON(i,a,h){const m=this.extent*Math.pow(2,h),x=this.extent*i,_=this.extent*a,A=this.loadGeometry();function P(G){return[360*(G.x+x)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(G.y+_)/m)*Math.PI))-90]}function N(G){return G.map(P)}let V;if(this.type===1){const G=[];for(const J of A)G.push(J[0]);const Y=N(G);V=G.length===1?{type:"Point",coordinates:Y[0]}:{type:"MultiPoint",coordinates:Y}}else if(this.type===2){const G=A.map(N);V=G.length===1?{type:"LineString",coordinates:G[0]}:{type:"MultiLineString",coordinates:G}}else{if(this.type!==3)throw new Error("unknown feature type");{const G=(function(J){const oe=J.length;if(oe<=1)return[J];const ue=[];let pe,we;for(let Te=0;Te<oe;Te++){const Ie=Vn(J[Te]);Ie!==0&&(we===void 0&&(we=Ie<0),we===Ie<0?(pe&&ue.push(pe),pe=[J[Te]]):pe&&pe.push(J[Te]))}return pe&&ue.push(pe),ue})(A),Y=[];for(const J of G)Y.push(J.map(N));V=Y.length===1?{type:"Polygon",coordinates:Y[0]}:{type:"MultiPolygon",coordinates:Y}}}const H={type:"Feature",geometry:V,properties:this.properties};return this.id!=null&&(H.id=this.id),H}}function _n(c,i,a){c===1?i.id=a.readVarint():c===2?(function(h,m){const x=h.readVarint()+h.pos;for(;h.pos<x;){const _=m._keys[h.readVarint()],A=m._values[h.readVarint()];m.properties[_]=A}})(a,i):c===3?i.type=a.readVarint():c===4&&(i._geometry=a.pos)}function Vn(c){let i=0;for(let a,h,m=0,x=c.length,_=x-1;m<x;_=m++)a=c[m],h=c[_],i+=(h.x-a.x)*(a.y+h.y);return i}Jt.types=["Unknown","Point","LineString","Polygon"];class fn{constructor(i,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(yn,this,a),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const a=this._pbf.readVarint()+this._pbf.pos;return new Jt(this._pbf,a,this.extent,this._keys,this._values)}}function yn(c,i,a){c===15?i.version=a.readVarint():c===1?i.name=a.readString():c===5?i.extent=a.readVarint():c===2?i._features.push(a.pos):c===3?i._keys.push(a.readString()):c===4&&i._values.push((function(h){let m=null;const x=h.readVarint()+h.pos;for(;h.pos<x;){const _=h.readVarint()>>3;m=_===1?h.readString():_===2?h.readFloat():_===3?h.readDouble():_===4?h.readVarint64():_===5?h.readVarint():_===6?h.readSVarint():_===7?h.readBoolean():null}if(m==null)throw new Error("unknown feature value");return m})(a))}class $n{constructor(i,a){this.layers=i.readFields(On,{},a)}}function On(c,i,a){if(c===3){const h=new fn(a,a.readVarint()+a.pos);h.length&&(i[h.name]=h)}}const Cn="3d_elevation_id",Bn="level";class _r{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,a){return this._valid&&i(a(this._geometry)),this}require(i,a,h){return this.get(i,!0,a,h)}optional(i,a,h){return this.get(i,!1,a,h)}success(){return this._valid}get(i,a,h,m){const x=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?h(m?m(x):x):a&&(this._valid=!1),this}}class mi{constructor(i,a){this.featureFunc=i,this.vertexFunc=a}parseFeature(i,a,h){return this.featureFunc(i,a,h)}parseVertex(i,a,h){return this.vertexFunc(i,a,h)}}const zr=new mi(((c,i,a)=>c.reset(i).require(Cn,(h=>{a.id=h})).optional("fixed_height_relative",(h=>{a.constantHeight=h}),Ir.decodeRelativeHeight).geometry((h=>{a.bounds=h}),Ru).success()),((c,i,a)=>c.reset(i).require(Cn,(h=>{a.id=h})).require("elevation_idx",(h=>{a.idx=h})).require("extent",(h=>{a.extent=h})).require("height_relative",(h=>{a.height=h}),Ir.decodeRelativeHeight).geometry((h=>{a.position=h}),Ir.getPoint).success())),ts=new mi(((c,i,a)=>c.reset(i).require(Cn,(h=>{a.id=h})).optional("fixed_height",(h=>{a.constantHeight=h}),Ir.decodeMetricHeight).geometry((h=>{a.bounds=h}),Ru).success()),((c,i,a)=>c.reset(i).require(Cn,(h=>{a.id=h})).require("elevation_idx",(h=>{a.idx=h})).require("extent",(h=>{a.extent=h})).require("height",(h=>{a.height=h}),Ir.decodeMetricHeight).geometry((h=>{a.position=h}),Ir.getPoint).success()));class Ir{static getPoint(i){return Zr(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static getVersionSchema(i){return i?i==="1.0.1"?ts:void 0:zr}static parse(i){const a=[],h=[],m=i.length,x=new _r;for(let _=0;_<m;_++){const A=i.feature(_),P=A.properties.version,N=Ir.getVersionSchema(P);if(N===void 0){It(`Unknown elevation feature version number ${P||"(unknown)"}`);continue}const V=A.properties.type;if(!V)continue;const H=Jt.types[A.type];if(H==="Point"&&V==="curve_point"){const G={};N.parseVertex(x,A,G)&&a.push(G)}else if(H==="Polygon"&&V==="curve_meta"){const G={};N.parseFeature(x,A,G)&&h.push(G)}}return{vertices:a,features:h}}}class bi{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,h){const m=gr(a,this.dir);if(Math.abs(m)<1e-6)return!1;const x=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1])/m;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,!0}}class Kr{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,h){const m=on(a,this.dir);if(Math.abs(m)<1e-6)return!1;const x=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/m;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(i,a,h){if((function(Y,J){var oe=Y[0],ue=Y[1],pe=Y[2],we=J[0],Te=J[1],Ie=J[2];return Math.abs(oe-we)<=v*Math.max(1,Math.abs(oe),Math.abs(we))&&Math.abs(ue-Te)<=v*Math.max(1,Math.abs(ue),Math.abs(Te))&&Math.abs(pe-Ie)<=v*Math.max(1,Math.abs(pe),Math.abs(Ie))})(this.pos,i)||a===0)return h[0]=h[1]=h[2]=0,!1;const[m,x,_]=this.dir,A=this.pos[0]-i[0],P=this.pos[1]-i[1],N=this.pos[2]-i[2],V=m*m+x*x+_*_,H=2*(A*m+P*x+N*_),G=H*H-4*V*(A*A+P*P+N*N-a*a);if(G<0){const Y=Math.max(-H/2,0),J=A+m*Y,oe=P+x*Y,ue=N+_*Y,pe=Math.hypot(J,oe,ue);return h[0]=J*a/pe,h[1]=oe*a/pe,h[2]=ue*a/pe,!1}{const Y=(-H-Math.sqrt(G))/(2*V);if(Y<0){const J=Math.hypot(A,P,N);return h[0]=A*a/J,h[1]=P*a/J,h[2]=N*a/J,!1}return h[0]=A+m*Y,h[1]=P+x*Y,h[2]=N+_*Y,!0}}}class Xi{constructor(i,a,h,m,x){this.TL=i,this.TR=a,this.BR=h,this.BL=m,this.horizon=x}static fromInvProjectionMatrix(i,a,h){const m=[-1,1,1],x=[1,1,1],_=[1,-1,1],A=[-1,-1,1],P=Un(m,m,i),N=Un(x,x,i),V=Un(_,_,i),H=Un(A,A,i);return new Xi(P,N,V,H,a/h)}}function wi(c,i,a){let h=1/0,m=-1/0;const x=[];for(const _ of c){wn(x,_,i);const A=on(x,a);h=Math.min(h,A),m=Math.max(m,A)}return[h,m]}function ss(c,i){let a=!0;for(let h=0;h<c.planes.length;h++){const m=c.planes[h];let x=0;for(let _=0;_<i.length;_++)x+=+(on(m,i[_])+m[3]>=0);if(x===0)return 0;x!==i.length&&(a=!1)}return a?2:1}function gi(c,i){for(const a of c.projections){const h=wi(i,c.points[0],a.axis);if(a.projection[1]<h[0]||a.projection[0]>h[1])return 0}return 1}function Xr(c,i){let a=0;const h=[0,0,0,0];for(let _=0;_<c.length;_++)h[0]=c[_][0],h[1]=c[_][1],h[2]=c[_][2],h[3]=1,(m=h)[0]*(x=i)[0]+m[1]*x[1]+m[2]*x[2]+m[3]*x[3]>=0&&a++;var m,x;return a}class Oi{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Gr.fromPoints(this.points),this.projections=[],this.frustumEdges=[wn([],this.points[2],this.points[3]),wn([],this.points[0],this.points[3]),wn([],this.points[4],this.points[0]),wn([],this.points[5],this.points[1]),wn([],this.points[6],this.points[2]),wn([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const m=[0,-h[2],h[1]],x=[h[2],0,-h[0]];this.projections.push({axis:m,projection:wi(this.points,this.points[0],m)}),this.projections.push({axis:x,projection:wi(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(i,a,h,m){const x=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((N=>{const V=Oe([],N,i),H=1/V[3]/a*x;return(G=V)[0]=(Y=V)[0]*(J=[H,H,m?1/V[3]:H,H])[0],G[1]=Y[1]*J[1],G[2]=Y[2]*J[2],G[3]=Y[3]*J[3],G;var G,Y,J})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((N=>{const V=kt([],mn([],wn([],_[N[0]],_[N[1]]),wn([],_[N[2]],_[N[1]]))),H=-on(V,_[N[1]]);return V.concat(H)})),P=[];for(let N=0;N<_.length;N++)P.push([_[N][0],_[N][1],_[N][2]]);return new Oi(P,A)}intersectsPrecise(i,a,h){for(let m=0;m<a.length;m++)if(!Xr(i,a[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!Xr(i,this.planes[m]))return 0;for(const m of h)for(const x of this.frustumEdges){const _=mn([],m,x),A=ke(_);if(A===0)continue;bt(_,_,1/A);const P=wi(this.points,this.points[0],_),N=wi(i,this.points[0],_);if(P[0]>N[1]||N[0]>P[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const h=a[3];if(on([a[0],a[1],a[2]],i)+h<0)return!1}return!0}}class Gr{static fromPoints(i){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const m of i)Le(a,a,m),st(h,h,m);return new Gr(a,h)}static fromTileIdAndHeight(i,a,h){const m=1<<i.canonical.z,x=i.canonical.x,_=i.canonical.y;return new Gr([x/m,_/m,a],[(x+1)/m,(_+1)/m,h])}static applyTransform(i,a){const h=i.getCorners();for(let m=0;m<h.length;++m)Un(h[m],h[m],a);return Gr.fromPoints(h)}static applyTransformFast(i,a){const h=[a[12],a[13],a[14]],m=[...h];for(let x=0;x<3;x++)for(let _=0;_<3;_++){const A=a[4*_+x],P=A*i.min[_],N=A*i.max[_];h[x]+=Math.min(P,N),m[x]+=Math.max(P,N)}return new Gr(h,m)}static projectAabbCorners(i,a){const h=i.getCorners();for(let m=0;m<h.length;++m)Un(h[m],h[m],a);return h}constructor(i,a){this.min=i,this.max=a,this.center=bt([],Ae([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],h=Ke(this.min),m=Ke(this.max);for(let x=0;x<a.length;x++)h[x]=a[x]?this.min[x]:this.center[x],m[x]=a[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new Gr(h,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?ss(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?ss(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?gi(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?gi(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Fn(Gr,"Aabb");class os{constructor(i,a){this.feature=i,this.metersToTile=a,this.index=0}get(){const i=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,h=a[1],m=-a[0],x=(i.extent+1)*this.metersToTile;return[new Ht(Math.trunc(i.position[0]+h*x),Math.trunc(i.position[1]+m*x)),new Ht(Math.trunc(i.position[0]-h*x),Math.trunc(i.position[1]-m*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ei{constructor(i,a,h,m,x,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[In(),In(),In(),In(),In(),In(),In()],this.id=i,this.heightRange={min:h,max:h},this.safeArea=a,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=x,this.edges=this.edges.filter((A=>{return A.a<this.vertices.length&&A.b<this.vertices.length&&!((P=this.vertices[A.a].position)[0]===(N=this.vertices[A.b].position)[0]&&P[1]===N[1]);var P,N})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const A of this.vertices)this.vertexProps.push({dir:Zr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,A.height),this.heightRange.max=Math.max(this.heightRange.max,A.height);for(const A of this.edges){const P=this.vertices[A.a].position,N=this.vertices[A.b].position,V=Kn(In(),N,P),H=Gn(V),G=St(In(),V,1/H);this.edgeProps.push({vec:V,dir:G,len:H});const Y=this.vertexProps[A.a].dir,J=this.vertexProps[A.b].dir;qn(Y,Y,G),qn(J,J,G)}for(const A of this.vertexProps)A.dir[0]===0&&A.dir[1]===0||er(A.dir,A.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(i);if(a==null)return 0;const[h,m]=a;return Ar(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,m)}computeSlopeNormal(i,a){const h=this.getClosestEdge(i);if(!h)return je(0,0,1);const m=h[0],x=this.edges[m],_=this.edgeProps[m].vec,A=je(_[0],_[1],(this.vertices[x.b].height-this.vertices[x.a].height)*a),P=je(A[1],-A[0],0);mn(P,P,A);const N=ke(P);return N>0?bt(P,P,1/N):$e(P,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let a=0,h=Number.POSITIVE_INFINITY,m=0;const[x,_,A,P,N,V,H]=this._tmpVec2;Vr(H,i.x,i.y);const G=new bi(H,null);for(let Y=0;Y<this.edges.length;Y++){const J=this.edges[Y],oe=this.edgeProps[Y].dir;G.dir=oe;const ue=this.vertices[J.a].position,pe=this.vertices[J.b].position,we=G.intersectsPlane(ue,this.vertexProps[J.a].dir,x),Te=G.intersectsPlane(pe,this.vertexProps[J.b].dir,_);if(!we||!Te)continue;Kn(A,_,x),Kn(P,H,x);const Ie=gr(A,A),Ze=Ie>0?gr(P,A)/Ie:0,Ve=ve(Ze,0,1),Ye=Math.abs((Ze-Ve)*this.edgeProps[Y].len);Kn(N,H,ue),Vr(V,oe[1],-oe[0]);const nt=Ye+Math.abs(gr(N,V));nt<h&&(a=Y,h=nt,m=Ve)}return[a,m]}tessellate(i){const a=Me(),h=Me(),m=Me(),x=Me();for(let _=this.edges.length-1;_>=0;--_){const A=this.edges[_].a,P=this.edges[_].b,{position:N,height:V,extent:H}=this.vertices[A],{position:G,height:Y,extent:J}=this.vertices[P],oe=this.vertexProps[A].dir,ue=this.vertexProps[P].dir;if($e(a,N[0]/i,N[1]/i,V),$e(h,G[0]/i,G[1]/i,Y),$e(m,oe[1],-oe[0],0),bt(m,m,H),$e(x,ue[1],-ue[0],0),bt(x,x,J),this.distSqLines(je(a[0]+.5*m[0],a[1]+.5*m[1],a[2]+.5*m[2]),je(h[0]-.5*x[0],h[1]-.5*x[1],h[2]-.5*x[2]),je(a[0]-.5*m[0],a[1]-.5*m[1],a[2]-.5*m[2]),je(h[0]+.5*x[0],h[1]+.5*x[1],h[2]+.5*x[2]))<=.0025000000000000005)continue;const pe=this.vertices.length,we=qn(In(),N,G);this.vertices.push({position:St(we,we,.5),height:.5*(V+Y),extent:.5*(H+J)});const Te=qn(In(),oe,ue);this.vertexProps.push({dir:er(Te,Te)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:A,b:pe}),this.edges.push({a:pe,b:P});const Ie=Kn(In(),this.vertices[pe].position,N),Ze=Gn(Ie),Ve={vec:Ie,dir:St(In(),Ie,1/Ze),len:Ze};this.edgeProps.push(Ve),this.edgeProps.push(Ve)}}distSqLines(i,a,h,m){const x=He(Me(),a,i),_=He(Me(),m,h),A=He(Me(),i,h),P=on(x,x),N=on(x,_),V=on(x,A),H=on(_,_),G=on(_,A),Y=P*H-N*N;if(Y===0)return _t(Hr(x,h,m,on(A,_)/on(_,_)),i);const J=(P*G-N*V)/Y;return _t(Hr(x,i,a,(N*G-V*H)/Y),Hr(_,h,m,J))}}class Pr{static parseFrom(i,a){const h=Ir.parse(i);if(!h)return[];let{vertices:m,features:x}=h;const _=1/Qe(a);x.sort(((V,H)=>V.id-H.id)),m.sort(((V,H)=>V.id-H.id||V.idx-H.idx)),m=m.filter(((V,H,G)=>H===G.findIndex((Y=>Y.id===V.id&&Y.idx===V.idx))));const A=new Array;let P=0;const N=m.length;for(const V of x){if(V.constantHeight){A.push(new Ei(V.id,V.bounds,V.constantHeight));continue}for(;P!==N&&m[P].id<V.id;)P++;if(P===N||m[P].id!==V.id)continue;const H=new Array,G=new Array,Y=P;for(;P!==N&&m[P].id===V.id;){const J=m[P];if(H.push({position:J.position,height:J.height,extent:J.extent}),P!==Y&&m[P-1].idx===J.idx-1){const oe=P-Y;G.push({a:oe-1,b:oe})}P++}A.push(new Ei(V.id,V.bounds,void 0,H,G,_))}return A}static getElevationFeature(i,a){if(!a)return;const h=+i.properties[Cn];return Number.isNaN(h)?void 0:a.find((m=>m.id===h))}}class Si{constructor(i,a){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(a)||(this.zScale=Math.pow(2,a.z-i.z),this.xOffset=(i.x*this.zScale-a.x)*xn,this.yOffset=(i.y*this.zScale-a.y)*xn)}constantElevation(i,a){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,a)}pointElevation(i,a,h){const m=this.constantElevation(a,h);return m??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(i),h))}computeBiasedHeight(i,a){return a<=0?i:i+a*Fe(0,a,i>=0?i:Math.abs(.5*i))}}Fn(Ei,"ElevationFeature");class xs{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new $a,this.indexArray=new ys,this.segments=new Li,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new kc),this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,h,m){}populate(i,a,h,m){const x=this.layers[0],_=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:N,id:V,index:H,sourceLayerIndex:G}of i){const Y=this.layers[0]._featureFilter.needGeometry,J=Mt(N,Y);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),J,h))continue;const oe=A?A.evaluate(J,{},h):void 0,ue={id:V,properties:N.properties,type:N.type,sourceLayerIndex:G,index:H,geometry:Y?J.geometry:zt(N,h,m),patterns:{},sortKey:oe};_.push(ue)}A&&_.sort(((N,V)=>N.sortKey-V.sortKey));let P=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new $f,P=m.projection);for(const N of _){const{geometry:V,index:H,sourceLayerIndex:G}=N,Y=i[H].feature;this.addFeature(N,V,H,a.availableImages,h,P,a.brightness,a.elevationFeatures),a.featureIndex.insert(Y,V,H,G,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,a,h,m,x,_,A){this.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,h_.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Zg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Nb.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,a,h,m,x,_,A,P){let N;this.elevationMode!=="none"&&(N=Pr.getElevationFeature(i,P));for(const V of a)for(const H of V){const G=H.x,Y=H.y;if(G<0||G>=xn||Y<0||Y>=xn)continue;if(_){const ue=_.projectTilePoint(G,Y,x),pe=_.upVector(x,G,Y);this.addGlobeExtVertex(ue,pe),this.addGlobeExtVertex(ue,pe),this.addGlobeExtVertex(ue,pe),this.addGlobeExtVertex(ue,pe)}const J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),oe=J.vertexLength;if(this.addCircleVertex(G,Y,-1,-1),this.addCircleVertex(G,Y,1,-1),this.addCircleVertex(G,Y,1,1),this.addCircleVertex(G,Y,-1,1),this.elevationMode!=="none"){const ue=N?N.pointElevation(new Ht(G,Y)):0;this.hasElevation=this.hasElevation||ue!==0;for(let pe=0;pe<4;pe++)this.elevatedLayoutVertexArray.emplaceBack(ue)}this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+2,oe+3),J.vertexLength+=4,J.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},m,x,A,void 0,this.worldview)}addCircleVertex(i,a,h,m){this.layoutVertexArray.emplaceBack(2*i+(h+1)/2,2*a+(m+1)/2)}addGlobeExtVertex(i,a){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function qs(c,i){for(let a=0;a<c.length;a++)if(_o(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(_o(c,i[a]))return!0;return!!ga(c,i)}function ws(c,i,a){return!!_o(c,i)||!!Do(i,c,a)}function Os(c,i){if(c.length===1)return Bl(i,c[0]);for(let a=0;a<i.length;a++){const h=i[a];for(let m=0;m<h.length;m++)if(_o(c,h[m]))return!0}for(let a=0;a<c.length;a++)if(Bl(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(ga(c,i[a]))return!0;return!1}function Aa(c,i,a){if(c.length>1){if(ga(c,i))return!0;for(let h=0;h<i.length;h++)if(Do(i[h],c,a))return!0}for(let h=0;h<c.length;h++)if(Do(c[h],i,a))return!0;return!1}function ga(c,i){if(c.length===0||i.length===0)return!1;for(let a=0;a<c.length-1;a++){const h=c[a],m=c[a+1];for(let x=0;x<i.length-1;x++)if(To(h,m,i[x],i[x+1]))return!0}return!1}function To(c,i,a,h){return Et(c,a,h)!==Et(i,a,h)&&Et(c,i,a)!==Et(c,i,h)}function jo(c,i,a){return(c.x-a.x)*(i.y-a.y)-(c.y-a.y)*(i.x-a.x)}function gl(c,i,a,h){const m=jo(c,i,h),x=jo(c,i,a);if(Math.sign(m)===Math.sign(x))return;const _=jo(a,h,c),A=_+x-m;return Math.sign(_)!==Math.sign(A)?[_/(_-A),x/(x-m)]:void 0}function Do(c,i,a){const h=a*a;if(i.length===1)return c.distSqr(i[0])<h;for(let m=1;m<i.length;m++)if(Fl(c,i[m-1],i[m])<h)return!0;return!1}function Fl(c,i,a){const h=i.distSqr(a);if(h===0)return c.distSqr(i);const m=((c.x-i.x)*(a.x-i.x)+(c.y-i.y)*(a.y-i.y))/h;return c.distSqr(m<0?i:m>1?a:a.sub(i)._mult(m)._add(i))}function Bl(c,i){let a,h,m,x=!1;for(let _=0;_<c.length;_++){a=c[_];for(let A=0,P=a.length-1;A<a.length;P=A++)h=a[A],m=a[P],h.y>i.y!=m.y>i.y&&i.x<(m.x-h.x)*(i.y-h.y)/(m.y-h.y)+h.x&&(x=!x)}return x}function _o(c,i){let a=!1;for(let h=0,m=c.length-1;h<c.length;m=h++){const x=c[h],_=c[m];x.y>i.y!=_.y>i.y&&i.x<(_.x-x.x)*(i.y-x.y)/(_.y-x.y)+x.x&&(a=!a)}return a}function Ss(c,i,a,h,m){for(const _ of c)if(i<=_.x&&a<=_.y&&h>=_.x&&m>=_.y)return!0;const x=[new Ht(i,a),new Ht(i,m),new Ht(h,m),new Ht(h,a)];if(c.length>2){for(const _ of x)if(_o(c,_))return!0}for(let _=0;_<c.length-1;_++)if(Fs(c[_],c[_+1],x))return!0;return!1}function Fs(c,i,a){const h=a[0],m=a[2];if(c.x<h.x&&i.x<h.x||c.x>m.x&&i.x>m.x||c.y<h.y&&i.y<h.y||c.y>m.y&&i.y>m.y)return!1;const x=Et(c,i,a[0]);return x!==Et(c,i,a[1])||x!==Et(c,i,a[2])||x!==Et(c,i,a[3])}function Ji(c,i,a,h,m,x){let _=i.y-c.y,A=c.x-i.x;if(x=x||0){const P=_*_+A*A;if(P===0)return!0;const N=Math.sqrt(P);_/=N,A/=N}return!((a.x-c.x)*_+(a.y-c.y)*A-x<0||(h.x-c.x)*_+(h.y-c.y)*A-x<0||(m.x-c.x)*_+(m.y-c.y)*A-x<0)}function Xs(c,i,a,h,m,x,_){return!(Ji(c,i,h,m,x,_)||Ji(i,a,h,m,x,_)||Ji(a,c,h,m,x,_)||Ji(h,m,c,i,a,_)||Ji(m,x,c,i,a,_)||Ji(x,h,c,i,a,_))}function Lo(c,i,a){const h=i.paint.get(c).value;return h.kind==="constant"?h.value:a.programConfigurations.get(i.id).getMaxValue(c)}function Ts(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function zl(c,i,a,h,m){if(!i[0]&&!i[1])return c;const x=Ht.convert(i)._mult(m);a==="viewport"&&x._rotate(-h);const _=[];for(let A=0;A<c.length;A++)_.push(c[A].sub(x));return _}function hu(c,i,a,h){const m=Ht.convert(c)._mult(h);return i==="viewport"&&m._rotate(-a),m}let $u,Wu;function b(c,i,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[c*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}Fn(xs,"CircleBucket",{omit:["layers"]});class M{constructor(i,a,h){this.z=i,this.x=a,this.y=h,this.key=se(0,i,i,a,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const a=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>a&&i.y===this.y>>a}url(i,a){const h=(function(x,_,A){var P=b(256*x,256*(_=Math.pow(2,A)-_-1),A),N=b(256*(x+1),256*(_+1),A);return P[0]+","+P[1]+","+N[0]+","+N[1]})(this.x,this.y,this.z),m=(function(x,_,A){let P,N="";for(let V=x;V>0;V--)P=1<<V-1,N+=(_&P?1:0)+(A&P?2:0);return N})(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class B{constructor(i,a){this.wrap=i,this.canonical=a,this.key=se(i,a.z,a.z,a.x,a.y)}}class Z{constructor(i,a,h,m,x){this.overscaledZ=i,this.wrap=a,this.canonical=new M(h,+m,+x),this.key=a===0&&i===h?this.canonical.key:se(a,i,h,m,x)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new Z(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Z(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return se(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return se(this.wrap*+a,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Z(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new Z(a,this.wrap,a,h,m),new Z(a,this.wrap,a,h+1,m),new Z(a,this.wrap,a,h,m+1),new Z(a,this.wrap,a,h+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Z(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Z(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new B(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function se(c,i,a,h,m){const x=1<<Math.min(a,22);let _=x*(m%x)+h%x;return c&&a<22&&(_+=x*x*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*_+a)+(i-a)}const ge=[c=>{let i=c.canonical.x-1,a=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,a--),new Z(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,a=c.wrap;return i===1<<c.canonical.z&&(i=0,a++),new Z(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>new Z(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Z(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Fn(M,"CanonicalTileID"),Fn(Z,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ue=di([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xt}=Ue,Ft=di([{name:"a_pos_3",components:3,type:"Int16"}]);var Tn=di([{name:"a_pos",type:"Int16",components:2}]);function or(c){return c*Ls/$}const yr=[new Gr([C,C,C],[I,I,I]),new Gr([C,C,C],[0,0,I]),new Gr([0,C,C],[I,0,I]),new Gr([C,0,C],[0,I,I]),new Gr([0,0,C],[I,I,I])];function ar(c,i,a,h=!0){const m=bt([],c._camera.position,c.worldSize),x=[i,a,1,1];Oe(x,x,c.pixelMatrixInverse),Nt(x,x,1/x[3]);const _=kt([],wn([],x,m)),A=c.globeMatrix,P=[A[12],A[13],A[14]],N=wn([],P,m),V=ke(N),H=kt([],N),G=c.worldSize/(2*Math.PI),Y=on(H,_),J=Math.asin(G/V);if(J<Math.acos(Y)){if(!h)return null;const Ot=[],pt=[];bt(Ot,_,V/Y),kt(pt,wn(pt,Ot,N)),kt(_,Ae(_,N,bt(_,pt,Math.tan(J)*V)))}const oe=[];new Kr(m,_).closestPointOnSphere(P,G,oe);const ue=kt([],Er(A,0)),pe=kt([],Er(A,1)),we=kt([],Er(A,2)),Te=on(ue,oe),Ie=on(pe,oe),Ze=on(we,oe),Ve=Rs(Math.asin(-Ie/G));let Ye=Rs(Math.atan2(Te,Ze));Ye=c.center.lng+(function(Ot,pt){const Ut=(pt-Ot+180)%360-180;return Ut<-180?Ut+360:Ut})(c.center.lng,Ye);const nt=be(Ye),ot=ve(_e(Ve),0,1);return new dt(nt,ot)}class ri{constructor(i,a,h){this.a=wn([],i,h),this.b=wn([],a,h),this.center=h;const m=kt([],this.a),x=kt([],this.b);this.angle=Math.acos(on(m,x))}}function ci(c,i){if(c.angle===0)return null;let a;return a=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:(function(h,m,x,_){const A=Math.sin(x);return h*(Math.sin((1-_)*x)/A)+m*(Math.sin(_*x)/A)})(c.a[i],c.b[i],c.angle,ve(a,0,1))+c.center[i]}function Yr(c){if(c.z<=1)return yr[c.z+2*c.y+c.x];const i=Sr(pn(c));return Gr.fromPoints(i)}function no(c,i,a){return bt(c,c,1-a),yt(c,c,i,a)}function cn(c,i,a){for(const h of c)Un(h,h,i),bt(h,h,a)}function Xt(c,i,a,h){const m=i/c.worldSize,x=c.globeMatrix;if(a.z<=1){const ot=Yr(a).getCorners();return cn(ot,x,m),Gr.fromPoints(ot)}const _=pn(a,h),A=Sr(_,Ls+or(c._tileCoverLift));cn(A,x,m);const P=Number.MAX_VALUE,N=[-P,-P,-P],V=[P,P,P];if(_.contains(c.center)){for(const pt of A)Le(V,V,pt),st(N,N,pt);N[2]=0;const ot=c.point,Ot=[ot.x*m,ot.y*m,0];return Le(V,V,Ot),st(N,N,Ot),new Gr(V,N)}if(c._tileCoverLift>0){for(const ot of A)Le(V,V,ot),st(N,N,ot);return new Gr(V,N)}const H=[x[12]*m,x[13]*m,x[14]*m],G=_.getCenter(),Y=ve(c.center.lat,-Ne,Ne),J=ve(G.lat,-Ne,Ne),oe=be(c.center.lng),ue=_e(Y);let pe=oe-be(G.lng);const we=ue-_e(J);pe>.5?pe-=1:pe<-.5&&(pe+=1);let Te=0;Math.abs(pe)>Math.abs(we)?Te=pe>=0?1:3:(Te=we>=0?0:2,yt(H,H,[x[4]*m,x[5]*m,x[6]*m],-Math.sin(Qr(we>=0?_.getSouth():_.getNorth()))*Ls));const Ie=A[Te],Ze=A[(Te+1)%4],Ve=new ri(Ie,Ze,H),Ye=[ci(Ve,0)||Ie[0],ci(Ve,1)||Ie[1],ci(Ve,2)||Ie[2]],nt=Yg(c.zoom);if(nt>0){const ot=(function({x:pt,y:Ut,z:Zt},en,vn,an,Qt){const sn=1/(1<<Zt);let jt=pt*sn,Rt=jt+sn,nn=Ut*sn,gn=nn+sn,Yt=0;const zn=(jt+Rt)/2-an;return zn>.5?Yt=-1:zn<-.5&&(Yt=1),jt=((jt+Yt)*en-(an*=en))*vn+an,Rt=((Rt+Yt)*en-an)*vn+an,nn=(nn*en-(Qt*=en))*vn+Qt,gn=(gn*en-Qt)*vn+Qt,[[jt,gn,0],[Rt,gn,0],[Rt,nn,0],[jt,nn,0]]})(a,i,c._pixelsPerMercatorPixel,oe,ue);for(let pt=0;pt<A.length;pt++)no(A[pt],ot[pt],nt);const Ot=Ae([],ot[Te],ot[(Te+1)%4]);bt(Ot,Ot,.5),no(Ye,Ot,nt)}for(const ot of A)Le(V,V,ot),st(N,N,ot);return V[2]=Math.min(Ie[2],Ze[2]),Le(V,V,Ye),st(N,N,Ye),new Gr(V,N)}function pn({x:c,y:i,z:a},h=!1){const m=1/(1<<a),x=new ee(Pe(c*m),i===(1<<a)-1&&h?-90:Ee((i+1)*m)),_=new ee(Pe((c+1)*m),i===0&&h?90:Ee(i*m));return new Q(x,_)}function Sr(c,i=Ls){const a=Qr(c.getNorth()),h=Qr(c.getSouth()),m=Math.cos(a),x=Math.cos(h),_=Math.sin(a),A=Math.sin(h),P=c.getWest(),N=c.getEast();return[j(x,A,P,i),j(x,A,N,i),j(m,_,N,i),j(m,_,P,i)]}function hi(c,i,a,h){const m=1<<a.z,x=(c/xn+a.x)/m;return z(Ee((i/xn+a.y)/m),Pe(x),h)}function Ai({min:c,max:i}){return d/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const Mi=new Float64Array(16);function Fi(c){const i=Ai(c),a=xe(Mi,[i,i,i]);return W(a,a,qt([],c.min))}function ia(c){const i=(h=c.min,(a=Mi)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[0],a[13]=h[1],a[14]=h[2],a[15]=1,a);var a,h;const m=1/Ai(c);return K(i,i,[m,m,m])}function js(c){const i=xn/(2*Math.PI);return c/(2*Math.PI)/i}function qh(c,i){return xn/(512*Math.pow(2,c))*Ai(Yr(i))}function j2(c,i,a,h,m){const x=js(a),_=[c,i,-a/(2*Math.PI)],A=F(new Float64Array(16));return W(A,A,_),K(A,A,[x,x,x]),ne(A,A,Qr(-m)),te(A,A,Qr(-h)),A}function Yg(c){return Fe(g,o,c)}function qN(c,i){const a=z(i.lat,i.lng),h=(function(J){const oe=z(J._center.lat,J._center.lng);let ue=mn([],je(0,1,0),oe);const pe=ae([],-J.angle,oe);ue=Un(ue,ue,pe),ae(pe,-J._pitch,ue);const we=kt([],oe);return bt(we,we,or(J.cameraToCenterDistance/J.pixelsPerMeter)),Un(we,we,pe),Ae([],oe,we)})(c);return _=(m=He([],h,a))[0],A=m[1],P=m[2],N=(x=a)[0],V=x[1],H=x[2],Y=(G=Math.sqrt((_*_+A*A+P*P)*(N*N+V*V+H*H)))&&on(m,x)/G,Math.acos(Math.min(Math.max(Y,-1),1));var m,x,_,A,P,N,V,H,G,Y}function r3(c,i){return qN(c,i)>Math.PI/2*1.01}const XN=Qr(85),Lq=Math.cos(XN),Oq=Math.sin(XN),Fq=D(),ZN=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function QN(c,i,a,h,m,x,_,A,P){if(x&&c.queryGeometry.isAboveHorizon)return!1;x&&(P*=c.pixelToTileUnitsFactor);const N=c.tileID.canonical,V=a.projection.upVectorScale(N,a.center.lat,a.worldSize).metersToTile;for(const H of i)for(const G of H){const Y=G.add(A),J=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(Y.x,Y.y,!0):0,oe=a.projection.projectTilePoint(Y.x,Y.y,N);if(J>0){const Te=a.projection.upVector(N,Y.x,Y.y);oe.x+=Te[0]*V*J,oe.y+=Te[1]*V*J,oe.z+=Te[2]*V*J}const ue=x?Y:Bq(oe.x,oe.y,oe.z,h),pe=x?c.tilespaceRays.map((Te=>Uq(Te,J))):c.queryGeometry.screenGeometry,we=Oe([],[oe.x,oe.y,oe.z,1],h);if(!_&&x?P*=we[3]/a.cameraToCenterDistance:_&&!x&&(P*=a.cameraToCenterDistance/we[3]),x){const Te=Ee((G.y/xn+N.y)/(1<<N.z));P/=a.projection.pixelsPerMeter(Te,1)/Se(1,Te)}if(ws(pe,ue,P))return!0}return!1}function Bq(c,i,a,h){const m=Oe([],[c,i,a,1],h);return new Ht(m[0]/m[3],m[1]/m[3])}const KN=je(0,0,0),zq=je(0,0,1);function Uq(c,i){const a=Me();return KN[2]=i,c.intersectsPlane(KN,zq,a),new Ht(a[0],a[1])}class YN extends xs{}let JN,e4,t4,n4;function r4(c,{width:i,height:a},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*a*h)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*a*h);return c.width=i,c.height=a,c.data=m,c}function i4(c,i,a){const{width:h,height:m}=i;h===c.width&&m===c.height||(i3(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,h),height:Math.min(c.height,m)},a,null),c.width=h,c.height=m,c.data=i.data)}function i3(c,i,a,h,m,x,_,A){if(m.width===0||m.height===0)return i;if(m.width>c.width||m.height>c.height||a.x>c.width-m.width||a.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||h.x>i.width-m.width||h.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const P=c.data,N=i.data,V=x===4&&A;for(let H=0;H<m.height;H++){const G=((a.y+H)*c.width+a.x)*x,Y=((h.y+H)*i.width+h.x)*x;if(V)for(let J=0;J<m.width;J++){const oe=G+J*x+3,ue=Y+J*x;N[ue+0]=255,N[ue+1]=255,N[ue+2]=255,N[ue+3]=P[oe]}else if(_)for(let J=0;J<m.width;J++){const oe=G+J*x,ue=Y+J*x,pe=new Wi(P[oe+0]/255,P[oe+1]/255,P[oe+2]/255,P[oe+3]).toNonPremultipliedRenderColor(_).toArray();N[ue+0]=pe[0],N[ue+1]=pe[1],N[ue+2]=pe[2],N[ue+3]=pe[3]}else for(let J=0;J<m.width*x;J++)N[Y+J]=P[G+J]}return i}Fn(YN,"HeatmapBucket",{omit:["layers"]});class Jg{constructor(i,a){r4(this,i,1,a)}resize(i){i4(this,new Jg(i),1)}clone(){return new Jg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,h,m,x){i3(i,a,h,m,x,1,null)}}class Ca{constructor(i,a){r4(this,i,4,a)}resize(i){i4(this,new Ca(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,h,m,x,_,A){i3(i,a,h,m,x,4,_,A)}}class s4{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function jb(c){const i={},a=c.resolution||256,h=c.clips?c.clips.length:1,m=c.image||new Ca({width:a,height:h}),x=(_,A,P)=>{i[c.evaluationKey]=P;const N=c.expression.evaluate(i),V=N?N.toNonPremultipliedRenderColor(null):null;V&&(m.data[_+A+0]=Math.floor(255*V.r),m.data[_+A+1]=Math.floor(255*V.g),m.data[_+A+2]=Math.floor(255*V.b),m.data[_+A+3]=Math.floor(255*V.a))};if(c.clips)for(let _=0,A=0;_<h;++_,A+=4*a)for(let P=0,N=0;P<a;P++,N+=4){const V=P/(a-1),{start:H,end:G}=c.clips[_];x(A,N,H*(1-V)+G*V)}else for(let _=0,A=0;_<a;_++,A+=4)x(0,A,_/(a-1));return m}Fn(Jg,"AlphaImage"),Fn(Ca,"RGBAImage");const Vq=di([{name:"a_pos",components:2,type:"Int16"}],4),Hq=di([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Gq=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),$q=di([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function m_(c,i,a=2){const h=i&&i.length,m=h?i[0]*a:c.length;let x=o4(c,0,m,a,!0);const _=[];if(!x||x.next===x.prev)return _;let A,P,N;if(h&&(x=(function(V,H,G,Y){const J=[];for(let oe=0,ue=H.length;oe<ue;oe++){const pe=o4(V,H[oe]*Y,oe<ue-1?H[oe+1]*Y:V.length,Y,!1);pe===pe.next&&(pe.steiner=!0),J.push(Jq(pe))}J.sort(Qq);for(let oe=0;oe<J.length;oe++)G=Kq(J[oe],G);return G})(c,i,x,a)),c.length>80*a){A=c[0],P=c[1];let V=A,H=P;for(let G=a;G<m;G+=a){const Y=c[G],J=c[G+1];Y<A&&(A=Y),J<P&&(P=J),Y>V&&(V=Y),J>H&&(H=J)}N=Math.max(V-A,H-P),N=N!==0?32767/N:0}return Db(x,_,a,A,P,N,0),_}function o4(c,i,a,h,m){let x;if(m===(function(_,A,P,N){let V=0;for(let H=A,G=P-N;H<P;H+=N)V+=(_[G]-_[H])*(_[H+1]+_[G+1]),G=H;return V})(c,i,a,h)>0)for(let _=i;_<a;_+=h)x=u4(_/h|0,c[_],c[_+1],x);else for(let _=a-h;_>=i;_-=h)x=u4(_/h|0,c[_],c[_+1],x);return x&&g_(x,x.next)&&(Fb(x),x=x.next),x}function Ay(c,i){if(!c)return c;i||(i=c);let a,h=c;do if(a=!1,h.steiner||!g_(h,h.next)&&Zo(h.prev,h,h.next)!==0)h=h.next;else{if(Fb(h),h=i=h.prev,h===h.next)break;a=!0}while(a||h!==i);return i}function Db(c,i,a,h,m,x,_){if(!c)return;!_&&x&&(function(P,N,V,H){let G=P;do G.z===0&&(G.z=s3(G.x,G.y,N,V,H)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==P);G.prevZ.nextZ=null,G.prevZ=null,(function(Y){let J,oe=1;do{let ue,pe=Y;Y=null;let we=null;for(J=0;pe;){J++;let Te=pe,Ie=0;for(let Ve=0;Ve<oe&&(Ie++,Te=Te.nextZ,Te);Ve++);let Ze=oe;for(;Ie>0||Ze>0&&Te;)Ie!==0&&(Ze===0||!Te||pe.z<=Te.z)?(ue=pe,pe=pe.nextZ,Ie--):(ue=Te,Te=Te.nextZ,Ze--),we?we.nextZ=ue:Y=ue,ue.prevZ=we,we=ue;pe=Te}we.nextZ=null,oe*=2}while(J>1)})(G)})(c,h,m,x);let A=c;for(;c.prev!==c.next;){const P=c.prev,N=c.next;if(x?qq(c,h,m,x):Wq(c))i.push(P.i,c.i,N.i),Fb(c),c=N.next,A=N.next;else if((c=N)===A){_?_===1?Db(c=Xq(Ay(c),i),i,a,h,m,x,2):_===2&&Zq(c,i,a,h,m,x):Db(Ay(c),i,a,h,m,x,1);break}}}function Wq(c){const i=c.prev,a=c,h=c.next;if(Zo(i,a,h)>=0)return!1;const m=i.x,x=a.x,_=h.x,A=i.y,P=a.y,N=h.y,V=Math.min(m,x,_),H=Math.min(A,P,N),G=Math.max(m,x,_),Y=Math.max(A,P,N);let J=h.next;for(;J!==i;){if(J.x>=V&&J.x<=G&&J.y>=H&&J.y<=Y&&Lb(m,A,x,P,_,N,J.x,J.y)&&Zo(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function qq(c,i,a,h){const m=c.prev,x=c,_=c.next;if(Zo(m,x,_)>=0)return!1;const A=m.x,P=x.x,N=_.x,V=m.y,H=x.y,G=_.y,Y=Math.min(A,P,N),J=Math.min(V,H,G),oe=Math.max(A,P,N),ue=Math.max(V,H,G),pe=s3(Y,J,i,a,h),we=s3(oe,ue,i,a,h);let Te=c.prevZ,Ie=c.nextZ;for(;Te&&Te.z>=pe&&Ie&&Ie.z<=we;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ue&&Te!==m&&Te!==_&&Lb(A,V,P,H,N,G,Te.x,Te.y)&&Zo(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ie.x>=Y&&Ie.x<=oe&&Ie.y>=J&&Ie.y<=ue&&Ie!==m&&Ie!==_&&Lb(A,V,P,H,N,G,Ie.x,Ie.y)&&Zo(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Te&&Te.z>=pe;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ue&&Te!==m&&Te!==_&&Lb(A,V,P,H,N,G,Te.x,Te.y)&&Zo(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ie&&Ie.z<=we;){if(Ie.x>=Y&&Ie.x<=oe&&Ie.y>=J&&Ie.y<=ue&&Ie!==m&&Ie!==_&&Lb(A,V,P,H,N,G,Ie.x,Ie.y)&&Zo(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function Xq(c,i){let a=c;do{const h=a.prev,m=a.next.next;!g_(h,m)&&l4(h,a,a.next,m)&&Ob(h,m)&&Ob(m,h)&&(i.push(h.i,a.i,m.i),Fb(a),Fb(a.next),a=c=m),a=a.next}while(a!==c);return Ay(a)}function Zq(c,i,a,h,m,x){let _=c;do{let A=_.next.next;for(;A!==_.prev;){if(_.i!==A.i&&eX(_,A)){let P=c4(_,A);return _=Ay(_,_.next),P=Ay(P,P.next),Db(_,i,a,h,m,x,0),void Db(P,i,a,h,m,x,0)}A=A.next}_=_.next}while(_!==c)}function Qq(c,i){let a=c.x-i.x;return a===0&&(a=c.y-i.y,a===0)&&(a=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),a}function Kq(c,i){const a=(function(m,x){let _=x;const A=m.x,P=m.y;let N,V=-1/0;if(g_(m,_))return _;do{if(g_(m,_.next))return _.next;if(P<=_.y&&P>=_.next.y&&_.next.y!==_.y){const oe=_.x+(P-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(oe<=A&&oe>V&&(V=oe,N=_.x<_.next.x?_:_.next,oe===A))return N}_=_.next}while(_!==x);if(!N)return null;const H=N,G=N.x,Y=N.y;let J=1/0;_=N;do{if(A>=_.x&&_.x>=G&&A!==_.x&&a4(P<Y?A:V,P,G,Y,P<Y?V:A,P,_.x,_.y)){const oe=Math.abs(P-_.y)/(A-_.x);Ob(_,m)&&(oe<J||oe===J&&(_.x>N.x||_.x===N.x&&Yq(N,_)))&&(N=_,J=oe)}_=_.next}while(_!==H);return N})(c,i);if(!a)return i;const h=c4(a,c);return Ay(h,h.next),Ay(a,a.next)}function Yq(c,i){return Zo(c.prev,c,i.prev)<0&&Zo(i.next,c,c.next)<0}function s3(c,i,a,h,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Jq(c){let i=c,a=c;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==c);return a}function a4(c,i,a,h,m,x,_,A){return(m-_)*(i-A)>=(c-_)*(x-A)&&(c-_)*(h-A)>=(a-_)*(i-A)&&(a-_)*(x-A)>=(m-_)*(h-A)}function Lb(c,i,a,h,m,x,_,A){return!(c===_&&i===A)&&a4(c,i,a,h,m,x,_,A)}function eX(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!(function(a,h){let m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==h.i&&m.next.i!==h.i&&l4(m,m.next,a,h))return!0;m=m.next}while(m!==a);return!1})(c,i)&&(Ob(c,i)&&Ob(i,c)&&(function(a,h){let m=a,x=!1;const _=(a.x+h.x)/2,A=(a.y+h.y)/2;do m.y>A!=m.next.y>A&&m.next.y!==m.y&&_<(m.next.x-m.x)*(A-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next;while(m!==a);return x})(c,i)&&(Zo(c.prev,c,i.prev)||Zo(c,i.prev,i))||g_(c,i)&&Zo(c.prev,c,c.next)>0&&Zo(i.prev,i,i.next)>0)}function Zo(c,i,a){return(i.y-c.y)*(a.x-i.x)-(i.x-c.x)*(a.y-i.y)}function g_(c,i){return c.x===i.x&&c.y===i.y}function l4(c,i,a,h){const m=L2(Zo(c,i,a)),x=L2(Zo(c,i,h)),_=L2(Zo(a,h,c)),A=L2(Zo(a,h,i));return m!==x&&_!==A||!(m!==0||!D2(c,a,i))||!(x!==0||!D2(c,h,i))||!(_!==0||!D2(a,c,h))||!(A!==0||!D2(a,i,h))}function D2(c,i,a){return i.x<=Math.max(c.x,a.x)&&i.x>=Math.min(c.x,a.x)&&i.y<=Math.max(c.y,a.y)&&i.y>=Math.min(c.y,a.y)}function L2(c){return c>0?1:c<0?-1:0}function Ob(c,i){return Zo(c.prev,c,c.next)<0?Zo(c,i,c.next)>=0&&Zo(c,c.prev,i)>=0:Zo(c,i,c.prev)<0||Zo(c,c.next,i)<0}function c4(c,i){const a=o3(c.i,c.x,c.y),h=o3(i.i,i.x,i.y),m=c.next,x=i.prev;return c.next=i,i.prev=c,a.next=m,m.prev=a,h.next=a,a.prev=h,x.next=h,h.prev=x,h}function u4(c,i,a,h){const m=o3(c,i,a);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function Fb(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function o3(c,i,a){return{i:c,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bb(c,i){const a=c.length;if(a<=1)return[c];const h=[];let m,x;for(let _=0;_<a;_++){const A=Sn(c[_]);A!==0&&(c[_].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(m&&h.push(m),m=[c[_]]):m.push(c[_]))}if(m&&h.push(m),i>1)for(let _=0;_<h.length;_++)h[_].length<=i||(_c(h[_],i,1,h[_].length-1,tX),h[_]=h[_].slice(0,i));return h}function tX(c,i){return i.area-c.area}function d4(c,i,a=1){if(!c)return null;const h=typeof c=="string"?za.from(c).getPrimary():c.getPrimary(),m=typeof c=="string"?null:c.getSecondary();for(const x of[h,m]){if(!x)continue;const _=x.id.toString();i.has(_)||i.set(_,[]),x.scaleSelf(a),i.get(_).push(x)}return{primary:h.toString(),secondary:m?m.toString():null}}function a3(c,i,a,h){const m=h.patternDependencies;let x=!1;for(const _ of i){const A=_.paint.get(`${c}-pattern`);A.isConstant()||(x=!0),d4(A.constantOr(null),m,a)&&(x=!0)}return x}function l3(c,i,a,h,m,x){const _=x.patternDependencies;for(const A of i){const P=A.paint.get(`${c}-pattern`).value;if(P.kind!=="constant"){let N=P.evaluate({zoom:h},a,{},x.availableImages);N=N&&N.name?N.name:N;const V=d4(N,_,m);if(!V)continue;const{primary:H,secondary:G}=V;H&&(a.patterns[A.id]=[H,G].filter(Boolean))}}return a}class h4{constructor(){this.polygons=new Map}add(i,...a){const h=this.polygons.get(i);h?h.push(...a):this.polygons.set(i,a)}merge(i){for(const[a,h]of i.polygons)this.add(a,...h)}}class xm{constructor(){this.portals=[]}static isOnBorder(i,a){return i<=0&&a<=0||i>=xn&&a>=xn}static evaluate(i){if(i.length===0)return new xm;let a=[];for(const P of i)a.push(...P.portals);if(a.length===0)return new xm;for(const P of a){const N=P.va,V=P.vb;(xm.isOnBorder(N.x,V.x)||xm.isOnBorder(N.y,V.y))&&(P.type="border")}const h=a.filter((P=>P.type!=="unevaluated")),m=a.filter((P=>P.type==="unevaluated"));if(m.length===0)return new xm;m.sort(((P,N)=>P.hash===N.hash?P.isTunnel===N.isTunnel?0:P.isTunnel?-1:1:P.hash<N.hash?1:-1)),a=h.concat(m);let x=h.length,_=x,A=x;do if(_++,_===a.length||a[x].hash!==a[_].hash){if(_-x==2){A<x&&(a[A]=a[x],a[x]=null);const P=a[A],N=a[_-1];P.type=P.isTunnel!==N.isTunnel?"tunnel":"polygon",P.connection={a:P.connection.a,b:N.connection.a},A++}x=_}while(x!==a.length);return a.splice(A),a.sort(((P,N)=>P.hash<N.hash?1:-1)),{portals:a}}}Fn(xm,"ElevationPortalGraph"),Fn(h4,"ElevationPolygons");class nX{constructor(i,a,h){this.outPositions=i,this.outNormals=a,this.outIndices=h,this.vertexLookup=new Map}addVertex(i,a,h){let m=i[2];h!=null&&(m*=h);const x=`${i[0]},${i[1]},${i[2]},${a[0]},${a[1]},${a[2]}`,_=this.vertexLookup.get(x);if(_!=null)return _;const A=this.outPositions.length;this.vertexLookup.set(x,A);const P=Math.trunc(16384*a[0]),N=Math.trunc(16384*a[1]),V=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(i[0],i[1],m),this.outNormals.emplaceBack(P,N,V),A}addTriangle(i,a,h){this.outIndices.emplaceBack(i,a,h)}addTriangles(i,a,h){if(i.length===0)return;const m=h.length===1,x=Me(),_=Me();for(let A=0;A<i.length;A+=3){const P=a[i[A+0]],N=a[i[A+1]],V=a[i[A+2]],H=m?h[0]:h[i[A+1]],G=m?h[0]:h[i[A+2]];$e(x,P.x,P.y,m?h[0]:h[i[A+0]]);const Y=this.addVertex(x,_);$e(x,N.x,N.y,H);const J=this.addVertex(x,_);$e(x,V.x,V.y,G);const oe=this.addVertex(x,_);this.outIndices.emplaceBack(Y,J,oe)}}addQuad(i,a,h,m,x,_){const A=this.addVertex(i,x,_),P=this.addVertex(a,x,_),N=this.addVertex(h,x,_),V=this.addVertex(m,x,_);this.addTriangle(A,P,N),this.addTriangle(N,V,A)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Pc{constructor(i,a,h,m){this.unevaluatedPortals=new xm,this.portalPolygons=new h4,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Gf,this.vertexNormals=new Ug,this.indexArray=new ys,this.tileToMeters=Qe(i),this.bridgeProgramConfigurations=new ml(a,{zoom:h,lut:m},(x=>x!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new ml(a,{zoom:h,lut:m},(x=>x!=="fill-bridge-guard-rail-color"))}addVertices(i,a){const h=this.unevalVertices.length;for(let m=0;m<i.length;m++)this.unevalVertices.push(i[m]),this.unevalHeights.push(a[m]);return h}addTriangles(i,a,h){const m=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of i)m.push(x+a)}addRenderableRing(i,a,h,m,x,_){const A=[new Ht(x.min.x,x.min.y),new Ht(x.max.x,x.min.y),new Ht(x.max.x,x.max.y),new Ht(x.min.x,x.max.y)];for(let P=0;P<h-1;P++){const N=a+P,V=N+1,H=this.unevalVertices[N],G=this.unevalVertices[V];if(!(H.x>=x.min.x&&H.x<=x.max.x&&H.y>=x.min.y&&H.y<=x.max.y||G.x>=x.min.x&&G.x<=x.max.x&&G.y>=x.min.y&&G.y<=x.max.y||Fs(H,G,A))||this.isOnBorder(H.x,G.x)||this.isOnBorder(H.y,G.y))continue;const Y=Pc.computeEdgeHash(this.unevalVertices[N],this.unevalVertices[V]);let J,oe=this.vertexHashLookup.get(Pc.computePosHash(H));oe!=null?J=oe.next:(oe=this.vertexHashLookup.get(Pc.computePosHash(G)),J=oe!=null?oe.prev:Y),this.unevalEdges.push({polygonIdx:i,a:N,b:V,hash:Y,portalHash:J,isTunnel:m,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,a,h,m,x){if(a.length===0)return;this.portalPolygons.add(i,{geometry:a,zLevel:x});const _=a[0];this.vertexHashLookup.clear();let A=Pc.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let P=0;P<_.length-1;P++){const N=_[P+0],V=_[P+1],H=Zr(V.x-N.x,V.y-N.y),G=Gn(H);if(G===0)continue;let Y="unevaluated";const J=m.pointElevation(N),oe=m.pointElevation(V);Math.abs(J)<.01&&Math.abs(oe)<.01?Y="entrance":(this.isOnBorder(N.x,V.x)||this.isOnBorder(N.y,V.y))&&(Y="border");const ue=Pc.computeEdgeHash(N,V);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:N,vb:V,vab:H,length:G,hash:ue,isTunnel:h,type:Y});const pe=Pc.computePosHash(N);this.vertexHashLookup.set(pe,{prev:A,next:ue}),A=ue}}construct(i){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=G=>{G.primitiveLength=this.indexArray.length-G.primitiveOffset},m=new nX(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const x=a(),_=a(),A=a(),P=(G,Y)=>{G.sort(((oe,ue)=>oe.type===Y&&ue.type!==Y?-1:oe.type!==Y&&ue.type===Y?1:0));const J=G.findIndex((oe=>oe.type!==Y));return J>=0?J:G.length};let N=0;this.unevalEdges.length>0&&(N=P(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},this.tileToMeters)),h(A);const V=a(),H=a();if(this.unevalEdges.length>0){const G=this.unevalEdges.splice(N),Y=P(G,"tunnel")+N;this.unevalEdges.push(...G),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},{min:N,max:Y})}h(V),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(H),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(_),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(x),this.maskSegments=Li.simpleSegment(0,H.primitiveOffset,0,H.primitiveLength),this.depthSegments=Li.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Li.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.renderableTunnelSegments=Li.simpleSegment(0,V.primitiveOffset,0,V.primitiveLength),this.shadowCasterSegments=Li.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(i,a,h,m,x,_,A,P){this.bridgeProgramConfigurations.updatePaintArrays(i,a,x,h,m,_,A,P),this.tunnelProgramConfigurations.updatePaintArrays(i,a,x,h,m,_,A,P)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,Gq.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,$q.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,a,h,m,x){const _=(A,P)=>{for(let N=0;N<P.length-1;N++){const V=P[N].featureIndex,H=P[N+1].vertexStart,G=i.feature(V);A.populatePaintArrays(H,G,V,{},h,a,m,void 0,x)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,a,h,m,x){const _=new Map;for(let A=m;A<x;A++){const P=h[A],N=P.a,V=P.b,H=Pc.computePosHash(i[N]),G=Pc.computePosHash(i[V]);let Y=_.get(H);Y||(Y={},_.set(H,Y));let J=_.get(G);J||(J={},_.set(G,J)),a[N]<=0&&a[V]<=0||(Y.to=V,J.from=N)}return _}isTerminalVertex(i,a){const h=Pc.computePosHash(this.unevalVertices[i]),m=a.get(h);return!m||!m.from||!m.to}constructBridgeStructures(i,a,h,m,x,_){i.clearVertexLookup();const A=this.computeVertexConnections(a,h,m,x.min,x.max),P=1/_,N=.5*P,V=(vn,an)=>$e(vn,a[an].x,a[an].y,h[an]*P),H=Me(),G=Me(),Y=Me(),J=Me(),oe=Me(),ue=(vn,an)=>{const Qt=A.get(Pc.computePosHash(a[an])),sn=Qt.from,jt=Qt.to;if(!sn||!jt)return;V(H,sn),V(G,an),V(Y,jt),Lr(J),Br(H,G)||(wn(oe,G,H),kt(J,oe)),Br(Y,G)||(wn(oe,Y,G),Ae(J,J,kt(oe,oe)));const Rt=mr(J);return Rt>0?bt(vn,J,1/Rt):void 0};let pe=Number.POSITIVE_INFINITY;this.sortSubarray(m,x.min,x.max,((vn,an)=>vn.featureInfo.featureIndex-an.featureInfo.featureIndex));const we=Me(),Te=Me(),Ie=Me(),Ze=Me(),Ve=Me(),Ye=Me(),nt=Me(),ot=Me(),Ot=Me(),pt=[Me(),Me(),Me(),Me()],Ut=[Me(),Me(),Me(),Me()],Zt=[{coord:new Ht(0,0),height:0},{coord:new Ht(0,0),height:0}],en=(vn,an)=>vn>an;for(let vn=x.min;vn<x.max;vn++){const an=m[vn];if(!an.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Zt,a,h,an,en))continue;const[Qt,sn]=Zt;if($e(we,Qt.coord.x,Qt.coord.y,P*Qt.height),$e(Te,sn.coord.x,sn.coord.y,P*sn.height),Br(we,Te))continue;wn(Ie,Te,we),kt(Ie,Ie);const jt=ue(ot,an.a)||Ie,Rt=ue(Ot,an.b)||Ie;$e(Ze,jt[1],-jt[0],0),kt(Ze,Ze),$e(Ve,Rt[1],-Rt[0],0),kt(Ve,Ve),mn(ot,Ze,jt),kt(Ye,ot),mn(ot,Ve,Rt),kt(nt,ot),Ae(pt[0],we,bt(ot,wn(ot,Ze,Ye),N)),Ae(pt[1],we,bt(ot,Ae(ot,Ze,Ye),N)),Ae(pt[2],we,bt(ot,Ye,N)),pt[3]=we,Ae(Ut[0],Te,bt(ot,wn(ot,Ve,nt),N)),Ae(Ut[1],Te,bt(ot,Ae(ot,Ve,nt),N)),Ae(Ut[2],Te,bt(ot,nt,N)),Ut[3]=Te,pe=this.addFeatureSection(an.featureInfo.featureIndex,pe,this.bridgeFeatureSections,i);const nn=i.addVertex(pt[0],Ze,_),gn=i.addVertex(pt[1],Ze,_),Yt=i.addVertex(Ut[0],Ve,_),zn=i.addVertex(Ut[1],Ve,_);i.addTriangle(nn,gn,Yt),i.addTriangle(gn,zn,Yt);const Zn=i.addVertex(pt[1],Ye,_),jn=i.addVertex(pt[2],Ye,_),Mn=i.addVertex(Ut[1],nt,_),Fr=i.addVertex(Ut[2],nt,_);i.addTriangle(Zn,jn,Mn),i.addTriangle(jn,Fr,Mn),qt(Ze,Ze),qt(Ve,Ve);const Rn=i.addVertex(pt[2],Ze,_),br=i.addVertex(pt[3],Ze,_),Ur=i.addVertex(Ut[2],Ve,_),fi=i.addVertex(Ut[3],Ve,_);i.addTriangle(Rn,br,Ur),i.addTriangle(br,fi,Ur);const Pi=this.isTerminalVertex(an.a,A),Wr=this.isTerminalVertex(an.b,A);Qt.height<.01&&Pi&&i.addQuad(pt[3],pt[2],pt[1],pt[0],qt(jt,jt),_),sn.height<.01&&Wr&&i.addQuad(Ut[0],Ut[1],Ut[2],Ut[3],Rt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,a,h,m,x,_){i.clearVertexLookup();let A=Number.POSITIVE_INFINITY;const P=(pe,we)=>pe.featureInfo.featureIndex-we.featureInfo.featureIndex;this.sortSubarray(m,x.min,x.max,P),this.sortSubarray(m,_.min,_.max,P);const N=pe=>kt(pe,pe),V=[{coord:new Ht(0,0),height:0},{coord:new Ht(0,0),height:0}],H=(pe,we)=>pe<we,G=Me(),Y=Me(),J=Me(),oe=Me(),ue=Me();for(let pe=x.min;pe<x.max;pe++){if(!this.prepareEdgePoints(V,a,h,m[pe],H))continue;const[we,Te]=V,Ie=N($e(ue,-(Te.coord.y-we.coord.y),Te.coord.x-we.coord.x,0));A=this.addFeatureSection(m[pe].featureInfo.featureIndex,A,this.tunnelFeatureSections,i),i.addQuad($e(G,we.coord.x,we.coord.y,we.height),$e(Y,Te.coord.x,Te.coord.y,Te.height),$e(J,Te.coord.x,Te.coord.y,m[pe].isTunnel?-.1:0),$e(oe,we.coord.x,we.coord.y,m[pe].isTunnel?-.1:0),Ie)}for(let pe=_.min;pe<_.max;pe++){const we=m[pe];we.isTunnel&&([we.a,we.b]=[we.b,we.a]);const Te=a[we.a],Ie=a[we.b],Ze=N($e(ue,-(Ie.y-Te.y),Ie.x-Te.x,0));A=this.addFeatureSection(we.featureInfo.featureIndex,A,this.tunnelFeatureSections,i),i.addQuad($e(G,Ie.x,Ie.y,0),$e(Y,Te.x,Te.y,0),$e(J,Te.x,Te.y,h[we.a]+4),$e(oe,Ie.x,Ie.y,h[we.b]+4),Ze),i.addQuad($e(G,Te.x,Te.y,0),$e(Y,Ie.x,Ie.y,0),$e(J,Ie.x,Ie.y,h[we.b]+4),$e(oe,Te.x,Te.y,h[we.a]+4),Ze)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,a,h,m){i.coord.x=a,i.coord.y=h,i.height=m}prepareEdgePoints(i,a,h,m,x){let _=a[m.a].x,A=a[m.a].y,P=a[m.b].x,N=a[m.b].y,V=h[m.a],H=h[m.b];const G=x(V,0),Y=x(H,0);if(G&&Y)return this.setElevatedPoint(i[0],_,A,V),this.setElevatedPoint(i[1],P,N,H),!0;if(!G&&!Y)return!1;if(G){if(!Y){const J=H/(H-V);P=Ar(P,_,J),N=Ar(N,A,J),H=Ar(H,V,J)}}else{const J=V/(V-H);_=Ar(_,P,J),A=Ar(A,N,J),V=Ar(V,H,J)}return this.setElevatedPoint(i[0],_,A,V),this.setElevatedPoint(i[1],P,N,H),!0}prepareEdges(i,a){if(a.length===0)return;a.sort(((A,P)=>A.hash===P.hash?P.polygonIdx-A.polygonIdx:P.hash>A.hash?1:-1));let h=0,m=0,x=0,_=a[h].polygonIdx;do m++,(m===a.length||a[h].hash!==a[m].hash)&&((m-h==1||a[m-1].polygonIdx!==_)&&(x<h&&(a[x]=a[h],a[h]=null),a[x].type="none",x++),h=m,h!==a.length&&(_=a[h].polygonIdx));while(h!==a.length);if(a.splice(x),a.length!==0&&i.length!==0){a.sort(((N,V)=>N.portalHash<V.portalHash?1:-1));let A=0,P=0;for(;A!==a.length&&P!==i.length;){const N=a[A],V=i[P];N.portalHash>V.hash?A++:V.hash>N.portalHash?P++:(N.type=V.type,A++)}}}isOnBorder(i,a){return i<=0&&a<=0||i>=xn&&a>=xn}addFeatureSection(i,a,h,m){return i!==a&&(a=i,h.push({featureIndex:i,vertexStart:m.getVertexCount()}),m.clearVertexLookup()),a}sortSubarray(i,a,h,m){const x=i.slice(a,h);x.sort(m),i.splice(a,x.length,...x)}static computeEdgeHash(i,a){return(i.y===a.y&&i.x>a.x||i.y>a.y)&&([i,a]=[a,i]),BigInt(Pc.computePosHash(i))<<32n|BigInt(Pc.computePosHash(a))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var f4,p4={exports:{}},m4=(f4||(f4=1,(function(c,i){(function(a){function h(Ge,Be){return Ge>Be?1:Ge<Be?-1:0}var m=function(Ge,Be){Ge===void 0&&(Ge=h),Be===void 0&&(Be=!1),this._compare=Ge,this._root=null,this._size=0,this._noDuplicates=!!Be},x={size:{configurable:!0}};function _(Ge,Be,$t,An,Wt){var kn=Wt-An;if(kn>0){var rr=An+Math.floor(kn/2),tr={key:Be[rr],data:$t[rr],parent:Ge};return tr.left=_(tr,Be,$t,An,rr),tr.right=_(tr,Be,$t,rr+1,Wt),tr}return null}function A(Ge,Be,$t,An,Wt){if(!($t>=An)){for(var kn=Ge[$t+An>>1],rr=$t-1,tr=An+1;;){do rr++;while(Wt(Ge[rr],kn)<0);do tr--;while(Wt(Ge[tr],kn)>0);if(rr>=tr)break;var Jr=Ge[rr];Ge[rr]=Ge[tr],Ge[tr]=Jr,Jr=Be[rr],Be[rr]=Be[tr],Be[tr]=Jr}A(Ge,Be,$t,tr,Wt),A(Ge,Be,tr+1,An,Wt)}}m.prototype.rotateLeft=function(Ge){var Be=Ge.right;Be&&(Ge.right=Be.left,Be.left&&(Be.left.parent=Ge),Be.parent=Ge.parent),Ge.parent?Ge===Ge.parent.left?Ge.parent.left=Be:Ge.parent.right=Be:this._root=Be,Be&&(Be.left=Ge),Ge.parent=Be},m.prototype.rotateRight=function(Ge){var Be=Ge.left;Be&&(Ge.left=Be.right,Be.right&&(Be.right.parent=Ge),Be.parent=Ge.parent),Ge.parent?Ge===Ge.parent.left?Ge.parent.left=Be:Ge.parent.right=Be:this._root=Be,Be&&(Be.right=Ge),Ge.parent=Be},m.prototype._splay=function(Ge){for(;Ge.parent;){var Be=Ge.parent;Be.parent?Be.left===Ge&&Be.parent.left===Be?(this.rotateRight(Be.parent),this.rotateRight(Be)):Be.right===Ge&&Be.parent.right===Be?(this.rotateLeft(Be.parent),this.rotateLeft(Be)):Be.left===Ge&&Be.parent.right===Be?(this.rotateRight(Be),this.rotateLeft(Be)):(this.rotateLeft(Be),this.rotateRight(Be)):Be.left===Ge?this.rotateRight(Be):this.rotateLeft(Be)}},m.prototype.splay=function(Ge){for(var Be,$t,An,Wt,kn;Ge.parent;)($t=(Be=Ge.parent).parent)&&$t.parent?((An=$t.parent).left===$t?An.left=Ge:An.right=Ge,Ge.parent=An):(Ge.parent=null,this._root=Ge),Wt=Ge.left,kn=Ge.right,Ge===Be.left?($t&&($t.left===Be?(Be.right?($t.left=Be.right,$t.left.parent=$t):$t.left=null,Be.right=$t,$t.parent=Be):(Wt?($t.right=Wt,Wt.parent=$t):$t.right=null,Ge.left=$t,$t.parent=Ge)),kn?(Be.left=kn,kn.parent=Be):Be.left=null,Ge.right=Be,Be.parent=Ge):($t&&($t.right===Be?(Be.left?($t.right=Be.left,$t.right.parent=$t):$t.right=null,Be.left=$t,$t.parent=Be):(kn?($t.left=kn,kn.parent=$t):$t.left=null,Ge.right=$t,$t.parent=Ge)),Wt?(Be.right=Wt,Wt.parent=Be):Be.right=null,Ge.left=Be,Be.parent=Ge)},m.prototype.replace=function(Ge,Be){Ge.parent?Ge===Ge.parent.left?Ge.parent.left=Be:Ge.parent.right=Be:this._root=Be,Be&&(Be.parent=Ge.parent)},m.prototype.minNode=function(Ge){if(Ge===void 0&&(Ge=this._root),Ge)for(;Ge.left;)Ge=Ge.left;return Ge},m.prototype.maxNode=function(Ge){if(Ge===void 0&&(Ge=this._root),Ge)for(;Ge.right;)Ge=Ge.right;return Ge},m.prototype.insert=function(Ge,Be){var $t=this._root,An=null,Wt=this._compare;if(this._noDuplicates)for(;$t;){if(An=$t,Wt($t.key,Ge)===0)return;$t=Wt($t.key,Ge)<0?$t.right:$t.left}else for(;$t;)An=$t,$t=Wt($t.key,Ge)<0?$t.right:$t.left;return $t={key:Ge,data:Be,left:null,right:null,parent:An},An?Wt(An.key,$t.key)<0?An.right=$t:An.left=$t:this._root=$t,this.splay($t),this._size++,$t},m.prototype.find=function(Ge){for(var Be=this._root,$t=this._compare;Be;){var An=$t(Be.key,Ge);if(An<0)Be=Be.right;else{if(!(An>0))return Be;Be=Be.left}}return null},m.prototype.contains=function(Ge){for(var Be=this._root,$t=this._compare;Be;){var An=$t(Ge,Be.key);if(An===0)return!0;Be=An<0?Be.left:Be.right}return!1},m.prototype.remove=function(Ge){var Be=this.find(Ge);if(!Be)return!1;if(this.splay(Be),Be.left)if(Be.right){var $t=this.minNode(Be.right);$t.parent!==Be&&(this.replace($t,$t.right),$t.right=Be.right,$t.right.parent=$t),this.replace(Be,$t),$t.left=Be.left,$t.left.parent=$t}else this.replace(Be,Be.left);else this.replace(Be,Be.right);return this._size--,!0},m.prototype.removeNode=function(Ge){if(!Ge)return!1;if(this.splay(Ge),Ge.left)if(Ge.right){var Be=this.minNode(Ge.right);Be.parent!==Ge&&(this.replace(Be,Be.right),Be.right=Ge.right,Be.right.parent=Be),this.replace(Ge,Be),Be.left=Ge.left,Be.left.parent=Be}else this.replace(Ge,Ge.left);else this.replace(Ge,Ge.right);return this._size--,!0},m.prototype.erase=function(Ge){var Be=this.find(Ge);if(Be){this.splay(Be);var $t=Be.left,An=Be.right,Wt=null;$t&&($t.parent=null,Wt=this.maxNode($t),this.splay(Wt),this._root=Wt),An&&($t?Wt.right=An:this._root=An,An.parent=Wt),this._size--}},m.prototype.pop=function(){var Ge=this._root,Be=null;if(Ge){for(;Ge.left;)Ge=Ge.left;Be={key:Ge.key,data:Ge.data},this.remove(Ge.key)}return Be},m.prototype.next=function(Ge){var Be=Ge;if(Be)if(Be.right)for(Be=Be.right;Be&&Be.left;)Be=Be.left;else for(Be=Ge.parent;Be&&Be.right===Ge;)Ge=Be,Be=Be.parent;return Be},m.prototype.prev=function(Ge){var Be=Ge;if(Be)if(Be.left)for(Be=Be.left;Be&&Be.right;)Be=Be.right;else for(Be=Ge.parent;Be&&Be.left===Ge;)Ge=Be,Be=Be.parent;return Be},m.prototype.forEach=function(Ge){for(var Be=this._root,$t=[],An=!1,Wt=0;!An;)Be?($t.push(Be),Be=Be.left):$t.length>0?(Ge(Be=$t.pop(),Wt++),Be=Be.right):An=!0;return this},m.prototype.range=function(Ge,Be,$t,An){for(var Wt=[],kn=this._compare,rr=this._root;Wt.length!==0||rr;)if(rr)Wt.push(rr),rr=rr.left;else{if(kn((rr=Wt.pop()).key,Be)>0)break;if(kn(rr.key,Ge)>=0&&$t.call(An,rr))return this;rr=rr.right}return this},m.prototype.keys=function(){for(var Ge=this._root,Be=[],$t=[],An=!1;!An;)Ge?(Be.push(Ge),Ge=Ge.left):Be.length>0?(Ge=Be.pop(),$t.push(Ge.key),Ge=Ge.right):An=!0;return $t},m.prototype.values=function(){for(var Ge=this._root,Be=[],$t=[],An=!1;!An;)Ge?(Be.push(Ge),Ge=Ge.left):Be.length>0?(Ge=Be.pop(),$t.push(Ge.data),Ge=Ge.right):An=!0;return $t},m.prototype.at=function(Ge){for(var Be=this._root,$t=[],An=!1,Wt=0;!An;)if(Be)$t.push(Be),Be=Be.left;else if($t.length>0){if(Be=$t.pop(),Wt===Ge)return Be;Wt++,Be=Be.right}else An=!0;return null},m.prototype.load=function(Ge,Be,$t){if(Ge===void 0&&(Ge=[]),Be===void 0&&(Be=[]),$t===void 0&&($t=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var An=Ge.length;return $t&&A(Ge,Be,0,An-1,this._compare),this._root=_(null,Ge,Be,0,An),this._size=An,this},m.prototype.min=function(){var Ge=this.minNode(this._root);return Ge?Ge.key:null},m.prototype.max=function(){var Ge=this.maxNode(this._root);return Ge?Ge.key:null},m.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},m.createTree=function(Ge,Be,$t,An,Wt){return new m($t,Wt).load(Ge,Be,An)},Object.defineProperties(m.prototype,x);var P=0,N=1,V=2,H=3,G=0,Y=1,J=2,oe=3;function ue(Ge,Be,$t){Be===null?(Ge.inOut=!1,Ge.otherInOut=!0):(Ge.isSubject===Be.isSubject?(Ge.inOut=!Be.inOut,Ge.otherInOut=Be.otherInOut):(Ge.inOut=!Be.otherInOut,Ge.otherInOut=Be.isVertical()?!Be.inOut:Be.inOut),Be&&(Ge.prevInResult=!pe(Be,$t)||Be.isVertical()?Be.prevInResult:Be));var An=pe(Ge,$t);Ge.resultTransition=An?(function(Wt,kn){var rr,tr=!Wt.inOut,Jr=!Wt.otherInOut;switch(kn){case G:rr=tr&&Jr;break;case Y:rr=tr||Jr;break;case oe:rr=tr^Jr;break;case J:rr=Wt.isSubject?tr&&!Jr:Jr&&!tr}return rr?1:-1})(Ge,$t):0}function pe(Ge,Be){switch(Ge.type){case P:switch(Be){case G:return!Ge.otherInOut;case Y:return Ge.otherInOut;case J:return Ge.isSubject&&Ge.otherInOut||!Ge.isSubject&&!Ge.otherInOut;case oe:return!0}break;case V:return Be===G||Be===Y;case H:return Be===J;case N:return!1}return!1}var we=function(Ge,Be,$t,An,Wt){this.left=Be,this.point=Ge,this.otherEvent=$t,this.isSubject=An,this.type=Wt||P,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Te={inResult:{configurable:!0}};function Ie(Ge,Be){return Ge[0]===Be[0]&&Ge[1]===Be[1]}we.prototype.isBelow=function(Ge){var Be=this.point,$t=this.otherEvent.point;return this.left?(Be[0]-Ge[0])*($t[1]-Ge[1])-($t[0]-Ge[0])*(Be[1]-Ge[1])>0:($t[0]-Ge[0])*(Be[1]-Ge[1])-(Be[0]-Ge[0])*($t[1]-Ge[1])>0},we.prototype.isAbove=function(Ge){return!this.isBelow(Ge)},we.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Te.inResult.get=function(){return this.resultTransition!==0},we.prototype.clone=function(){var Ge=new we(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ge.contourId=this.contourId,Ge.resultTransition=this.resultTransition,Ge.prevInResult=this.prevInResult,Ge.isExteriorRing=this.isExteriorRing,Ge.inOut=this.inOut,Ge.otherInOut=this.otherInOut,Ge},Object.defineProperties(we.prototype,Te);var Ze=11102230246251565e-32,Ve=134217729,Ye=(3+8*Ze)*Ze;function nt(Ge,Be,$t,An,Wt){var kn,rr,tr,Jr,Mr=Be[0],Yn=An[0],Bi=0,as=0;Yn>Mr==Yn>-Mr?(kn=Mr,Mr=Be[++Bi]):(kn=Yn,Yn=An[++as]);var Rr=0;if(Bi<Ge&&as<$t)for(Yn>Mr==Yn>-Mr?(tr=kn-((rr=Mr+kn)-Mr),Mr=Be[++Bi]):(tr=kn-((rr=Yn+kn)-Yn),Yn=An[++as]),kn=rr,tr!==0&&(Wt[Rr++]=tr);Bi<Ge&&as<$t;)Yn>Mr==Yn>-Mr?(tr=kn-((rr=kn+Mr)-(Jr=rr-kn))+(Mr-Jr),Mr=Be[++Bi]):(tr=kn-((rr=kn+Yn)-(Jr=rr-kn))+(Yn-Jr),Yn=An[++as]),kn=rr,tr!==0&&(Wt[Rr++]=tr);for(;Bi<Ge;)tr=kn-((rr=kn+Mr)-(Jr=rr-kn))+(Mr-Jr),Mr=Be[++Bi],kn=rr,tr!==0&&(Wt[Rr++]=tr);for(;as<$t;)tr=kn-((rr=kn+Yn)-(Jr=rr-kn))+(Yn-Jr),Yn=An[++as],kn=rr,tr!==0&&(Wt[Rr++]=tr);return kn===0&&Rr!==0||(Wt[Rr++]=kn),Rr}function ot(Ge){return new Float64Array(Ge)}var Ot=33306690738754716e-32,pt=22204460492503146e-32,Ut=11093356479670487e-47,Zt=ot(4),en=ot(8),vn=ot(12),an=ot(16),Qt=ot(4);function sn(Ge,Be,$t){var An=(function(Wt,kn,rr,tr,Jr,Mr){var Yn=(kn-Mr)*(rr-Jr),Bi=(Wt-Jr)*(tr-Mr),as=Yn-Bi;if(Yn===0||Bi===0||Yn>0!=Bi>0)return as;var Rr=Math.abs(Yn+Bi);return Math.abs(as)>=Ot*Rr?as:-(function(ki,ls,es,Hs,As,fs,is){var Gi,ei,$i,ps,kr,Ri,Cs,Ys,oo,Eo,Ms,vo,oc,bo,Nc,Ma,Xu,ac,jc=ki-As,ka=es-As,Dc=ls-fs,Zu=Hs-fs;Zt[0]=(Nc=(Ys=jc-(Cs=(Ri=Ve*jc)-(Ri-jc)))*(Eo=Zu-(oo=(Ri=Ve*Zu)-(Ri-Zu)))-((bo=jc*Zu)-Cs*oo-Ys*oo-Cs*Eo))-((Ms=Nc-(Xu=(Ys=Dc-(Cs=(Ri=Ve*Dc)-(Ri-Dc)))*(Eo=ka-(oo=(Ri=Ve*ka)-(Ri-ka)))-((Ma=Dc*ka)-Cs*oo-Ys*oo-Cs*Eo)))+(kr=Nc-Ms))+(kr-Xu),Zt[1]=(oc=bo-((vo=bo+Ms)-(kr=vo-bo))+(Ms-kr))-((Ms=oc-Ma)+(kr=oc-Ms))+(kr-Ma),Zt[2]=vo-((ac=vo+Ms)-(kr=ac-vo))+(Ms-kr),Zt[3]=ac;var oa=(function(s0,op){for(var ES=op[0],D_=1;D_<4;D_++)ES+=op[D_];return ES})(0,Zt),yl=pt*is;if(oa>=yl||-oa>=yl||(Gi=ki-(jc+(kr=ki-jc))+(kr-As),$i=es-(ka+(kr=es-ka))+(kr-As),ei=ls-(Dc+(kr=ls-Dc))+(kr-fs),ps=Hs-(Zu+(kr=Hs-Zu))+(kr-fs),Gi===0&&ei===0&&$i===0&&ps===0)||(yl=Ut*is+Ye*Math.abs(oa),(oa+=jc*ps+Zu*Gi-(Dc*$i+ka*ei))>=yl||-oa>=yl))return oa;Qt[0]=(Nc=(Ys=Gi-(Cs=(Ri=Ve*Gi)-(Ri-Gi)))*(Eo=Zu-(oo=(Ri=Ve*Zu)-(Ri-Zu)))-((bo=Gi*Zu)-Cs*oo-Ys*oo-Cs*Eo))-((Ms=Nc-(Xu=(Ys=ei-(Cs=(Ri=Ve*ei)-(Ri-ei)))*(Eo=ka-(oo=(Ri=Ve*ka)-(Ri-ka)))-((Ma=ei*ka)-Cs*oo-Ys*oo-Cs*Eo)))+(kr=Nc-Ms))+(kr-Xu),Qt[1]=(oc=bo-((vo=bo+Ms)-(kr=vo-bo))+(Ms-kr))-((Ms=oc-Ma)+(kr=oc-Ms))+(kr-Ma),Qt[2]=vo-((ac=vo+Ms)-(kr=ac-vo))+(Ms-kr),Qt[3]=ac;var sp=nt(4,Zt,4,Qt,en);Qt[0]=(Nc=(Ys=jc-(Cs=(Ri=Ve*jc)-(Ri-jc)))*(Eo=ps-(oo=(Ri=Ve*ps)-(Ri-ps)))-((bo=jc*ps)-Cs*oo-Ys*oo-Cs*Eo))-((Ms=Nc-(Xu=(Ys=Dc-(Cs=(Ri=Ve*Dc)-(Ri-Dc)))*(Eo=$i-(oo=(Ri=Ve*$i)-(Ri-$i)))-((Ma=Dc*$i)-Cs*oo-Ys*oo-Cs*Eo)))+(kr=Nc-Ms))+(kr-Xu),Qt[1]=(oc=bo-((vo=bo+Ms)-(kr=vo-bo))+(Ms-kr))-((Ms=oc-Ma)+(kr=oc-Ms))+(kr-Ma),Qt[2]=vo-((ac=vo+Ms)-(kr=ac-vo))+(Ms-kr),Qt[3]=ac;var i0=nt(sp,en,4,Qt,vn);Qt[0]=(Nc=(Ys=Gi-(Cs=(Ri=Ve*Gi)-(Ri-Gi)))*(Eo=ps-(oo=(Ri=Ve*ps)-(Ri-ps)))-((bo=Gi*ps)-Cs*oo-Ys*oo-Cs*Eo))-((Ms=Nc-(Xu=(Ys=ei-(Cs=(Ri=Ve*ei)-(Ri-ei)))*(Eo=$i-(oo=(Ri=Ve*$i)-(Ri-$i)))-((Ma=ei*$i)-Cs*oo-Ys*oo-Cs*Eo)))+(kr=Nc-Ms))+(kr-Xu),Qt[1]=(oc=bo-((vo=bo+Ms)-(kr=vo-bo))+(Ms-kr))-((Ms=oc-Ma)+(kr=oc-Ms))+(kr-Ma),Qt[2]=vo-((ac=vo+Ms)-(kr=ac-vo))+(Ms-kr),Qt[3]=ac;var j_=nt(i0,vn,4,Qt,an);return an[j_-1]})(Wt,kn,rr,tr,Jr,Mr,Rr)})(Ge[0],Ge[1],Be[0],Be[1],$t[0],$t[1]);return An>0?-1:An<0?1:0}function jt(Ge,Be){var $t=Ge.point,An=Be.point;return $t[0]>An[0]?1:$t[0]<An[0]?-1:$t[1]!==An[1]?$t[1]>An[1]?1:-1:(function(Wt,kn,rr,tr){return Wt.left!==kn.left?Wt.left?1:-1:sn(rr,Wt.otherEvent.point,kn.otherEvent.point)!==0?Wt.isBelow(kn.otherEvent.point)?-1:1:!Wt.isSubject&&kn.isSubject?1:-1})(Ge,Be,$t)}function Rt(Ge,Be,$t){var An=new we(Be,!1,Ge,Ge.isSubject),Wt=new we(Be,!0,Ge.otherEvent,Ge.isSubject);return Ie(Ge.point,Ge.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ge),An.contourId=Wt.contourId=Ge.contourId,jt(Wt,Ge.otherEvent)>0&&(Ge.otherEvent.left=!0,Wt.left=!1),Ge.otherEvent.otherEvent=Wt,Ge.otherEvent=An,$t.push(Wt),$t.push(An),$t}function nn(Ge,Be){return Ge[0]*Be[1]-Ge[1]*Be[0]}function gn(Ge,Be){return Ge[0]*Be[0]+Ge[1]*Be[1]}function Yt(Ge,Be,$t){var An=(function(Jr,Mr,Yn,Bi,as){var Rr=[Mr[0]-Jr[0],Mr[1]-Jr[1]],ki=[Bi[0]-Yn[0],Bi[1]-Yn[1]];function ls(Ri,Cs,Ys){return[Ri[0]+Cs*Ys[0],Ri[1]+Cs*Ys[1]]}var es=[Yn[0]-Jr[0],Yn[1]-Jr[1]],Hs=nn(Rr,ki),As=Hs*Hs,fs=gn(Rr,Rr);if(As>0){var is=nn(es,ki)/Hs;if(is<0||is>1)return null;var Gi=nn(es,Rr)/Hs;return Gi<0||Gi>1?null:is===0||is===1?[ls(Jr,is,Rr)]:Gi===0||Gi===1?[ls(Yn,Gi,ki)]:[ls(Jr,is,Rr)]}if((As=(Hs=nn(es,Rr))*Hs)>0)return null;var ei=gn(Rr,es)/fs,$i=ei+gn(Rr,ki)/fs,ps=Math.min(ei,$i),kr=Math.max(ei,$i);return ps<=1&&kr>=0?ps===1?[ls(Jr,ps>0?ps:0,Rr)]:kr===0?[ls(Jr,kr<1?kr:1,Rr)]:[ls(Jr,ps>0?ps:0,Rr),ls(Jr,kr<1?kr:1,Rr)]:null})(Ge.point,Ge.otherEvent.point,Be.point,Be.otherEvent.point),Wt=An?An.length:0;if(Wt===0||Wt===1&&(Ie(Ge.point,Be.point)||Ie(Ge.otherEvent.point,Be.otherEvent.point))||Wt===2&&Ge.isSubject===Be.isSubject)return 0;if(Wt===1)return Ie(Ge.point,An[0])||Ie(Ge.otherEvent.point,An[0])||Rt(Ge,An[0],$t),Ie(Be.point,An[0])||Ie(Be.otherEvent.point,An[0])||Rt(Be,An[0],$t),1;var kn=[],rr=!1,tr=!1;return Ie(Ge.point,Be.point)?rr=!0:jt(Ge,Be)===1?kn.push(Be,Ge):kn.push(Ge,Be),Ie(Ge.otherEvent.point,Be.otherEvent.point)?tr=!0:jt(Ge.otherEvent,Be.otherEvent)===1?kn.push(Be.otherEvent,Ge.otherEvent):kn.push(Ge.otherEvent,Be.otherEvent),rr&&tr||rr?(Be.type=N,Ge.type=Be.inOut===Ge.inOut?V:H,rr&&!tr&&Rt(kn[1].otherEvent,kn[0].point,$t),2):tr?(Rt(kn[0],kn[1].point,$t),3):kn[0]!==kn[3].otherEvent?(Rt(kn[0],kn[1].point,$t),Rt(kn[1],kn[2].point,$t),3):(Rt(kn[0],kn[1].point,$t),Rt(kn[3].otherEvent,kn[2].point,$t),3)}function zn(Ge,Be){if(Ge===Be)return 0;if(sn(Ge.point,Ge.otherEvent.point,Be.point)!==0||sn(Ge.point,Ge.otherEvent.point,Be.otherEvent.point)!==0)return Ie(Ge.point,Be.point)?Ge.isBelow(Be.otherEvent.point)?-1:1:Ge.point[0]===Be.point[0]?Ge.point[1]<Be.point[1]?-1:1:jt(Ge,Be)===1?Be.isAbove(Ge.point)?-1:1:Ge.isBelow(Be.point)?-1:1;if(Ge.isSubject!==Be.isSubject)return Ge.isSubject?-1:1;var $t=Ge.point,An=Be.point;return $t[0]===An[0]&&$t[1]===An[1]?($t=Ge.otherEvent.point)[0]===(An=Be.otherEvent.point)[0]&&$t[1]===An[1]?0:Ge.contourId>Be.contourId?1:-1:jt(Ge,Be)===1?1:-1}var Zn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function jn(Ge,Be,$t,An){var Wt,kn=Ge+1,rr=Be[Ge].point,tr=Be.length;for(kn<tr&&(Wt=Be[kn].point);kn<tr&&Wt[0]===rr[0]&&Wt[1]===rr[1];){if(!$t[kn])return kn;++kn<tr&&(Wt=Be[kn].point)}for(kn=Ge-1;$t[kn]&&kn>An;)kn--;return kn}Zn.prototype.isExterior=function(){return this.holeOf==null};var Mn=Rn,Fr=Rn;function Rn(Ge,Be){if(!(this instanceof Rn))return new Rn(Ge,Be);if(this.data=Ge||[],this.length=this.data.length,this.compare=Be||br,this.length>0)for(var $t=(this.length>>1)-1;$t>=0;$t--)this._down($t)}function br(Ge,Be){return Ge<Be?-1:Ge>Be?1:0}Rn.prototype={push:function(Ge){this.data.push(Ge),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ge=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ge}},peek:function(){return this.data[0]},_up:function(Ge){for(var Be=this.data,$t=this.compare,An=Be[Ge];Ge>0;){var Wt=Ge-1>>1,kn=Be[Wt];if($t(An,kn)>=0)break;Be[Ge]=kn,Ge=Wt}Be[Ge]=An},_down:function(Ge){for(var Be=this.data,$t=this.compare,An=this.length>>1,Wt=Be[Ge];Ge<An;){var kn=1+(Ge<<1),rr=kn+1,tr=Be[kn];if(rr<this.length&&$t(Be[rr],tr)<0&&(kn=rr,tr=Be[rr]),$t(tr,Wt)>=0)break;Be[Ge]=tr,Ge=kn}Be[Ge]=Wt}},Mn.default=Fr;var Ur=Math.max,fi=Math.min,Pi=0;function Wr(Ge,Be,$t,An,Wt,kn){var rr,tr,Jr,Mr,Yn,Bi;for(rr=0,tr=Ge.length-1;rr<tr;rr++)if(Mr=Ge[rr+1],Yn=new we(Jr=Ge[rr],!1,void 0,Be),Bi=new we(Mr,!1,Yn,Be),Yn.otherEvent=Bi,Jr[0]!==Mr[0]||Jr[1]!==Mr[1]){Yn.contourId=Bi.contourId=$t,kn||(Yn.isExteriorRing=!1,Bi.isExteriorRing=!1),jt(Yn,Bi)>0?Bi.left=!0:Yn.left=!0;var as=Jr[0],Rr=Jr[1];Wt[0]=fi(Wt[0],as),Wt[1]=fi(Wt[1],Rr),Wt[2]=Ur(Wt[2],as),Wt[3]=Ur(Wt[3],Rr),An.push(Yn),An.push(Bi)}}var Vi=[];function Hi(Ge,Be,$t){typeof Ge[0][0][0]=="number"&&(Ge=[Ge]),typeof Be[0][0][0]=="number"&&(Be=[Be]);var An=(function(Rr,ki,ls){var es=null;return Rr.length*ki.length==0&&(ls===G?es=Vi:ls===J?es=Rr:ls!==Y&&ls!==oe||(es=Rr.length===0?ki:Rr)),es})(Ge,Be,$t);if(An)return An===Vi?null:An;var Wt=[1/0,1/0,-1/0,-1/0],kn=[1/0,1/0,-1/0,-1/0],rr=(function(Rr,ki,ls,es,Hs){var As,fs,is,Gi,ei,$i,ps=new Mn(null,jt);for(is=0,Gi=Rr.length;is<Gi;is++)for(ei=0,$i=(As=Rr[is]).length;ei<$i;ei++)(fs=ei===0)&&Pi++,Wr(As[ei],!0,Pi,ps,ls,fs);for(is=0,Gi=ki.length;is<Gi;is++)for(ei=0,$i=(As=ki[is]).length;ei<$i;ei++)fs=ei===0,Hs===J&&(fs=!1),fs&&Pi++,Wr(As[ei],!1,Pi,ps,es,fs);return ps})(Ge,Be,Wt,kn,$t);if(An=(function(Rr,ki,ls,es,Hs){var As=null;return(ls[0]>es[2]||es[0]>ls[2]||ls[1]>es[3]||es[1]>ls[3])&&(Hs===G?As=Vi:Hs===J?As=Rr:Hs!==Y&&Hs!==oe||(As=Rr.concat(ki))),As})(Ge,Be,Wt,kn,$t))return An===Vi?null:An;for(var tr=(function(Rr){var ki,ls,es=(function(is){var Gi,ei,$i,ps,kr=[];for(ei=0,$i=is.length;ei<$i;ei++)((Gi=is[ei]).left&&Gi.inResult||!Gi.left&&Gi.otherEvent.inResult)&&kr.push(Gi);for(var Ri=!1;!Ri;)for(Ri=!0,ei=0,$i=kr.length;ei<$i;ei++)ei+1<$i&&jt(kr[ei],kr[ei+1])===1&&(ps=kr[ei],kr[ei]=kr[ei+1],kr[ei+1]=ps,Ri=!1);for(ei=0,$i=kr.length;ei<$i;ei++)(Gi=kr[ei]).otherPos=ei;for(ei=0,$i=kr.length;ei<$i;ei++)(Gi=kr[ei]).left||(ps=Gi.otherPos,Gi.otherPos=Gi.otherEvent.otherPos,Gi.otherEvent.otherPos=ps);return kr})(Rr),Hs={},As=[],fs=function(){if(!Hs[ki]){var is=As.length,Gi=(function(kr,Ri,Cs){var Ys=new Zn;if(kr.prevInResult!=null){var oo=kr.prevInResult,Eo=oo.outputContourId;if(oo.resultTransition>0){var Ms=Ri[Eo];if(Ms.holeOf!=null){var vo=Ms.holeOf;Ri[vo].holeIds.push(Cs),Ys.holeOf=vo,Ys.depth=Ri[Eo].depth}else Ri[Eo].holeIds.push(Cs),Ys.holeOf=Eo,Ys.depth=Ri[Eo].depth+1}else Ys.holeOf=null,Ys.depth=Ri[Eo].depth}else Ys.holeOf=null,Ys.depth=0;return Ys})(es[ki],As,is),ei=function(kr){Hs[kr]=!0,kr<es.length&&es[kr]&&(es[kr].outputContourId=is)},$i=ki,ps=ki;for(Gi.points.push(es[ki].point);ei($i),ei($i=es[$i].otherPos),Gi.points.push(es[$i].point),!(($i=jn($i,es,Hs,ps))==ps||$i>=es.length)&&es[$i];);As.push(Gi)}};for(ki=0,ls=es.length;ki<ls;ki++)fs();return As})((function(Rr,ki,ls,es,Hs,As){for(var fs,is,Gi,ei=new m(zn),$i=[],ps=Math.min(es[2],Hs[2]);Rr.length!==0;){var kr=Rr.pop();if($i.push(kr),As===G&&kr.point[0]>ps||As===J&&kr.point[0]>es[2])break;if(kr.left){is=fs=ei.insert(kr),fs=fs!==(Gi=ei.minNode())?ei.prev(fs):null,is=ei.next(is);var Ri=fs?fs.key:null;if(ue(kr,Ri,As),is&&Yt(kr,is.key,Rr)===2&&(ue(kr,Ri,As),ue(is.key,kr,As)),fs&&Yt(fs.key,kr,Rr)===2){var Cs=fs;ue(Ri,(Cs=Cs!==Gi?ei.prev(Cs):null)?Cs.key:null,As),ue(kr,Ri,As)}}else is=fs=ei.find(kr=kr.otherEvent),fs&&is&&(fs=fs!==Gi?ei.prev(fs):null,is=ei.next(is),ei.remove(kr),is&&fs&&Yt(fs.key,is.key,Rr))}return $i})(rr,0,0,Wt,kn,$t)),Jr=[],Mr=0;Mr<tr.length;Mr++){var Yn=tr[Mr];if(Yn.isExterior()){for(var Bi=[Yn.points],as=0;as<Yn.holeIds.length;as++)Bi.push(tr[Yn.holeIds[as]].points);Jr.push(Bi)}}return Jr}var Ds={UNION:Y,DIFFERENCE:J,INTERSECTION:G,XOR:oe};a.diff=function(Ge,Be){return Hi(Ge,Be,J)},a.intersection=function(Ge,Be){return Hi(Ge,Be,G)},a.operations=Ds,a.union=function(Ge,Be){return Hi(Ge,Be,Y)},a.xor=function(Ge,Be){return Hi(Ge,Be,oe)},Object.defineProperty(a,"__esModule",{value:!0})})(i)})(0,p4.exports)),p4.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function O2(c,i,a,h){const m=[],x=h===0?(_,A,P,N,V,H)=>{_.push(new Ht(H,P+(H-A)/(N-A)*(V-P)))}:(_,A,P,N,V,H)=>{_.push(new Ht(A+(H-P)/(V-P)*(N-A),H))};for(const _ of c){const A=[];for(const P of _){if(P.length<=2)continue;const N=[];for(let G=0;G<P.length-1;G++){const Y=P[G].x,J=P[G].y,oe=P[G+1].x,ue=P[G+1].y,pe=h===0?Y:J,we=h===0?oe:ue;pe<i?we>i&&x(N,Y,J,oe,ue,i):pe>a?we<a&&x(N,Y,J,oe,ue,a):N.push(P[G]),we<i&&pe>=i&&x(N,Y,J,oe,ue,i),we>a&&pe<=a&&x(N,Y,J,oe,ue,a)}let V=P[P.length-1];const H=h===0?V.x:V.y;H>=i&&H<=a&&N.push(V),N.length&&(V=N[N.length-1],N[0].x===V.x&&N[0].y===V.y||N.push(N[0]),A.push(N))}A.length&&m.push(A)}return m}function rX(c,i){const a=c3(c),h=c3([i]),m=m4.intersection(a,h);return m==null?[]:g4(m)}function iX(c,i){let h=c3(c,65536);const m=[];for(;i.valid();i.next()){const[x,_]=i.get(),A=x.x*65536,P=x.y*65536,N=_.x*65536,V=_.y*65536,H=N-A,G=V-P,Y=Math.hypot(H,G);if(Y===0)continue;const J=Math.trunc(G/Y*3),oe=-Math.trunc(H/Y*3);m.push([[[A,P],[N,V],[N+J,V+oe],[A+J,P+oe],[A,P]]])}return m.length>0&&(h=m4.diff(h,m)),g4(h,1/65536)}function c3(c,i=1){return[c.map((a=>a.map((h=>[h.x*i,h.y*i]))))]}function g4(c,i=1){return c.map((a=>a.map(((h,m)=>{const x=h.map((_=>new Ht(_[0]*i,_[1]*i).round()));return m>0&&x.reverse(),x}))))}class u3{constructor(i,a){this.layoutVertexArray=new $a,this.indexArray=new ys,this.lineIndexArray=new Dl,this.triangleSegments=new Li,this.lineSegments=new Li,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new kc)}update(i,a,h,m,x,_,A,P){this.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,P)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Vq.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Hq.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,a,h,m,x,_,A){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,h,m,x,_,void 0,A)}}class d3{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new u3(i,!1),this.elevationBufferData=new u3(i,!0),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,h,m){}populate(i,a,h,m){this.hasPattern=a3("fill",this.layers,this.pixelRatio,a);const x=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:A,id:P,index:N,sourceLayerIndex:V}of i){const H=this.layers[0]._featureFilter.needGeometry,G=Mt(A,H);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),G,h))continue;const Y=x?x.evaluate(G,{},h,a.availableImages):void 0,J={id:P,properties:A.properties,type:A.type,sourceLayerIndex:V,index:N,geometry:H?G.geometry:zt(A,h,m),patterns:{},sortKey:Y};_.push(J)}x&&_.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of _){const{geometry:P,index:N,sourceLayerIndex:V}=A;if(this.hasPattern){const H=l3("fill",this.layers,A,this.zoom,this.pixelRatio,a);this.patternFeatures.push(H)}else this.addFeature(A,P,N,h,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[N].feature,P,N,V,this.index)}}update(i,a,h,m,x,_,A){this.bufferData.update(i,a,h,m,x,_,A,this.worldview),this.elevationBufferData.update(i,a,h,m,x,_,A,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,a,h,m,x,_,A,this.worldview)}addFeatures(i,a,h,m,x,_){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,a,h,m,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,a,h,m,x,_=[],A,P){const N=Bb(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,N,m,h,P):this.addGeometry(N,this.bufferData),this.bufferData.populatePaintArrays(i,h,x,_,m,A,this.worldview),this.elevationBufferData.populatePaintArrays(i,h,x,_,m,A,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,a,h,m,x){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(a,h,m,x,this.worldview))}addElevatedRoadFeature(i,a,h,m,x){const _=new Array,A=Pr.getElevationFeature(i,x);if(!A)return void this.addGeometry(a,this.bufferData);{const N=this.clipPolygonsToTile(a,1);N.length>0&&_.push({polygons:N,elevationFeature:A,elevationTileID:h})}const P={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},h),featureIndex:m};for(const N of _)if(N.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Pc(N.elevationTileID,this.layers,this.zoom,this.lut));const H=N.elevationFeature.isTunnel();let G=0;i.properties.hasOwnProperty(Bn)&&(G=+i.properties[Bn]);for(const Y of N.polygons)this.elevatedStructures.addPortalCandidates(N.elevationFeature.id,Y,H,N.elevationFeature,G)}N.elevationFeature.constantHeight==null&&(N.polygons=this.prepareElevatedPolygons(N.polygons,N.elevationFeature,N.elevationTileID));const V=new Si(h,N.elevationTileID);this.addElevatedGeometry(N.polygons,V,N.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m,P)}}addElevatedGeometry(i,a,h,m,x,_){const A={elevation:h,elevationSampler:a,bias:m,index:x,featureInfo:_},[P,N]=this.addGeometry(i,this.elevationBufferData,A);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:P,max:N}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,P),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,N))}addGeometry(i,a,h){let m=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,_=null;h&&(_=h.elevationSampler.constantElevation(h.elevation,h.bias),_!=null&&(m=_,x=_));const A=(P,N,V)=>{if(h!=null)if(N.push(P),_!=null)a.elevatedLayoutVertexArray.emplaceBack(_),V.push(_);else{const H=h.elevationSampler.pointElevation(P,h.elevation,h.bias);a.elevatedLayoutVertexArray.emplaceBack(H),V.push(H),m=Math.min(m,H),x=Math.max(x,H)}};for(const P of i){let N=0;for(const Te of P)N+=Te.length;const V=a.triangleSegments.prepareSegment(N,a.layoutVertexArray,a.indexArray),H=V.vertexLength,G=[],Y=[],J=[],oe=[],ue=[],pe=a.layoutVertexArray.length;for(const Te of P){if(Te.length===0)continue;Te!==P[0]&&Y.push(G.length/2);const Ie=a.lineSegments.prepareSegment(Te.length,a.layoutVertexArray,a.lineIndexArray),Ze=Ie.vertexLength;h&&ue.push(a.layoutVertexArray.length-pe),A(Te[0],J,oe),a.layoutVertexArray.emplaceBack(Te[0].x,Te[0].y),a.lineIndexArray.emplaceBack(Ze+Te.length-1,Ze),G.push(Te[0].x),G.push(Te[0].y);for(let Ve=1;Ve<Te.length;Ve++)A(Te[Ve],J,oe),a.layoutVertexArray.emplaceBack(Te[Ve].x,Te[Ve].y),a.lineIndexArray.emplaceBack(Ze+Ve-1,Ze+Ve),G.push(Te[Ve].x),G.push(Te[Ve].y);Ie.vertexLength+=Te.length,Ie.primitiveLength+=Te.length}const we=m_(G,Y);for(let Te=0;Te<we.length;Te+=3)a.indexArray.emplaceBack(H+we[Te],H+we[Te+1],H+we[Te+2]);if(we.length>0&&h&&this.elevationMode==="hd-road-base"){const Te=h.elevation.isTunnel(),Ie=h.elevation.safeArea,Ze=this.elevatedStructures.addVertices(J,oe);this.elevatedStructures.addTriangles(we,Ze,Te);const Ve=ue.length;if(Ve>0){for(let Ye=0;Ye<Ve-1;Ye++)this.elevatedStructures.addRenderableRing(h.index,ue[Ye]+Ze,ue[Ye+1]-ue[Ye],Te,Ie,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,ue[Ve-1]+Ze,J.length-ue[Ve-1],Te,Ie,h.featureInfo)}}V.vertexLength+=N,V.primitiveLength+=we.length/3}return[m,x]}prepareElevatedPolygons(i,a,h){const m=1/Qe(h),x=[];for(const _ of i){const A=iX(_,new os(a,m));x.push(...A)}return x}clipPolygonsToTile(i,a){const h=-a,m=-a,x=xn+a,_=xn+a;let A=0;const P=[],N=[];for(;A<i.length;A++){const G=i[A],Y=Ru(G);(Y.min.x>=h&&Y.max.x<=x&&Y.min.y>=m&&Y.max.y<=_?P:N).push(G)}if(P.length===i.length)return i;const V=[new Ht(h,m),new Ht(x,m),new Ht(x,_),new Ht(h,_),new Ht(h,m)],H=P;for(const G of N)H.push(...rX(G,V));return H}}let y4,x4,_4,v4;Fn(d3,"FillBucket",{omit:["layers","patternFeatures"]}),Fn(u3,"FillBufferData"),Fn(Pc,"ElevatedStructures");class F2{constructor(i,a,h,m){if(this.triangleCount=a.length/3,this.min=new Ht(0,0),this.max=new Ht(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[x,_]=[i[0].clone(),i[0].clone()];for(let H=1;H<i.length;++H){const G=i[H];x.x=Math.min(x.x,G.x),x.y=Math.min(x.y,G.y),_.x=Math.max(_.x,G.x),_.y=Math.max(_.y,G.y)}if(m){const H=Math.ceil(Math.max(_.x-x.x,_.y-x.y)/m);h=Math.max(h,H)}if(h===0)return;this.min=x,this.max=_;const A=this.max.sub(this.min);A.x=Math.max(A.x,1),A.y=Math.max(A.y,1);const P=Math.max(A.x,A.y)/h;this.cellsX=Math.max(1,Math.ceil(A.x/P)),this.cellsY=Math.max(1,Math.ceil(A.y/P)),this.xScale=1/P,this.yScale=1/P;const N=[];for(let H=0;H<this.triangleCount;H++){const G=i[a[3*H+0]].sub(this.min),Y=i[a[3*H+1]].sub(this.min),J=i[a[3*H+2]].sub(this.min),oe=rp(Math.floor(Math.min(G.x,Y.x,J.x)),this.xScale,this.cellsX),ue=rp(Math.floor(Math.max(G.x,Y.x,J.x)),this.xScale,this.cellsX),pe=rp(Math.floor(Math.min(G.y,Y.y,J.y)),this.yScale,this.cellsY),we=rp(Math.floor(Math.max(G.y,Y.y,J.y)),this.yScale,this.cellsY),Te=new Ht(0,0),Ie=new Ht(0,0),Ze=new Ht(0,0),Ve=new Ht(0,0);for(let Ye=pe;Ye<=we;++Ye){Te.y=Ie.y=Ye*P,Ze.y=Ve.y=(Ye+1)*P;for(let nt=oe;nt<=ue;++nt)Te.x=Ze.x=nt*P,Ie.x=Ve.x=(nt+1)*P,(Xs(G,Y,J,Te,Ie,Ve)||Xs(G,Y,J,Te,Ve,Ze))&&N.push({cellIdx:Ye*this.cellsX+nt,triIdx:H})}}if(N.length===0)return;N.sort(((H,G)=>H.cellIdx-G.cellIdx||H.triIdx-G.triIdx));let V=0;for(;V<N.length;){const H=N[V].cellIdx,G={start:this.payload.length,len:0};for(;V<N.length&&N[V].cellIdx===H;)++G.len,this.payload.push(N[V++].triIdx);this.cells[H]=G}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const h=rp(i.x-this.min.x,this.xScale,this.cellsX),m=rp(i.y-this.min.y,this.yScale,this.cellsY),x=this.cells[m*this.cellsX+h];if(x){this._lazyInitLookup();for(let _=0;_<x.len;_++){const A=this.payload[x.start+_],P=Math.floor(A/8),N=1<<A%8;if(!(this.lookup[P]&N)&&(this.lookup[P]|=N,a.push(A),a.length===this.triangleCount))return}}}query(i,a,h){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const m=rp(i.x-this.min.x,this.xScale,this.cellsX),x=rp(a.x-this.min.x,this.xScale,this.cellsX),_=rp(i.y-this.min.y,this.yScale,this.cellsY),A=rp(a.y-this.min.y,this.yScale,this.cellsY);for(let P=_;P<=A;P++)for(let N=m;N<=x;N++){const V=this.cells[P*this.cellsX+N];if(V)for(let H=0;H<V.len;H++){const G=this.payload[V.start+H],Y=Math.floor(G/8),J=1<<G%8;if(!(this.lookup[Y]&J)&&(this.lookup[Y]|=J,h.push(G),h.length===this.triangleCount))return}}}}function rp(c,i,a){return Math.max(0,Math.min(a-1,Math.floor(c*i)))}Fn(F2,"TriangleGridIndex");class b4{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.footprints=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){for(const h of this.footprints)a.push({footprint:h,id:i})}updateAppearances(i,a,h,m){}populate(i,a,h,m){const x=[];for(const{feature:_,id:A,index:P,sourceLayerIndex:N}of i){const V=this.layers[0]._featureFilter.needGeometry,H=Mt(_,V);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),H,h))continue;const G={id:A,properties:_.properties,type:_.type,sourceLayerIndex:N,index:P,geometry:V?H.geometry:zt(_,h,m),patterns:{}};x.push(G)}for(const _ of x){const{geometry:A,index:P,sourceLayerIndex:N}=_;this.addFeature(_,A,P,h,{},a.availableImages,a.brightness),a.featureIndex.insert(i[P].feature,A,P,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,h,m,x,_,A){}destroy(){}addFeature(i,a,h,m,x,_=[],A){for(const P of Bb(a,2)){const N=[],V=[],H=[],G=new Ht(1/0,1/0),Y=new Ht(-1/0,-1/0);for(const ue of P)if(ue.length!==0){ue!==P[0]&&H.push(V.length/2);for(let pe=0;pe<ue.length;pe++)V.push(ue[pe].x),V.push(ue[pe].y),N.push(ue[pe]),G.x=Math.min(G.x,ue[pe].x),G.y=Math.min(G.y,ue[pe].y),Y.x=Math.max(Y.x,ue[pe].x),Y.y=Math.max(Y.y,ue[pe].y)}const J=m_(V,H),oe=new F2(N,J,8,256);this.footprints.push({vertices:N,indices:J,grid:oe,min:G,max:Y})}}}Fn(b4,"ClipBucket",{omit:["layers"]});const sX=di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),oX=di([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),aX=di([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),lX=di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cX=di([{name:"a_join_normal_inside",components:3,type:"Int16"}]),uX=di([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),dX=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:hX}=sX,zb=Number.MAX_SAFE_INTEGER,w4=zb-1;function S4(c,i,a,h){return c.order<i||c.order===zb||!(c.clipMask&a)||(function(m,x){return x.length!==0&&x.find((_=>_===m))===void 0})(h,c.clipScope)}function B2(c,i){return c.x-i.x||c.y-i.y}function T4(c,i){return B2(c.min,i.min)===0&&B2(c.max,i.max)===0}function h3(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function z2(c,i){if(c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==i[a].sourceId||!T4(c[a],i[a])||c[a].order!==i[a].order||c[a].clipMask!==i[a].clipMask||!cs(c[a].clipScope,i[a].clipScope))return!1;return!0}function E4(c,i,a){const h=1/xn,m=1/(1<<a.canonical.z),x=(i.x*h+a.canonical.x)*m+a.wrap,_=(i.y*h+a.canonical.y)*m;return{min:new Ht((c.x*h+a.canonical.x)*m+a.wrap,(c.y*h+a.canonical.y)*m),max:new Ht(x,_)}}function fX(c,i,a){const h=1<<a.canonical.z,m=((i.x-a.wrap)*h-a.canonical.x)*xn,x=(i.y*h-a.canonical.y)*xn;return{min:new Ht(((c.x-a.wrap)*h-a.canonical.x)*xn,(c.y*h-a.canonical.y)*xn),max:new Ht(m,x)}}function f3(c,i,a,h,m,x,_){const A=c.indices,P=c.vertices,N=[];for(let V=h;V<h+m;V+=3){const H=i[a[V+0]+x],G=i[a[V+1]+x],Y=i[a[V+2]+x],J=Math.min(H.x,G.x,Y.x),oe=Math.max(H.x,G.x,Y.x),ue=Math.min(H.y,G.y,Y.y),pe=Math.max(H.y,G.y,Y.y);N.length=0,c.grid.query(new Ht(J,ue),new Ht(oe,pe),N);for(let we=0;we<N.length;we++){const Te=N[we];if(Xs(P[A[3*Te+0]],P[A[3*Te+1]],P[A[3*Te+2]],H,G,Y,_))return!0}}return!1}function A4(c,i,a,h){if(!c||!a)return!1;let m=c.vertices;if(!i.canonical.equals(h.canonical)||i.wrap!==h.wrap){if(a.vertices.length<c.vertices.length)return A4(a,h,c,i);const x=i.canonical,_=h.canonical,A=Math.pow(2,_.z-x.z);m=c.vertices.map((P=>new Ht((P.x+x.x*xn)*A-_.x*xn,(P.y+x.y*xn)*A-_.y*xn)))}return f3(a,m,c.indices,0,c.indices.length,0,0)}function C4(c,i,a,h){const m=Math.pow(2,h.z-a.z);return new Ht((c+a.x*xn)*m-h.x*xn,(i+a.y*xn)*m-h.y*xn)}function p3(c,i){const a=[];i.grid.queryPoint(c,a);const h=i.indices,m=i.vertices;for(let x=0;x<a.length;x++){const _=a[x];if(_o([m[h[3*_+0]],m[h[3*_+1]],m[h[3*_+2]]],c))return!0}return!1}const m3=[new Ht(0,0),new Ht(xn,0),new Ht(xn,xn),new Ht(0,xn)];function M4(c,i){const a=[];let h=[];if(!i||c.length<2)return[c];if(c.length===2)return Fs(c[0],c[1],m3)?[c]:[];for(let m=0;m<c.length+2;m++){const x=c[m%c.length],_=c[(m+1)%c.length],A=Fs(m===0?c[c.length-1]:c[(m-1)%c.length],x,m3),P=Fs(x,_,m3),N=A||P;N&&h.push(x),N&&P||h.length>0&&(h.length>1&&a.push(h),h=[])}return h.length>1&&a.push(h),a}const g3=Jt.types,pX=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],mX=["fill-extrusion-flood-light-ground-radius"],gX=Math.pow(2,13),yX=Math.pow(2,15)-1,k4=new Ht(0,1),e0=2147483648,I4=7,P4=450;function Ub(c,i,a,h,m,x,_,A){c.emplaceBack((i<<1)+_,(a<<1)+x,(Math.floor(h*gX)<<1)+m,Math.round(A))}function Vb(c,i,a){c.emplaceBack(i.x*xn,i.y*xn,a?1:0)}function U2(c,i,a,h,m,x){c.emplaceBack(i.x,i.y,(a.x<<1)+h,(a.y<<1)+m,x)}function Hb(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class R4{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class N4{constructor(){this.centroidXY=new Ht(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ht(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ht(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ht(this.max.x-this.min.x,this.max.y-this.min.y)}}class j4{constructor(){this.acc=new Ht(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,h){this.accCount++,this.acc._add(a);let m=!!this.borders;a.x<i.min.x?(i.min.x=a.x,m=!0):a.x>i.max.x&&(i.max.x=a.x,m=!0),a.y<i.min.y?(i.min.y=a.y,m=!0):a.y>i.max.y&&(i.max.y=a.y,m=!0),((a.x===0||a.x===xn)&&a.x===h.x)!=((a.y===0||a.y===xn)&&a.y===h.y)&&this.processBorderOverlap(a,h),m&&this.checkBorderIntersection(a,h)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,Ar(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>xn!=i.x>xn&&this.addBorderIntersection(1,Ar(a.y,i.y,(xn-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Ar(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>xn!=i.y>xn&&this.addBorderIntersection(3,Ar(a.x,i.x,(xn-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,i.x)}}centroid(){return this.accCount===0?new Ht(0,0):new Ht(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((i,a)=>i+ +(a[0]!==Number.MAX_VALUE)),0):0}}function D4(c,i){const a=c.add(i)._unit(),h=ve(c.x*a.x+c.y*a.y,-1,1);var m,x,_;return m=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(m)))/4*yX*((x=c).x*(_=i).y-x.y*_.x<0?-1:1)}const xX=[c=>c.x<0,c=>c.x>xn,c=>c.y<0,c=>c.y>xn];function _X(c,i,a,h){const m=[4];if(h===0)return m;a._mult(h);const x=c.sub(a),_=i.sub(a),A=[c,i,x,_];for(let P=0;P<4;P++)for(const N of A)if(xX[P](N)){m.push(P);break}return m}class y3{constructor(i){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new dm,this.indexArray=new ys,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut},(a=>mX.includes(a))),this._segments=new Li,this.hiddenByLandmarkVertexArray=new Hh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Li}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,h,m=!1){const x=i.length;if(x>2){let _=Math.max(0,this._segments.get().length-1);const A=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let P;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const N=i[0],V=i[1];P=D4(N.sub(i[x-1])._perp()._unit(),V.sub(N)._perp()._unit())}for(let N=0;N<x;N++){const V=N===x-1?0:N+1,H=i[N],G=i[V],Y=i[V===x-1?0:V+1],J=G.sub(H)._perp()._unit(),oe=D4(J,Y.sub(G)._perp()._unit()),ue=P,pe=oe;if(x3(H,G,a)||m&&F4(H,a)&&F4(G,a)){P=oe;continue}const we=A.vertexLength;U2(this.vertexArray,H,G,1,1,ue),U2(this.vertexArray,H,G,1,0,ue),U2(this.vertexArray,H,G,0,1,pe),U2(this.vertexArray,H,G,0,0,pe),A.vertexLength+=4;const Te=_X(H,G,J,h);for(const Ie of Te)this._segmentToGroundQuads[_].push({id:we,region:Ie}),this._segmentToRegionTriCounts[_][Ie]+=2,A.primitiveLength+=2;P=oe}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let h=0;h<a;h++)this._segmentToGroundQuads[h].sort(((m,x)=>m.region-x.region));for(let h=0;h<a;h++){const m=this._segmentToGroundQuads[h],x=i[h],_=this._segmentToRegionTriCounts[h];_.reduce(((P,N)=>P+N),0);let A=0;for(let P=0;P<=4;P++){const N=_[P];if(N!==0){let V=this.regionSegments[P];V||(V=this.regionSegments[P]=new Li);const H={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+A,vertexLength:x.vertexLength,primitiveLength:N};V.get().push(H)}A+=N}for(let P=0;P<m.length;P++){const N=m[P].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,h,m,x,_,A){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,h,m,x,_,void 0,A)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,oX.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=i.createVertexBuffer(this.groundRadiusArray,aX.members)))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,h,m,x,_,A,P){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,h,m,x,_,A,P)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&e0))}updateHiddenByLandmarkRange(i,a,h){if(!this.hasData())return;const m=a+i;if(a!==0){for(let x=i;x<m;++x)this.hiddenByLandmarkVertexArray.emplace(x,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,uX.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class V2{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ys,this.footprintVertices=new $a,this.footprintSegments=[],this.layoutVertexArray=new Ea,this.centroidVertexArray=new wy,this.wallVertexArray=new ma,this.indexArray=new ys,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut},(a=>pX.includes(a))),this.segments=new Li,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.groundEffect=new y3(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,h,m){}populate(i,a,h,m){this.features=[],this.hasPattern=a3("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Qe(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:_,index:A,sourceLayerIndex:P}of i){const N=this.layers[0]._featureFilter.needGeometry,V=Mt(x,N);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),V,h))continue;const H={id:_,sourceLayerIndex:P,index:A,geometry:N?V.geometry:zt(x,h,m),properties:x.properties,type:x.type,patterns:{}},G=this.layoutVertexArray.length,Y=g3[H.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:x.id,feature:l3("fill-extrusion",this.layers,H,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const J of H.geometry)for(const oe of M4(J,Y))this.addFeature(x.id,H,[oe],A,h,{},a.availableImages,m,a.brightness);else this.addFeature(x.id,H,H.geometry,A,h,{},a.availableImages,m,a.brightness);a.featureIndex.insert(x,H.geometry,A,P,this.index,G)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,h,m,x,_){for(const{featureId:A,feature:P}of this.features){const N=g3[P.type]==="Polygon",{geometry:V}=P;if(this.wallMode)for(const H of V)for(const G of M4(H,N))this.addFeature(A,P,[G],P.index,a,h,m,x,_);else this.addFeature(A,P,V,P.index,a,h,m,x,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,h,m,x,_,A){this.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,this.worldview),this.groundEffect.update(i,a,x,h,m,_,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hX),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,cX.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,dX.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,lX.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,h,m,x,_,A,P,N){const V=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,H=[new Ht(0,0),new Ht(xn,xn)],G=P.projection,Y=G.name==="globe",J=this.wallMode||g3[a.type]==="Polygon",oe=new j4;oe.centroidDataIndex=this.centroidData.length;const ue=new N4;ue.buildingId=i,a.properties&&a.properties.hasOwnProperty("building_id")&&(ue.buildingId=a.properties.building_id);const pe=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},x)<=0,we=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},x);let Te;if(ue.height=we,ue.vertexArrayOffset=this.layoutVertexArray.length,ue.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new $f),this.wallMode){if(Y)return void It("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;Te=(function(pt){const Ut=pt[0].x===pt[pt.length-1].x&&pt[0].y===pt[pt.length-1].y;(function(jn){let Mn=0;const Fr=jn.length;for(let Rn=0;Rn<Fr;Rn++)Mn+=(jn[(Rn+1)%Fr].x-jn[Rn].x)*(jn[(Rn+1)%Fr].y+jn[Rn].y);return Mn>=0})(pt)||(pt=pt.reverse());const en={geometry:[],joinNormals:[],indices:[]},vn=[],an=[],Qt=[];let sn=pt.length;for(;sn>=2&&pt[sn-1].equals(pt[sn-2]);)sn--;if(sn<(Ut?3:2))return en;let jt,Rt,nn,gn,Yt,zn=0;for(;zn<sn-1&&pt[zn].equals(pt[zn+1]);)zn++;Ut&&(jt=pt[sn-2],Yt=pt[zn].sub(jt)._unit()._perp());for(let jn=zn;jn<sn;jn++){if(nn=jn===sn-1?Ut?pt[zn+1]:void 0:pt[jn+1],nn&&pt[jn].equals(nn))continue;Yt&&(gn=Yt),jt&&(Rt=jt),jt=pt[jn],Yt=nn?nn.sub(jt)._unit()._perp():gn,gn=gn||Yt;let Mn=gn.add(Yt);Mn.x===0&&Mn.y===0||Mn._unit();const Fr=Mn.x*Yt.x+Mn.y*Yt.y,Rn=Fr!==0?1/Fr:1/0,br=gn.x*Yt.y-gn.y*Yt.x>0;let Ur="miter";const fi=2;Ur==="miter"&&Rn>fi&&(Ur="bevel"),Ur==="bevel"&&(Rn>100&&(Ur="flipbevel"),Rn<fi&&(Ur="miter"));const Pi=(Wr,Vi,Hi,Ds)=>{const Ge=new Ht(Wr.x,Wr.y),Be=new Ht(Wr.x,Wr.y);Ge.x+=Vi.x*Ds,Ge.y+=Vi.y*Ds,Be.x-=Vi.x*Math.max(Hi,1),Be.y-=Vi.y*Math.max(Hi,1),Qt.push(Vi),vn.push(Ge),an.push(Be)};if(Ur==="miter")Mn._mult(Rn),Pi(jt,Mn,0,0);else if(Ur==="flipbevel")Mn=Yt.mult(-1),Pi(jt,Mn,0,0),Pi(jt,Mn.mult(-1),0,0);else{const Wr=-Math.sqrt(Rn*Rn-1),Vi=br?Wr:0,Hi=br?0:Wr;Rt&&Pi(jt,gn,Vi,Hi),nn&&Pi(jt,Yt,Vi,Hi)}}en.geometry=[...vn,...an.reverse(),vn[0]],en.joinNormals=[...Qt,...Qt.reverse(),Qt[Qt.length-1]];const Zn=en.geometry.length-1;for(let jn=0;jn<Zn/2;jn++)if(jn+1<Zn/2){let Mn=jn,Fr=jn+1,Rn=Zn-1-jn,br=Zn-2-jn;Mn=Mn===0?Zn-1:Mn-1,Fr=Fr===0?Zn-1:Fr-1,Rn=Rn===0?Zn-1:Rn-1,br=br===0?Zn-1:br-1,en.indices.push(Rn),en.indices.push(Fr),en.indices.push(Mn),en.indices.push(Rn),en.indices.push(br),en.indices.push(Fr)}return en})(h[0]),h=[Te.geometry]}const Ie=(pt,Ut)=>pt<(Ut.length-1)/2||pt===Ut.length-1,Ze=this.wallMode?[h]:Bb(h,500);for(let pt=Ze.length-1;pt>=0;pt--){const Ut=Ze[pt];(Ut.length===0||(Ve=Ut[0]).every((Zt=>Zt.x<=0))||Ve.every((Zt=>Zt.x>=xn))||Ve.every((Zt=>Zt.y<=0))||Ve.every((Zt=>Zt.y>=xn)))&&Ze.splice(pt,1)}var Ve;let Ye;if(Y)Ye=V4(Ze,H,x);else{Ye=[];for(const pt of Ze)Ye.push({polygon:pt,bounds:H})}const nt=J?this.edgeRadius:0,ot=nt>0&&this.zoom<17,Ot=(pt,Ut)=>{if(pt.length===0)return!1;const Zt=pt[pt.length-1];return Ut.x===Zt.x&&Ut.y===Zt.y};for(const{polygon:pt,bounds:Ut}of Ye){let Zt=0,en=0;for(const sn of pt)J&&!sn[0].equals(sn[sn.length-1])&&sn.push(sn[0]),en+=J?sn.length-1:sn.length;const vn=this.segments.prepareSegment((J?5:4)*en,this.layoutVertexArray,this.indexArray);ue.footprintSegIdx<0&&(ue.footprintSegIdx=this.footprintSegments.length),ue.polygonSegIdx<0&&(ue.polygonSegIdx=this.polygonSegments.length);const an={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Qt=new R4;if(Qt.vertexOffset=this.footprintVertices.length,Qt.indexOffset=3*this.footprintIndices.length,Qt.ringIndices=[],J){const sn=[],jt=[];Zt=vn.vertexLength;for(let nn=0;nn<pt.length;nn++){const gn=pt[nn];gn.length&&nn!==0&&jt.push(sn.length/2);const Yt=[];let zn,Zn;zn=gn[1].sub(gn[0])._perp()._unit(),Qt.ringIndices.push(gn.length-1);for(let jn=1;jn<gn.length;jn++){const Mn=gn[jn],Fr=gn[jn===gn.length-1?1:jn+1],Rn=Mn.clone();if(nt){Zn=Fr.sub(Mn)._perp()._unit();const br=zn.add(Zn)._unit(),Ur=nt*Math.min(4,1/(zn.x*br.x+zn.y*br.y));Rn.x+=Ur*br.x,Rn.y+=Ur*br.y,Rn.x=Math.round(Rn.x),Rn.y=Math.round(Rn.y),zn=Zn}if(!pe||nt!==0&&!ot||Ot(Yt,Rn)||Yt.push(Rn),Ub(this.layoutVertexArray,Rn.x,Rn.y,0,0,1,1,0),this.wallMode){const br=Ie(jn,gn);Vb(this.wallVertexArray,Te.joinNormals[jn],!br)}vn.vertexLength++,this.footprintVertices.emplaceBack(Mn.x,Mn.y),sn.push(Mn.x,Mn.y),Y&&Hb(this.layoutVertexExtArray,G.projectTilePoint(Rn.x,Rn.y,x),G.upVector(x,Rn.x,Rn.y))}pe&&(nt===0||ot)&&(Yt.length!==0&&Ot(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,Ut,V))}const Rt=this.wallMode?Te.indices:m_(sn,jt);for(let nn=0;nn<Rt.length;nn+=3)this.footprintIndices.emplaceBack(Qt.vertexOffset+Rt[nn+0],Qt.vertexOffset+Rt[nn+1],Qt.vertexOffset+Rt[nn+2]),this.indexArray.emplaceBack(Zt+Rt[nn],Zt+Rt[nn+2],Zt+Rt[nn+1]),vn.primitiveLength++;Qt.indexCount+=Rt.length,Qt.vertexCount+=this.footprintVertices.length-Qt.vertexOffset}for(let sn=0;sn<pt.length;sn++){const jt=pt[sn];oe.startRing(ue,jt[0]);let Rt=jt.length>4&&B4(jt[jt.length-2],jt[0],jt[1]),nn=nt?vX(jt[jt.length-2],jt[0],jt[1],nt):0;const gn=[];let Yt,zn,Zn;zn=jt[1].sub(jt[0])._perp()._unit();let jn=!0;for(let Mn=1,Fr=0;Mn<jt.length;Mn++){let Rn=jt[Mn-1],br=jt[Mn];const Ur=jt[Mn===jt.length-1?1:Mn+1];if(oe.appendEdge(ue,br,Rn),x3(br,Rn,Ut)){nt&&(zn=Ur.sub(br)._perp()._unit(),jn=!jn);continue}const fi=br.sub(Rn)._perp(),Pi=fi.x/(Math.abs(fi.x)+Math.abs(fi.y)),Wr=fi.y>0?1:0,Vi=Rn.dist(br);if(Fr+Vi>32768&&(Fr=0),nt){Zn=Ur.sub(br)._perp()._unit();let Be=O4(Rn,br,Ur,L4(zn,Zn),nt);isNaN(Be)&&(Be=0);const $t=br.sub(Rn)._unit();Rn=Rn.add($t.mult(nn))._round(),br=br.add($t.mult(-Be))._round(),nn=Be,zn=Zn,pe&&this.zoom>=17&&(Ot(gn,Rn)||gn.push(Rn),Ot(gn,br)||gn.push(br))}const Hi=vn.vertexLength,Ds=jt.length>4&&B4(Rn,br,Ur);let Ge=z4(Fr,Rt,jn);if(Ub(this.layoutVertexArray,Rn.x,Rn.y,Pi,Wr,0,0,Ge),Ub(this.layoutVertexArray,Rn.x,Rn.y,Pi,Wr,0,1,Ge),this.wallMode){const Be=Ie(Mn-1,jt),$t=Te.joinNormals[Mn-1];Vb(this.wallVertexArray,$t,Be),Vb(this.wallVertexArray,$t,Be)}if(Fr+=Vi,Ge=z4(Fr,Ds,!jn),Rt=Ds,Ub(this.layoutVertexArray,br.x,br.y,Pi,Wr,0,0,Ge),Ub(this.layoutVertexArray,br.x,br.y,Pi,Wr,0,1,Ge),this.wallMode){const Be=Ie(Mn,jt),$t=Te.joinNormals[Mn];Vb(this.wallVertexArray,$t,Be),Vb(this.wallVertexArray,$t,Be)}if(vn.vertexLength+=4,this.indexArray.emplaceBack(Hi+0,Hi+1,Hi+2),this.indexArray.emplaceBack(Hi+1,Hi+3,Hi+2),vn.primitiveLength+=2,nt){const Be=Zt+(Mn===1?jt.length-2:Mn-2),$t=Mn===1?Zt:Be+1;if(this.indexArray.emplaceBack(Hi+1,Be,Hi+3),this.indexArray.emplaceBack(Be,$t,Hi+3),vn.primitiveLength+=2,Yt===void 0&&(Yt=Hi),!x3(Ur,jt[Mn],Ut)){const An=Mn===jt.length-1?Yt:vn.vertexLength;this.indexArray.emplaceBack(Hi+2,Hi+3,An),this.indexArray.emplaceBack(Hi+3,An+1,An),this.indexArray.emplaceBack(Hi+3,$t,An+1),vn.primitiveLength+=3}jn=!jn}if(Y){const Be=this.layoutVertexExtArray,$t=G.projectTilePoint(Rn.x,Rn.y,x),An=G.projectTilePoint(br.x,br.y,x),Wt=G.upVector(x,Rn.x,Rn.y),kn=G.upVector(x,br.x,br.y);Hb(Be,$t,Wt),Hb(Be,$t,Wt),Hb(Be,An,kn),Hb(Be,An,kn)}}J&&(Zt+=jt.length-1),pe&&nt&&this.zoom>=17&&(gn.length!==0&&Ot(gn,gn[0])&&gn.pop(),this.groundEffect.addData(gn,Ut,V,nt>0))}this.footprintSegments.push(Qt),an.triangleCount=this.indexArray.length-an.triangleArrayOffset,this.polygonSegments.push(an),++ue.footprintSegLen,++ue.polygonSegLen}if(ue.vertexCount=this.layoutVertexArray.length-ue.vertexArrayOffset,ue.groundVertexCount=this.groundEffect.vertexArray.length-ue.groundVertexArrayOffset,ue.vertexCount!==0){if(ue.centroidXY=oe.borders?k4:this.encodeCentroid(oe,ue),this.centroidData.push(ue),oe.borders){this.featuresOnBorder.push(oe);const pt=this.featuresOnBorder.length-1;for(let Ut=0;Ut<oe.borders.length;Ut++)oe.borders[Ut][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ut].push(pt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,_,A,x,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,m,_,A,x,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,we)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort(((a,h)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[h].borders[i][0]))}splitToSubtiles(){const i=[];for(let A=0;A<this.centroidData.length;A++){const P=this.centroidData[A],N=+(P.min.y+P.max.y>xn),V=2*N+(+(P.min.x+P.max.x>xn)^N);for(let H=0;H<P.polygonSegLen;H++){const G=P.polygonSegIdx+H;i.push({centroidIdx:A,subtile:V,polygonSegmentIdx:G,triangleSegmentIdx:this.polygonSegments[G].triangleSegIdx})}}const a=new ys;i.sort(((A,P)=>A.triangleSegmentIdx===P.triangleSegmentIdx?A.subtile-P.subtile:A.triangleSegmentIdx-P.triangleSegmentIdx));let h=0,m=0,x=0;for(const A of i){if(A.triangleSegmentIdx!==h)break;x++}const _=i.length;for(;m!==i.length;){h=i[m].triangleSegmentIdx;let A=0,P=m,N=m;for(let V=P;V<x&&i[V].subtile===A;V++)N++;for(;P!==x;){const V=i[P];A=V.subtile;const H=this.centroidData[V.centroidIdx].min.clone(),G=this.centroidData[V.centroidIdx].max.clone(),Y={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let J=P;J<N;J++){const oe=i[J],ue=this.polygonSegments[oe.polygonSegmentIdx],pe=this.centroidData[oe.centroidIdx].min,we=this.centroidData[oe.centroidIdx].max,Te=this.indexArray.uint16;for(let Ie=ue.triangleArrayOffset;Ie<ue.triangleArrayOffset+ue.triangleCount;Ie++)a.emplaceBack(Te[3*Ie],Te[3*Ie+1],Te[3*Ie+2]);Y.primitiveLength+=ue.triangleCount,H.x=Math.min(H.x,pe.x),H.y=Math.min(H.y,pe.y),G.x=Math.max(G.x,we.x),G.y=Math.max(G.y,we.y)}Y.primitiveLength>0&&this.triangleSubSegments.push({segment:Y,min:H,max:G}),P=N;for(let J=P;J<x&&i[J].subtile===i[P].subtile;J++)N++}m=x;for(let V=m;V<_&&i[V].triangleSegmentIdx===i[m].triangleSegmentIdx;V++)x++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,h){const m=new Li;if(this.wallMode){for(const oe of this.triangleSubSegments)m.segments.push(oe.segment);return m}let x=0,_=0;const A=1<<i.canonical.z;if(a){const oe=a.getMinMaxForTile(i);oe&&(x=oe.min,_=oe.max)}_+=this.maxHeight;const P=i.toUnwrapped();let N;const V=[P.canonical.x/A+P.wrap,P.canonical.y/A],H=[(P.canonical.x+1)/A+P.wrap,(P.canonical.y+1)/A],G=(oe,ue,pe)=>[oe[0]*(1-pe[0])+ue[0]*pe[0],oe[1]*(1-pe[1])+ue[1]*pe[1]],Y=[],J=[];for(const oe of this.triangleSubSegments){Y[0]=oe.min.x/xn,Y[1]=oe.min.y/xn,J[0]=oe.max.x/xn,J[1]=oe.max.y/xn;const ue=G(V,H,Y),pe=G(V,H,J);if(new Gr([ue[0],ue[1],x],[pe[0],pe[1],_]).intersectsPrecise(h)===0){N&&(m.segments.push(N),N=void 0);continue}const we=oe.segment;N&&N.vertexOffset!==we.vertexOffset&&(m.segments.push(N),N=void 0),N?(N.vertexLength+=we.vertexLength,N.primitiveLength+=we.primitiveLength):N={vertexOffset:we.vertexOffset,primitiveLength:we.primitiveLength,vertexLength:we.vertexLength,primitiveOffset:we.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&m.segments.push(N),m}encodeCentroid(i,a){const h=i.centroid(),m=a.span(),x=Math.min(7,Math.round(m.x*this.tileToMeter/10)),_=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new Ht(ve(h.x,1,xn-1)<<3|x,ve(h.y,1,xn-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new Ht(0,0);const a=i.borders,h=Number.MAX_VALUE;if(a[0][0]!==h||a[1][0]!==h){const m=a[0][0]!==h?0:1;return new Ht(6|(a[0][0]!==h?0:65528),(a[m][0]+a[m][1])/2<<3|6)}{const m=a[2][0]!==h?2:3;return new Ht((a[m][0]+a[m][1])/2<<3|6,6|(a[2][0]!==h?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,h=i.vertexCount+i.vertexArrayOffset,m=i.flags&e0?k4:i.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==m.y||x!==m.x){for(let _=a;_<h;++_)this.centroidVertexArray.emplace(_,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const m=a.getReplacementRegionsForTile(i.toUnwrapped());if(z2(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const x=[];for(const _ of this.activeReplacements){if(_.order<h)continue;const A=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingId){const P=_.footprint.buildingId;for(const N of this.centroidData)N.buildingId===P&&(N.flags|=e0)}else for(const P of this.centroidData)if(!(P.flags&e0||_.min.x>P.max.x||P.min.x>_.max.x||_.min.y>P.max.y||P.min.y>_.max.y))for(let N=0;N<P.footprintSegLen;N++){const V=this.footprintSegments[P.footprintSegIdx+N];if(x.length=0,bX(this.footprintVertices,V.vertexOffset,V.vertexCount,_.footprintTileId.canonical,i.canonical,x),f3(_.footprint,x,this.footprintIndices.uint16,V.indexOffset,V.indexCount,-V.vertexOffset,-A)){P.flags|=e0;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,h){let m=!1;for(let x=0;x<h.footprintSegLen;x++){const _=this.footprintSegments[h.footprintSegIdx+x];let A=0;for(const P of _.ringIndices){for(let N=A,V=P+A-1;N<P+A;V=N++){const H=this.footprintVertices.int16[2*(N+_.vertexOffset)+0],G=this.footprintVertices.int16[2*(N+_.vertexOffset)+1],Y=this.footprintVertices.int16[2*(V+_.vertexOffset)+1];G>a!=Y>a&&i<(this.footprintVertices.int16[2*(V+_.vertexOffset)+0]-H)*(a-G)/(Y-G)+H&&(m=!m)}A=P}}return m}getHeightAtTileCoord(i,a){let h=Number.NEGATIVE_INFINITY,m=!0;const x=4*(i+xn)*xn+(a+xn);if(this.partLookup.hasOwnProperty(x)){const _=this.partLookup[x];return _?{height:_.height,hidden:!!(_.flags&e0)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||a>_.max.y||_.min.y>a||_.height<=h||this.footprintContainsPoint(i,a,_)&&(h=_.height,this.partLookup[x]=_,m=!!(_.flags&e0));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:m};this.partLookup[x]=void 0}}function L4(c,i){const a=c.add(i)._unit();return c.x*a.x+c.y*a.y}function vX(c,i,a,h){const m=i.sub(c)._perp()._unit(),x=a.sub(i)._perp()._unit();return O4(c,i,a,L4(m,x),h)}function O4(c,i,a,h,m){const x=Math.sqrt(1-h*h);return Math.min(c.dist(i)/3,i.dist(a)/3,m*x/h)}function x3(c,i,a){return c.x<a[0].x&&i.x<a[0].x||c.x>a[1].x&&i.x>a[1].x||c.y<a[0].y&&i.y<a[0].y||c.y>a[1].y&&i.y>a[1].y}function F4(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function B4(c,i,a){if(c.x<0||c.x>=xn||i.x<0||i.x>=xn||a.x<0||a.x>=xn)return!1;const h=a.sub(i),m=h.perp(),x=c.sub(i);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&m.x*x.x+m.y*x.y<0}function z4(c,i,a){const h=i?2|c:-3&c;return a?1|h:-2&h}function U4(){const c=Math.PI/32,i=Math.tan(c),a=$;return a*Math.sqrt(1+2*i*i)-a}function V4(c,i,a){const h=1<<a.z,m=Pe(a.x/h),x=Pe((a.x+1)/h),_=Ee(a.y/h),A=Ee((a.y+1)/h);return(function(P,N,V,H,G=0,Y){const J=[];if(!P.length||!V||!H)return J;const oe=(Ve,Ye)=>{for(const nt of Ve)J.push({polygon:nt,bounds:Ye})},ue=Math.ceil(Math.log2(V)),pe=Math.ceil(Math.log2(H)),we=ue-pe,Te=[];for(let Ve=0;Ve<Math.abs(we);Ve++)Te.push(we>0?0:1);for(let Ve=0;Ve<Math.min(ue,pe);Ve++)Te.push(0),Te.push(1);let Ie=P;if(Ie=O2(Ie,N[0].y-G,N[1].y+G,1),Ie=O2(Ie,N[0].x-G,N[1].x+G,0),!Ie.length)return J;const Ze=[];for(Te.length?Ze.push({polygons:Ie,bounds:N,depth:0}):oe(Ie,N);Ze.length;){const Ve=Ze.pop(),Ye=Ve.depth,nt=Te[Ye],ot=Ve.bounds[0],Ot=Ve.bounds[1],pt=nt===0?ot.x:ot.y,Ut=nt===0?Ot.x:Ot.y,Zt=Y?Y(nt,pt,Ut):.5*(pt+Ut),en=O2(Ve.polygons,pt-G,Zt+G,nt),vn=O2(Ve.polygons,Zt-G,Ut+G,nt);if(en.length){const an=[ot,new Ht(nt===0?Zt:Ot.x,nt===1?Zt:Ot.y)];Te.length>Ye+1?Ze.push({polygons:en,bounds:an,depth:Ye+1}):oe(en,an)}if(vn.length){const an=[new Ht(nt===0?Zt:ot.x,nt===1?Zt:ot.y),Ot];Te.length>Ye+1?Ze.push({polygons:vn,bounds:an,depth:Ye+1}):oe(vn,an)}}return J})(c,i,Math.ceil((x-m)/11.25),Math.ceil((_-A)/11.25),1,((P,N,V)=>{if(P===0)return .5*(N+V);{const H=Ee((a.y+N/xn)/h);return(_e(.5*(Ee((a.y+V/xn)/h)+H))*h-a.y)*xn}}))}function bX(c,i,a,h,m,x){const _=Math.pow(2,h.z-m.z);for(let A=0;A<a;A++){let P=c.int16[2*(A+i)+0],N=c.int16[2*(A+i)+1];P=(P+m.x*xn)*_-h.x*xn,N=(N+m.y*xn)*_-h.y*xn,x.push(new Ht(P,N))}}let H4,G4;Fn(V2,"FillExtrusionBucket",{omit:["layers","features"]}),Fn(N4,"PartData"),Fn(R4,"FootprintSegment"),Fn(j4,"BorderCentroidData"),Fn(y3,"GroundEffect");class Cy extends Ht{constructor(i,a,h){super(i,a),this.z=h}}class $4 extends Cy{constructor(i,a,h,m){super(i,a,h),this.w=m}}function W4(c,i,a,h){const m=a==="x"?"y":"x",x=(h-c[a])/(i[a]-c[a]);c[m]=Math.round(c[m]+(i[m]-c[m])*x),c[a]=h,c.hasOwnProperty("z")&&(c.z=Ar(c.z,i.z,x)),c.hasOwnProperty("w")&&(c.w=Ar(c.w,i.w,x))}function q4(c,i,a,h){const m=a,x=h;for(const _ of["x","y"]){let A=c,P=i;A[_]>=P[_]&&(A=i,P=c),A[_]<m&&P[_]>m&&W4(A,P,_,m),A[_]<x&&P[_]>x&&W4(P,A,_,x)}}function H2(c,i,a,h,m,x){const _=[];for(let A=0;A<c.length;A++){const P=c[A];let N;const V=_.length;let H=0;for(let G=0;G<P.length-1;G++){let Y=P[G],J=P[G+1],oe=0;const ue=H;let pe,we;x&&(oe=Math.hypot(J.x-Y.x,J.y-Y.y),H+=oe,pe=Y,we=J),Y.x<i&&J.x<i||(Y.x<i?Y=new Ht(i,Y.y+(i-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x<i&&(J=new Ht(i,Y.y+(i-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y<a&&J.y<a||(Y.y<a?Y=new Ht(Y.x+(a-Y.y)/(J.y-Y.y)*(J.x-Y.x),a)._round():J.y<a&&(J=new Ht(Y.x+(a-Y.y)/(J.y-Y.y)*(J.x-Y.x),a)._round()),Y.x>=h&&J.x>=h||(Y.x>=h?Y=new Ht(h,Y.y+(h-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x>=h&&(J=new Ht(h,Y.y+(h-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y>=m&&J.y>=m||(Y.y>=m?Y=new Ht(Y.x+(m-Y.y)/(J.y-Y.y)*(J.x-Y.x),m)._round():J.y>=m&&(J=new Ht(Y.x+(m-Y.y)/(J.y-Y.y)*(J.x-Y.x),m)._round()),N&&Y.equals(N[N.length-1])||(N=[Y],_.push(N),x&&x.push({progress:{min:ue+X4(pe,we,Y)*oe,max:1},parentIndex:A,prevPoint:pe,nextPoint:we})),N.push(J),x&&(x[x.length-1].progress.max=ue+X4(pe,we,J)*oe,x[x.length-1].nextPoint=we)))))}if(x&&H>0)for(let G=V;G<_.length;G++)x[G].progress.min/=H,x[G].progress.max/=H}return _}function wX(c,i,a,h,m){if(c.length<2)return void h.push(c);const x=[];for(;i.valid();){const[N,V]=i.get();for(let H=0;H<c.length-1;H++){const G=c[H],Y=c[H+1],J=gl(G,Y,N,V);if(J){const[oe]=J,ue=new Ht(Ar(G.x,Y.x,oe),Ar(G.y,Y.y,oe));x.push({t:H+oe,distance:0,point:ue})}}i.next()}if(x.length===0)return void h.push(c);x.sort(((N,V)=>N.t-V.t));let _=0,A=0,P=[];for(h.push(P);_!==c.length;){if(A===x.length){for(;_!==c.length;)P.length!==0&&P[P.length-1].equals(c[_])||P.push(c[_]),_++;break}x[A].t<=_?(P.length!==0&&P[P.length-1].equals(x[A].point)||P.push(x[A].point),Math.trunc(x[A].t),A++):(P.length!==0&&P[P.length-1].equals(c[_])||P.push(c[_]),_++)}}function X4(c,i,a){return c.x!==i.x?(a.x-c.x)/(i.x-c.x):c.y!==i.y?(a.y-c.y)/(i.y-c.y):0}function Gb(c,i){return c.x*i.x+c.y*i.y}function Z4(c,i){if(c.length===1){let a=0;const h=i[a++];let m;for(;!m||h.equals(m);)if(m=i[a++],!m)return 1/0;for(;a<i.length;a++){const x=i[a],_=c[0],A=m.sub(h),P=x.sub(h),N=_.sub(h),V=Gb(A,A),H=Gb(A,P),G=Gb(P,P),Y=Gb(N,A),J=Gb(N,P),oe=V*G-H*H,ue=(G*Y-H*J)/oe,pe=(V*J-H*Y)/oe,we=h.z*(1-ue-pe)+m.z*ue+x.z*pe;if(isFinite(we))return we}return 1/0}{let a=1/0;for(const h of i)a=Math.min(a,h.z);return a}}function Q4(c,i,a){let h=1/0;Os(a,i)&&(h=Z4(a,i[0]));for(let m=0;m<i.length;m++){const x=i[m],_=c[m];for(let A=0;A<x.length-1;A++){const P=x[A],N=[P,x[A+1],_[A+1],_[A],P];qs(a,N)&&(h=Math.min(h,Z4(a,N)))}}return h!==1/0&&h}function K4(c,i,a,h,m,x,_,A,P,N,V){return c.projection.name==="globe"?(function(H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze){const Ve=[],Ye=[],nt=H.projection.upVectorScale(Ze,H.center.lat,H.worldSize).metersToTile,ot=[0,0,0,1],Ot=[0,0,0,1],pt=(Zt,en,vn,an)=>{Zt[0]=en,Zt[1]=vn,Zt[2]=an,Zt[3]=1},Ut=U4();Y>0&&(Y+=Ut),J+=Ut;for(const Zt of G){const en=[],vn=[];for(const an of Zt){const Qt=an.x+oe.x,sn=an.y+oe.y,jt=H.projection.projectTilePoint(Qt,sn,Ze),Rt=H.projection.upVector(Ze,an.x,an.y);let nn=Y,gn=J;if(pe){const Yt=Y4(Qt,sn,Y,J,pe,we,Te,Ie);nn+=Yt.base,gn+=Yt.top}Y!==0?pt(ot,jt.x+Rt[0]*nt*nn,jt.y+Rt[1]*nt*nn,jt.z+Rt[2]*nt*nn):pt(ot,jt.x,jt.y,jt.z),pt(Ot,jt.x+Rt[0]*nt*gn,jt.y+Rt[1]*nt*gn,jt.z+Rt[2]*nt*gn),Un(ot,ot,ue),Un(Ot,Ot,ue),en.push(new Cy(ot[0],ot[1],ot[2])),vn.push(new Cy(Ot[0],Ot[1],Ot[2]))}Ve.push(en),Ye.push(vn)}return[Ve,Ye]})(c,i,a,h,m,x,_,A,P,N,V):_?(function(H,G,Y,J,oe,ue,pe,we,Te){const Ie=[],Ze=[],Ve=[0,0,0,1];for(const Ye of H){const nt=[],ot=[];for(const Ot of Ye){const pt=Ot.x+J.x,Ut=Ot.y+J.y,Zt=Y4(pt,Ut,G,Y,ue,pe,we,Te);Ve[0]=pt,Ve[1]=Ut,Ve[2]=Zt.base,Ve[3]=1,Oe(Ve,Ve,oe),Ve[3]=Math.max(Ve[3],1e-5);const en=new Cy(Ve[0]/Ve[3],Ve[1]/Ve[3],Ve[2]/Ve[3]);Ve[0]=pt,Ve[1]=Ut,Ve[2]=Zt.top,Ve[3]=1,Oe(Ve,Ve,oe),Ve[3]=Math.max(Ve[3],1e-5);const vn=new Cy(Ve[0]/Ve[3],Ve[1]/Ve[3],Ve[2]/Ve[3]);nt.push(en),ot.push(vn)}Ie.push(nt),Ze.push(ot)}return[Ie,Ze]})(i,a,h,m,x,_,A,P,N):(function(H,G,Y,J,oe){const ue=[],pe=[],we=oe[8]*G,Te=oe[9]*G,Ie=oe[10]*G,Ze=oe[11]*G,Ve=oe[8]*Y,Ye=oe[9]*Y,nt=oe[10]*Y,ot=oe[11]*Y;for(const Ot of H){const pt=[],Ut=[];for(const Zt of Ot){const en=Zt.x+J.x,vn=Zt.y+J.y,an=oe[0]*en+oe[4]*vn+oe[12],Qt=oe[1]*en+oe[5]*vn+oe[13],sn=oe[2]*en+oe[6]*vn+oe[14],jt=oe[3]*en+oe[7]*vn+oe[15],Rt=an+we,nn=Qt+Te,gn=sn+Ie,Yt=Math.max(jt+Ze,1e-5),zn=an+Ve,Zn=Qt+Ye,jn=sn+nt,Mn=Math.max(jt+ot,1e-5);pt.push(new Cy(Rt/Yt,nn/Yt,gn/Yt)),Ut.push(new Cy(zn/Mn,Zn/Mn,jn/Mn))}ue.push(pt),pe.push(Ut)}return[ue,pe]})(i,a,h,m,x)}function Y4(c,i,a,h,m,x,_,A){const P=_*m.getElevationAt(c,i,!0,!0),N=x[0]!==0,V=N?x[1]===0?_*(x[0]/I4-P4):_*(function(H,G,Y){const J=Math.floor(G[0]/8),oe=Math.floor(G[1]/8),ue=10*(G[0]-8*J),pe=10*(G[1]-8*oe),we=H.getElevationAt(J,oe,!0,!0),Te=H.getMeterToDEM(Y),Ie=Math.floor(.5*(ue*Te-1)),Ze=Math.floor(.5*(pe*Te-1)),Ve=H.tileCoordToPixel(J,oe),Ye=2*Ie+1,nt=2*Ze+1,ot=(function(vn,an,Qt,sn,jt){return[vn.getElevationAtPixel(an,Qt,!0),vn.getElevationAtPixel(an+jt,Qt,!0),vn.getElevationAtPixel(an,Qt+jt,!0),vn.getElevationAtPixel(an+sn,Qt+jt,!0)]})(H,Ve.x-Ie,Ve.y-Ze,Ye,nt),Ot=Math.abs(ot[0]-ot[1]),pt=Math.abs(ot[2]-ot[3]),Ut=Math.abs(ot[0]-ot[2])+Math.abs(ot[1]-ot[3]),Zt=Math.min(.25,.5*Te*(Ot+pt)/Ye),en=Math.min(.25,.5*Te*Ut/nt);return we+Math.max(Zt*ue,en*pe)})(m,x,A):P;return{base:P+(a===0?-1:a),top:N?Math.max(V+h,P+a+2):P+h}}class SX{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class TX{constructor(){this.tasks={},this.taskQueue=[],Ct(["process"],this),this.invoker=new SX(this.process),this.nextId=0}add(i,a){const h=this.nextId++,m=(function({type:x,isSymbolTile:_,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||_?x!=="parseTile"||_?x==="parseTile"&&_?300-A:x==="maybePrepare"&&_?400-A:500:200-A:100-A})(a);if(m===0){try{i()}finally{}return null}return this.tasks[h]={fn:i,metadata:a,priority:m,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){const x=this.tasks[this.taskQueue[m]];x.priority<a&&(a=x.priority,i=m)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}class J4{constructor(i,a,h){this.target=i,this.parent=a,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new TX}send(i,a,h,m,x=!1,_){const A=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=_,this.callbacks[A]=h);const P=new Set;return this.target.postMessage({id:A,type:i,hasCallback:!!h,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:zu(a,P)},P),{cancel:()=>{h&&delete this.callbacks[A],this.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(i){const a=i.data;if(!a)return;const h=a.id;if(h&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const m=this.cancelCallbacks[h];delete this.cancelCallbacks[h],m&&m.cancel()}else if(a.mustQueue||xr(self)){const m=this.callbacks[h],x=this.scheduler.add((()=>this.processTask(h,a)),m&&m.metadata||{type:"message"});x&&(this.cancelCallbacks[h]=x)}else this.processTask(h,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const h=this.callbacks[i];delete this.callbacks[i],h&&(a.error?h(ec(a.error)):h(null,ec(a.data)))}else{const h=new Set,m=a.hasCallback?(_,A)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?zu(_):null,data:zu(A,h)},h)}:()=>{},x=ec(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,x,m);else if(this.parent.getWorkerSource){const _=a.type.split("."),{source:A,scope:P}=x;this.parent.getWorkerSource(a.sourceMapId,_[0],A,P)[_[1]](x,m)}else m(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var $b={workerUrl:"",workerClass:null,workerParams:void 0};const _3="mapboxgl_preloaded_worker_pool";class My{constructor(){this.active={}}acquire(i,a=My.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push($b.workerClass!=null?new $b.workerClass:new self.Worker($b.workerUrl,$b.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[_3]}numActive(){return Object.keys(this.active).length}}My.workerCount=2;class y_{constructor(i,a,h="Worker",m=My.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Pt();const x=this.workerPool.acquire(this.id,m);for(let _=0;_<x.length;_++){const A=new y_.Actor(x[_],a,this.id);A.name=`${h} ${_}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(i,a,h){Je(this.actors,((m,x)=>{m.send(i,a,x)}),h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((i=>{i.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Wb,v3;function G2(){return Wb||(Wb=new My),Wb}y_.Actor=J4;class EX{constructor(i){this.module=i}createIntArray(i){const a=new Int32Array(i),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,h/a.BYTES_PER_ELEMENT),h}createFloatArray(i){const a=new Float32Array(i),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,h/a.BYTES_PER_ELEMENT),h}createStringBuffer(i){const a=this.module.malloc(i.length+1);for(let h=0;h<i.length;++h)this.module.heapU8[a+h]=i.charCodeAt(h);return this.module.heapU8[a+i.length]=0,a}readStringBuffer(i){let a="";for(;this.module.heapU8[i]!==0;)a+=String.fromCharCode(this.module.heapU8[i]),++i;return a}setStyle(i){const a=i.entranceColorRgb,h=i.facadeGlazingColorRgb,m=i.roofColorRgb,x=i.wallColorRgb,_=i.normalScale;this.module.setStyle(a[0],a[1],a[2],h[0],h[1],h[2],m[0],m[1],m[2],x[0],x[1],x[2],_[0],_[1],_[2],i.tileToMeters)}setAOOptions(i,a){this.module.setAOOptions(i?1:0,a)}setMetricOptions(i,a){this.module.setMetricOptions(i?1:0,a)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,a){this.module.setFacadeOptions(i,a?1:0)}setFauxFacadeOptions(i,a,h){this.module.setFauxFacadeOptions(i?1:0,a?1:0,h)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,a){for(const A of i){const P=this.createStringBuffer(A.roofType),N=[0],V=[];for(const Y of A.coordinates)if(Array.isArray(Y)){for(const J of Y)V.push(J.x),V.push(J.y);N.push(V.length)}const H=this.createIntArray(N),G=this.createFloatArray(V);this.module.addFeature(A.id,A.sourceId,A.minHeight,A.height,P,A.roofType.length,G,H,N.length-1),this.module.free(P),this.module.free(H),this.module.free(G)}for(const A of a){let P;P=A.entrances?JSON.parse(A.entrances):[];const N=this.createFloatArray(P),V=[];for(const G of A.coordinates)V.push(G.x),V.push(G.y);const H=this.createFloatArray(V);this.module.addFacade(A.sourceId,A.crossPerc,A.distanceToRoad,N,P.length,H,V.length),this.module.free(N),this.module.free(H)}if(!this.module.generateMesh()){const A=this.module.getLastError();return this.readStringBuffer(A)}const h=this.module.getMeshCount(),m=new Array(h);for(let A=0;A<h;A++){const P=this.module.getPositionsPtr(A),N=this.module.getPositionsLength(A),V=new Float32Array(this.module.heapF32.buffer,P,N),H=this.module.getNormalsPtr(A),G=this.module.getNormalsLength(A),Y=new Float32Array(this.module.heapF32.buffer,H,G),J=this.module.getColorsPtr(A),oe=this.module.getColorsLength(A),ue=new Uint8Array(this.module.heapU8.buffer,J,oe),pe=this.module.getAOPtr(A),we=this.module.getAOLength(A),Te=new Float32Array(this.module.heapF32.buffer,pe,we),Ie=this.module.getUVPtr(A),Ze=this.module.getUVLength(A),Ve=new Float32Array(this.module.heapF32.buffer,Ie,Ze),Ye=this.module.getFauxFacadePtr(A),nt=this.module.getFauxFacadeLength(A),ot=new Uint8Array(this.module.heapU8.buffer,Ye,nt),Ot=this.module.getIndicesPtr(A),pt=this.module.getIndicesLength(A),Ut=new Int32Array(this.module.heap32.buffer,Ot,pt),Zt=this.module.getBuildingPart(A),en=this.readStringBuffer(Zt);m[A]={positions:V,normals:Y,colors:ue,ao:Te,uv:Ve,isFauxFacade:ot,indices:Ut,buildingPart:en}}const x=this.module.getRingCount(),_=[];for(let A=0;A<x;A++){const P=this.module.getRingPtr(A),N=this.module.getRingLength(A),V=new Float32Array(this.module.heapF32.buffer,P,N);_.push(V)}return{meshes:m,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let qb,b3,Xh,x_,w3,__=null,v_=null,e6=null,$2=null;function t6(){return xr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:b3||ii.DRACO_URL}function n6(){if(xr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(x_)return x_;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return x_=WebAssembly.validate(c)?ii.MESHOPT_SIMD_URL:ii.MESHOPT_URL,x_}function AX(){return $2}const W2={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},CX={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Xb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function r6(c,i,a){const h=a.json.bufferViews.length,m=a.buffers.length;i.bufferView=h,a.json.bufferViews[h]={buffer:m,byteLength:c.byteLength},a.buffers[m]=c}const S3="KHR_draco_mesh_compression";function MX(c,i){const a=c.extensions&&c.extensions[S3];if(!a)return;const h=new Xh.Decoder,m=a6(i,a.bufferView),x=new Xh.Mesh;if(!h.DecodeArrayToMesh(m,m.byteLength,x))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[c.indices],A=W2[_.componentType],P=_.count*A.BYTES_PER_ELEMENT,N=Xh._malloc(P);A===Uint16Array?h.GetTrianglesUInt16Array(x,P,N):h.GetTrianglesUInt32Array(x,P,N),r6(Xh.memory.buffer.slice(N,N+P),_,i),Xh._free(N);for(const V of Object.keys(a.attributes)){const H=h.GetAttributeByUniqueId(x,a.attributes[V]),G=i.json.accessors[c.attributes[V]],Y=CX[G.componentType],J=G.count*Xb[G.type]*W2[G.componentType].BYTES_PER_ELEMENT,oe=Xh._malloc(J);h.GetAttributeDataArrayForAllPoints(x,H,Xh[Y],J,oe),r6(Xh.memory.buffer.slice(oe,oe+J),G,i),Xh._free(oe)}h.destroy(),x.destroy(),delete c.extensions[S3]}const q2="EXT_meshopt_compression";function kX(c,i){if(!c.extensions||!c.extensions[q2])return;const a=c.extensions[q2],h=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),m=new Uint8Array(a.count*a.byteStride);w3.decodeGltfBuffer(m,a.count,a.byteStride,h,a.mode,a.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=m.buffer,delete c.extensions[q2]}const i6=1179937895,s6=new TextDecoder("utf8");function o6(c,i){return new URL(c,i).href}function IX(c,i,a,h){return fetch(o6(c.uri,h)).then((m=>m.arrayBuffer())).then((m=>{i.buffers[a]=m}))}function a6(c,i){const a=c.json.bufferViews[i];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function PX(c,i,a,h){if(c.uri){const m=o6(c.uri,h);return fetch(m).then((x=>x.blob())).then((x=>createImageBitmap(x))).then((x=>{i.images[a]=x}))}if(c.bufferView!==void 0){const m=a6(i,c.bufferView),x=new Blob([m],{type:c.mimeType});return createImageBitmap(x).then((_=>{i.images[a]=_}))}}function l6(c,i=0,a){const h={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===i6){const V=new Uint32Array(c,i);let H=2;const G=(V[H++]>>2)-3,Y=V[H++]>>2;if(H++,h.json=JSON.parse(s6.decode(V.subarray(H,H+Y))),H+=Y,H<G){const J=V[H++];H++;const oe=i+(H<<2);h.buffers[0]=c.slice(oe,oe+J)}}else h.json=JSON.parse(s6.decode(new Uint8Array(c,i)));const{buffers:m,images:x,meshes:_,extensionsUsed:A,bufferViews:P}=h.json;let N=Promise.resolve();if(m){const V=[];for(let H=0;H<m.length;H++){const G=m[H];G.uri?V.push(IX(G,h,H,a)):h.buffers[H]||(h.buffers[H]=null)}N=Promise.all(V)}return N.then((()=>{const V=[],H=A&&A.includes(S3),G=A&&A.includes(q2);if(H&&V.push((function(){if(!Xh)return qb??(qb=(function(Y){let J,oe=null;function ue(){J=new Uint8Array(oe.buffer)}function pe(){throw new Error("Unexpected Draco error.")}const we={a:{a:pe,d:function(Te,Ie,Ze){return J.copyWithin(Te,Ie,Ie+Ze)},c:function(Te){const Ie=J.length,Ze=Math.max(Te>>>0,Math.ceil(1.2*Ie)),Ve=Math.ceil((Ze-Ie)/65536);try{return oe.grow(Ve),ue(),!0}catch{return!1}},b:pe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Y,we):Y.then((Te=>Te.arrayBuffer())).then((Te=>WebAssembly.instantiate(Te,we)))).then((Te=>{const{Rb:Ie,Qb:Ze,P:Ve,T:Ye,X:nt,Ja:ot,La:Ot,Qa:pt,Va:Ut,Wa:Zt,eb:en,jb:vn,f:an,e:Qt,yb:sn,zb:jt,Ab:Rt,Bb:nn,Db:gn,Gb:Yt}=Te.instance.exports;oe=Qt;const zn=(()=>{let Zn=0,jn=0,Mn=0,Fr=0;return Rn=>{Mn&&(Ie(Fr),Ie(Zn),jn+=Mn,Mn=Zn=0),Zn||(jn+=128,Zn=Ze(jn));const br=Rn.length+7&-8;let Ur=Zn;br>=jn&&(Mn=br,Ur=Fr=Ze(br));for(let fi=0;fi<Rn.length;fi++)J[Ur+fi]=Rn[fi];return Ur}})();return ue(),an(),{memory:Qt,_free:Ie,_malloc:Ze,Mesh:class{constructor(){this.ptr=Ve()}destroy(){Ye(this.ptr)}},Decoder:class{constructor(){this.ptr=ot()}destroy(){vn(this.ptr)}DecodeArrayToMesh(Zn,jn,Mn){const Fr=zn(Zn),Rn=Ot(this.ptr,Fr,jn,Mn.ptr);return!!nt(Rn)}GetAttributeByUniqueId(Zn,jn){return{ptr:pt(this.ptr,Zn.ptr,jn)}}GetTrianglesUInt16Array(Zn,jn,Mn){Ut(this.ptr,Zn.ptr,jn,Mn)}GetTrianglesUInt32Array(Zn,jn,Mn){Zt(this.ptr,Zn.ptr,jn,Mn)}GetAttributeDataArrayForAllPoints(Zn,jn,Mn,Fr,Rn){en(this.ptr,Zn.ptr,jn.ptr,Mn,Fr,Rn)}},DT_INT8:sn(),DT_UINT8:jt(),DT_INT16:Rt(),DT_UINT16:nn(),DT_UINT32:gn(),DT_FLOAT32:Yt()}}))})(fetch(t6())),qb.then((Y=>{Xh=Y,qb=void 0})))})()),G&&V.push((function(){if(w3)return;const Y=(function(J){let oe;const ue=WebAssembly.instantiateStreaming(J,{}).then((Te=>{oe=Te.instance,oe.exports.__wasm_call_ctors()})),pe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},we={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ue,supported:!0,decodeGltfBuffer(Te,Ie,Ze,Ve,Ye,nt){(function(ot,Ot,pt,Ut,Zt,en,vn){const an=ot.exports.sbrk,Qt=Ut+3&-4,sn=an(Qt*Zt),jt=an(en.length),Rt=new Uint8Array(ot.exports.memory.buffer);Rt.set(en,jt);const nn=Ot(sn,Ut,Zt,jt,en.length);if(nn===0&&vn&&vn(sn,Qt,Zt),pt.set(Rt.subarray(sn,sn+Ut*Zt)),an(sn-an(0)),nn!==0)throw new Error(`Malformed buffer data: ${nn}`)})(oe,oe.exports[we[Ye]],Te,Ie,Ze,Ve,oe.exports[pe[nt]])}}})(fetch(n6()));return Y.ready.then((()=>{w3=Y}))})()),x)for(let Y=0;Y<x.length;Y++)V.push(PX(x[Y],h,Y,a));return(V.length?Promise.all(V):Promise.resolve()).then((()=>{if(H&&_)for(const{primitives:Y}of _)for(const J of Y)MX(J,h);if(G&&_&&P)for(const Y of P)kX(Y,h);return h}))}))}function c6(c){return fetch(c).then((i=>i.arrayBuffer())).then((i=>l6(i,0,c)))}function T3(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function E3(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class A3{constructor(i,a,h,m){this.context=i,this.format=h,this.useMipmap=m&&m.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:m&&m.premultiply})}update(i,a){const h=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,m=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:x}=this,{gl:_}=x,{x:A,y:P}=a&&a.position?a.position:{x:0,y:0},N=A+h,V=P+m;!this.size||this.size[0]===N&&this.size[1]===V||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!a||a.premultiply!==!1));const H=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&N>0&&V>0){const G=this.useMipmap?Math.floor(Math.log2(Math.max(N,V)))+1:1;_.texStorage2D(_.TEXTURE_2D,G,this.format,N,V),this.size=[N,V]}this.size&&(H?_.texSubImage2D(_.TEXTURE_2D,0,A,P,T3(this.format),E3(this.format),i):"data"in i&&i.data&&_.texSubImage2D(_.TEXTURE_2D,0,A,P,h,m,T3(this.format),E3(this.format),i.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,a,h=!1){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!h?i===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,h,m,x){const{context:_}=this,{gl:A}=_;A.bindTexture(A.TEXTURE_2D,this.texture),a!==this.magFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?i===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),h!==this.wrapS&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),this.wrapS=h),m!==this.wrapT&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,m),this.wrapT=m),x!==this.compareMode&&(x?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,x)):A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.NONE),this.compareMode=x)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Zb{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrapS=a)}}const RX=di([{name:"a_pos_3f",components:3,type:"Float32"}]),NX=di([{name:"a_color_3f",components:3,type:"Float32"}]),jX=di([{name:"a_color_4f",components:4,type:"Float32"}]),DX=di([{name:"a_uv_2f",components:2,type:"Float32"}]),LX=di([{name:"a_normal_3f",components:3,type:"Float32"}]),OX=di([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),FX=di([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function u6(c,i){const a=X2(c.projection,c.zoom,c.width,c.height),h=(function(x,_,A,P,N){const V=new ee(A.lng-180*t0,A.lat),H=new ee(A.lng+180*t0,A.lat),G=x.project(V.lng,V.lat),Y=x.project(H.lng,H.lat),J=-Math.atan2(Y.y-G.y,Y.x-G.x),oe=dt.fromLngLat(A);oe.y=ve(oe.y,-1+t0,1-t0);const ue=oe.toLngLat(),pe=x.project(ue.lng,ue.lat),we=dt.fromLngLat(ue);we.x+=t0;const Te=we.toLngLat(),Ie=x.project(Te.lng,Te.lat),Ze=h6(Ie.x-pe.x,Ie.y-pe.y,J),Ve=dt.fromLngLat(ue);Ve.y+=t0;const Ye=Ve.toLngLat(),nt=x.project(Ye.lng,Ye.lat),ot=h6(nt.x-pe.x,nt.y-pe.y,J),Ot=Math.abs(Ze.x)/Math.abs(ot.y),pt=F([]);re(pt,pt,-J*(1-(N?0:P)));const Ut=F([]);return K(Ut,Ut,[1,1-(1-Ot)*P,1]),Ut[4]=-ot.x/ot.y*P,re(Ut,Ut,J),X(Ut,pt,Ut),Ut})(c.projection,0,c.center,a,i),m=d6(c);return K(h,h,[m,m,1]),h}function d6(c){const i=c.projection,a=X2(c.projection,c.zoom,c.width,c.height),h=C3(i,c.center),m=C3(i,ee.convert(i.center));return Math.pow(2,h*a+(1-a)*m)}function X2(c,i,a,h,m=1/0){const x=c.range;if(!x)return 0;const _=Math.min(m,Math.max(a,h)),A=Math.log2(_/1024);return Fe(x[0]+A,x[1]+A,i)}const t0=1/4e4;function C3(c,i){const a=ve(i.lat,-Ne,Ne),h=new ee(i.lng-180*t0,a),m=new ee(i.lng+180*t0,a),x=c.project(h.lng,a),_=c.project(m.lng,a),A=dt.fromLngLat(h),P=dt.fromLngLat(m),N=_.x-x.x,V=_.y-x.y,H=P.x-A.x,G=P.y-A.y,Y=Math.sqrt((H*H+G*G)/(N*N+V*V));return Math.log2(Y)}function h6(c,i,a){const h=Math.cos(a),m=Math.sin(a);return{x:c*h-i*m,y:c*m+i*h}}function f6(c,i,a){F(c),re(c,c,Qr(i[2])),ne(c,c,Qr(i[0])),te(c,c,Qr(i[1])),K(c,c,a),X(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Z2(c,i,a,h,m,x,_,A){const P=[a[0]-i[0],a[1]-i[1],0],N=[h[0]-i[0],h[1]-i[1],0];if(ke(P)<1e-12||ke(N)<1e-12)return En(c);const V=mn([],P,N);kt(V,V),He(N,h,i),P[2]=(x-m)*A,N[2]=(_-m)*A;const H=P;return mn(H,P,N),kt(H,H),bn(c,V,H)}function Q2(c,i,a=!1){const h=Yg(i.zoom),m=(function(x,_,A){const P=_.worldSize,N=[x[12],x[13],x[14]],V=Ee(N[1]/P),H=Pe(N[0]/P),G=F([]),Y=Se(1,V)*P,J=Se(1,0)*P*ze(V,_.zoom),oe=1/js(P);let ue=J*oe;if(A){const Ie=X2(_.projection,_.zoom,_.width,_.height,1024);ue=oe*_.projection.pixelSpaceConversion(_.center.lat,P,Ie)}const pe=z(V,H);Ae(pe,pe,bt([],kt([],pe),Y*ue*N[2]));const we=(function(Ie){const Ze=[Ie[0],Ie[1],Ie[2]];let Ve=[0,1,0];const Ye=mn([],Ve,Ze);return mn(Ve,Ze,Ye),vt(Ve)===0&&(Ve=[0,1,0],mn(Ye,Ze,Ve)),kt(Ye,Ye),kt(Ve,Ve),kt(Ze,Ze),[Ye[0],Ye[1],Ye[2],0,Ve[0],Ve[1],Ve[2],0,Ze[0],Ze[1],Ze[2],0,Ie[0],Ie[1],Ie[2],1]})(pe);K(G,G,[ue,ue,ue*Y]),W(G,G,[-N[0],-N[1],-N[2]]);const Te=X([],_.globeMatrix,we);return X(Te,Te,G),X(Te,Te,x),Te})(c,i,a);if(h>0){const x=(function(_,A){const P=A.worldSize,N=Se(1,0)*P*ze(A.center.lat,A.zoom)/js(P),V=Se(1,A.center.lat)*P,H=F([]);te(H,H,Qr(A.center.lng)),ne(H,H,Qr(A.center.lat)),W(H,H,[0,0,Ls]),K(H,H,[N,N,N*V]);const G=A.point;return W(H,H,[-G.x,-G.y,0]),X(H,H,_),X(H,A.globeMatrix,H)})(c,i);return(function(_,A,P){const N=(J,oe,ue)=>{const pe=ke(J),we=ke(oe),Te=no(J,oe,ue);return bt(Te,Te,1/ke(Te)*Ar(pe,we,ue))},V=N([_[0],_[1],_[2]],[A[0],A[1],A[2]],P),H=N([_[4],_[5],_[6]],[A[4],A[5],A[6]],P),G=N([_[8],_[9],_[10]],[A[8],A[9],A[10]],P),Y=no([_[12],_[13],_[14]],[A[12],A[13],A[14]],P);return[V[0],V[1],V[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,Y[0],Y[1],Y[2],1]})(m,x,h)}return m}function M3(c,i,a,h){const m=Gr.projectAabbCorners(h,a);let x=Number.MAX_VALUE;for(let A=0;A<m.length;++A){const P=m[A];P[0]=(.5*P[0]+.5)*i.width,P[1]=(.5-.5*P[1])*i.height,P[2]<x&&(x=P[2])}const _=(function(A){const P=[];let N=0;for(let Y=1;Y<A.length;Y++)(A[Y][0]<A[N][0]||A[Y][0]===A[N][0]&&A[Y][1]<A[N][1])&&(N=Y);let V,H=N;const G=new Uint8Array(A.length);do{if(G[H])break;P.push(new Ht(A[H][0],A[H][1])),G[H]=1,V=(H+1)%A.length;for(let Y=0;Y<A.length;Y++){if(A[Y][0]===A[V][0]&&A[Y][1]===A[V][1]||A[Y][0]===A[H][0]&&A[Y][1]===A[H][1])continue;const J=[A[Y][0]-A[H][0],A[Y][1]-A[H][1]],oe=[A[V][0]-A[H][0],A[V][1]-A[H][1]],ue=J[0]*oe[1]-J[1]*oe[0];(ue>0||ue===0&&J[0]*oe[0]+J[1]*oe[1]>=0&&J[0]*J[0]+J[1]*J[1]>oe[0]*oe[0]+oe[1]*oe[1])&&(V=Y)}H=V}while(H!==N);return P.length>0&&P.push(P[0]),P})(m);if(qs(c,_))return x}const ky=64,b_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function K2(c,i,a,h,m,x,_,A,P,N=!1){const V=a.zoom,H=a.project(h),G=ze(h.lat,V),Y=1/G;F(c),W(c,c,[H.x+_[0]*Y,H.y+_[1]*Y,_[2]]);let J=1,oe=1;const ue=a.worldSize;if(N){if(a.projection.name==="mercator"){let Ie=0;a.elevation&&(Ie=a.elevation.getAtPointOrZero(new dt(H.x/ue,H.y/ue),0));const Ze=Oe([],[H.x,H.y,Ie,1],a.projMatrix)[3]/a.cameraToCenterDistance;J=Ze,oe=Ze*ze(a.center.lat,V)}else if(a.projection.name==="globe"){const Ie=Q2(c,a),Ze=[0,0,0,1];Oe(Ze,Ze,X([],a.projMatrix,Ie));const Ve=Ze[3]/a.cameraToCenterDistance,Ye=Yg(V),nt=a.projection.pixelsPerMeter(h.lat,ue)*ze(h.lat,V),ot=a.projection.pixelsPerMeter(a.center.lat,ue)*ze(a.center.lat,V);J=Ve/Ar(nt,Xe(a.center.lat),Ye),oe=Ve*G/nt,J*=ot,oe*=ot}}else J=Y;K(c,c,[J,J,oe]);const pe=[...c],we=i.orientation,Te=[];if(f6(Te,[we[0]+(m?m[0]:0),we[1]+(m?m[1]:0),we[2]+(m?m[2]:0)],x),X(c,pe,Te),A&&a.elevation){let Ie=0;const Ze=[];if(P&&a.elevation){Ie=(function(Ye,nt,ot,Ot,pt){const Ut=nt.elevation;if(!Ut)return 0;const Zt=Gr.projectAabbCorners(ot,Ot),en=Se(1,pt.lat)*nt.worldSize,vn=(function(jn,Mn){const Fr=[0,0,1],Rn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const br of Rn){const Ur=jn[br.corners[0]],fi=jn[br.corners[1]],Pi=jn[br.corners[2]],Wr=[fi[0]-Ur[0],fi[1]-Ur[1],Mn*(fi[2]-Ur[2])],Vi=mn(Wr,Wr,[Pi[0]-Ur[0],Pi[1]-Ur[1],Mn*(Pi[2]-Ur[2])]);kt(Vi,Vi),br.dotProductWithUp=on(Vi,Fr)}return Rn.sort(((br,Ur)=>br.dotProductWithUp-Ur.dotProductWithUp)),Rn[0].corners})(Zt,en),an=Zt[vn[0]],Qt=Zt[vn[1]],sn=Zt[vn[2]],jt=Zt[vn[3]],Rt=Ut.getAtPointOrZero(new dt(an[0]/nt.worldSize,an[1]/nt.worldSize),0),nn=Ut.getAtPointOrZero(new dt(Qt[0]/nt.worldSize,Qt[1]/nt.worldSize),0),gn=Ut.getAtPointOrZero(new dt(sn[0]/nt.worldSize,sn[1]/nt.worldSize),0),Yt=Ut.getAtPointOrZero(new dt(jt[0]/nt.worldSize,jt[1]/nt.worldSize),0),zn=(Rt+Yt)/2,Zn=(nn+gn)/2;return zn>Zn?nn<gn?Z2(Ye,Qt,jt,an,nn,Yt,Rt,en):Z2(Ye,sn,an,jt,gn,Rt,Yt,en):Rt<Yt?Z2(Ye,an,Qt,sn,Rt,nn,gn,en):Z2(Ye,jt,sn,Qt,Yt,gn,nn,en),Math.max(zn,Zn)})(Ze,a,i.aabb,c,h);const Ve=X([],ye([],Ze),Te);X(c,pe,Ve)}else Ie=a.elevation.getAtPointOrZero(new dt(H.x/ue,H.y/ue),0);Ie!==0&&(c[14]+=Ie)}}class p6{constructor(i,a,h,m,x){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=i,this.uri=a,this.position=h!=null?new ee(h[0],h[1]):new ee(0,0),this.orientation=m??[0,0,0],this.nodes=x,this.uploaded=!1,this.aabb=new Gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,a){X(i.globalMatrix,a,i.localMatrix);const h=this.nodeOverrides.get(i.name);if(h!==void 0){const _=[];x=h.orientation,F(m=_),te(m,m,Qr(x[1])),re(m,m,Qr(x[2])),ne(m,m,Qr(x[0])),X(i.globalMatrix,i.globalMatrix,_)}var m,x;if(i.meshes)for(const _ of i.meshes){const A=Gr.applyTransformFast(_.aabb,i.globalMatrix);this.aabb.encapsulate(A)}if(i.children)for(const _ of i.children)this._applyTransformations(_,i.globalMatrix)}computeBoundsAndApplyParent(){const i=F([]);this.aabb=new Gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,i)}computeModelMatrix(i,a,h,m,x,_,A=!1){K2(this.matrix,this,i.transform,this.position,a,h,m,x,_,A)}upload(i){if(!this.uploaded){for(const a of this.nodes)k3(a,i);for(const a of this.nodes)Y2(a);this.uploaded=!0}}destroy(){for(const i of this.nodes)I3(i)}}function Qb(c,i,a=!1){c.uploaded||(c.gfxTexture=new A3(i,c.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function BX(c,i,a){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,RX.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,LX.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,DX.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?NX:jX).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,FX.members,!0)),c.segments=Li.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const h=c.material;h.pbrMetallicRoughness.baseColorTexture&&Qb(h.pbrMetallicRoughness.baseColorTexture,i),h.pbrMetallicRoughness.metallicRoughnessTexture&&Qb(h.pbrMetallicRoughness.metallicRoughnessTexture,i),h.normalTexture&&Qb(h.normalTexture,i),h.occlusionTexture&&Qb(h.occlusionTexture,i,a),h.emissionTexture&&Qb(h.emissionTexture,i)}function k3(c,i,a){if(c.meshes)for(const h of c.meshes)BX(h,i,a);if(c.children)for(const h of c.children)k3(h,i,a)}function Y2(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)Y2(i)}function I3(c){if(c.meshes)for(const a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(const a of c.children)I3(a)}function Iy(c,i){const a=c.json.bufferViews[i.bufferView],h=W2[i.componentType];return new h(c.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==Xb[i.type]*h.BYTES_PER_ELEMENT?a.byteStride/h.BYTES_PER_ELEMENT:Xb[i.type]))}function P3(c,i,a,h){const m=W2[i.componentType],x=(function(V){switch(V){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(m),_=c.json.bufferViews[i.bufferView],A=_.byteStride?_.byteStride/m.BYTES_PER_ELEMENT:Xb[i.type],P=a.float32,N=P.length/a.capacity;for(let V=0,H=0;V<i.count*A;V+=A,H+=N)for(let G=0;G<N;G++)P[H+G]=h[V+G]*x;a._trim()}function zX(c,i,a){const h=c.indices,m=c.attributes,x={};x.indexArray=new ys;const _=i.json.accessors[h],A=_.count/3;x.indexArray.reserve(A);const P=Iy(i,_);for(let G=0;G<A;G++)x.indexArray.emplaceBack(P[3*G],P[3*G+1],P[3*G+2]);x.indexArray._trim(),x.vertexArray=new Wa;const N=i.json.accessors[m.POSITION];x.vertexArray.reserve(N.count);const V=Iy(i,N);for(let G=0;G<N.count;G++)x.vertexArray.emplaceBack(V[3*G],V[3*G+1],V[3*G+2]);if(x.vertexArray._trim(),x.aabb=new Gr(N.min,N.max),x.centroid=(function(G,Y){const J=[0,0,0],oe=G.length;if(oe>0){for(let ue=0;ue<oe;ue++){const pe=3*G[ue];J[0]+=Y[pe],J[1]+=Y[pe+1],J[2]+=Y[pe+2]}J[0]/=oe,J[1]/=oe,J[2]/=oe}return J})(P,V),m.COLOR_0!==void 0){const G=i.json.accessors[m.COLOR_0],Y=Xb[G.type],J=Iy(i,G);x.colorArray=Y===3?new Wa:new Vu,x.colorArray.resize(G.count),P3(i,G,x.colorArray,J)}if(m.NORMAL!==void 0){x.normalArray=new Wa;const G=i.json.accessors[m.NORMAL];x.normalArray.resize(G.count);const Y=Iy(i,G);P3(i,G,x.normalArray,Y)}if(m.TEXCOORD_0!==void 0&&a.length>0){x.texcoordArray=new Hu;const G=i.json.accessors[m.TEXCOORD_0];x.texcoordArray.resize(G.count);const Y=Iy(i,G);P3(i,G,x.texcoordArray,Y)}if(m._FEATURE_ID_RGBA4444!==void 0){const G=i.json.accessors[m._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=Iy(i,G))}m._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(Iy(i,i.json.accessors[m._FEATURE_RGBA4444]).buffer));const H=c.material;return x.material=(function(G,Y){const{emissiveFactor:J=[0,0,0],alphaMode:oe="OPAQUE",alphaCutoff:ue=.5,normalTexture:pe,occlusionTexture:we,emissiveTexture:Te,doubleSided:Ie,name:Ze}=G,{baseColorFactor:Ve=[1,1,1,1],metallicFactor:Ye=1,roughnessFactor:nt=1,baseColorTexture:ot,metallicRoughnessTexture:Ot}=G.pbrMetallicRoughness||{},pt=we?Y[we.index]:void 0;if(we&&we.extensions&&we.extensions.KHR_texture_transform&&pt){const Ut=we.extensions.KHR_texture_transform;pt.offsetScale=[Ut.offset[0],Ut.offset[1],Ut.scale[0],Ut.scale[1]]}return{name:Ze,pbrMetallicRoughness:{baseColorFactor:new Wi(...Ve),metallicFactor:Ye,roughnessFactor:nt,baseColorTexture:ot?Y[ot.index]:void 0,metallicRoughnessTexture:Ot?Y[Ot.index]:void 0},doubleSided:Ie,emissiveFactor:new Wi(...J),alphaMode:oe,alphaCutoff:ue,normalTexture:pe?Y[pe.index]:void 0,occlusionTexture:pt,emissionTexture:Te?Y[Te.index]:void 0,defined:G.defined===void 0}})(H!==void 0?i.json.materials[H]:{defined:!1},a),x}function m6(c,i,a){const{matrix:h,rotation:m,translation:x,scale:_,mesh:A,extras:P,children:N,name:V}=c,H={};if(H.name=V,H.localMatrix=h||(function(G,Y,J,oe){var ue=Y[0],pe=Y[1],we=Y[2],Te=Y[3],Ie=ue+ue,Ze=pe+pe,Ve=we+we,Ye=ue*Ie,nt=ue*Ze,ot=ue*Ve,Ot=pe*Ze,pt=pe*Ve,Ut=we*Ve,Zt=Te*Ie,en=Te*Ze,vn=Te*Ve,an=oe[0],Qt=oe[1],sn=oe[2];return G[0]=(1-(Ot+Ut))*an,G[1]=(nt+vn)*an,G[2]=(ot-en)*an,G[3]=0,G[4]=(nt-vn)*Qt,G[5]=(1-(Ye+Ut))*Qt,G[6]=(pt+Zt)*Qt,G[7]=0,G[8]=(ot+en)*sn,G[9]=(pt-Zt)*sn,G[10]=(1-(Ye+Ot))*sn,G[11]=0,G[12]=J[0],G[13]=J[1],G[14]=J[2],G[15]=1,G})([],m||[0,0,0,1],x||[0,0,0],_||[1,1,1]),H.globalMatrix=O(H.localMatrix),A!==void 0){H.meshes=a[A];const G=H.anchor=[0,0];for(const Y of H.meshes){const{min:J,max:oe}=Y.aabb;G[0]+=J[0]+oe[0],G[1]+=J[1]+oe[1]}G[0]=Math.floor(G[0]/H.meshes.length/2),G[1]=Math.floor(G[1]/H.meshes.length/2)}if(P&&(P.id&&(H.id=P.id),P.lights&&(H.lights=(function(G){if(!G.length)return[];const Y=(function(we){const Te=atob(we),Ie=new Uint8Array(Te.length);for(let Ze=0;Ze<Te.length;Ze++)Ie[Ze]=Te.codePointAt(Ze);return Ie})(G),J=[],oe=Y.length/24,ue=new Uint16Array(Y.buffer),pe=new Float32Array(Y.buffer);for(let we=0;we<oe;we++){const Te=ue[2*we*6]/30,Ie=ue[2*we*6+1]/30,Ze=ue[2*we*6+10]/100,Ve=pe[6*we+1],Ye=pe[6*we+2],nt=pe[6*we+3],ot=pe[6*we+4],Ot=nt-Ve,pt=ot-Ye,Ut=Math.hypot(Ot,pt);J.push({pos:[Ve+.5*Ot,Ye+.5*pt,Ie],normal:[pt/Ut,-Ot/Ut,0],width:Ut,height:Te,depth:Ze,points:[Ve,Ye,nt,ot]})}return J})(P.lights)),P.MAPBOX_geometry_bloom&&(H.isGeometryBloom=P.MAPBOX_geometry_bloom)),N){const G=[];for(const Y of N)G.push(m6(i.json.nodes[Y],i,a));H.children=G}return H}function UX(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new F2(c.vertices,c.indices,8,256),[a,h]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:a,max:h}}function VX(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const h=[];for(const _ of a){if(!Array.isArray(_)||_.length!==2)continue;const A=_[0],P=_[1];typeof A=="number"&&typeof P=="number"&&h.push(new Ht(A,P))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let m=0;for(let _=0;_<h.length;_++){const A=h[_],P=h[(_+1)%h.length],N=h[(_+2)%h.length];m+=(A.x-P.x)*(N.y-P.y)-(N.x-P.x)*(A.y-P.y)}m>0&&h.reverse();const x=m_(h.flatMap((_=>[_.x,_.y])),[]);return x.length===0?null:{vertices:h,indices:x}}function HX(c,i){const a=[],h=[];let m=0;const x=[];for(const _ of c){m=a.length;const A=_.vertexArray.float32,P=_.indexArray.uint16;for(let N=0;N<_.vertexArray.length;N++)x[0]=A[3*N+0],x[1]=A[3*N+1],x[2]=A[3*N+2],Un(x,x,i),a.push(new Ht(x[0],x[1]));for(let N=0;N<3*_.indexArray.length;N++)h.push(P[N]+m)}if(h.length%3!=0)return null;for(let _=0;_<h.length;_+=3){const A=a[h[_+0]],P=a[h[_+1]],N=a[h[_+2]];(A.x-P.x)*(N.y-P.y)-(N.x-P.x)*(A.y-P.y)>0&&([h[_+1],h[_+2]]=[h[_+2],h[_+1]])}return{vertices:a,indices:h}}function R3(c){const i=(function(P,N){const V=[],H=WebGL2RenderingContext;if(P.json.textures)for(const G of P.json.textures){const Y={magFilter:H.LINEAR,minFilter:H.NEAREST,wrapS:H.REPEAT,wrapT:H.REPEAT};G.sampler!==void 0&&Object.assign(Y,P.json.samplers[G.sampler]),V.push({image:N[G.source],sampler:Y,uploaded:!1})}return V})(c,c.images),a=(function(P,N){const V=[];for(const H of P.json.meshes){const G=[];for(const Y of H.primitives)G.push(zX(Y,P,N));V.push(G)}return V})(c,i),{scenes:h,scene:m,nodes:x}=c.json,_=h?h[m||0].nodes:[...x.keys()],A=[];for(const P of _)A.push(m6(x[P],c,a));return(function(P,N,V){const H={},G=new Set;for(let Y=0;Y<P.length;Y++){const J=V[N[Y]];if(!J.extras)continue;const oe=J.extras["mapbox:footprint:version"],ue=J.extras["mapbox:footprint:id"];(oe||ue)&&G.add(Y),oe==="1.0.0"&&ue&&(H[ue]=Y)}for(let Y=0;Y<P.length;Y++){if(G.has(Y))continue;const J=P[Y],oe=V[N[Y]];if(!oe.extras)continue;let ue=null;J.id in H&&(ue=HX(P[H[J.id]].meshes,J.localMatrix)),ue||(ue=VX(oe)),ue&&(J.footprint=UX(ue))}if(G.size>0){const Y=Array.from(G.values()).sort(((J,oe)=>J-oe));for(let J=Y.length-1;J>=0;J--)P.splice(Y[J],1)}})(A,_,c.json.nodes),A}function GX(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,a=c.aabb.min[0]-1,h=c.aabb.min[1]-1,m=ky/(c.aabb.max[0]-a+2),x=ky/(c.aabb.max[1]-h+2);for(let _=0;_<i.length;_+=3){const A=i[_+2],P=(i[_+0]-a)*m|0,N=(i[_+1]-h)*x|0;A>c.heightmap[N*ky+P]&&(c.heightmap[N*ky+P]=A)}}function g6(c,i,a,h,m){a.reserve(a.length+4*c.length),h.reserve(h.length+10*c.length),m.reserve(m.length+10*c.length);let x=h.length;for(const _ of c){const A=Math.min(10,Math.max(4,1.3*_.height))*i,P=[-_.normal[1],_.normal[0],0],N=Math.min(.29,.1*_.width/_.depth),V=_.width-2*_.depth*i*(N+.01),H=yt([],_.pos,P,V/2),G=yt([],_.pos,P,-V/2),Y=[H[0],H[1],H[2]+_.height],J=[G[0],G[1],G[2]+_.height],oe=yt([],_.normal,P,N);bt(oe,oe,A);const ue=yt([],_.normal,P,-N);bt(ue,ue,A),Ae(oe,H,oe),Ae(ue,G,ue),H[2]+=.1,G[2]+=.1,h.emplaceBack(oe[0],oe[1],oe[2]),h.emplaceBack(ue[0],ue[1],ue[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(G[0],G[1],G[2]),h.emplaceBack(Y[0],Y[1],Y[2]),h.emplaceBack(J[0],J[1],J[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(G[0],G[1],G[2]),h.emplaceBack(oe[0],oe[1],oe[2]),h.emplaceBack(ue[0],ue[1],ue[2]);const pe=V/A/2;m.emplaceBack(-pe-N,-1,pe,.8),m.emplaceBack(pe+N,-1,pe,.8),m.emplaceBack(-pe,0,pe,1.3),m.emplaceBack(pe,0,pe,1.3),m.emplaceBack(pe+N,-.8,pe,.7),m.emplaceBack(pe+N,-.8,pe,.7),m.emplaceBack(0,0,pe,1.3),m.emplaceBack(0,0,pe,1.3),m.emplaceBack(pe+N,-1.2,pe,.8),m.emplaceBack(pe+N,-1.2,pe,.8),a.emplaceBack(6+x,4+x,8+x),a.emplaceBack(7+x,9+x,5+x),a.emplaceBack(0+x,1+x,2+x),a.emplaceBack(1+x,3+x,2+x),x+=10}}function $X(c,i){const a={};a.indexArray=new ys,a.vertexArray=new Wa,a.colorArray=new Vu,g6(c,i,a.indexArray,a.vertexArray,a.colorArray);const h={defined:!0};h.emissiveFactor=Wi.black;const m={};return m.baseColorFactor=Wi.white,h.pbrMetallicRoughness=m,a.material=h,a.aabb=new Gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const y6=di([{name:"a_pos_3f",components:3,type:"Float32"}]),WX=di([{name:"a_normal_3",components:3,type:"Int16"}]),qX=di([{name:"a_centroid_3",components:3,type:"Int16"}]),x6=di([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),XX=di([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),ZX=di([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),QX=di([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),KX=di([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),YX=di([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),_6=Jt.types,J2=32767;function JX(c,i){const a=xn+i;for(const h of c)for(const m of h)if(m.x<-i||m.x>a||m.y<-i||m.y>a)return!1;return!0}class v6{constructor(){this.layoutVertexArray=new Wa,this.layoutAttenuationArray=new Vu,this.layoutColorArray=new Dl,this.indexArray=new ys,this.indexArrayForConflation=new ys,this.segmentsBucket=new Li}}class N3{constructor(){this.layoutVertexArray=new Wa,this.layoutNormalArray=new Bh,this.layoutCentroidArray=new Bh,this.layoutColorArray=new Dl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new qf,this.layoutAOArray=new kc,this.indexArray=new ys,this.indexArrayForConflation=new ys,this.segmentsBucket=new Li,this.entranceBloom=new v6}}class b6{constructor(i){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new N3,this.buildingWithFacade=new N3,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.lut=i.lut,this.buildingWithFacade.layoutFacadePaintArray=new Dl,this.buildingWithFacade.layoutFacadeDataArray=new Uu,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Dl,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=i.projection,this.groundEffect=new y3(i),this.groundEffect.groundRadiusArray=new kc,this.hasAppearances=null}updateFootprints(i,a){for(const h of this.footprints)a.push({footprint:h,id:i})}updateAppearances(i,a,h,m){}prepare(){return(function(){if($2!=null||e6!=null)return null;if(v_!=null)return v_;const i=fetch(ii.BUILDING_GEN_URL);return v_=(function(a){let h,m,x,_;function A(){h=new Uint8Array(_.buffer),m=new Int32Array(_.buffer),x=new Float32Array(_.buffer)}function P(){throw new Error("Unexpected BuildingGen error.")}const N=()=>{},V={a:{a:P,f:function(H){const G=h.length,Y=Math.max(H>>>0,Math.ceil(1.2*G)),J=Math.ceil((Y-G)/65536);try{return _.grow(J),A(),!0}catch{return!1}},g:P,b:N,c:N,d:N,e:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,V):a.then((H=>H.arrayBuffer())).then((H=>WebAssembly.instantiate(H,V)))).then((H=>{const G=H.instance.exports;return(0,G.g)(),_=G.f,A(),new EX({setStyle:G.h,setAOOptions:G.i,setMetricOptions:G.j,setStructuralOptions:G.k,setFacadeOptions:G.l,setFauxFacadeOptions:G.m,setFacadeClassifierOptions:G.n,addFeature:G.o,addFacade:G.p,generateMesh:G.q,getLastError:G.r,getOuterRingLength:G.s,getMeshCount:G.t,getPositionsPtr:G.u,getPositionsLength:G.v,getNormalsPtr:G.w,getNormalsLength:G.x,getColorsPtr:G.y,getColorsLength:G.z,getAOPtr:G.A,getAOLength:G.B,getUVPtr:G.C,getUVLength:G.D,getFauxFacadePtr:G.E,getFauxFacadeLength:G.F,getIndicesPtr:G.G,getIndicesLength:G.H,getBuildingPart:G.I,getRingCount:G.J,getRingPtr:G.K,getRingLength:G.L,free:G.M,malloc:G.N,heapU8:h,heap32:m,heapF32:x})}))})(i).then((a=>(v_=null,$2=a,$2))).catch((a=>{It("Could not load building-gen"),v_=null,e6=a})),v_})()}populate(i,a,h,m){const x=AX();if(!x)return;const _=Qe(h);this.tileToMeter=_,this.brightness=a.brightness,x.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),x.setAOOptions(!1,.3),x.setMetricOptions(!1,16),x.setStructuralOptions(!0),x.setFacadeClassifierOptions(3);const A=new Map,P=new Map;for(const{feature:N}of i){if(_6[N.type]!=="LineString"){A.set(N.id,N.properties.source_id);continue}const V=this.layers[0]._featureFilter.needGeometry,H=Mt(N,V);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom),H,h))continue;const G=V?H.geometry:zt(N,h,m),Y=[];for(const pe of G)for(const we of pe)Y.push({x:we.x,y:we.y});const J={coordinates:Y,crossPerc:N.properties.cross_perc,distanceToRoad:N.properties.distance_to_road,entrances:N.properties.entrances,sourceId:0},oe=N.properties.source_id;let ue=P.get(oe);ue||(ue=[],P.set(oe,ue)),ue.push(J)}this.maxHeight=0;for(const{feature:N,id:V,index:H,sourceLayerIndex:G}of i){if(_6[N.type]==="LineString")continue;const Y=this.layers[0]._featureFilter.needGeometry,J=Mt(N,Y);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom),J,h))continue;const oe=Y?J.geometry:zt(N,h,m),ue=Bb(oe,500);if(!JX(oe,163))continue;const pe=this.layers[0],we=pe.layout.get("building-roof-shape").evaluate(N,{},h);if(we==="flat")continue;const Te=pe.layout.get("building-base").evaluate(N,{},h),Ie=pe.layout.get("building-height").evaluate(N,{},h),Ze=pe.layout.get("building-flood-light-ground-radius").evaluate(N,{},h),Ve=pe.paint.get("building-ambient-occlusion-intensity"),Ye=Ze/this.tileToMeter;let nt=pe.layout.get("building-flood-light-wall-radius").evaluate(N,{},h);nt=ve(nt,0,2048);const ot=nt/2048*J2,Ot=A.get(V);let pt;pt=P.has(Ot)?P.get(Ot):[];const Ut=pt.length!==0&&pe.layout.get("building-facade").evaluate(N,{},h);x.setFacadeOptions(4,!0),x.setFauxFacadeOptions(Ut,!1,1);let Zt=0,en=0,vn=0,an=0,Qt=0,sn=0;if(Ut){let Wt=Math.round(pe.layout.get("building-facade-floors").evaluate(N,{},h));if(Te===0){Wt=Math.max(1,Wt-(pt.length>0?1:0));let rr=4;if(Ie>100){const tr=[10,13,15];rr=tr[N.id?N.id%tr.length:0],x.setFacadeOptions(rr,!0)}Qt=1.6803*rr/_}else Qt=Te/_;sn=Ie/_,Qt=Math.min(Qt,sn),vn=pe.layout.get("building-facade-unit-width").evaluate(N,{},h)/_,an=(sn-Qt)/Wt,x.setFauxFacadeOptions(!0,!0,vn);const kn=pe.layout.get("building-facade-window").evaluate(N,{},h);Zt=kn[0],en=kn[1]}const jt=[],Rt=new Ht(1/0,1/0),nn=new Ht(-1/0,-1/0),gn=new Ht(0,0);let Yt=0;for(const Wt of ue)if(Wt.length>0){const kn=[];for(const rr of Wt){const tr=[];for(let Jr=rr.length-1;Jr>=0;Jr--){const Mr=rr[Jr];tr.push({x:Mr.x,y:Mr.y}),Rt.x=Math.min(Rt.x,Mr.x),Rt.y=Math.min(Rt.y,Mr.y),nn.x=Math.max(nn.x,Mr.x),nn.y=Math.max(nn.y,Mr.y),gn.x+=Mr.x,gn.y+=Mr.y,Yt++}kn.push(tr)}jt.push({id:N.id?N.id:0,height:Ie,minHeight:Te,sourceId:0,roofType:we,coordinates:kn})}gn.x/=Yt||1,gn.y/=Yt||1;const zn=x.generateMesh(jt,pt);if(typeof zn=="string"){It(`Unable to generate building ${N.id}: ${zn}`);continue}if(zn.meshes.length===0||zn.modifiedPolygonRings.length===0)continue;let Zn=0;for(const Wt of zn.meshes)Zn+=Wt.positions.length/3;const jn=Ut?this.buildingWithFacade:this.buildingWithoutFacade,Mn=jn.segmentsBucket.prepareSegment(Zn,jn.layoutVertexArray,jn.indexArray),Fr=[];let Rn=null,br=0,Ur=-1;const fi=jn.layoutVertexArray.length,Pi=jn.indexArray.length;let Wr=0;for(const Wt of zn.meshes){const kn=jn.layoutVertexArray.length;if(Wt.buildingPart==="entrance"){const Yn=new Array;for(let ki=0;ki<Wt.positions.length;ki+=12){const ls=Wt.positions[ki+0],es=Wt.positions[ki+1],Hs=Wt.positions[ki+3],As=Wt.positions[ki+4],fs=Wt.positions[ki+2],is=Wt.positions[ki+8]-fs,Gi=1,ei=Hs-ls,$i=As-es,ps=Math.hypot(ei,$i);Yn.push({pos:[ls+.5*ei,es+.5*$i,fs],normal:[$i/ps,-ei/ps,0],width:ps,height:is,depth:Gi,points:[ls,es,Hs,As]})}const Bi=jn.entranceBloom.segmentsBucket.prepareSegment(10*Yn.length,jn.entranceBloom.layoutVertexArray,jn.entranceBloom.indexArray),as=jn.entranceBloom.layoutVertexArray.length;br=jn.entranceBloom.indexArray.length,g6(Yn,.5/this.tileToMeter,jn.entranceBloom.indexArray,jn.entranceBloom.layoutVertexArray,jn.entranceBloom.layoutAttenuationArray);const Rr=jn.entranceBloom.layoutVertexArray.length-as;Ur=jn.entranceBloom.indexArray.length-br;for(let ki=0;ki<Rr;ki++)jn.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Bi.vertexLength+=Rr,Bi.primitiveLength+=Ur,Rn={part:Wt.buildingPart,vertexOffset:as,vertexLength:Rr}}for(let Yn=0;Yn<Wt.positions.length;Yn+=3)Wr=Math.max(Wr,Wt.positions[Yn+2]),jn.layoutVertexArray.emplaceBack(Wt.positions[Yn],Wt.positions[Yn+1],Wt.positions[Yn+2]);const rr=Math.floor(gn.x),tr=Math.floor(gn.y),Jr=Math.floor(Wr);for(let Yn=0;Yn<Wt.positions.length;Yn+=3)jn.layoutCentroidArray.emplaceBack(rr,tr,Jr),jn.layoutFloodLightDataArray.emplaceBack(Wt.buildingPart==="wall"?ot:0);for(let Yn=0;Yn<Wt.normals.length;Yn+=3)jn.layoutNormalArray.emplaceBack(Wt.normals[Yn+0]*J2,Wt.normals[Yn+1]*J2,Wt.normals[Yn+2]*J2);for(let Yn=0;Yn<Wt.ao.length;Yn++)jn.layoutAOArray.emplaceBack(Wt.ao[Yn]);for(let Yn=0;Yn<Wt.colors.length;Yn+=3){const Bi=1+(Wt.ao[Yn/3]-1)*Ve;jn.layoutColorArray.emplaceBack(Wt.colors[Yn]*Bi<<8|Wt.colors[Yn+1]*Bi,Wt.colors[Yn+2]*Bi<<8)}if(Ut){for(let Yn=0;Yn<Wt.positions.length;Yn+=3)jn.layoutFacadePaintArray.emplaceBack(65535,255);for(let Yn=0;Yn<Wt.isFauxFacade.length;Yn++)if(Wt.isFauxFacade[Yn]){const Bi=1|Math.min(65535,Math.floor(Wt.uv[2*Yn]*zn.outerRingLength)),as=Math.floor(255*Zt)<<8|Math.floor(255*en),Rr=Math.floor(65535*Math.min(1,vn/xn)),ki=Math.floor(65535*Math.min(1,an/xn));jn.layoutFacadeDataArray.emplaceBack(Bi,as,Rr,ki);const ls=Math.floor(65535*Math.min(1,Qt/xn)),es=Math.floor(65535*Math.min(1,sn/xn));jn.layoutFacadeVerticalRangeArray.emplaceBack(ls,es)}else jn.layoutFacadeDataArray.emplaceBack(0,0,0,0),jn.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Mr=Mn.vertexLength;for(let Yn=0;Yn<Wt.indices.length;Yn+=3)jn.indexArray.emplaceBack(Mr+Wt.indices[Yn],Mr+Wt.indices[Yn+1],Mr+Wt.indices[Yn+2]);Mn.vertexLength+=Wt.positions.length/3,Mn.primitiveLength+=Wt.indices.length/3,(Wt.buildingPart==="roof"||Wt.buildingPart==="wall"||Wt.buildingPart==="facade_glazing"||Wt.buildingPart==="entrance")&&Fr.push({part:Wt.buildingPart,vertexOffset:kn,vertexLength:Wt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Wr),this.buildingFeatures.push({promoteId:V,feature:J,hasFauxFacade:Ut,segment:Mn,parts:Fr,buildingBloom:Rn});const Vi=jn.indexArray.length-Pi,Hi=[],Ds=[],Ge=new Ht(1/0,1/0),Be=new Ht(-1/0,-1/0),$t=this.groundEffect.vertexArray.length;for(const Wt of zn.modifiedPolygonRings){const kn=[],rr=new Ht(1/0,1/0),tr=new Ht(-1/0,-1/0);for(let Jr=0;Jr<Wt.length;Jr+=2){const Mr=Wt.length-Jr-2;rr.x=Math.min(rr.x,Wt[Mr]),rr.y=Math.min(rr.y,Wt[Mr+1]),tr.x=Math.max(tr.x,Wt[Mr]),tr.y=Math.max(tr.y,Wt[Mr+1]);const Yn=new Ht(Wt[Mr],Wt[Mr+1]);kn.push(Yn),Hi.push(Yn.x,Yn.y),Ds.push(Yn.clone())}Ge.x=Math.min(Ge.x,rr.x),Ge.y=Math.min(Ge.y,rr.y),Be.x=Math.max(Be.x,tr.x),Be.y=Math.max(Be.y,tr.y),this.groundEffect.addData(kn,[rr,tr],Ye)}const An=this.groundEffect.vertexArray.length-$t;for(let Wt=0;Wt<An;Wt++)this.groundEffect.groundRadiusArray.emplaceBack(Ze);(Rt.x<0||nn.x>xn||Rt.y<0||nn.y>xn)&&this.featuresOnBorder.push({featureId:N.id,footprintIndex:this.footprints.length});{const Wt=m_(Hi,null,2),kn=new F2(Ds,Wt,8,256);let rr=N.id;N.properties&&N.properties.hasOwnProperty("building_id")&&(rr=N.properties.building_id);const tr={vertices:Ds,indices:Wt,grid:kn,min:Ge,max:Be,buildingId:rr,hiddenFlags:0,indicesOffset:Pi,indicesLength:Vi,bloomIndicesOffset:br,bloomIndicesLength:Ur,groundEffectVertexOffset:$t,groundEffectVertexLength:An,hasFauxFacade:Ut,segment:Mn,height:Wr};N.id!==void 0&&this.featureFootprintLookup.set(N.id,this.footprints.length),this.footprints.push(tr)}this.programConfigurations.populatePaintArrays(jn.layoutVertexArray.length,N,H,{},a.availableImages,h,a.brightness),this.groundEffect.addPaintPropertiesData(N,H,{},a.availableImages,h,a.brightness),a.featureIndex.insert(N,oe,H,G,this.index,fi)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(i,a,h,m,x,_,A){this.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A),this.groundEffect.update(i,a,x,h,m,_,A),this.evaluate(this.layers[0],i),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){const a=h=>{h.layoutVertexBuffer=i.createVertexBuffer(h.layoutVertexArray,y6.members),h.layoutNormalBuffer=i.createVertexBuffer(h.layoutNormalArray,WX.members),h.layoutCentroidBuffer=i.createVertexBuffer(h.layoutCentroidArray,qX.members),h.layoutFloodLightDataBuffer=i.createVertexBuffer(h.layoutFloodLightDataArray,YX.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=i.createVertexBuffer(h.layoutFacadeDataArray,ZX.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=i.createVertexBuffer(h.layoutFacadeVerticalRangeArray,QX.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(h.entranceBloom.layoutVertexArray,y6.members),h.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,KX.members)),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){const i=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(i,a,h=!0){let m=!1;const x=h?a:0,_=0|(h?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const A of i){const P=this.footprints[A],N=P.hiddenFlags&_|x;P.hiddenFlags!==N&&(P.hiddenFlags=N,m=!0,this.groundEffect.updateHiddenByLandmarkRange(P.groundEffectVertexOffset,P.groundEffectVertexLength,P.hiddenFlags!==0))}return m&&(this.indexArrayForConflationUploaded=!1),m}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),this.indexArrayForConflationUploaded)return;const a=m=>{m.indexArray.length!==0&&(m.indexArrayForConflation.resize(m.indexArray.length),m.indexArrayForConflation.uint16.set(m.indexArray.uint16),m.entranceBloom.indexArrayForConflation.resize(m.entranceBloom.indexArray.length),m.entranceBloom.indexArrayForConflation.uint16.set(m.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const m of this.footprints){const x=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=m.indicesOffset+m.indicesLength;if(m.hiddenFlags!==0){for(let P=m.indicesOffset;P<_;P++)x.indexArrayForConflation.uint16[3*P+0]=0,x.indexArrayForConflation.uint16[3*P+1]=0,x.indexArrayForConflation.uint16[3*P+2]=0;const A=m.bloomIndicesOffset+m.bloomIndicesLength;for(let P=m.bloomIndicesOffset;P<A;P++)x.entranceBloom.indexArrayForConflation.uint16[3*P+0]=0,x.entranceBloom.indexArrayForConflation.uint16[3*P+1]=0,x.entranceBloom.indexArrayForConflation.uint16[3*P+2]=0}}const h=m=>{m.indexArray.length!==0&&(m.indexBuffer?m.indexBuffer.updateData(m.indexArrayForConflation):m.indexBuffer=i.createIndexBuffer(m.indexArrayForConflation,!0),m.entranceBloom.indexBuffer?m.entranceBloom.indexBuffer.updateData(m.entranceBloom.indexArrayForConflation):m.entranceBloom.indexBuffer=i.createIndexBuffer(m.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(i){const a=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=i.createVertexBuffer(h.layoutColorArray,x6.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=i.createVertexBuffer(h.layoutFacadePaintArray,XX.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=i.createVertexBuffer(h.entranceBloom.layoutColorArray,x6.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(i,a){const h=i.paint.get("building-ambient-occlusion-intensity");for(const m of this.buildingFeatures){const x=a[m.promoteId],_=m.feature;_.properties["building-part"]="roof";const A=i.paint.get("building-color").evaluate(_,x,this.canonical).toPremultipliedRenderColor(this.lut),P=i.paint.get("building-emissive-strength").evaluate(_,x,this.canonical);_.properties["building-part"]="wall";const N=i.paint.get("building-color").evaluate(_,x,this.canonical).toPremultipliedRenderColor(this.lut),V=i.paint.get("building-emissive-strength").evaluate(_,x,this.canonical);_.properties["building-part"]="window";const H=i.paint.get("building-color").evaluate(_,x,this.canonical).toPremultipliedRenderColor(this.lut),G=i.paint.get("building-emissive-strength").evaluate(_,x,this.canonical);_.properties["building-part"]="door";const Y=i.paint.get("building-color").evaluate(_,x,this.canonical).toPremultipliedRenderColor(this.lut),J=i.paint.get("building-emissive-strength").evaluate(_,x,this.canonical),oe=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const pe of m.parts){let we,Te=A;pe.part==="roof"?(Te=A,we=P):pe.part==="wall"?(Te=N,we=V):pe.part==="facade_glazing"?(Te=H,we=G):pe.part==="entrance"&&(Te=Y,we=J),we=ve(we,0,1);for(let Ie=0;Ie<pe.vertexLength;Ie++){const Ze=pe.vertexOffset+Ie,Ve=1+(oe.layoutAOArray.float32[Ze]-1)*h;oe.layoutColorArray.emplace(Ze,Te.r*Ve*255<<8|Te.g*Ve*255,Te.b*Ve*255<<8|255*we),m.hasFauxFacade&&oe.layoutFacadePaintArray.emplace(Ze,255*H.r<<8|255*H.g,255*H.b<<8|255*G)}}const ue=m.buildingBloom;if(ue)for(let pe=0;pe<ue.vertexLength;pe++)oe.entranceBloom.layoutColorArray.emplace(ue.vertexOffset+pe,255*Y.r<<8|255*Y.g,255*Y.b<<8|51*J)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(i,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const m=a.getReplacementRegionsForTile(i.toUnwrapped());if(z2(this.activeReplacements,m))return;this.activeReplacements=m;for(const _ of this.footprints)_.hiddenFlags&=-2;const x=[];for(const _ of this.activeReplacements){if(_.order<=w4)continue;const A=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const P of this.footprints)P.min.x>_.max.x||P.max.x<_.min.x||P.min.y>_.max.y||P.max.y<_.min.y||(x.length=0,eZ(P.vertices,0,P.vertices.length,_.footprintTileId.canonical,i.canonical,x),f3(_.footprint,x,P.indices,0,P.indices.length,0,-A)&&(P.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(i){if(i.id!==void 0){const a=this.featureFootprintLookup.get(i.id);return this.footprints[a]}return null}getHeightAtTileCoord(i,a){let h=Number.NEGATIVE_INFINITY,m=!0;const x=4*(i+xn)*xn+(a+xn);if(this.footprintLookup.hasOwnProperty(x)){const A=this.footprintLookup[x];return A?{height:A.height,hidden:A.hiddenFlags!==0}:void 0}const _=new Ht(i,a);for(const A of this.footprints)i>A.max.x||A.min.x>i||a>A.max.y||A.min.y>a||A.height<=h||p3(_,A)&&(h=A.height,this.footprintLookup[x]=A,m=A.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:m};this.footprintLookup[x]=void 0}}function eZ(c,i,a,h,m,x){const _=Math.pow(2,h.z-m.z);for(let A=0;A<a;A++){let P=c[A+i].x,N=c[A+i].y;P=(P+m.x*xn)*_-h.x*xn,N=(N+m.y*xn)*_-h.y*xn,x.push(new Ht(P,N))}}let w6,S6;Fn(b6,"BuildingBucket",{omit:["layers"]}),Fn(N3,"BuildingGeometry"),Fn(v6,"BuildingBloomGeometry");const tZ=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),nZ=di([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:rZ}=tZ,iZ=di([{name:"a_packed",components:3,type:"Float32"}]),{members:sZ}=iZ,oZ=di([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:aZ}=oZ;class T6{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Jg({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const h=this.getKey(i,a);return this.positions[h]}trim(){const i=this.width,a=this.height=ct(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,h){const m=[];let x=i.length%2==1?-i[i.length-1]*h:0,_=i[0]*h,A=!0;m.push({left:x,right:_,isDash:A,zeroLength:i[0]===0});let P=i[0];for(let N=1;N<i.length;N++){A=!A;const V=i[N];x=P*h,P+=V,_=P*h,m.push({left:x,right:_,isDash:A,zeroLength:V===0})}return m}addRoundDash(i,a,h){const m=a/2;for(let x=-h;x<=h;x++){const _=this.width*(this.nextRow+h+x);let A=0,P=i[A];for(let N=0;N<this.width;N++){N/P.right>1&&(P=i[++A]);const V=Math.abs(N-P.left),H=Math.abs(N-P.right),G=Math.min(V,H);let Y;const J=x/h*(m+1);if(P.isDash){const oe=m-Math.abs(J);Y=Math.sqrt(G*G+oe*oe)}else Y=m-Math.sqrt(G*G+J*J);this.image.data[_+N]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(i,a){for(let P=i.length-1;P>=0;--P){const N=i[P],V=i[P+1];N.zeroLength?i.splice(P,1):V&&V.isDash===N.isDash&&(V.left=N.left,i.splice(P,1))}const h=i[0],m=i[i.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const x=this.width*this.nextRow;let _=0,A=i[_];for(let P=0;P<this.width;P++){P/A.right>1&&(A=i[++_]);const N=Math.abs(P-A.left),V=Math.abs(P-A.right),H=Math.min(N,V);this.image.data[x+P]=Math.max(0,Math.min(255,(A.isDash?H:-H)+a+128))}}addDash(i,a){const h=this.getKey(i,a);if(this.positions[h])return this.positions[h];const m=a==="round",x=m?7:0,_=2*x+1;if(this.nextRow+_>this.height)return It("LineAtlas out of space"),null;i.length===0&&i.push(1);let A=0;for(let V=0;V<i.length;V++)i[V]<0&&(It("Negative value is found in line dasharray, replacing values with 0"),i[V]=0),A+=i[V];if(A!==0){const V=this.width/A,H=this.getDashRanges(i,this.width,V);m?this.addRoundDash(H,V,x):this.addRegularDash(H,a==="square"?.5*V:0)}const P=this.nextRow+x;this.nextRow+=_;const N={tl:[P,x],br:[A,0]};return this.positions[h]=N,N}}Fn(T6,"LineAtlas");const lZ=Jt.types,cZ=Math.cos(Math.PI/180*37.5),uZ=Math.cos(Math.PI/180*5);class j3{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new hm,this.layoutVertexArray2=new Wa,this.patternVertexArray=new Wa,this.indexArray=new ys,this.programConfigurations=new ml(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Li,this.maxLineLength=0,this.zOffsetVertexArray=new Wa,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.tessellationStep=i.tessellationStep?i.tessellationStep:xn/64,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,h,m){}populate(i,a,h,m){this.hasPattern=a3("line",this.layers,this.pixelRatio,a);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Qe(h);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const G=this.layers[0].layout.get("line-z-offset"),Y=G.isConstant()&&!G.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&Y?"none":"offset",this.elevationType==="offset"&&_==="none"&&It(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&A!==void 0;const P=[];for(const{feature:G,id:Y,index:J,sourceLayerIndex:oe}of i){const ue=this.layers[0]._featureFilter.needGeometry,pe=Mt(G,ue);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),pe,h))continue;const we=x?x.evaluate(pe,{},h):void 0,Te={id:Y,properties:G.properties,type:G.type,sourceLayerIndex:oe,index:J,geometry:ue?pe.geometry:zt(G,h,m),patterns:{},sortKey:we};P.push(Te)}x&&P.sort(((G,Y)=>G.sortKey-Y.sortKey));const{lineAtlas:N,featureIndex:V}=a,H=this.addConstantDashes(N);for(const G of P){const{geometry:Y,index:J,sourceLayerIndex:oe}=G;if(H&&this.addFeatureDashes(G,N),this.hasPattern){const ue=l3("line",this.layers,G,this.zoom,this.pixelRatio,a);this.patternFeatures.push(ue)}else this.addFeature(G,Y,J,h,N.positions,a.availableImages,a.brightness,a.elevationFeatures);V.insert(i[J].feature,Y,J,oe,this.index)}}addConstantDashes(i){let a=!1;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(m.kind!=="constant"||x.kind!=="constant")a=!0;else{const _=x.value,A=m.value;if(!A)continue;i.addDash(A,_)}}return a}addFeatureDashes(i,a){const h=this.zoom;for(const m of this.layers){const x=m.paint.get("line-dasharray").value,_=m.layout.get("line-cap").value;if(x.kind==="constant"&&_.kind==="constant")continue;let A,P;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:h},i);P=_.kind==="constant"?_.value:_.evaluate({zoom:h},i),a.addDash(A,P),i.patterns[m.id]=[a.getKey(A,P)]}}update(i,a,h,m,x,_,A,P){this.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,P)}addFeatures(i,a,h,m,x,_){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,a,h,m,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,sZ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,aZ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,nZ.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rZ),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i,a){let h,m;if(a&&a>0?(h=`mapbox_clip_start_${a}`,m=`mapbox_clip_end_${a}`):(h="mapbox_clip_start",m="mapbox_clip_end"),i.properties&&i.properties.hasOwnProperty(h)&&i.properties.hasOwnProperty(m))return{start:+i.properties[h],end:+i.properties[m]}}addFeature(i,a,h,m,x,_,A,P){const N=this.layers[0].layout,V=N.get("line-join").evaluate(i,{}),H=N.get("line-cap").evaluate(i,{}),G=N.get("line-miter-limit"),Y=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i;const J=!(!i.properties||!i.properties.hasOwnProperty("mapbox_line_metrics"))&&i.properties.mapbox_line_metrics;this.zOffsetValue=N.get("line-z-offset").value;const oe=this.layers[0].paint.get("line-width").value;if(oe.kind!=="constant"&&oe.isLineProgressConstant===!1&&(this.variableWidthValue=oe),this.elevationType==="road"){const ue=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,a,m,P,V,H,G,Y)){const[pe,we]=this.clipRuntimeLinesToTile(a,1);for(let Te=0;Te<pe.length;Te++){const Ie=pe[Te],Ze=we[Te],Ve={progress:{min:Ze.progress.min,max:Ze.progress.max},nextDir:this.computeSegNextDir(Ze,Ie),prevDir:this.computeSegPrevDir(Ze,Ie)};this.addLine(Ie,i,m,V,H,G,Y,Ve,J&&Ze.parentIndex>0?Ze.parentIndex:null)}this.fillNonElevatedRoadSegment(ue)}}else for(let ue=0;ue<a.length;ue++)this.addLine(a[ue],i,m,V,H,G,Y,void 0,J&&ue>0?ue:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,x,_,m,A,void 0,this.worldview)}computeSegNextDir(i,a){return i.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(i,a){return a[1].sub(i.prevPoint).unit()}clipLinesToTile(i,a){return H2(i,-a,-a,xn+a,xn+a)}clipRuntimeLinesToTile(i,a){const h=[];return[H2(i,-a,-a,xn+a,xn+a,h),h]}addElevatedRoadFeature(i,a,h,m,x,_,A,P){const N=[],V=Pr.getElevationFeature(i,m);if(V){const H=this.clipLinesToTile(a,1),G=this.prepareElevatedLines(H,V,h);for(const Y of G)N.push({geometry:Y,elevation:V,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(N.length===0)return!1;for(const H of N){const G=this.layoutVertexArray.length;this.addLine(H.geometry,i,h,x,_,A,P);const Y=new Si(h,H.elevationTileID);if(H.elevation)for(let J=G;J<this.layoutVertexArray.length;J++){const oe=new Ht(this.layoutVertexArray.int16[6*J]>>1,this.layoutVertexArray.int16[6*J+1]>>1),ue=Y.pointElevation(oe,H.elevation,.05);this.updateHeightRange(ue),this.zOffsetVertexArray.emplaceBack(ue,0,0)}else this.fillNonElevatedRoadSegment(G)}return!0}prepareElevatedLines(i,a,h){if(a.constantHeight!=null)return i;const m=[],x=1/Qe(h);for(const _ of i)wX(_,new os(a,x),0,m);return m}fillNonElevatedRoadSegment(i){for(let a=i;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,a,h,m,x,_,A,P,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=N?this.lineFeatureClips(a,N):this.lineClips;const V=m==="none";this.patternJoinNone=this.hasPattern&&V,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const H=P&&P.progress.min>0,G=P&&P.progress.max<1;if(this.lineClips){let ot={min:this.lineClips.start,max:this.lineClips.end},Ot=1;if(P){const Zt=this.lineClips.end-this.lineClips.start;ot=(function(en,vn,an){return{min:li(en.min,vn,an),max:li(en.max,vn,an)}})(P.progress,{min:0,max:1},ot),Zt>0&&(Ot=(ot.max-ot.min)/Zt)}const pt=+a.properties.mapbox_clip_feature_len,Ut=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(pt)||Number.isNaN(Ut)){for(let en=0;en<i.length-1;en++)this.totalDistance+=i[en].dist(i[en+1]);const Zt=this.totalDistance/(ot.max-ot.min);this.totalFeatureLength=Number.isFinite(Zt)?Zt:0,this.lineClips.start=ot.min,this.lineClips.end=ot.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=pt,this.distance=Ut*Ot,this.lineClips.start=ot.min,this.lineClips.end=ot.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Y=lZ[a.type]==="Polygon";let J=i.length;for(;J>=2&&i[J-1].equals(i[J-2]);)J--;let oe=0;for(;oe<J-1&&i[oe].equals(i[oe+1]);)oe++;if(J<(Y?3:2))return;m==="bevel"&&(_=1.05);const ue=this.segments.prepareSegment(10*J,this.layoutVertexArray,this.indexArray);let pe,we,Te,Ie,Ze,Ve,Ye,nt;P&&P.prevDir&&(Ve=P.prevDir.perp()),P&&P.nextDir&&(Ye=P.nextDir.perp()),this.e1=this.e2=-1,Y&&(pe=i[J-2],Ze=i[oe].sub(pe)._unit()._perp());for(let ot=oe;ot<J;ot++){if(Te=ot===J-1?Y?i[oe+1]:void 0:i[ot+1],Te&&i[ot].equals(Te))continue;Ze&&(Ie=Ze),pe&&(we=pe),pe=i[ot],nt=this.evaluateLineProgressFeatures(we?we.dist(pe):0),Ze=Te?Te.sub(pe)._unit()._perp():Ie,Ie=Ie||Ze;const Ot=we&&Te;let pt=Ot?m:Y||V?"butt":x;const Ut=Ie.x*Ze.x+Ie.y*Ze.y;if(V){const Rt=function(nn){if(nn.patternJoinNone){const gn=nn.segmentPoints.length/2,Yt=nn.lineSoFar-nn.segmentStart;for(let zn=0;zn<gn;++zn){const Zn=nn.segmentPoints[2*zn+1],jn=Math.round(nn.segmentPoints[2*zn])+.5+.25*Zn;nn.patternVertexArray.emplaceBack(jn,Yt,nn.segmentStart),nn.patternVertexArray.emplaceBack(jn,Yt,nn.segmentStart)}nn.segmentPoints.length=0}nn.e1=nn.e2=-1};if(Ot&&Ut<uZ){this.updateDistance(we,pe),this.addCurrentVertex(pe,Ie,1,1,ue,nt),Rt(this),this.addCurrentVertex(pe,Ze,-1,-1,ue,nt);continue}if(we){if(!Te){this.updateDistance(we,pe),this.addCurrentVertex(pe,Ie,1,1,ue,nt),Rt(this);continue}pt="miter"}}let Zt=Ie.add(Ze);Zt.x===0&&Zt.y===0||Zt._unit();const en=Zt.x*Ze.x+Zt.y*Ze.y,vn=en!==0?1/en:1/0,an=2*Math.sqrt(2-2*en),Qt=en<cZ&&we&&Te,sn=Ie.x*Ze.y-Ie.y*Ze.x>0,jt=this.overscaling<=16?15*xn/(512*this.overscaling):0;if(Ot&&pt==="round"){if(vn<A)pt="miter";else if(vn<=2){const Rt=D3(pe,-10,xn+10);pt=this.elevationType==="offset"&&(Rt||this.hasCrossSlope)?"miter":"fakeround"}}if(pt==="miter"&&vn>_&&(pt="bevel"),pt==="bevel"&&(vn>2&&(pt="flipbevel"),vn<_&&(pt="miter")),we&&!(pt==="miter"&&Qt)&&this.updateDistance(we,pe),pt==="miter")if(Qt){const Rt=pe.dist(we);if(Rt>2*jt){const gn=pe.sub(pe.sub(we)._mult(jt/Rt)._round());this.updateDistance(we,gn),this.addCurrentVertex(gn,Ie,0,0,ue,nt),we=gn}this.updateDistance(we,pe),Zt._mult(vn),this.addCurrentVertex(pe,Zt,0,0,ue,nt);const nn=pe.dist(Te);if(nn>2*jt){const gn=pe.add(Te.sub(pe)._mult(jt/nn)._round());this.updateDistance(pe,gn),this.addCurrentVertex(gn,Ze,0,0,ue,nt),pe=gn}}else Zt._mult(vn),this.addCurrentVertex(pe,Zt,0,0,ue,nt);else if(pt==="flipbevel"){if(vn>100)Zt=Ze.mult(-1);else{const Rt=vn*Ie.add(Ze).mag()/Ie.sub(Ze).mag();Zt._perp()._mult(Rt*(sn?-1:1))}this.addCurrentVertex(pe,Zt,0,0,ue,nt),this.addCurrentVertex(pe,Zt.mult(-1),0,0,ue,nt)}else if(pt==="bevel"||pt==="fakeround"){nt!=null&&we&&this.addCurrentVertex(pe,Ye||Ie,-1,-1,ue,nt);const Rt=pe.dist(we)<=2*jt&&pt!=="bevel",nn=Zt.mult(sn?1:-1);nn._mult(vn);const gn=Ze.mult(sn?-1:1),Yt=Ie.mult(sn?-1:1),zn=this.evaluateLineProgressFeatures(this.distance);if(nt==null&&(this.addHalfVertex(pe,nn.x,nn.y,!1,!sn,0,ue,zn),Rt||this.addHalfVertex(pe,nn.x+2*Yt.x,nn.y+2*Yt.y,!1,sn,0,ue,zn)),pt==="fakeround"){const Zn=Math.round(180*an/Math.PI/20);this.addHalfVertex(pe,Yt.x,Yt.y,!1,sn,0,ue,zn);for(let jn=0;jn<Zn;jn++){let Mn=jn/Zn;if(Mn!==.5){const Rn=Mn-.5;Mn+=Mn*Rn*(Mn-1)*((1.0904+Ut*(Ut*(3.55645-1.43519*Ut)-3.2452))*Rn*Rn+(.848013+Ut*(.215638*Ut-1.06021)))}const Fr=gn.sub(Yt)._mult(Mn)._add(Yt)._unit();this.addHalfVertex(pe,Fr.x,Fr.y,!1,sn,0,ue,zn)}this.addHalfVertex(pe,gn.x,gn.y,!1,sn,0,ue,zn)}Rt||nt!=null||this.addHalfVertex(pe,nn.x+2*gn.x,nn.y+2*gn.y,!1,sn,0,ue,zn),nt!=null&&Te&&this.addCurrentVertex(pe,Ve||Ze,1,1,ue,nt)}else if(pt==="butt")this.addCurrentVertex(pe,Zt,0,0,ue,nt);else if(pt==="square"){if(!we){const Rt=H?0:-1;this.addCurrentVertex(pe,Zt,Rt,Rt,ue,nt)}if(this.addCurrentVertex(pe,Zt,0,0,ue,nt),we){const Rt=G?0:1;this.addCurrentVertex(pe,Zt,Rt,Rt,ue,nt)}}else if(pt==="round"){if(we){const Rt=!Ot&&Ye?Ye:Ie;this.addCurrentVertex(pe,Rt,0,0,ue,nt),!Ot&&G||this.addCurrentVertex(pe,Rt,1,1,ue,nt,!0)}if(Te){const Rt=!Ot&&Ve?Ve:Ze;!Ot&&H||this.addCurrentVertex(pe,Rt,-1,-1,ue,nt,!0),this.addCurrentVertex(pe,Rt,0,0,ue,nt)}}}}addVerticesTo(i,a,h,m,x,_,A,P,N,V){const H=(a.w-i.w)/this.tessellationStep|0;let G=0;const Y=this.scaledDistance;if(H>1){this.lineSoFar=i.w;const oe=(a.x-i.x)/H,ue=(a.y-i.y)/H,pe=(a.z-i.z)/H,we=(a.w-i.w)/H;for(let Te=1;Te<H;++Te){i.x+=oe,i.y+=ue,i.z+=pe,this.lineSoFar+=we,G+=we;const Ie=this.evaluateLineProgressFeatures(this.prevDistance+G);this.scaledDistance=(this.prevDistance+G)/this.totalDistance,this.addHalfVertex(i,h,m,V,!1,A,N,Ie),this.addHalfVertex(i,x,_,V,!0,-P,N,Ie)}}this.lineSoFar=a.w,this.scaledDistance=Y;const J=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,h,m,V,!1,A,N,J),this.addHalfVertex(a,x,_,V,!0,-P,N,J)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):It(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(i,a,h,m,x,_,A=!1){const P=a.x+a.y*h,N=a.y-a.x*h,V=a.y*m-a.x,H=-a.y-a.x*m;if(_!=null){const G=this.elevationType==="offset",Y=-10,J=xn+10,oe=_.zOffset,ue=new $4(i.x,i.y,oe,this.lineSoFar),pe=!!G&&D3(i,Y,J),we=this.lineSoFar,Te=this.distance;if(this.currentVertex)if(pe){const Ie=this.currentVertexIsOutside,Ze=this.currentVertex,Ve=new $4(i.x,i.y,oe,this.lineSoFar);if(q4(Ze,Ve,Y,J),!D3(Ve,Y,J)){if(Ie){this.e1=this.e2=-1,this.distance-=Ze.dist(ue),this.lineSoFar=Ze.w;const Ye=this.evaluateLineProgressFeatures(Ze.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ze,P,N,A,!1,h,x,Ye),this.addHalfVertex(Ze,V,H,A,!0,-m,x,Ye),this.prevDistance=this.distance}this.distance=this.prevDistance+Ze.dist(Ve),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ze,Ve,P,N,V,H,h,m,x,A),this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}}else{const Ie=this.currentVertex;if(this.currentVertexIsOutside){q4(Ie,ue,Y,J),this.e1=this.e2=-1,this.distance-=Ie.dist(ue),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ie.w;const Ze=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,P,N,A,!1,h,x,Ze),this.addHalfVertex(Ie,V,H,A,!0,-m,x,Ze),this.prevDistance=this.distance,this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ie,ue,P,N,V,H,h,m,x,A)}else pe||(this.addHalfVertex(i,P,N,A,!1,h,x,_),this.addHalfVertex(i,V,H,A,!0,-m,x,_));this.currentVertex=ue,this.currentVertexIsOutside=pe,this.lineSoFar=we}else this.addHalfVertex(i,P,N,A,!1,h,x,_),this.addHalfVertex(i,V,H,A,!0,-m,x,_)}addHalfVertex({x:i,y:a},h,m,x,_,A,P,N){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,A)),this.layoutVertexArray.emplaceBack((i<<1)+(x?1:0),(a<<1)+(_?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const H=Ar(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,H)}const V=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),P.primitiveLength++),_?this.e2=V:this.e1=V,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function D3(c,i,a){return c.x<i||c.x>a||c.y<i||c.y>a}let E6,A6;function C6(c,i,a){return i*(xn/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Fn(j3,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const M6=(c,i,a)=>(1-a)*c+a*i;function k6(c,i){return 1/C6(c,1,i.tileZoom)}function I6(c,i,a,h){return c.translatePosMatrix(h||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const P6=c=>{const i=[];R6(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const h=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return h&&m&&i.push("LINE_JOIN_NONE"),i};function R6(c){const i=c.paint.get("line-dasharray").value;return i.kind!=="constant"||i.value}let L3;const N6=()=>L3||(L3={layout:E6||(E6=new Ns({"line-cap":new Pn(ft.layout_line["line-cap"]),"line-join":new Pn(ft.layout_line["line-join"]),"line-miter-limit":new dn(ft.layout_line["line-miter-limit"]),"line-round-limit":new dn(ft.layout_line["line-round-limit"]),"line-sort-key":new Pn(ft.layout_line["line-sort-key"]),"line-z-offset":new Pn(ft.layout_line["line-z-offset"]),"line-elevation-reference":new dn(ft.layout_line["line-elevation-reference"]),"line-cross-slope":new dn(ft.layout_line["line-cross-slope"]),visibility:new dn(ft.layout_line.visibility),"line-width-unit":new dn(ft.layout_line["line-width-unit"])})),paint:A6||(A6=new Ns({"line-opacity":new Pn(ft.paint_line["line-opacity"]),"line-color":new Pn(ft.paint_line["line-color"]),"line-translate":new dn(ft.paint_line["line-translate"]),"line-translate-anchor":new dn(ft.paint_line["line-translate-anchor"]),"line-width":new Pn(ft.paint_line["line-width"]),"line-gap-width":new Pn(ft.paint_line["line-gap-width"]),"line-offset":new Pn(ft.paint_line["line-offset"]),"line-blur":new Pn(ft.paint_line["line-blur"]),"line-dasharray":new Pn(ft.paint_line["line-dasharray"]),"line-pattern":new Pn(ft.paint_line["line-pattern"]),"line-pattern-cross-fade":new dn(ft.paint_line["line-pattern-cross-fade"]),"line-gradient":new jh(ft.paint_line["line-gradient"]),"line-trim-offset":new dn(ft.paint_line["line-trim-offset"]),"line-trim-fade-range":new dn(ft.paint_line["line-trim-fade-range"]),"line-trim-color":new dn(ft.paint_line["line-trim-color"]),"line-emissive-strength":new dn(ft.paint_line["line-emissive-strength"]),"line-border-width":new Pn(ft.paint_line["line-border-width"]),"line-border-color":new Pn(ft.paint_line["line-border-color"]),"line-occlusion-opacity":new dn(ft.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},L3);class dZ extends Pn{possiblyEvaluate(i,a){return a=new rs(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(i,a)}evaluate(i,a,h,m){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,h,m)}}let Kb;function j6(c,i){return i>0?i+2*c:c}const hZ=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fZ=di([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pZ=di([{name:"a_projected_pos",components:4,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mZ=di([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),gZ=di([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),yZ=di([{name:"a_texb",components:2,type:"Uint16"}]),xZ=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_Z=di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const D6=di([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vZ=di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),di([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var sa=24;function bZ(c,i,a){return c.sections.forEach((h=>{h.text=(function(m,x,_){const A=x.layout.get("text-transform").evaluate(_,{});return A==="uppercase"?m=m.toLocaleUpperCase():A==="lowercase"&&(m=m.toLocaleLowerCase()),na.applyArabicShaping&&(m=na.applyArabicShaping(m)),m})(h.text,i,a)})),c}const Yb={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function wZ(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function SZ(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}const O3=4294967296,L6=1/O3,O6=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let eS=class{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,i,a=this.length){for(;this.pos<a;){const h=this.readVarint(),m=h>>3,x=this.pos;this.type=7&h,c(m,i,this),this.pos===x&&this.skip(h)}return i}readMessage(c,i){return this.readFields(c,i,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*O3;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*O3;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const i=this.buf;let a,h;return h=i[this.pos++],a=127&h,h<128?a:(h=i[this.pos++],a|=(127&h)<<7,h<128?a:(h=i[this.pos++],a|=(127&h)<<14,h<128?a:(h=i[this.pos++],a|=(127&h)<<21,h<128?a:(h=i[this.pos],a|=(15&h)<<28,(function(m,x,_){const A=_.buf;let P,N;if(N=A[_.pos++],P=(112&N)>>4,N<128||(N=A[_.pos++],P|=(127&N)<<3,N<128)||(N=A[_.pos++],P|=(127&N)<<10,N<128)||(N=A[_.pos++],P|=(127&N)<<17,N<128)||(N=A[_.pos++],P|=(127&N)<<24,N<128)||(N=A[_.pos++],P|=(1&N)<<31,N<128))return w_(m,P,x);throw new Error("Expected varint not more than 10 bytes")})(a,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,i=this.pos;return this.pos=c,c-i>=12&&O6?O6.decode(this.buf.subarray(i,c)):(function(a,h,m){let x="",_=h;for(;_<m;){const A=a[_];let P,N,V,H=null,G=A>239?4:A>223?3:A>191?2:1;if(_+G>m)break;G===1?A<128&&(H=A):G===2?(P=a[_+1],(192&P)==128&&(H=(31&A)<<6|63&P,H<=127&&(H=null))):G===3?(P=a[_+1],N=a[_+2],(192&P)==128&&(192&N)==128&&(H=(15&A)<<12|(63&P)<<6|63&N,(H<=2047||H>=55296&&H<=57343)&&(H=null))):G===4&&(P=a[_+1],N=a[_+2],V=a[_+3],(192&P)==128&&(192&N)==128&&(192&V)==128&&(H=(15&A)<<18|(63&P)<<12|(63&N)<<6|63&V,(H<=65535||H>=1114112)&&(H=null))),H===null?(H=65533,G=1):H>65535&&(H-=65536,x+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),x+=String.fromCharCode(H),_+=G}return x})(this.buf,i,c)}readBytes(){const c=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,c);return this.pos=c,i}readPackedVarint(c=[],i){const a=this.readPackedEnd();for(;this.pos<a;)c.push(this.readVarint(i));return c}readPackedSVarint(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const i=7&c;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(c,i){this.writeVarint(c<<3|i)}realloc(c){let i=this.length||16;for(;i<this.pos+c;)i*=2;if(i!==this.length){const a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*L6),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*L6),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?(function(i,a){let h,m;if(i>=0?(h=i%4294967296|0,m=i/4294967296|0):(h=~(-i%4294967296),m=~(-i/4294967296),4294967295^h?h=h+1|0:(h=0,m=m+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(x,_,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)})(h,0,a),(function(x,_){const A=(7&x)<<4;_.buf[_.pos++]|=A|((x>>>=3)?128:0),x&&(_.buf[_.pos++]=127&x|((x>>>=7)?128:0),x&&(_.buf[_.pos++]=127&x|((x>>>=7)?128:0),x&&(_.buf[_.pos++]=127&x|((x>>>=7)?128:0),x&&(_.buf[_.pos++]=127&x|((x>>>=7)?128:0),x&&(_.buf[_.pos++]=127&x)))))})(m,a)})(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const i=this.pos;this.pos=(function(h,m,x){for(let _,A,P=0;P<m.length;P++){if(_=m.charCodeAt(P),_>55295&&_<57344){if(!A){_>56319||P+1===m.length?(h[x++]=239,h[x++]=191,h[x++]=189):A=_;continue}if(_<56320){h[x++]=239,h[x++]=191,h[x++]=189,A=_;continue}_=A-55296<<10|_-56320|65536,A=null}else A&&(h[x++]=239,h[x++]=191,h[x++]=189,A=null);_<128?h[x++]=_:(_<2048?h[x++]=_>>6|192:(_<65536?h[x++]=_>>12|224:(h[x++]=_>>18|240,h[x++]=_>>12&63|128),h[x++]=_>>6&63|128),h[x++]=63&_|128)}return x})(this.buf,c,this.pos);const a=this.pos-i;a>=128&&F6(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const i=c.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=c[a]}writeRawMessage(c,i){this.pos++;const a=this.pos;c(i,this);const h=this.pos-a;h>=128&&F6(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h}writeMessage(c,i,a){this.writeTag(c,2),this.writeRawMessage(i,a)}writePackedVarint(c,i){i.length&&this.writeMessage(c,TZ,i)}writePackedSVarint(c,i){i.length&&this.writeMessage(c,EZ,i)}writePackedBoolean(c,i){i.length&&this.writeMessage(c,MZ,i)}writePackedFloat(c,i){i.length&&this.writeMessage(c,AZ,i)}writePackedDouble(c,i){i.length&&this.writeMessage(c,CZ,i)}writePackedFixed32(c,i){i.length&&this.writeMessage(c,kZ,i)}writePackedSFixed32(c,i){i.length&&this.writeMessage(c,IZ,i)}writePackedFixed64(c,i){i.length&&this.writeMessage(c,PZ,i)}writePackedSFixed64(c,i){i.length&&this.writeMessage(c,RZ,i)}writeBytesField(c,i){this.writeTag(c,2),this.writeBytes(i)}writeFixed32Field(c,i){this.writeTag(c,5),this.writeFixed32(i)}writeSFixed32Field(c,i){this.writeTag(c,5),this.writeSFixed32(i)}writeFixed64Field(c,i){this.writeTag(c,1),this.writeFixed64(i)}writeSFixed64Field(c,i){this.writeTag(c,1),this.writeSFixed64(i)}writeVarintField(c,i){this.writeTag(c,0),this.writeVarint(i)}writeSVarintField(c,i){this.writeTag(c,0),this.writeSVarint(i)}writeStringField(c,i){this.writeTag(c,2),this.writeString(i)}writeFloatField(c,i){this.writeTag(c,5),this.writeFloat(i)}writeDoubleField(c,i){this.writeTag(c,1),this.writeDouble(i)}writeBooleanField(c,i){this.writeVarintField(c,+i)}};function w_(c,i,a){return a?4294967296*i+(c>>>0):4294967296*(i>>>0)+(c>>>0)}function F6(c,i,a){const h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(h);for(let m=a.pos-1;m>=c;m--)a.buf[m+h]=a.buf[m]}function TZ(c,i){for(let a=0;a<c.length;a++)i.writeVarint(c[a])}function EZ(c,i){for(let a=0;a<c.length;a++)i.writeSVarint(c[a])}function AZ(c,i){for(let a=0;a<c.length;a++)i.writeFloat(c[a])}function CZ(c,i){for(let a=0;a<c.length;a++)i.writeDouble(c[a])}function MZ(c,i){for(let a=0;a<c.length;a++)i.writeBoolean(c[a])}function kZ(c,i){for(let a=0;a<c.length;a++)i.writeFixed32(c[a])}function IZ(c,i){for(let a=0;a<c.length;a++)i.writeSFixed32(c[a])}function PZ(c,i){for(let a=0;a<c.length;a++)i.writeFixed64(c[a])}function RZ(c,i){for(let a=0;a<c.length;a++)i.writeSFixed64(c[a])}const F3=3;function NZ(c,i,a){i.glyphs=[],c===1&&a.readMessage(jZ,i)}function jZ(c,i,a){if(c===3){const{id:h,bitmap:m,width:x,height:_,left:A,top:P,advance:N}=a.readMessage(DZ,{});i.glyphs.push({id:h,bitmap:new Jg({width:x+2*F3,height:_+2*F3},m),metrics:{width:x,height:_,left:A,top:P,advance:N}})}else c===4?i.ascender=a.readSVarint():c===5&&(i.descender=a.readSVarint())}function DZ(c,i,a){c===1?i.id=a.readVarint():c===2?i.bitmap=a.readBytes():c===3?i.width=a.readVarint():c===4?i.height=a.readVarint():c===5?i.left=a.readSVarint():c===6?i.top=a.readSVarint():c===7&&(i.advance=a.readVarint())}const B6=F3,Rc={horizontal:1,vertical:2,horizontalOnly:3};class Jb{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const h=new Jb;return h.scale=i||1,h.fontStack=a,h}static forImage(i){const a=new Jb;return a.image=i,a}}class S_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a,h){const m=new S_;for(let x=0;x<i.sections.length;x++){const _=i.sections[x];_.image?m.addImageSection(_,h):m.addTextSection(_,a)}return m}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=(function(a,h){let m="";for(let x=0;x<a.length;x++){const _=a.charCodeAt(x+1)||null,A=a.charCodeAt(x-1)||null;m+=!h&&(_&&Bd(_)&&!Yb[a[x+1]]||A&&Bd(A)&&!Yb[a[x-1]])||!Yb[a[x]]?a[x]:Yb[a[x]]}return m})(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&tS[this.text.charCodeAt(h)];h++)i++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&tS[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const h=new S_;return h.text=this.text.substring(i,a),h.sectionIndex=this.sectionIndex.slice(i,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((i,a)=>Math.max(i,this.sections[a].scale)),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Jb.forText(i.scale,i.fontStack||a));const h=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(h)}addImageSection(i,a){const h=i.image?i.image.getPrimary():null;if(!h)return void It("Can't add FormattedSection with an empty image.");h.scaleSelf(a);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(Jb.forImage(h)),this.sectionIndex.push(this.sections.length-1)):It("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function B3(c,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe=1){const ue=S_.fromFeature(c,m,oe);H===Rc.vertical&&ue.verticalizePunctuation(G);let pe=[];const we=(function(Ye,nt,ot,Ot,pt,Ut){if(!Ye)return[];const Zt=[],en=(function(sn,jt,Rt,nn,gn,Yt){let zn=0;for(let Zn=0;Zn<sn.length();Zn++){const jn=sn.getSection(Zn);zn+=z6(sn.getCodePoint(Zn),jn,nn,gn,jt,Yt)}return zn/Math.max(1,Math.ceil(zn/Rt))})(Ye,nt,ot,Ot,pt,Ut),vn=Ye.text.indexOf("")>=0;let an=0;for(let sn=0;sn<Ye.length();sn++){const jt=Ye.getSection(sn),Rt=Ye.getCodePoint(sn);if(tS[Rt]||(an+=z6(Rt,jt,Ot,pt,nt,Ut)),sn<Ye.length()-1){const nn=!((Qt=Rt)<11904||!(pr["Bopomofo Extended"](Qt)||pr.Bopomofo(Qt)||pr["CJK Compatibility Forms"](Qt)||pr["CJK Compatibility Ideographs"](Qt)||pr["CJK Compatibility"](Qt)||pr["CJK Radicals Supplement"](Qt)||pr["CJK Strokes"](Qt)||pr["CJK Symbols and Punctuation"](Qt)||pr["CJK Unified Ideographs Extension A"](Qt)||pr["CJK Unified Ideographs"](Qt)||pr["Enclosed CJK Letters and Months"](Qt)||pr["Halfwidth and Fullwidth Forms"](Qt)||pr.Hiragana(Qt)||pr["Ideographic Description Characters"](Qt)||pr["Kangxi Radicals"](Qt)||pr["Katakana Phonetic Extensions"](Qt)||pr.Katakana(Qt)||pr["Vertical Forms"](Qt)||pr["Yi Radicals"](Qt)||pr["Yi Syllables"](Qt)));(LZ[Rt]||nn||jt.image)&&Zt.push(V6(sn+1,an,en,Zt,OZ(Rt,Ye.getCodePoint(sn+1),nn&&vn),!1))}}var Qt;return H6(V6(Ye.length(),an,en,Zt,0,!0))})(ue,N,x,i,h,Y),{processBidirectionalText:Te,processStyledBidirectionalText:Ie}=na;if(Te&&ue.sections.length===1){const Ye=Te(ue.toString(),we);for(const nt of Ye){const ot=new S_;ot.text=nt,ot.sections=ue.sections;for(let Ot=0;Ot<nt.length;Ot++)ot.sectionIndex.push(0);pe.push(ot)}}else if(Ie){const Ye=Ie(ue.text,ue.sectionIndex,we);for(const nt of Ye){const ot=new S_;ot.text=nt[0],ot.sectionIndex=nt[1],ot.sections=ue.sections,pe.push(ot)}}else pe=(function(Ye,nt){const ot=[],Ot=Ye.text;let pt=0;for(const Ut of nt)ot.push(Ye.substring(pt,Ut)),pt=Ut;return pt<Ot.length&&ot.push(Ye.substring(pt,Ot.length)),ot})(ue,we);const Ze=[],Ve={positionedLines:Ze,text:ue.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:H,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ye,nt,ot,Ot,pt,Ut,Zt,en,vn,an,Qt,sn){let jt=0,Rt=0,nn=0;const gn=en==="right"?1:en==="left"?0:.5;let Yt=!1;for(const Rn of pt){const br=Rn.getSections();for(const Ur of br){if(Ur.image)continue;const fi=nt[Ur.fontStack];if(fi&&(Yt=fi.ascender!==void 0&&fi.descender!==void 0,!Yt))break}if(!Yt)break}let zn=0;for(const Rn of pt){Rn.trim();const br=Rn.getMaxScale(),Ur=(br-1)*sa,fi={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[zn]=fi;const Pi=fi.positionedGlyphs;let Wr=0;if(!Rn.length()){Rt+=Ut,++zn;continue}let Vi=0,Hi=0;for(let Ge=0;Ge<Rn.length();Ge++){const Be=Rn.getSection(Ge),$t=Rn.getSectionIndex(Ge),An=Rn.getCodePoint(Ge);let Wt=Be.scale,kn=null,rr=null,tr=null,Jr=sa,Mr=0,Yn=vn;Yn===Rc.vertical&&((Zn=An)===12312||Zn===12313||Zn===12316||Zn===12540||Zn===12448)&&(Yn=Rc.horizontal);const Bi=!(Yn===Rc.horizontal||!Qt&&!Uf(An)||Qt&&(tS[An]||Rg(An)));if(Be.image){const as=Ot.get(Be.image.toString());if(!as)continue;tr=Be.image,Ye.iconsInText=Ye.iconsInText||!0,rr=as.paddedRect;const Rr=as.displaySize;Wt=Wt*sa/sn,kn={width:Rr[0],height:Rr[1],left:0,top:-B6,advance:Bi?Rr[1]:Rr[0],localGlyph:!1},Mr=Yt?-kn.height*Wt:br*sa-17-Rr[1]*Wt,Jr=kn.advance;const ki=(Bi?Rr[0]:Rr[1])*Wt-sa*br;ki>0&&ki>Wr&&(Wr=ki)}else{const as=ot[Be.fontStack];if(!as)continue;as[An]&&(rr=as[An]);const Rr=nt[Be.fontStack];if(!Rr)continue;const ki=Rr.glyphs[An];if(!ki)continue;if(kn=ki.metrics,Jr=An!==8203?sa:0,Yt){const ls=Rr.ascender!==void 0?Math.abs(Rr.ascender):0,es=Rr.descender!==void 0?Math.abs(Rr.descender):0,Hs=(ls+es)*Wt;Vi<Hs&&(Vi=Hs,Hi=(ls-es)/2*Wt),Mr=-ls*Wt}else Mr=(br-Wt)*sa-17}Bi?(Ye.verticalizable=!0,Pi.push({glyph:An,image:tr,x:jt,y:Rt+Mr,vertical:Bi,scale:Wt,localGlyph:kn.localGlyph,fontStack:Be.fontStack,sectionIndex:$t,metrics:kn,rect:rr}),jt+=Jr*Wt+an):(Pi.push({glyph:An,image:tr,x:jt,y:Rt+Mr,vertical:Bi,scale:Wt,localGlyph:kn.localGlyph,fontStack:Be.fontStack,sectionIndex:$t,metrics:kn,rect:rr}),jt+=kn.advance*Wt+an)}Pi.length!==0&&(nn=Math.max(jt-an,nn),Yt?G6(Pi,gn,Wr,Hi,Ut*br/2):G6(Pi,gn,Wr,0,Ut/2)),jt=0;const Ds=Ut*br+Wr;fi.lineOffset=Math.max(Wr,Ur),Rt+=Ds,++zn}var Zn;const jn=Rt,{horizontalAlign:Mn,verticalAlign:Fr}=z3(Zt);(function(Rn,br,Ur,fi,Pi,Wr){const Vi=(br-Ur)*Pi,Hi=-Wr*fi;for(const Ds of Rn)for(const Ge of Ds.positionedGlyphs)Ge.x+=Vi,Ge.y+=Hi})(Ye.positionedLines,gn,Mn,Fr,nn,jn),Ye.top+=-Fr*jn,Ye.bottom=Ye.top+jn,Ye.left+=-Mn*nn,Ye.right=Ye.left+nn,Ye.hasBaseline=Yt})(Ve,i,a,h,pe,_,A,P,H,N,G,J),!(function(Ye){for(const nt of Ye)if(nt.positionedGlyphs.length!==0)return!1;return!0})(Ze))return Ve}const tS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},LZ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function z6(c,i,a,h,m,x){if(i.image){const _=h.get(i.image.toString());return _?_.displaySize[0]*i.scale*sa/x+m:0}{const _=a[i.fontStack],A=_&&_.glyphs[c];return A?A.metrics.advance*i.scale+m:0}}function U6(c,i,a,h){const m=Math.pow(c-i,2);return h?c<i?m/2:2*m:m+Math.abs(a)*a}function OZ(c,i,a){let h=0;return c===10&&(h-=1e4),a&&(h+=150),c!==40&&c!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function V6(c,i,a,h,m,x){let _=null,A=U6(i,a,m,x);for(const P of h){const N=U6(i-P.x,a,m,x)+P.badness;N<=A&&(_=P,A=N)}return{index:c,x:i,priorBreak:_,badness:A}}function H6(c){return c?H6(c.priorBreak).concat(c.index):[]}function z3(c){let i=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function G6(c,i,a,h,m){if(!(i||a||h||m))return;const x=c.length-1,_=c[x],A=(_.x+_.metrics.advance*_.scale)*i;for(let P=0;P<=x;P++)c[P].x-=A,c[P].y+=a+h+m}function $6(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function nS(c,i,a,h){const{horizontalAlign:m,verticalAlign:x}=z3(h),_=a[0]-c.displaySize[0]*m,A=a[1]-c.displaySize[1]*x;return{imagePrimary:c,imageSecondary:i,top:A,bottom:A+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function U3(c,i,a,h,m,x){const _=c.imagePrimary;let A;if(_.content){const ue=_.content,pe=_.pixelRatio||1;A=[ue[0]/pe,ue[1]/pe,_.displaySize[0]-ue[2]/pe,_.displaySize[1]-ue[3]/pe]}const P=i.left*x,N=i.right*x;let V,H,G,Y;a==="width"||a==="both"?(Y=m[0]+P-h[3],H=m[0]+N+h[1]):(Y=m[0]+(P+N-_.displaySize[0])/2,H=Y+_.displaySize[0]);const J=i.top*x,oe=i.bottom*x;return a==="height"||a==="both"?(V=m[1]+J-h[0],G=m[1]+oe+h[2]):(V=m[1]+(J+oe-_.displaySize[1])/2,G=V+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:V,right:H,bottom:G,left:Y,collisionPadding:A}}function W6(c){return!c.imagePrimary.stretchX}function q6(c){return!c.imagePrimary.stretchY}function X6(c){return{width:c.right-c.left,height:c.bottom-c.top}}const Zh=128;function T_(c,i,a){const{expression:h}=i;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new rs(c+1,{worldview:a}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:x}=h;let _=0;for(;_<m.length&&m[_]<=c;)_++;_=Math.max(0,_-1);let A=_;for(;A<m.length&&m[A]<c+1;)A++;A=Math.min(m.length-1,A);const P=m[_],N=m[A];return h.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:N,interpolationType:x}:{kind:"camera",minZoom:P,maxZoom:N,minSize:h.evaluate(new rs(P,{worldview:a})),maxSize:h.evaluate(new rs(N,{worldview:a})),interpolationType:x}}}function V3(c,{uSize:i,uSizeT:a},{lowerSize:h,upperSize:m}){return c.kind==="source"?h/Zh:c.kind==="composite"?Ar(h/Zh,m/Zh,a):i}function E_(c,i,a=1){let h=0,m=0;if(c.kind==="constant")m=c.layoutSize*a;else if(c.kind!=="source"){const{interpolationType:x,minZoom:_,maxZoom:A}=c,P=x?ve(dl.interpolationFactor(x,i,_,A),0,1):0;c.kind==="camera"?m=Ar(c.minSize,c.maxSize,P)*a:h=P*a}return{uSizeT:h,uSize:m}}class _m extends Ht{constructor(i,a,h,m,x){super(i,a),this.angle=m,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new _m(this.x,this.y,this.z,this.angle,this.segment)}}function Z6(c,i,a,h,m){if(i.segment===void 0)return!0;let x=i,_=i.segment+1,A=0;for(;A>-a/2;){if(_--,_<0)return!1;A-=c[_].dist(x),x=c[_]}A+=c[_].dist(c[_+1]),_++;const P=[];let N=0;for(;A<a/2;){const V=c[_],H=c[_+1];if(!H)return!1;let G=c[_-1].angleTo(V)-V.angleTo(H);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:G}),N+=G;A-P[0].distance>h;)N-=P.shift().angleDelta;if(N>m)return!1;_++,A+=V.dist(H)}return!0}function Q6(c){let i=0;for(let a=0;a<c.length-1;a++)i+=c[a].dist(c[a+1]);return i}function K6(c,i,a){return c?.6*i*a:0}function Y6(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function FZ(c,i,a,h,m,x){const _=K6(a,m,x),A=Y6(a,h)*x;let P=0;const N=Q6(c)/2;for(let V=0;V<c.length-1;V++){const H=c[V],G=c[V+1],Y=H.dist(G);if(P+Y>N){const J=(N-P)/Y,oe=Ar(H.x,G.x,J),ue=Ar(H.y,G.y,J),pe=new _m(oe,ue,0,G.angleTo(H),V);return!_||Z6(c,pe,A,_,i)?pe:void 0}P+=Y}}function BZ(c,i,a,h,m,x,_,A,P){const N=K6(h,x,_),V=Y6(h,m),H=V*_,G=c[0].x===0||c[0].x===P||c[0].y===0||c[0].y===P;return i-H<i/4&&(i=H+i/4),J6(c,G?i/2*A%i:(V/2+2*x)*_*A%i,i,N,a,H,G,!1,P)}function J6(c,i,a,h,m,x,_,A,P){const N=x/2,V=Q6(c);let H=0,G=i-a,Y=[];for(let J=0;J<c.length-1;J++){const oe=c[J],ue=c[J+1],pe=oe.dist(ue),we=ue.angleTo(oe);for(;G+a<H+pe;){G+=a;const Te=(G-H)/pe,Ie=Ar(oe.x,ue.x,Te),Ze=Ar(oe.y,ue.y,Te);if(Ie>=0&&Ie<P&&Ze>=0&&Ze<P&&G-N>=0&&G+N<=V){const Ve=new _m(Ie,Ze,0,we,J);h&&!Z6(c,Ve,x,h,m)||Y.push(Ve)}}H+=pe}return A||Y.length||_||(Y=J6(c,H/2,a,h,m,x,_,!0,P)),Y}function ej(c){let i=0,a=0;for(const _ of c)i+=_.w*_.h,a=Math.max(a,_.w);c.sort(((_,A)=>A.h-_.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let m=0,x=0;for(const _ of c)for(let A=h.length-1;A>=0;A--){const P=h[A];if(!(_.w>P.w||_.h>P.h)){if(_.x=P.x,_.y=P.y,x=Math.max(x,_.y+_.h),m=Math.max(m,_.x+_.w),_.w===P.w&&_.h===P.h){const N=h.pop();N&&A<h.length&&(h[A]=N)}else _.h===P.h?(P.x+=_.w,P.w-=_.w):_.w===P.w?(P.y+=_.h,P.h-=_.h):(h.push({x:P.x+_.w,y:P.y,w:P.w-_.w,h:_.h}),P.y+=_.h,P.h-=_.h);break}}return{w:m,h:x,fill:i/(m*x)||0}}Fn(_m,"Anchor");const Py=1;class e1{static getImagePositionScale(i,a,h){if(a&&i&&i.options&&i.options.transform){const m=i.options.transform;return{x:m.a,y:m.d}}return{x:h,y:h}}constructor(i,a,h,m){this.paddedRect=i;const{pixelRatio:x,version:_,stretchX:A,stretchY:P,content:N,sdf:V,usvg:H}=a;this.pixelRatio=x,this.stretchX=A,this.stretchY=P,this.content=N,this.version=_,this.padding=h,this.sdf=V,this.usvg=H,this.scale=e1.getImagePositionScale(m,H,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function H3(c,i,a){const h=Pu.parse(c),m=(function(x,_,A=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*A[0])+2*_,h:(x.data?x.data.height:x.height*A[1])+2*_}})(i,a,[h.options.transform.a,h.options.transform.d]);return{bin:m,imagePosition:new e1(m,i,a,h),imageVariant:h}}class tj{constructor(i,a,h){const m=new Map,x=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,m,Py,_),this.addImages(a,x,2,_);const{w:A,h:P}=ej(_),N=new Ca({width:A||1,height:P||1});for(const[V,H]of i.entries()){const G=m.get(V).paddedRect;Ca.copy(H.data,N,{x:0,y:0},{x:G.x+Py,y:G.y+Py},H.data,null,H.sdf)}for(const[V,H]of a.entries()){const G=x.get(V),Y=G.paddedRect;let J=G.padding;const oe=Y.x+J,ue=Y.y+J,pe=H.data.width,we=H.data.height;J=J>1?J-1:J,Ca.copy(H.data,N,{x:0,y:0},{x:oe,y:ue},H.data,h),Ca.copy(H.data,N,{x:0,y:we-J},{x:oe,y:ue-J},{width:pe,height:J},h),Ca.copy(H.data,N,{x:0,y:0},{x:oe,y:ue+we},{width:pe,height:J},h),Ca.copy(H.data,N,{x:pe-J,y:0},{x:oe-J,y:ue},{width:J,height:we},h),Ca.copy(H.data,N,{x:0,y:0},{x:oe+pe,y:ue},{width:J,height:we},h),Ca.copy(H.data,N,{x:pe-J,y:we-J},{x:oe-J,y:ue-J},{width:J,height:J},h),Ca.copy(H.data,N,{x:0,y:we-J},{x:oe+pe,y:ue-J},{width:J,height:J},h),Ca.copy(H.data,N,{x:0,y:0},{x:oe+pe,y:ue+we},{width:J,height:J},h),Ca.copy(H.data,N,{x:pe-J,y:0},{x:oe-J,y:ue+we},{width:J,height:J},h)}this.lut=h,this.image=N,this.iconPositions=m,this.patternPositions=x}addImages(i,a,h,m){for(const[x,_]of i.entries()){const{bin:A,imagePosition:P,imageVariant:N}=H3(x,_,h);a.set(x,P),m.push(A),_.hasRenderCallback&&this.haveRenderCallbacks.push(N.id)}}patchUpdatedImages(i,a,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((m=>i.hasImage(m,h))),i.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const m of i.getUpdatedImages(h)){for(const x of this.iconPositions.keys()){const _=Pu.parse(x);if(bs.isEqual(_.id,m)){const A=i.getImage(m,h);this.patchUpdatedImage(this.iconPositions.get(x),A,a,null)}}for(const x of this.patternPositions.keys()){const _=Pu.parse(x);if(bs.isEqual(_.id,m)){const A=i.getImage(m,h);this.patchUpdatedImage(this.patternPositions.get(x),A,a,this.lut)}}}}patchUpdatedImage(i,a,h,m=null){if(!i||!a||i.version===a.version)return;i.version=a.version;const[x,_]=i.tl,A=i.sdf;if(this.lut||A){const P={width:a.data.width,height:a.data.height},N=new Ca(P);Ca.copy(a.data,N,{x:0,y:0},{x:0,y:0},P,m,A),h.update(N,{position:{x,y:_}})}else h.update(a.data,{position:{x,y:_}})}}Fn(e1,"ImagePosition"),Fn(tj,"ImageAtlas");const t1=1e20;function nj(c,i,a,h,m,x,_,A,P){for(let N=i;N<i+h;N++)rj(c,a*x+N,x,m,_,A,P);for(let N=a;N<a+m;N++)rj(c,N*x+i,1,h,_,A,P)}function rj(c,i,a,h,m,x,_){x[0]=0,_[0]=-t1,_[1]=t1,m[0]=c[i];for(let A=1,P=0,N=0;A<h;A++){m[A]=c[i+A*a];const V=A*A;do{const H=x[P];N=(m[A]-m[H]+V-H*H)/(A-H)/2}while(N<=_[P]&&--P>-1);P++,x[P]=A,_[P]=N,_[P+1]=t1}for(let A=0,P=0;A<h;A++){for(;_[P+1]<A;)P++;const N=x[P],V=A-N;c[i+A*a]=m[N]+V*V}}const Qh=2,G3={none:0,ideographs:1,all:2};class A_{constructor(i,a,h){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const h=[],m=this.url||ii.GLYPHS_URL;for(const x in i)for(const _ of i[x])h.push({stack:x,id:_});Je(h,(({stack:x,id:_},A)=>{let P=this.entries[x];P||(P=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=P.glyphs[_];if(N!==void 0)return void A(null,{stack:x,id:_,glyph:N});if(N=this._tinySDF(P,x,_),N)return P.glyphs[_]=N,void A(null,{stack:x,id:_,glyph:N});const V=Math.floor(_/256);if(256*V>65535)return It("glyphs > 65535 not supported"),void A(null,{stack:x,id:_,glyph:N});if(P.ranges[V])return void A(null,{stack:x,id:_,glyph:N});let H=P.requests[V];H||(H=P.requests[V]=[],A_.loadGlyphRange(x,V,m,this.requestManager,((G,Y)=>{if(Y){P.ascender=Y.ascender,P.descender=Y.descender;for(const J in Y.glyphs)this._doesCharSupportLocalGlyph(+J)||(P.glyphs[+J]=Y.glyphs[+J]);P.ranges[V]=!0}for(const J of H)J(G,Y);delete P.requests[V]}))),H.push(((G,Y)=>{G?A(G):Y&&A(null,{stack:x,id:_,glyph:Y.glyphs[_]||null})}))}),((x,_)=>{if(x)a(x);else if(_){const A={};for(const{stack:P,id:N,glyph:V}of _)A[P]===void 0&&(A[P]={}),A[P].glyphs===void 0&&(A[P].glyphs={}),A[P].glyphs[N]=V&&{id:V.id,bitmap:V.bitmap.clone(),metrics:V.metrics},A[P].ascender=this.entries[P].ascender,A[P].descender=this.entries[P].descender;a(null,A)}}))}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==G3.none&&(this.localGlyphMode===G3.all?!!this.localFontFamily:!!this.localFontFamily&&(pr["CJK Unified Ideographs"](i)||pr["Hangul Syllables"](i)||pr.Hiragana(i)||pr.Katakana(i)||pr["CJK Symbols and Punctuation"](i)||pr["CJK Unified Ideographs Extension A"](i)||pr["CJK Unified Ideographs Extension B"](i)||pr.Osage(i)))}_tinySDF(i,a,h){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(h))return;let x=i.tinySDF;if(!x){let oe="400";/bold/i.test(a)?oe="900":/medium/i.test(a)?oe="500":/light/i.test(a)&&(oe="200"),x=i.tinySDF=new A_.TinySDF({fontFamily:m,fontWeight:oe,fontSize:24*Qh,buffer:3*Qh,radius:8*Qh}),x.fontWeight=oe}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const _=String.fromCodePoint(h),{data:A,width:P,height:N,glyphWidth:V,glyphHeight:H,glyphLeft:G,glyphTop:Y,glyphAdvance:J}=x.draw(_);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new Jg({width:P,height:N},A),metrics:{width:V/Qh,height:H/Qh,left:G/Qh,top:Y/Qh-27,advance:J/Qh,localGlyph:!0}}}}A_.loadGlyphRange=function(c,i,a,h,m){const x=256*i,_=x+255,A=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${x}-${_}`),xc.Glyphs);dh(A,((P,N)=>{if(P)m(P);else if(N){const V={},H=(function(G){return new eS(G).readFields(NZ,{})})(N);for(const G of H.glyphs)V[G.id]=G;m(null,{glyphs:V,ascender:H.ascender,descender:H.descender})}}))},A_.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:a=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:x="normal",fontStyle:_="normal",lang:A=null}={}){this.buffer=i,this.cutoff=h,this.radius=a,this.lang=A;const P=this.size=c+4*i,N=this._createCanvas(P),V=this.ctx=N.getContext("2d",{willReadFrequently:!0});V.font=`${_} ${x} ${c}px ${m}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:x}=this.ctx.measureText(c),_=Math.ceil(a),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-m))),P=Math.min(this.size-this.buffer,_+Math.ceil(h)),N=A+2*this.buffer,V=P+2*this.buffer,H=Math.max(N*V,0),G=new Uint8ClampedArray(H),Y={data:G,width:N,height:V,glyphWidth:A,glyphHeight:P,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(A===0||P===0)return Y;const{ctx:J,buffer:oe,gridInner:ue,gridOuter:pe}=this;this.lang&&(J.lang=this.lang),J.clearRect(oe,oe,A,P),J.fillText(c,oe,oe+_);const we=J.getImageData(oe,oe,A,P);pe.fill(t1,0,H),ue.fill(0,0,H);for(let Te=0;Te<P;Te++)for(let Ie=0;Ie<A;Ie++){const Ze=we.data[4*(Te*A+Ie)+3]/255;if(Ze===0)continue;const Ve=(Te+oe)*N+Ie+oe;if(Ze===1)pe[Ve]=0,ue[Ve]=t1;else{const Ye=.5-Ze;pe[Ve]=Ye>0?Ye*Ye:0,ue[Ve]=Ye<0?Ye*Ye:0}}nj(pe,0,0,N,V,N,this.f,this.v,this.z),nj(ue,oe,oe,A,P,N,this.f,this.v,this.z);for(let Te=0;Te<H;Te++){const Ie=Math.sqrt(pe[Te])-Math.sqrt(ue[Te]);G[Te]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return Y}};const ip=Py;function ij(c,i){return c+i[1]-i[0]}function $3(c,i,a,h,m=1){const x=[],_=c.imagePrimary,A=_.pixelRatio,P=_.paddedRect.w-2*ip,N=_.paddedRect.h-2*ip,V=(c.right-c.left)*m,H=(c.bottom-c.top)*m,G=_.stretchX||[[0,P]],Y=_.stretchY||[[0,N]],J=G.reduce(ij,0),oe=Y.reduce(ij,0),ue=P-J,pe=N-oe;let we=0,Te=J,Ie=0,Ze=oe,Ve=0,Ye=ue,nt=0,ot=pe;if(_.content&&h){const pt=_.content;we=rS(G,0,pt[0]),Ie=rS(Y,0,pt[1]),Te=rS(G,pt[0],pt[2]),Ze=rS(Y,pt[1],pt[3]),Ve=pt[0]-we,nt=pt[1]-Ie,Ye=pt[2]-pt[0]-Te,ot=pt[3]-pt[1]-Ze}const Ot=(pt,Ut,Zt,en)=>{const vn=iS(pt.stretch-we,Te,V,c.left*m),an=sS(pt.fixed-Ve,Ye,pt.stretch,J),Qt=iS(Ut.stretch-Ie,Ze,H,c.top*m),sn=sS(Ut.fixed-nt,ot,Ut.stretch,oe),jt=iS(Zt.stretch-we,Te,V,c.left*m),Rt=sS(Zt.fixed-Ve,Ye,Zt.stretch,J),nn=iS(en.stretch-Ie,Ze,H,c.top*m),gn=sS(en.fixed-nt,ot,en.stretch,oe),Yt=new Ht(vn,Qt),zn=new Ht(jt,Qt),Zn=new Ht(jt,nn),jn=new Ht(vn,nn),Mn=new Ht(an/A,sn/A),Fr=new Ht(Rt/A,gn/A),Rn=i*Math.PI/180;if(Rn){const Vi=Math.sin(Rn),Hi=Math.cos(Rn),Ds=[Hi,-Vi,Vi,Hi];Yt._matMult(Ds),zn._matMult(Ds),jn._matMult(Ds),Zn._matMult(Ds)}const br=pt.stretch+pt.fixed,Ur=Zt.stretch+Zt.fixed,fi=Ut.stretch+Ut.fixed,Pi=en.stretch+en.fixed,Wr=c.imageSecondary;return{tl:Yt,tr:zn,bl:jn,br:Zn,texPrimary:{x:_.paddedRect.x+ip+br,y:_.paddedRect.y+ip+fi,w:Ur-br,h:Pi-fi},texSecondary:Wr?{x:Wr.paddedRect.x+ip+br,y:Wr.paddedRect.y+ip+fi,w:Ur-br,h:Pi-fi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mn,pixelOffsetBR:Fr,minFontScaleX:Ye/A/V,minFontScaleY:ot/A/H,isSDF:a}};if(h&&(_.stretchX||_.stretchY)){const pt=sj(G,ue,J),Ut=sj(Y,pe,oe);for(let Zt=0;Zt<pt.length-1;Zt++){const en=pt[Zt],vn=pt[Zt+1];for(let an=0;an<Ut.length-1;an++)x.push(Ot(en,Ut[an],vn,Ut[an+1]))}}else x.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:N+1}));return x}function zZ(c,i){const a=c.stretchY||[[0,c.paddedRect.h-2*ip]];return i&&(c.stretchX||c.stretchY)?oj(c.stretchX||[[0,c.paddedRect.w-2*ip]])*oj(a):1}function rS(c,i,a){let h=0;for(const m of c)h+=Math.max(i,Math.min(a,m[1]))-Math.max(i,Math.min(a,m[0]));return h}function sj(c,i,a){const h=[{fixed:-ip,stretch:0}];for(const[m,x]of c){const _=h[h.length-1];h.push({fixed:m-_.stretch,stretch:_.stretch}),h.push({fixed:m-_.stretch,stretch:_.stretch+(x-m)})}return h.push({fixed:i+ip,stretch:a}),h}function oj(c){return 2*c.length+1}function iS(c,i,a,h){return c/i*a+h}function sS(c,i,a,h){return c-i*a/h}function UZ(c,i,a,h){const m=i+c.positionedLines[h].lineOffset;return h===0?a+m/2:a+(m+(i+c.positionedLines[h-1].lineOffset))/2}function VZ(c,i=1,a=!1){let h=1/0,m=1/0,x=-1/0,_=-1/0;const A=c[0];for(let Y=0;Y<A.length;Y++){const J=A[Y];(!Y||J.x<h)&&(h=J.x),(!Y||J.y<m)&&(m=J.y),(!Y||J.x>x)&&(x=J.x),(!Y||J.y>_)&&(_=J.y)}const P=Math.min(x-h,_-m);let N=P/2;const V=new Up([],HZ);if(P===0)return new Ht(h,m);for(let Y=h;Y<x;Y+=P)for(let J=m;J<_;J+=P)V.push(new C_(Y+N,J+N,N,c));let H=(function(Y){let J=0,oe=0,ue=0;const pe=Y[0];for(let we=0,Te=pe.length,Ie=Te-1;we<Te;Ie=we++){const Ze=pe[we],Ve=pe[Ie],Ye=Ze.x*Ve.y-Ve.x*Ze.y;oe+=(Ze.x+Ve.x)*Ye,ue+=(Ze.y+Ve.y)*Ye,J+=3*Ye}return new C_(oe/J,ue/J,0,Y)})(c),G=V.length;for(;V.length;){const Y=V.pop();(Y.d>H.d||!H.d)&&(H=Y,a&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,G)),Y.max-H.d<=i||(N=Y.h/2,V.push(new C_(Y.p.x-N,Y.p.y-N,N,c)),V.push(new C_(Y.p.x+N,Y.p.y-N,N,c)),V.push(new C_(Y.p.x-N,Y.p.y+N,N,c)),V.push(new C_(Y.p.x+N,Y.p.y+N,N,c)),G+=4)}return a&&(console.log(`num probes: ${G}`),console.log(`best distance: ${H.d}`)),H.p}function HZ(c,i){return i.max-c.max}class C_{constructor(i,a,h,m){this.p=new Ht(i,a),this.h=h,this.d=(function(x,_){let A=!1,P=1/0;for(let N=0;N<_.length;N++){const V=_[N];for(let H=0,G=V.length,Y=G-1;H<G;Y=H++){const J=V[H],oe=V[Y];J.y>x.y!=oe.y>x.y&&x.x<(oe.x-J.x)*(x.y-J.y)/(oe.y-J.y)+J.x&&(A=!A),P=Math.min(P,Fl(x,J,oe))}}return(A?1:-1)*Math.sqrt(P)})(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const GZ=Object.keys,W3=Number.POSITIVE_INFINITY,$Z=Math.sqrt(2);function oS(c,i,a,h){const m=c.collisionPadding||[0,0,0,0],x={top:c.top-m[1],bottom:c.bottom+m[3],left:c.left-m[0],right:c.right+m[2],scaled:!1};return h!==void 0&&(function(_,A){_.top*=A,_.bottom*=A,_.left*=A,_.right*=A,_.scaled=!0})(x,h),a&&(function(_,A){if(!A)return;const P=Qr(A),N=new Ht(_.left,_.top),V=new Ht(_.right,_.top),H=new Ht(_.left,_.bottom),G=new Ht(_.right,_.bottom);N._rotateAround(P,new Ht(0,0)),V._rotateAround(P,new Ht(0,0)),H._rotateAround(P,new Ht(0,0)),G._rotateAround(P,new Ht(0,0)),_.left=Math.min(N.x,V.x,H.x,G.x),_.right=Math.max(N.x,V.x,H.x,G.x),_.top=Math.min(N.y,V.y,H.y,G.y),_.bottom=Math.max(N.y,V.y,H.y,G.y)})(x,a),i?{top:Math.min(i.top,x.top),bottom:Math.max(i.bottom,x.bottom),left:Math.min(i.left,x.left),right:Math.max(i.right,x.right),scaled:i.scaled||x.scaled}:x}function aj(c,[i,a]){let h=0,m=0;if(a===W3){i<0&&(i=0);const x=i/$Z;switch(c){case"top-right":case"top-left":m=x-7;break;case"bottom-right":case"bottom-left":m=7-x;break;case"bottom":m=7-i;break;case"top":m=i-7}switch(c){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=i;break;case"right":h=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),c){case"top-right":case"top-left":case"top":m=a-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-a}switch(c){case"top-right":case"bottom-right":case"right":h=-i;break;case"top-left":case"bottom-left":case"left":h=i}}return[h,m]}function WZ(c,i,a,h,m,x,_,A,P,N,V){const H=c.layers[0],G=H.appearances;if(G.length===0)return{iconBBox:null,iconVerticalBBox:null};let Y=null,J=null;const oe=h.get("icon-rotate").evaluate(m,{},x);i&&(Y=oS(i,Y,oe,_),a)&&(J=oS(a,J,oe+90,_));const[ue,pe]=h.get("icon-size-scale-range"),we=ve(1,ue,pe);for(const Te of G){const Ie=Te.getUnevaluatedProperties(),Ze=Ie._values["icon-image"].value!==void 0,Ve=Ie._values["icon-size"].value!==void 0,Ye=Ie._values["icon-offset"].value!==void 0,nt=Ie._values["icon-rotate"].value!==void 0;if(Ze||Ve||Ye||nt){const ot=Ye?H.getAppearanceValueAndResolveTokens(Te,"icon-offset",m,x,[]):null,Ot=ot&&Array.isArray(ot)?ot:A,pt=nt?H.getAppearanceValueAndResolveTokens(Te,"icon-rotate",m,x,[]):null,Ut=typeof pt=="number"?pt:oe,Zt=Ve?H.getAppearanceValueAndResolveTokens(Te,"icon-size",m,x,[]):null,en=typeof Zt=="number"?Zt*P.iconScaleFactor:_;let vn=null,an=null,Qt=null;if(Ze){const sn=H.getAppearanceValueAndResolveTokens(Te,"icon-image",m,x,[]);if(sn){const jt=c.getResolvedImageFromTokens(sn),Rt=Ie._values["icon-size"],nn=n1(jt,T_(c.zoom,Rt,c.worldview),Rt,x,c.zoom,m,c.pixelRatio,we,c.worldview);Qt=N.get(nn.iconPrimary.toString())}}else i&&(Qt=i.imagePrimary);Qt&&(vn=nS(Qt,null,Ot,V),c.allowVerticalPlacement&&(an=nS(Qt,null,Ot,V))),vn&&(Y=oS(vn,Y,Ut,en)),an&&(J=oS(an,J,Ut+90,en))}}return{iconBBox:Y,iconVerticalBBox:J}}function aS(c,i,a,h,m,x,_,A,P){if(!i||!i.usvg)return;const N=X6(h),V=X6(m),H=x!=="both"&&x!=="width"||!W6(h)?1:V.width/N.width,G=x!=="both"&&x!=="height"||!q6(h)?1:V.height/N.height;a.scaleSelf(H,G);const Y=a.toString();_.set(Y,a),A.set(Y,i);const{imagePosition:J}=H3(Y,i,Py);P.set(Y,J)}function lj(c,i,a,h,m,x,_,A,P){if(!c)return;const N=(function(V,H,G,Y,J,oe){if(V.kind==="camera")return V.maxSize;if(V.kind==="composite"){const ue=H.possiblyEvaluate(new rs(V.maxZoom,{worldview:oe}),G).evaluate(J,{},G),pe=H.possiblyEvaluate(new rs(V.minZoom,{worldview:oe}),G).evaluate(J,{},G);return Math.max(ue,pe)}return H.possiblyEvaluate(new rs(Y,{worldview:oe})).evaluate(J,{},G)})(i,a,h,m,x,P);return c.scaleSelf(N*A*_)}function n1(c,i,a,h,m,x,_,A,P){return{iconPrimary:lj(c.getPrimary(),i,a,h,m,x,_,A,P),iconSecondary:lj(c.getSecondary(),i,a,h,m,x,_,A,P)}}function qZ(c,i,a){if(!i)return;const h=a.get(c.toString()),m=a.get(i.toString());h&&m&&(h.paddedRect.w===m.paddedRect.w&&h.paddedRect.h===m.paddedRect.h||It(`Mismatch in icon variant sizes: ${c.toString()} and ${i.toString()}`),h.usvg!==m.usvg&&It(`Mismatch in icon variant image types: ${c.id} and ${i.id}`))}function cj(c,i,a,h){if(!c)return;const m=i.get(a.toString());if(c.imagePrimary=m,h){const x=i.get(h.toString());c.imageSecondary=x}}function XZ(c,i){for(const a in c.horizontal)uj(c.horizontal[a],i);uj(c.vertical,i)}function uj(c,i){if(c){for(const a of c.positionedLines)for(const h of a.positionedGlyphs)if(h.image!==null){const m=h.image.toString();h.rect=i.get(m).paddedRect}}}function q3(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ZZ(c,i,a,h,m,x,_,A,P){const N=X3(x.horizontal)||x.vertical,V=a.get("icon-text-fit-padding").evaluate(h,{},m);let H,G=i;return i&&P!=="none"&&(c.allowVerticalPlacement&&x.vertical&&(H=U3(i,x.vertical,P,V,A,_)),N&&(G=U3(i,N,P,V,A,_))),{defaultShapedIcon:G,verticallyShapedIcon:H}}function QZ(c,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we,Te,Ie,Ze){let Ve=_.textMaxSize.evaluate(i,{},G);Ve===void 0?Ve=A*_.textScaleFactor:Ve*=_.textScaleFactor;const Ye=c.layers[0].layout,nt=sa,ot=A*_.textScaleFactor/nt,Ot=X3(a.horizontal)||a.vertical;if(ue!=="none"&&c.appearanceFeatureData&&i.index<c.appearanceFeatureData.length){const Yt=c.appearanceFeatureData[i.index];Yt&&(Yt.textShaping=Ot,Yt.iconTextFitPadding=Ye.get("icon-text-fit-padding").evaluate(i,{},G),Yt.fontScale=ot)}const pt=Y.name==="globe",Ut=c.tilePixelRatio*Ve/nt,Zt=(jt=c.overscaling,c.zoom>18&&jt>2&&(jt>>=1),Math.max(xn/(512*jt),1)*Ye.get("symbol-spacing")),en=Ye.get("text-padding")*c.tilePixelRatio,vn=Ye.get("icon-padding")*c.tilePixelRatio,an=Qr(Ye.get("text-max-angle")),Qt=Ye.get("icon-rotation-alignment")==="map"&&Te!=="point",sn=Zt/2;var jt;c.hasAnyIconTextFit===!1&&ue!=="none"&&(c.hasAnyIconTextFit=!0);const Rt=i.properties?+i.properties[Cn]:null,nn=Rt&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(Rt):65535,gn=(Yt,zn,Zn)=>{if(zn.x<0||zn.x>=xn||zn.y<0||zn.y>=xn)return;let jn=null;if(pt){const{x:Mn,y:Fr,z:Rn}=Y.projectTilePoint(zn.x,zn.y,Zn);jn={anchor:new _m(Mn,Fr,Rn,0,void 0),up:Y.upVector(Zn,zn.x,zn.y)}}(function(Mn,Fr,Rn,br,Ur,fi,Pi,Wr,Vi,Hi,Ds,Ge,Be,$t,An,Wt,kn,rr,tr,Jr,Mr,Yn,Bi,as,Rr,ki,ls,es,Hs,As,fs){const is=Mn.addToLineVertexArray(Fr,br);let Gi,ei,$i,ps,kr,Ri,Cs,Ys=0,oo=0,Eo=0,Ms=0,vo=-1,oc=-1;const bo={};let Nc=ph("");const Ma=Rn?Rn.anchor:Fr,Xu=es!=="none";let ac=0,jc=0;if(Vi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const oa=Vi.layout.get("text-offset").evaluate(Mr,{},Rr);ac=oa[0]*sa,jc=oa[1]*sa}else ac=Vi.layout.get("text-radial-offset").evaluate(Mr,{},Rr)*sa,jc=W3;if(Mn.allowVerticalPlacement&&Ur.vertical){const oa=Ur.vertical;if(An)Ri=Z3(oa),Wr&&(Cs=Z3(Wr));else{const yl=Vi.layout.get("text-rotate").evaluate(Mr,{},Rr)+90;$i=lS(Hi,Ma,Fr,Ds,Ge,Be,oa,$t,yl,Wt),Wr&&(ps=lS(Hi,Ma,Fr,Ds,Ge,Be,Wr,rr,yl,null,fs))}}if(fi){const oa=Mn.iconSizeData,yl=Vi.layout.get("icon-rotate").evaluate(Mr,{},Rr),sp=$3(fi,yl,Bi,Xu,Yn.iconScaleFactor),i0=Wr?$3(Wr,yl,Bi,Xu,Yn.iconScaleFactor):void 0;ei=lS(Hi,Ma,Fr,Ds,Ge,Be,fi,rr,yl,null,As);const j_=(function(op,ES,D_,cK,kD,ID,uK,dK){const PD=op.layers[0],RD=PD.appearances;let L_=ES.length;if(D_&&(L_=Math.max(L_,D_.length)),RD.length===0)return L_;const[hK,fK]=cK.get("icon-size-scale-range"),pK=ve(1,hK,fK);for(const ND of RD){const jD=ND.getUnevaluatedProperties();if(jD._values["icon-image"].value!==void 0){const DD=PD.getAppearanceValueAndResolveTokens(ND,"icon-image",kD,ID,[]);if(DD){const LD=op.getResolvedImageFromTokens(DD);if(LD){const OD=jD._values["icon-size"],mK=n1(LD,T_(op.zoom,OD,op.worldview),OD,ID,op.zoom,kD,op.pixelRatio,pK,op.worldview),gK=uK.get(mK.iconPrimary.toString());L_=Math.max(L_,zZ(gK,dK))}}}}return L_})(Mn,sp,i0,Vi.layout,Mr,Rr,Mn.iconAtlasPositions,Xu);Ys=4*j_;let s0=null;oa.kind==="source"?(s0=[Zh*Vi.layout.get("icon-size").evaluate(Mr,{},Rr)*Yn.iconScaleFactor],s0[0]>vm&&It(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${r1}. Reduce your "icon-size".`)):oa.kind==="composite"&&(s0=[Zh*Yn.compositeIconSizes[0].evaluate(Mr,{},Rr)*Yn.iconScaleFactor,Zh*Yn.compositeIconSizes[1].evaluate(Mr,{},Rr)*Yn.iconScaleFactor],(s0[0]>vm||s0[1]>vm)&&It(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${r1}. Reduce your "icon-size".`)),Mn.addSymbols(Mn.icon,sp,s0,Jr,tr,Mr,void 0,Rn,Fr,is.lineStartIndex,is.lineLength,-1,as,Rr,ki,ls,Mn.symbolInstances.length,j_),vo=Mn.icon.placedSymbolArray.length-1,i0&&(oo=4*j_,Mn.addSymbols(Mn.icon,i0,s0,Jr,tr,Mr,Rc.vertical,Rn,Fr,is.lineStartIndex,is.lineLength,-1,as,Rr,ki,ls,Mn.symbolInstances.length,j_),oc=Mn.icon.placedSymbolArray.length-1)}for(const oa in Ur.horizontal){const yl=oa,sp=Ur.horizontal[yl];Gi||(Nc=ph(sp.text),An?kr=Z3(sp):Gi=lS(Hi,Ma,Fr,Ds,Ge,Be,sp,$t,Vi.layout.get("text-rotate").evaluate(Mr,{},Rr),Wt));const i0=sp.positionedLines.length===1;if(Eo+=dj(Mn,Rn,Fr,sp,Pi,Vi,An,Mr,Wt,is,Ur.vertical?Rc.horizontal:Rc.horizontalOnly,i0?GZ(Ur.horizontal):[yl],bo,vo,Yn,as,Rr,Mn.symbolInstances.length,ki),i0)break}Ur.vertical&&(Ms+=dj(Mn,Rn,Fr,Ur.vertical,Pi,Vi,An,Mr,Wt,is,Rc.vertical,["vertical"],bo,oc,Yn,as,Rr,Mn.symbolInstances.length,ki));let ka=-1;const Dc=(oa,yl)=>oa?Math.max(oa,yl):yl;ka=Dc(kr,ka),ka=Dc(Ri,ka),ka=Dc(Cs,ka);const Zu=ka>-1?1:0;Mn.glyphOffsetArray.length>=65535&&It("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mr.sortKey!==void 0&&Mn.addToSortKeyRanges(Mn.symbolInstances.length,Mr.sortKey),Mn.symbolInstances.emplaceBack(Fr.x,Fr.y,Ma.x,Ma.y,Ma.z,bo.right>=0?bo.right:-1,bo.center>=0?bo.center:-1,bo.left>=0?bo.left:-1,bo.vertical>=0?bo.vertical:-1,vo,oc,Nc,Gi!==void 0?Gi:Mn.collisionBoxArray.length,Gi!==void 0?Gi+1:Mn.collisionBoxArray.length,$i!==void 0?$i:Mn.collisionBoxArray.length,$i!==void 0?$i+1:Mn.collisionBoxArray.length,ei!==void 0?ei:Mn.collisionBoxArray.length,ei!==void 0?ei+1:Mn.collisionBoxArray.length,ps||Mn.collisionBoxArray.length,ps?ps+1:Mn.collisionBoxArray.length,Ds,Eo,Ms,Ys,oo,Zu,0,ac,jc,ka,0,Xu?1:0,Hs)})(c,zn,jn,Yt,a,h,x,m,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,en,we,N,0,vn,Qt,pe,i,_,V,H,G,J,oe,ue,nn,Ie,Ze)};if(Te==="line")for(const Yt of H2(i.geometry,0,0,xn,xn)){const zn=BZ(Yt,Zt,an,a.vertical||Ot,h,nt,Ut,c.overscaling,xn);for(const Zn of zn)Ot&&KZ(c,Ot.text,sn,Zn)||gn(Yt,Zn,G)}else if(Te==="line-center"){for(const Yt of i.geometry)if(Yt.length>1){const zn=FZ(Yt,an,a.vertical||Ot,h,nt,Ut);zn&&gn(Yt,zn,G)}}else if(i.type==="Polygon")for(const Yt of Bb(i.geometry,0)){const zn=VZ(Yt,16);gn(Yt[0],new _m(zn.x,zn.y,0,0,void 0),G)}else if(i.type==="LineString")for(const Yt of i.geometry)gn(Yt,new _m(Yt[0].x,Yt[0].y,0,0,void 0),G);else if(i.type==="Point")for(const Yt of i.geometry)for(const zn of Yt)gn([zn],new _m(zn.x,zn.y,0,0,void 0),G)}const r1=255,vm=r1*Zh;function dj(c,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we){const Te=(function(Ve,Ye,nt,ot,Ot,pt,Ut,Zt){const en=[];if(Ye.positionedLines.length===0)return en;const vn=ot.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,an=(function(nn){const gn=nn[0],Yt=nn[1],zn=gn*Yt;return zn>0?[gn,-Yt]:zn<0?[-gn,Yt]:gn===0?[Yt,gn]:[Yt,-gn]})(nt);let Qt=Math.abs(Ye.top-Ye.bottom);for(const nn of Ye.positionedLines)Qt-=nn.lineOffset;const sn=Ye.positionedLines.length,jt=Qt/sn;let Rt=Ye.top-nt[1];for(let nn=0;nn<sn;++nn){const gn=Ye.positionedLines[nn];Rt=UZ(Ye,jt,Rt,nn);for(const Yt of gn.positionedGlyphs){if(!Yt.rect)continue;const zn=Yt.rect||{};let Zn=B6+1,jn=!0,Mn=1,Fr=0;if(Yt.image){const tr=Ut.get(Yt.image.toString());if(!tr)continue;if(tr.sdf){It("SDF images are not supported in formatted text and will be ignored.");continue}jn=!1,Mn=tr.pixelRatio,Zn=Py/Mn}const Rn=(Ot||Zt)&&Yt.vertical,br=Yt.metrics.advance*Yt.scale/2,Ur=Yt.metrics,fi=Yt.rect;if(fi===null)continue;Zt&&Ye.verticalizable&&(Fr=Yt.image?br-Yt.metrics.width*Yt.scale/2:0);const Pi=Ot?[Yt.x+br,Yt.y]:[0,0];let Wr=[0,0],Vi=[0,0],Hi=!1;Ot||(Rn?(Vi=[Yt.x+br+an[0],Yt.y+an[1]-Fr],Hi=!0):Wr=[Yt.x+br+nt[0],Yt.y+nt[1]-Fr]);const Ds=fi.w*Yt.scale/(Mn*(Yt.localGlyph?Qh:1)),Ge=fi.h*Yt.scale/(Mn*(Yt.localGlyph?Qh:1));let Be,$t,An,Wt;if(Rn){const tr=Yt.y-Rt,Jr=new Ht(-br,br-tr),Mr=-Math.PI/2,Yn=new Ht(...Vi);Be=new Ht(-br+Wr[0],Wr[1]),Be._rotateAround(Mr,Jr)._add(Yn),Be.x+=-tr+br,Be.y-=(Ur.left-Zn)*Yt.scale;const Bi=Yt.image?Ur.advance*Yt.scale:sa*Yt.scale,as=String.fromCodePoint(Yt.glyph);wZ(as)?Be.x+=(1-Zn)*Yt.scale:SZ(as)?Be.x+=Bi-Ur.height*Yt.scale+(-Zn-1)*Yt.scale:Be.x+=Yt.image||Ur.width+2*Zn===fi.w&&Ur.height+2*Zn===fi.h?(Bi-Ge)/2:(Bi-(Ur.height+2*Zn)*Yt.scale)/2,$t=new Ht(Be.x,Be.y-Ds),An=new Ht(Be.x+Ge,Be.y),Wt=new Ht(Be.x+Ge,Be.y-Ds)}else{const tr=(Ur.left-Zn)*Yt.scale-br+Wr[0],Jr=(-Ur.top-Zn)*Yt.scale+Wr[1],Mr=tr+Ds,Yn=Jr+Ge;Be=new Ht(tr,Jr),$t=new Ht(Mr,Jr),An=new Ht(tr,Yn),Wt=new Ht(Mr,Yn)}if(vn){let tr;tr=Ot?new Ht(0,0):Hi?new Ht(an[0],an[1]):new Ht(nt[0],nt[1]),Be._rotateAround(vn,tr),$t._rotateAround(vn,tr),An._rotateAround(vn,tr),Wt._rotateAround(vn,tr)}const kn=new Ht(0,0),rr=new Ht(0,0);en.push({tl:Be,tr:$t,bl:An,br:Wt,texPrimary:zn,texSecondary:void 0,writingMode:Ye.writingMode,glyphOffset:Pi,sectionIndex:Yt.sectionIndex,isSDF:jn,pixelOffsetTL:kn,pixelOffsetBR:rr,minFontScaleX:0,minFontScaleY:0})}}return en})(0,h,P,x,_,A,m,c.allowVerticalPlacement),Ie=c.textSizeData;let Ze=null;Ie.kind==="source"?(Ze=[Zh*x.layout.get("text-size").evaluate(A,{},ue)*J.textScaleFactor],Ze[0]>vm&&It(`${c.layerIds[0]}: Value for "text-size" is >= ${r1}. Reduce your "text-size".`)):Ie.kind==="composite"&&(Ze=[Zh*J.compositeTextSizes[0].evaluate(A,{},ue)*J.textScaleFactor,Zh*J.compositeTextSizes[1].evaluate(A,{},ue)*J.textScaleFactor],(Ze[0]>vm||Ze[1]>vm)&&It(`${c.layerIds[0]}: Value for "text-size" is >= ${r1}. Reduce your "text-size".`)),c.addSymbols(c.text,Te,Ze,P,_,A,V,i,a,N.lineStartIndex,N.lineLength,Y,oe,ue,we,!1,pe,Te.length);for(const Ve of H)G[Ve]=c.text.placedSymbolArray.length-1;return 4*Te.length}function X3(c){for(const i in c)return c[i];return null}function lS(c,i,a,h,m,x,_,A,P,N,V){let H,G,Y,J;if(H=V?V.top:_.top,G=V?V.bottom:_.bottom,Y=V?V.left:_.left,J=V?V.right:_.right,$6(_)&&_.collisionPadding){const oe=_.collisionPadding;Y-=oe[0],H-=oe[1],J+=oe[2],G+=oe[3]}if(P){const oe=new Ht(Y,H),ue=new Ht(J,H),pe=new Ht(Y,G),we=new Ht(J,G),Te=Qr(P);let Ie=new Ht(0,0);N&&(Ie=new Ht(N[0],N[1])),oe._rotateAround(Te,Ie),ue._rotateAround(Te,Ie),pe._rotateAround(Te,Ie),we._rotateAround(Te,Ie),Y=Math.min(oe.x,ue.x,pe.x,we.x),J=Math.max(oe.x,ue.x,pe.x,we.x),H=Math.min(oe.y,ue.y,pe.y,we.y),G=Math.max(oe.y,ue.y,pe.y,we.y)}return c.emplaceBack(i.x,i.y,i.z,a.x,a.y,Y,H,J,G,A,h,m,x),c.length-1}function Z3(c){$6(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function KZ(c,i,a,h){const m=c.compareText;if(i in m){const x=m[i];for(let _=x.length-1;_>=0;_--)if(h.dist(x[_])<a)return!0}else m[i]=[];return m[i].push(h),!1}function hj(c,i){const a=c.fovAboveCenter,h=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,m=(c._camera.position[2]*c.worldSize-h)/Math.cos(c._pitch),x=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let _=Math.sin(c._pitch)*x+m;const A=m*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let P=Math.max(c.zoom-17,0);c.isOrthographic&&(P/=10),_*=1+P}return Math.min(1.01*_,A)}function i1(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const a=Math.pow(2,-c.z),h=c.x*a,m=(c.x+1)*a,x=c.y*a,_=(c.y+1)*a,A=Pe(h),P=Pe(m),N=Ee(x),V=Ee(_),H=i.project(A,N),G=i.project(P,N),Y=i.project(P,V),J=i.project(A,V);let oe=Math.min(H.x,G.x,Y.x,J.x),ue=Math.min(H.y,G.y,Y.y,J.y),pe=Math.max(H.x,G.x,Y.x,J.x),we=Math.max(H.y,G.y,Y.y,J.y);const Te=a/16;function Ie(Ve,Ye,nt,ot,Ot,pt){const Ut=(nt+Ot)/2,Zt=(ot+pt)/2,en=i.project(Pe(Ut),Ee(Zt)),vn=Math.max(0,oe-en.x,ue-en.y,en.x-pe,en.y-we);oe=Math.min(oe,en.x),pe=Math.max(pe,en.x),ue=Math.min(ue,en.y),we=Math.max(we,en.y),vn>Te&&(Ie(Ve,en,nt,ot,Ut,Zt),Ie(en,Ye,Ut,Zt,Ot,pt))}Ie(H,G,h,x,m,x),Ie(G,Y,m,x,m,_),Ie(Y,J,m,_,h,_),Ie(J,H,h,_,h,x),oe-=Te,ue-=Te,pe+=Te,we+=Te;const Ze=1/Math.max(pe-oe,we-ue);return{scale:Ze,x:oe*Ze,y:ue*Ze,x2:pe*Ze,y2:we*Ze,projection:i}}function fj(c,{x:i,y:a},h=0){return new Ht(((i-h)*c.scale-c.x)*xn,(a*c.scale-c.y)*xn)}const YZ=F(new Float32Array(16));class n0{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new ee(0,0)}projectTilePoint(i,a,h){return{x:i,y:a,z:0}}locationPoint(i,a,h,m=!0){return i._coordinatePoint(i.locationCoordinate(a,h),m)}pixelsPerMeter(i,a){return Se(1,i)*a}pixelSpaceConversion(i,a,h){return 1}farthestPixelDistance(i){return hj(i,i.pixelsPerMeter)}pointCoordinate(i,a,h,m){const x=i.horizonLineFromTop(!1),_=new Ht(a,Math.max(x,h));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,m))}pointCoordinate3D(i,a,h){const m=new Ht(a,h);if(i.elevation)return i.elevation.pointCoordinate(m);{const x=this.pointCoordinate(i,m.x,m.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const h=i.horizonLineFromTop();return a.y<h}createInversionMatrix(i,a){return YZ}createTileMatrix(i,a,h){let m,x,_;const A=h.canonical,P=F(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=i1(A,this);m=1,x=N.x+h.wrap*N.scale,_=N.y,K(P,P,[m/N.scale,m/N.scale,i.pixelsPerMeter/a])}else m=a/i.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*h.wrap)*m,_=A.y*m;return W(P,P,[x,_,0]),K(P,P,[m/xn,m/xn,1]),P}upVector(i,a,h){return[0,0,1]}upVectorScale(i,a,h){return{metersToTile:1}}}class JZ extends n0{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,h]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(Qr(a));this.n=(m+Math.sin(Qr(h)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:h,c:m,r0:x}=this,_=Qr(i-this.center[0]),A=Qr(a),P=Math.sqrt(m-2*h*Math.sin(A))/h;return{x:P*Math.sin(_*h),y:P*Math.cos(_*h)-x,z:0}}unproject(i,a){const{n:h,c:m,r0:x}=this,_=x+a;let A=Math.atan2(i,Math.abs(_))*Math.sign(_);_*h<0&&(A-=Math.PI*Math.sign(i)*Math.sign(_));const P=Qr(this.center[0])*h;A=tt(A,-Math.PI-P,Math.PI-P);const N=ve(Rs(A/h)+this.center[0],-180,180),V=Math.asin(ve((m-(i*i+_*_)*h*h)/(2*h),-1,1)),H=ve(Rs(V),-Ne,Ne);return new ee(N,H)}}const s1=1.340264,o1=-.081106,a1=893e-6,l1=.003796,cS=Math.sqrt(3)/2;class eQ extends n0{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const h=Math.asin(cS*Math.sin(a)),m=h*h,x=m*m*m;return{x:.5*(i*Math.cos(h)/(cS*(s1+3*o1*m+x*(7*a1+9*l1*m)))/Math.PI+.5),y:1-.5*(h*(s1+o1*m+x*(a1+l1*m))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,m=h*h,x=m*m*m;for(let V,H,G,Y=0;Y<12&&(H=h*(s1+o1*m+x*(a1+l1*m))-a,G=s1+3*o1*m+x*(7*a1+9*l1*m),V=H/G,h=ve(h-V,-Math.PI/3,Math.PI/3),m=h*h,x=m*m*m,!(Math.abs(V)<1e-12));++Y);const _=cS*i*(s1+3*o1*m+x*(7*a1+9*l1*m))/Math.cos(h),A=Math.asin(Math.sin(h)/cS),P=ve(180*_/Math.PI,-180,180),N=ve(180*A/Math.PI,-Ne,Ne);return new ee(P,N)}}class tQ extends n0{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const h=360*(i-.5),m=ve(360*(.5-a),-Ne,Ne);return new ee(h,m)}}const M_=Math.PI/2;function uS(c){return Math.tan((M_+c)/2)}class nQ extends n0{constructor(i){super(i),this.center=i.center||[0,30];const[a,h]=this.parallels=i.parallels||[30,30];let m=Qr(a),x=Qr(h);this.southernCenter=m+x<0,this.southernCenter&&(m=-m,x=-x);const _=Math.cos(m),A=uS(m);this.n=m===x?Math.sin(m):Math.log(_/Math.cos(x))/Math.log(uS(x)/A),this.f=_*Math.pow(uS(m),this.n)/this.n}project(i,a){a=Qr(a),this.southernCenter&&(a=-a),i=Qr(i-this.center[0]);const h=1e-6,{n:m,f:x}=this;x>0?a<-M_+h&&(a=-M_+h):a>M_-h&&(a=M_-h);const _=x/Math.pow(uS(a),m);let A=_*Math.sin(m*i),P=x-_*Math.cos(m*i);return A=.5*(A/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:A,y:this.southernCenter?P:1-P,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f:m}=this,x=m-a,_=Math.sign(x),A=Math.sign(h)*Math.sqrt(i*i+x*x);let P=Math.atan2(i,Math.abs(x))*_;x*h<0&&(P-=Math.PI*Math.sign(i)*_);const N=ve(Rs(P/h)+this.center[0],-180,180),V=ve(Rs(2*Math.atan(Math.pow(m/A,1/h))-M_),-Ne,Ne);return new ee(N,this.southernCenter?-V:V)}}class pj extends n0{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:be(i),y:_e(a),z:0}}unproject(i,a){const h=Pe(i),m=Ee(a);return new ee(h,m)}}const mj=Qr(Ne);class rQ extends n0{project(i,a){const h=(a=Qr(a))*a,m=h*h;return{x:.5*((i=Qr(i))*(.8707-.131979*h+m*(m*(.003971*h-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+m*(.028874*h-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,m=25,x=0,_=h*h;do{_=h*h;const N=_*_;x=(h*(1.007226+_*(.015085+N*(.028874*_-.044475-.005916*N)))-a)/(1.007226+_*(.045255+N*(.259866*_-.311325-.005916*11*N))),h=ve(h-x,-mj,mj)}while(Math.abs(x)>1e-6&&--m>0);_=h*h;const A=ve(Rs(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),P=Rs(h);return new ee(A,P)}}const gj=Qr(Ne);class iQ extends n0{project(i,a){a=Qr(a),i=Qr(i);const h=Math.cos(a),m=2/Math.PI,x=Math.acos(h*Math.cos(i/2)),_=Math.sin(x)/x,A=.5*(i*m+2*h*Math.sin(i/2)/_)||0,P=.5*(a+Math.sin(a)/_)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(i,a){let h=i=(2*i-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,x=25;const _=1e-6;let A=0,P=0;do{const N=Math.cos(m),V=Math.sin(m),H=2*V*N,G=V*V,Y=N*N,J=Math.cos(h/2),oe=Math.sin(h/2),ue=2*J*oe,pe=oe*oe,we=1-Y*J*J,Te=we?1/we:0,Ie=we?Math.acos(N*J)*Math.sqrt(1/we):0,Ze=.5*(2*Ie*N*oe+2*h/Math.PI)-i,Ve=.5*(Ie*V+m)-a,Ye=.5*Te*(Y*pe+Ie*N*J*G)+1/Math.PI,nt=Te*(ue*H/4-Ie*V*oe),ot=.125*Te*(H*oe-Ie*V*Y*ue),Ot=.5*Te*(G*J+Ie*pe*N)+.5,pt=nt*ot-Ot*Ye;A=(Ve*nt-Ze*Ot)/pt,P=(Ze*ot-Ve*Ye)/pt,h=ve(h-A,-Math.PI,Math.PI),m=ve(m-P,-gj,gj)}while((Math.abs(A)>_||Math.abs(P)>_)&&--x>0);return new ee(Rs(h),Rs(m))}}class yj extends n0{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Qr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:h,cosPhi:m}=this;return{x:Qr(i)*m*h+.5,y:-Math.sin(Qr(a))/m*h+.5,z:0}}unproject(i,a){const{scale:h,cosPhi:m}=this,x=-(a-.5)/h,_=ve(Rs((i-.5)/h)/m,-180,180),A=Math.asin(ve(x*m,-1,1)),P=ve(Rs(A),-Ne,Ne);return new ee(_,P)}}class sQ extends pj{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,h){const m=hi(i,a,h);return Un(m,m,Fi(Yr(h))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,a,h){const m=z(a.lat,a.lng),x=kt([],m),_=h?i._centerAltitude+h:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;yt(m,m,x,Se(1,0)*xn*_);const A=F(new Float64Array(16));return X(A,i.pixelMatrix,i.globeMatrix),Un(m,m,A),new Ht(m[0],m[1])}pixelsPerMeter(i,a){return Se(1,0)*a}pixelSpaceConversion(i,a,h){const m=Se(1,i)*a,x=Ar(Se(1,45)*a,m,h);return this.pixelsPerMeter(i,a)/x}createTileMatrix(i,a,h){const m=ia(Yr(h.canonical));return X(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,a){const{center:h}=i,m=Fi(Yr(a));return te(m,m,Qr(h.lng)),ne(m,m,Qr(h.lat)),K(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,a,h,m){return ar(i,a,h,!0)||new dt(0,0)}pointCoordinate3D(i,a,h){const m=this.pointCoordinate(i,a,h,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,a){return!ar(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=(function(m,x){const _=m.cameraToCenterDistance,A=m._centerAltitude*x,P=m._camera,N=m._camera.forward(),V=Ae([],bt([],N,-_),[0,0,A]),H=m.worldSize/(2*Math.PI),G=[0,0,-H],Y=m.width/m.height,J=Math.tan(m.fovAboveCenter),oe=bt([],P.up(),J),ue=bt([],P.right(),J*Y),pe=kt([],Ae([],Ae([],N,oe),ue)),we=[];let Te;if(new Kr(V,pe).closestPointOnSphere(G,H,we)){const Ie=Ae([],we,G),Ze=wn([],Ie,V);Te=Math.cos(m.fovAboveCenter)*ke(Ze)}else{const Ie=wn([],V,G),Ze=wn([],G,V);kt(Ze,Ze);const Ve=ke(Ie)-H;Te=Math.sqrt(Ve*(Ve+2*H));const Ye=Math.acos(Te/(H+Ve))-Math.acos(on(N,Ze));Te*=Math.cos(Ye)}return 1.01*Te})(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),h=Yg(i.zoom);if(h>0){const m=hj(i,Se(1,i.center.lat)*i.worldSize),x=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Ar(a,m+x*(1-Math.cos(_)),Math.pow(h,10))}return a}upVector(i,a,h){return hi(a,h,i,1)}upVectorScale(i){return{metersToTile:or(Ai(Yr(i)))}}}function xj(c){const i=c.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new pj(c);case"equirectangular":return new tQ(c);case"naturalEarth":return new rQ(c);case"equalEarth":return new eQ(c);case"winkelTripel":return new iQ(c);case"albers":return a?new yj(c):new JZ(c);case"lambertConformalConic":return a?new yj(c):new nQ(c);case"globe":return new sQ(c)}throw new Error(`Invalid projection name: ${c.name}`)}const oQ=Jt.types,aQ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function c1(c,i,a,h,m,x,_,A,P,N,V,H,G){const Y=A?Math.min(vm,Math.round(A[0])):0,J=A?Math.min(vm,Math.round(A[1])):0;c.emplaceBack(i,a,Math.round(32*h),Math.round(32*m),x,_,(Y<<1)+(P?1:0),0+(J<<1),16*N,16*V,256*H,256*G)}function u1(c,i,a){c.emplaceBack(i,a)}function d1(c,i,a,h,m,x,_){c.emplaceBack(i,a,h,m,x,_)}const dS=(c,i,a,h)=>{for(let m=0;m<i;m++)c.emplaceBack(a[0],a[1],a[2],h[0],h[1],h[2])};function k_(c,i,a,h,m){c.emplaceBack(i,a,h,m),c.emplaceBack(i,a,h,m),c.emplaceBack(i,a,h,m),c.emplaceBack(i,a,h,m)}function lQ(c){for(const i of c.sections)if(jg(i.text))return!0;return!1}class Q3{constructor(i){this.layoutVertexArray=new Vg,this.indexArray=new ys,this.programConfigurations=i,this.segments=new Li,this.dynamicLayoutVertexArray=new Vu,this.opacityVertexArray=new Hg,this.placedSymbolArray=new Qf,this.iconTransitioningVertexArray=new Dl,this.globeExtVertexArray=new zh,this.zOffsetVertexArray=new kc,this.orientationVertexArray=new qg,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(i,a){const h=[],m=this.layoutVertexArray.uint16;for(let x=0;x<a;++x){const _=12*(i+x);h.push(...m.slice(_,_+12))}return h}updateIconVertexData(i,a,h,m,x,_,A,P,N,V,H,G,Y){const J=this.layoutVertexArray.uint16,oe=12*i;J[oe]=a,J[oe+1]=h,J[oe+2]=m,J[oe+3]=x,J[oe+4]=_,J[oe+5]=A,J[oe+6]=P,J[oe+7]=N,J[oe+8]=V,J[oe+9]=H,J[oe+10]=G,J[oe+11]=Y}upload(i,a,h,m,x,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hZ.members,!!_),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,pZ.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,aQ,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,yZ.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,fZ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,mZ.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,gZ.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Fn(Q3,"SymbolBuffers");class K3{constructor(i,a,h){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new h,this.segments=new Li,this.collisionVertexArray=new Vo,this.collisionVertexArrayExt=new Vu}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,xZ.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,_Z.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fn(K3,"CollisionBuffers");class hS{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=F([]),this.placementViewportMatrix=F([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=T_(this.zoom,a["text-size"],this.worldview),this.iconSizeData=T_(this.zoom,a["icon-size"],this.worldview);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.lut=i.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((_=>Rc[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(i){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some((h=>h.getProperty(i)!=null))}createArrays(){this.text=new Q3(new ml(this.layers,{zoom:this.zoom,lut:this.lut},(i=>i.startsWith("text")||i.startsWith("symbol")))),this.icon=new Q3(new ml(this.layers,{zoom:this.zoom,lut:this.lut},(i=>i.startsWith("icon")||i.startsWith("symbol")))),this.glyphOffsetArray=new _y,this.lineVertexArray=new vy,this.symbolInstances=new uu}calculateGlyphDependencies(i,a,h,m,x){for(const _ of i){const A=_.codePointAt(0);if(A===void 0)break;if(a[A]=!0,m&&x&&A<=65535){const P=Yb[_];P&&(a[P.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(i,a,h,m,x,_){let A=1;const P=i.getUnevaluatedProperties()._values["icon-size"],N=T_(this.zoom,P,this.worldview),V=E_(N,a);if(N.kind!=="constant"&&N.kind!=="camera"||(A=V.uSize),N.kind==="composite"){const{minZoom:H,maxZoom:G}=N,Y=P.possiblyEvaluate(new rs(H,{worldview:this.worldview}),m),J=P.possiblyEvaluate(new rs(G,{worldview:this.worldview}),m),oe=Y.evaluate(h,{},m,x);A=oe+(J.evaluate(h,{},m,x)-oe)*V.uSizeT}return N.kind==="source"&&(A=P.possiblyEvaluate(new rs(this.zoom,{worldview:this.worldview}),m).evaluate(h,{},m,x)),A*_}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!z2(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}getResolvedImageFromTokens(i){return typeof i=="string"?za.build(i):i}populate(i,a,h,m){const x=this.layers[0],_=x.layout,A=this.projection.name==="globe",P=_.get("text-font"),N=_.get("text-field"),V=_.get("icon-image"),[H,G]=_.get("icon-size-scale-range"),Y=ve(a.scaleFactor||1,H,G),J=(N.value.kind!=="constant"||N.value.value instanceof Io&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),oe=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,ue=this.hasAnyAppearanceProperty("icon-image"),pe=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!J&&!oe&&!ue)return;const we=a.iconDependencies,Te=a.glyphDependencies,Ie=a.availableImages,Ze=new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Ve=Ye=>{const nt=Ye.id.toString();we.has(nt)?we.get(nt).push(Ye):we.set(nt,[Ye])};for(const Ye of i){const{feature:nt,id:ot,index:Ot,sourceLayerIndex:pt}=Ye,Ut=x._featureFilter.needGeometry,Zt=Mt(nt,Ut);if(!x._featureFilter.filter(Ze,Zt,h))continue;if(Ut||(Zt.geometry=zt(nt,h,m)),A&&nt.type!==1&&h.z<=5){const nn=Zt.geometry,gn=.98078528056,Yt=(zn,Zn)=>on(hi(zn.x,zn.y,h,1),hi(Zn.x,Zn.y,h,1))<gn;for(let zn=0;zn<nn.length;zn++)nn[zn]=Gt(nn[zn],Yt)}let en,vn;if(J){const nn=x.getValueAndResolveTokens("text-field",Zt,h,Ie),gn=Io.factory(nn);lQ(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||Uo()==="unavailable"||this.hasRTLText&&na.isParsed())&&(en=bZ(gn,x,Zt))}if(oe){const nn=x.getValueAndResolveTokens("icon-image",Zt,h,Ie);vn=this.getResolvedImageFromTokens(nn)}const an=this.layers[0];let Qt=!1;if(!vn&&ue){const nn=an.getAppearances();for(const gn of nn)if(gn.getProperty("icon-image")){const Yt=an.getAppearanceValueAndResolveTokens(gn,"icon-image",Zt,h,Ie);if(Yt){vn=this.getResolvedImageFromTokens(Yt),Qt=!0;break}}}if(!en&&!vn)continue;const sn=this.sortFeaturesByKey?pe.evaluate(Zt,{},h):void 0,jt={id:ot,text:en,icon:vn,index:Ot,sourceLayerIndex:pt,geometry:Zt.geometry,properties:nt.properties,type:oQ[nt.type],sortKey:sn};if(this.features.push(jt),this.appearanceFeatureData.push({id:ot,properties:nt.properties,usesAppearanceIconAsPlaceholder:Qt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),vn){const nn=an._unevaluatedLayout._values,{iconPrimary:gn,iconSecondary:Yt}=n1(vn,this.iconSizeData,nn["icon-size"],h,this.zoom,jt,this.pixelRatio,Y,this.worldview);Ve(gn),Yt&&(this.hasAnySecondaryIcon=!0,Ve(Yt))}const Rt=an.getAppearances();if(Rt.length!==0&&Rt.forEach((nn=>{if(!nn.getProperty("icon-image"))return;const gn=this.getCombinedIconPrimary(nn,an,Zt,h,Ie,jt,Y);gn&&Ve(gn)})),en){const nn=P.evaluate(Zt,{},h).join(","),gn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rc.vertical)>=0;for(const Yt of en.sections)if(Yt.image){const zn=Yt.image.getPrimary().scaleSelf(this.pixelRatio),Zn=zn.id.toString(),jn=we.get(Zn)||[];jn.push(zn),we.set(Zn,jn)}else{const zn=Nh(en.toString()),Zn=Yt.fontStack||nn,jn=Te[Zn]=Te[Zn]||{};this.calculateGlyphDependencies(Yt.text,jn,gn,this.allowVerticalPlacement,zn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ye){const nt={},ot={},Ot=[];let pt=0;function Ut(an){Ot.push(Ye[an]),pt++}function Zt(an,Qt,sn){const jt=ot[an];return delete ot[an],ot[Qt]=jt,Ot[jt].geometry[0].pop(),Ot[jt].geometry[0]=Ot[jt].geometry[0].concat(sn[0]),jt}function en(an,Qt,sn){const jt=nt[Qt];return delete nt[Qt],nt[an]=jt,Ot[jt].geometry[0].shift(),Ot[jt].geometry[0]=sn[0].concat(Ot[jt].geometry[0]),jt}function vn(an,Qt,sn){const jt=sn?Qt[0][Qt[0].length-1]:Qt[0][0];return`${an}:${jt.x}:${jt.y}`}for(let an=0;an<Ye.length;an++){const Qt=Ye[an],sn=Qt.geometry,jt=Qt.text?Qt.text.toString():null;if(!jt){Ut(an);continue}const Rt=vn(jt,sn),nn=vn(jt,sn,!0);if(Rt in ot&&nn in nt&&ot[Rt]!==nt[nn]){const gn=en(Rt,nn,sn),Yt=Zt(Rt,nn,Ot[gn].geometry);delete nt[Rt],delete ot[nn],ot[vn(jt,Ot[Yt].geometry,!0)]=Yt,Ot[gn].geometry=null}else Rt in ot?Zt(Rt,nn,sn):nn in nt?en(Rt,nn,sn):(Ut(an),nt[Rt]=pt-1,ot[nn]=pt-1)}return Ot.filter((an=>an.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ye of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ye.id,this.elevationFeatures.length),this.elevationFeatures.push(Ye)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ye,nt)=>Ye.sortKey-nt.sortKey))}getCombinedIconPrimary(i,a,h,m,x,_,A){let P,N;const V=i.getUnevaluatedProperties();if(V._values["icon-image"].value!==void 0){const H=a.getAppearanceValueAndResolveTokens(i,"icon-image",h,m,x);P=this.getResolvedImageFromTokens(H)}else{const H=a.getValueAndResolveTokens("icon-image",h,m,x);P=this.getResolvedImageFromTokens(H)}if(P){const H=V._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];N=n1(P,T_(this.zoom,H,this.worldview),H,m,this.zoom,_,this.pixelRatio,A,this.worldview).iconPrimary}return N}updateAppearanceBasedIconTextures(i,a,h,m){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const x=this.layers[0];let _=!1,A=0;const P=x.layout,[N,V]=P.get("icon-size-scale-range"),H=ve(1,N,V);for(let G=0;G<this.symbolInstances.length;G++){const Y=this.symbolInstances.get(G),J=this.appearanceFeatureData[Y.featureIndex];if(J&&Y.placedIconSymbolIndex>=0){const oe=J.id,ue=a&&oe!==void 0?a[String(oe)]:void 0,pe={type:"Point",id:J.id,properties:J.properties,geometry:[]},we=this.layers[0].appearances&&this.layers[0].appearances.find((Te=>Te.isActive({globals:m,feature:pe,canonical:i,featureState:ue})));if(J.activeAppearance===we)continue;if(we){J.activeAppearance=we;const Te={sortKey:void 0,text:void 0,icon:null,index:Y.featureIndex,sourceLayerIndex:Y.featureIndex,geometry:[],properties:J.properties,type:"Point",id:J.id};if(!we.hasCachedIconPrimary()){const Ye=this.getCombinedIconPrimary(we,x,pe,i,h,Te,H);we.setCachedIconPrimary(Ye)}const Ie=we.getCachedIconPrimary();if(!Ie)continue;const Ze=Ie.toString(),Ve=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ze);if(Ve){const Ye=x.getAppearanceValueAndResolveTokens(we,"icon-offset",pe,i,h),nt=Ye&&Array.isArray(Ye)?Ye:[0,0];let ot=nS(Ve,void 0,nt,x.layout.get("icon-anchor").evaluate(pe,{},i));const Ot=x.getAppearanceValueAndResolveTokens(we,"icon-rotate",pe,i,h),pt=typeof Ot=="number"?Ot:0,Ut=Ve.sdf,Zt=x.layout.get("icon-text-fit").constantOr("none");Zt!=="none"&&J.textShaping&&J.iconTextFitPadding&&J.fontScale&&(ot=U3(ot,J.textShaping,Zt,J.iconTextFitPadding,nt,J.fontScale));const en=this.calculateEffectiveAppearanceIconSize(we,m.zoom,pe,i,h,H),vn=0,an=1+(Math.min(vm,Math.round(en*Zh))<<1),Qt=$3(ot,pt,Ut,Zt!=="none",H);J.isUsingAppearanceVertexData||(J.isUsingAppearanceVertexData=!0,J.layoutBasedVertexData=this.icon.getIconVertexData(A,Y.numIconVertices));for(let jt=0;jt<Qt.length;++jt){const Rt=Qt[jt],nn=J.layoutBasedVertexData[0]||Y.tileAnchorX,gn=J.layoutBasedVertexData[1]||Y.tileAnchorY,Yt=16*Rt.pixelOffsetTL.x,zn=16*Rt.pixelOffsetTL.y,Zn=16*Rt.pixelOffsetBR.x,jn=16*Rt.pixelOffsetBR.y,Mn=16*Rt.minFontScaleX,Fr=16*Rt.minFontScaleY;this.icon.updateIconVertexData(A,nn,gn,Math.round(32*Rt.tl.x),Math.round(32*Rt.tl.y),Rt.texPrimary.x,Rt.texPrimary.y,vn,an,Yt,zn,Mn,Fr),this.icon.updateIconVertexData(A+1,nn,gn,Math.round(32*Rt.tr.x),Math.round(32*Rt.tr.y),Rt.texPrimary.x+Rt.texPrimary.w,Rt.texPrimary.y,vn,an,Zn,zn,Mn,Fr),this.icon.updateIconVertexData(A+2,nn,gn,Math.round(32*Rt.bl.x),Math.round(32*Rt.bl.y),Rt.texPrimary.x,Rt.texPrimary.y+Rt.texPrimary.h,vn,an,Yt,jn,Mn,Fr),this.icon.updateIconVertexData(A+3,nn,gn,Math.round(32*Rt.br.x),Math.round(32*Rt.br.y),Rt.texPrimary.x+Rt.texPrimary.w,Rt.texPrimary.y+Rt.texPrimary.h,vn,an,Zn,jn,Mn,Fr),A+=4}const sn=Y.numIconVertices-4*Qt.length;for(let jt=0;jt<sn;++jt)this.icon.updateIconVertexData(A+jt,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else A+=Y.numIconVertices}else if(J.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(A,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),A+=Y.numIconVertices,J.activeAppearance=null;else if(J.isUsingAppearanceVertexData){const Ie=J.layoutBasedVertexData.length/12;for(let Ze=0;Ze<Ie;++Ze){const Ve=Ze*12;this.icon.updateIconVertexData(A+Ze,J.layoutBasedVertexData[Ve+0],J.layoutBasedVertexData[Ve+1],J.layoutBasedVertexData[Ve+2],J.layoutBasedVertexData[Ve+3],J.layoutBasedVertexData[Ve+4],J.layoutBasedVertexData[Ve+5],J.layoutBasedVertexData[Ve+6],J.layoutBasedVertexData[Ve+7],J.layoutBasedVertexData[Ve+8],J.layoutBasedVertexData[Ve+9],J.layoutBasedVertexData[Ve+10],J.layoutBasedVertexData[Ve+11])}A+=Ie,J.isUsingAppearanceVertexData=!1,J.activeAppearance=null,_=!0}else A+=Y.numIconVertices,J.activeAppearance=null}}return _}update(i,a,h,m,x,_,A){this.text.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,a,x,h,m,_,A,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const h=Qe(i),m=1/h;let x=!1,_=!1;for(let A=0;A<this.symbolInstances.length;A++){const P=this.symbolInstances.get(A),N=je(1,0,0),V=je(0,1,0),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:G,numIconVertices:Y,numVerticalIconVertices:J}=P,oe=H>0||G>0,ue=Y>0,pe=this.elevationFeatures[P.elevationFeatureIndex];if(pe){const we=new Ht(P.tileAnchorX,P.tileAnchorY),Te=.075+pe.pointElevation(we);P.zOffset!==Te&&(a=!0,P.zOffset=Te),Te!==0&&(this.hasAnyZOffset=!0);const Ie=pe.computeSlopeNormal(we,m),Ze=bn(Bt(),je(0,0,1),Ie);ht(N,N,Ze),ht(V,V,Ze),N[2]*=h,V[2]*=h,N[0]===1&&N[1]===0&&N[2]===0&&V[0]===0&&V[1]===1&&V[2]===0||(x=x||oe,_=_||ue)}if(oe&&(dS(this.text.orientationVertexArray,H,N,V),dS(this.text.orientationVertexArray,G,N,V)),ue){const{placedIconSymbolIndex:we,verticalPlacedIconSymbolIndex:Te}=P;we>=0&&dS(this.icon.orientationVertexArray,Y,N,V),Te>=0&&dS(this.icon.orientationVertexArray,J,N,V)}}x||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(x,_,A)=>{h+=_,h>x.length&&x.resize(h);for(let P=-_;P<0;P++)x.emplace(P+h,A)},a=(x,_,A)=>{m+=_,m>x.length&&x.resize(m);for(let P=-_;P<0;P++)x.emplace(P+m,A)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,m=0;for(let x=0;x<this.symbolInstances.length;x++){const _=this.symbolInstances.get(x),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:P,numIconVertices:N}=_,V=_.zOffset,H=N>0;if((A>0||P>0)&&(i(this.text.zOffsetVertexArray,A,V),i(this.text.zOffsetVertexArray,P,V)),H){const{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:Y}=_;G>=0&&a(this.icon.zOffsetVertexArray,N,V),Y>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,V)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i,a,h,m,x){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(i,a,h,m){return!!(i&&a&&h)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(i,a,h,m)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xj(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const h=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:m,y:x}of a)this.lineVertexArray.emplaceBack(m,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe,ue,pe,we){const Te=i.indexArray,Ie=i.layoutVertexArray,Ze=i.globeExtVertexArray,Ve=i.segments.prepareSegment(4*we,Ie,Te,this.canOverlap?_.sortKey:void 0),Ye=this.glyphOffsetArray.length,nt=Ve.vertexLength,ot=this.allowVerticalPlacement&&A===Rc.vertical?Math.PI/2:0,Ot=_.text&&_.text.sections;for(let Zt=0;Zt<a.length;Zt++){const{tl:en,tr:vn,bl:an,br:Qt,texPrimary:sn,texSecondary:jt,pixelOffsetTL:Rt,pixelOffsetBR:nn,minFontScaleX:gn,minFontScaleY:Yt,glyphOffset:zn,isSDF:Zn,sectionIndex:jn}=a[Zt],Mn=Ve.vertexLength,Fr=zn[1];if(c1(Ie,N.x,N.y,en.x,Fr+en.y,sn.x,sn.y,h,Zn,Rt.x,Rt.y,gn,Yt),c1(Ie,N.x,N.y,vn.x,Fr+vn.y,sn.x+sn.w,sn.y,h,Zn,nn.x,Rt.y,gn,Yt),c1(Ie,N.x,N.y,an.x,Fr+an.y,sn.x,sn.y+sn.h,h,Zn,Rt.x,nn.y,gn,Yt),c1(Ie,N.x,N.y,Qt.x,Fr+Qt.y,sn.x+sn.w,sn.y+sn.h,h,Zn,nn.x,nn.y,gn,Yt),P){const{x:Rn,y:br,z:Ur}=P.anchor,[fi,Pi,Wr]=P.up;d1(Ze,Rn,br,Ur,fi,Pi,Wr),d1(Ze,Rn,br,Ur,fi,Pi,Wr),d1(Ze,Rn,br,Ur,fi,Pi,Wr),d1(Ze,Rn,br,Ur,fi,Pi,Wr),k_(i.dynamicLayoutVertexArray,Rn,br,Ur,ot)}else k_(i.dynamicLayoutVertexArray,N.x,N.y,N.z,ot);if(ue){const Rn=jt||sn;u1(i.iconTransitioningVertexArray,Rn.x,Rn.y),u1(i.iconTransitioningVertexArray,Rn.x+Rn.w,Rn.y),u1(i.iconTransitioningVertexArray,Rn.x,Rn.y+Rn.h),u1(i.iconTransitioningVertexArray,Rn.x+Rn.w,Rn.y+Rn.h)}Te.emplaceBack(Mn,Mn+1,Mn+2),Te.emplaceBack(Mn+1,Mn+2,Mn+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zn[0]),Zt!==a.length-1&&jn===a[Zt+1].sectionIndex||i.programConfigurations.populatePaintArrays(Ie.length,_,_.index,{},Y,J,oe,Ot&&Ot[jn],this.worldview)}const pt=we-a.length;pt!==0&&this._addNullVertices(pt,Ie,h,P,Ze,i,ue,Ve,Te);const Ut=P?P.anchor:N;i.placedSymbolArray.emplaceBack(Ut.x,Ut.y,Ut.z,N.x,N.y,Ye,this.glyphOffsetArray.length-Ye,nt,V,H,N.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],A,0,0,0,G,0),i.symbolInstanceIndices.push(pe)}_addNullVertices(i,a,h,m,x,_,A,P,N){for(let V=0;V<i;V++){for(let G=0;G<4;G++)c1(a,0,0,0,0,0,0,h,!1,0,0,0,0),m&&d1(x,0,0,0,0,0,0),k_(_.dynamicLayoutVertexArray,0,0,0,0),A&&u1(_.iconTransitioningVertexArray,0,0);const H=P.vertexLength;N.emplaceBack(H,H+1,H+2),N.emplaceBack(H+1,H+2,H+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(i,a,h,m,x,_,A){i.emplaceBack(a,h,m,x,_,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(i,a,h,m,x,_,A){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),N=P.vertexLength,V=A.tileAnchorX,H=A.tileAnchorY;for(let Y=0;Y<4;Y++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,a,i.padding,A.zOffset),this._commitLayoutVertex(h.layoutVertexArray,m,x,_,V,H,new Ht(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,x,_,V,H,new Ht(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,x,_,V,H,new Ht(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,m,x,_,V,H,new Ht(i.x1,i.y2)),P.vertexLength+=4;const G=h.indexArray;G.emplaceBack(N,N+1),G.emplaceBack(N+1,N+2),G.emplaceBack(N+2,N+3),G.emplaceBack(N+3,N),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,h,m,x,_){for(let A=m;A<x;A++){const P=h.get(A),N=this.getSymbolInstanceTextSize(i,_,a,A);this._addCollisionDebugVertices(P,N,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,a,h,m,x,_){for(let A=m;A<x;A++){const P=h.get(A),N=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(P,N,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,a,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new K3($g,D6.members,Dl),this.iconCollisionBox=new K3($g,D6.members,Dl);const m=E_(this.iconSizeData,i),x=E_(this.textSizeData,i,h);for(let _=0;_<this.symbolInstances.length;_++){const A=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(x,i,a,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(x,i,a,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(m,i,a,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(m,i,a,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(i,a,h,m){const x=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),_=V3(this.textSizeData,i,x)/sa;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,a,h){const m=this.icon.placedSymbolArray.get(h),x=V3(this.iconSizeData,i,m);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(i,a,h,m){i.emplaceBack(a,-h,-h,m),i.emplaceBack(a,h,-h,m),i.emplaceBack(a,h,h,m),i.emplaceBack(a,-h,h,m)}_updateTextDebugCollisionBoxes(i,a,h,m,x,_,A){for(let P=m;P<x;P++){const N=h.get(P),V=this.getSymbolInstanceTextSize(i,_,a,P);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,V,N.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,a,h,m,x,_,A){for(let P=m;P<x;P++){const N=h.get(P),V=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,V,N.padding,_.zOffset)}}updateCollisionDebugBuffers(i,a,h,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=E_(this.iconSizeData,i,m),_=E_(this.textSizeData,i,h);for(let A=0;A<this.symbolInstances.length;A++){const P=this.symbolInstances.get(A);this._updateTextDebugCollisionBoxes(_,i,a,P.textBoxStartIndex,P.textBoxEndIndex,P,h),this._updateTextDebugCollisionBoxes(_,i,a,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P,h),this._updateIconDebugCollisionBoxes(x,i,a,P.iconBoxStartIndex,P.iconBoxEndIndex,P,m),this._updateIconDebugCollisionBoxes(x,i,a,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,h,m,x,_,A,P,N){const V={};if(a<h){const{x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie,featureIndex:Ze}=i.get(a);V.textBox={x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie},V.textFeatureIndex=Ze}if(m<x){const{x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie,featureIndex:Ze}=i.get(m);V.verticalTextBox={x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie},V.verticalTextFeatureIndex=Ze}if(_<A){const{x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie,featureIndex:Ze}=i.get(_);V.iconBox={x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie},V.iconFeatureIndex=Ze}if(P<N){const{x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie,featureIndex:Ze}=i.get(P);V.verticalIconBox={x1:H,y1:G,x2:Y,y2:J,padding:oe,projectedAnchorX:ue,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Ie},V.verticalIconFeatureIndex=Ze}return V}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const h=i.placedSymbolArray.get(a),m=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<m;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),h=Math.cos(i),m=[],x=[],_=[];for(let A=0;A<this.symbolInstances.length;++A){_.push(A);const P=this.symbolInstances.get(A);m.push(0|Math.round(a*P.tileAnchorX+h*P.tileAnchorY)),x.push(P.featureIndex)}return _.sort(((A,P)=>m[A]-m[P]||x[P]-x[A])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset))}addToSortKeyRanges(i,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:N}=h;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),_>=0&&_!==x&&_!==m&&this.addIndicesForPlacedSymbol(this.text,_),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(i){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[i]).elevationFeatureIndex;let h;return this.elevationFeatures&&a<this.elevationFeatures.length&&(h=this.elevationFeatures[a]),h}}function _j(c,i){return i.replace(/{([^{}]+)}/g,((a,h)=>h in c?String(c[h]):""))}let vj,bj,Y3;Fn(hS,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),hS.addDynamicAttributes=k_;class wj{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:wd,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fn(wj,"FormatSectionOverride",{omit:["defaultValue"]});const J3=()=>Y3||(Y3={layout:vj||(vj=new Ns({"symbol-placement":new dn(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new dn(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dn(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dn(ft.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new dn(ft.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new dn(ft.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new dn(ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new dn(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new dn(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dn(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(ft.layout_symbol["icon-size"]),"icon-size-scale-range":new dn(ft.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Pn(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pn(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(ft.layout_symbol["icon-image"]),"icon-image-use-theme":new dn({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Pn(ft.layout_symbol["icon-rotate"]),"icon-padding":new dn(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new dn(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(ft.layout_symbol["icon-offset"]),"icon-anchor":new Pn(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dn(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dn(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dn(ft.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(ft.layout_symbol["text-field"]),"text-font":new Pn(ft.layout_symbol["text-font"]),"text-size":new Pn(ft.layout_symbol["text-size"]),"text-size-scale-range":new dn(ft.layout_symbol["text-size-scale-range"]),"text-max-width":new Pn(ft.layout_symbol["text-max-width"]),"text-line-height":new Pn(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(ft.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(ft.layout_symbol["text-justify"]),"text-radial-offset":new Pn(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dn(ft.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(ft.layout_symbol["text-anchor"]),"text-max-angle":new dn(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new dn(ft.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(ft.layout_symbol["text-rotate"]),"text-padding":new dn(ft.layout_symbol["text-padding"]),"text-keep-upright":new dn(ft.layout_symbol["text-keep-upright"]),"text-transform":new Pn(ft.layout_symbol["text-transform"]),"text-offset":new Pn(ft.layout_symbol["text-offset"]),"text-allow-overlap":new dn(ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new dn(ft.layout_symbol["text-ignore-placement"]),"text-optional":new dn(ft.layout_symbol["text-optional"]),visibility:new dn(ft.layout_symbol.visibility)})),paint:bj||(bj=new Ns({"icon-opacity":new Pn(ft.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pn(ft.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pn(ft.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pn(ft.paint_symbol["text-emissive-strength"]),"icon-color":new Pn(ft.paint_symbol["icon-color"]),"icon-halo-color":new Pn(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new dn(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new dn(ft.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new dn(ft.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pn(ft.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pn(ft.paint_symbol["text-occlusion-opacity"]),"text-color":new Pn(ft.paint_symbol["text-color"],{runtimeType:ol,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Pn(ft.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(ft.paint_symbol["text-halo-blur"]),"text-translate":new dn(ft.paint_symbol["text-translate"]),"text-translate-anchor":new dn(ft.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new dn(ft.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new dn(ft.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new dn(ft.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new dn(ft.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Pn(ft.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},Y3);class fS extends pa{constructor(i,a,h,m){super(i,J3(),a,h,m,i.layout?i.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=F([]),this.hasOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}_handleSpecialPaintPropertyUpdate(i){i!=="icon-occlusion-opacity"&&i!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(i,a){super.recalculate(i,a),this.appearances&&this.appearances.forEach((m=>{m.recalculate(i,a,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const x of h)m.indexOf(x)<0&&m.push(x);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,h,m){return this._saturation===i&&this._contrast===a&&this._brightnessMin===h&&this._brightnessMax===m||(this._colorAdjustmentMatrix=(function(x,_,A,P){x=vi(x),_=ai(_);const N=D(),V=x/3,H=1-2*V,G=[H,V,V,0,V,H,V,0,V,V,H,0,0,0,0,1],Y=.5-.5*_,J=P-A;return X(N,[J,0,0,0,0,J,0,0,0,0,J,0,A,A,A,1],[_,0,0,0,0,_,0,0,0,0,_,0,Y,Y,Y,1]),X(N,N,G),N})(i,a,h,m),this._saturation=i,this._contrast=a,this._brightnessMin=h,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,h,m){const x=this.layout.get(i).evaluate(a,{},h,m),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||Ff(_.value)||!x?x:_j(a.properties,x)}getAppearanceValueAndResolveTokens(i,a,h,m,x){const _=i.getProperty(a);if(!_)return;const A=_.evaluate(h,{},m,x),P=i.getUnevaluatedProperties()._values[a];return P.isDataDriven()||Ff(P.value)||!A||typeof A!="string"?A:_j(h.properties,A)}createBucket(i){return new hS(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of J3().paint.overridableProperties){if(!fS.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),h=new wj(a),m=new Of(h,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let x=null;x=a.value.kind==="constant"||a.value.kind==="source"?new Sa("source",m):new fl("composite",m,a.value.zoomStops,a.value.interpolationType),this.paint._values[i]=new xo(a.property,x,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&fS.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const h=i.get("text-field"),m=J3().paint.properties[a];let x=!1;const _=A=>{for(const P of A)if(m.overrides&&m.overrides.hasOverride(P))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Io)_(h.value.value.sections);else if(h.value.kind==="source"){const A=N=>{x||(N instanceof tu&&so(N.value)===gh?_(N.value.sections):N instanceof Td?_(N.sections):N.eachChild(A))},P=h.value;P._styleExpression&&A(P._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,h){return{config:new Gu(this,{zoom:a,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Sj,Tj,Ej,Aj;var eC=di([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function pS(c,i,a,h,m,x,_,A){const P=[c,i,1,a,h,1,m,x,1],N=[_,A,1],V=k([],P),[H,G,Y]=$r(N,N,V);return R(P,P,[H,0,0,0,G,0,0,0,Y])}function Cj(c,i,a,h,m,x,_,A){const P=(function(N,V,H,G,Y,J,oe,ue){const pe=pS(0,0,1,0,1,1,0,1),we=pS(N,V,H,G,Y,J,oe,ue);return R(we,we,k([],pe))})(c,i,a,h,m,x,_,A);return[P[2]/P[8]/xn,P[5]/P[8]/xn]}function mS(c){return[c[0],Math.min(Math.max(c[1],-Ne),Ne)]}class Mj extends Jc{constructor(i,a,h,m){super(),this.id=i,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new wa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=gf(this.map._requestManager.transformRequest(this.url,xc.Image),((h,m)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new yf(h)):m&&(this.image=m instanceof HTMLImageElement?eo.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())}))}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Zb(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Zb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],h=i[0][1];for(const x of i)x[1]>h&&(h=x[1]),x[1]<a&&(a=x[1]);const m=(h+a)/2;if(m>Ne?this.onNorthPole=!0:m<-Ne&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=i.map(dt.fromLngLat);this.tileID=(function(_){let A=1/0,P=1/0,N=-1/0,V=-1/0;for(const oe of _)A=Math.min(A,oe.x),P=Math.min(P,oe.y),N=Math.max(N,oe.x),V=Math.max(V,oe.y);const H=Math.max(N-A,V-P),G=Math.max(0,Math.floor(-Math.log2(H))),Y=Math.pow(2,G);let J=Math.floor((A+N)/2*Y);return J>1&&(J-=1),new M(G,J,Math.floor((P+V)/2*Y))})(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Zb||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const pe in this.tiles){const we=this.tiles[pe];we.state!=="loaded"&&(we.state="loaded",we.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=i1(new M(0,0,0),this.map.transform.projection),h=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(pe){const we=pe[1].x-pe[0].x,Te=pe[1].y-pe[0].y,Ie=pe[2].x-pe[1].x,Ze=pe[2].y-pe[1].y,Ve=pe[3].x-pe[2].x,Ye=pe[3].y-pe[2].y,nt=pe[0].x-pe[3].x,ot=pe[0].y-pe[3].y,Ot=we*Ze-Ie*Te,pt=Ie*Ye-Ve*Ze,Ut=Ve*ot-nt*Ye,Zt=nt*Te-we*ot;return Ot>0&&pt>0&&Ut>0&&Zt>0||Ot<0&&pt<0&&Ut<0&&Zt<0})(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=i1(this.tileID,this.map.transform.projection),[x,_,A,P]=this.coordinates.map((pe=>{const we=m.projection.project(pe[0],pe[1]);return fj(m,we)._round()}));this.perspectiveTransform=Cj(x.x,x.y,_.x,_.y,A.x,A.y,P.x,P.y);const N=this._boundsArray=new Ea;N.emplaceBack(x.x,x.y,0,0),N.emplaceBack(_.x,_.y,xn,0),N.emplaceBack(P.x,P.y,0,xn),N.emplaceBack(A.x,A.y,xn,xn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(N,eC.members),this.boundsSegments=Li.simpleSegment(0,0,4,2);const V=[],H=[mS((G=this.coordinates)[0]),mS(G[1]),mS(G[2]),mS(G[3])];var G;const[Y,J,oe,ue]=(function(pe){let we=pe[0][0],Te=we,Ie=pe[0][1],Ze=Ie;for(let Ve=1;Ve<pe.length;Ve++)pe[Ve][0]<we?we=pe[Ve][0]:pe[Ve][0]>Te&&(Te=pe[Ve][0]),pe[Ve][1]<Ie?Ie=pe[Ve][1]:pe[Ve][1]>Ze&&(Ze=pe[Ve][1]);return[we,Ie,Te-we,Ze-Ie]})(H);{const pe=new Ea,[we,Te,Ie,Ze]=(function(Qt){let sn=Qt[0].x,jt=sn,Rt=Qt[0].y,nn=Rt;for(let gn=1;gn<Qt.length;gn++)Qt[gn].x<sn?sn=Qt[gn].x:Qt[gn].x>jt&&(jt=Qt[gn].x),Qt[gn].y<Rt?Rt=Qt[gn].y:Qt[gn].y>nn&&(nn=Qt[gn].y);return[sn,Rt,jt-sn,nn-Rt]})(h),Ve=Qt=>[(Qt.x-we)/Ie,(Qt.y-Te)/Ze],[Ye,nt,ot,Ot]=h.map(Ve),pt=(function(Qt,sn,jt,Rt,nn,gn,Yt,zn){const Zn=pS(0,0,1,0,1,1,0,1);return R(Zn,Zn,k([],pS(Qt,sn,jt,Rt,nn,gn,Yt,zn)))})(Ye[0],Ye[1],nt[0],nt[1],ot[0],ot[1],Ot[0],Ot[1]);this.elevatedGlobePerspectiveTransform=Cj(Ye[0],Ye[1],nt[0],nt[1],ot[0],ot[1],Ot[0],Ot[1]);const Ut=(Qt,sn)=>{V.push(Qt.lng);const jt=Math.round((Qt.lng-Y)/oe*xn),Rt=Math.round((Qt.lat-J)/ue*xn),nn=Ve(sn),gn=$r([],[nn[0],nn[1],1],pt),Yt=Math.round(gn[0]/gn[2]*xn),zn=Math.round(gn[1]/gn[2]*xn);pe.emplaceBack(jt,Rt,Yt,zn)},Zt=h[3].x-h[0].x,en=h[3].y-h[0].y,vn=h[2].x-h[1].x,an=h[2].y-h[1].y;for(let Qt=0;Qt<65;Qt++){const sn=Qt/64,jt=[h[0].x+sn*Zt,h[0].y+sn*en],Rt=[h[1].x+sn*vn,h[1].y+sn*an],nn=Rt[0]-jt[0],gn=Rt[1]-jt[1];for(let Yt=0;Yt<65;Yt++){const zn=Yt/64,Zn={x:jt[0]+nn*zn,y:jt[1]+gn*zn};Ut(a.projection.unproject(Zn.x,Zn.y),Zn)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(pe,eC.members)}{this.maxLongitudeTriangleSize=0;let pe=[],we=new ys;const Te=(Ie,Ze,Ve)=>{we.emplaceBack(Ie,Ze,Ve);const Ye=V[Ie],nt=V[Ze],ot=V[Ve],Ot=Math.min(Math.min(Ye,nt),ot),pt=Math.max(Math.max(Ye,nt),ot)-Ot;pt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pt),pe.push(Ot+pt/2)};for(let Ie=0;Ie<64;Ie++)for(let Ze=0;Ze<64;Ze++){const Ve=65*Ie+Ze,Ye=Ve+1,nt=Ve+65,ot=nt+1;Te(Ve,nt,Ye),Te(Ye,nt,ot)}[pe,we]=(function(Ie,Ze){const Ve=Array.from({length:Ie.length},((ot,Ot)=>Ot));Ve.sort(((ot,Ot)=>Ie[ot]-Ie[Ot]));const Ye=[],nt=new ys;for(let ot=0;ot<Ve.length;ot++){const Ot=Ve[ot];Ye.push(Ie[Ot]);const pt=3*Ot,Ut=pt+1;nt.emplaceBack(Ze.uint16[pt],Ze.uint16[Ut],Ze.uint16[Ut+1])}return[Ye,nt]})(pe,we),this.elevatedGlobeTrianglesCenterLongitudes=pe,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(we)}this.elevatedGlobeSegments=Li.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,oe/xn,0,ue/xn,0,0,J,Y,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,h=a.gl;!this._dirty||this.texture instanceof Zb||(this.texture?this.texture.update(this.image):(this.texture=new A3(a,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let m=(x=i+180)+360*Math.round((h[0]-x)/360);var x;const _=new Li,A=(H,G)=>{_.segments.push({vertexOffset:0,primitiveOffset:H,vertexLength:a.segments[0].vertexLength,primitiveLength:G,sortKey:void 0,vaos:{}})},P=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-m)<=P){const H=ur(h,0,h.length,m+P);return H===h.length||A(H,fr(h,H+1,h.length,m+360-P)-H),_}m<h[0]&&(m+=360);const N=fr(h,0,h.length,m-P);if(N===h.length)return A(0,h.length),_;A(0,N-0);const V=ur(h,N+1,h.length,m+P);return V!==h.length&&A(V,h.length-V),_}}const cQ=(Math.pow(256,2)-1)/16907520;class kj extends pa{constructor(i,a,h,m){super(i,{layout:Ej||(Ej=new Ns({visibility:new dn(ft.layout_raster.visibility)})),paint:Aj||(Aj=new Ns({"raster-opacity":new dn(ft.paint_raster["raster-opacity"]),"raster-color":new jh(ft.paint_raster["raster-color"]),"raster-color-mix":new dn(ft.paint_raster["raster-color-mix"]),"raster-color-range":new dn(ft.paint_raster["raster-color-range"]),"raster-hue-rotate":new dn(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dn(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dn(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new dn(ft.paint_raster["raster-saturation"]),"raster-contrast":new dn(ft.paint_raster["raster-contrast"]),"raster-resampling":new dn(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new dn(ft.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new dn(ft.paint_raster["raster-emissive-strength"]),"raster-array-band":new dn(ft.paint_raster["raster-array-band"]),"raster-elevation":new dn(ft.paint_raster["raster-elevation"]),"raster-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},a,h,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof Mj&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[h,m]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(m)||h===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=jb({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,m])}}let Ij,Pj,Rj,Nj,jj;class Dj extends pa{constructor(i,a,h,m){super(i,{layout:Ij||(Ij=new Ns({visibility:new dn(ft["layout_raster-particle"].visibility)})),paint:Pj||(Pj=new Ns({"raster-particle-array-band":new dn(ft["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new dn(ft["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new jh(ft["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new dn(ft["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new dn(ft["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new dn(ft["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new dn(ft["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new dn(ft["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},a,h,m),this._updateColorRamp(),this.lastInvalidatedAt=eo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=jb({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=eo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class uQ extends pa{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function tC(c,i,a){const h=[0,0,1],m=En([]);return rn(m,m,a?-Qr(c)+Math.PI:Qr(c)),Dn(m,m,-Qr(i)),ht(h,h,m),kt(h,h)}const Lj={None:0,Model:1,Symbol:2,FillExtrusion:4};class gS{constructor(i,a,h,m){this.message=(i?`${i}: `:"")+h,m&&(this.identifier=m),a!=null&&a.__line__&&(this.line=a.__line__)}}function nC(c,i){const a=c.indexOf("://")===-1;try{return new URL(c,a&&i?"http://example.com":void 0),!0}catch{return!1}}class Oj{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Fj{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Xf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(i){const a=16*i,h=this.instancedDataArray.float32;let m=Math.floor(h[a+2]);const x=1.05*(h[a+2]-m);return m/=100,[h[a]%1*1.05,h[a+1]%1*1.05,x,m]}tileCoordinatesForInstance(i){const a=16*i,h=this.instancedDataArray.float32;let m=h[a+0];return m=m>xn?m-xn:m,new Ht(Math.trunc(m),Math.trunc(h[a+1]))}translationForInstance(i){const a=16*i,h=this.instancedDataArray.float32;return[h[a+4],h[a+5],h[a+6]]}rotationScaleForInstance(i){const a=16*i,h=this.instancedDataArray.float32;return[h[a+7],h[a+8],h[a+9],h[a+10],h[a+11],h[a+12],h[a+13],h[a+14],h[a+15]]}transformForInstance(i){const a=16*i,h=this.instancedDataArray.float32;return[h[a+7],h[a+8],h[a+9],h[a+4],h[a+10],h[a+11],h[a+12],h[a+5],h[a+13],h[a+14],h[a+15],h[a+6],0,0,0,1]}}class rC{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaledZ=this.canonical.z+Math.log2(i.overscaling),this.layers=i.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,h,m){}populate(i,a,h,m){this.tileToMeter=Qe(h);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:A,index:P,sourceLayerIndex:N}of i){const V=A??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),H=Mt(_,x);if(!this.layers[0]._featureFilter.filter(new rs(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),H,h))continue;const G={id:V,sourceLayerIndex:N,index:P,geometry:x?H.geometry:zt(_,h,m),properties:_.properties,type:_.type,patterns:{}},Y=this.addFeature(G,G.geometry,H);Y&&a.featureIndex.insert(_,G.geometry,P,N,this.index,this.instancesPerModel[Y].instancedDataArray.length,xn/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const i=this.layers[0].modelManager,a=this.layers[0].scope;let h=0;for(const m of this.modelUris){const x=i.getModel(m,a);if(!x)continue;const _=this.instancesPerModel[m];if(_){const A=.5*Vt(x.aabb.max,x.aabb.min)*_.maxScale+_.maxXYTranslationDistance,P=Math.min(xn,Math.max(A/this.tileToMeter,xn/32));h=Math.max(P,h)}}return h}update(i,a,h,m){for(const x in this.instancesPerModel){const _=this.instancesPerModel[x];for(const A in i)_.idToFeaturesIndex.hasOwnProperty(A)&&(this.evaluate(_.features[_.idToFeaturesIndex[A]],i[A],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const m of h.features){const x=this.layers[0],_=m.feature,A=this.canonical,P=x.paint.get("model-rotation").evaluate(_,{},A),N=x.paint.get("model-scale").evaluate(_,{},A),V=x.paint.get("model-translation").evaluate(_,{},A);Br(m.rotation,P)&&Br(m.scale,N)&&Br(m.translation,V)||(this.evaluate(m,m.featureStates,h,!0),i=!0)}}return i}updateReplacement(i,a,h,m){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const x=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(z2(this.activeReplacements,x))return!1;this.activeReplacements=x;let _=!1;for(const A in this.instancesPerModel){const P=this.instancesPerModel[A],N=P.instancedDataArray;for(const V of P.features){const H=V.instancedDataOffset,G=V.instancedDataCount;for(let Y=0;Y<G;Y++){const J=16*(Y+H);let oe=N.float32[J+0];const ue=oe>xn;oe=ue?oe-xn:oe;const pe=Math.floor(oe),we=Math.floor(N.float32[J+1]);let Te=!1;for(const Ie of this.activeReplacements)if(!S4(Ie,h,Lj.Model,m)&&!(Ie.min.x>pe||pe>Ie.max.x||Ie.min.y>we||we>Ie.max.y)&&(Te=p3(C4(pe,we,i.canonical,Ie.footprintTileId.canonical),Ie.footprint),Te))break;N.float32[J]=Te?oe+xn:oe,_=_||Te!==ue}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=i.createVertexBuffer(h.instancedDataArray,OX.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)i.removeModel(a,"",!0)}addFeature(i,a,h){const m=this.layers[0],x=m.layout.get("model-id").evaluate(h,{},this.canonical);if(!x)return It(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),x;(nC(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new Fj);const _=this.instancesPerModel[x],A=_.instancedDataArray,P=new Oj(h,A.length);for(const N of a)for(const V of N){if(V.x<0||V.x>=xn||V.y<0||V.y>=xn)continue;if(this.lookupDim!==0){const G=(this.lookupDim-1)/xn,Y=this.lookupDim*(V.y*G|0)+V.x*G|0;if(this.lookup){if(this.lookup[Y]!==0)continue;this.lookup[Y]=1}}this.instanceCount++;const H=A.length;A.resize(H+1),_.instancesEvaluatedElevation.push(0),A.float32[16*H]=V.x,A.float32[16*H+1]=V.y}return P.instancedDataCount=_.instancedDataArray.length-P.instancedDataOffset,P.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(P),this.evaluate(P,{},_,!1)),x}getModelUris(){return this.modelUris}evaluate(i,a,h,m){const x=this.layers[0],_=i.feature,A=this.canonical,P=i.rotation=x.paint.get("model-rotation").evaluate(_,a,A),N=i.scale=x.paint.get("model-scale").evaluate(_,a,A),V=i.translation=x.paint.get("model-translation").evaluate(_,a,A),H=Object.assign({},x.paint.get("model-color").evaluate(_,a,A));H.a=x.paint.get("model-color-mix-intensity").evaluate(_,a,A);const G=[];this.maxVerticalOffset<V[2]&&(this.maxVerticalOffset=V[2]);const Y=V[0]*V[0]+V[1]*V[1],J=Y>0?Math.sqrt(Y):0;h.maxScale=Math.max(Math.max(h.maxScale,N[0]),Math.max(N[1],N[2])),h.maxXYTranslationDistance=Math.max(h.maxXYTranslationDistance,J),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),f6(G,P,N);const oe=Math.round(100*H.a)+H.b/1.05;for(let ue=0;ue<i.instancedDataCount;++ue){const pe=i.instancedDataOffset+ue,we=16*pe,Te=h.instancedDataArray.float32;let Ie=0;m&&(Ie=Te[we+6]-h.instancesEvaluatedElevation[pe]);const Ze=0|Te[we+1];Te[we]=(0|Te[we])+H.r/1.05,Te[we+1]=Ze+H.g/1.05,Te[we+2]=oe,Te[we+3]=1/(A.z>10?this.tileToMeter:Qe(A,Ze)),Te[we+4]=V[0],Te[we+5]=V[1],Te[we+6]=V[2]+Ie,Te[we+7]=G[0],Te[we+8]=G[1],Te[we+9]=G[2],Te[we+10]=G[4],Te[we+11]=G[5],Te[we+12]=G[6],Te[we+13]=G[8],Te[we+14]=G[9],Te[we+15]=G[10],h.instancesEvaluatedElevation[pe]=V[2]}}}let Bj,zj;Fn(rC,"ModelBucket",{omit:["layers"]}),Fn(Fj,"PerModelAttributes"),Fn(Oj,"ModelFeature");class I_{constructor(i,a,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(i,a,h){const m=h||i.findDEMTileFor(a);if(!m||!m.dem)return;const x=m.dem,_=m.tileID,A=1<<a.canonical.z-_.canonical.z;return new I_(m,x.dim/xn/A,[(a.canonical.x/A-_.canonical.x)*x.dim,(a.canonical.y/A-_.canonical.y)*x.dim])}tileCoordToPixel(i,a){const h=a*this._scale+this._offset[1];return new Ht(Math.floor(i*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(i,a,h,m){const x=i*this._scale+this._offset[0],_=a*this._scale+this._offset[1],A=Math.floor(x),P=Math.floor(_),N=this._dem;return m=!!m,h?Ar(Ar(N.get(A,P,m),N.get(A,P+1,m),_-P),Ar(N.get(A+1,P,m),N.get(A+1,P+1,m),_-P),x-A):N.get(A,P,m)}getElevationAtPixel(i,a,h){return this._dem.get(i,a,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Se(1,i)*this._dem.stride}}const iC=new Float32Array(262144),Ry=new Uint8Array(262144);function Uj(c){let i=0;if(c.meshes)for(const a of c.meshes)i=Math.max(i,a.aabb.max[2]);if(c.children)for(const a of c.children)i=Math.max(i,Uj(a));return i}function Vj(c,i,a){if(c.meshes)for(const h of c.meshes){if(h.aabb.min[0]===1/0)continue;const m=Gr.applyTransform(h.aabb,c.globalMatrix);a.insert(i,m.min[0],m.min[1],m.max[0],m.max[1])}if(c.children)for(const h of c.children)Vj(h,i,a)}const Hj=["","wall","door","roof","window","lamp","logo"];class Gj{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:Uj(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new Gr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==i&&(h.transformedAabb=Gr.applyTransformFast(h.aabb,this.node.globalMatrix),a.encapsulate(h.transformedAabb)),i++;this.aabb=a}return this.aabb}}class yS{constructor(i,a,h,m,x,_,A,P){this.id=h,this.layers=i,this.layerIds=this.layers.map((N=>N.fqid)),this.stateDependentLayerIds=this.layers.filter((N=>N.isStateDependent())).map((N=>N.id)),this.modelTraits|=b_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=b_.HasMapboxMeshFeatures),x&&(this.modelTraits|=b_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=P,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const N of a)this.nodesInfo.push(new Gj(N)),Vj(N,A.featureIndexArray.length,A.grid),A.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,A.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(i,a){for(const h of this.getNodesInfo()){const m=h.node;m.footprint&&a.push({footprint:m.footprint,id:i})}}updateAppearances(i,a,h,m){}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const h=a?this.stateDependentLayers:this.layers;if(!cs(i,this.states))for(const m of h)this.evaluate(m,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const h of a){const m=h.node;this.uploaded?this.updatePbrBuffer(m):k3(m,i,!0)}for(const h of a)Y2(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const h of i.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),a=!0);return a}needsReEvaluation(i,a,h){const m=i.transform.projectionOptions,x=i.style.getBrightness(),_=this.brightness!==x;if(!this.uploaded||this.dirty||m.name!==this.projection.name||h1(h.paint.get("model-color").value,_)||h1(h.paint.get("model-color-mix-intensity").value,_)||h1(h.paint.get("model-roughness").value,_)||h1(h.paint.get("model-emissive-strength").value,_)||h1(h.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=m,this.brightness=x;const A=this.getNodesInfo();for(const P of A)P.state=null;return!0}return!1}evaluateTransform(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const h=this.getNodesInfo(),m=this.id.canonical;for(const x of h){const _=x.feature;x.evaluatedTranslation=a.paint.get("model-translation").evaluate(_,{},m),x.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},m)}}evaluate(i,a){const h=this.getNodesInfo();for(const m of h){if(!m.node.meshes)continue;const x=m.feature,_=a&&a[x.id];if(cs(_,m.state))continue;m.state=structuredClone(_);const A=m.node.meshes&&m.node.meshes[0].featureData,P=m.evaluatedColor[2],N=m.evaluatedRMEA[2],V=this.id.canonical;if(m.hasTranslucentParts=!1,A){for(let H=0;H<Hj.length;H++){const G=Hj[H];G.length&&(x.properties.part=G);const Y=i.paint.get("model-color").evaluate(x,_,V).toPremultipliedRenderColor(null),J=i.paint.get("model-color-mix-intensity").evaluate(x,_,V);m.evaluatedColor[H]=[Y.r,Y.g,Y.b,J],m.evaluatedRMEA[H][0]=i.paint.get("model-roughness").evaluate(x,_,V),m.evaluatedRMEA[H][2]=i.paint.get("model-emissive-strength").evaluate(x,_,V),m.evaluatedRMEA[H][3]=Y.a,m.emissionHeightBasedParams[H]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,_,V),!m.hasTranslucentParts&&Y.a<1&&(m.hasTranslucentParts=!0)}delete x.properties.part,hQ(m,P!==m.evaluatedColor[2]||N!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(x,_,V);m.evaluatedTranslation=i.paint.get("model-translation").evaluate(x,_,V),m.evaluatedScale=i.paint.get("model-scale").evaluate(x,_,V),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,h,m){const x=i.findDEMTileFor(h);if(x&&(x.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const _=I_.create(i,h,x);if(!_)return;this.modelTraits&b_.HasMapboxMeshFeatures&&this.updateDEM(i,_,h,m);for(const A of this.getNodesInfo()){const P=A.node;if(!P.footprint||!P.footprint.vertices||!P.footprint.vertices.length)continue;const N=P.footprint.vertices;let V=_.getElevationAt(N[0].x,N[0].y,!0,!0);for(let H=1;H<N.length;H++)V=Math.min(V,_.getElevationAt(N[H].x,N[H].y,!0,!0));P.elevation=V}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,h,m){let x=a._dem._modifiedForSources[m];if(x===void 0&&(a._dem._modifiedForSources[m]=[],x=a._dem._modifiedForSources[m]),x.includes(h.canonical))return;const _=a._dem.dim;x.push(h.canonical);let A=!1;for(const P of this.getNodesInfo()){const N=P.node;if(!N.footprint||!N.footprint.grid)continue;const V=N.footprint.grid,H=a.tileCoordToPixel(V.min.x,V.min.y),G=a.tileCoordToPixel(V.max.x,V.max.y),Y=Math.min(Math.min(_-G.y,H.x),Math.min(H.y,_-G.x));if(Y<0)continue;const J=ve(Y,2,5);let oe=Math.max(0,H.x-J),ue=Math.max(0,H.y-J),pe=Math.min(G.x+J,_-1),we=Math.min(G.y+J,_-1);for(let Ve=ue;Ve<=we;++Ve)for(let Ye=oe;Ye<=pe;++Ye)Ry[Ve*_+Ye]=255;let Te=0,Ie=0;for(let Ve=0;Ve<V.cellsY;++Ve)for(let Ye=0;Ye<V.cellsX;++Ye){if(!V.cells[Ve*V.cellsX+Ye])continue;const nt=a.tileCoordToPixel(V.min.x+Ye/V.xScale,V.min.y+Ve/V.yScale),ot=a.tileCoordToPixel(V.min.x+(Ye+1)/V.xScale,V.min.y+(Ve+1)/V.yScale);for(let Ot=nt.y;Ot<=Math.min(ot.y+1,_-1);++Ot)for(let pt=nt.x;pt<=Math.min(ot.x+1,_-1);++pt)Ry[Ot*_+pt]===255&&(Ry[Ot*_+pt]=0,Te+=a.getElevationAtPixel(pt,Ot),Ie++)}const Ze=Te/Ie;oe=Math.max(1,H.x-J),ue=Math.max(1,H.y-J),pe=Math.min(G.x+J,_-2),we=Math.min(G.y+J,_-2),A=!0;for(let Ve=ue;Ve<=we;++Ve)for(let Ye=oe;Ye<=pe;++Ye)Ry[Ve*_+Ye]===0&&(iC[Ve*_+Ye]=a._dem.set(Ye,Ve,Ze));for(let Ve=1;Ve<J;++Ve){oe=Math.max(1,H.x-Ve),ue=Math.max(1,H.y-Ve),pe=Math.min(G.x+Ve,_-2),we=Math.min(G.y+Ve,_-2);for(let Ye=ue;Ye<=we;++Ye)for(let nt=oe;nt<=pe;++nt){const ot=Ye*_+nt;if(Ry[ot]===255){let Ot=0,pt=0,Ut=-1,Zt=-1;for(let en=-1;en<=1;++en)for(let vn=-1;vn<=1;++vn){const an=(Ye+en)*_+nt+vn;if(Ry[an]>=Ve)continue;const Qt=iC[an],sn=Math.abs(Qt);sn>pt&&(Ot=Qt,pt=sn,Ut=vn,Zt=en)}if(pt>.1){const en=1-(Ve+.5*Math.abs(Ut*Zt))/J;let vn=a._dem.get(nt,Ye)+Ot*en;const an=a._dem.get(nt+Ut,Ye+Zt),Qt=a._dem.get(nt-Ut,Ye-Zt,!0);(vn-an)*(vn-Qt)>0&&(vn=(an+Qt)/2),iC[ot]=a._dem.set(nt,Ye,vn),Ry[ot]=Ve}}}}}A&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=eo.now())}setFilter(i){this.filter=i?am(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((i=>this.filter.filter(new rs(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical))):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)Y2(a.node),I3(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(i.toUnwrapped());for(const m of this.getNodesInfo()){const x=m.node.footprint;m.hiddenByReplacement=!!x&&!h.find((_=>_.footprint===x))}}getHeightAtTileCoord(i,a){const h=[],m=[0,0,0],x=F([]);for(const _ of this.getNodesInfo()){const A=_.node.meshes[0],P=A.transformedAabb;if(i<P.min[0]||a<P.min[1]||i>P.max[0]||a>P.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};U(x,_.node.globalMatrix),m[0]=i,m[1]=a,Un(m,m,x);const N=(m[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*ky|0,V=Math.min(63,(m[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*ky|0)*ky+Math.min(63,N),H=A.heightmap[V];if(!(H<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:H,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ht(i,a),new Ht(i,a),h),h.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function h1(c,i){return c instanceof Sa&&!c.isLightConstant&&i}function dQ(c,i,a,h,m,x,_,A){let P=(61440&i|(61440&i)>>4)>>8,N=(3840&i|(3840&i)>>4)>>4,V=240&i|(240&i)>>4;a[3]>0&&(P=Ar(P,255*a[0],a[3]),N=Ar(N,255*a[1],a[3]),V=Ar(V,255*a[2],a[3]));const H=P<<8|N,G=V<<8|Math.floor(255*h[3]),Y=(function(Ve){const Ye=ve(Ve,0,2);return Math.min(Math.round(.5*Ye*255),255)})(h[2])<<8|15*h[0]<<4|15*h[1],J=ve(m[0],0,1),oe=ve(m[1],0,1),ue=ve(m[2],0,1),pe=ve(m[3],0,1);let we,Te,Ie,Ze;if(J!==oe&&_!==x&&oe!==J){const Ve=_-x;Te=1/(Ve*(oe-J)),Ie=-(x+Ve*J)/(Ve*(oe-J));const Ye=ve(m[4],-1,1);Ze=Math.pow(10,Ye),we=255*ue<<8|255*pe}else we=65535,Te=0,Ie=1,Ze=1;if(c.emplaceBack(H,G,Y,we,Te,Ie,Ze),A){const Ve=A.length;A.clear();for(let Ye=0;Ye<Ve;Ye++)A.emplaceBack(H,G,Y,we,Te,Ie,Ze)}}function hQ(c,i,a){const h=c.node;let m=0;const x=a&b_.HasMeshoptCompression;for(const _ of h.meshes){if(h.lights&&h.lightMeshIndex===m||!_.featureData)continue;_.featureArray=new Vh,_.featureArray.reserve(_.featureData.length);let A=i;for(const P of _.featureData){const N=x?65535&P:P>>16&65535,V=x?P>>16&65535:65535&P,H=(15&V)<8?15&V:0,G=c.evaluatedRMEA[H],Y=c.evaluatedColor[H],J=c.emissionHeightBasedParams[H];let oe;if(A&&H===2&&h.lights&&(oe=new Vh,oe.resize(10*h.lights.length)),dQ(_.featureArray,N,Y,G,J,_.aabb.min[2],_.aabb.max[2],oe),oe&&A){A=!1;const ue=h.meshes[h.lightMeshIndex];ue.featureArray=oe,ue.featureArray._trim()}}_.featureArray._trim(),m++}}Fn(yS,"Tiled3dModelBucket",{omit:["layers"]}),Fn(Gj,"Tiled3dModelFeature");const fQ=["id","tile","layer","source","sourceLayer","state"];class Ny{constructor(i,a,h,m,x){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=h,this._y=m,this.properties=i?i.properties:{},this.id=x}clone(){const i=new Ny(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of fQ)this[a]!==void 0&&(i[a]=this[a]);return i}}class jy extends Jc{constructor(i,a,h,m){super(),this.id=i,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const i=[];for(const a in this._options.models){const h=this._options.models[a],m=this._modelsInfo.get(a);if(m){const x=m.model;x.position=h.position!=null?new ee(h.position[0],h.position[1]):new ee(0,0),x.orientation=h.orientation!=null?h.orientation:[0,0,0],m.modelSpec=h,jy.applyModelSpecification(x,h),x.computeBoundsAndApplyParent(),this.models.push(x)}else{const x=c6(this.map._requestManager.transformRequest(h.uri,xc.Model).url).then((_=>{if(!_)return;const A=R3(_),P=new p6(a,h.uri,h.position,h.orientation,A);jy.applyModelSpecification(P,h),P.computeBoundsAndApplyParent(),this.models.push(P),this._modelsInfo.set(a,{modelSpec:h,model:P})})).catch((_=>{this.fire(new yf(new Error(`Could not load model ${a} from ${h.uri}: ${_.message}`)))}));i.push(x)}}Promise.allSettled(i).then((()=>{this._loaded=!0,this.fire(new wa("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((a=>{this._loaded=!0,this.fire(new yf(new Error(`Could not load models: ${a.message}`)))}))}static applyModelSpecification(i,a){a.nodeOverrides&&jy.convertNodeOverrides(i,a.nodeOverrides),a.materialOverrides&&jy.convertMaterialOverrides(i,a.materialOverrides),a.nodeOverrideNames&&(i.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(i.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(i.featureProperties=a.featureProperties)}static convertNodeOverrides(i,a){if(Array.isArray(a)&&a.every((h=>typeof h=="string"))){i.nodeOverrideNames=[];for(const h of a)i.nodeOverrideNames.push(h)}else Object.entries(a).forEach((([h,m])=>{const x={orientation:[0,0,0]};if(m.hasOwnProperty("orientation")){const _=m.orientation;_&&(x.orientation=_)}i.nodeOverrides.set(h,x)}))}static convertMaterialOverrides(i,a){if(Array.isArray(a)&&a.every((h=>typeof h=="string"))){i.materialOverrideNames=[];for(const h of a)i.materialOverrideNames.push(h)}else Object.entries(a).forEach((([h,m])=>{const x={color:new Wi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=m["model-color"];_!==void 0&&(x.color.r=_[0],x.color.g=_[1],x.color.b=_[2]);const A=m["model-color-mix-intensity"];A!==void 0&&(x.colorMix=A);const P=m["model-emissive-strength"];P!==void 0&&(x.emissionStrength=P);const N=m["model-opacity"];N!==void 0&&(x.opacity=N),i.materialOverrides.set(h,x)}))}onAdd(i){this.map=i,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(i,a){}serialize(){return this._options}setProperty(i,a){return!1}reload(){const i=Ud(this.id,this.scope);this.map.style.clearSource(i),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(i){this.models=[];const a=new Map;for(const h in i){const m=i[h];if(this._modelsInfo.has(h)){const x=this._modelsInfo.get(h);x&&x.modelSpec.uri===m.uri&&a.set(h,x)}}this._modelsInfo=a,this._options.models=i,this._loaded=!1,this.load()}}function sC(c,i,a,h){const m=1<<c.z;i.lat=Ee((h/xn+c.y)/m),i.lng=Pe((a/xn+c.x)/m)}function pQ(c,i,a,h){const m=c.getNodesInfo()[i];if(!m||m.hiddenByReplacement||!m.node.meshes)return;let x=Number.MAX_VALUE;const _=m.node,A=a.tile,P=h.calculatePosMatrix(A.tileID.toUnwrapped(),h.worldSize),N=m.evaluatedScale;let V=0;h.elevation&&_.elevation&&(V=_.elevation*h.elevation.exaggeration()),W(P,P,[(_.anchor?_.anchor[0]:0)*(N[0]-1),(_.anchor?_.anchor[1]:0)*(N[1]-1),V]),K(P,P,N);const H=a.queryGeometry,G=H.isPointQuery()?H.screenBounds:H.screenGeometry,Y=function(oe){const ue=X([],P,oe.globalMatrix);X(ue,h.expandedFarZProjMatrix,ue);for(let pe=0;pe<oe.meshes.length;++pe){const we=oe.meshes[pe];if(pe===oe.lightMeshIndex)continue;const Te=M3(G,h,ue,we.aabb);Te!=null&&(x=Math.min(Te,x))}if(oe.children)for(const pe of oe.children)Y(pe)};if(Y(_),x===Number.MAX_VALUE)return;const J=new ee(0,0);return sC(A.tileID.canonical,J,m.node.anchor[0],m.node.anchor[1]),{intersectionZ:x,position:J,feature:m.feature}}const mQ={circle:class extends pa{constructor(c,i,a,h){super(c,{layout:$u||($u=new Ns({"circle-sort-key":new Pn(ft.layout_circle["circle-sort-key"]),"circle-elevation-reference":new dn(ft.layout_circle["circle-elevation-reference"]),visibility:new dn(ft.layout_circle.visibility)})),paint:Wu||(Wu=new Ns({"circle-radius":new Pn(ft.paint_circle["circle-radius"]),"circle-color":new Pn(ft.paint_circle["circle-color"]),"circle-blur":new Pn(ft.paint_circle["circle-blur"]),"circle-opacity":new Pn(ft.paint_circle["circle-opacity"]),"circle-translate":new dn(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new dn(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dn(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dn(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(ft.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new dn(ft.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}createBucket(c){return new xs(c)}queryRadius(c){const i=c;return Lo("circle-radius",this,i)+Lo("circle-stroke-width",this,i)+Ts(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,a,h,m,x,_,A){const P=hu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return QN(c,h,x,_,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,a){const h=ZN(this);return{config:new Gu(this,{zoom:i,lut:a}),defines:h,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends pa{createBucket(c){return new YN(c)}constructor(c,i,a,h){super(c,{layout:JN||(JN=new Ns({visibility:new dn(ft.layout_heatmap.visibility)})),paint:e4||(e4=new Ns({"heatmap-radius":new Pn(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dn(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jh(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dn(ft.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(c){return Lo("heatmap-radius",this,c)}queryIntersectsFeature(c,i,a,h,m,x,_,A){const P=this.paint.get("heatmap-radius").evaluate(i,a);return QN(c,h,x,_,A,!0,!0,new Ht(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,a){return c==="heatmap"?{config:new Gu(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends pa{constructor(c,i,a,h){super(c,{layout:t4||(t4=new Ns({visibility:new dn(ft.layout_hillshade.visibility)})),paint:n4||(n4=new Ns({"hillshade-illumination-direction":new dn(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dn(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dn(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dn(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dn(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dn(ft.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new dn(ft.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}},fill:class extends pa{constructor(c,i,a,h){super(c,{layout:y4||(y4=new Ns({"fill-sort-key":new Pn(ft.layout_fill["fill-sort-key"]),visibility:new dn(ft.layout_fill.visibility),"fill-elevation-reference":new dn(ft.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Pn(ft.layout_fill["fill-construct-bridge-guard-rail"])})),paint:x4||(x4=new Ns({"fill-antialias":new dn(ft.paint_fill["fill-antialias"]),"fill-opacity":new Pn(ft.paint_fill["fill-opacity"]),"fill-color":new Pn(ft.paint_fill["fill-color"]),"fill-outline-color":new Pn(ft.paint_fill["fill-outline-color"]),"fill-translate":new dn(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new dn(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pn(ft.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new dn(ft.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new dn(ft.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Pn(ft.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Pn(ft.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Pn(ft.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,i,a){return{config:new Gu(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new d3(c)}queryRadius(){return Ts(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,a,h,m,x){return!c.queryGeometry.isAboveHorizon&&Os(zl(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?i&&!c:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends pa{constructor(c,i,a,h){super(c,{layout:H4||(H4=new Ns({visibility:new dn(ft["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new dn(ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:G4||(G4=new Ns({"fill-extrusion-opacity":new dn(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dn(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dn(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new dn(ft["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new dn(ft["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new dn(ft["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new dn(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new dn(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new dn(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new dn(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new dn(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new dn(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new dn(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new dn(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new dn(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new dn(ft["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new dn(ft["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new dn(ft["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Pn(ft["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new dn(ft["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new V2(c)}queryRadius(){return Ts(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,a,h,m,x,_,A,P){const N=hu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),V=this.paint.get("fill-extrusion-height").evaluate(i,a),H=this.paint.get("fill-extrusion-base").evaluate(i,a),G=[0,0],Y=A&&x.elevation,J=x.elevation?x.elevation.exaggeration():1,oe=c.tile.getBucket(this);if(Y&&oe instanceof V2){const Ie=oe.centroidVertexArray,Ze=P+1;Ze<Ie.length&&(G[0]=Ie.geta_centroid_pos0(Ze),G[1]=Ie.geta_centroid_pos1(Ze))}if(G[0]===0&&G[1]===1)return!1;x.projection.name==="globe"&&(h=V4([h],[new Ht(0,0),new Ht(xn,xn)],c.tileID.canonical).map((Ie=>Ie.polygon)).flat());const ue=Y?A:null,[pe,we]=K4(x,h,H,V,N,_,ue,G,J,x.center.lat,c.tileID.canonical),Te=c.queryGeometry;return Q4(pe,we,Te.isPointQuery()?Te.screenBounds:Te.screenGeometry)}},building:class extends pa{constructor(c,i,a,h){super(c,{layout:w6||(w6=new Ns({visibility:new dn(ft.layout_building.visibility),"building-facade":new Pn(ft.layout_building["building-facade"]),"building-facade-floors":new Pn(ft.layout_building["building-facade-floors"]),"building-facade-unit-width":new Pn(ft.layout_building["building-facade-unit-width"]),"building-facade-window":new Pn(ft.layout_building["building-facade-window"]),"building-roof-shape":new Pn(ft.layout_building["building-roof-shape"]),"building-height":new Pn(ft.layout_building["building-height"]),"building-base":new Pn(ft.layout_building["building-base"]),"building-flood-light-wall-radius":new Pn(ft.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Pn(ft.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Pn(ft.layout_building["building-flip-roof-orientation"])})),paint:S6||(S6=new Ns({"building-opacity":new dn(ft.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new dn(ft.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new dn(ft.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new dn(ft.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new dn(ft.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new dn(ft.paint_building["building-vertical-scale"]),"building-cast-shadows":new dn(ft.paint_building["building-cast-shadows"]),"building-color":new Pn(ft.paint_building["building-color"]),"building-emissive-strength":new Pn(ft.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new dn(ft.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new dn(ft.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new dn(ft.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new dn(ft.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new dn(ft.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new b6(c)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(c){return!0}queryRadius(c){return 0}queryIntersectsFeature(c,i,a,h,m,x,_,A,P){let N=this.layout.get("building-height").evaluate(i,a);const V=this.layout.get("building-base").evaluate(i,a),H=c.tile.getBucket(this).getFootprint(i);if(H){if(H.hiddenFlags!==0)return!1;N=H.height}const[G,Y]=K4(x,h,V,N,new Ht(0,0),_,null,[0,0],1,x.center.lat,c.tileID.canonical),J=c.queryGeometry;return Q4(G,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends pa{constructor(c,i,a,h){const m=N6();super(c,m,i,a,h),m.layout&&(this.layout=new Mc(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof qp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(Kb)return Kb;const a=N6();return Kb=new dZ(a.paint.properties["line-width"].specification),Kb.useIntegerZoom=!0,Kb})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new j3(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,a){const h=P6(this);return{config:new Gu(this,{zoom:i,lut:a}),defines:h,overrideFog:!1}}queryRadius(c){const i=c,a=j6(Lo("line-width",this,i),Lo("line-gap-width",this,i)),h=Lo("line-offset",this,i);return a/2+Math.abs(h)+Ts(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,a,h,m,x){if(c.queryGeometry.isAboveHorizon)return!1;const _=zl(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,c.pixelToTileUnitsFactor),A=c.pixelToTileUnitsFactor/2*j6(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),P=this.paint.get("line-offset").evaluate(i,a);return P&&(h=(function(N,V){const H=[],G=new Ht(0,0);for(let Y=0;Y<N.length;Y++){const J=N[Y],oe=[];for(let ue=0;ue<J.length;ue++){const pe=J[ue],we=J[ue+1],Te=ue===0?G:pe.sub(J[ue-1])._unit()._perp(),Ie=ue===J.length-1?G:we.sub(pe)._unit()._perp(),Ze=Te._add(Ie)._unit();Ze._mult(1/(Ze.x*Ie.x+Ze.y*Ie.y)),oe.push(Ze._mult(V)._add(pe))}H.push(oe)}return H})(h,P*c.pixelToTileUnitsFactor)),(function(N,V,H){for(let G=0;G<V.length;G++){const Y=V[G];if(N.length>=3){for(let J=0;J<Y.length;J++)if(_o(N,Y[J]))return!0}if(Aa(N,Y,H))return!0}return!1})(_,h,A)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:fS,background:class extends pa{constructor(c,i,a,h){super(c,{layout:Sj||(Sj=new Ns({visibility:new dn(ft.layout_background.visibility)})),paint:Tj||(Tj=new Ns({"background-pitch-alignment":new dn(ft.paint_background["background-pitch-alignment"]),"background-color":new dn(ft.paint_background["background-color"]),"background-pattern":new dn(ft.paint_background["background-pattern"]),"background-opacity":new dn(ft.paint_background["background-opacity"]),"background-emissive-strength":new dn(ft.paint_background["background-emissive-strength"]),"background-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:kj,"raster-particle":Dj,sky:class extends pa{constructor(c,i,a,h){super(c,{layout:Rj||(Rj=new Ns({visibility:new dn(ft.layout_sky.visibility)})),paint:Nj||(Nj=new Ns({"sky-type":new dn(ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new dn(ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new dn(ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new dn(ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new dn(ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new jh(ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new dn(ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new dn(ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new dn(ft.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=jb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),m=!h,x=c.style.light,_=x.properties.get("position");return m&&x.properties.get("anchor")==="viewport"&&It("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?tC(_.azimuthal,90-_.polar,i):tC(h[0],90-h[1],i)}const a=this.paint.get("sky-gradient-center");return tC(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends pa{constructor(c,i,a,h){super(c,{paint:jj||(jj=new Ns({}))},i,null)}},model:class extends pa{constructor(c,i,a,h){super(c,{layout:Bj||(Bj=new Ns({visibility:new dn(ft.layout_model.visibility),"model-id":new Pn(ft.layout_model["model-id"])})),paint:zj||(zj=new Ns({"model-opacity":new Pn(ft.paint_model["model-opacity"]),"model-rotation":new Pn(ft.paint_model["model-rotation"]),"model-scale":new Pn(ft.paint_model["model-scale"]),"model-translation":new Pn(ft.paint_model["model-translation"]),"model-color":new Pn(ft.paint_model["model-color"]),"model-color-mix-intensity":new Pn(ft.paint_model["model-color-mix-intensity"]),"model-type":new dn(ft.paint_model["model-type"]),"model-cast-shadows":new dn(ft.paint_model["model-cast-shadows"]),"model-receive-shadows":new dn(ft.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new dn(ft.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pn(ft.paint_model["model-emissive-strength"]),"model-roughness":new Pn(ft.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pn(ft.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new dn(ft.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new dn(ft.paint_model["model-front-cutoff"]),"model-elevation-reference":new dn(ft.paint_model["model-elevation-reference"]),"model-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this.layer=c,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new rC(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof yS?xn-1:0}queryRenderedFeatures(c,i,a){const h=i.getSource();if(!(h&&h instanceof jy))return{};const m=h,x={};x[this.id]=[];const _=x[this.id];let A=0;for(const P of m.models){const N=i.getFeatureState(this.sourceLayer,P.id),V={type:"Unknown",id:P.id,properties:P.featureProperties},H=this.paint.get("model-rotation").evaluate(V,N),G=this.paint.get("model-scale").evaluate(V,N),Y=this.paint.get("model-translation").evaluate(V,N),J=this.paint.get("model-elevation-reference");let oe=[];K2(oe,P,a,P.position,H,G,Y,J==="ground",J==="ground",!1),a.projection.name==="globe"&&(oe=Q2(oe,a));const ue=X([],a.projMatrix,oe),pe=M3(c.isPointQuery()?c.screenBounds:c.screenGeometry,a,ue,P.aabb);if(pe!=null){const we=new Ny(void 0,0,0,0,P.id);we.layer=this.layer,we.properties=structuredClone(P.featureProperties),we.properties.layer=this.id,we.properties.uri=P.uri,we.properties.orientation=P.orientation,we.sourceLayer=this.sourceLayer,we.geometry={type:"Point",coordinates:[P.position.lng,P.position.lat]},we.state=N,we.source=this.source,_.push({featureIndex:A,feature:we,intersectionZ:pe})}++A}return x}queryIntersectsFeature(c,i,a,h,m,x){if(!this.modelManager)return!1;const _=this.modelManager,A=c.tile.getBucket(this);if(!(A&&A instanceof rC))return!1;for(const P in A.instancesPerModel){const N=A.instancesPerModel[P],V=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(V)){const H=N.features[N.idToFeaturesIndex[V]],G=_.getModel(P,this.scope);if(!G)return!1;let Y=[];const J=new ee(0,0),oe=A.canonical;let ue=Number.MAX_VALUE;for(let pe=0;pe<H.instancedDataCount;++pe){const we=16*(H.instancedDataOffset+pe),Te=N.instancedDataArray.float32,Ie=[Te[we+4],Te[we+5],Te[we+6]];sC(oe,J,Math.floor(Te[we]),Math.floor(Te[we+1])),K2(Y,G,x,J,H.rotation,H.scale,Ie,!1,!1,!1),x.projection.name==="globe"&&(Y=Q2(Y,x));const Ze=X([],x.projMatrix,Y),Ve=c.queryGeometry,Ye=M3(Ve.isPointQuery()?Ve.screenBounds:Ve.screenGeometry,x,Ze,G.aabb);Ye!=null&&(ue=Math.min(Ye,ue))}return ue!==Number.MAX_VALUE&&ue}}return!1}_handleOverridablePaintPropertyUpdate(c,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof fl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends pa{constructor(c,i,a,h){super(c,{layout:_4||(_4=new Ns({"clip-layer-types":new dn(ft.layout_clip["clip-layer-types"]),"clip-layer-scope":new dn(ft.layout_clip["clip-layer-scope"])})),paint:v4||(v4=new Ns({}))},i,a,h)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new b4(c)}is3D(c){return!0}}},oC=new Wi(0,0,0),aC={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},lC={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},xS={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},gQ={PAINT_ORDER_FILL_AND_STROKE:1},f1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},$j={MASK_TYPE_LUMINANCE:1};function yQ(c,i,a){c===1&&i.icons.push((function(h,m){return(function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:_}=x;if(_.content_area){const{content_area:A}=_;A.left==null&&(A.left=0),A.top==null&&(A.top=A.left),A.width==null&&(A.width=x.usvg_tree.width),A.height==null&&(A.height=A.width)}if(_.text_placeholder){const{text_placeholder:A}=_;A.top==null&&(A.top=A.left),A.height==null&&(A.height=A.width)}return _.stretch_x&&_.stretch_x.length&&Wj(_,"x"),_.stretch_y&&_.stretch_y.length&&Wj(_,"y"),x})(h.readFields(xQ,{name:void 0},m))})(a,a.readVarint()+a.pos))}function Wj(c,i){const a=[],h=c[`stretch_${i}`];let m=null;for(let x=0;x<h.length;x++)m===null?m=a.length===0?h[0]:a[a.length-1][1]+h[x]:(a.push([m,m+h[x]]),m=null);c[`stretch_${i}_areas`]=a}function xQ(c,i,a){c===1?i.name=a.readString():c===2?i.metadata=(function(h,m){return h.readFields(_Q,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)})(a,a.readVarint()+a.pos):c===3&&(i.usvg_tree=(function(h,m){return h.readFields(wQ,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)})(a,a.readVarint()+a.pos),i.data="usvg_tree")}function _Q(c,i,a){c===1?i.stretch_x=a.readPackedVarint():c===2?i.stretch_y=a.readPackedVarint():c===3?i.content_area=qj(a,a.readVarint()+a.pos):c===4?i.variables.push((function(h,m){return h.readFields(bQ,{name:void 0},m)})(a,a.readVarint()+a.pos)):c===5&&(i.text_placeholder=qj(a,a.readVarint()+a.pos))}function qj(c,i){return c.readFields(vQ,{},i)}function vQ(c,i,a){c===1?i.left=a.readVarint():c===2?i.width=a.readVarint():c===3?i.top=a.readVarint():c===4&&(i.height=a.readVarint())}function bQ(c,i,a){c===1?i.name=a.readString():c===2&&(i.rgb_color=bS(a.readVarint()),i.value="rgb_color")}function wQ(c,i,a){c===1?i.width=i.height=a.readVarint():c===2?i.height=a.readVarint():c===3?i.children.push(_S(a,a.readVarint()+a.pos)):c===4?i.linear_gradients.push((function(h,m){return h.readFields(kQ,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)})(a,a.readVarint()+a.pos)):c===5?i.radial_gradients.push((function(h,m){return h.readFields(PQ,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)})(a,a.readVarint()+a.pos)):c===7?i.clip_paths.push((function(h,m){return h.readFields(RQ,{children:[]},m)})(a,a.readVarint()+a.pos)):c===8&&i.masks.push((function(h,m){const x=h.readFields(NQ,{left:0,width:20,mask_type:$j.MASK_TYPE_LUMINANCE,children:[]},m);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x})(a,a.readVarint()+a.pos))}function _S(c,i){return c.readFields(SQ,{},i)}function SQ(c,i,a){c===1?(i.group=(function(h,m){return h.readFields(TQ,{opacity:255,children:[]},m)})(a,a.readVarint()+a.pos),i.node="group"):c===2&&(i.path=(function(h,m){return h.readFields(AQ,{paint_order:1,commands:[],step:1,diffs:[],rule:aC.PATH_RULE_NON_ZERO},m)})(a,a.readVarint()+a.pos),i.node="path")}function TQ(c,i,a){c===1?i.transform=vS(a,a.readVarint()+a.pos):c===2?i.opacity=a.readVarint():c===5?i.clip_path_idx=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(_S(a,a.readVarint()+a.pos))}function vS(c,i){return c.readFields(EQ,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function EQ(c,i,a){c===1?i.sx=a.readFloat():c===2?i.ky=a.readFloat():c===3?i.kx=a.readFloat():c===4?i.sy=a.readFloat():c===5?i.tx=a.readFloat():c===6&&(i.ty=a.readFloat())}function AQ(c,i,a){c===1?i.fill=(function(h,m){return h.readFields(CQ,{rgb_color:oC,paint:"rgb_color",opacity:255},m)})(a,a.readVarint()+a.pos):c===2?i.stroke=(function(h,m){return h.readFields(MQ,{rgb_color:oC,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)})(a,a.readVarint()+a.pos):c===3?i.paint_order=a.readVarint():c===5?a.readPackedVarint(i.commands):c===6?i.step=a.readFloat():c===7?a.readPackedSVarint(i.diffs):c===8&&(i.rule=a.readVarint())}function CQ(c,i,a){c===1?(i.rgb_color=bS(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=a.readVarint())}function bS(c){return new Wi((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function MQ(c,i,a){c===1?(i.rgb_color=bS(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5?a.readPackedFloat(i.dasharray):c===6?i.dashoffset=a.readFloat():c===7?i.miterlimit=a.readFloat():c===8?i.opacity=a.readVarint():c===9?i.width=a.readFloat():c===10?i.linecap=a.readVarint():c===11&&(i.linejoin=a.readVarint())}function kQ(c,i,a){c===1?i.transform=vS(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(Xj(a,a.readVarint()+a.pos)):c===4?i.x1=a.readFloat():c===5?i.y1=a.readFloat():c===6?i.x2=a.readFloat():c===7&&(i.y2=a.readFloat())}function Xj(c,i){return c.readFields(IQ,{offset:0,opacity:255,rgb_color:oC},i)}function IQ(c,i,a){c===1?i.offset=a.readFloat():c===2?i.opacity=a.readVarint():c===3&&(i.rgb_color=bS(a.readVarint()))}function PQ(c,i,a){c===1?i.transform=vS(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(Xj(a,a.readVarint()+a.pos)):c===4?i.cx=a.readFloat():c===5?i.cy=a.readFloat():c===6?i.r=a.readFloat():c===7?i.fx=a.readFloat():c===8?i.fy=a.readFloat():c===9&&(i.fr=a.readFloat())}function RQ(c,i,a){c===1?i.transform=vS(a,a.readVarint()+a.pos):c===2?i.clip_path_idx=a.readVarint():c===3&&i.children.push(_S(a,a.readVarint()+a.pos))}function NQ(c,i,a){c===1?i.left=i.top=a.readFloat():c===2?i.width=i.height=a.readFloat():c===3?i.top=a.readFloat():c===4?i.height=a.readFloat():c===5?i.mask_type=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(_S(a,a.readVarint()+a.pos))}class jQ{static calculate(i={},a=[]){const h=new Map,m=new Map;if(Object.keys(i).length===0)return h;a.forEach((x=>{m.set(x.name,x.rgb_color||new Wi(0,0,0))}));for(const[x,_]of Object.entries(i))m.has(x)?h.set(m.get(x).toString(),_):console.warn(`Ignoring unknown image variable "${x}"`);return h}}function P_(c,i=255,a){const h=i/255,m=c.toString(),x=a.has(m)?a.get(m).clone():c.clone();return x.a*=h,x.toString()}function p1(c,i){if(!Is()){const a=document.createElement("canvas");return a.width=c,a.height=i,a}return new OffscreenCanvas(c,i)}function DQ(c,i){const a=jQ.calculate(i.params,c.metadata?c.metadata.variables:[]),h=c.usvg_tree,m=h.width,x=h.height,_=i.transform?i.transform:new DOMMatrix,A=Math.max(1,Math.round(m*_.a)),P=Math.max(1,Math.round(x*_.d)),N=new DOMMatrix([A/m,0,0,P/x,0,0]),V=p1(A,P).getContext("2d");return cC(V,N,h,h,a),V.getImageData(0,0,A,P)}function cC(c,i,a,h,m){for(const x of h.children)Zj(c,i,a,x,m)}function Zj(c,i,a,h,m){h.group?(c.save(),(function(x,_,A,P,N){const V=P.mask_idx!=null?A.masks[P.mask_idx]:null,H=P.clip_path_idx!=null?A.clip_paths[P.clip_path_idx]:null;if(P.transform&&(_=R_(P.transform).preMultiplySelf(_)),!(function(J,oe,ue){return J.opacity!==255||oe||ue})(P,H!=null,V!=null))return void cC(x,_,A,P,N);const G=p1(x.canvas.width,x.canvas.height),Y=G.getContext("2d");cC(Y,_,A,P,N),H&&nD(Y,_,A,H),V&&rD(Y,_,A,V,N),x.globalAlpha=P.opacity/255,x.drawImage(G,0,0)})(c,i,a,h.group,m),c.restore()):h.path&&(c.save(),(function(x,_,A,P,N){x.setTransform(_),P.paint_order===gQ.PAINT_ORDER_FILL_AND_STROKE?(Qj(x,A,P,N),Yj(x,A,P,N)):(Yj(x,A,P,N),Qj(x,A,P,N))})(c,i,a,h.path,m),c.restore())}function Qj(c,i,a,h){const m=a.fill;if(!m)return;const x=m.opacity/255;switch(c.save(),c.beginPath(),iD(a,c),m.paint){case"rgb_color":c.fillStyle=P_(m.rgb_color,m.opacity,h);break;case"linear_gradient_idx":{const _=i.linear_gradients[m.linear_gradient_idx];_.transform&&c.setTransform(R_(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=Jj(c,_,x,h);break}case"radial_gradient_idx":{const _=i.radial_gradients[m.radial_gradient_idx];_.transform&&c.setTransform(R_(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=eD(c,_,x,h)}}c.fill(Kj(a)),c.restore()}function Kj(c){return c.rule===aC.PATH_RULE_NON_ZERO?"nonzero":c.rule===aC.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Yj(c,i,a,h){const m=a.stroke;if(!m)return;const x=sD(a);c.lineWidth=m.width,c.miterLimit=m.miterlimit,c.setLineDash(m.dasharray),c.lineDashOffset=m.dashoffset;const _=m.opacity/255;switch(m.paint){case"rgb_color":c.strokeStyle=P_(m.rgb_color,m.opacity,h);break;case"linear_gradient_idx":c.strokeStyle=Jj(c,i.linear_gradients[m.linear_gradient_idx],_,h,!0);break;case"radial_gradient_idx":c.strokeStyle=eD(c,i.radial_gradients[m.radial_gradient_idx],_,h,!0)}switch(m.linejoin){case xS.LINE_JOIN_MITER_CLIP:case xS.LINE_JOIN_MITER:c.lineJoin="miter";break;case xS.LINE_JOIN_ROUND:c.lineJoin="round";break;case xS.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(m.linecap){case lC.LINE_CAP_BUTT:c.lineCap="butt";break;case lC.LINE_CAP_ROUND:c.lineCap="round";break;case lC.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(x)}function Jj(c,i,a,h,m=!1){if(i.stops.length===1){const G=i.stops[0];return P_(G.rgb_color,G.opacity*a,h)}const{x1:x,y1:_,x2:A,y2:P}=i;let N=new DOMPoint(x,_),V=new DOMPoint(A,P);if(m){const G=R_(i.transform);N=G.transformPoint(N),V=G.transformPoint(V)}const H=c.createLinearGradient(N.x,N.y,V.x,V.y);for(const G of i.stops)H.addColorStop(G.offset,P_(G.rgb_color,G.opacity*a,h));return H}function eD(c,i,a,h,m=!1){if(i.stops.length===1){const pe=i.stops[0];return P_(pe.rgb_color,pe.opacity*a,h)}const x=R_(i.transform),{fx:_,fy:A,fr:P,cx:N,cy:V,r:H}=i;let G=new DOMPoint(_,A),Y=new DOMPoint(N,V),J=P,oe=H;if(m){G=x.transformPoint(G),Y=x.transformPoint(Y);const pe=(x.a+x.d)/2;J=P*pe,oe=i.r*pe}const ue=c.createRadialGradient(G.x,G.y,J,Y.x,Y.y,oe);for(const pe of i.stops)ue.addColorStop(pe.offset,P_(pe.rgb_color,pe.opacity*a,h));return ue}function tD(c,i,a,h){const m=h.transform?R_(h.transform).preMultiplySelf(i):i,x=p1(c.canvas.width,c.canvas.height),_=x.getContext("2d");for(const P of h.children)if(P.group)tD(_,m,a,P.group);else if(P.path){const N=P.path,V=new Path2D;V.addPath(sD(N),m),_.fill(V,Kj(N))}const A=h.clip_path_idx!=null?a.clip_paths[h.clip_path_idx]:null;A&&nD(_,m,a,A),c.globalCompositeOperation="source-over",c.drawImage(x,0,0)}function nD(c,i,a,h){const m=p1(c.canvas.width,c.canvas.height);tD(m.getContext("2d"),i,a,h),c.globalCompositeOperation="destination-in",c.drawImage(m,0,0)}function rD(c,i,a,h,m){if(h.children.length===0)return;const x=h.mask_idx!=null?a.masks[h.mask_idx]:null;x&&rD(c,i,a,x,m);const _=c.canvas.width,A=c.canvas.height,P=p1(_,A),N=P.getContext("2d"),V=h.width,H=h.height,G=h.left,Y=h.top,J=new Path2D,oe=new Path2D;oe.rect(G,Y,V,H),J.addPath(oe,i),N.clip(J);for(const we of h.children)Zj(N,i,a,we,m);const ue=N.getImageData(0,0,_,A),pe=ue.data;if(h.mask_type===$j.MASK_TYPE_LUMINANCE)for(let we=0;we<pe.length;we+=4)pe[we+3]=pe[we+3]/255*(.2126*pe[we]+.7152*pe[we+1]+.0722*pe[we+2]);N.putImageData(ue,0,0),c.globalCompositeOperation="destination-in",c.drawImage(P,0,0)}function R_(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function iD(c,i){const a=c.step;let h=c.diffs[0]*a,m=c.diffs[1]*a;i.moveTo(h,m);for(let x=0,_=2;x<c.commands.length;x++)switch(c.commands[x]){case f1.PATH_COMMAND_MOVE:h+=c.diffs[_++]*a,m+=c.diffs[_++]*a,i.moveTo(h,m);break;case f1.PATH_COMMAND_LINE:h+=c.diffs[_++]*a,m+=c.diffs[_++]*a,i.lineTo(h,m);break;case f1.PATH_COMMAND_QUAD:{const A=h+c.diffs[_++]*a,P=m+c.diffs[_++]*a;h=A+c.diffs[_++]*a,m=P+c.diffs[_++]*a,i.quadraticCurveTo(A,P,h,m);break}case f1.PATH_COMMAND_CUBIC:{const A=h+c.diffs[_++]*a,P=m+c.diffs[_++]*a,N=A+c.diffs[_++]*a,V=P+c.diffs[_++]*a;h=N+c.diffs[_++]*a,m=V+c.diffs[_++]*a,i.bezierCurveTo(A,P,N,V,h,m);break}case f1.PATH_COMMAND_CLOSE:i.closePath()}return i}function sD(c){return iD(c,new Path2D)}class wS{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}Fn(wS,"LRUCache");class uC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Ca(i,i.data)}getFromCache(i,a,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new wS(150)),this.cacheMap.get(h).get(Ud(i.toString(),a))}setInCache(i,a,h,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new wS(150));const x=this.cacheDependenciesMap.get(m),_=Ud(i.id.toString(),h);x.get(_)||x.set(_,new Set);const A=this.cacheMap.get(m),P=i.toString();x.get(_).add(P),A.put(Ud(i.toString(),h),a)}removeImagesFromCacheByIds(i,a,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const m=this.cacheMap.get(h),x=this.cacheDependenciesMap.get(h);for(const _ of i){const A=Ud(_.toString(),a);if(x.has(A)){for(const P of x.get(A))m.delete(P);x.delete(A)}}}rasterize(i,a,h,m,x=DQ){const _=this.getFromCache(i,h,m);if(_)return _.clone();const A=x(a.icon,i.options),P=uC._getImage(A);return this.setInCache(i,P,h,m),P.clone()}}class oD{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const h=this.toIdx(i,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function aD(c,i,a,h){let m=0,x=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(h[_])<1e-15){if(a[_]<c[_]||a[_]>i[_])return null}else{const A=1/h[_];let P=(c[_]-a[_])*A,N=(i[_]-a[_])*A;if(P>N){const V=P;P=N,N=V}if(P>m&&(m=P),N<x&&(x=N),m>x)return null}return m}function lD(c,i,a,h,m,x,_,A,P,N,V){const H=h-c,G=m-i,Y=x-a,J=_-c,oe=A-i,ue=P-a,pe=V[1]*ue-V[2]*oe,we=V[2]*J-V[0]*ue,Te=V[0]*oe-V[1]*J,Ie=H*pe+G*we+Y*Te;if(Math.abs(Ie)<1e-15)return null;const Ze=1/Ie,Ve=N[0]-c,Ye=N[1]-i,nt=N[2]-a,ot=(Ve*pe+Ye*we+nt*Te)*Ze;if(ot<0||ot>1)return null;const Ot=Ye*Y-nt*G,pt=nt*H-Ve*Y,Ut=Ve*G-Ye*H,Zt=(V[0]*Ot+V[1]*pt+V[2]*Ut)*Ze;return Zt<0||ot+Zt>1?null:(J*Ot+oe*pt+ue*Ut)*Ze}function cD(c,i,a){return(c-i)/(a-i)}function uD(c,i,a,h,m,x,_,A,P){const N=1<<a,V=x-h,H=_-m,G=(c+1)/N*V+h,Y=(i+0)/N*H+m,J=(i+1)/N*H+m;A[0]=(c+0)/N*V+h,A[1]=Y,P[0]=G,P[1]=J}class dD{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=(function(x){const _=Math.ceil(Math.log2(x.dim/8)),A=[];let P=Math.ceil(Math.pow(2,_));const N=1/P,V=(Y,J,oe,ue,pe)=>{const we=ue?1:0,Te=(Y+1)*oe-we,Ie=J*oe,Ze=(J+1)*oe-we;pe[0]=Y*oe,pe[1]=Ie,pe[2]=Te,pe[3]=Ze};let H=new oD(P);const G=[];for(let Y=0;Y<P*P;Y++){V(Y%P,Math.floor(Y/P),N,!1,G);const J=r0(G[0],G[1],x),oe=r0(G[2],G[1],x),ue=r0(G[2],G[3],x),pe=r0(G[0],G[3],x);H.minimums.push(Math.min(J,oe,ue,pe)),H.maximums.push(Math.max(J,oe,ue,pe)),H.leaves.push(1)}for(A.push(H),P/=2;P>=1;P/=2){const Y=A[A.length-1];H=new oD(P);for(let J=0;J<P*P;J++){V(J%P,Math.floor(J/P),2,!0,G);const oe=Y.getElevation(G[0],G[1]),ue=Y.getElevation(G[2],G[1]),pe=Y.getElevation(G[2],G[3]),we=Y.getElevation(G[0],G[3]),Te=Y.isLeaf(G[0],G[1]),Ie=Y.isLeaf(G[2],G[1]),Ze=Y.isLeaf(G[2],G[3]),Ve=Y.isLeaf(G[0],G[3]),Ye=Math.min(oe.min,ue.min,pe.min,we.min),nt=Math.max(oe.max,ue.max,pe.max,we.max),ot=Te&&Ie&&Ze&&Ve;H.maximums.push(nt),H.minimums.push(Ye),H.leaves.push(nt-Ye<=5&&ot?1:0)}A.push(H)}return A})(this.dem),h=a.length-1,m=a[h];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(i,a,h,m,x,_,A=1){return aD([i,a,-100],[h,m,this.maximums[0]*A],x,_)}raycast(i,a,h,m,x,_,A=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,a,h,m,x,_,A);if(P==null)return null;const N=[],V=[],H=[],G=[],Y=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:J,t:oe,nodex:ue,nodey:pe,depth:we}=Y.pop();if(this.leaves[J]){uD(ue,pe,we,i,a,h,m,H,G);const Ie=1<<we,Ze=(ue+0)/Ie,Ve=(ue+1)/Ie,Ye=(pe+0)/Ie,nt=(pe+1)/Ie,ot=r0(Ze,Ye,this.dem)*A,Ot=r0(Ve,Ye,this.dem)*A,pt=r0(Ve,nt,this.dem)*A,Ut=r0(Ze,nt,this.dem)*A,Zt=lD(H[0],H[1],ot,G[0],H[1],Ot,G[0],G[1],pt,x,_),en=lD(G[0],G[1],pt,H[0],G[1],Ut,H[0],H[1],ot,x,_),vn=Math.min(Zt!==null?Zt:Number.MAX_VALUE,en!==null?en:Number.MAX_VALUE);if(vn!==Number.MAX_VALUE)return vn;{const an=yt([],x,_,oe);if(hD(ot,Ot,Ut,pt,cD(an[0],H[0],G[0]),cD(an[1],H[1],G[1]))>=an[2])return oe}continue}let Te=0;for(let Ie=0;Ie<this._siblingOffset.length;Ie++){uD((ue<<1)+this._siblingOffset[Ie][0],(pe<<1)+this._siblingOffset[Ie][1],we+1,i,a,h,m,H,G),H[2]=-100,G[2]=this.maximums[this.childOffsets[J]+Ie]*A;const Ze=aD(H,G,x,_);if(Ze!=null){const Ve=Ze;N[Ie]=Ve;let Ye=!1;for(let nt=0;nt<Te&&!Ye;nt++)Ve>=N[V[nt]]&&(V.splice(nt,0,Ie),Ye=!0);Ye||(V[Te]=Ie),Te++}}for(let Ie=0;Ie<Te;Ie++){const Ze=V[Ie];Y.push({idx:this.childOffsets[J]+Ze,t:N[Ze],nodex:(ue<<1)+this._siblingOffset[Ze][0],nodey:(pe<<1)+this._siblingOffset[Ze][1],depth:we+1})}}return null}_addNode(i,a,h){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,h,m,x){if(i[m].isLeaf(a,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const _=m-1,A=i[_];let P=0,N=0;for(let V=0;V<this._siblingOffset.length;V++){const H=2*a+this._siblingOffset[V][0],G=2*h+this._siblingOffset[V][1],Y=A.getElevation(H,G),J=A.isLeaf(H,G),oe=this._addNode(Y.min,Y.max,J);J&&(P|=1<<V),N||(N=oe)}for(let V=0;V<this._siblingOffset.length;V++)P&1<<V||this._construct(i,2*a+this._siblingOffset[V][0],2*h+this._siblingOffset[V][1],_,N+V)}}function hD(c,i,a,h,m,x){return Ar(Ar(c,a,x),Ar(i,h,x),m)}function r0(c,i,a){const h=a.dim,m=ve(c*h-.5,0,h-1),x=ve(i*h-.5,0,h-1),_=Math.floor(m),A=Math.floor(x),P=Math.min(_+1,h-1),N=Math.min(A+1,h-1);return hD(a.get(_,A),a.get(P,A),a.get(_,N),a.get(P,N),m-_,x-A)}const LQ={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function OQ(c,i,a){return(256*c*256+256*i+a)/10-1e4}function FQ(c,i,a){return 256*c+i+a/256-32768}class SS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,h,m=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void It(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const x=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let P=0;P<x;P++)_[this._idx(-1,P)]=_[this._idx(0,P)],_[this._idx(x,P)]=_[this._idx(x-1,P)],_[this._idx(P,-1)]=_[this._idx(P,0)],_[this._idx(P,x)]=_[this._idx(P,x-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(x,-1)]=_[this._idx(x-1,0)],_[this._idx(-1,x)]=_[this._idx(0,x-1)],_[this._idx(x,x)]=_[this._idx(x-1,x-1)]}const A=h==="terrarium"?FQ:OQ;for(let P=0;P<_.length;++P){const N=4*P;this.floatView[P]=A(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=eo.now()}_buildQuadTree(){this._tree=new dD(this)}get(i,a,h=!1){h&&(i=ve(i,-1,this.dim),a=ve(a,-1,this.dim));const m=this._idx(i,a);return this.floatView[m]}set(i,a,h){const m=this._idx(i,a),x=this.floatView[m];return this.floatView[m]=h,h-x}static getUnpackVector(i){return LQ[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const h=[0,0,0,0],m=SS.getUnpackVector(a);let x=Math.floor((i+m[3])/m[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new s4({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,x=a*this.dim+this.dim,_=h*this.dim,A=h*this.dim+this.dim;switch(a){case-1:m=x-1;break;case 1:x=m+1}switch(h){case-1:_=A-1;break;case 1:A=_+1}const P=-a*this.dim,N=-h*this.dim;for(let V=_;V<A;V++)for(let H=m;H<x;H++){const G=4*this._idx(H,V),Y=4*this._idx(H+P,V+N);this.pixels[G+0]=i.pixels[Y+0],this.pixels[G+1]=i.pixels[Y+1],this.pixels[G+2]=i.pixels[Y+2],this.pixels[G+3]=i.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function BQ(c,i,a){c===1?i.headerLength=a.readFixed32():c===2?i.x=a.readVarint():c===3?i.y=a.readVarint():c===4?i.z=a.readVarint():c===5&&i.layers.push((function(h,m){return h.readFields(GQ,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)})(a,a.readVarint()+a.pos))}function zQ(c,i,a){c===1?(i.delta_filter=(function(h,m){return h.readFields(UQ,{blockSize:0},m)})(a,a.readVarint()+a.pos),i.filter="delta_filter"):c===2?(a.readVarint(),i.filter="zigzag_filter"):c===3?(a.readVarint(),i.filter="bitshuffle_filter"):c===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function UQ(c,i,a){c===1&&(i.blockSize=a.readVarint())}function VQ(c,i,a){c===1?(a.readVarint(),i.codec="gzip_data"):c===2?(a.readVarint(),i.codec="jpeg_image"):c===3?(a.readVarint(),i.codec="webp_image"):c===4&&(a.readVarint(),i.codec="png_image")}function HQ(c,i,a){let h=0,m=0;c===1?i.firstByte=a.readFixed64():c===2?i.lastByte=a.readFixed64():c===3?i.filters.push((function(x,_){return x.readFields(zQ,{},_)})(a,a.readVarint()+a.pos)):c===4?i.codec=(function(x,_){return x.readFields(VQ,{},_)})(a,a.readVarint()+a.pos):c===5?m=a.readFloat():c===6?h=a.readFloat():c===7?i.bands.push(a.readString()):c===8?i.offset=a.readDouble():c===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=m),i.scale===0&&(i.scale=h)}function GQ(c,i,a){c===1?i.version=a.readVarint():c===2?i.name=a.readString():c===3?i.units=a.readString():c===4?i.tileSize=a.readVarint():c===5?i.buffer=a.readVarint():c===6?i.pixelFormat=a.readVarint():c===7&&i.dataIndex.push((function(h,m){return h.readFields(HQ,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)})(a,a.readVarint()+a.pos))}function $Q(c,i,a){if(c===2)(function(h,m,x){h.readFields(WQ,x,m)})(a,a.readVarint()+a.pos,i);else if(c===3)throw new Error("Not implemented")}function WQ(c,i,a){if(c===1){let h=0;const m=a.readVarint()+a.pos;for(;a.pos<m;)i[h++]=a.readVarint()}}function qQ(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let h=2;h>=1;h--){const m=h===1?1:0,x=h===2?1:0;for(let _=0;_<i[0];_++){const A=i[1]*_;for(let P=m;P<i[1];P++){const N=i[2]*(P+A);for(let V=x;V<i[2];V++){const H=i[3]*(V+N);for(let G=0;G<i[3];G++){const Y=H+G;c[Y]+=c[Y-a]}}}}a*=i[h]}return c}function XQ(c){for(let i=0,a=c.length;i<a;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function ZQ(c,i){switch(i){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const h=c[a],m=c[a+1];c[a]=(240&h)>>4|(61440&h)>>8|(240&m)<<4|61440&m,c[a+1]=15&h|(3840&h)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const h=c[a],m=c[a+1],x=c[a+2],_=c[a+3];c[a+0]=(192&h)>>6|(192&m)>>4|(192&x)>>2|192&_,c[a+1]=(48&h)>>4|(48&m)>>2|48&x|(48&_)<<2,c[a+2]=(12&h)>>2|12&m|(12&x)<<2|(12&_)<<4,c[a+3]=3&h|(3&m)<<2|(3&x)<<4|(3&_)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}Fn(SS,"DEMData"),Fn(dD,"DemMinMaxQuadTree",{omit:["dem"]});var qu=Uint8Array,m1=Uint16Array,QQ=Int32Array,fD=new qu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pD=new qu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),KQ=new qu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mD=function(c,i){for(var a=new m1(31),h=0;h<31;++h)a[h]=i+=1<<c[h-1];var m=new QQ(a[30]);for(h=1;h<30;++h)for(var x=a[h];x<a[h+1];++x)m[x]=x-a[h]<<5|h;return{b:a,r:m}},gD=mD(fD,2),yD=gD.b,YQ=gD.r;yD[28]=258,YQ[258]=28;for(var JQ=mD(pD,0).b,xD=new m1(32768),Oo=0;Oo<32768;++Oo){var N_=(43690&Oo)>>1|(21845&Oo)<<1;xD[Oo]=((65280&(N_=(61680&(N_=(52428&N_)>>2|(13107&N_)<<2))>>4|(3855&N_)<<4))>>8|(255&N_)<<8)>>1}var g1=function(c,i,a){for(var h=c.length,m=0,x=new m1(i);m<h;++m)c[m]&&++x[c[m]-1];var _,A=new m1(i);for(m=1;m<i;++m)A[m]=A[m-1]+x[m-1]<<1;_=new m1(1<<i);var P=15-i;for(m=0;m<h;++m)if(c[m])for(var N=m<<4|c[m],V=i-c[m],H=A[c[m]-1]++<<V,G=H|(1<<V)-1;H<=G;++H)_[xD[H]>>P]=N;return _},y1=new qu(288);for(Oo=0;Oo<144;++Oo)y1[Oo]=8;for(Oo=144;Oo<256;++Oo)y1[Oo]=9;for(Oo=256;Oo<280;++Oo)y1[Oo]=7;for(Oo=280;Oo<288;++Oo)y1[Oo]=8;var _D=new qu(32);for(Oo=0;Oo<32;++Oo)_D[Oo]=5;var eK=g1(y1,9),tK=g1(_D,5),dC=function(c){for(var i=c[0],a=1;a<c.length;++a)c[a]>i&&(i=c[a]);return i},Kh=function(c,i,a){var h=i/8|0;return(c[h]|c[h+1]<<8)>>(7&i)&a},hC=function(c,i){var a=i/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&i)},nK=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yh=function(c,i,a){var h=new Error(i||nK[c]);if(h.code=c,Error.captureStackTrace&&Error.captureStackTrace(h,Yh),!a)throw h;return h},rK=new qu(0),iK=typeof TextDecoder<"u"&&new TextDecoder;try{iK.decode(rK,{stream:!0})}catch{}const sK={gzip_data:"gzip"};class Gd extends Error{constructor(i){super(i),this.name="MRTError"}}const oK={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},vD={uint32:1,uint16:2,uint8:4},aK={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fC;class TS{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new Gd(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),h=new DataView(i);if(a[0]!==13)throw new Gd("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),h=this.getHeaderLength(i);if(a.length<h)throw new Gd(`Expected header with length >= ${h} but got buffer of length ${a.length}`);const m=new fC(a.subarray(0,h)).readFields(BQ,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Gd(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const x of m.layers)this.layers[x.name]=new bD(x,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],h=this.getLayer(i.layerName);for(let m of i.blockIndices){const x=h.dataIndex[m],_=x.firstByte-i.firstByte,A=x.lastByte-i.firstByte;if(h._blocksInProgress.has(m))continue;const P={layerName:h.name,firstByte:_,lastByte:A,pixelFormat:h.pixelFormat,blockIndex:m,blockShape:[x.bands.length].concat(h.bandShape),buffer:h.buffer,codec:x.codec.codec,filters:x.filters.map((N=>N.filter))};h._blocksInProgress.add(m),a.push(P)}return new wD(a,(()=>{a.forEach((m=>h._blocksInProgress.delete(m.blockIndex)))}),((m,x)=>{if(a.forEach((_=>h._blocksInProgress.delete(_.blockIndex))),m)throw m;x.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class bD{constructor({version:i,name:a,units:h,tileSize:m,pixelFormat:x,buffer:_,dataIndex:A},P){if(this.version=i,this.version!==1)throw new Gd(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=h,this.tileSize=m,this.buffer=_,this.pixelFormat=oK[x],this.dataIndex=A,this.bandShape=[m+2*_,m+2*_,vD[this.pixelFormat]],this._decodedBlocks=new wS(P?P.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return vD[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:i})=>i)).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[h,m]of this.dataIndex.entries()){for(const[x,_]of m.bands.entries())if(_===i)return{bandIndex:a+x,blockIndex:h,blockBandIndex:x};a+=m.bands.length}break;case"number":for(const[h,m]of this.dataIndex.entries()){if(i>=a&&i<a+m.bands.length)return{bandIndex:i,blockIndex:h,blockBandIndex:i-a};a+=m.bands.length}break;default:throw new Gd(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let a=1/0,h=-1/0;const m=[],x=new Set;for(const _ of i){const{blockIndex:A}=this.getBlockForBand(_);if(A<0)throw new Gd(`Invalid band: ${JSON.stringify(_)}`);const P=this.dataIndex[A];m.includes(A)||m.push(A),x.add(A),a=Math.min(a,P.firstByte),h=Math.max(h,P.lastByte)}if(x.size>this.cacheSize)throw new Gd(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:h,blockIndices:m}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:h}=this.getBlockForBand(i);if(a<0)throw new Gd(`Band not found: ${JSON.stringify(i)}`);const m=this._decodedBlocks.get(a.toString());if(!m)throw new Gd(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[a],_=this.bandShape.reduce(((N,V)=>N*V),1),A=h*_,P=m.subarray(A,A+_);return{data:P,bytes:new Uint8Array(P.buffer).subarray(P.byteOffset,P.byteOffset+P.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}TS.setPbf=function(c){fC=c};class wD{constructor(i,a,h){this.tasks=i,this._onCancel=a,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}TS.performDecoding=function(c,i){const a=new Uint8Array(c);return Promise.all(i.tasks.map((h=>{const{layerName:m,firstByte:x,lastByte:_,pixelFormat:A,blockShape:P,blockIndex:N,filters:V,codec:H}=h,G=a.subarray(x,_+1),Y=new Uint32Array(P[0]*P[1]*P[2]);let J;if(H!=="gzip_data")throw new Gd(`Unhandled codec: ${H}`);return J=(function(oe,ue){if(!globalThis.DecompressionStream&&ue==="gzip_data")return Promise.resolve(((Ie=(function(Ye){Ye[0]==31&&Ye[1]==139&&Ye[2]==8||Yh(6,"invalid gzip data");var nt=Ye[3],ot=10;4&nt&&(ot+=2+(Ye[10]|Ye[11]<<8));for(var Ot=(nt>>3&1)+(nt>>4&1);Ot>0;Ot-=!Ye[ot++]);return ot+(2&nt)})(Te=oe))+8>Te.length&&Yh(6,"invalid gzip data"),(function(Ye,nt,ot,Ot){var pt=Ye.length;if(!pt||nt.f&&!nt.l)return ot||new qu(0);var Ut=!ot,Zt=Ut||nt.i!=2,en=nt.i;Ut&&(ot=new qu(3*pt));var vn,an,Qt=function(Hs){var As=ot.length;if(Hs>As){var fs=new qu(Math.max(2*As,Hs));fs.set(ot),ot=fs}},sn=nt.f||0,jt=nt.p||0,Rt=nt.b||0,nn=nt.l,gn=nt.d,Yt=nt.m,zn=nt.n,Zn=8*pt;do{if(!nn){sn=Kh(Ye,jt,1);var jn=Kh(Ye,jt+1,3);if(jt+=3,!jn){var Mn=Ye[(Ge=4+((jt+7)/8|0))-4]|Ye[Ge-3]<<8,Fr=Ge+Mn;if(Fr>pt){en&&Yh(0);break}Zt&&Qt(Rt+Mn),ot.set(Ye.subarray(Ge,Fr),Rt),nt.b=Rt+=Mn,nt.p=jt=8*Fr,nt.f=sn;continue}if(jn==1)nn=eK,gn=tK,Yt=9,zn=5;else if(jn==2){var Rn=Kh(Ye,jt,31)+257,br=Kh(Ye,jt+10,15)+4,Ur=Rn+Kh(Ye,jt+5,31)+1;jt+=14;for(var fi=new qu(Ur),Pi=new qu(19),Wr=0;Wr<br;++Wr)Pi[KQ[Wr]]=Kh(Ye,jt+3*Wr,7);jt+=3*br;var Vi=dC(Pi),Hi=(1<<Vi)-1,Ds=g1(Pi,Vi);for(Wr=0;Wr<Ur;){var Ge,Be=Ds[Kh(Ye,jt,Hi)];if(jt+=15&Be,(Ge=Be>>4)<16)fi[Wr++]=Ge;else{var $t=0,An=0;for(Ge==16?(An=3+Kh(Ye,jt,3),jt+=2,$t=fi[Wr-1]):Ge==17?(An=3+Kh(Ye,jt,7),jt+=3):Ge==18&&(An=11+Kh(Ye,jt,127),jt+=7);An--;)fi[Wr++]=$t}}var Wt=fi.subarray(0,Rn),kn=fi.subarray(Rn);Yt=dC(Wt),zn=dC(kn),nn=g1(Wt,Yt),gn=g1(kn,zn)}else Yh(1);if(jt>Zn){en&&Yh(0);break}}Zt&&Qt(Rt+131072);for(var rr=(1<<Yt)-1,tr=(1<<zn)-1,Jr=jt;;Jr=jt){var Mr=($t=nn[hC(Ye,jt)&rr])>>4;if((jt+=15&$t)>Zn){en&&Yh(0);break}if($t||Yh(2),Mr<256)ot[Rt++]=Mr;else{if(Mr==256){Jr=jt,nn=null;break}var Yn=Mr-254;Mr>264&&(Yn=Kh(Ye,jt,(1<<(Rr=fD[Wr=Mr-257]))-1)+yD[Wr],jt+=Rr);var Bi=gn[hC(Ye,jt)&tr],as=Bi>>4;if(Bi||Yh(3),jt+=15&Bi,kn=JQ[as],as>3){var Rr=pD[as];kn+=hC(Ye,jt)&(1<<Rr)-1,jt+=Rr}if(jt>Zn){en&&Yh(0);break}Zt&&Qt(Rt+131072);var ki=Rt+Yn;if(Rt<kn){var ls=0-kn,es=Math.min(kn,ki);for(ls+Rt<0&&Yh(3);Rt<es;++Rt)ot[Rt]=(void 0)[ls+Rt]}for(;Rt<ki;++Rt)ot[Rt]=ot[Rt-kn]}}nt.l=nn,nt.p=Jr,nt.b=Rt,nt.f=sn,nn&&(sn=1,nt.m=Yt,nt.d=gn,nt.n=zn)}while(!sn);return Rt!=ot.length&&Ut?(vn=ot,((an=Rt)==null||an>vn.length)&&(an=vn.length),new qu(vn.subarray(0,an))):ot.subarray(0,Rt)})(Te.subarray(Ie,-8),{i:2},new qu(((pe=Te)[(we=pe.length)-4]|pe[we-3]<<8|pe[we-2]<<16|pe[we-1]<<24)>>>0))));var pe,we,Te,Ie;const Ze=sK[ue];if(!Ze)throw new Error(`Unhandled codec: ${ue}`);const Ve=new globalThis.DecompressionStream(Ze);return new Response(new Blob([oe]).stream().pipeThrough(Ve)).arrayBuffer().then((Ye=>new Uint8Array(Ye)))})(G,H).then((oe=>((function(ue,pe){ue.readFields($Q,pe)})(new fC(oe),Y),new aK[A](Y.buffer)))),J.then((oe=>{for(let ue=V.length-1;ue>=0;ue--)switch(V[ue]){case"delta_filter":qQ(oe,P);break;case"zigzag_filter":XQ(oe);break;case"bitshuffle_filter":ZQ(oe,A);break;default:throw new Gd(`Unhandled filter "${V[ue]}"`)}return{layerName:m,blockIndex:N,data:oe}})).catch((oe=>{throw oe}))})))},Fn(wD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Fn(TS,"MapboxRasterTile"),Fn(bD,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class SD{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const h=i[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class TD{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ha(xn,16,0),this.featureIndexArray=new by,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,h,m,x,_=0,A=0){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,x,_);const N=this.grid;for(let V=0;V<a.length;V++){const H=a[V],G=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<H.length;Y++){const J=H[Y];G[0]=Math.min(G[0],J.x),G[1]=Math.min(G[1],J.y),G[2]=Math.max(G[2],J.x),G[3]=Math.max(G[3],J.y)}A!==0&&(G[0]-=A,G[1]-=A,G[2]+=A,G[3]+=A),G[0]<xn&&G[1]<xn&&G[2]>=0&&G[3]>=0&&N.insert(P,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $n(new eS(this.rawTileData)).layers,this.sourceLayerCoder=new SD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:h,transform:m,tileTransform:x,pixelPosMatrix:_,availableImages:A,worldview:P}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const N=a.queryRadius?a.queryRadius:0,V=h.bufferedTilespaceBounds,H=this.grid.query(V.min.x,V.min.y,V.max.x,V.max.y,((oe,ue,pe,we)=>Ss(h.bufferedTilespaceGeometry,oe-N,ue-N,pe+N,we+N)));H.sort(lK);let G=null;m.elevation&&H.length>0&&(G=I_.create(m.elevation,this.tileID));const Y={};let J;for(let oe=0;oe<H.length;oe++){const ue=H[oe];if(ue===J)continue;J=ue;const pe=this.featureIndexArray.get(ue);let we=null;this.is3DTile?this.loadMatchingModelFeature(Y,pe,i,h,m,P):this.loadMatchingFeature(Y,pe,i,A,P,((Te,Ie,Ze,Ve=0)=>(we||(we=zt(Te,this.tileID.canonical,x)),Ie.queryIntersectsFeature(h,Te,Ze,we,this.z,m,_,G,Ve))))}return Y}loadMatchingFeature(i,a,h,m,x,_){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:N,layoutVertexArrayOffset:V}=a,H=this.bucketLayerIDs[P],G=h.layers,Y=Object.keys(G);if(Y.length&&!gt(Y,H))return;const J=h.sourceCache,oe=this.sourceLayerCoder.decode(N),ue=this.vtLayers[oe].feature(A),pe=this.getId(ue,oe);for(let we=0;we<H.length;we++){const Te=H[we];if(!G[Te])continue;const{styleLayer:Ie,targets:Ze}=G[Te];let Ve={};pe!==void 0&&(Ve=J.getFeatureState(Ie.sourceLayer,pe));const Ye=!_||_(ue,Ie,Ve,V);if(!Ye)continue;const nt=new Ny(ue,this.z,this.x,this.y,pe);nt.tile=this.tileID.canonical,nt.state=Ve;let ot=this.serializedLayersCache.get(Te);ot||(ot=Ie.serialize(),ot.id=Te,this.serializedLayersCache.set(Te,ot)),nt.source=ot.source,nt.sourceLayer=ot["source-layer"],nt.layer=Object.assign({},ot),nt.layer.paint=ED(ot.paint,Ie.paint,ue,Ve,m),nt.layer.layout=ED(ot.layout,Ie.layout,ue,Ve,m);let Ot=!1;for(const pt of Ze){this.updateFeatureProperties(nt,pt);const{filter:Ut}=pt;if(Ut){if(ue.properties=nt.properties,Ut.needGeometry){const Zt=Mt(ue,!0);if(!Ut.filter(new rs(this.tileID.overscaledZ,{worldview:x}),Zt,this.tileID.canonical))continue}else if(!Ut.filter(new rs(this.tileID.overscaledZ,{worldview:x}),ue))continue}Ot=!0,pt.targetId&&this.addFeatureVariant(nt,pt)}Ot&&this.appendToResult(i,Te,A,nt,Ye)}}loadMatchingModelFeature(i,a,h,m,x,_){const{featureIndex:A,bucketIndex:P}=a,N=this.bucketLayerIDs[P],V=h.layers,H=Object.keys(V);if(!H.length||gt(H,N))for(let G=0;G<N.length;G++){const Y=N[G],{styleLayer:J,targets:oe}=V[Y];if(J.type!=="model")continue;const ue=m.tile,pe=ue.getBucket(J);if(!(pe&&pe instanceof yS))continue;const we=pQ(pe,A,m,x);if(!we)continue;const{z:Te,x:Ie,y:Ze}=ue.tileID.canonical,{feature:Ve,intersectionZ:Ye,position:nt}=we;let ot={};Ve.id!==void 0&&(ot=h.sourceCache.getFeatureState(J.sourceLayer,Ve.id));const Ot=new Ny({},Te,Ie,Ze,Ve.id);Ot.tile=this.tileID.canonical,Ot.state=ot,Ot.properties=Ve.properties,Ot.geometry={type:"Point",coordinates:[nt.lng,nt.lat]};let pt=this.serializedLayersCache.get(Y);pt||(pt=J.serialize(),pt.id=Y,this.serializedLayersCache.set(Y,pt)),Ot.source=pt.source,Ot.sourceLayer=pt["source-layer"],Ot.layer=Object.assign({},pt);let Ut=!1;for(const Zt of oe){this.updateFeatureProperties(Ot,Zt);const{filter:en}=Zt;if(en){if(Ve.properties=Ot.properties,en.needGeometry){if(!en.filter(new rs(this.tileID.overscaledZ,{worldview:_}),Ve,this.tileID.canonical))continue}else if(!en.filter(new rs(this.tileID.overscaledZ,{worldview:_}),Ve))continue}Ut=!0,Zt.targetId&&this.addFeatureVariant(Ot,Zt)}Ut&&this.appendToResult(i,Y,A,Ot,Ye)}}updateFeatureProperties(i,a,h){if(a.properties){const m={};for(const x in a.properties){const _=a.properties[x].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,h);_!=null&&(m[x]=_)}i.properties=m}}addFeatureVariant(i,a,h){const m={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(m.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(m)}appendToResult(i,a,h,m,x){let _=i[a];_===void 0&&(_=i[a]=[]),_.push({featureIndex:h,feature:m,intersectionZ:x})}lookupSymbolFeatures(i,a,h,m,x,_){const A={};this.loadVTLayers();for(const P of i)this.loadMatchingFeature(A,{bucketIndex:a,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},m,x,_);return A}loadFeature(i){const{featureIndex:a,sourceLayerIndex:h}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(h),x=this.vtFeatures[m];if(x[a])return x[a];const _=this.vtLayers[m].feature(a);return x[a]=_,_}hasLayer(i){for(const a of this.bucketLayerIDs)for(const h of a)if(i===h)return!0;return!1}getId(i,a){let h=i.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const x=Va(m);if(x.result!=="success"){const _=x.value.map((A=>`${A.key}: ${A.message}`)).join(", ");return void It(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=x.value}h=this.promoteIdExpression.evaluate({zoom:0},i)}else h=i.properties[m];typeof h=="boolean"&&(h=Number(h))}return h}}function ED(c,i,a,h,m){return un(c,((x,_)=>{const A=i instanceof Mc?i.get(_):null;return A&&A.evaluate?A.evaluate(a,h,void 0,m):A}))}function lK(c,i){return i-c}Fn(TD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const AD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pC{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=h>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const x=AD[15&h];if(!x)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[A]=new Uint32Array(i,4,1);return new pC(A,_,x,i)}constructor(i,a=64,h=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const x=AD.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,A=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+A+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=a,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return mC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:_,nodeSize:A}=this,P=[0,x.length-1,0],N=[];for(;P.length;){const V=P.pop()||0,H=P.pop()||0,G=P.pop()||0;if(H-G<=A){for(let ue=G;ue<=H;ue++){const pe=_[2*ue],we=_[2*ue+1];pe>=i&&pe<=h&&we>=a&&we<=m&&N.push(x[ue])}continue}const Y=G+H>>1,J=_[2*Y],oe=_[2*Y+1];J>=i&&J<=h&&oe>=a&&oe<=m&&N.push(x[Y]),(V===0?i<=J:a<=oe)&&(P.push(G),P.push(Y-1),P.push(1-V)),(V===0?h>=J:m>=oe)&&(P.push(Y+1),P.push(H),P.push(1-V))}return N}within(i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:x,nodeSize:_}=this,A=[0,m.length-1,0],P=[],N=h*h;for(;A.length;){const V=A.pop()||0,H=A.pop()||0,G=A.pop()||0;if(H-G<=_){for(let ue=G;ue<=H;ue++)MD(x[2*ue],x[2*ue+1],i,a)<=N&&P.push(m[ue]);continue}const Y=G+H>>1,J=x[2*Y],oe=x[2*Y+1];MD(J,oe,i,a)<=N&&P.push(m[Y]),(V===0?i-h<=J:a-h<=oe)&&(A.push(G),A.push(Y-1),A.push(1-V)),(V===0?i+h>=J:a+h>=oe)&&(A.push(Y+1),A.push(H),A.push(1-V))}return P}}function mC(c,i,a,h,m,x){if(m-h<=a)return;const _=h+m>>1;CD(c,i,_,h,m,x),mC(c,i,a,h,_-1,1-x),mC(c,i,a,_+1,m,1-x)}function CD(c,i,a,h,m,x){for(;m>h;){if(m-h>600){const N=m-h+1,V=a-h+1,H=Math.log(N),G=.5*Math.exp(2*H/3),Y=.5*Math.sqrt(H*G*(N-G)/N)*(V-N/2<0?-1:1);CD(c,i,a,Math.max(h,Math.floor(a-V*G/N+Y)),Math.min(m,Math.floor(a+(N-V)*G/N+Y)),x)}const _=i[2*a+x];let A=h,P=m;for(x1(c,i,h,a),i[2*m+x]>_&&x1(c,i,h,m);A<P;){for(x1(c,i,A,P),A++,P--;i[2*A+x]<_;)A++;for(;i[2*P+x]>_;)P--}i[2*h+x]===_?x1(c,i,h,P):(P++,x1(c,i,P,m)),P<=a&&(h=P+1),a<=P&&(m=P-1)}}function x1(c,i,a,h){gC(c,a,h),gC(i,2*a,2*h),gC(i,2*a+1,2*h+1)}function gC(c,i,a){const h=c[i];c[i]=c[a],c[a]=h}function MD(c,i,a,h){const m=c-a,x=i-h;return m*m+x*x}r.$=Lp,r.A=Pu,r.B=Ud,r.C=2,r.D=y_,r.E=Jc,r.F=e1,r.G=ej,r.H=xg,r.I=bs,r.J=Og,r.K=wf,r.L=Sf,r.M=em,r.N=Mg,r.O=Lf,r.P=Ht,r.Q=Ff,r.R=xc,r.S=Dh,r.T=A3,r.U=Va,r.V=gS,r.W=rm,r.X=Cf,r.Y=Eh,r.Z=Wp,r._=ha,r.a=function(c){return ii.API_CDN_URL_REGEX.test(c)},r.a$=Ea,r.a0=Dr,r.a1=mh,r.a2=Lh,r.a3=class extends gS{},r.a4=tm,r.a5=Rh,r.a6=ft,r.a7=function(c){const i=c.value;return i?Dr(i)?nC(i,!0)?[]:[new gS(c.key,i,`invalid url "${i}"`)]:[new gS(c.key,i,`string expected, "${wf(i)}" found`)]:[]},r.a8=Dg,r.a9=Ns,r.aA=ve,r.aB=X,r.aC=Oe,r.aD=Ls,r.aE=_o,r.aF=be,r.aG=Lt,r.aH=function(c,i){const a={};for(let h=0;h<i.length;h++){const m=i[h];m in c&&(a[m]=c[m])}return a},r.aI=Q,r.aJ=_e,r.aK=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,a,h){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[x,_]=m.result;return this.scheduler?this.scheduler.add((()=>{h(x,_)}),i):h(x,_),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=a(((x,_)=>{m.result=[x,_];for(const A of m.callbacks)this.scheduler?this.scheduler.add((()=>{A(x,_)}),i):A(x,_);setTimeout((()=>delete this.entries[c]),3e3)}))),()=>{m.result||(m.callbacks=m.callbacks.filter((x=>x!==h)),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},r.aL=function(c,i,a){const h=JSON.stringify(c.request);return c.data&&(this.deduped.entries[h]={result:[null,c.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},(m=>{const x=dh(c.request,((_,A,P)=>{_?m(_):A&&m(null,{vectorTile:a?void 0:new $n(new eS(A)),rawData:A,responseHeaders:new Map(P.entries())})}));return()=>{x.cancel(),m()}}),i)},r.aM=function(c){return c?{cacheControl:c.get("Cache-Control"),expires:c.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=function(c){gc++,gc>ca&&(c.getActor().send("enforceCacheSizeLimit",il),gc=0)},r.aO=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log2(c)))},r.aP=Z,r.aQ=kj,r.aR=Dj,r.aS=ee,r.aT=Mj,r.aU=function(c,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let h=0;h<c.length;h++){const m=document.createElement("source");Di(c[h])||(a.crossOrigin="Anonymous"),m.src=c[h],a.appendChild(m)}return{cancel:()=>{}}},r.aV=Zb,r.aW=jy,r.aX=Ct,r.aY=i1,r.aZ=Pe,r.a_=Ee,r.aa=dn,r.ab=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return Hn(c.expression.evaluate(i))}interpolate(c,i,a){return{x:Ar(c.x,i.x,a),y:Ar(c.y,i.y,a),z:Ar(c.z,i.z,a),azimuthal:Ar(c.azimuthal,i.azimuthal,a),polar:Ar(c.polar,i.polar,a)}}},r.ac=rs,r.ad=fl,r.ae=dt,r.af=Un,r.ag=ke,r.ah=Fe,r.ai=Mc,r.aj=Yg,r.ak=Ar,r.al=xn,r.am=_f,r.an=Qr,r.ao=Wi,r.ap=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return(function([a,h]){const m=Hn([1,a,h]);return{x:m.x,y:m.y,z:m.z}})(c.expression.evaluate(i))}interpolate(c,i,a){return{x:Ar(c.x,i.x,a),y:Ar(c.y,i.y,a),z:Ar(c.z,i.z,a)}}},r.aq=function(c,i,a=0,h=!0){const m=new Ht(a,a),x=c.sub(m),_=i.add(m),A=[x,new Ht(_.x,x.y),_,new Ht(x.x,_.y)];return h&&A.push(x.clone()),A},r.ar=function(c,i){const a=[];for(let h=0;h<c.length;h++){const m=tt(h-1,-1,c.length-1),x=tt(h+1,-1,c.length-1),_=c[h],A=c[x],P=c[m].sub(_).unit(),N=A.sub(_).unit(),V=N.angleWithSep(P.x,P.y),H=P.add(N).unit().mult(-1*i/Math.sin(V/2));a.push(_.add(H))}return a},r.as=fj,r.at=Ss,r.au=function(c,i,a=0){return je(((i.x-a)*c.scale-c.x)*xn,(i.y*c.scale-c.y)*xn,We(i.z,i.y))},r.av=wn,r.aw=kt,r.ax=Kr,r.ay=C6,r.az=function(c){let i=1/0,a=1/0,h=-1/0,m=-1/0;for(const x of c)i=Math.min(i,x.x),a=Math.min(a,x.y),h=Math.max(h,x.x),m=Math.max(m,x.y);return{min:new Ht(i,a),max:new Ht(h,m)}},r.b=function(c){return ii.API_FONTS_REGEX.test(c)},r.b$=p3,r.b0=ys,r.b1=Pt,r.b2=xy,r.b3=hS,r.b4=function(){na.isLoading()||na.isLoaded()||Uo()!=="deferred"||Vf()},r.b5=am,r.b6=Mt,r.b7=Ny,r.b8=vr,r.b9=j3,r.bA=re,r.bB=D,r.bC=function(c,i){const{x:a,y:h}=c.point,m=j2(a,h,c.worldSize/c._pixelsPerMercatorPixel,0,0);return X(m,m,ia(Yr(i)))},r.bD=E,r.bE=Lr,r.bF=Vt,r.bG=yt,r.bH=mn,r.bI=on,r.bJ=E_,r.bK=Rc,r.bL=V3,r.bM=function(c,i,a,h,m){const x=5*i+2;c.float32[x+0]=a,c.float32[x+1]=h,c.float32[x+2]=m},r.bN=k_,r.bO=Zr,r.bP=St,r.bQ=qn,r.bR=Tr,r.bS=tt,r.bT=function(c,i,a,h){var m=new w(4);return m[0]=c,m[1]=i,m[2]=a,m[3]=h,m},r.bU=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const a=i.getSource().maxzoom,h=1<<a,m=Math.floor(c.x),x=Math.floor((c.x-m)*h),_=Math.floor(c.y*h),A=this.findDEMTileFor(new Z(a,m,a,x,_));return!(!A||!A.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const h=this._source();if(!h||c.y<0||c.y>1)return i;const m=h.getSource().maxzoom,x=1<<m,_=Math.floor(c.x),A=c.x-_,P=new Z(m,_,m,Math.floor(A*x),Math.floor(c.y*x)),N=this.findDEMTileFor(P);if(!N||!N.dem)return i;const V=N.dem,H=1<<N.tileID.canonical.z,G=(A*H-N.tileID.canonical.x)*V.dim,Y=(c.y*H-N.tileID.canonical.y)*V.dim,J=Math.floor(G),oe=Math.floor(Y);return(a?this.exaggeration():1)*Ar(Ar(V.get(J,oe),V.get(J,oe+1),Y-oe),Ar(V.get(J+1,oe),V.get(J+1,oe+1),Y-oe),G-J)}static getAtTileOffset(c,i,a,h){const m=1<<c.canonical.z;return h?h.pointElevation(i):a?a.getAtPointOrZero(new dt(c.wrap+(c.canonical.x+i.x/xn)/m,(c.canonical.y+i.y/xn)/m)):0}static getAtTileOffsetFunc(c,i,a,h){return(m,x,_)=>{const A=this.getAtTileOffset(c,m,x,_),P=h.upVector(c.canonical,m.x,m.y);return bt(P,P,A*h.upVectorScale(c.canonical,i,a).metersToTile),P}}getForTilePoints(c,i,a,h){if(this.isUsingMockSource())return!1;const m=I_.create(this,c,h);return!!m&&(i.forEach((x=>{x[2]=this.exaggeration()*m.getElevationAt(x[0],x[1],a)})),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const a=i.dem.tree,h=i.tileID,m=1<<c.canonical.z-h.canonical.z;let x=c.canonical.x/m-h.canonical.x,_=c.canonical.y/m-h.canonical.y,A=0;for(let P=0;P<c.canonical.z-h.canonical.z&&!a.leaves[A];P++){x*=2,_*=2;const N=2*Math.floor(_)+Math.floor(x);A=a.childOffsets[A]+N,x%=1,_%=1}return{min:this.exaggeration()*a.minimums[A],max:this.exaggeration()*a.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,a=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const m of c){const x=this.getMinMaxForTile(m.tileID);x&&(a=Math.min(a,x.min),h=Math.max(h,x.max),i=!0)}return i?{min:a,max:h}:null}},r.bV=H2,r.bW=qs,r.bX=sa,r.bY=S4,r.bZ=Lj,r.b_=C4,r.ba=d3,r.bb=zt,r.bc=$a,r.bd=qf,r.be=Tn,r.bf=Li,r.bg=m_,r.bh=eC,r.bi=function(c,i){const a=Yg(i.zoom);if(a===0)return Yr(c);const h=pn(c),m=Sr(h),x=be(h.getWest())*i.worldSize,_=be(h.getEast())*i.worldSize,A=_e(h.getNorth())*i.worldSize,P=_e(h.getSouth())*i.worldSize,N=[x,A,0],V=[_,A,0],H=[x,P,0],G=[_,P,0],Y=U([],i.globeMatrix);return Un(N,N,Y),Un(V,V,Y),Un(H,H,Y),Un(G,G,Y),m[0]=no(m[0],H,a),m[1]=no(m[1],G,a),m[2]=no(m[2],V,a),m[3]=no(m[3],N,a),Gr.fromPoints(m)},r.bj=Fi,r.bk=U,r.bl=hi,r.bm=no,r.bn=Bh,r.bo=Ft,r.bp=xe,r.bq=W,r.br=TS,r.bs=eS,r.bt=dh,r.bu=function(c,i){const a=[];for(const h in c)h in i||a.push(h);return a},r.bv=Je,r.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bx=cs,r.by=O,r.bz=F,r.c=Qi,r.c$=function(c){return c*c*c*c*c},r.c0=z3,r.c1=aj,r.c2=q3,r.c3=pC,r.c4=bt,r.c5=mr,r.c6=En,r.c7=function(c,i,a){a*=.5;var h=i[0],m=i[1],x=i[2],_=i[3],A=Math.sin(a),P=Math.cos(a);return c[0]=h*P+m*A,c[1]=m*P-h*A,c[2]=x*P+_*A,c[3]=_*P-x*A,c},r.c8=Dn,r.c9=Er,r.cA=Oi,r.cB=d6,r.cC=M,r.cD=Xt,r.cE=function(c,i,a,h,m,x,_,A,P){if(P.name==="globe")return Xt(c,i,new M(a,h,m),!1);const N=i1({z:a,x:h,y:m},P);return new Gr([(x+N.x/N.scale)*i,i*(N.y/N.scale),_],[(x+N.x2/N.scale)*i,i*(N.y2/N.scale),A])},r.cF=function(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c[3]=Math.min(i[3],a[3]),c},r.cG=function(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c[3]=Math.max(i[3],a[3]),c},r.cH=function(c){const i=Math.round((c+45+360)%360/90)%4;return ea[i]},r.cI=Ne,r.cJ=Nt,r.cK=o,r.cL=function(c){const i=F(new Float64Array(16));X(i,c.pixelMatrix,c.globeMatrix);const a=[0,C,0],h=[0,I,0];return Un(a,a,i),Un(h,h,i),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!r3(c,new ee(c.center.lat,90)),h[0]>0&&h[0]<=c.width&&h[1]>0&&h[1]<=c.height&&!r3(c,new ee(c.center.lat,-90))]},r.cM=function(c,i){const{scale:a}=c.tileTransform,h=a*xn/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return(function(m,x,_){var A=x[1],P=x[2],N=x[3],V=_[0],H=_[1];return m[0]=x[0]*V,m[1]=A*V,m[2]=P*H,m[3]=N*H,m})(new Float32Array(4),i.inverseAdjustmentMatrix,[h,h])},r.cN=X2,r.cO=Ce,r.cP=u6,r.cQ=function(c){const i=u6(c,!0);return E([],[i[0],i[1],i[4],i[5]])},r.cR=K,r.cS=Xi,r.cT=ne,r.cU=function(c){const{x:i,y:a}=c.point,{lng:h,lat:m}=c._center;return j2(i,a,c.worldSize,h,m)},r.cV=qe,r.cW=Rs,r.cX=se,r.cY=Fs,r.cZ=g,r.c_=function(c,i,a){let h=0;for(let m=0;m<2;++m)c[m]>0&&(h+=(c[m]-0)*(c[m]-0)),i[m]<0&&(h+=(0-i[m])*(0-i[m]));return h},r.ca=function(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c[3]=i[3],c},r.cb=ye,r.cc=function(c,i,a,h,m){var x=1/Math.tan(i/2);if(c[0]=x/a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=x,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,m!=null&&m!==1/0){var _=1/(h-m);c[10]=(m+h)*_,c[14]=2*m*h*_}else c[10]=-1,c[14]=-2*h;return c},r.cd=function(c,i,a,h,m,x,_){var A=1/(i-a),P=1/(h-m),N=1/(x-_);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*P,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*N,c[11]=0,c[12]=(i+a)*A,c[13]=(m+h)*P,c[14]=(_+x)*N,c[15]=1,c},r.ce=Se,r.cf=function(c,i,a){c[4*i+0]=a[0],c[4*i+1]=a[1],c[4*i+2]=a[2],c[4*i+3]=a[3]},r.cg=ym,r.ch=Hd,r.ci=Ks,r.cj=Ic,r.ck=rc,r.cl=xj,r.cm=function(){var c=new w(4);return w!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},r.cn=function(c,i,a){var h=i[0],m=i[1],x=i[2],_=i[3],A=Math.sin(a),P=Math.cos(a);return c[0]=h*P+x*A,c[1]=m*P+_*A,c[2]=h*-A+x*P,c[3]=m*-A+_*P,c},r.co=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]},r.cp=Br,r.cq=function(c){var i=c[0],a=c[1],h=c[2],m=c[3];return Math.sqrt(i*i+a*a+h*h+m*m)},r.cr=ir,r.cs=ht,r.ct=B,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=Hr,r.cz=Me,r.d=function(c){return ii.API_TILEJSON_REGEX.test(c)},r.d$=ZN,r.d0=de,r.d1=45,r.d2=Wh,r.d3=function(c,i,a){const h=Math.sqrt(c*c+i*i+a*a),m=h>0?Math.acos(a/h)*ho:0;let x=c!==0||i!==0?Math.atan2(-i,-c)*ho+90:0;return x<0&&(x+=360),[h,x,m]},r.d4=je,r.d5=Hn,r.d6=Qe,r.d7=Ae,r.d8=Gr,r.d9=He,r.dA=qo,r.dB=class extends pl{constructor(c){super(c),this.current=p_}set(c,i,a){if(this.fetchUniformLocation(c,i)){for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},r.dC=Hl,r.dD=function(c,i,a){const h=Yg(a.zoom),m=c.style.map._antialias,x=c.terrain&&c.terrain.exaggeration()>0;return h===0&&!m&&!x},r.dE=function(c){const i=c.pixelsPerMeter,a=i/Se(1,c.center.lat),h=F(new Float64Array(16));return W(h,h,[c.point.x,c.point.y,0]),K(h,h,[a,a,i]),Float32Array.from(h)},r.dF=pn,r.dG=function(c){const i=Ne-5;c=ve(c,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Qr(c))),3);return Math.round(a*(S.length-1))},r.dH=function(c,i,a,h){const m=i.getNorth(),x=i.getSouth(),_=i.getWest(),A=i.getEast(),P=1<<c.z,N=A-_,V=m-x,H=N/y,G=-V/S[a],Y=[0,H,0,G,0,0,m,_,0];if(c.z>0){const J=180/h;R(Y,Y,[J/N+1,0,0,0,J/V+1,0,-.5*J/H,.5*J/G,1])}return Y[2]=P,Y[5]=c.x,Y[8]=c.y,Y},r.dI=Yr,r.dJ=function(c,i,a){const h=F(new Float64Array(16)),m=(i/(1<<c)-.5)*Math.PI*2;return te(h,a.globeMatrix,m),Float32Array.from(h)},r.dK=s4,r.dL=or,r.dM=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},r.dN=T,r.dO=function(c,i){var a=Math.sin(i),h=Math.cos(i);return c[0]=h,c[1]=a,c[2]=0,c[3]=-a,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},r.dP=$r,r.dQ=qh,r.dR=ai,r.dS=vi,r.dT=256,r.dU=function(c,i){const a=[0,0,0];return Un(a,a,Fi(Yr(i.canonical))),Un(a,a,c),a},r.dV=c=>({u_matrix:new rc(c),u_texsize:new Ic(c),u_pixels_to_tile_units:new Ll(c),u_device_pixel_ratio:new Ks(c),u_width_scale:new Ks(c),u_floor_width_scale:new Ks(c),u_image:new ym(c),u_units_to_pixels:new Ic(c),u_tile_units_to_pixels:new Ks(c),u_alpha_discard_threshold:new Ks(c),u_trim_offset:new Ic(c),u_trim_fade_range:new Ic(c),u_trim_color:new Wh(c),u_emissive_strength:new Ks(c),u_zbias_factor:new Ks(c),u_tile_to_meter:new Ks(c),u_ground_shadow_factor:new Hd(c),u_pattern_transition:new Ks(c)}),r.dW=c=>({u_matrix:new rc(c),u_pixels_to_tile_units:new Ll(c),u_device_pixel_ratio:new Ks(c),u_width_scale:new Ks(c),u_floor_width_scale:new Ks(c),u_units_to_pixels:new Ic(c),u_dash_image:new ym(c),u_gradient_image:new ym(c),u_image_height:new Ks(c),u_texsize:new Ic(c),u_tile_units_to_pixels:new Ks(c),u_alpha_discard_threshold:new Ks(c),u_trim_offset:new Ic(c),u_trim_fade_range:new Ic(c),u_trim_color:new Wh(c),u_emissive_strength:new Ks(c),u_zbias_factor:new Ks(c),u_tile_to_meter:new Ks(c),u_ground_shadow_factor:new Hd(c)}),r.dX=c=>({u_camera_to_center_distance:new Ks(c),u_extrude_scale:new Ll(c),u_device_pixel_ratio:new Ks(c),u_matrix:new rc(c),u_inv_rot_matrix:new rc(c),u_merc_center:new Ic(c),u_tile_id:new Hd(c),u_zoom_transition:new Ks(c),u_up_dir:new Hd(c),u_emissive_strength:new Ks(c)}),r.dY=Wo,r.dZ=vZ,r.d_=class{constructor(c,i,a,h){this.context=c,this.format=h,this.size=a,this.texture=c.gl.createTexture();const[m,x,_]=this.size,{gl:A}=c;A.bindTexture(A.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in i&&i.data&&A.texImage3D(A.TEXTURE_3D,0,this.format,m,x,_,0,T3(this.format),E3(this.format),i.data)}bind(c,i){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_3D,this.texture),c!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,c),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},r.da=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},r.db=c6,r.dc=R3,r.dd=p6,r.de=nC,r.df=function(c,i){return c.readFields(yQ,{icons:[]},i)},r.dg=G2,r.dh=A_,r.di=G3,r.dj=fg,r.dk=zd,r.dl=ji,r.dm=ph,r.dn=Re,r.dp=function(c){const i=c.indexOf(Fh);return i>=0?c.slice(0,i):c},r.dq=function(c){return c.indexOf(Fh)>=0},r.dr=function(c){const i=c.lastIndexOf(Fh);return i>=0?c.slice(i+1):""},r.ds=function(c){const i=[],a=c.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},r.dt=function(c,i,a,h){return c.type==="custom"?new uQ(c,i):new mQ[c.type](c,i,a,h)},r.du=tn,r.dv=function(c){const i=c.indexOf(Fh);return i>=0?c.slice(i+1):""},r.dw=class extends Ny{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},r.dx=Ro,r.dy=xd,r.dz=function(c){return c({pluginStatus:$o,pluginURL:lu}),Ro.on("pluginStateChange",c),c},r.e=ii,r.e$=function([c,i,a]){const h=Math.hypot(c,i,a),m=Math.atan2(c,a),x=.5*Math.PI-Math.acos(-i/h);return new ee(Rs(m),Rs(x))},r.e0=(c,i,a,h,m,x)=>{const _=c.transform,A=_.projection.name==="globe";let P;if(x.paint.get("circle-pitch-alignment")==="map")if(A){const V=qh(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;P=Float32Array.from([V,0,0,V])}else P=_.calculatePixelsToTileUnitsMatrix(a);else P=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(_.projection),u_matrix:c.translatePosMatrix(i.projMatrix,a,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:eo.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Fq,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(A){N.u_inv_rot_matrix=h,N.u_merc_center=m,N.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],N.u_zoom_transition=Yg(_.zoom);const V=m[0]*xn,H=m[1]*xn;N.u_up_dir=_.projection.upVector(new M(0,0,0),V,H)}return N},r.e1=P6,r.e2=za,r.e3=(c,i,a,h,m,x,_,A,P,N)=>{const V=c.transform,H=V.pitch<15?M6(.07,.7,ve((14-V.zoom)/5,0,1)):.07,G=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:I6(c,i,a,h),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:V.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:m,u_width_scale:x,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:k6(i,V),u_units_to_pixels:[1/V.pixelsToGLUnits[0],1/V.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(G?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:H,u_tile_to_meter:Qe(i.tileID.canonical,0),u_ground_shadow_factor:P,u_pattern_transition:N}},r.e4=(c,i,a,h,m,x,_,A,P,N)=>{const V=c.transform,H=V.calculatePixelsToTileUnitsMatrix(i),G=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Y=V.pitch<15?M6(.07,.7,ve((14-V.zoom)/5,0,1)):.07;return{u_matrix:I6(c,i,a,h),u_pixels_to_tile_units:H,u_device_pixel_ratio:x,u_width_scale:_,u_floor_width_scale:A,u_units_to_pixels:[1/V.pixelsToGLUnits[0],1/V.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:R6(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:k6(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:P,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(G?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:Y,u_tile_to_meter:Qe(i.tileID.canonical,0),u_ground_shadow_factor:N}},r.e5=ct,r.e6=jb,r.e7=We,r.e8=ge,r.e9=V2,r.eA=sC,r.eB=K2,r.eC=Q2,r.eD=[1,1,1],r.eE=I_,r.eF=Qn,r.eG=function(c,i,a,h){var m=i[0],x=i[1],_=i[2],A=i[3];return c[0]=m+h*(a[0]-m),c[1]=x+h*(a[1]-x),c[2]=_+h*(a[2]-_),c[3]=A+h*(a[3]-A),c},r.eH=b_,r.eI=Dl,r.eJ=Hu,r.eK=function(c,i,a,h,m,x,_,A,P,N,V,H,G,Y,J,oe){var ue=new w(16);return ue[0]=c,ue[1]=i,ue[2]=a,ue[3]=h,ue[4]=m,ue[5]=x,ue[6]=_,ue[7]=A,ue[8]=P,ue[9]=N,ue[10]=V,ue[11]=H,ue[12]=G,ue[13]=Y,ue[14]=J,ue[15]=oe,ue},r.eL=$,r.eM=pm,r.eN=Wf,r.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ht(1/0,1/0),max:new Ht(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const a=E4(new Ht(0,0),new Ht(xn,xn),c),h=[];if(i&&!h3(a,this._globalClipBounds))return h;for(const m of this._activeRegions){if(m.hiddenByOverlap||!h3(a,m))continue;const x=fX(m.min,m.max,c);h.push({min:x.min,max:x.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return h}setSources(c){this._setSources(c.map((i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const h of i.cache.getVisibleCoordinates()){const m=i.cache.getTile(h).buckets[i.layer];m&&m.updateFootprints(h.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope}))))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const a=c.getOrder(),h=c.getClipMask(),m=c.getClipScope();for(const x of i){if(!x.footprint)continue;const _=E4(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:a,clipMask:h,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort(((i,a)=>i.priority-a.priority||B2(i.min,a.min)||B2(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||(function(h,m){const x=(_,A)=>_+A;return h.length-m.length||h.reduce(x,"").localeCompare(m.reduce(x,""))})(i.clipScope,a.clipScope)));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const a=this._activeRegions[i],h=this._prevRegions[i];c=a.priority!==h.priority||!T4(a,h)||a.order!==h.order||a.clipMask!==h.clipMask||!cs(a.clipScope,h.clipScope),this._activeRegions[i].hiddenByOverlap=h.hiddenByOverlap,++i}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==zb&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const h=this._activeRegions;if(a>=h.length)return a;const m=h[a].priority;for(;a<h.length&&h[a].priority===m;)++a;return a};if(this._sourceIds.length>1){let a=0,h=i(a);for(;a!==h;){let m=a;const x=a;for(;m!==h;){const _=this._activeRegions[m];_.hiddenByOverlap=!1;for(let A=0;A<x;A++){const P=this._activeRegions[A];if(!P.hiddenByOverlap&&_.order===zb&&h3(_,P)&&(_.hiddenByOverlap=A4(_.footprint,_.tileId,P.footprint,P.tileId),_.hiddenByOverlap))break}++m}a=h,h=i(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},r.eP=zb,r.eQ=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const a=new $a,h=new ys,m=[],x=c+1+2,_=i[0]+1,A=i[0]+1+(1+i.length),P=(N,V,H)=>{let G=N===x-1?N-2:N===0?N:N-1;return G+=H?24575:0,[G,V]};for(let N=0;N<x;++N)a.emplaceBack(...P(N,0,!0));for(let N=0;N<_;++N)for(let V=0;V<x;++V)a.emplaceBack(...P(V,N,(V===0||V===x-1)&&!0));for(let N=0;N<i.length;++N){const V=i[N];for(let H=0;H<x;++H)a.emplaceBack(...P(H,V,!0))}for(let N=0;N<i.length;++N){const V=h.length,H=i[N]+1+2,G=new ys;for(let oe=0;oe<H-1;oe++){const ue=oe===H-2,pe=ue?x*(A-i.length+N-oe):x;for(let we=0;we<x-1;we++){const Te=oe*x+we;oe===0||ue||we===0||we===x-2?(G.emplaceBack(Te+1,Te,Te+pe),G.emplaceBack(Te+pe,Te+pe+1,Te+1)):(h.emplaceBack(Te+1,Te,Te+pe),h.emplaceBack(Te+pe,Te+pe+1,Te+1))}}const Y=Li.simpleSegment(0,V,a.length,h.length-V);for(let oe=0;oe<G.uint16.length;oe+=3)h.emplaceBack(G.uint16[oe],G.uint16[oe+1],G.uint16[oe+2]);const J=Li.simpleSegment(0,V,a.length,h.length-V);m.push({withoutSkirts:Y,withSkirts:J})}return{vertices:a,indices:h,segments:m}}_createGrid(c){const i=this._fillGridMeshWithLods(y,S);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,Tn.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new ys;for(let _=0;_<=y;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const a=new Vd,h=new Vd,m=new Vd,x=new Vd;this._poleSegments=[];for(let _=0,A=0;_<g;_++){const P=360/(1<<_);a.emplaceBack(0,-Ls,0,.5,0),h.emplaceBack(0,-Ls,0,.5,1),m.emplaceBack(0,-Ls,0,.5,.5),x.emplaceBack(0,-Ls,0,.5,.5);for(let N=0;N<=y;N++){let V=N/y,H=0;const G=Ar(0,P,V),[Y,J,oe]=j(Lq,Oq,G,Ls);a.emplaceBack(Y,J,oe,V,H),h.emplaceBack(Y,J,oe,V,1-H);const ue=Qr(G);V=.5+.5*Math.sin(ue),H=.5+.5*Math.cos(ue),m.emplaceBack(Y,J,oe,V,H),x.emplaceBack(Y,J,oe,V,1-H)}this._poleSegments.push(Li.simpleSegment(A,0,66,64)),A+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,xt,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(h,xt,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,xt,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(x,xt,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},r.eR=w4,r.eS=ut,r.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eU=me,r.eV=De,r.eW=function(c,i,a){return c[0]=i[0]/a[0],c[1]=i[1]/a[1],c[2]=i[2]/a[2],c},r.eX=Nn,r.eY=z,r.eZ=vt,r.e_=$e,r.ea=U4,r.eb=e0,r.ec=P4,r.ed=I4,r.ee=ze,r.ef=function(c,i){if(c===i){var a=i[1],h=i[2],m=i[3],x=i[6],_=i[7],A=i[11];c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=a,c[6]=i[9],c[7]=i[13],c[8]=h,c[9]=x,c[11]=i[14],c[12]=m,c[13]=_,c[14]=A}else c[0]=i[0],c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=i[1],c[5]=i[5],c[6]=i[9],c[7]=i[13],c[8]=i[2],c[9]=i[6],c[10]=i[10],c[11]=i[14],c[12]=i[3],c[13]=i[7],c[14]=i[11],c[15]=i[15];return c},r.eg=cQ,r.eh=di,r.ei=mm,r.ej=256,r.ek=ia,r.el=Wa,r.em=te,r.en=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[4],c[4]=i[5],c[5]=i[6],c[6]=i[8],c[7]=i[9],c[8]=i[10],c},r.eo=Vd,r.ep=fm,r.eq=hl,r.er=function(c,i,a,h,m){return ve((c-i)/(a-i)*(m-h)+h,h,m)},r.es=rn,r.et=function(c,i){var a=i[0],h=i[1],m=i[2],x=i[3],_=i[4],A=i[5],P=i[6],N=i[7],V=i[8],H=V*_-A*N,G=-V*x+A*P,Y=N*x-_*P,J=a*H+h*G+m*Y;return J?(c[0]=H*(J=1/J),c[1]=(-V*h+m*N)*J,c[2]=(A*h-m*_)*J,c[3]=G*J,c[4]=(V*a-m*P)*J,c[5]=(-A*a+m*x)*J,c[6]=Y*J,c[7]=(-N*a+h*P)*J,c[8]=(_*a-h*x)*J,c):null},r.eu=2,r.ev=qt,r.ew=Bt,r.ex=ce,r.ey=function(c,i){var a=new w(3);ce(a,i);var h=1/a[0],m=1/a[1],x=1/a[2],_=i[0]*h,A=i[1]*m,P=i[2]*x,N=i[4]*h,V=i[5]*m,H=i[6]*x,G=i[8]*h,Y=i[9]*m,J=i[10]*x,oe=_+V+J,ue=0;return oe>0?(ue=2*Math.sqrt(oe+1),c[3]=.25*ue,c[0]=(H-Y)/ue,c[1]=(G-P)/ue,c[2]=(A-N)/ue):_>V&&_>J?(ue=2*Math.sqrt(1+_-V-J),c[3]=(H-Y)/ue,c[0]=.25*ue,c[1]=(A+N)/ue,c[2]=(G+P)/ue):V>J?(ue=2*Math.sqrt(1+V-_-J),c[3]=(G-P)/ue,c[0]=(A+N)/ue,c[1]=.25*ue,c[2]=(H+Y)/ue):(ue=2*Math.sqrt(1+J-_-V),c[3]=(A-N)/ue,c[0]=(G+P)/ue,c[1]=(H+Y)/ue,c[2]=.25*ue),c},r.ez=function(c,i){var a=2*Math.acos(i[3]),h=Math.sin(a/2);return h>v?(c[0]=i[0]/h,c[1]=i[1]/h,c[2]=i[2]/h):(c[0]=1,c[1]=0,c[2]=0),a},r.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,((i,a)=>String.fromCharCode(+("0x"+a)))))},r.f0=et,r.f1=C3,r.f2=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!(function(a){if(jr==null){const h=a.navigator?a.navigator.userAgent:null;jr=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return jr})(c)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f3=function(c,i){il=c,ca=i},r.f4=r3,r.f5=qN,r.f6=function(c){const i=[0,0,0],a=F(new Float64Array(16));return X(a,c.pixelMatrix,c.globeMatrix),Un(i,i,a),new Ht(i[0],i[1])},r.f7=function(){const c=Wb;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(_3),Wb=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f8=function(){G2().acquire(_3)},r.f9=Uo,r.fA=Jt,r.fB=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==i6){const a=new Uint32Array(c,0,7),[,,h,m,x,_]=a;i=a.byteLength+m+x+_+x,(h!==c.byteLength||i>=c.byteLength)&&It("Invalid b3dm header information.")}return l6(c,i)},r.fC=function(c,i){const a=R3(c);for(const h of a){for(const m of h.meshes)GX(m);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push($X(h.lights,i)))}return a},r.fD=yS,r.fE=xr,r.fF=J4,r.fG=na,r.fH=Ta,r.fI=function(c){Qc(),ua!=null&&ua.then((i=>{i.keys().then((a=>{for(let h=0;h<a.length-c;h++)i.delete(a[h]).catch((m=>It(m.message)))})).catch((a=>It(a.message)))})).catch((i=>It(i.message)))},r.fa=function(c,i,a=!1){if($o===Ta.deferred||$o===Ta.loading||$o===Ta.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");lu=eo.resolveURL(c),$o=Ta.deferred,sm=i,uo(),a||Vf()},r.fb=function(c){x_=eo.resolveURL(c),__||(__=new y_(G2(),new Jc)),__.broadcast("setMeshoptUrl",x_)},r.fc=n6,r.fd=function(c){b3=eo.resolveURL(c),__||(__=new y_(G2(),new Jc)),__.broadcast("setDracoUrl",b3)},r.fe=t6,r.ff=$b,r.fg=function(c){const i=mc();if(!i)return;const a=i.delete(Zc);c&&a.then((()=>c())).catch(c)},r.fh=My,r.fi=Fn,r.fj=Jg,r.fk=Qh,r.fl=SD,r.fm=TD,r.fn=T6,r.fo=Cn,r.fp="hd_road_elevation",r.fq=Pr,r.fr=un,r.fs=xm,r.ft=H3,r.fu=Py,r.fv=function(c,i,a,h,m,x,_,A=1,P,N,V){c.createArrays(),c.tilePixelRatio=xn/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const H=c.layers[0].layout,G=c.layers[0]._unevaluatedLayout._values,Y={};Y.scaleFactor=A,Y.textSizeScaleRange=H.get("text-size-scale-range"),Y.iconSizeScaleRange=H.get("icon-size-scale-range");const[J,oe]=Y.textSizeScaleRange,[ue,pe]=Y.iconSizeScaleRange;Y.textScaleFactor=ve(Y.scaleFactor,J,oe),Y.iconScaleFactor=ve(Y.scaleFactor,ue,pe);const we=G["text-size"],Te=G["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:ot,maxZoom:Ot}=c.textSizeData;Y.compositeTextSizes=[we.possiblyEvaluate(new rs(ot,{worldview:V}),x),we.possiblyEvaluate(new rs(Ot,{worldview:V}),x)]}if(c.iconSizeData.kind==="composite"){const{minZoom:ot,maxZoom:Ot}=c.iconSizeData;Y.compositeIconSizes=[Te.possiblyEvaluate(new rs(ot,{worldview:V}),x),Te.possiblyEvaluate(new rs(Ot,{worldview:V}),x)]}Y.layoutTextSize=we.possiblyEvaluate(new rs(_+1,{worldview:V}),x),Y.layoutIconSize=Te.possiblyEvaluate(new rs(_+1,{worldview:V}),x),Y.textMaxSize=we.possiblyEvaluate(new rs(18,{worldview:V}),x);const Ie=H.get("symbol-placement"),Ze=H.get("text-rotation-alignment")==="map"&&Ie!=="point",Ve=H.get("text-size");let Ye=!1;const nt=[];for(const ot of c.features){const Ot=H.get("text-font").evaluate(ot,{},x).join(","),pt=Ve.evaluate(ot,{},x)*Y.textScaleFactor,Ut=Y.layoutTextSize.evaluate(ot,{},x)*Y.textScaleFactor,Zt=Y.layoutIconSize.evaluate(ot,{},x)*Y.iconScaleFactor,en={horizontal:{},vertical:void 0},vn=ot.text;let an,Qt=[0,0];if(vn){const fi=vn.toString(),Pi=H.get("text-letter-spacing").evaluate(ot,{},x)*sa,Wr=H.get("text-line-height").evaluate(ot,{},x)*sa,Vi=zf(fi)?Pi:0,Hi=H.get("text-anchor").evaluate(ot,{},x),Ds=H.get("text-variable-anchor");if(!Ds){const Wt=H.get("text-radial-offset").evaluate(ot,{},x);if(Wt)Qt=aj(Hi,[Wt*sa,W3]);else{const kn=H.get("text-offset").evaluate(ot,{},x);Qt=[kn[0]*sa,kn[1]*sa]}}let Ge=Ze?"center":H.get("text-justify").evaluate(ot,{},x);const Be=Ie==="point",$t=Be?H.get("text-max-width").evaluate(ot,{},x)*sa:1/0,An=Wt=>{c.allowVerticalPlacement&&Nh(fi)&&(en.vertical=B3(vn,i,a,m,Ot,$t,Wr,Hi,Wt,Vi,Qt,Rc.vertical,!0,Ut,pt,P))};if(!Ze&&Ds){const Wt=Ge==="auto"?Ds.map((rr=>q3(rr))):[Ge];let kn=!1;for(let rr=0;rr<Wt.length;rr++){const tr=Wt[rr];if(!en.horizontal[tr])if(kn)en.horizontal[tr]=en.horizontal[0];else{const Jr=B3(vn,i,a,m,Ot,$t,Wr,"center",tr,Vi,Qt,Rc.horizontal,!1,Ut,pt,P);Jr&&(en.horizontal[tr]=Jr,kn=Jr.positionedLines.length===1)}}An("left")}else{if(Ge==="auto"&&(Ge=q3(Hi)),Be||H.get("text-writing-mode").indexOf("horizontal")>=0||!Nh(fi)){const Wt=B3(vn,i,a,m,Ot,$t,Wr,Hi,Ge,Vi,Qt,Rc.horizontal,!1,Ut,pt,P);Wt&&(en.horizontal[Ge]=Wt)}An(Be?"left":Ge)}}let sn,jt,Rt,nn,gn,Yt,zn=!1;const Zn=H.get("icon-text-fit").evaluate(ot,{},x);if(ot.icon&&ot.icon.hasPrimary()){const fi=n1(ot.icon,c.iconSizeData,G["icon-size"],x,c.zoom,ot,P,Y.iconScaleFactor,V);sn=fi.iconPrimary,Rt=fi.iconSecondary;const Pi=sn.toString();if(jt=h.get(Pi),jt&&(gn=H.get("icon-offset").evaluate(ot,{},x),Yt=H.get("icon-anchor").evaluate(ot,{},x),an=nS(m.get(Pi),Rt?m.get(Rt.toString()):void 0,gn,Yt),zn=jt.sdf,c.sdfIcons===void 0?c.sdfIcons=jt.sdf:c.sdfIcons!==jt.sdf&&It("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(jt.pixelRatio!==c.pixelRatio||H.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),Rt){const Wr=Rt.toString();nn=h.get(Wr)}}Ye=Ye||!(!ot.icon||!ot.icon.hasSecondary());const jn=X3(en.horizontal)||en.vertical;c.iconsInText||(c.iconsInText=!!jn&&jn.iconsInText);const Mn=Ut*Y.textScaleFactor/sa,{defaultShapedIcon:Fr,verticallyShapedIcon:Rn}=ZZ(c,an,H,ot,x,en,Mn,gn,Zn);Zn!=="none"&&an&&(W6(an)||q6(an))&&(aS(0,jt,sn,an,Fr,Zn,N,h,m),aS(0,nn,Rt,an,Fr,Zn,N,h,m),Rn&&(aS(0,jt,sn,an,Rn,Zn,N,h,m),aS(0,nn,Rt,an,Rn,Zn,N,h,m))),an=Fr;const{iconBBox:br,iconVerticalBBox:Ur}=WZ(c,an,Rn,H,ot,x,Zt,gn,Y,m,Yt);nt.push({feature:ot,shapedTextOrientations:en,shapedText:jn,shapedIcon:an,iconPrimary:sn,iconSecondary:Rt,iconOffset:gn,iconAnchor:Yt,verticallyShapedIcon:Rn,layoutTextSize:Ut,layoutIconSize:Zt,textOffset:Qt,isSDFIcon:zn,iconTextFit:Zn,iconCollisionBounds:br,iconVerticalCollisionBounds:Ur})}return{featureData:nt,sizes:Y,hasAnySecondaryIcon:Ye,textAlongLine:Ze,symbolPlacement:Ie}},r.fw=tj,r.fx=function(c,i,a,h,m,x,_,A,P,N){c.iconAtlasPositions=N.iconPositions;const{featureData:V,hasAnySecondaryIcon:H,sizes:G,textAlongLine:Y,symbolPlacement:J}=i;for(const oe of V){const{shapedIcon:ue,verticallyShapedIcon:pe,feature:we,shapedTextOrientations:Te,shapedText:Ie,layoutTextSize:Ze,textOffset:Ve,isSDFIcon:Ye,iconPrimary:nt,iconSecondary:ot,iconTextFit:Ot,iconOffset:pt,iconCollisionBounds:Ut,iconVerticalCollisionBounds:Zt}=oe;cj(ue,N.iconPositions,nt,ot),cj(pe,N.iconPositions,nt,ot),XZ(Te,N.iconPositions),qZ(nt,ot,N.iconPositions),(Ie||ue)&&QZ(c,we,Te,ue,pe,P,G,Ze,0,Ve,Ye,h,m,_,A,H,Ot,pt,Y,J,Ut,Zt)}a&&c.generateCollisionDebugBuffers(x,c.collisionBoxArray,G.textScaleFactor)},r.fy=$n,r.fz=SS,r.g=function(c,i){return xd(Object.assign(c,{method:"GET"}),i)},r.h=function(c){return c.indexOf("mapbox:")===0},r.i=function(c){return ii.API_STYLE_REGEX.test(c)&&!Qi(c)},r.j=Or,r.k=yc,r.l=function(c){return decodeURIComponent(atob(c).split("").map((i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2))).join(""))},r.m=function(c,i){return xd(Object.assign(c,{type:"json"}),i)},r.n=gf,r.o=eo,r.p=function(c,i){return xd(Object.assign(c,{method:"POST"}),i)},r.q=Ca,r.r=Is,r.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return v3||(v3=new My),v3},r.u=function(){return(function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)})()},r.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},r.w=It,r.x=uC,r.y=yf,r.z=wa})),u(["./shared"],(function(r){function v(ut){const me=ut?ut.url.toString():void 0;return me?performance.getEntriesByName(me):[]}function w(ut){if(typeof ut=="number"||typeof ut=="boolean"||typeof ut=="string"||ut==null)return JSON.stringify(ut);if(Array.isArray(ut)){let ve="[";for(const Fe of ut)ve+=`${w(Fe)},`;return`${ve}]`}let me="{";for(const ve of Object.keys(ut).sort())me+=`${ve}:${w(ut[ve])},`;return`${me}}`}function E(ut){let me="";for(const ve of r.bw)me+=`/${w(ut[ve])}`;return me}class T{constructor(me){this.keyCache={},this._layers={},this._layerConfigs={},me&&this.replace(me)}replace(me,ve){this._layerConfigs={},this._layers={},this.update(me,[],ve)}update(me,ve,Fe){this._options=Fe;for(const Je of me)this._layerConfigs[Je.id]=Je,(this._layers[Je.id]=r.dt(Je,this.scope,null,this._options)).compileFilter(Fe),this.keyCache[Je.id]&&delete this.keyCache[Je.id];for(const Je of ve)delete this.keyCache[Je],delete this._layerConfigs[Je],delete this._layers[Je];this.familiesBySource={};const tt=(function(Je,at){const Pt={};for(let Ct=0;Ct<Je.length;Ct++){const un=Je[Ct];let tn=at&&at[un.id];tn||(un.type==="symbol"?tn=un.id:(tn=E(un),un.type==="line"&&un.paint&&(function gt(wt){return typeof wt=="string"&&wt==="line-progress"||(Array.isArray(wt)?wt.some(gt):!(!wt||typeof wt!="object")&&Object.values(wt).some(gt))})(un.paint["line-width"])&&(tn+=`/${w(un.paint["line-width"])}`))),at&&(at[un.id]=tn);let Re=Pt[tn];Re||(Re=Pt[tn]=[]),Re.push(un)}const ct=[];for(const Ct in Pt)ct.push(Pt[Ct]);return ct})(Object.values(this._layerConfigs),this.keyCache);for(const Je of tt){const at=Je.map((Re=>this._layers[Re.id])),Pt=at[0];if(Pt.visibility==="none")continue;const ct=Pt.source||"";let Ct=this.familiesBySource[ct];Ct||(Ct=this.familiesBySource[ct]={});const un=Pt.sourceLayer||"_geojsonTileLayer";let tn=Ct[un];tn||(tn=Ct[un]=[]),tn.push(at)}}}const k=1*r.fk;class R{constructor(me){const ve={},Fe=[];for(const Pt in me){const ct=me[Pt],Ct=ve[Pt]={};for(const un in ct.glyphs){const tn=ct.glyphs[+un];if(!tn||tn.bitmap.width===0||tn.bitmap.height===0)continue;const Re=tn.metrics.localGlyph?k:1,gt={x:0,y:0,w:tn.bitmap.width+2*Re,h:tn.bitmap.height+2*Re};Fe.push(gt),Ct[un]=gt}}const{w:tt,h:Je}=r.G(Fe),at=new r.fj({width:tt||1,height:Je||1});for(const Pt in me){const ct=me[Pt];for(const Ct in ct.glyphs){const un=ct.glyphs[+Ct];if(!un||un.bitmap.width===0||un.bitmap.height===0)continue;const tn=ve[Pt][Ct],Re=un.metrics.localGlyph?k:1;r.fj.copy(un.bitmap,at,{x:0,y:0},{x:tn.x+Re,y:tn.y+Re},un.bitmap)}}this.image=at,this.positions=ve}}function D(ut,me,ve){ut[me]?ve&&(ut[me].center=ve):ut[me]={floorIds:new Set,center:ve||[0,0],floors:{}}}function O(ut,me,ve,Fe){for(const tt of me)D(ut,tt),ut[tt].floors[ve]=Fe,ut[tt].floorIds.add(ve)}function F(ut){return{id:ut.properties.id.toString(),center:ut.properties.center.toString().split(";").map(Number)}}function U(ut){return{id:ut.properties.id.toString(),isDefault:!!ut.properties.is_default&&ut.properties.is_default,connections:ut.properties.connected_floor_ids?new Set(ut.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ut.properties.conflicted_floor_ids?new Set(ut.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ut.properties.building_ids?new Set(ut.properties.building_ids.toString().split(";")):new Set,name:ut.properties.name.toString(),zIndex:ut.properties.z_index}}function X(ut,me){return me.every((ve=>ut.properties&&ut.properties[ve]!=null))}function W(ut){return X(ut,["type","id","name"])&&ut.properties.type==="building"}function K(ut){return X(ut,["type","id","name","z_index"])&&ut.properties.type==="floor"}r.fi(R,"GlyphAtlas");class ne{constructor(me){this.tileID=new r.aP(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.lut=me.lut,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.scope=me.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=me.showCollisionBoxes,this.collectResourceTiming=!!me.request&&me.request.collectResourceTiming,this.promoteId=me.promoteId,this.isSymbolTile=me.isSymbolTile,this.tileTransform=r.aY(me.tileID.canonical,me.projection),this.projection=me.projection,this.worldview=me.worldview,this.localizableLayerIds=me.localizableLayerIds,this.brightness=me.brightness,this.extraShadowCaster=!!me.extraShadowCaster,this.tessellationStep=me.tessellationStep,this.scaleFactor=me.scaleFactor,this.worldview=me.worldview,this.indoor=me.indoor}parse(me,ve,Fe,tt,Je,at){this.status="parsing",this.data=me,this.collisionBoxArray=new r.b2;const Pt=new r.fl(Object.keys(me.layers).sort()),ct=new r.fm(this.tileID,this.promoteId);ct.bucketLayerIDs=[];const Ct={},un=new r.fn(256,256),tn={featureIndex:ct,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:un,availableImages:Fe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const It=this.indoor.indoorState.activeFloorsVisible,Et=(function(Sn,Hn,xr){const vr=(function(fr,ur){if(!fr)return r.w("No source layers defined in indoor specification"),ur;if(fr.size===0)return ur;const ai=fr.difference(ur);for(const vi of ai)r.w(`Missing source layer required in indoor specification: ${vi}`);return ur.intersection(ur)})(Hn.sourceLayers,new Set(Object.keys(Sn.layers))),jr=Hn.indoorState,Er=(function(fr,ur,ai,vi){const li=new Set,ii=new Set,Or=new Set,Qi=new Map,Ni={},ko=Gs=>{const Zs=Qi.get(Gs)||new Set;for(const mo of li)if((Qi.get(mo)||new Set).has(Gs)||Zs.has(mo))return!0;return!1};for(const Gs of ur){const Zs=fr.layers[Gs];if(Zs)for(let mo=0;mo<Zs.length;mo++){const ds=Zs.feature(mo);if(W(ds)){const{id:Is,center:eo}=F(ds);D(Ni,Is,eo),li.add(Is)}else if(K(ds)){const{id:Is,isDefault:eo,connections:wo,conflicts:ji,buildings:Zc,name:il,zIndex:ca}=U(ds);O(Ni,Zc,Is,{name:il,zIndex:ca}),Qi.set(Is,ji),(Is===vi||wo.has(vi))&&li.add(Is),ii.add(Is),eo&&Or.add(Is)}}else r.w(`indoor source layer not found: ${Gs}`)}if(ai)for(const Gs of ai)ii.has(Gs)&&(ko(Gs)||li.add(Gs));for(const Gs of Or)li.has(Gs)||ko(Gs)||li.add(Gs);return{buildings:Ni,activeFloors:li}})(Sn,vr,jr.lastActiveFloors,jr.selectedFloorId);return xr.send("setIndoorData",Er),Er})(me,this.indoor,Je);tn.activeFloors=It?Et.activeFloors:void 0}const Re=[],gt=ve.familiesBySource[this.source];for(const It in gt){const Et=me.layers[It];if(!Et)continue;let Sn=!1,Hn=!1,xr=!1;for(const fr of gt[It])fr[0].type==="symbol"?Sn=!0:Hn=!0,fr[0].is3D()&&fr[0].type!=="model"&&(xr=!0);if(this.extraShadowCaster&&!xr||this.isSymbolTile===!0&&!Sn||this.isSymbolTile===!1&&!Hn)continue;Et.version===1&&r.w(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vr=Pt.encode(It),jr=[];let Er=!1;for(let fr=0,ur=0;fr<Et.length;fr++){const ai=Et.feature(fr),vi=ct.getId(ai,It);if(this.localizableLayerIds&&this.localizableLayerIds.has(It)){const li=ai.properties?ai.properties.worldview:null;if(this.worldview&&typeof li=="string")if(li==="all")ai.properties.$localized=!0;else{if(!li.split(",").includes(this.worldview))continue;ai.properties.$localized=!0,ai.properties.worldview=this.worldview}}!Er&&ai.properties&&ai.properties.hasOwnProperty(r.fo)&&(Er=!0),jr.push({feature:ai,id:vi,index:ur,sourceLayerIndex:vr}),ur++}Er&&!tn.elevationFeatures&&me.layers.hasOwnProperty(r.fp)&&(tn.elevationFeatures=r.fq.parseFrom(me.layers[r.fp],this.canonical));for(const fr of gt[It]){const ur=fr[0];if(this.extraShadowCaster&&(!ur.is3D()||ur.type==="model")||this.isSymbolTile!==void 0&&ur.type==="symbol"!==this.isSymbolTile||ur.minzoom&&this.zoom<Math.floor(ur.minzoom)||ur.maxzoom&&this.zoom>=ur.maxzoom||ur.visibility==="none")continue;te(fr,this.zoom,tn.brightness,Fe,this.worldview);const ai=Ct[ur.id]=ur.createBucket({index:ct.bucketLayerIDs.length,layers:fr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:tt,worldview:this.worldview});ct.bucketLayerIDs.push(fr.map((li=>r.B(li.id,li.scope))));let vi=ai.prepare?ai.prepare():null;vi!=null?(vi=vi.then((()=>ai.populate(jr,tn,this.tileID.canonical,this.tileTransform))),Re.push(vi)):ai.populate(jr,tn,this.tileID.canonical,this.tileTransform)}}const wt=()=>{let It,Et,Sn,Hn,xr,vr;un.trim();const jr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Er=()=>{if(It)return this.status="done",at(It);if(this.extraShadowCaster)this.status="done",at(null,{buckets:Object.values(Ct).filter((ur=>!ur.isEmpty())),featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:tn.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Et&&Sn&&Hn){const ur=new R(Et),ai=new Map;for(const[ii,Or]of Sn.entries()){const{imagePosition:Qi}=r.ft(ii,Or,r.fu);ai.set(ii,Qi)}const vi={};for(const ii in Ct){const Or=Ct[ii];Or instanceof r.b3&&(te(Or.layers,this.zoom,tn.brightness,Fe,this.worldview),vi[ii]=r.fv(Or,Et,ur.positions,Sn,ai,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,xr,this.worldview))}const li={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Je,Sn,xr,(()=>{li.iconsPending=!1,fr(vi,ur,li)})),this.rasterizeIfNeeded(Je,Hn,vr,(()=>{li.patternsPending=!1,fr(vi,ur,li)}))}},fr=(ur,ai,vi,li)=>{if(vi.iconsPending||vi.patternsPending)return;const ii=new r.fw(Sn,Hn,this.lut);for(const Or in Ct){const Qi=Ct[Or];if(Or in ur)r.fx(Qi,ur[Or],this.showCollisionBoxes,Fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Sn,ii);else if(Qi.hasPattern&&(Qi instanceof r.b9||Qi instanceof r.ba||Qi instanceof r.e9)){te(Qi.layers,this.zoom,tn.brightness,Fe,this.worldview);const Ni=Object.fromEntries(ii.patternPositions);Qi.addFeatures(tn,this.tileID.canonical,Ni,Fe,this.tileTransform,this.brightness)}}this.status="done",at(null,{buckets:Object.values(Ct).filter((Or=>!Or.isEmpty())),featureIndex:ct,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,lineAtlas:un,imageAtlas:ii,brightness:tn.brightness})};if(!this.extraShadowCaster){const ur=r.fr(tn.glyphDependencies,(li=>Object.keys(li).map(Number)));Object.keys(ur).length?Je.send("getGlyphs",{uid:this.uid,stacks:ur},((li,ii)=>{It||(It=li,Et=ii,Er())}),void 0,!1,jr):Et={};const ai=Array.from(tn.iconDependencies.keys()).map((li=>r.I.parse(li)));ai.length?Je.send("getImages",{images:ai,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((li,ii)=>{It||(It=li,Sn=new Map,xr=this.updateImageMapAndGetImageTaskQueue(Sn,ii,tn.iconDependencies),Er())}),void 0,!1,jr):(Sn=new Map,xr=new Map);const vi=Array.from(tn.patternDependencies.keys()).map((li=>r.I.parse(li)));vi.length?Je.send("getImages",{images:vi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((li,ii)=>{It||(It=li,Hn=new Map,vr=this.updateImageMapAndGetImageTaskQueue(Hn,ii,tn.patternDependencies),Er())}),void 0,!1,jr):(Hn=new Map,vr=new Map)}if(tn.elevationFeatures&&tn.elevationFeatures.length>0){const ur=[];for(const vi of Object.values(Ct))if(vi instanceof r.ba){const li=vi.getUnevaluatedPortalGraph();li&&ur.push(li)}const ai=r.fs.evaluate(ur);for(const vi of Object.values(Ct))if(vi instanceof r.ba){const li=me.layers[Pt.decode(vi.sourceLayerIndex)];vi.setEvaluatedPortalGraph(ai,li,this.tileID.canonical,tn.availableImages,tn.brightness)}}Er()};Re.length>0?Promise.allSettled(Re).then(wt).catch(at):wt()}updateParameters(me){this.scaleFactor=me.scaleFactor,this.showCollisionBoxes=me.showCollisionBoxes,this.projection=me.projection,this.brightness=me.brightness,this.tileTransform=r.aY(me.tileID.canonical,me.projection),this.extraShadowCaster=me.extraShadowCaster,this.lut=me.lut,this.worldview=me.worldview,this.indoor=me.indoor}rasterizeIfNeeded(me,ve,Fe,tt){Array.from(ve.values()).some((Je=>Je.usvg))?this.rasterize(me,ve,Fe,tt):tt()}updateImageMapAndGetImageTaskQueue(me,ve,Fe){const tt=new Map;for(const Je of ve.keys()){const at=Fe.get(Je)||[];for(const Pt of at){const ct=Pt.toString(),Ct=ve.get(Pt.id.toString());Ct.usvg?tt.has(ct)||(tt.set(ct,Pt),me.set(ct,Object.assign({},Ct))):me.set(ct,Ct)}}return tt}rasterize(me,ve,Fe,tt){this.rasterizeTask=me.send("rasterizeImages",{scope:this.scope,tasks:Fe},((Je,at)=>{if(!Je)for(const[Pt,ct]of at.entries()){const Ct=Object.assign(ve.get(Pt),{data:ct});ve.set(Pt,Ct)}tt()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function te(ut,me,ve,Fe,tt){const Je=new r.ac(me,{brightness:ve,worldview:tt});for(const at of ut)at.recalculate(Je,Fe)}class re extends r.E{constructor(me,ve,Fe,tt,Je,at,Pt){super(),this.actor=me,this.layerIndex=ve,this.availableImages=Fe,this.availableModels=tt,this.loadVectorData=at||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(me.scheduler),this.isSpriteLoaded=Je,this.scheduler=me.scheduler,this.brightness=Pt}loadTile(me,ve){const Fe=me.uid,tt=me&&me.request,Je=tt&&tt.collectResourceTiming,at=this.loading[Fe]=new ne(me);at.abort=this.loadVectorData(me,((Pt,ct)=>{const Ct=!this.loading[Fe];if(delete this.loading[Fe],at.cancelRasterize(),Ct||Pt||!ct)return at.status="done",Ct||(this.loaded[Fe]=at),ve(Pt);const un=ct.rawData,tn={},Re=r.aM(ct.responseHeaders);Re&&Re.expires&&(tn.expires=Re.expires),Re&&Re.cacheControl&&(tn.cacheControl=Re.cacheControl),at.vectorTile=ct.vectorTile||new r.fy(new r.bs(un));const gt=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((wt,It)=>{if(wt||!It)return ve(wt);const Et={};if(Je){const Sn=v(tt);Sn.length>0&&(Et.resourceTiming=JSON.parse(JSON.stringify(Sn)))}ve(null,Object.assign({rawTileData:un.slice(0),responseHeaders:ct.responseHeaders},It,tn,Et))}))};this.isSpriteLoaded?gt():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(gt,{type:"parseTile",isSymbolTile:me.isSymbolTile,zoom:me.tileZoom}):gt()})),this.loaded=this.loaded||{},this.loaded[Fe]=at}))}reloadTile(me,ve){const Fe=this.loaded,tt=me.uid;if(Fe&&Fe[tt]){const Je=Fe[tt];Je.updateParameters(me);const at=(Pt,ct)=>{const Ct=Je.reloadCallback;Ct&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ct)),ve(Pt,ct)};Je.status==="parsing"?Je.reloadCallback=at:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at):at())}else ve(null,void 0)}abortTile(me,ve){const Fe=me.uid,tt=this.loading[Fe];tt&&(tt.abort&&tt.abort(),delete this.loading[Fe]),ve()}removeTile(me,ve){const Fe=this.loaded,tt=me.uid;Fe&&Fe[tt]&&delete Fe[tt],ve()}}class xe{loadTile(me,ve){const{uid:Fe,encoding:tt,rawImageData:Je,padding:at}=me,Pt=ImageBitmap&&Je instanceof ImageBitmap?this.getImageData(Je,at):Je;ve(null,new r.fz(Fe,Pt,tt,at<1))}reloadTile(me,ve){ve(null,null)}abortTile(me,ve){ve()}removeTile(me,ve){ve()}getImageData(me,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(me.width,me.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=me.width,this.offscreenCanvas.height=me.height,this.offscreenCanvasContext.drawImage(me,0,0,me.width,me.height);const Fe=this.offscreenCanvasContext.getImageData(-ve,-ve,me.width+2*ve,me.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Fe}}r.br.setPbf(r.bs);class ae{constructor(me){this._mrt=new r.br(me.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=me.uid,this.tileID=me.tileID,this.source=me.source}parse(me,ve){const Fe=this._mrt;this.status="parsing",this._entireBuffer=me;try{Fe.parseHeader(me),this._isHeaderLoaded=!0;const tt=[];for(const Je in Fe.layers){const at=Fe.getLayer(Je),Pt=at.getDataRange(at.getBandList()),ct=Fe.createDecodingTask(Pt),Ct=me.slice(Pt.firstByte,Pt.lastByte+1),un=r.br.performDecoding(Ct,ct).then((tn=>ct.complete(null,tn))).catch((tn=>ct.complete(tn,null)));tt.push(un)}Promise.allSettled(tt).then((()=>ve(null,Fe))).catch((Je=>ve(Je)))}catch(tt){ve(tt)}}}class ce{constructor(me){this.actor=me,this.loading={},this.loaded={}}loadTile(me,ve){const Fe=me.uid,tt=me.request,Je=this.loading[Fe]=new ae(me),{cancel:at}=r.bt(tt,((Pt,ct,Ct)=>{const un=!this.loading[Fe];if(delete this.loading[Fe],un||Pt||!ct)return Je.status="done",un||(this.loaded[Fe]=Je),ve(Pt);Je.parse(ct,((tn,Re)=>{if(tn||!Re)return ve(tn);ve(null,Re,Ct)})),this.loaded[Fe]=Je}));Je.abort=at}reloadTile(me,ve){ve(null,void 0)}abortTile(me,ve){const Fe=me.uid,tt=this.loading[Fe];tt&&(tt.abort&&tt.abort(),delete this.loading[Fe]),ve()}removeTile(me,ve){const Fe=me.uid;this.loaded[Fe]&&delete this.loaded[Fe],ve()}decodeRasterArray(me,ve){r.br.performDecoding(me.buffer,me.task).then((Fe=>ve(null,Fe))).catch((Fe=>ve(Fe)))}}const ye=r.fA.prototype.toGeoJSON;class Ce{constructor(me){this._feature=me,this.extent=r.al,this.type=me.type,this.properties=me.tags,"id"in me&&!isNaN(me.id)&&(this.id=parseInt(me.id,10))}loadGeometry(){if(this._feature.type===1){const me=[];for(const ve of this._feature.geometry)me.push([new r.P(ve[0],ve[1])]);return me}{const me=[];for(const ve of this._feature.geometry){const Fe=[];for(const tt of ve)Fe.push(new r.P(tt[0],tt[1]));me.push(Fe)}return me}}toGeoJSON(me,ve,Fe){return ye.call(this,me,ve,Fe)}}class Me{constructor(me,ve){this.name=me,this.extent=r.al,this.length=ve.length,this._jsonFeatures=ve}feature(me){return new Ce(this._jsonFeatures[me])}}class Ke{constructor(me){this.layers={},this.extent=r.al;for(const ve of Object.keys(me))this.layers[ve]=new Me(ve,me[ve])}}const ke=64/4096,je=128;class $e{constructor(){this.features=new Map}clear(){this.features.clear()}load(me=[],ve){for(const Fe of me){const tt=Fe.id;if(tt==null)continue;let Je=this.features.get(tt);Je&&this.updateCache(Je,ve),Fe.geometry?(Je=He(Fe),this.updateCache(Je,ve),this.features.set(tt,Je)):this.features.delete(tt),this.updateCache(Je,ve)}}updateCache(me,ve){for(const{canonical:Fe,uid:tt}of Object.values(ve)){const{z:Je,x:at,y:Pt}=Fe;Ae(me,Math.pow(2,Je),at,Pt)&&delete ve[tt]}}getTile(me,ve,Fe){const tt=Math.pow(2,me),Je=[];for(const at of this.features.values())Ae(at,tt,ve,Fe)&&Je.push(bt(at,tt,ve,Fe));return{features:Je}}getFeatures(){return[...this.features.values()]}}function Ae({minX:ut,minY:me,maxX:ve,maxY:Fe},tt,Je,at){return ut<(Je+1+ke)/tt&&me<(at+1+ke)/tt&&ve>(Je-ke)/tt&&Fe>(at-ke)/tt}function He(ut){const{id:me,geometry:ve,properties:Fe}=ut;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:tt,coordinates:Je}=ve,at={id:me,type:1,geometry:[],tags:Fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Pt=at.geometry;if(tt==="Point")qe(Je,Pt,at);else if(tt==="MultiPoint")for(const ct of Je)qe(ct,Pt,at);else if(tt==="LineString")at.type=2,Le(Je,Pt,at);else if(tt==="MultiLineString")at.type=2,st(Je,Pt,at);else if(tt==="Polygon")at.type=3,st(Je,Pt,at,!0);else{if(tt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const ct of Je)st(ct,Pt,at,!0)}return at}function qe([ut,me],ve,Fe){const tt=r.aF(ut);let Je=r.aJ(me);Je=Je<0?0:Je>1?1:Je,ve.push(tt,Je),Fe.minX=Math.min(Fe.minX,tt),Fe.minY=Math.min(Fe.minY,Je),Fe.maxX=Math.max(Fe.maxX,tt),Fe.maxY=Math.max(Fe.maxY,Je)}function Le(ut,me,ve,Fe=!1,tt=!1){const Je=[];for(const at of ut)qe(at,Je,ve);me.push(Je),Fe&&(function(at,Pt){let ct=0;for(let Ct=0,un=at.length,tn=un-2;Ct<un;tn=Ct,Ct+=2)ct+=(at[Ct]-at[tn])*(at[Ct+1]+at[tn+1]);if(ct>0===Pt)for(let Ct=0,un=at.length;Ct<un/2;Ct+=2){const tn=at[Ct],Re=at[Ct+1];at[Ct]=at[un-2-Ct],at[Ct+1]=at[un-1-Ct],at[un-2-Ct]=tn,at[un-1-Ct]=Re}})(Je,tt)}function st(ut,me,ve,Fe=!1){for(let tt=0;tt<ut.length;tt++)Le(ut[tt],me,ve,Fe,tt===0)}function bt(ut,me,ve,Fe){const{id:tt,type:Je,geometry:at,tags:Pt}=ut,ct=[];if(Je===1)(function(Ct,un,tn,Re,gt){for(let wt=0;wt<Ct.length;wt+=2){const It=Math.round(r.al*(Ct[wt+0]*un-tn)),Et=Math.round(r.al*(Ct[wt+1]*un-Re));gt.push([It,Et])}})(at,me,ve,Fe,ct);else for(const Ct of at)yt(Ct,me,ve,Fe,ct);return{id:tt,type:Je,geometry:ct,tags:Pt}}function yt(ut,me,ve,Fe,tt){const Je=-je,at=r.al+je;let Pt;for(let ct=0;ct<ut.length-2;ct+=2){let Ct=Math.round(r.al*(ut[ct+0]*me-ve)),un=Math.round(r.al*(ut[ct+1]*me-Fe)),tn=Math.round(r.al*(ut[ct+2]*me-ve)),Re=Math.round(r.al*(ut[ct+3]*me-Fe));const gt=tn-Ct,wt=Re-un;Ct<Je&&tn<Je||(Ct<Je?(un+=Math.round(wt*((Je-Ct)/gt)),Ct=Je):tn<Je&&(Re=un+Math.round(wt*((Je-Ct)/gt)),tn=Je),un<Je&&Re<Je||(un<Je?(Ct+=Math.round(gt*((Je-un)/wt)),un=Je):Re<Je&&(tn=Ct+Math.round(gt*((Je-un)/wt)),Re=Je),Ct>=at&&tn>=at||(Ct>=at?(un+=Math.round(wt*((at-Ct)/gt)),Ct=at):tn>=at&&(Re=un+Math.round(wt*((at-Ct)/gt)),tn=at),un>=at&&Re>=at||(un>=at?(Ct+=Math.round(gt*((at-un)/wt)),un=at):Re>=at&&(tn=Ct+Math.round(gt*((at-un)/wt)),Re=at),Pt&&Ct===Pt[Pt.length-1][0]&&un===Pt[Pt.length-1][1]||(Pt=[[Ct,un]],tt.push(Pt)),Pt.push([tn,Re])))))}}function Vt({name:ut,features:me},ve){ve.writeStringField(1,ut),ve.writeVarintField(5,r.al);const Fe=new Map,tt=new Map,Je={keys:Fe,values:tt,feature:null};for(const at of me)Je.feature=at,ve.writeMessage(2,_t,Je);for(const at of Fe.keys())ve.writeStringField(3,at);for(const at of tt.keys())ve.writeMessage(4,mn,at)}function _t(ut,me){const ve=ut.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&me.writeVarintField(1,+ve.id),ve.tags&&me.writeMessage(2,vt,ut),me.writeVarintField(3,ve.type),me.writeMessage(4,on,ve)}function vt({keys:ut,values:me,feature:ve},Fe){for(const tt of Object.keys(ve.tags)){let Je=ve.tags[tt];if(Je===null)continue;let at=ut.get(tt);at===void 0&&(at=ut.size,ut.set(tt,at)),Fe.writeVarint(at);const Pt=typeof Je;Pt!=="string"&&Pt!=="boolean"&&Pt!=="number"&&(Je=JSON.stringify(Je));let ct=me.get(Je);ct===void 0&&(ct=me.size,me.set(Je,ct)),Fe.writeVarint(ct)}}function qt(ut,me){return(me<<3)+(7&ut)}function kt(ut){return ut<<1^ut>>31}function on(ut,me){const{geometry:ve,type:Fe}=ut;let tt=0,Je=0;if(Fe===1){me.writeVarint(qt(1,ve.length));for(const at of ve){const Pt=at[0]-tt,ct=at[1]-Je;me.writeVarint(kt(Pt)),me.writeVarint(kt(ct)),tt+=Pt,Je+=ct}}else for(const at of ve){me.writeVarint(qt(1,1));const Pt=at.length-(Fe===3?1:0);for(let ct=0;ct<Pt;ct++){ct===1&&me.writeVarint(qt(2,Pt-1));const Ct=at[ct][0]-tt,un=at[ct][1]-Je;me.writeVarint(kt(Ct)),me.writeVarint(kt(un)),tt+=Ct,Je+=un}Fe===3&&me.writeVarint(qt(7,1))}}function mn(ut,me){const ve=typeof ut;ve==="string"?me.writeStringField(1,ut):ve==="boolean"?me.writeBooleanField(7,ut):ve==="number"&&(ut%1!=0?me.writeDoubleField(3,ut):ut<0?me.writeSVarintField(6,ut):me.writeVarintField(5,ut))}const Hr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ut=>ut},Un=Math.fround||($r=new Float32Array(1),ut=>($r[0]=+ut,$r[0]));var $r;const ht=3,Lr=5,Br=6;class wn{constructor(me){this.options=Object.assign(Object.create(Hr),me),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(me){const{log:ve,minZoom:Fe,maxZoom:tt}=this.options;ve&&console.time("total time");const Je=`prepare ${me.length} points`;ve&&console.time(Je),this.points=me;const at=[];for(let ct=0;ct<me.length;ct++){const Ct=me[ct];if(!Ct.geometry)continue;const[un,tn]=Ct.geometry.coordinates,Re=Un(Qn(un)),gt=Un(Nt(tn));at.push(Re,gt,1/0,ct,-1,1),this.options.reduce&&at.push(0)}let Pt=this.trees[tt+1]=this._createTree(at);ve&&console.timeEnd(Je);for(let ct=tt;ct>=Fe;ct--){const Ct=+Date.now();Pt=this.trees[ct]=this._createTree(this._cluster(Pt,ct)),ve&&console.log("z%d: %d clusters in %dms",ct,Pt.numItems,+Date.now()-Ct)}return ve&&console.timeEnd("total time"),this}getClusters(me,ve){let Fe=((me[0]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,me[1]));let Je=me[2]===180?180:((me[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,me[3]));if(me[2]-me[0]>=360)Fe=-180,Je=180;else if(Fe>Je){const tn=this.getClusters([Fe,tt,180,at],ve),Re=this.getClusters([-180,tt,Je,at],ve);return tn.concat(Re)}const Pt=this.trees[this._limitZoom(ve)],ct=Pt.range(Qn(Fe),Nt(at),Qn(Je),Nt(tt)),Ct=Pt.data,un=[];for(const tn of ct){const Re=this.stride*tn;un.push(Ct[Re+Lr]>1?Nn(Ct,Re,this.clusterProps):this.points[Ct[Re+ht]])}return un}getChildren(me){const ve=this._getOriginId(me),Fe=this._getOriginZoom(me),tt="No cluster with the specified id.",Je=this.trees[Fe];if(!Je)throw new Error(tt);const at=Je.data;if(ve*this.stride>=at.length)throw new Error(tt);const Pt=this.options.radius/(this.options.extent*Math.pow(2,Fe-1)),ct=Je.within(at[ve*this.stride],at[ve*this.stride+1],Pt),Ct=[];for(const un of ct){const tn=un*this.stride;at[tn+4]===me&&Ct.push(at[tn+Lr]>1?Nn(at,tn,this.clusterProps):this.points[at[tn+ht]])}if(Ct.length===0)throw new Error(tt);return Ct}getLeaves(me,ve,Fe){const tt=[];return this._appendLeaves(tt,me,ve=ve||10,Fe=Fe||0,0),tt}getTile(me,ve,Fe){const tt=this.trees[this._limitZoom(me)],Je=Math.pow(2,me),{extent:at,radius:Pt}=this.options,ct=Pt/at,Ct=(Fe-ct)/Je,un=(Fe+1+ct)/Je,tn={features:[]};return this._addTileFeatures(tt.range((ve-ct)/Je,Ct,(ve+1+ct)/Je,un),tt.data,ve,Fe,Je,tn),ve===0&&this._addTileFeatures(tt.range(1-ct/Je,Ct,1,un),tt.data,Je,Fe,Je,tn),ve===Je-1&&this._addTileFeatures(tt.range(0,Ct,ct/Je,un),tt.data,-1,Fe,Je,tn),tn.features.length?tn:null}getClusterExpansionZoom(me){let ve=this._getOriginZoom(me)-1;for(;ve<=this.options.maxZoom;){const Fe=this.getChildren(me);if(ve++,Fe.length!==1)break;me=Fe[0].properties.cluster_id}return ve}_appendLeaves(me,ve,Fe,tt,Je){const at=this.getChildren(ve);for(const Pt of at){const ct=Pt.properties;if(ct&&ct.cluster?Je+ct.point_count<=tt?Je+=ct.point_count:Je=this._appendLeaves(me,ct.cluster_id,Fe,tt,Je):Je<tt?Je++:me.push(Pt),me.length===Fe)break}return Je}_createTree(me){const ve=new r.c3(me.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Fe=0;Fe<me.length;Fe+=this.stride)ve.add(me[Fe],me[Fe+1]);return ve.finish(),ve.data=me,ve}_addTileFeatures(me,ve,Fe,tt,Je,at){for(const Pt of me){const ct=Pt*this.stride,Ct=ve[ct+Lr]>1;let un,tn,Re;if(Ct)un=mr(ve,ct,this.clusterProps),tn=ve[ct],Re=ve[ct+1];else{const It=this.points[ve[ct+ht]];un=It.properties;const[Et,Sn]=It.geometry.coordinates;tn=Qn(Et),Re=Nt(Sn)}const gt={type:1,geometry:[[Math.round(this.options.extent*(tn*Je-Fe)),Math.round(this.options.extent*(Re*Je-tt))]],tags:un};let wt;wt=Ct||this.options.generateId?ve[ct+ht]:this.points[ve[ct+ht]].id,wt!==void 0&&(gt.id=wt),at.features.push(gt)}}_limitZoom(me){return Math.max(this.options.minZoom,Math.min(Math.floor(+me),this.options.maxZoom+1))}_cluster(me,ve){const{radius:Fe,extent:tt,reduce:Je,minPoints:at}=this.options,Pt=Fe/(tt*Math.pow(2,ve)),ct=me.data,Ct=[],un=this.stride;for(let tn=0;tn<ct.length;tn+=un){if(ct[tn+2]<=ve)continue;ct[tn+2]=ve;const Re=ct[tn],gt=ct[tn+1],wt=me.within(ct[tn],ct[tn+1],Pt),It=ct[tn+Lr];let Et=It;for(const Sn of wt){const Hn=Sn*un;ct[Hn+2]>ve&&(Et+=ct[Hn+Lr])}if(Et>It&&Et>=at){let Sn,Hn=Re*It,xr=gt*It,vr=-1;const jr=(tn/un<<5)+(ve+1)+this.points.length;for(const Er of wt){const fr=Er*un;if(ct[fr+2]<=ve)continue;ct[fr+2]=ve;const ur=ct[fr+Lr];Hn+=ct[fr]*ur,xr+=ct[fr+1]*ur,ct[fr+4]=jr,Je&&(Sn||(Sn=this._map(ct,tn,!0),vr=this.clusterProps.length,this.clusterProps.push(Sn)),Je(Sn,this._map(ct,fr)))}ct[tn+4]=jr,Ct.push(Hn/Et,xr/Et,1/0,jr,-1,Et),Je&&Ct.push(vr)}else{for(let Sn=0;Sn<un;Sn++)Ct.push(ct[tn+Sn]);if(Et>1)for(const Sn of wt){const Hn=Sn*un;if(!(ct[Hn+2]<=ve)){ct[Hn+2]=ve;for(let xr=0;xr<un;xr++)Ct.push(ct[Hn+xr])}}}}return Ct}_getOriginId(me){return me-this.points.length>>5}_getOriginZoom(me){return(me-this.points.length)%32}_map(me,ve,Fe){if(me[ve+Lr]>1){const at=this.clusterProps[me[ve+Br]];return Fe?Object.assign({},at):at}const tt=this.points[me[ve+ht]].properties,Je=this.options.map(tt);return Fe&&Je===tt?Object.assign({},Je):Je}}function Nn(ut,me,ve){return{type:"Feature",id:ut[me+ht],properties:mr(ut,me,ve),geometry:{type:"Point",coordinates:[(Fe=ut[me],360*(Fe-.5)),et(ut[me+1])]}};var Fe}function mr(ut,me,ve){const Fe=ut[me+Lr],tt=Fe>=1e4?`${Math.round(Fe/1e3)}k`:Fe>=1e3?Math.round(Fe/100)/10+"k":Fe,Je=ut[me+Br],at=Je===-1?{}:Object.assign({},ve[Je]);return Object.assign(at,{cluster:!0,cluster_id:ut[me+ht],point_count:Fe,point_count_abbreviated:tt})}function Qn(ut){return ut/360+.5}function Nt(ut){const me=Math.sin(ut*Math.PI/180),ve=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return ve<0?0:ve>1?1:ve}function et(ut){const me=(180-360*ut)*Math.PI/180;return 360*Math.atan(Math.exp(me))/Math.PI-90}function Oe(ut,me,ve,Fe){let tt=Fe;const Je=me+(ve-me>>1);let at,Pt=ve-me;const ct=ut[me],Ct=ut[me+1],un=ut[ve],tn=ut[ve+1];for(let Re=me+3;Re<ve;Re+=3){const gt=Bt(ut[Re],ut[Re+1],ct,Ct,un,tn);if(gt>tt)at=Re,tt=gt;else if(gt===tt){const wt=Math.abs(Re-Je);wt<Pt&&(at=Re,Pt=wt)}}tt>Fe&&(at-me>3&&Oe(ut,me,at,Fe),ut[at+2]=tt,ve-at>3&&Oe(ut,at,ve,Fe))}function Bt(ut,me,ve,Fe,tt,Je){let at=tt-ve,Pt=Je-Fe;if(at!==0||Pt!==0){const ct=((ut-ve)*at+(me-Fe)*Pt)/(at*at+Pt*Pt);ct>1?(ve=tt,Fe=Je):ct>0&&(ve+=at*ct,Fe+=Pt*ct)}return at=ut-ve,Pt=me-Fe,at*at+Pt*Pt}function En(ut,me,ve,Fe){const tt={id:ut??null,type:me,geometry:ve,tags:Fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(me==="Point"||me==="MultiPoint"||me==="LineString")Dn(tt,ve);else if(me==="Polygon")Dn(tt,ve[0]);else if(me==="MultiLineString")for(const Je of ve)Dn(tt,Je);else if(me==="MultiPolygon")for(const Je of ve)Dn(tt,Je[0]);return tt}function Dn(ut,me){for(let ve=0;ve<me.length;ve+=3)ut.minX=Math.min(ut.minX,me[ve]),ut.minY=Math.min(ut.minY,me[ve+1]),ut.maxX=Math.max(ut.maxX,me[ve]),ut.maxY=Math.max(ut.maxY,me[ve+1])}function rn(ut,me,ve,Fe){if(!me.geometry)return;const tt=me.geometry.coordinates;if(tt&&tt.length===0)return;const Je=me.geometry.type,at=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let Pt=[],ct=me.id;if(ve.promoteId?ct=me.properties[ve.promoteId]:ve.generateId&&(ct=Fe||0),Je==="Point")wr(tt,Pt);else if(Je==="MultiPoint")for(const Ct of tt)wr(Ct,Pt);else if(Je==="LineString")cr(tt,Pt,at,!1);else if(Je==="MultiLineString"){if(ve.lineMetrics){for(const Ct of tt)Pt=[],cr(Ct,Pt,at,!1),ut.push(En(ct,"LineString",Pt,me.properties));return}Jn(tt,Pt,at,!1)}else if(Je==="Polygon")Jn(tt,Pt,at,!0);else{if(Je!=="MultiPolygon"){if(Je==="GeometryCollection"){for(const Ct of me.geometry.geometries)rn(ut,{id:ct,geometry:Ct,properties:me.properties},ve,Fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ct of tt){const un=[];Jn(Ct,un,at,!0),Pt.push(un)}}ut.push(En(ct,Je,Pt,me.properties))}function wr(ut,me){me.push(ir(ut[0]),bn(ut[1]),0)}function cr(ut,me,ve,Fe){let tt,Je,at=0;for(let ct=0;ct<ut.length;ct++){const Ct=ir(ut[ct][0]),un=bn(ut[ct][1]);me.push(Ct,un,0),ct>0&&(at+=Fe?(tt*un-Ct*Je)/2:Math.sqrt(Math.pow(Ct-tt,2)+Math.pow(un-Je,2))),tt=Ct,Je=un}const Pt=me.length-3;me[2]=1,Oe(me,0,Pt,ve),me[Pt+2]=1,me.size=Math.abs(at),me.start=0,me.end=me.size}function Jn(ut,me,ve,Fe){for(let tt=0;tt<ut.length;tt++){const Je=[];cr(ut[tt],Je,ve,Fe),me.push(Je)}}function ir(ut){return ut/360+.5}function bn(ut){const me=Math.sin(ut*Math.PI/180),ve=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return ve<0?0:ve>1?1:ve}function In(ut,me,ve,Fe,tt,Je,at,Pt){if(Fe/=me,Je>=(ve/=me)&&at<Fe)return ut;if(at<ve||Je>=Fe)return null;const ct=[];for(const Ct of ut){const un=Ct.geometry;let tn=Ct.type;const Re=tt===0?Ct.minX:Ct.minY,gt=tt===0?Ct.maxX:Ct.maxY;if(Re>=ve&&gt<Fe){ct.push(Ct);continue}if(gt<ve||Re>=Fe)continue;let wt=[];if(tn==="Point"||tn==="MultiPoint")Zr(un,wt,ve,Fe,tt);else if(tn==="LineString")Vr(un,wt,ve,Fe,tt,!1,Pt.lineMetrics);else if(tn==="MultiLineString")Kn(un,wt,ve,Fe,tt,!1);else if(tn==="Polygon")Kn(un,wt,ve,Fe,tt,!0);else if(tn==="MultiPolygon")for(const It of un){const Et=[];Kn(It,Et,ve,Fe,tt,!0),Et.length&&wt.push(Et)}if(wt.length){if(Pt.lineMetrics&&tn==="LineString"){for(const It of wt)ct.push(En(Ct.id,tn,It,Ct.tags));continue}tn!=="LineString"&&tn!=="MultiLineString"||(wt.length===1?(tn="LineString",wt=wt[0]):tn="MultiLineString"),tn!=="Point"&&tn!=="MultiPoint"||(tn=wt.length===3?"Point":"MultiPoint"),ct.push(En(Ct.id,tn,wt,Ct.tags))}}return ct.length?ct:null}function Zr(ut,me,ve,Fe,tt){for(let Je=0;Je<ut.length;Je+=3){const at=ut[Je+tt];at>=ve&&at<=Fe&&St(me,ut[Je],ut[Je+1],ut[Je+2])}}function Vr(ut,me,ve,Fe,tt,Je,at){let Pt=qn(ut);const ct=tt===0?Gn:er;let Ct,un,tn=ut.start;for(let Et=0;Et<ut.length-3;Et+=3){const Sn=ut[Et],Hn=ut[Et+1],xr=ut[Et+2],vr=ut[Et+3],jr=ut[Et+4],Er=tt===0?Sn:Hn,fr=tt===0?vr:jr;let ur=!1;at&&(Ct=Math.sqrt(Math.pow(Sn-vr,2)+Math.pow(Hn-jr,2))),Er<ve?fr>ve&&(un=ct(Pt,Sn,Hn,vr,jr,ve),at&&(Pt.start=tn+Ct*un)):Er>Fe?fr<Fe&&(un=ct(Pt,Sn,Hn,vr,jr,Fe),at&&(Pt.start=tn+Ct*un)):St(Pt,Sn,Hn,xr),fr<ve&&Er>=ve&&(un=ct(Pt,Sn,Hn,vr,jr,ve),ur=!0),fr>Fe&&Er<=Fe&&(un=ct(Pt,Sn,Hn,vr,jr,Fe),ur=!0),!Je&&ur&&(at&&(Pt.end=tn+Ct*un),me.push(Pt),Pt=qn(ut)),at&&(tn+=Ct)}let Re=ut.length-3;const gt=ut[Re],wt=ut[Re+1],It=tt===0?gt:wt;It>=ve&&It<=Fe&&St(Pt,gt,wt,ut[Re+2]),Re=Pt.length-3,Je&&Re>=3&&(Pt[Re]!==Pt[0]||Pt[Re+1]!==Pt[1])&&St(Pt,Pt[0],Pt[1],Pt[2]),Pt.length&&me.push(Pt)}function qn(ut){const me=[];return me.size=ut.size,me.start=ut.start,me.end=ut.end,me}function Kn(ut,me,ve,Fe,tt,Je){for(const at of ut)Vr(at,me,ve,Fe,tt,Je,!1)}function St(ut,me,ve,Fe){ut.push(me,ve,Fe)}function Gn(ut,me,ve,Fe,tt,Je){const at=(Je-me)/(Fe-me);return St(ut,Je,ve+(tt-ve)*at,1),at}function er(ut,me,ve,Fe,tt,Je){const at=(Je-ve)/(tt-ve);return St(ut,me+(Fe-me)*at,Je,1),at}function gr(ut,me){const ve=[];for(let Fe=0;Fe<ut.length;Fe++){const tt=ut[Fe],Je=tt.type;let at;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")at=nr(tt.geometry,me);else if(Je==="MultiLineString"||Je==="Polygon"){at=[];for(const Pt of tt.geometry)at.push(nr(Pt,me))}else if(Je==="MultiPolygon"){at=[];for(const Pt of tt.geometry){const ct=[];for(const Ct of Pt)ct.push(nr(Ct,me));at.push(ct)}}ve.push(En(tt.id,Je,at,tt.tags))}return ve}function nr(ut,me){const ve=[];ve.size=ut.size,ut.start!==void 0&&(ve.start=ut.start,ve.end=ut.end);for(let Fe=0;Fe<ut.length;Fe+=3)ve.push(ut[Fe]+me,ut[Fe+1],ut[Fe+2]);return ve}function ln(ut,me){if(ut.transformed)return ut;const ve=1<<ut.z,Fe=ut.x,tt=ut.y;for(const Je of ut.features){const at=Je.geometry,Pt=Je.type;if(Je.geometry=[],Pt===1)for(let ct=0;ct<at.length;ct+=2)Je.geometry.push(Tr(at[ct],at[ct+1],me,ve,Fe,tt));else for(let ct=0;ct<at.length;ct++){const Ct=[];for(let un=0;un<at[ct].length;un+=2)Ct.push(Tr(at[ct][un],at[ct][un+1],me,ve,Fe,tt));Je.geometry.push(Ct)}}return ut.transformed=!0,ut}function Tr(ut,me,ve,Fe,tt,Je){return[Math.round(ve*(ut*Fe-tt)),Math.round(ve*(me*Fe-Je))]}function ni(ut,me,ve,Fe,tt){const Je=me===tt.maxZoom?0:tt.tolerance/((1<<me)*tt.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:ut.length,source:null,x:ve,y:Fe,z:me,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Pt of ut)Yi(at,Pt,Je,tt);return at}function Yi(ut,me,ve,Fe){const tt=me.geometry,Je=me.type,at=[];if(ut.minX=Math.min(ut.minX,me.minX),ut.minY=Math.min(ut.minY,me.minY),ut.maxX=Math.max(ut.maxX,me.maxX),ut.maxY=Math.max(ut.maxY,me.maxY),Je==="Point"||Je==="MultiPoint")for(let Pt=0;Pt<tt.length;Pt+=3)at.push(tt[Pt],tt[Pt+1]),ut.numPoints++,ut.numSimplified++;else if(Je==="LineString")ns(at,tt,ut,ve,!1,!1);else if(Je==="MultiLineString"||Je==="Polygon")for(let Pt=0;Pt<tt.length;Pt++)ns(at,tt[Pt],ut,ve,Je==="Polygon",Pt===0);else if(Je==="MultiPolygon")for(let Pt=0;Pt<tt.length;Pt++){const ct=tt[Pt];for(let Ct=0;Ct<ct.length;Ct++)ns(at,ct[Ct],ut,ve,!0,Ct===0)}if(at.length){let Pt=me.tags||null;if(Je==="LineString"&&Fe.lineMetrics){Pt={};for(const Ct in me.tags)Pt[Ct]=me.tags[Ct];Pt.mapbox_clip_start=tt.start/tt.size,Pt.mapbox_clip_end=tt.end/tt.size}const ct={geometry:at,type:Je==="Polygon"||Je==="MultiPolygon"?3:Je==="LineString"||Je==="MultiLineString"?2:1,tags:Pt};me.id!==null&&(ct.id=me.id),ut.features.push(ct)}}function ns(ut,me,ve,Fe,tt,Je){const at=Fe*Fe;if(Fe>0&&me.size<(tt?at:Fe))return void(ve.numPoints+=me.length/3);const Pt=[];for(let ct=0;ct<me.length;ct+=3)(Fe===0||me[ct+2]>at)&&(ve.numSimplified++,Pt.push(me[ct],me[ct+1])),ve.numPoints++;tt&&(function(ct,Ct){let un=0;for(let tn=0,Re=ct.length,gt=Re-2;tn<Re;gt=tn,tn+=2)un+=(ct[tn]-ct[gt])*(ct[tn+1]+ct[gt+1]);if(un>0===Ct)for(let tn=0,Re=ct.length;tn<Re/2;tn+=2){const gt=ct[tn],wt=ct[tn+1];ct[tn]=ct[Re-2-tn],ct[tn+1]=ct[Re-1-tn],ct[Re-2-tn]=gt,ct[Re-1-tn]=wt}})(Pt,Je),ut.push(Pt)}const Ht={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class cs{constructor(me,ve){const Fe=(ve=this.options=(function(Je,at){for(const Pt in at)Je[Pt]=at[Pt];return Je})(Object.create(Ht),ve)).debug;if(Fe&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let tt=(function(Je,at){const Pt=[];if(Je.type==="FeatureCollection")for(let ct=0;ct<Je.features.length;ct++)rn(Pt,Je.features[ct],at,ct);else rn(Pt,Je.type==="Feature"?Je:{geometry:Je},at);return Pt})(me,ve);this.tiles={},this.tileCoords=[],Fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),tt=(function(Je,at){const Pt=at.buffer/at.extent;let ct=Je;const Ct=In(Je,1,-1-Pt,Pt,0,-1,2,at),un=In(Je,1,1-Pt,2+Pt,0,-1,2,at);return(Ct||un)&&(ct=In(Je,1,-Pt,1+Pt,0,-1,2,at)||[],Ct&&(ct=gr(Ct,1).concat(ct)),un&&(ct=ct.concat(gr(un,-1)))),ct})(tt,ve),tt.length&&this.splitTile(tt,0,0,0),Fe&&(tt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(me,ve,Fe,tt,Je,at,Pt){const ct=[me,ve,Fe,tt],Ct=this.options,un=Ct.debug;for(;ct.length;){tt=ct.pop(),Fe=ct.pop(),ve=ct.pop(),me=ct.pop();const tn=1<<ve,Re=rl(ve,Fe,tt);let gt=this.tiles[Re];if(!gt&&(un>1&&console.time("creation"),gt=this.tiles[Re]=ni(me,ve,Fe,tt,Ct),this.tileCoords.push({z:ve,x:Fe,y:tt}),un)){un>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,Fe,tt,gt.numFeatures,gt.numPoints,gt.numSimplified),console.timeEnd("creation"));const ur=`z${ve}`;this.stats[ur]=(this.stats[ur]||0)+1,this.total++}if(gt.source=me,Je==null){if(ve===Ct.indexMaxZoom||gt.numPoints<=Ct.indexMaxPoints)continue}else{if(ve===Ct.maxZoom||ve===Je)continue;if(Je!=null){const ur=Je-ve;if(Fe!==at>>ur||tt!==Pt>>ur)continue}}if(gt.source=null,me.length===0)continue;un>1&&console.time("clipping");const wt=.5*Ct.buffer/Ct.extent,It=.5-wt,Et=.5+wt,Sn=1+wt;let Hn=null,xr=null,vr=null,jr=null,Er=In(me,tn,Fe-wt,Fe+Et,0,gt.minX,gt.maxX,Ct),fr=In(me,tn,Fe+It,Fe+Sn,0,gt.minX,gt.maxX,Ct);me=null,Er&&(Hn=In(Er,tn,tt-wt,tt+Et,1,gt.minY,gt.maxY,Ct),xr=In(Er,tn,tt+It,tt+Sn,1,gt.minY,gt.maxY,Ct),Er=null),fr&&(vr=In(fr,tn,tt-wt,tt+Et,1,gt.minY,gt.maxY,Ct),jr=In(fr,tn,tt+It,tt+Sn,1,gt.minY,gt.maxY,Ct),fr=null),un>1&&console.timeEnd("clipping"),ct.push(Hn||[],ve+1,2*Fe,2*tt),ct.push(xr||[],ve+1,2*Fe,2*tt+1),ct.push(vr||[],ve+1,2*Fe+1,2*tt),ct.push(jr||[],ve+1,2*Fe+1,2*tt+1)}}getTile(me,ve,Fe){me=+me,ve=+ve,Fe=+Fe;const tt=this.options,{extent:Je,debug:at}=tt;if(me<0||me>24)return null;const Pt=1<<me,ct=rl(me,ve=ve+Pt&Pt-1,Fe);if(this.tiles[ct])return ln(this.tiles[ct],Je);at>1&&console.log("drilling down to z%d-%d-%d",me,ve,Fe);let Ct,un=me,tn=ve,Re=Fe;for(;!Ct&&un>0;)un--,tn>>=1,Re>>=1,Ct=this.tiles[rl(un,tn,Re)];return Ct&&Ct.source?(at>1&&(console.log("found parent tile z%d-%d-%d",un,tn,Re),console.time("drilling down")),this.splitTile(Ct.source,un,tn,Re,me,ve,Fe),at>1&&console.timeEnd("drilling down"),this.tiles[ct]?ln(this.tiles[ct],Je):null):null}}function rl(ut,me,ve){return 32*((1<<ut)*ve+me)+ut}function ho(ut,me){const ve=ut.tileID.canonical;if(!this._geoJSONIndex)return void me(null,null);const Fe=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Fe)return void me(null,null);const tt=Ct=>Ct.tags&&"3d_elevation_id"in Ct.tags&&"source"in Ct.tags&&Ct.tags.source==="elevation",Je=Fe.features.filter((Ct=>tt(Ct)));let at={_geojsonTileLayer:Fe.features};Je.length>0&&(at={_geojsonTileLayer:Fe.features.filter((Ct=>!tt(Ct))),hd_road_elevation:Je});const Pt=new Ke(at),ct=(function(Ct){const un=new r.bs;for(const tn of Object.keys(Ct))un.writeMessage(3,Vt,{name:tn,features:Ct[tn]});return un.finish()})(at).buffer;me(null,{vectorTile:Pt,rawData:ct})}class Qr extends re{constructor(me,ve,Fe,tt,Je,at,Pt){super(me,ve,Fe,tt,Je,ho,Pt),at&&(this.loadGeoJSON=at),this._dynamicIndex=new $e}loadData(me,ve){const Fe=me&&me.request,tt=Fe&&Fe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(me,((Je,at)=>{if(Je||!at)return ve(Je);if(typeof at!="object")return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));{try{if(me.filter){const ct=r.U(me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ct.result==="error")throw new Error(ct.value.map((Ct=>`${Ct.key}: ${Ct.message}`)).join(", "));at.features=at.features.filter((Ct=>ct.value.evaluate({zoom:0},Ct)))}me.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),me.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),me.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=me.cluster?new wn((function({superclusterOptions:ct,clusterProperties:Ct}){if(!Ct||!ct)return ct;const un={},tn={},Re={accumulated:null,zoom:0},gt={properties:null},wt=Object.keys(Ct);for(const It of wt){const[Et,Sn]=Ct[It],Hn=r.U(Sn),xr=r.U(typeof Et=="string"?[Et,["accumulated"],["get",It]]:Et);un[It]=Hn.value,tn[It]=xr.value}return ct.map=It=>{gt.properties=It;const Et={};for(const Sn of wt)Et[Sn]=un[Sn].evaluate(Re,gt);return Et},ct.reduce=(It,Et)=>{gt.properties=Et;for(const Sn of wt)Re.accumulated=It[Sn],It[Sn]=tn[Sn].evaluate(Re,gt)},ct})(me)).load(at.features):me.dynamic?this._dynamicIndex:(function(ct,Ct){return new cs(ct,Ct)})(at,me.geojsonVtOptions)}catch(ct){return ve(ct)}const Pt={};if(tt){const ct=v(Fe);ct&&(Pt.resourceTiming={},Pt.resourceTiming[me.source]=JSON.parse(JSON.stringify(ct)))}ve(null,Pt)}}))}reloadTile(me,ve){const Fe=this.loaded;return Fe&&Fe[me.uid]?me.partial?ve(null,void 0):super.reloadTile(me,ve):this.loadTile(me,ve)}loadGeoJSON(me,ve){if(me.request)r.m(me.request,ve);else{if(typeof me.data!="string")return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ve(null,JSON.parse(me.data))}catch{return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(me,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(Fe){ve(Fe)}}getClusterChildren(me,ve){try{ve(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(Fe){ve(Fe)}}getClusterLeaves(me,ve){try{ve(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(Fe){ve(Fe)}}}class Rs{constructor(me,ve,Fe){this.tileID=new r.aP(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=me.projection,this.brightness=ve,this.worldview=Fe}parse(me,ve,Fe,tt){this.status="parsing";const Je=new r.aP(Fe.tileID.overscaledZ,Fe.tileID.wrap,Fe.tileID.canonical.z,Fe.tileID.canonical.x,Fe.tileID.canonical.y),at=[],Pt=ve.familiesBySource[Fe.source],ct=new r.fm(Je,Fe.promoteId);ct.bucketLayerIDs=[],ct.is3DTile=!0,r.fB(me).then((Ct=>{if(!Ct)return tt(new Error("Could not parse tile"));const un=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ct.json.asset.extras&&Ct.json.asset.extras.MAPBOX_mesh_features,tn=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("EXT_meshopt_compression"),Re=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const gt in Pt)for(const wt of Pt[gt]){const It=wt[0];ct.bucketLayerIDs.push(wt.map((Hn=>r.B(Hn.id,Hn.scope)))),It.recalculate(Re,[]);const Et=r.fC(Ct,1/r.d6(Fe.tileID.canonical)),Sn=new r.fD(wt,Et,Je,un,tn,this.brightness,ct,this.worldview);un||(Sn.needsUpload=!0),at.push(Sn),Sn.evaluate(It)}this.status="done",tt(null,{buckets:at,featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Ct=>tt(new Error(Ct.message))))}}class ea{constructor(me,ve,Fe,tt,Je,at,Pt,ct){this.actor=me,this.layerIndex=ve,this.availableImages=Fe,this.availableModels=tt,this.brightness=Pt,this.loading={},this.loaded={},this.worldview=ct}loadTile(me,ve){const Fe=me.uid,tt=this.loading[Fe]=new Rs(me,this.brightness,this.worldview);r.bt(me.request,((Je,at)=>{const Pt=!this.loading[Fe];return delete this.loading[Fe],Pt||Je?(tt.status="done",Pt||(this.loaded[Fe]=tt),ve(Je)):at&&at.byteLength!==0?void tt.parse(at,this.layerIndex,me,((ct,Ct)=>{tt.status="done",this.loaded=this.loaded||{},this.loaded[Fe]=tt,ct||!Ct?ve(ct):ve(null,Ct)})):(tt.status="done",this.loaded[Fe]=tt,ve())}))}reloadTile(me,ve){const Fe=this.loaded,tt=me.uid;if(Fe&&Fe[tt]){const Je=Fe[tt];Je.projection=me.projection,Je.brightness=me.brightness;const at=(Pt,ct)=>{Je.reloadCallback&&(delete Je.reloadCallback,this.loadTile(me,ve)),ve(Pt,ct)};Je.status==="parsing"?Je.reloadCallback=at:Je.status==="done"&&this.loadTile(me,ve)}}abortTile(me,ve){const Fe=me.uid;this.loading[Fe]&&delete this.loading[Fe],ve()}removeTile(me,ve){const Fe=this.loaded,tt=me.uid;Fe&&Fe[tt]&&delete Fe[tt],ve()}}class Hl{constructor(me){this.self=me,this.actor=new r.fF(me,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:re,geojson:Qr,"raster-dem":xe,"raster-array":ce,"batched-model":ea},this.workerSources={},this.self.registerWorkerSource=(ve,Fe)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Fe},this.self.registerRTLTextPlugin=ve=>{if(r.fG.isParsed())throw new Error("RTL text plugin already registered.");r.fG.setState({pluginStatus:r.fH.parsed,pluginURL:r.fG.getPluginURL()}),r.fG.applyArabicShaping=ve.applyArabicShaping,r.fG.processBidirectionalText=ve.processBidirectionalText,r.fG.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const Fe of this.rtlPluginParsingListeners)Fe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(me,ve,Fe){delete this.layerIndexes[me],delete this.availableImages[me],delete this.availableModels[me],delete this.workerSources[me],Fe()}checkIfReady(me,ve,Fe){Fe()}setReferrer(me,ve){this.referrer=ve}spriteLoaded(me,ve){this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={});const{scope:Fe,isLoaded:tt}=ve;if(this.isSpriteLoaded[me][Fe]=tt,this.workerSources[me]&&this.workerSources[me][Fe])for(const Je in this.workerSources[me][Fe]){const at=this.workerSources[me][Fe][Je];for(const Pt in at){const ct=at[Pt];ct instanceof re&&(ct.isSpriteLoaded=tt,ct.fire(new r.z("isSpriteLoaded")))}}}setImages(me,ve,Fe){this.availableImages[me]||(this.availableImages[me]={});const{scope:tt,images:Je}=ve;if(this.availableImages[me][tt]=Je,this.workerSources[me]&&this.workerSources[me][tt]){for(const at in this.workerSources[me][tt]){const Pt=this.workerSources[me][tt][at];for(const ct in Pt)Pt[ct].availableImages=Je}Fe()}else Fe()}setModels(me,{scope:ve,models:Fe},tt){if(this.availableModels[me]||(this.availableModels[me]={}),this.availableModels[me][ve]=Fe,this.workerSources[me]&&this.workerSources[me][ve]){for(const Je in this.workerSources[me][ve]){const at=this.workerSources[me][ve][Je];for(const Pt in at)at[Pt].availableModels=Fe}tt()}else tt()}setProjection(me,ve){this.projections[me]=r.cl(ve)}setBrightness(me,ve,Fe){this.brightness=ve,Fe()}setWorldview(me,ve,Fe){this.worldview=ve,Fe()}setLayers(me,ve,Fe){this.getLayerIndex(me,ve.scope).replace(ve.layers,ve.options),Fe()}updateLayers(me,ve,Fe){this.getLayerIndex(me,ve.scope).update(ve.layers,ve.removedIds,ve.options),Fe()}loadTile(me,ve,Fe){ve.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,ve.type,ve.source,ve.scope).loadTile(ve,Fe)}decodeRasterArray(me,ve,Fe){this.getWorkerSource(me,ve.type,ve.source,ve.scope).decodeRasterArray(ve,Fe)}reloadTile(me,ve,Fe){ve.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,ve.type,ve.source,ve.scope).reloadTile(ve,Fe)}abortTile(me,ve,Fe){this.getWorkerSource(me,ve.type,ve.source,ve.scope).abortTile(ve,Fe)}removeTile(me,ve,Fe){this.getWorkerSource(me,ve.type,ve.source,ve.scope).removeTile(ve,Fe)}removeSource(me,ve,Fe){if(!(this.workerSources[me]&&this.workerSources[me][ve.scope]&&this.workerSources[me][ve.scope][ve.type]&&this.workerSources[me][ve.scope][ve.type][ve.source]))return;const tt=this.workerSources[me][ve.scope][ve.type][ve.source];delete this.workerSources[me][ve.scope][ve.type][ve.source],tt.removeSource!==void 0?tt.removeSource(ve,Fe):Fe()}loadWorkerSource(me,ve,Fe){try{this.self.importScripts(ve.url),Fe()}catch(tt){Fe(tt.toString())}}syncRTLPluginState(me,ve,Fe){if(r.fG.isParsed())Fe(null,!0);else if(r.fG.isParsing())this.rtlPluginParsingListeners.push(Fe);else try{r.fG.setState(ve);const tt=r.fG.getPluginURL();!r.fG.isLoaded()||r.fG.isParsed()||r.fG.isParsing()||tt==null||(r.fG.setState({pluginStatus:r.fH.parsing,pluginURL:r.fG.getPluginURL()}),this.self.importScripts(tt),r.fG.isParsed()?Fe(null,!0):this.rtlPluginParsingListeners.push(Fe))}catch(tt){Fe(tt.toString())}}setDracoUrl(me,ve){this.dracoUrl=ve}getAvailableImages(me,ve){this.availableImages[me]||(this.availableImages[me]={});let Fe=this.availableImages[me][ve];return Fe||(Fe=[]),Fe}getAvailableModels(me,ve){this.availableModels[me]||(this.availableModels[me]={});let Fe=this.availableModels[me][ve];return Fe||(Fe={}),Fe}getLayerIndex(me,ve){this.layerIndexes[me]||(this.layerIndexes[me]={});let Fe=this.layerIndexes[me][ve];return Fe||(Fe=this.layerIndexes[me][ve]=new T,Fe.scope=ve),Fe}getWorkerSource(me,ve,Fe,tt){const Je=this.workerSources;return Je[me]||(Je[me]={}),Je[me][tt]||(Je[me][tt]={}),Je[me][tt][ve]||(Je[me][tt][ve]={}),this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={}),Je[me][tt][ve][Fe]||(Je[me][tt][ve][Fe]=new this.workerSourceTypes[ve]({send:(at,Pt,ct,Ct,un,tn)=>this.actor.send(at,Pt,ct,me,un,tn),scheduler:this.actor.scheduler},this.getLayerIndex(me,tt),this.getAvailableImages(me,tt),this.getAvailableModels(me,tt),this.isSpriteLoaded[me][tt],void 0,this.brightness,this.worldview)),Je[me][tt][ve][Fe]}rasterizeImagesWorker(me,ve,Fe){const tt=new Map;for(const[Je,{image:at,imageVariant:Pt}]of ve.tasks.entries()){const ct=this.imageRasterizer.rasterize(Pt,at,ve.scope,me);tt.set(Je,ct)}Fe(void 0,tt)}removeRasterizedImages(me,ve,Fe){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,me),Fe()}enforceCacheSizeLimit(me,ve){r.fI(ve)}getWorkerPerformanceMetrics(me,ve,Fe){Fe(void 0,void 0)}}return r.fE(self)&&(self.worker=new Hl(self)),Hl})),u(["./shared"],(function(r){var v="3.16.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},E={mark(g){performance.mark(g)},measure(g,o,d){performance.measure(g,o,d)}};function T(g){const o=g.name.split("?")[0];return r.a(o)&&o.includes("mapbox-gl.js")?"javascript":r.a(o)&&o.includes("mapbox-gl.css")?"css":r.b(o)?"fontRange":r.c(o)?"sprite":r.i(o)?"style":r.d(o)?"tilejson":"other"}var k,R={},D=(function(){if(k)return R;function g(y){return!o(y)}function o(y){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,I,j=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(j);try{I=new Worker(z),C=!0}catch{C=!1}return I&&I.terminate(),URL.revokeObjectURL(z),C})()?(function(){var C=document.createElement("canvas");C.width=C.height=1;var I=C.getContext("2d");if(!I)return!1;var j=I.getImageData(0,0,1,1);return j&&j.width===C.width})()?(d[S=y&&y.failIfMajorPerformanceCaveat]===void 0&&(d[S]=(function(C){var I,j=(function(z){var $=document.createElement("canvas"),q=Object.create(g.webGLContextAttributes);return q.failIfMajorPerformanceCaveat=z,$.getContext("webgl2",q)})(C);if(!j)return!1;try{I=j.createShader(j.VERTEX_SHADER)}catch{return!1}return!(!I||j.isContextLost())&&(j.shaderSource(I,"void main() {}"),j.compileShader(I),j.getShaderParameter(I,j.COMPILE_STATUS)===!0)})(S)),d[S]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var S}k=1,R.supported=g,R.notSupportedReason=o;var d={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},R})();function O(g,o,d){const y=document.createElement(g);return o!=null&&(y.className=o),d&&d.appendChild(y),y}function F(g,o,d){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const S of Object.keys(o))y.setAttributeNS(null,S,String(o[S]));return d&&d.appendChild(y),y}const U=typeof document<"u"?document.documentElement&&document.documentElement.style:null,X=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let W;function K(){U&&X&&(W=U[X],U[X]="none")}function ne(){U&&X&&(U[X]=W)}function te(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",te,!0)}function re(){window.addEventListener("click",te,!0),window.setTimeout((()=>{window.removeEventListener("click",te,!0)}),0)}function xe(g,o){const d=g.getBoundingClientRect();return ye(g,d,o)}function ae(g,o){const d=g.getBoundingClientRect(),y=[];for(let S=0;S<o.length;S++)y.push(ye(g,d,o[S]));return y}function ce(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function ye(g,o,d){const y=g.offsetWidth===o.width?1:g.offsetWidth/o.width;return new r.P((d.clientX-o.left)*y,(d.clientY-o.top)*y)}const Ce="01",Me="NO_ACCESS_TOKEN";class Ke{constructor(o,d,y){this._transformRequestFn=o,this._customAccessToken=d,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const o=(function(){let d="";for(let y=0;y<10;y++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ce,d].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeStyleURL(o,d){if(!r.h(o))return o;const y=je(o);return y.params.push(`sdk=js-${v}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||d)}normalizeGlyphsURL(o,d){if(!r.h(o))return o;const y=je(o);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||d)}normalizeModelURL(o,d){if(!r.h(o))return o;const y=je(o);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||d)}normalizeSourceURL(o,d,y,S){if(!r.h(o))return o;const C=je(o);return C.path=`/v4/${C.authority}.json`,C.params.push("secure"),y&&C.params.push(`language=${y}`),S&&C.params.push(`worldview=${S}`),this._makeAPIURL(C,this._customAccessToken||d)}normalizeIconsetURL(o,d){const y=je(o);return r.h(o)?(y.path=`/styles/v1${y.path}/iconset.pbf`,this._makeAPIURL(y,this._customAccessToken||d)):$e(y)}normalizeSpriteURL(o,d,y,S){const C=je(o);return r.h(o)?(C.path=`/styles/v1${C.path}/sprite${d}${y}`,this._makeAPIURL(C,this._customAccessToken||S)):(C.path+=`${d}${y}`,$e(C))}normalizeTileURL(o,d,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!r.h(o))return o;const S=je(o);S.path=S.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||y&&S.authority!=="raster"&&y===512?"@2x":""}${r.k.supported?".webp":"$1"}`),S.authority==="raster"?S.path=`/${r.e.RASTER_URL_PREFIX}${S.path}`:S.authority==="rasterarrays"?S.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${S.path}`:S.authority==="3dtiles"?S.path=`/${r.e.TILES3D_URL_PREFIX}${S.path}`:(S.path=S.path.replace(/^.+\/v4\//,"/"),S.path=`/${r.e.TILE_URL_VERSION}${S.path}`);const C=this._customAccessToken||(function(I){for(const j of I){const z=j.match(/^access_token=(.*)$/);if(z)return z[1]}return null})(S.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&C&&this._skuToken&&S.params.push(`sku=${this._skuToken}`),this._makeAPIURL(S,C)}canonicalizeTileURL(o,d){const y=je(o);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return o;let S="mapbox://";y.path.match(/^\/raster\/v1\//)?S+=`raster/${y.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?S+=`rasterarrays/${y.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:S+=`tiles/${y.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let C=y.params;return d&&(C=C.filter((I=>!I.match(/^access_token=/)))),C.length&&(S+=`?${C.join("&")}`),S}canonicalizeTileset(o,d){const y=!!d&&r.h(d),S=[];for(const C of o.tiles||[])r.j(C)?S.push(this.canonicalizeTileURL(C,y)):S.push(C);return S}_makeAPIURL(o,d){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",S=je(r.e.API_URL);if(o.protocol=S.protocol,o.authority=S.authority,o.protocol==="http"){const C=o.params.indexOf("secure");C>=0&&o.params.splice(C,1)}if(S.path!=="/"&&(o.path=`${S.path}${o.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return $e(o);if(d=d||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return o.params=o.params.filter((C=>C.indexOf("access_token")===-1)),o.params.push(`access_token=${d||""}`),$e(o)}}const ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(g){const o=g.match(ke);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function $e(g){const o=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${o}`}const Ae="mapbox.eventData";function He(g){if(!g)return null;const o=g.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(r.l(o[1]))}catch{return null}}class qe{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const d=He(r.e.ACCESS_TOKEN);let y="";return y=d&&d.u?r.f(d.u):r.e.ACCESS_TOKEN||"",o?`${Ae}.${o}:${y}`:`${Ae}:${y}`}fetchEventData(){const o=r.s("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid"),S=this.getStorageKey("uuidTimestamp");if(o)try{const C=localStorage.getItem(d);C&&(this.eventData=JSON.parse(C));const I=localStorage.getItem(y);I&&(this.anonId=I);const j=localStorage.getItem(S);j&&(this.anonIdTimestamp=Number(j));const z=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<z)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=r.s("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid"),S=this.getStorageKey("uuidTimestamp"),C=this.anonId,I=this.anonIdTimestamp;if(o&&C)try{localStorage.setItem(y,C),Object.keys(this.eventData).length>=1&&localStorage.setItem(d,JSON.stringify(this.eventData)),I&&localStorage.setItem(S,I.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,d,y,S){if(!r.e.EVENTS_URL)return;const C=je(r.e.EVENTS_URL);C.params.push(`access_token=${S||r.e.ACCESS_TOKEN||""}`);const I={event:this.type,created:new Date(o).toISOString()},j=d?Object.assign(I,d):I,z={url:$e(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([j])};this.pendingRequest=r.p(z,($=>{this.pendingRequest=null,y($),this.saveEventData(),this.processRequests(S)}))}queueRequest(o,d){this.queue.push(o),this.processRequests(d)}}const Le=new class extends qe{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,o){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some((d=>r.h(d)||r.j(d)))&&this.queueRequest(Date.now(),o)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=He(r.e.ACCESS_TOKEN),d=o?o.u:r.e.ACCESS_TOKEN;let y=d!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),y=!0);const S=this.queue.shift();if(this.eventData.lastSuccess){const C=new Date(this.eventData.lastSuccess),I=new Date(S),j=(S-this.eventData.lastSuccess)/864e5;y=y||j>=1||j<-1||C.getDate()!==I.getDate()}else y=!0;y?this.postEvent(S,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ce,"enabled.telemetry":!1,userId:this.anonId},(C=>{C||(this.eventData.lastSuccess=S,this.eventData.tokenU=d)}),g):this.processRequests()}},st=Le.postTurnstileEvent.bind(Le),bt=new class extends qe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,o,d,y){this.skuToken=o,this.errorCb=y,r.e.EVENTS_URL&&(d||r.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},d):this.errorCb(new Error(Me)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ce,skuToken:this.skuToken,userId:this.anonId},(y=>{y?this.errorCb(y):o&&(this.success[o]=!0)}),g))}remove(){this.errorCb=null}},yt=bt.postMapLoadEvent.bind(bt),Vt=new class extends qe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let o=this.mapInstanceIdMap.get(g);return o||(o=r.u(),this.mapInstanceIdMap.set(g,o)),o}getEventId(g){const o=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,o+1),o}postStyleLoadEvent(g,o){const{map:d,style:y,importedStyles:S}=o;if(!r.e.EVENTS_URL||!g&&!r.e.ACCESS_TOKEN)return;const C=this.getMapInstanceId(d),I={mapInstanceId:C,eventId:this.getEventId(C),style:y};S.length&&(I.importedStyles=S),this.queueRequest({timestamp:Date.now(),payload:I},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:d}=this.queue.shift();this.postEvent(o,d,(()=>{}),g)}},_t=Vt.postStyleLoadEvent.bind(Vt),vt=new class extends qe{constructor(g){super("metrics"),g&&(this.data=g)}postMetricsEvent(g){if(!r.e.EVENTS_URL||!g&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();const o=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:d}=this.queue.shift();this.postEvent(o,d,(()=>{}),g)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),qt=vt.postMetricsEvent.bind(vt),kt=new class extends qe{constructor(){super("gljs.performance")}postPerformanceEvent(g,o){r.e.EVENTS_URL&&(g||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:d}=this.queue.shift(),y=(function(S){const C=performance.getEntriesByType("resource"),I=performance.getEntriesByType("mark"),j=(function(ie){const le={};if(ie){for(const de in ie)if(de!=="other")for(const be of ie[de]){const _e=`${de}ResolveRangeMin`,Se=`${de}ResolveRangeMax`,Pe=`${de}RequestCount`,Ee=`${de}RequestCachedCount`;le[_e]=Math.min(le[_e]||1/0,be.startTime),le[Se]=Math.max(le[Se]||-1/0,be.responseEnd);const We=Ne=>{le[Ne]===void 0&&(le[Ne]=0),++le[Ne]};be.transferSize!==void 0&&be.transferSize===0&&We(Ee),We(Pe)}}return le})((function(ie,le){const de={};if(ie)for(const be of ie){const _e=le(be);de[_e]===void 0&&(de[_e]=[]),de[_e].push(be)}return de})(C,T)),z=window.devicePixelRatio,$=navigator.connection||navigator.mozConnection||navigator.webkitConnection,q=$?$.effectiveType:void 0,ee={counters:[],metadata:[],attributes:[]},Q=(ie,le,de)=>{de!=null&&ie.push({name:le,value:de.toString()})};for(const ie in j)Q(ee.counters,ie,j[ie]);if(S.interactionRange[0]!==1/0&&S.interactionRange[1]!==-1/0&&(Q(ee.counters,"interactionRangeMin",S.interactionRange[0]),Q(ee.counters,"interactionRangeMax",S.interactionRange[1])),I)for(const ie of Object.values(w)){const le=I.find((de=>de.name===ie));le&&Q(ee.counters,ie,le.startTime)}return Q(ee.counters,"visibilityHidden",S.visibilityHidden),Q(ee.attributes,"style",(function(ie){if(ie)for(const le of ie){const de=le.name.split("?")[0];if(r.i(de)){const be=de.split("/").slice(-2);if(be.length===2)return`mapbox://styles/${be[0]}/${be[1]}`}}})(C)),Q(ee.attributes,"terrainEnabled",S.terrainEnabled?"true":"false"),Q(ee.attributes,"fogEnabled",S.fogEnabled?"true":"false"),Q(ee.attributes,"projection",S.projection),Q(ee.attributes,"zoom",S.zoom),Q(ee.metadata,"devicePixelRatio",z),Q(ee.metadata,"connectionEffectiveType",q),Q(ee.metadata,"navigatorUserAgent",navigator.userAgent),Q(ee.metadata,"screenWidth",window.screen.width),Q(ee.metadata,"screenHeight",window.screen.height),Q(ee.metadata,"windowWidth",window.innerWidth),Q(ee.metadata,"windowHeight",window.innerHeight),Q(ee.metadata,"mapWidth",S.width/z),Q(ee.metadata,"mapHeight",S.height/z),Q(ee.metadata,"webglRenderer",S.renderer),Q(ee.metadata,"webglVendor",S.vendor),Q(ee.metadata,"sdkVersion",v),Q(ee.metadata,"sdkIdentifier","mapbox-gl-js"),ee})(d);for(const S of y.metadata);for(const S of y.counters);for(const S of y.attributes);this.postEvent(o,y,(()=>{}),g)}},on=kt.postPerformanceEvent.bind(kt),mn=new class extends qe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,o,d,y){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const S=je(r.e.API_URL+r.e.SESSION_PATH);S.params.push(`sku=${o||""}`),S.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);const C={url:$e(S),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(C,(I=>{this.pendingRequest=null,d(I),this.saveEventData(),this.processRequests(y)}))}getSessionAPI(g,o,d,y){this.skuToken=o,this.errorCb=y,r.e.SESSION_PATH&&r.e.API_URL&&(d||r.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},d):this.errorCb(new Error(Me)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||this.getSession(d,this.skuToken,(y=>{y?this.errorCb(y):o&&(this.success[o]=!0)}),g)}remove(){this.errorCb=null}},Hr=mn.getSessionAPI.bind(mn),Un=new Set;function $r(g,o){o?Un.add(g):Un.delete(g)}class ht{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,d){this._updatedSourceCaches[o]=d,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const d=o.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(o.id),this.setDirty()}removeLayer(o){const d=o.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][o.id]=o,this._updatedLayers[d].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const d in this._updatedLayers)o[d]=o[d]||{},o[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)o[d]=o[d]||{},o[d].removedIds=Object.keys(this._removedLayers[d]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,d){this._updatedImages[d]=this._updatedImages[d]||new Set,this._updatedImages[d].add(r.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Lr(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class Br extends r.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new r.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const d=this.atlasTexture.get(o);d&&(d.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,d){this.imageProviders.has(d)||this.imageProviders.set(d,new Map),this.imageProviders.get(d).set(o.id,o)}removeImageProvider(o,d){this.imageProviders.has(d)&&this.imageProviders.get(d).delete(o)}getPendingImageProviders(){const o=[];for(const d of this.imageProviders.values())for(const y of d.values())y.hasPendingRequests()&&o.push(y);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,d){if(this.loaded.get(d)!==o&&(this.loaded.set(d,o),o)){for(const{ids:y,callback:S}of this.requestors)this._notify(y,d,S);this.requestors=[]}}hasImage(o,d){return!!this.getImage(o,d)}getImage(o,d){return this.images.get(d).get(o.toString())}addImage(o,d,y){this._validate(o,y)&&this.images.get(d).set(o.toString(),y)}_validate(o,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new r.y(new Error(`Image "${o.name}" has invalid "content" value`))),y=!1),y}_validateStretch(o,d){if(!o)return!0;let y=0;for(const S of o){if(S[0]<y||S[1]<S[0]||d<S[1])return!1;y=S[1]}return!0}_validateContent(o,d){return o?o.length!==4||!d.usvg&&(o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,d,y){const S=this.images.get(d).get(o.toString());y.version=S.version+1,this.images.get(d).set(o.toString(),y),this.updatedImages.get(d).add(o),this.removeFromImageRasterizerCache(o,d)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,d){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:d}):this.imageRasterizer.removeImagesFromCacheByIds([o],d))}removeImage(o,d){const y=this.images.get(d),S=y.get(o.toString());y.delete(o.toString()),this.patterns.get(d).delete(o.toString()),this.removeFromImageRasterizerCache(o,d),S.userImage&&S.userImage.onRemove&&S.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map((d=>r.I.from(d)))}getImages(o,d,y){const S=[],C=[],I=this.imageProviders.get(d);for(const q of o){if(!q.iconsetId){S.push(q);continue}const ee=I.get(q.iconsetId);ee&&(this.getImage(q,d)?C.push(q):ee.addPendingRequest(q))}if(S.length===0)return void this._notify(C,d,y);let j=!0;const z=!!this.loaded.get(d),$=this.images.get(d);if(!z)for(const q of S)$.has(q.toString())||(j=!1);z||j?this._notify(S,d,y):this.requestors.push({ids:S,scope:d,callback:y})}rasterizeImages(o,d){const y=new Map,{tasks:S,scope:C}=o;for(const[I,j]of S.entries()){const z=this.getImage(j.id,C);z&&y.set(I,{image:z,imageVariant:j})}this._rasterizeImages(C,y,d)}_rasterizeImages(o,d,y){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:d,scope:o},y);else{const S=new Map;for(const[C,{image:I,imageVariant:j}]of d.entries())S.set(C,this.imageRasterizer.rasterize(j,I,o,0));y(void 0,S)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,d,y){const S=this.images.get(d),C=new Map;for(const I of o){if(!S.get(I.toString())){if(I.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:I.name}))}const j=S.get(I.toString());if(!j){r.w(`Image "${I.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const z={data:j.usvg?null:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,usvg:j.usvg,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:!!(j.userImage&&j.userImage.render)};j.usvg&&Object.assign(z,{width:j.icon.usvg_tree.width,height:j.icon.usvg_tree.height}),C.set(r.I.toString(I),z)}y(null,C)}getPixelSize(o){const{width:d,height:y}=this.atlasImage.get(o);return{width:d,height:y}}getPattern(o,d,y){const S=o.toString(),C=this.patterns.get(d),I=C.get(S),j=this.getImage(o,d);if(!j)return null;if(I){if(I.position.version===j.version)return I.position;I.position.version=j.version}else{if(j.usvg&&!j.data){const z=this.getPatternInFlightId(S,d);if(this.patternsInFlight.has(z))return null;this.patternsInFlight.add(z);const $=new r.A(o).scaleSelf(r.o.devicePixelRatio),q=new Map([[$.toString(),{image:j,imageVariant:$}]]);return this._rasterizeImages(d,q,((ee,Q)=>this.storePatternImage($,d,j,y,Q))),null}this.storePattern(o,d,j)}return this._updatePatternAtlas(d,y),C.get(S).position}getPatternInFlightId(o,d){return r.B(o,d)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,d,y,S,C){const I=o.toString(),j=C?C.get(I):void 0;j&&(y.data=j,this.storePattern(o.id,d,y),this._updatePatternAtlas(d,S),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),d)))}storePattern(o,d,y){const S={w:y.data.width+2*r.C,h:y.data.height+2*r.C,x:0,y:0},C=new r.F(S,y,r.C);this.patterns.get(d).set(o.toString(),{bin:S,position:C})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,d){const y=o.gl;let S=this.atlasTexture.get(d);S?this.dirty&&(S.update(this.atlasImage.get(d)),this.dirty=!1):(S=new r.T(o,this.atlasImage.get(d),y.RGBA8),this.atlasTexture.set(d,S)),S.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(o,d){const y=this.patterns.get(o),S=Array.from(y.values()).map((({bin:$})=>$)),{w:C,h:I}=r.G(S),j=this.atlasImage.get(o);j.resize({width:C||1,height:I||1});const z=this.images.get(o);for(const[$,{bin:q,position:ee}]of y.entries()){let Q=ee.padding;const ie=q.x+Q,le=q.y+Q,de=z.get($).data,be=de.width,_e=de.height;Q=Q>1?Q-1:Q,r.q.copy(de,j,{x:0,y:0},{x:ie,y:le},{width:be,height:_e},d),r.q.copy(de,j,{x:0,y:_e-Q},{x:ie,y:le-Q},{width:be,height:Q},d),r.q.copy(de,j,{x:0,y:0},{x:ie,y:le+_e},{width:be,height:Q},d),r.q.copy(de,j,{x:be-Q,y:0},{x:ie-Q,y:le},{width:Q,height:_e},d),r.q.copy(de,j,{x:0,y:0},{x:ie+be,y:le},{width:Q,height:_e},d),r.q.copy(de,j,{x:be-Q,y:_e-Q},{x:ie-Q,y:le-Q},{width:Q,height:Q},d),r.q.copy(de,j,{x:0,y:_e-Q},{x:ie+be,y:le-Q},{width:Q,height:Q},d),r.q.copy(de,j,{x:0,y:0},{x:ie+be,y:le+_e},{width:Q,height:Q},d),r.q.copy(de,j,{x:be-Q,y:0},{x:ie-Q,y:le+_e},{width:Q,height:Q},d)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,d){const y=this.images.get(d);for(const S of o){if(this.callbackDispatchedThisFrame.get(d).has(S.toString()))continue;this.callbackDispatchedThisFrame.get(d).add(S.toString());const C=y.get(S.toString());Lr(C)&&this.updateImage(S,d,C)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function wn(g){const o=g.value,d=g.valueSpec,y=g.style,S=g.styleSpec,C=g.key,I=g.arrayElementValidator||Gn;if(!Array.isArray(o))return[new r.V(C,o,`array expected, ${r.K(o)} found`)];if(d.length&&o.length!==d.length)return[new r.V(C,o,`array length ${d.length} expected, length ${o.length} found`)];if(d["min-length"]&&o.length<d["min-length"])return[new r.V(C,o,`array length at least ${d["min-length"]} expected, length ${o.length} found`)];let j={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};S.$version<7&&(j.function=d.function),r.H(d.value)&&(j=d.value);let z=[];for(let $=0;$<o.length;$++)z=z.concat(I({array:o,arrayIndex:$,value:o[$],valueSpec:j,style:y,styleSpec:S,key:`${C}[${$}]`},!0));return z}function Nn(g){const o=g.key,d=g.value,y=g.valueSpec;if(!r.L(d))return[new r.V(o,d,`number expected, ${r.K(d)} found`)];if(d!=d)return[new r.V(o,d,"number expected, NaN found")];if("minimum"in y){let S=y.minimum;if(Array.isArray(y.minimum)&&(S=y.minimum[g.arrayIndex]),d<S)return[new r.V(o,d,`${d} is less than the minimum value ${S}`)]}if("maximum"in y){let S=y.maximum;if(Array.isArray(y.maximum)&&(S=y.maximum[g.arrayIndex]),d>S)return[new r.V(o,d,`${d} is greater than the maximum value ${S}`)]}return[]}function mr(g){const o=g.key,d=g.value;if(!r.H(d))return[new r.V(o,d,`object expected, ${r.K(d)} found`)];const y=g.valueSpec,S=r.J(d.type);let C,I,j,z={};const $=S!=="categorical"&&d.property===void 0,q=!$,ee=(function(de){const be=de.stops;return Array.isArray(be)&&Array.isArray(be[0])&&r.H(be[0][0])})(d),Q=er({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(de){if(S==="identity")return[new r.V(de.key,de.value,'identity function may not have a "stops" property')];let be=[];const _e=de.value;return be=be.concat(wn({key:de.key,value:_e,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:ie})),Array.isArray(_e)&&_e.length===0&&be.push(new r.V(de.key,_e,"array must have at least one stop")),be},default:function(de){return Gn({key:de.key,value:de.value,valueSpec:y,style:de.style,styleSpec:de.styleSpec})}}});return S==="identity"&&$&&Q.push(new r.V(g.key,g.value,'missing required property "property"')),S==="identity"||d.stops||Q.push(new r.V(g.key,g.value,'missing required property "stops"')),S==="exponential"&&y.expression&&!r.M(y)&&Q.push(new r.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(q&&!r.N(y)?Q.push(new r.V(g.key,g.value,"property functions not supported")):$&&!r.O(y)&&Q.push(new r.V(g.key,g.value,"zoom functions not supported"))),S!=="categorical"&&!ee||d.property!==void 0||Q.push(new r.V(g.key,g.value,'"property" property is required')),Q;function ie(de){let be=[];const _e=de.value,Se=de.key;if(!Array.isArray(_e))return[new r.V(Se,_e,`array expected, ${r.K(_e)} found`)];if(_e.length!==2)return[new r.V(Se,_e,`array length 2 expected, length ${_e.length} found`)];if(ee){if(!r.H(_e[0]))return[new r.V(Se,_e,`object expected, ${r.K(_e[0])} found`)];const Pe=_e[0];if(Pe.zoom===void 0)return[new r.V(Se,_e,"object stop key must have zoom")];if(Pe.value===void 0)return[new r.V(Se,_e,"object stop key must have value")];const Ee=r.J(Pe.zoom);if(typeof Ee!="number")return[new r.V(Se,Pe.zoom,"stop zoom values must be numbers")];if(j&&j>Ee)return[new r.V(Se,Pe.zoom,"stop zoom values must appear in ascending order")];Ee!==j&&(j=Ee,I=void 0,z={}),be=be.concat(er({key:`${Se}[0]`,value:_e[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Nn,value:le}}))}else be=be.concat(le({key:`${Se}[0]`,value:_e[0],style:de.style,styleSpec:de.styleSpec},_e));return r.Q(r.S(_e[1]))?be.concat([new r.V(`${Se}[1]`,_e[1],"expressions are not allowed in function stops.")]):be.concat(Gn({key:`${Se}[1]`,value:_e[1],valueSpec:y,style:de.style,styleSpec:de.styleSpec}))}function le(de,be){const _e=r.K(de.value),Se=r.J(de.value),Pe=de.value!==null?de.value:be;if(C){if(_e!==C)return[new r.V(de.key,Pe,`${_e} stop domain type must match previous stop domain type ${C}`)]}else C=_e;if(_e!=="number"&&_e!=="string"&&_e!=="boolean"&&typeof Se!="number"&&typeof Se!="string"&&typeof Se!="boolean")return[new r.V(de.key,Pe,"stop domain value must be a number, string, or boolean")];if(_e!=="number"&&S!=="categorical"){let Ee=`number expected, ${_e} found`;return r.N(y)&&S===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(de.key,Pe,Ee)]}return S!=="categorical"||_e!=="number"||typeof Se=="number"&&isFinite(Se)&&Math.floor(Se)===Se?S!=="categorical"&&_e==="number"&&typeof Se=="number"&&typeof I=="number"&&I!==void 0&&Se<I?[new r.V(de.key,Pe,"stop domain values must appear in ascending order")]:(I=Se,S==="categorical"&&Se in z?[new r.V(de.key,Pe,"stop domain values must be unique")]:(z[Se]=!0,[])):[new r.V(de.key,Pe,`integer expected, found ${String(Se)}`)]}}function Qn(g){const o=(g.expressionContext==="property"?r.W:r.U)(r.S(g.value),g.valueSpec);if(o.result==="error")return o.value.map((y=>new r.V(`${g.key}${y.key}`,g.value,y.message)));const d=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new r.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!r.Z(d))return[new r.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Nt(d,g);if(g.expressionContext==="appearance")return et(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!r.X(d,["zoom","feature-state"]))return[new r.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!r.Y(d))return[new r.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nt(g,o){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const S of o.valueSpec.expression.parameters)d.delete(S);if(d.size===0)return[];const y=[];return g instanceof r._&&d.has(g.name)?[new r.V(o.key,o.value,`["${g.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(g.eachChild((S=>{y.push(...Nt(S,o))})),y)}function et(g,o){const d=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const S of o.valueSpec.expression.parameters)d.add(S);if(d.size===0)return[];const y=[];return g instanceof r._&&!d.has(g.name)?[new r.V(o.key,o.value,`["${g.name}"] is not an allowed parameter`)]:(g.eachChild((S=>{y.push(...et(S,o))})),y)}function Oe(g){const o=g.key,d=g.value,y=g.valueSpec,S=[];return Array.isArray(y.values)?y.values.indexOf(r.J(d))===-1&&S.push(new r.V(o,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(r.J(d))===-1&&S.push(new r.V(o,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),S}function Bt(g){return r.a2(r.S(g.value))?Qn(Object.assign({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):En(g)}function En(g){const o=g.value,d=g.key;if(!Array.isArray(o))return[new r.V(d,o,`array expected, ${r.K(o)} found`)];if(o.length<1)return[new r.V(d,o,"filter array must have at least 1 element")];const y=g.styleSpec;let S=Oe({key:`${d}[0]`,value:o[0],valueSpec:y.filter_operator});switch(r.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&r.J(o[1])==="$type"&&S.push(new r.V(d,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&S.push(new r.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(r.a0(o[1])||S.push(new r.V(`${d}[1]`,o[1],`string expected, ${r.K(o[1])} found`)));for(let C=2;C<o.length;C++)r.J(o[1])==="$type"?S=S.concat(Oe({key:`${d}[${C}]`,value:o[C],valueSpec:y.geometry_type})):r.a0(o[C])||r.L(o[C])||r.$(o[C])||S.push(new r.V(`${d}[${C}]`,o[C],`string, number, or boolean expected, ${r.K(o[C])} found.`));break;case"any":case"all":case"none":for(let C=1;C<o.length;C++)S=S.concat(En({key:`${d}[${C}]`,value:o[C],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":o.length!==2?S.push(new r.V(d,o,`filter array for "${o[0]}" operator must have 2 elements`)):r.a0(o[1])||S.push(new r.V(`${d}[1]`,o[1],`string expected, ${r.K(o[1])} found`))}return S}function Dn(g,o){const d=g.key,y=g.style,S=g.layer,C=g.styleSpec,I=g.value,j=g.objectKey,z=C[`${o}_${g.layerType}`];if(!z)return[];const $=j.match(/^(.*)-use-theme$/);if($&&z[$[1]])return r.Q(r.S(I))?[].concat(Gn({key:d,value:I,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:y,styleSpec:C,expressionContext:"property",propertyType:o,propertyKey:j})):Gn({key:d,value:I,valueSpec:{type:"string"},style:y,styleSpec:C});const q=j.match(/^(.*)-transition$/);if(o==="paint"&&q&&z[q[1]]&&z[q[1]].transition)return Gn({key:d,value:I,valueSpec:C.transition,style:y,styleSpec:C});const ee=g.valueSpec||z[j];if(!ee)return[new r.a3(d,I,`unknown property "${j}"`)];let Q;if(r.a0(I)&&r.N(ee)&&!ee.tokens&&(Q=/^{([^}]+)}$/.exec(I))){const le=`\`{ "type": "identity", "property": ${Q?JSON.stringify(Q[1]):'"_"'} }\``;return[new r.V(d,I,`"${j}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const ie=[];if(g.layerType==="symbol")j!=="text-field"||!y||y.glyphs||y.imports||ie.push(new r.V(d,I,'use of "text-field" requires a style "glyphs" property')),j==="text-font"&&r.a4(r.S(I))&&r.J(I.type)==="identity"&&ie.push(new r.V(d,I,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&o==="paint"&&S&&S.layout&&S.layout.hasOwnProperty("model-id")&&r.N(ee)&&(r.a5(ee)||r.O(ee))){const le=r.W(r.S(I),ee).value,de="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;de&&!r.X(de,["measure-light"])&&(j==="model-emissive-strength"&&r.Y(de)&&r.Z(de)||ie.push(new r.V(d,I,`${j} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ie.concat(Gn({key:g.key,value:I,valueSpec:ee,style:y,styleSpec:C,expressionContext:"property",propertyType:o,propertyKey:j}))}function rn(g){return Dn(g,"paint")}function wr(g){return Dn(g,"layout")}function cr(g){let o=[];const d=g.value,y=g.key,S=g.style,C=g.styleSpec;if(!r.H(d))return[new r.V(y,d,"object expected")];d.type||d.ref||o.push(new r.V(y,d,'either "type" or "ref" is required'));let I=r.J(d.type);const j=r.J(d.ref);if(d.id){const z=r.J(d.id);for(let $=0;$<g.arrayIndex;$++){const q=S.layers[$];r.J(q.id)===z&&o.push(new r.V(y,d.id,`duplicate layer id "${z}", previously used at line ${q.id.__line__}`))}}if("ref"in d){let z;["type","source","source-layer","filter","layout"].forEach(($=>{$ in d&&o.push(new r.V(y,d[$],`"${$}" is prohibited for ref layers`))})),S.layers.forEach(($=>{r.J($.id)===j&&(z=$)})),z?z.ref?o.push(new r.V(y,d.ref,"ref cannot reference another ref layer")):I=r.J(z.type):typeof j=="string"&&o.push(new r.V(y,d.ref,`ref layer "${j}" not found`))}else if(I!=="background"&&I!=="sky"&&I!=="slot")if(d.source)if(r.a0(d.source)){const z=S.sources&&S.sources[d.source],$=z&&r.J(z.type);z?$==="vector"&&I==="raster"?o.push(new r.V(y,d.source,`layer "${d.id}" requires a raster source`)):$==="raster"&&I!=="raster"?o.push(new r.V(y,d.source,`layer "${d.id}" requires a vector source`)):$!=="vector"||d["source-layer"]?$==="raster-dem"&&I!=="hillshade"?o.push(new r.V(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):$!=="raster-array"||["raster","raster-particle"].includes(I)?I==="line"&&d.paint&&(d.paint["line-gradient"]||d.paint["line-trim-offset"])&&$==="geojson"&&!z.lineMetrics?o.push(new r.V(y,d,`layer "${d.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):I==="raster-particle"&&$!=="raster-array"&&o.push(new r.V(y,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):o.push(new r.V(y,d.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new r.V(y,d,`layer "${d.id}" must specify a "source-layer"`)):o.push(new r.V(y,d.source,`source "${d.source}" not found`))}else o.push(new r.V(`${y}.source`,d.source,'"source" must be a string'));else o.push(new r.V(y,d,'missing required property "source"'));return o=o.concat(er({key:y,value:d,valueSpec:C.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gn({key:`${y}.type`,value:d.type,valueSpec:C.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:z=>Bt(Object.assign({layerType:I},z)),layout:z=>er({layer:d,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":$=>wr(Object.assign({layerType:I},$))}}),paint:z=>er({layer:d,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":$=>rn(Object.assign({layerType:I,layer:d},$))}}),appearances(z){const $=wn({key:z.key,value:z.value,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:Q=>(function(ie){const{key:le,layer:de,layerType:be}=ie,_e=r.J(ie.value),Se=r.J(_e.name),Pe=r.J(_e.condition),Ee=er({key:le,value:_e,valueSpec:ie.styleSpec.appearance,style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{condition:We=>(function(Ne){const Xe=[];return Xe.push(...Qn({key:Ne.key,value:Ne.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Xe})(Object.assign({layer:de,layerType:be},We)),properties:We=>(function(Ne){const Xe=[],{styleSpec:ze,layer:De,layerType:Qe}=Ne,dt=ze[`paint_${Qe}`],lt=ze[`layout_${Qe}`],Lt=Ne.object[Ne.objectKey];for(const Tt in Lt){const Gt=Tt in dt?"paint":Tt in lt?"layout":void 0;if(!Gt){Xe.push(new r.V(Ne.key,Tt,`unknown property "${Tt}" for layer type "${Qe}"`));continue}const hn=Object.assign({},Ne,{key:`${Ne.key}.${Tt}`,object:Lt,objectKey:Tt,layer:De,layerType:Qe,value:Lt[Tt],valueSpec:Gt==="paint"?dt[Tt]:lt[Tt]});Xe.push(...Dn(hn,Gt))}return Xe})(Object.assign({layer:de,layerType:be},We))}});return Se!=="hidden"&&Pe===void 0&&Ee.push(new r.V(ie.key,"name",'Appearance with name different than "hidden" must have a condition')),Ee})(Object.assign({layerType:I,layer:d},Q))}),q=Array.isArray(z.value)?z.value:[],ee=new Set;return q.forEach(((Q,ie)=>{const le=r.J(Q.name);if(le)if(ee.has(le)){const de=r.J(d.id);$.push(new r.V(z.key,le,`Duplicated appearance name "${le}" for layer "${de}"`))}else ee.add(le)})),$}}})),o}function Jn({key:g,value:o}){return r.a0(o)?[]:[new r.V(g,o,`string expected, ${r.K(o)} found`)]}const ir={promoteId:function g({key:o,value:d}){if(r.a0(d))return Jn({key:o,value:d});if(Array.isArray(d)){const S=[],C=r.S(d),I=r.U(C);return I.result==="error"&&I.value.forEach((j=>{S.push(new r.V(`${o}${j.key}`,null,`${j.message}`))})),r.X(I.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||S.push(new r.V(`${o}`,null,"promoteId expression should be only feature dependent")),S}if(!r.H(d))return[new r.V(o,d,`string, expression or object expected, "${r.K(d)}" found`)];const y=[];for(const S in d)y.push(...g({key:`${o}.${S}`,value:d[S]}));return y}};function bn(g){const o=g.value,d=g.key,y=g.styleSpec,S=g.style;if(!r.H(o))return[new r.V(d,o,`object expected, ${r.K(o)} found`)];if(!("type"in o))return[new r.V(d,o,'"type" is required')];const C=r.J(o.type);let I=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&("url"in o||"tiles"in o||I.push(new r.a3(d,o,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return I=I.concat(er({key:d,value:o,valueSpec:y[`source_${C.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:ir})),I;case"geojson":if(I=er({key:d,value:o,valueSpec:y.source_geojson,style:S,styleSpec:y,objectElementValidators:ir}),"cluster"in o&&"clusterProperties"in o){if(!r.H(o.clusterProperties))return[new r.V(`${d}.clusterProperties`,o,`object expected, ${r.K(o)} found`)];for(const j in o.clusterProperties){const z=o.clusterProperties[j];if(!Array.isArray(z))return[new r.V(`${d}.clusterProperties.${j}`,z,"array expected")];const[$,q]=z,ee=typeof $=="string"?[$,["accumulated"],["get",j]]:$;I.push(...Qn({key:`${d}.${j}.map`,value:q,expressionContext:"cluster-map"})),I.push(...Qn({key:`${d}.${j}.reduce`,value:ee,expressionContext:"cluster-reduce"}))}}return I;case"video":return er({key:d,value:o,valueSpec:y.source_video,style:S,styleSpec:y});case"image":return er({key:d,value:o,valueSpec:y.source_image,style:S,styleSpec:y});case"canvas":return[new r.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oe({key:`${d}.type`,value:o.type,valueSpec:{values:In(y)}})}}function In(g){return g.source.reduce(((o,d)=>{const y=g[d];return y.type.type==="enum"&&(o=o.concat(Object.keys(y.type.values||{}))),o}),[])}function Zr(g){const o=g.value,d=g.styleSpec,y=d.light,S=g.style;if(o===void 0)return[];if(!r.H(o))return[new r.V("light",o,`object expected, ${r.K(o)} found`)];let C=[];for(const I in o){const j=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);C=C.concat(z&&y[z[1]]?Gn({key:I,value:o[I],valueSpec:{type:"string"},style:S,styleSpec:d}):j&&y[j[1]]&&y[j[1]].transition?Gn({key:I,value:o[I],valueSpec:d.transition,style:S,styleSpec:d}):y[I]?Gn({key:I,value:o[I],valueSpec:y[I],style:S,styleSpec:d}):[new r.V(I,o[I],`unknown property "${I}"`)])}return C}function Vr(g){const o=g.value;if(!o)return[];const d=g.key;if(!r.H(o))return[new r.V(d,o,`object expected, ${r.K(o)} found`)];let y=[];const S=g.styleSpec,C=S["light-3d"],I=g.style,j=g.style.lights;for(const q of["type","id"])if(!(q in o))return y=y.concat([new r.V(d,o,`missing property "${q}"`)]),y;if(!r.a0(o.type))return y=y.concat([new r.V(`${d}.type`,o.type,"string expected")]),y;if(j)for(let q=0;q<g.arrayIndex;q++){const ee=r.J(o.type),Q=j[q];r.J(Q.type)===ee&&y.push(new r.V(d,o.id,`duplicate light type "${o.type}", previously defined at line ${Q.id.__line__}`))}const z=`properties_light_${o.type}`;if(!(z in S))return y=y.concat([new r.V(`${d}.type`,o,`Invalid light type ${o.type}`)]),y;const $=S[z];for(const q in o)if(q==="properties"){const ee=o[q];if(!r.H(ee))return y=y.concat([new r.V("properties",ee,`object expected, ${r.K(ee)} found`)]),y;for(const Q in ee){const ie=Q.match(/^(.*)-transition$/),le=Q.match(/^(.*)-use-theme$/);y=y.concat(le&&$[le[1]]?Gn({key:q,value:ee[Q],valueSpec:{type:"string"},style:I,styleSpec:S}):ie&&$[ie[1]]&&$[ie[1]].transition?Gn({key:q,value:o[q],valueSpec:S.transition,style:I,styleSpec:S}):$[Q]?Gn({key:Q,value:ee[Q],valueSpec:$[Q],style:I,styleSpec:S}):[new r.a3(g.key,ee[Q],`unknown property "${Q}"`)])}}else y=y.concat(C[q]?Gn({key:q,value:o[q],valueSpec:C[q],style:I,styleSpec:S}):[new r.a3(q,o[q],`unknown property "${q}"`)]);return y}function qn(g){const o=g.value,d=g.key,y=g.style,S=g.styleSpec,C=S.terrain;if(o==null)return[];if(!r.H(o))return[new r.V("terrain",o,`object expected, ${r.K(o)} found`)];let I=[];for(const j in o){const z=j.match(/^(.*)-transition$/),$=j.match(/^(.*)-use-theme$/);I=I.concat($&&C[$[1]]?Gn({key:j,value:o[j],valueSpec:{type:"string"},style:y,styleSpec:S}):z&&C[z[1]]&&C[z[1]].transition?Gn({key:j,value:o[j],valueSpec:S.transition,style:y,styleSpec:S}):C[j]?Gn({key:j,value:o[j],valueSpec:C[j],style:y,styleSpec:S}):[new r.a3(j,o[j],`unknown property "${j}"`)])}if(o.source)if(r.a0(o.source)){const j=y.sources&&y.sources[o.source],z=j&&r.J(j.type);j?z!=="raster-dem"&&I.push(new r.V(`${d}.source`,o.source,`terrain cannot be used with a source of type ${z}, it only be used with a "raster-dem" source type`)):I.push(new r.V(`${d}.source`,o.source,`source "${o.source}" not found`))}else I.push(new r.V(`${d}.source`,o.source,"source must be a string"));else I.push(new r.V(d,o,'terrain is missing required property "source"'));return I}function Kn(g){const o=g.value,d=g.style,y=g.styleSpec,S=y.fog;if(o===void 0)return[];if(!r.H(o))return[new r.V("fog",o,`object expected, ${r.K(o)} found`)];let C=[];for(const I in o){const j=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);C=C.concat(z&&S[z[1]]?Gn({key:I,value:o[I],valueSpec:{type:"string"},style:d,styleSpec:y}):j&&S[j[1]]&&S[j[1]].transition?Gn({key:I,value:o[I],valueSpec:y.transition,style:d,styleSpec:y}):S[I]?Gn({key:I,value:o[I],valueSpec:S[I],style:d,styleSpec:y}):[new r.a3(I,o[I],`unknown property "${I}"`)])}return C}const St={"*":()=>[],array:wn,boolean:function(g){const o=g.value,d=g.key;return r.$(o)?[]:[new r.V(d,o,`boolean expected, ${r.K(o)} found`)]},number:Nn,color:function({key:g,value:o}){return r.a0(o)?r.a1.parseCSSColor(o)===null?[new r.V(g,o,`color expected, "${o}" found`)]:[]:[new r.V(g,o,`color expected, ${r.K(o)} found`)]},enum:Oe,filter:Bt,function:mr,layer:cr,object:er,source:bn,model:r.a7,light:Zr,"light-3d":Vr,terrain:qn,fog:Kn,string:Jn,formatted:function(g){return Jn(g).length===0?[]:Qn(g)},resolvedImage:function(g){return Jn(g).length===0?[]:Qn(g)},projection:function(g){const o=g.value,d=g.styleSpec,y=d.projection,S=g.style;if(r.H(o)){let C=[];for(const I in o)C=C.concat(Gn({key:I,value:o[I],valueSpec:y[I],style:S,styleSpec:d}));return C}return r.a0(o)?[]:[new r.V("projection",o,`object or string expected, ${r.K(o)} found`)]},import:function(g){const o=g.key,{value:d,styleSpec:y}=g;if(!r.H(d))return[new r.V(o,d,"import must be an object")];const{data:S,...C}=d;Object.defineProperty(C,"__line__",{value:d.__line__,enumerable:!1});let I=er(Object.assign({},g,{value:C,valueSpec:y.import}));return r.J(C.id)===""&&I.push(new r.V(`${g.key}.id`,C,"import id can't be an empty string")),S&&(I=I.concat(nr(S,y,{key:`${g.key}.data`}))),I},iconset:function(g){const o=g.value,d=g.key,y=g.styleSpec,S=g.style;if(!r.H(o))return[new r.V(d,o,"object expected")];if(!o.type)return[new r.V(d,o,'"type" is required')];const C=r.J(o.type);let I=[];if(I=I.concat(er({key:d,value:o,valueSpec:y[`iconset_${C}`],style:S,styleSpec:y})),(function(j,z){return!(j!=="source"||!z.source)})(C,o)){const j=S.sources&&S.sources[o.source],z=j&&r.J(j.type);j?z!=="raster-array"&&I.push(new r.V(d,o.source,`iconset cannot be used with a source of type ${String(z)}, it only be used with a "raster-array" source type`)):I.push(new r.V(d,o.source,`source "${o.source}" not found`))}return I}};function Gn(g,o=!1){const d=g.value,y=g.valueSpec,S=g.styleSpec;if(y.expression){if(r.a4(r.J(d)))return mr(g);if(r.Q(r.S(d)))return Qn(g)}if(y.type&&St[y.type]){const C=St[y.type](g);return o===!0&&C.length>0&&Array.isArray(g.value)?Qn(g):C}return er(Object.assign({},g,{valueSpec:y.type?S[y.type]:y}))}function er(g){const o=g.key,d=g.value,y=g.valueSpec||{},S=g.objectElementValidators||{},C=g.style,I=g.styleSpec;if(!r.H(d))return[new r.V(o,d,`object expected, ${r.K(d)} found`)];let j=[];for(const z in d){const $=z.split(".")[0];let q;S[$]?q=S[$]:y[$]?q=Gn:S["*"]?q=S["*"]:y["*"]&&(q=Gn),q?j=j.concat(q({key:(o&&`${o}.`)+z,value:d[z],valueSpec:y[$]||y["*"],style:C,styleSpec:I,object:d,objectKey:z},d)):j.push(new r.a3(o,d[z],`unknown property "${z}"`))}for(const z in y){if(S[z])continue;const $=y[z];$.required&&$.default===void 0&&d[z]===void 0&&j.push(new r.V(o,d,`missing required property "${z}"`))}return j}function gr({key:g,value:o}){const d=Jn({key:g,value:o});if(d.length)return d;const y=o;return y.indexOf("{fontstack}")===-1&&d.push(new r.V(g,o,'"glyphs" url must include a "{fontstack}" token')),y.indexOf("{range}")===-1&&d.push(new r.V(g,o,'"glyphs" url must include a "{range}" token')),d}function nr(g,o=r.a6,d={}){return er({key:d.key||"",value:g,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:g,objectElementValidators:{glyphs:gr}})}function ln(g,o=r.a6){return ut(nr(g,o))}const Tr=g=>ut(bn(g)),ni=g=>ut(Zr(g)),Yi=g=>ut(Vr(g)),ns=g=>ut(qn(g)),Ht=g=>ut(Kn(g)),cs=g=>ut((function(o){const d=o.value,y=o.style,S=o.styleSpec,C=S.snow;if(d===void 0)return[];if(!r.H(d))return[new r.V("snow",d,`object expected, ${r.K(d)} found`)];let I=[];for(const j in d){const z=j.match(/^(.*)-transition$/);I=I.concat(z&&C[z[1]]&&C[z[1]].transition?Gn({key:j,value:d[j],valueSpec:S.transition,style:y,styleSpec:S}):C[j]?Gn({key:j,value:d[j],valueSpec:C[j],style:y,styleSpec:S}):[new r.a3(j,d[j],`unknown property "${j}"`)])}return I})(g)),rl=g=>ut((function(o){const d=o.value,y=o.style,S=o.styleSpec,C=S.rain;if(d===void 0)return[];if(!r.H(d))return[new r.V("rain",d,`object expected, ${r.K(d)} found`)];let I=[];for(const j in d){const z=j.match(/^(.*)-transition$/);I=I.concat(z&&C[z[1]]&&C[z[1]].transition?Gn({key:j,value:d[j],valueSpec:S.transition,style:y,styleSpec:S}):C[j]?Gn({key:j,value:d[j],valueSpec:C[j],style:y,styleSpec:S}):[new r.a3(j,d[j],`unknown property "${j}"`)])}return I})(g)),ho=g=>ut(cr(g)),Qr=g=>ut(Bt(g)),Rs=g=>ut(rn(g)),ea=g=>ut(wr(g)),Hl=g=>ut(r.a7(g));function ut(g){return g.slice().sort(((o,d)=>o.line&&d.line?o.line-d.line:0))}function me(g,o){let d=!1;if(o&&o.length)for(const y of o)y instanceof r.a3?r.w(y.message):(g.fire(new r.y(new Error(y.message))),d=!0);return d}const ve=r.a6.light;let Fe;class tt extends r.E{constructor(o,d="flat"){super(),this._transitionable=new r.a8(Fe||(Fe=new r.a9({anchor:new r.aa(ve.anchor),position:new r.ab(ve.position),color:new r.aa(ve.color),intensity:new r.aa(ve.intensity)}))),this.setLight(o,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d,y={}){this._validate(ni,o,y)||(this._transitionable.setTransitionOrValue(o),this.id=d)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y){return(!y||y.validate!==!1)&&me(this,o.call(ln,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}const Je=r.a6.terrain;let at=class extends r.E{constructor(g,o,d,y,S){super(),this.scope=d,this._transitionable=new r.a8(new r.a9({source:new r.aa(Je.source),exaggeration:new r.aa(Je.exaggeration)}),d,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=S}get(){return this._transitionable.serialize()}set(g,o){this._transitionable.setTransitionOrValue(g,o)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new r.ac(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const o=g.value.expression;if(!o)return null;let d=-1,y=-1,S=1;for(const C of o.zoomStops)S=o.evaluate(new r.ac(C,{worldview:this.worldview})),S>.01?(d=C,y=-1):y=C;return S<.01&&d>0&&y>d?[d,y]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof r.ad}};const Pt=45,ct=65,Ct=.05;function un(g,o,d,y){const S=r.ah(Pt,ct,d),[C,I]=tn(g,y);let j=1-Math.min(1,Math.exp((o-C)/(I-C)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*S*g.alpha}function tn(g,o){const d=.5/Math.tan(.5*o);return[g.range[0]+d,g.range[1]+d]}function Re(g,o,d,y,S){const C=r.af([],[o,d,y],S.mercatorFogMatrix);return un(g,r.ag(C),S.pitch,S._fov)}function gt(g,o,d,y,S,C,I){const j=[[d,y,0],[S,y,0],[S,C,0],[d,C,0]];let z=Number.MAX_VALUE,$=-Number.MAX_VALUE;for(const q of j){const ee=r.af([],q,o),Q=r.ag(ee);z=Math.min(z,Q),$=Math.max($,Q)}return[un(g,z,I.pitch,I._fov),un(g,$,I.pitch,I._fov)]}const wt=r.a6.fog;class It extends r.E{constructor(o,d,y,S){super();const C=new r.a9({range:new r.aa(wt.range),color:new r.aa(wt.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(wt["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(wt["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(wt["horizon-blend"]),"star-intensity":new r.aa(wt["star-intensity"]),"vertical-range":new r.aa(wt["vertical-range"])});this._transitionable=new r.a8(C,y,new Map(S)),this.set(o,S),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new r.ai(C),this.scope=y}get state(){const o=this._transform,d=o.projection.name==="globe",y=r.aj(o.zoom),S=this.properties.get("range"),C=[.5,3];return{range:d?[r.ak(C[0],S[0],y),r.ak(C[1],S[1],y)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d,y={}){if(this._validate(Ht,o,y))return;const S=Object.assign({},o);for(const C of Object.keys(wt))S[C]===void 0&&(S[C]=wt[C].default);this._options=S,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Pt,ct,o))*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?(function(y,S,C){const I=r.ae.fromLngLat(S),j=C.elevation?C.elevation.getAtPointOrZero(I):0;return Re(y,I.x,I.y,j,C)})(this.state,o,d):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(o.toUnwrapped());return gt(this.state,d,0,0,r.al,r.al,this._transform)}getOpacityForBounds(o,d,y,S,C){return this._transform.projection.supportsFog?gt(this.state,o,d,y,S,C,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?tn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const y of d){const S=o.points[y];let C;if(S[2]>=0)C=S;else{const I=o.points[y-4];C=r.am(I,S,I[2]/(I[2]-S[2]))}if(Re(this.state,C[0],C[1],0,this._transform)>=Ct)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y){return(!y||y.validate!==!1)&&me(this,o.call(ln,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Et,Sn,Hn,xr,vr=class extends r.E{constructor(g,o,d,y){super();const S=Et||(Et=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(S,d,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(S),this.scope=d}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),y=r.an(d[0]),S=-Math.max(r.an(d[1]),.01),C=[Math.cos(y)*Math.cos(S),Math.sin(y)*Math.cos(S),Math.sin(S)],I=this.properties.get("vignette"),j=this.properties.get("vignette-color");return j.a=I,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*g),direction:C,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(g,o,d={}){if(this._validate(cs,g,d))return;const y=Object.assign({},g),S=r.a6.snow;for(const C of Object.keys(S))y[C]===void 0&&(y[C]=S[C].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,d){return(!d||d.validate!==!1)&&me(this,g.call(ln,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},jr=class extends r.E{constructor(g,o,d,y){super();const S=Sn||(Sn=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(S,d,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(S),this.scope=d}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),y=r.an(d[0]),S=-Math.max(r.an(d[1]),.01),C=[Math.cos(y)*Math.cos(S),Math.sin(y)*Math.cos(S),Math.sin(S)],I=this.properties.get("vignette-color");return I.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(o.r,o.g,o.b,o.a*g),direction:C,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(g,o,d={}){if(this._validate(rl,g,d))return;const y=Object.assign({},g),S=r.a6.rain;for(const C of Object.keys(S))y[C]===void 0&&(y[C]=S[C].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,d){return(!d||d.validate!==!1)&&me(this,g.call(ln,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Er extends r.E{constructor(o,d,y,S){super(),this.scope=y,this._options=o,this.properties=new r.ai(d),this._transitionable=new r.a8(d,y,new Map(S)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,d){this._options=o,this._transitionable.setTransitionOrValue(o.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class fr{constructor(o,d,y){this.screenBounds=o,this.cameraPoint=y.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(o,d){let y,S;if(o instanceof r.P||typeof o[0]=="number"){const C=r.P.convert(o);y=[C],S=d.isPointAboveHorizon(C)}else{const C=r.P.convert(o[0]),I=r.P.convert(o[1]),j=C.add(I)._div(2);y=[C,I],S=r.aq(C,I).every((z=>d.isPointAboveHorizon(z)))&&d.isPointAboveHorizon(j)}return new fr(y,S,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],S=r.aq(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?S[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(S[3]=this.cameraPoint)),r.ar(S,o)}bufferedCameraGeometryGlobe(o){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],S=r.aq(d,y,o),C=this.cameraPoint.clone();switch(3*((C.y>d.y)+(C.y>y.y))+((C.x>d.x)+(C.x>y.x))){case 0:S[0]=C,S[4]=C.clone();break;case 1:S.splice(1,0,C);break;case 2:S[1]=C;break;case 3:S.splice(4,0,C);break;case 5:S.splice(2,0,C);break;case 6:S[3]=C;break;case 7:S.splice(3,0,C);break;case 8:S[2]=C}return S}containsTile(o,d,y,S=0){const C=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/d._pixelsPerMercatorPixel+1,I=y?this._bufferedCameraMercator(C,d):this._bufferedScreenMercator(C,d);let j=o.tileID.wrap+(I.unwrapped?S:0);const z=I.polygon.map((be=>r.as(o.tileTransform,be,j)));if(!r.at(z,0,0,r.al,r.al))return;j=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const $=this.screenGeometryMercator.polygon.map((be=>r.au(o.tileTransform,be,j))),q=$.map((be=>new r.P(be[0],be[1]))),ee=d.getFreeCameraOptions().position||new r.ae(0,0,0),Q=r.au(o.tileTransform,ee,j),ie=$.map((be=>{const _e=r.av(be,be,Q);return r.aw(_e,_e),new r.ax(Q,_e)})),le=r.ay(o,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:ie,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(de=r.az(z),de.min.x=r.aA(de.min.x,0,r.al),de.min.y=r.aA(de.min.y,0,r.al),de.max.x=r.aA(de.max.x,0,r.al),de.max.y=r.aA(de.max.y,0,r.al),de),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:le};var de}_bufferedScreenMercator(o,d){const y=vi(o);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let S;return S=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),d):{polygon:this.bufferedScreenGeometry(o).map((C=>d.pointCoordinate3D(C))),unwrapped:!0},this._screenRaycastCache[y]=S,S}}_bufferedCameraMercator(o,d){const y=vi(o);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let S;return S=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),d):{polygon:this.bufferedCameraGeometry(o).map((C=>d.pointCoordinate3D(C))),unwrapped:!0},this._cameraRaycastCache[y]=S,S}}_projectAndResample(o,d){const y=(function(C,I){const j=r.aB([],I.pixelMatrix,I.globeMatrix),z=[0,-r.aD,0,1],$=[0,r.aD,0,1],q=[0,0,0,1];r.aC(z,z,j),r.aC($,$,j),r.aC(q,q,j);const ee=new r.P(z[0]/z[3],z[1]/z[3]),Q=new r.P($[0]/$[3],$[1]/$[3]),ie=r.aE(C,ee)&&z[3]<q[3],le=r.aE(C,Q)&&$[3]<q[3];if(!ie&&!le)return null;const de=(function(Xe,ze,De){for(let Qe=1;Qe<Xe.length;Qe++){const dt=ai(ze.pointCoordinate3D(Xe[Qe-1]).x),lt=ai(ze.pointCoordinate3D(Xe[Qe]).x);if(De<0){if(dt<lt)return{idx:Qe,t:-dt/(lt-1-dt)}}else if(lt<dt)return{idx:Qe,t:(1-dt)/(lt+1-dt)}}return null})(C,I,ie?-1:1);if(!de)return null;const{idx:be,t:_e}=de;let Se=be>1?ur(C.slice(0,be),I):[],Pe=be<C.length?ur(C.slice(be),I):[];Se=Se.map((Xe=>new r.P(ai(Xe.x),Xe.y))),Pe=Pe.map((Xe=>new r.P(ai(Xe.x),Xe.y)));const Ee=[...Se];Ee.length===0&&Ee.push(Pe[Pe.length-1]);const We=r.ak(Ee[Ee.length-1].y,(Pe.length===0?Se[0]:Pe[0]).y,_e);let Ne;return Ne=ie?[new r.P(0,We),new r.P(0,0),new r.P(1,0),new r.P(1,We)]:[new r.P(1,We),new r.P(1,1),new r.P(0,1),new r.P(0,We)],Ee.push(...Ne),Pe.length===0?Ee.push(Se[0]):Ee.push(...Pe),{polygon:Ee.map((Xe=>new r.ae(Xe.x,Xe.y))),unwrapped:!1}})(o,d);if(y)return y;const S=(function(C,I){let j=!1,z=-1/0,$=0;for(let ee=0;ee<C.length-1;ee++)C[ee].x>z&&(z=C[ee].x,$=ee);for(let ee=0;ee<C.length-1;ee++){const Q=($+ee)%(C.length-1),ie=C[Q],le=C[Q+1];Math.abs(ie.x-le.x)>.5&&(ie.x<le.x?(ie.x+=1,Q===0&&(C[C.length-1].x+=1)):(le.x+=1,Q+1===C.length-1&&(C[0].x+=1)),j=!0)}const q=r.aF(I.center.lng);return j&&q<Math.abs(q-1)&&C.forEach((ee=>{ee.x-=1})),{polygon:C,unwrapped:j}})(ur(o,d).map((C=>new r.P(ai(C.x),C.y))),d);return{polygon:S.polygon.map((C=>new r.ae(C.x,C.y))),unwrapped:S.unwrapped}}}function ur(g,o){return r.aG(g,(d=>{const y=o.pointCoordinate3D(d);d.x=y.x,d.y=y.y}),1/256)}function ai(g){return g<0?1+g%1:g%1}function vi(g){return 100*g|0}function li(g,o,d,y,S){const C=function(j,z){if(j)return S(j);if(z){if(g.url&&z.tiles&&g.tiles&&delete g.tiles,z.variants){if(!Array.isArray(z.variants))return S(new Error("variants must be an array"));for(const q of z.variants){if(q==null||typeof q!="object"||q.constructor!==Object)return S(new Error("variant must be an object"));if(!Array.isArray(q.capabilities))return S(new Error("capabilities must be an array"));if(q.capabilities.length===1&&q.capabilities[0]==="meshopt"){z=Object.assign(z,q);break}}}const $=r.aH(Object.assign({},z,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);$.tiles=o.canonicalizeTileset($,g.url),S(null,$)}},I=(function(j,z,$){if(!j)return null;if(!z&&!$)return j;$=$||j.worldview_default;const q=Object.values(j.language||{});if(q.length===0)return null;const ee=Object.values(j.worldview||{});if(ee.length===0)return null;const Q=q.every((le=>le===z)),ie=ee.every((le=>le===$));return Q&&ie?j:z in(j.language_options||{})||$ in(j.worldview_options||{})?null:j.language_options&&j.worldview_options?j:null})(g.data,d,y);return I?r.o.frame((()=>C(null,I))):g.url?r.m(o.transformRequest(o.normalizeSourceURL(g.url,null,d,y),r.R.Source),C):r.o.frame((()=>{const{data:j,...z}=g;C(null,z)}))}function ii(g,o){const d=Math.pow(2,o.z),y=Math.floor(r.aF(g.getWest())*d),S=Math.floor(r.aJ(g.getNorth())*d),C=Math.ceil(r.aF(g.getEast())*d),I=Math.ceil(r.aJ(g.getSouth())*d);return o.x>=y&&o.x<C&&o.y>=S&&o.y<I}class Or{constructor(o,d,y){this.bounds=o?r.aI.convert(this.validateBounds(o)):null,this.minzoom=d||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const d of o)this.extraBounds.push(r.aI.convert(this.validateBounds(d)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!ii(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const d of this.extraBounds)if(ii(d,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const d=new Or(o.bounds,o.minzoom,o.maxzoom);return d.addExtraBounds(o.extra_bounds),d}}class Qi extends r.E{constructor(o,d,y,S){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(d,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new r.aK}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,d,y,((S,C)=>{if(this._tileJSONRequest=null,this._loaded=!0,S)d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new r.y(S));else if(C){if(Object.assign(this,C),this.hasWorldviews=!!C.worldview_options,C.worldview_default&&(this.worldviewDefault=C.worldview_default),C.vector_layers){this.vectorLayers=C.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const I of C.vector_layers)this.vectorLayerIds.push(I.id),C.worldview&&C.worldview[I.source]&&this.localizableLayerIds.add(I.id)}this.tileBounds=Or.fromTileJSON(C),st(C.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(S)}))}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(o)))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,d){const y=o.tileID.canonical.url(this.tiles,this.scheme),S=this.map._requestManager.normalizeTileURL(y),C=this.map._requestManager.transformRequest(S,r.R.Tile),I=this.map.style?this.map.style.getLut(this.scope):null,j=I?{image:I.image.clone()}:null,z={request:C,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:j,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(y)&&(z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",z,$.bind(this));else if(o.actor=this._tileWorkers[S]=this._tileWorkers[S]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",z,$.bind(this),void 0,!0);else{const q=r.aL.call({deduped:this._deduped},z,((ee,Q)=>{if(ee||!Q)$.call(this,ee);else{const ie=r.aM(Q.responseHeaders);z.data={cacheControl:ie.cacheControl,expires:ie.expires,rawData:Q.rawData.slice(0)},o.actor&&o.actor.send("loadTile",z,$.bind(this),void 0,!0)}}),!0);o.request={cancel:q}}function $(q,ee){return delete o.request,o.aborted?d(null):q&&q.status!==404?d(q):(ee&&ee.resourceTiming&&(o.resourceTiming=ee.resourceTiming),this.map._refreshExpiredTiles&&ee&&o.setExpiryData(ee),o.loadVectorData(ee,this.map.painter),r.aN(this.dispatcher),d(null,ee),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ni extends r.E{constructor(o,d,y,S){super(),this.id=o,this.dispatcher=y,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},d),Object.assign(this,r.aH(d,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const d=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,null,d,((y,S)=>{this._tileJSONRequest=null,this._loaded=!0,y?this.fire(new r.y(y)):S&&(Object.assign(this,S),S.raster_layers&&(this.rasterLayers=S.raster_layers,this.rasterLayerIds=this.rasterLayers.map((C=>C.id))),this.tileBounds=Or.fromTileJSON(S),st(S.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(y)}))}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(o)))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const y=r.o.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);o.request=r.n(this.map._requestManager.transformRequest(S,r.R.Tile),((C,I,j)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(C)return o.state="errored",d(C);if(!I)return d(null);const z=r.aM(j);this.map._refreshExpiredTiles&&o.setExpiryData(z),o.setTexture(I,this.map.painter),o.state="loaded",r.aN(this.dispatcher),d(null)}))}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d&&d()}unloadTile(o,d){o.texture&&o.texture instanceof r.T?(o.destroy(!0),o.texture&&o.texture instanceof r.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ko([g,o],d,y,{scaled:S=!0}={}){const{tileSize:C,buffer:I}=y,{x:j,y:z,z:$}=d;if(!isFinite(j)||!isFinite(z)||!isFinite($))throw new Error("Invalid MRT header");const q=2**$,ee=q*r.aF(g),Q=q*r.aJ(o);return(function([ie,le],de,{scaled:be=!0}={}){if(!de)throw new Error("bandView is undefined");const{data:_e,tileSize:Se,buffer:Pe,offset:Ee,scale:We,dimension:Ne}=de;if(ie<-Pe||ie>Se+Pe||le<-Pe||le>Se+Pe)throw new Error(`Point (${ie}, ${le}) out of bounds for tileSize=${Se}, buffer=${Pe}`);const Xe=(le+Pe)*(Se+2*Pe)+(ie+Pe);if(new Uint32Array(_e.buffer)[Xe]===4294967295)return null;let ze=[];ze=be?[]:new de.data.constructor(Ne);for(let De=0;De<Ne;De++)ze[De]=Math.round(1e12*(_e[Ne*Xe+De]*We+Ee))/1e12;return ze})([Math.min(Math.max(-I,Math.floor((ee-j)*C)),C-1+I),Math.min(Math.max(-I,Math.floor((Q-z)*C)),C-1+I)],y,{scaled:S})}class Gs extends Ni{constructor(o,d,y,S){super(o,d,y,S),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},d)}triggerRepaint(o){const d=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);d&&d.enabled&&y&&d._clearRenderCacheForTile(y.id,o.tileID),this.map.triggerRepaint()}loadTile(o,d){const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),S=this.map._requestManager.transformRequest(y,r.R.Tile),C={request:S,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=S,o.actor||(o.actor=this.dispatcher.getActor());const I=(j,z,$)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(j)return j.name==="AbortError"?void 0:(o.state="errored",d(j));if(this.map._refreshExpiredTiles&&z){const q=r.aM($);o.setExpiryData(q)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!z)return d(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=z}d(null)};o.request=this.partial?o.fetchHeader(void 0,I.bind(this)):o.actor.send("loadTile",C,I.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){const y=o.texturePerLayer;if(o.flushAllQueues(),y.size){o.destroy(!0);for(const S of y.values())this.map.painter.saveTileTexture(S)}else o.destroy()}prepareTile(o,d,y,S){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(d,y,S,((C,I)=>{if(C)return o.state="errored",this.fire(new r.y(C)),void this.triggerRepaint(o);I&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(y,I,this.map.painter),o.state="loaded",this.triggerRepaint(o))})))}getInitialBand(o){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find((({id:C})=>C===o)),y=d&&d.fields,S=y&&y.bands&&y.bands;return S?S[0]:0}getTextureDescriptor(o,d,y){if(!o)return;const S=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!S)return;let C=null;d instanceof r.aQ?C=d.paint.get("raster-array-band"):d instanceof r.aR&&(C=d.paint.get("raster-particle-array-band"));const I=C||this.getInitialBand(S);if(I==null)return;if(!o.textureDescriptorPerLayer.get(d.id))return void this.prepareTile(o,S,d.id,I);if(o.updateNeeded(d.id,I)&&!y)return;const j=o.textureDescriptorPerLayer.get(d.id);return Object.assign({},j,{texture:o.texturePerLayer.get(d.id)})}getImages(o,d){const y=new Map;for(const S of o)for(const C of d){const[I,j]=C.split("/"),z=S.getLayer(I);if(!z||!z.hasBand(j)||!z.hasDataForBand(j))continue;const{bytes:$,tileSize:q,buffer:ee}=z.getBandView(j),Q=q+2*ee,ie={data:new r.q({width:Q,height:Q},$),pixelRatio:2,sdf:!1,usvg:!1,version:0};y.set(C,ie)}return y}queryRasterArrayValueByBandId(o,d,y){const S=d._mrt;return new Promise((C=>{const I={},j=new Set;for(const[z,$]of Object.entries(S.layers)){if(y.layerName&&z!==y.layerName)continue;const q={};I[z]=q;for(const{bands:ee}of $.dataIndex)for(const Q of ee)y.bands&&!y.bands.includes(Q)||(j.add(r.B(z,Q)),d.fetchBand(z,null,Q,(ie=>{r.o.frame((()=>{q[Q]=ie?null:ko([o.lng,o.lat],S,$.getBandView(Q)),j.delete(r.B(z,Q)),j.size===0&&C(I)}))}),!1))}j.size===0&&C(I)}))}_loadTileForQuery(o,d){if(this._loadTileLoaded[o.uid])return void d(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(d);this._loadTilePending[o.uid]=[d];const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),S=this.map._requestManager.transformRequest(y,r.R.Tile);o.actor.send("loadTile",{request:S,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((C,I,j)=>{if(C)return this._loadTilePending[o.uid].forEach((z=>z(C,null))),void delete this._loadTilePending[o.uid];if(!I)return this._loadTilePending[o.uid].forEach((z=>z(null,null))),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&I){const z=r.aM(j);o.setExpiryData(z)}o._mrt=I,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach((z=>z(null,I))),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(o,d,y){return new Promise(((S,C)=>{this._loadTileForQuery(d,((I,j)=>{I?C(I):S(j?this.queryRasterArrayValueByBandId(o,d,y):null)}))}))}queryRasterArrayValue(o,d){const y=r.aS.convert(o),S=this.findLoadedParent(y);return S&&S._mrt?d.bands||!this.partial?this.queryRasterArrayValueByBandId(y,S,d):this.queryRasterArrayValueByAllBands(y,S,d):Promise.resolve(null)}findLoadedParent(o){const d=r.ae.fromLngLat(o,this.map.transform.tileSize),y=this.maxzoom+1,S=1<<y,C=Math.floor(d.x),I=Math.floor((d.x-C)*S),j=Math.floor(d.y*S),z=this.map.style.getSourceCache(this.id),$=new r.aP(y,C,y,I,j);return z.findLoadedParent($,this.minzoom)}}const Zs={vector:Qi,raster:Ni,"raster-dem":class extends Ni{constructor(g,o,d,y){super(g,o,d,y),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(g,o){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(S,C){S&&(g.state="errored",o(S)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",o(null))}g.request=r.n(this.map._requestManager.transformRequest(d,r.R.Tile),(function(S,C,I){if(delete g.request,g.aborted)g.state="unloaded",o(null);else if(S)g.state="errored",o(S);else if(C){const j=r.aM(I);this.map._refreshExpiredTiles&&g.setExpiryData(j);const z=ImageBitmap&&C instanceof ImageBitmap&&r.r(),$=1-(C.width-r.aO(C.width))/2;$<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const q=z?C:r.o.getImageData(C,$),ee={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:q,encoding:this.encoding,padding:$};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",ee,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const o=g.canonical,d=Math.pow(2,o.z),y=(o.x-1+d)%d,S=o.x===0?g.wrap-1:g.wrap,C=(o.x+1+d)%d,I=o.x+1===d?g.wrap+1:g.wrap,j={};return j[new r.aP(g.overscaledZ,S,o.z,y,o.y).key]={backfilled:!1},j[new r.aP(g.overscaledZ,I,o.z,C,o.y).key]={backfilled:!1},o.y>0&&(j[new r.aP(g.overscaledZ,S,o.z,y,o.y-1).key]={backfilled:!1},j[new r.aP(g.overscaledZ,g.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},j[new r.aP(g.overscaledZ,I,o.z,C,o.y-1).key]={backfilled:!1}),o.y+1<d&&(j[new r.aP(g.overscaledZ,S,o.z,y,o.y+1).key]={backfilled:!1},j[new r.aP(g.overscaledZ,g.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},j[new r.aP(g.overscaledZ,I,o.z,C,o.y+1).key]={backfilled:!1}),j}},"raster-array":Gs,geojson:class extends r.E{constructor(g,o,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const S=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*S,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*S,extent:r.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*S,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const d of this._data.features)o.set(d.id,d);for(const d of g.features)o.set(d.id,d);this._data.features=[...o.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterChildren(g,o){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterLeaves(g,o,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:o,offset:d},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:g},this.workerOptions);o.scope=this.scope;const d=this._data;typeof d=="string"?(o.request=this.map._requestManager.transformRequest(r.o.resolveURL(d),r.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,((y,S)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new r.y(y));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&S&&S.resourceTiming&&S.resourceTiming[this.id]&&(C.resourceTiming=S.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new r.z("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const g=r.B(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,o){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,S=y?{image:y.image.clone()}:null,C=this._partialReload,I={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:S,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:C,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};g.request=this.actor.send(d,I,((j,z)=>C&&!z?(g.state="loaded",o(null)):(delete g.request,g.destroy(),g.aborted?o(null):j?o(j):(g.loadVectorData(z,this.map.painter,d==="reloadTile"),o(null)))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,o){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aT{constructor(g,o,d,y){super(g,o,d,y),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const o of g.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.R.Source).url);r.aU(this.urls,((o,d)=>{this._loaded=!0,o?this.fire(new r.y(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const o=this.video.seekable;g<o.start(0)||g>o.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,o=g.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(g,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aT,model:r.aW,"batched-model":class extends r.E{constructor(g,o,d,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(g)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,o,d,((y,S)=>{this._tileJSONRequest=null,this._loaded=!0,y?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new r.y(y))):S&&(Object.assign(this,S),S.bounds&&(this.tileBounds=new Or(S.bounds,this.minzoom,this.maxzoom)),st(S.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)}))}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,o){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,r.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=o;else{if(g.buckets){const C=Object.values(g.buckets);for(const I of C)I.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,S.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,S.bind(this),void 0,!0);function S(C,I){return g.aborted?o(null):C&&C.status!==404?o(C):(this.map._refreshExpiredTiles&&I&&g.setExpiryData(I),g.loadModelData(I,this.map.painter),g.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aT{constructor(g,o,d,y){super(g,o,d,y),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((C=>typeof C!="number"))))||this.fire(new r.y(new r.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${g}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof r.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends r.E{constructor(g,o,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Or(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:o,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:o,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,o){const{x:d,y,z:S}=g.tileID.canonical,C=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:S},{signal:C.signal})).then((function(I){return delete g.request,g.aborted?(g.state="unloaded",o(null)):I===void 0?(g.state="errored",o(null)):I===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",o(null)):(function(j){return j instanceof ImageData||j instanceof HTMLCanvasElement||j instanceof ImageBitmap||j instanceof HTMLImageElement})(I)?(this.loadTileData(g,I),g.state="loaded",void o(null)):(g.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((I=>{I.name!=="AbortError"&&(g.state="errored",o(I))})),g.request.cancel=()=>C.abort()}loadTileData(g,o){g.setTexture(o,this.map.painter)}unloadTile(g,o){if(g.texture&&g.texture instanceof r.T?(g.destroy(!0),g.texture&&g.texture instanceof r.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y,z:S}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:S})}o&&o()}abortTile(g,o){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z})))}_clearTiles(){const g=r.B(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},mo=function(g,o,d,y){const S=new Zs[o.type](g,o,d,y);if(S.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${S.id}`);return r.aX(["load","abort","unload","serialize","prepare"],S),S};function ds(g,o,d=""){return`${d}:${o.id||""}:${o.layer.id}:${(function(y){if("layerId"in y)return`layer:${y.layerId}`;{const{featuresetId:S,importId:C}=y;return`featureset:${S}${C?`:import:${C}`:""}`}})(g.target)}`}function Is(g,o,d,y=""){if(g.uniqueFeatureID){const S=ds(g,o,y);if(d.has(S))return!0;d.add(S)}return!1}function eo(g,o,d,y,S=!1){const C=o.sourceCache.transform,I=o.sourceCache.tilesIn(g,o.has3DLayers,S);I.sort(Zc);const j=[];for(const z of I){const $=z.tile.queryRenderedFeatures(o,z,d,y,C,S);Object.keys($).length&&j.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:$})}for(const z in o.layers){const $=o.layers[z];if($.styleLayer){const q=$.styleLayer.queryRenderedFeatures(g,o.sourceCache,y);Object.keys(q).length&&j.push({wrappedTileID:0,queryResults:q})}}return j.length===0?{}:(function(z){const $={},q={};for(const ee of z){const Q=ee.queryResults,ie=ee.wrappedTileID,le=q[ie]=q[ie]||{};for(const de in Q){const be=Q[de],_e=le[de]=le[de]||{},Se=$[de]=$[de]||[];for(const Pe of be)_e[Pe.featureIndex]||(_e[Pe.featureIndex]=!0,Se.push(Pe))}}return $})(j)}function wo(g,o,d,y,S,C){const I={},j=y.queryRenderedSymbols(g),z=[];for(const $ of Object.keys(j).map(Number))z.push(S[$]);z.sort(Zc);for(const $ of z){const q=$.featureIndex.lookupSymbolFeatures(j[$.bucketInstanceId],$.bucketIndex,$.sourceLayerIndex,o,d,C);for(const ee in q){const Q=I[ee]=I[ee]||[],ie=q[ee];ie.sort(((le,de)=>{const be=$.featureSortOrder;if(be){const _e=be.indexOf(le.featureIndex);return be.indexOf(de.featureIndex)-_e}return de.featureIndex-le.featureIndex}));for(const le of ie)Q.push(le)}}return I}function ji(g,o){const d=g.getRenderableIds().map((C=>g.getTileByID(C))),y=[],S={};for(let C=0;C<d.length;C++){const I=d[C],j=I.tileID.canonical.key;S[j]||(S[j]=!0,I.querySourceFeatures(y,o))}return y}function Zc(g,o){const d=g.tileID,y=o.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function il(g,o){const d={};if(!o)return d;for(const y of g){const S=y.layerIds.map((C=>o.getLayer(C))).filter(Boolean);if(S.length!==0){y.layers=S,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map((C=>S.filter((I=>I.id===C))[0])));for(const C of S)d[C.fqid]=y}}return d}const ca=32,Gl=33,ua=new Uint16Array(8184);for(let g=0;g<2046;g++){let o=g+2,d=0,y=0,S=0,C=0,I=0,j=0;for(1&o?S=C=I=ca:d=y=j=ca;(o>>=1)>1;){const $=d+S>>1,q=y+C>>1;1&o?(S=d,C=y,d=I,y=j):(d=S,y=C,S=I,C=j),I=$,j=q}const z=4*g;ua[z+0]=d,ua[z+1]=y,ua[z+2]=S,ua[z+3]=C}const sl=new Uint16Array(2178),mc=new Uint8Array(1089),Qc=new Uint16Array(1089);function gc(g){return g===0?-.03125:g===32?.03125:0}const yc={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class da{constructor(o,d,y,S,C,I){this.tileID=o,this.uid=r.b1(),this.uses=0,this.tileSize=d,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=C,S&&S.style&&(this._lastUpdatedBrightness=S.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",S&&S.transform&&(this.projection=S.transform.projection),this.worldview=I,this._hasAppearances=null}registerFadeDuration(o){const d=o+this.timeAdded;d<r.o.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,d,y){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=il(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const S in this.buckets){const C=this.buckets[S];if(C instanceof r.b3){if(this.hasSymbolBuckets=!0,!y)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const S in this.buckets){const C=this.buckets[S];if(C instanceof r.b3&&C.hasRTLText){this.hasRTLText=!0,r.b4();break}}this.queryPadding=0;for(const S in this.buckets){const C=this.buckets[S],I=d.style.getOwnLayer(S);if(!I)continue;const j=I.queryRadius(C);this.queryPadding=Math.max(this.queryPadding,j)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new r.b2}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,d,y){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,il(o.buckets,d.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,d){for(const C in this.buckets){const I=this.buckets[C];if(I.uploadPending()){let j={},z=[],$={zoom:0,pitch:0,brightness:0,worldview:""};if(d){if(d.style){z=d.style.listImages();const q=I.layers[0],ee=q.sourceLayer||"_geojsonTileLayer",Q=d.style.getLayerSourceCache(q);Q&&(j=Q._state.getState(ee,void 0))}$={zoom:d.transform.zoom||0,pitch:d.transform.pitch||0,brightness:d.style.getBrightness()||0,worldview:d.worldview||""}}I.upload(o,this.tileID.canonical,j,z,$)}}const y=o.gl,S=this.imageAtlas;S&&!S.uploaded&&(this.imageAtlasTexture=new r.T(o,S.image,y.RGBA8,{useMipmap:!!S.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(o,this.glyphAtlasImage,y.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(o,this.lineAtlas.image,y.R8),this.lineAtlas.uploaded=!0)}prepare(o,d,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,y),!d||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const S=d.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(d)),(this._lastUpdatedBrightness||S||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&S&&Math.abs(this._lastUpdatedBrightness-S)<.001||(this.updateBuckets(d,this._lastUpdatedBrightness!==S),this._lastUpdatedBrightness=S))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const d in this.buckets){const y=this.buckets[d];y.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,y.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,d,y,S,C,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const j=this.evaluateQueryRenderedFeaturePadding(),z=(function($,q){const ee=r.bp([],[.5*$.width,.5*-$.height,1]);return r.bq(ee,ee,[1,-1,0]),r.aB(ee,ee,$.calculateProjMatrix(q.toUnwrapped())),Float32Array.from(ee)})(C,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:d,pixelPosMatrix:z,transform:S,availableImages:y,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:j})}querySourceFeatures(o,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const S=y.loadVTLayers(),C=d?d.sourceLayer:"",I=S._geojsonTileLayer||S[C];if(!I)return;const j=r.b5(d&&d.filter),{z,x:$,y:q}=this.tileID.canonical,ee={z,x:$,y:q};for(let Q=0;Q<I.length;Q++){const ie=I.feature(Q);if(j.needGeometry){const be=r.b6(ie,!0);if(!j.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),be,this.tileID.canonical))continue}else if(!j.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ie))continue;const le=y.getId(ie,C),de=new r.b7(ie,z,$,q,le);de.tile=ee,o.push(de)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const y=r.b8(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let S=!1;if(this.expirationTime>y)S=!1;else if(d)if(this.expirationTime<d)S=!0;else{const C=this.expirationTime-d;C?this.expirationTime=y+Math.max(C,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const d in this.buckets)if(o.style.hasLayer(d)&&this.buckets[d].layers.some((y=>y.appearances&&y.appearances.length>0)))return!0;return!1}updateBuckets(o,d){if(!this.latestFeatureIndex||!o.style)return;const y=this.latestFeatureIndex.loadVTLayers(),S=o.style.listImages(),C=o.style.getBrightness();for(const I in this.buckets){if(!o.style.hasLayer(I))continue;const j=this.buckets[I],z=j.layers[0],$=z.sourceLayer||"_geojsonTileLayer",q=y[$],ee=o.style.getLayerSourceCache(z);let Q={};ee&&(Q=ee._state.getState($,void 0));const ie=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(Q).length>0&&!d;if(j.hasAppearances=j.layers.some((be=>be.appearances&&be.appearances.length>0)),(le&&j.stateDependentLayers.length!==0||d)&&j.update(Q,q,S,ie,le?j.stateDependentLayers:j.layers,d,C),le&&j.stateDependentLayers.length!==0||d||j.hasAppearances){const be={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};j.updateAppearances(this.tileID.canonical,Q,S,be)}(j instanceof r.b9||j instanceof r.ba)&&o._terrain&&o._terrain.enabled&&ee&&j.uploadPending()&&o._terrain._clearRenderCacheForTile(ee.id,this.tileID);const de=o&&o.style&&o.style.getOwnLayer(I);de&&(this.queryPadding=Math.max(this.queryPadding,de.queryRadius(j)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=r.o.now()+o}setTexture(o,d){const y=d.context,S=y.gl;this.texture=this.texture||d.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o):(this.texture=new r.T(y,o,S.RGBA8,{useMipmap:!0}),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE))}setDependencies(o,d){const y={};for(const S of d)y[S]=!0;this.dependencies[o]=y}hasDependency(o,d){for(const y of o){const S=this.dependencies[y];if(S){for(const C of d)if(S[C])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const y=r.bb(yc,this.tileID.canonical,this.tileTransform)[0],S=new r.bc,C=new r.bd;for(let I=0;I<y.length;I++){const{x:j,y:z}=y[I];S.emplaceBack(j,z),C.emplaceBack(I)}C.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(C),this._tileDebugBuffer=o.createVertexBuffer(S,r.be.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,S.length,C.length)}_makeTileBoundsBuffers(o,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const y=r.bb(yc,this.tileID.canonical,this.tileTransform)[0];let S,C;if(this.isRaster){const I=(function(j,z){const $=r.aY(j,z),q=Math.pow(2,j.z);for(let be=0;be<Gl;be++)for(let _e=0;_e<Gl;_e++){const Se=r.aZ((j.x+(_e+gc(_e))/ca)/q),Pe=r.a_((j.y+(be+gc(be))/ca)/q),Ee=z.project(Se,Pe),We=be*Gl+_e;sl[2*We+0]=Math.round((Ee.x*$.scale-$.x)*r.al),sl[2*We+1]=Math.round((Ee.y*$.scale-$.y)*r.al)}mc.fill(0),Qc.fill(0);for(let be=2045;be>=0;be--){const _e=4*be,Se=ua[_e+0],Pe=ua[_e+1],Ee=ua[_e+2],We=ua[_e+3],Ne=Se+Ee>>1,Xe=Pe+We>>1,ze=Ne+Xe-Pe,De=Xe+Se-Ne,Qe=Pe*Gl+Se,dt=We*Gl+Ee,lt=Xe*Gl+Ne,Lt=Math.hypot((sl[2*Qe+0]+sl[2*dt+0])/2-sl[2*lt+0],(sl[2*Qe+1]+sl[2*dt+1])/2-sl[2*lt+1])>=16;mc[lt]=mc[lt]||(Lt?1:0),be<1022&&(mc[lt]=mc[lt]||mc[(Pe+De>>1)*Gl+(Se+ze>>1)]||mc[(We+De>>1)*Gl+(Ee+ze>>1)])}const ee=new r.a$,Q=new r.b0;let ie=0;function le(be,_e){const Se=_e*Gl+be;return Qc[Se]===0&&(ee.emplaceBack(sl[2*Se+0],sl[2*Se+1],be*r.al/ca,_e*r.al/ca),Qc[Se]=++ie),Qc[Se]-1}function de(be,_e,Se,Pe,Ee,We){const Ne=be+Se>>1,Xe=_e+Pe>>1;if(Math.abs(be-Ee)+Math.abs(_e-We)>1&&mc[Xe*Gl+Ne])de(Ee,We,be,_e,Ne,Xe),de(Se,Pe,Ee,We,Ne,Xe);else{const ze=le(be,_e),De=le(Se,Pe),Qe=le(Ee,We);Q.emplaceBack(ze,De,Qe)}}return de(0,0,ca,ca,ca,0),de(ca,ca,0,0,0,ca),{vertices:ee,indices:Q}})(this.tileID.canonical,d);S=I.vertices,C=I.indices}else{S=new r.a$,C=new r.b0;for(const{x:j,y:z}of y)S.emplaceBack(j,z,0,0);const I=r.bg(S.int16.subarray(0,4*S.length),void 0,4);for(let j=0;j<I.length;j+=3)C.emplaceBack(I[j],I[j+1],I[j+2])}this._tileBoundsBuffer=o.createVertexBuffer(S,r.bh.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(C),this._tileBoundsSegments=r.bf.simpleSegment(0,0,S.length,C.length)}_makeGlobeTileDebugBuffers(o,d){const y=d.projection;if(!y||y.name!=="globe"||d.freezeTileCoverage)return;const S=this.tileID.canonical,C=r.bi(S,d),I=r.bj(C),j=r.aj(d.zoom);let z;j>0&&(z=r.bk(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,S,d,I,z,j),this._makeGlobeTileDebugTextBuffer(o,S,d,I,z,j)}_globePoint(o,d,y,S,C,I,j){let z=r.bl(o,d,y);if(I){const $=1<<y.z,q=r.aF(S.center.lng),ee=r.aJ(S.center.lat),Q=(y.x+.5)/$-q;let ie=0;Q>.5?ie=-1:Q<-.5&&(ie=1);let le=(o/r.al+y.x)/$+ie,de=(d/r.al+y.y)/$;le=(le-q)*S._pixelsPerMercatorPixel+q,de=(de-ee)*S._pixelsPerMercatorPixel+ee;const be=[le*S.worldSize,de*S.worldSize,0];r.af(be,be,I),z=r.bm(z,be,j)}return r.af(z,z,C)}_makeGlobeTileDebugBorderBuffer(o,d,y,S,C,I){const j=new r.bc,z=new r.bd,$=new r.bn,q=(Q,ie,le,de,be)=>{const _e=(le-Q)/(be-1),Se=(de-ie)/(be-1),Pe=j.length;for(let Ee=0;Ee<be;Ee++){const We=Q+Ee*_e,Ne=ie+Ee*Se;j.emplaceBack(We,Ne);const Xe=this._globePoint(We,Ne,d,y,S,C,I);$.emplaceBack(Xe[0],Xe[1],Xe[2]),z.emplaceBack(Pe+Ee)}},ee=r.al;q(0,0,ee,0,16),q(ee,0,ee,ee,16),q(ee,ee,0,ee,16),q(0,ee,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(z),this._tileDebugBuffer=o.createVertexBuffer(j,r.be.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer($,r.bo.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,j.length,z.length)}_makeGlobeTileDebugTextBuffer(o,d,y,S,C,I){const j=r.al/4,z=new r.bc,$=new r.b0,q=new r.bn,ee=25;$.reserve(32),z.reserve(ee),q.reserve(ee);const Q=(ie,le)=>ee*ie+le;for(let ie=0;ie<ee;ie++){const le=ie*j;for(let de=0;de<ee;de++){const be=de*j;z.emplaceBack(be,le);const _e=this._globePoint(be,le,d,y,S,C,I);q.emplaceBack(_e[0],_e[1],_e[2])}}for(let ie=0;ie<4;ie++)for(let le=0;le<4;le++){const de=Q(ie,le),be=Q(ie,le+1),_e=Q(ie+1,le),Se=Q(ie+1,le+1);$.emplaceBack(de,be,_e),$.emplaceBack(_e,be,Se)}this._tileDebugTextIndexBuffer=o.createIndexBuffer($),this._tileDebugTextBuffer=o.createVertexBuffer(z,r.be.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(q,r.bo.members),this._tileDebugTextSegments=r.bf.simpleSegment(0,0,ee,32)}destroy(o=!1){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.br.setPbf(r.bs);class $l extends da{constructor(o,d,y,S,C){super(o,d,y,S,C),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,d,y){const S=y.context,C=S.gl;let I=this.texturePerLayer.get(o)||y.getTileTexture(d.width);I&&I instanceof r.T?I.update(d,{premultiply:!1}):I=new r.T(S,d,C.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,I)}flushQueues(o){const d=this._workQueuePerLayer.get(o)||[],y=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()();for(;y.length;)y.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const d=this._workQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const d=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}}fetchHeader(o=16384,d){const y=this._mrt=new r.br(30),S=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=r.bt(S,((C,I,j)=>{if(C)d(C);else try{const z=y.getHeaderLength(I);if(z>o)return void(this.request=this.fetchHeader(z,d));y.parseHeader(I),this._isHeaderLoaded=!0;let $=0;for(const q of Object.values(y.layers))$=Math.max($,q.dataIndex[q.dataIndex.length-1].lastByte);I.byteLength>=$&&(this.entireBuffer=I),d(null,this.entireBuffer||I,j)}catch(z){d(z)}})),this.request}fetchBandForRender(o,d,y,S){this.fetchBand(o,d,y,(C=>{if(C)return void S(C);this.updateTextureDescriptor(o,d,y);const I=this.textureDescriptorPerLayer.get(d);S(null,I?I.img:null)}))}fetchBand(o,d,y,S,C=!0){const I=this._mrt;if(!this._isHeaderLoaded||!I)return void S(new Error("Tile header is not ready"));const j=this.actor;if(!j)return void S(new Error("Can't fetch tile band without an actor"));let z;const $=r.B(String(y),r.B(this.tileID.key,o));let q=this._taskQueue.get($);q?q.add(S):(q=new Set,q.add(S),this._taskQueue.set($,q));const ee=(de,be)=>{z.complete(de,be),de?S(de):(q.values().forEach((_e=>_e(null,be))),this._taskQueue.delete($))},Q=(de,be)=>{if(de)return S(de);const _e=j.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:be,task:z},ee,void 0,!0);if(d!==null){const Se=this._workQueuePerLayer.get(d)||[];Se.push((()=>{_e&&_e.cancel(),z.cancel()})),this._workQueuePerLayer.has(d)||this._workQueuePerLayer.set(d,Se)}};let ie;try{ie=I.getLayer(o)}catch(de){if(this.state==="reloading")return;throw de}if(!ie)return void S(new Error(`Unknown sourceLayer "${o}"`));if(ie.hasDataForBand(y))return q.values().forEach((de=>de(null,null))),void this._taskQueue.delete($);const le=ie.getDataRange([y]);if(z=I.createDecodingTask(le),!z||z.tasks.length)if(d!==null&&this.flushQueues(d),this.entireBuffer)Q(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const de=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),be=r.bt(de,Q);if(d!==null){const _e=this._fetchQueuePerLayer.get(d)||[];_e.push((()=>{be.cancel(),z.cancel()})),this._fetchQueuePerLayer.has(d)||this._fetchQueuePerLayer.set(d,_e)}}}updateNeeded(o,d){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==d||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,d,y){if(!this._mrt)return;const S=this._mrt.getLayer(o);if(!S||!S.hasBand(y)||!S.hasDataForBand(y))return;const{bytes:C,tileSize:I,buffer:j,offset:z,scale:$}=S.getBandView(y),q=I+2*j,ee=new r.q({width:q,height:q},C),Q=this.texturePerLayer.get(d);Q&&Q instanceof r.T&&Q.update(ee,{premultiply:!1}),this.textureDescriptorPerLayer.set(d,{layer:o,band:y,img:ee,buffer:j,offset:z,tileSize:I,format:S.pixelFormat,mix:[$,256*$,65536*$,16777216*$]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const d of this.texturePerLayer.values())d&&d instanceof r.T&&d.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ch{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,y){const S=o.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);const C={value:d,timeout:void 0};if(y!==void 0&&(C.timeout=setTimeout((()=>{this.remove(o,C)}),y)),this.data[S].push(C),this.order.push(S),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const y=o.wrapped().key,S=d===void 0?0:this.data[y].indexOf(d),C=this.data[y][S];return this.data[y].splice(S,1),C.timeout&&clearTimeout(C.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(C.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const y in this.data)for(const S of this.data[y])o(S.value)||d.push(S);for(const y of d)this.remove(y.value.tileID,y)}}class Cu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,y){const S=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][S]=this.stateChanges[o][S]||{},Object.assign(this.stateChanges[o][S],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const C in this.state[o])C!==S&&(this.deletedStates[o][C]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][S]===null){this.deletedStates[o][S]={};for(const C in this.state[o][S])y[C]||(this.deletedStates[o][S][C]=null)}else for(const C in y)this.deletedStates[o]&&this.deletedStates[o][S]&&this.deletedStates[o][S][C]===null&&delete this.deletedStates[o][S][C]}removeFeatureState(o,d,y){if(this.deletedStates[o]===null)return;const S=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&d!==void 0)this.deletedStates[o][S]!==null&&(this.deletedStates[o][S]=this.deletedStates[o][S]||{},this.deletedStates[o][S][y]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][S])for(y in this.deletedStates[o][S]={},this.stateChanges[o][S])this.deletedStates[o][S][y]=null;else this.deletedStates[o][S]=null;else this.deletedStates[o]=null}getState(o,d){const y=this.state[o]||{},S=this.stateChanges[o]||{},C=this.deletedStates[o];if(C===null)return{};if(d!==void 0){const j=String(d),z=Object.assign({},y[j],S[j]);if(C){const $=C[d];if($===null)return{};for(const q in $)delete z[q]}return z}const I=Object.assign({},y,S);if(C)for(const j in C)delete I[j];return I}initializeTileState(o,d){o.refreshFeatureState(d)}coalesceChanges(o,d){const y={};for(const S in this.stateChanges){this.state[S]=this.state[S]||{};const C={};for(const I in this.stateChanges[S])this.state[S][I]||(this.state[S][I]={}),Object.assign(this.state[S][I],this.stateChanges[S][I]),C[I]=this.state[S][I];y[S]=C}for(const S in this.deletedStates){this.state[S]=this.state[S]||{};const C={};if(this.deletedStates[S]===null)for(const I in this.state[S])C[I]={},this.state[S][I]={};else for(const I in this.deletedStates[S]){if(this.deletedStates[S][I]===null)this.state[S][I]={};else if(this.state[S][I])for(const j of Object.keys(this.deletedStates[S][I]))delete this.state[S][I][j];C[I]=this.state[S][I]}y[S]=y[S]||{},Object.assign(y[S],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const S in o)o[S].refreshFeatureState(d)}}class Wl extends r.E{constructor(o,d,y){super(),this.id=o,this._onlySymbols=y,d.on("data",(S=>{S.dataType==="source"&&S.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),d.on("error",(()=>{this._sourceErrored=!0})),this._source=d,this._tiles={},this._cache=new ch(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Cu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,d){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(o,this.map?this.map.painter:void 0),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((o=>o.tileID)).sort(hg).map((o=>o.key))}getRenderableIds(o,d){const y=[];for(const S in this._tiles)this._isIdRenderable(+S,o,d)&&y.push(this._tiles[S]);return o?y.sort(((S,C)=>{const I=S.tileID,j=C.tileID,z=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),$=new r.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-j.overscaledZ||$.y-z.y||$.x-z.x})).map((S=>S.tileID.key)):y.map((S=>S.tileID)).sort(hg).map((S=>S.key))}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d,y){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())&&(y||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,d){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,o,d)))}_tileLoaded(o,d,y,S,C){if(S){if(o.state="errored",S.status!==404)this._source.fire(new r.y(S,{tile:o}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const j=this.map.painter.terrain;this.update(this.transform,j.getScaledDemTileSize(),!0),j.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=r.o.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let I=new Map;C&&C.responseHeaders&&(I=C.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:I}))}_backfillDEM(o){const d=this.getRenderableIds();for(let S=0;S<d.length;S++){const C=d[S];if(o.neighboringTiles&&o.neighboringTiles[C]){const I=this.getTileByID(C);y(o,I),y(I,o)}}function y(S,C){if(!S.dem||S.dem.borderReady)return;S.needsHillshadePrepare=!0,S.needsDEMTextureUpload=!0;let I=C.tileID.canonical.x-S.tileID.canonical.x;const j=C.tileID.canonical.y-S.tileID.canonical.y,z=Math.pow(2,S.tileID.canonical.z),$=C.tileID.key;I===0&&j===0||Math.abs(j)>1||(Math.abs(I)>1&&(Math.abs(I+z)===1?I+=z:Math.abs(I-z)===1&&(I-=z)),C.dem&&S.dem&&(S.dem.backfillBorder(C.dem,I,j),S.neighboringTiles&&S.neighboringTiles[$]&&(S.neighboringTiles[$].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,y,S){for(const C in this._tiles){let I=this._tiles[C];if(S[C]||!I.hasData()||I.tileID.overscaledZ<=d||I.tileID.overscaledZ>y)continue;let j=I.tileID;for(;I&&I.tileID.overscaledZ>d+1;){const $=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[$.key],I&&I.hasData()&&(j=$)}let z=j;for(;z.overscaledZ>d;)if(z=z.scaledTo(z.overscaledZ-1),o[z.key]){S[j.key]=j;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=o.overscaledZ-1;y>=d;y--){const S=o.scaledTo(y),C=this._getLoadedTile(S);if(C)return C}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,d){d=d||this._source.tileSize;const y=Math.ceil(o.width/d)+1,S=Math.ceil(o.height/d)+1,C=Math.floor(y*S*5),I=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,C):C,j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(j)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const y={};for(const S in this._tiles){const C=this._tiles[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),y[C.tileID.key]=C}this._tiles=y;for(const S in this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(const S in this._tiles)this._setTileReloadTimer(+S,this._tiles[S])}}update(o,d,y,S,C){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(o,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const I=this._source.type==="batched-model";let j,z=this._source.maxzoom;const $=this.map&&this.map.painter?this.map.painter._terrain:null;if($&&$.sourceCache===this&&$.attenuationRange()){const Q=$.attenuationRange()[0],ie=Math.floor(Q)-Math.log2($.getDemUpscale());z>ie&&(z=ie)}if(this.used||this.usedForTerrain){if(this._source.tileID)j=o.getVisibleUnwrappedCoordinates(this._source.tileID).map((Q=>new r.aP(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y)));else if(this.tileCoverLift!==0){const Q=o.clone();Q.tileCoverLift=this.tileCoverLift,j=Q.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:I}),this._source.minzoom<=1&&o.projection.name==="globe"&&(j.push(new r.aP(1,0,1,0,0)),j.push(new r.aP(1,0,1,1,0)),j.push(new r.aP(1,0,1,0,1)),j.push(new r.aP(1,0,1,1,1)))}else if(j=o.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:I}),this._source.hasTile){const Q=this._source.hasTile.bind(this._source);j=j.filter((ie=>Q(ie)))}}else j=[];if(j.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!xc(this._source.type)){const Q=o.coveringZoomLevel({tileSize:d||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),ie=Math.min(Q,this._source.maxzoom);if(I){const le=o.extendTileCover(j,ie);for(const de of le)j.push(de)}else if(C){const le=o.extendTileCoverToNearPlane(j,this.transform.getFrustum(ie),ie);for(const de of le)j.push(de)}else if(this.castsShadows&&S){const le=o.extendTileCover(j,ie,S);for(const de of le)this._shadowCasterTiles[de.key]=!0,j.push(de)}}const q=this._updateRetainedTiles(j);if(xc(this._source.type)&&j.length!==0){const Q={},ie={},le=Object.keys(q);for(const be of le){const _e=q[be],Se=this._tiles[be];if(!Se||Se.fadeEndTime&&Se.fadeEndTime<=r.o.now())continue;const Pe=this.findLoadedParent(_e,Math.max(_e.overscaledZ-Wl.maxOverzooming,this._source.minzoom));Pe&&(this._addTile(Pe.tileID),Q[Pe.tileID.key]=Pe.tileID),ie[be]=_e}const de=j[j.length-1].overscaledZ;for(const be in this._tiles){const _e=this._tiles[be];if(q[be]||!_e.hasData())continue;let Se=_e.tileID;for(;Se.overscaledZ>de;){Se=Se.scaledTo(Se.overscaledZ-1);const Pe=this._tiles[Se.key];if(Pe&&Pe.hasData()&&ie[Se.key]){q[be]=_e.tileID;break}}}for(const be in Q)q[be]||(this._coveredTiles[be]=!0,q[be]=Q[be])}for(const Q in q)this._tiles[Q].clearFadeHold();const ee=r.bu(this._tiles,q);for(const Q of ee){const ie=this._tiles[Q];ie.hasSymbolBuckets&&!ie.holdingForFade()?ie.setHoldDuration(this.map._fadeDuration):ie.hasSymbolBuckets&&!ie.symbolFadeFinished()||this._removeTile(+Q)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const d={};if(o.length===0)return d;const y={},S=o.reduce((($,q)=>Math.min($,q.overscaledZ)),1/0),C=o[0].overscaledZ,I=Math.max(C-Wl.maxOverzooming,this._source.minzoom),j=Math.max(C+Wl.maxUnderzooming,this._source.minzoom),z={};for(const $ of o){const q=this._addTile($);d[$.key]=$,q.hasData()||S<this._source.maxzoom&&(z[$.key]=$)}this._retainLoadedChildren(z,S,j,d);for(const $ of o){let q=this._tiles[$.key];if(q.hasData())continue;if($.canonical.z>=this._source.maxzoom){const Q=$.children(this._source.maxzoom)[0],ie=this.getTile(Q);if(ie&&ie.hasData()){d[Q.key]=Q;continue}}else{const Q=$.children(this._source.maxzoom);if(d[Q[0].key]&&d[Q[1].key]&&d[Q[2].key]&&d[Q[3].key])continue}let ee=q.wasRequested();for(let Q=$.overscaledZ-1;Q>=I;--Q){const ie=$.scaledTo(Q);if(y[ie.key]||(y[ie.key]=!0,q=this.getTile(ie),!q&&ee&&(q=this._addTile(ie)),q&&(d[ie.key]=ie,ee=q.wasRequested(),q.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let y,S=this._tiles[o].tileID;for(;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){y=this._loadedParentTiles[S.key];break}d.push(S.key);const C=S.scaledTo(S.overscaledZ-1);if(y=this._getLoadedTile(C),y)break;S=C}for(const C of d)this._loadedParentTiles[C]=y}}_addTile(o){let d=this._tiles[o.key];if(d)return d.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const y=!!d;if(!y){const S=this.map?this.map.painter:null,C=this._source.tileSize*o.overscaleFactor();d=this._source.type==="raster-array"?new $l(o,C,this.transform.tileZoom,S,this._isRaster):new da(o,C,this.transform.tileZoom,S,this._isRaster,this._source.worldview),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))}return d.uses++,this._tiles[o.key]=d,y||this._source.fire(new r.z("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=d.getExpiryTimeout();y&&(this._timers[o]=setTimeout((()=>{this._reloadTile(o,"expired"),delete this._timers[o]}),y))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"||d.state==="empty"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,d,y){const S=[],C=this.transform;if(!C)return S;const I=C.projection.name==="globe",j=r.aF(C.center.lng);for(const z in this._tiles){const $=this._tiles[z];if(y&&$.clearQueryDebugViz(),$.holdingForFade())continue;let q;if(I){const ee=$.tileID.canonical;if(ee.z===0){const Q=[Math.abs(r.aA(j,...uh(ee,-1))-j),Math.abs(r.aA(j,...uh(ee,1))-j)];q=[0,2*Q.indexOf(Math.min(...Q))-1]}else{const Q=[Math.abs(r.aA(j,...uh(ee,-1))-j),Math.abs(r.aA(j,...uh(ee,0))-j),Math.abs(r.aA(j,...uh(ee,1))-j)];q=[Q.indexOf(Math.min(...Q))-1]}}else q=[0];for(const ee of q){const Q=o.containsTile($,C,d,ee);Q&&S.push(Q)}}return S}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,d){const y=this.getRenderableIds(o,d).map((C=>this._tiles[C].tileID)),S=this.transform.projection.name==="globe";for(const C of y)C.projMatrix=this.transform.calculateProjMatrix(C.toUnwrapped()),C.expandedProjMatrix=S?this.transform.calculateProjMatrix(C.toUnwrapped(),!1,!0):C.projMatrix;return y}sortCoordinatesByDistance(o){const d=o.slice(),y=this.transform._camera.position,S=this.transform._camera.forward(),C={};for(const I of d){const j=1/(1<<I.canonical.z);C[I.key]=((I.canonical.x+.5)*j+I.wrap-y[0])*S[0]+((I.canonical.y+.5)*j-y[1])*S[1]-y[2]*S[2]}return d.sort(((I,j)=>C[I.key]-C[j.key])),d}hasTransition(){if(this._source.hasTransition())return!0;if(xc(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(o,d,y){this._state.updateState(o=o||"_geojsonTileLayer",d,y)}removeFeatureState(o,d,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,y)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,y){const S=this._tiles[o];S&&S.setDependencies(d,y)}reloadTilesForDependencies(o,d){for(const y in this._tiles)this._tiles[y].hasDependency(o,d)&&this._reloadTile(+y,"reloading");this._cache.filter((y=>!y.hasDependency(o,d)))}_preloadTiles(o,d){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(o,d))};return void this._source.on("data",z)}const y=new Map,S=Array.isArray(o)?o:[o],C=this.map.painter.terrain,I=this.usedForTerrain&&C?C.getScaledDemTileSize():this._source.tileSize;for(const z of S){const $=z.coveringTiles({tileSize:I,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const q of $)y.set(q.key,q);this.usedForTerrain&&z.updateElevation(!1)}const j=Array.from(y.values());r.bv(j,((z,$)=>{const q=new da(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(q,(ee=>{this._source.type==="raster-dem"&&q.dem&&this._backfillDEM(q),$(ee,q)}))}),d)}}function hg(g,o){const d=Math.abs(2*g.wrap)-+(g.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||y-d||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function xc(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function uh(g,o){const d=1<<g.z;return[g.x/d+o,(g.x+1)/d+o]}Wl.maxOverzooming=10,Wl.maxUnderzooming=3;class fg{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,d=!1;for(const y in this.style._mergedLayers){const S=this.style._mergedLayers[y];if(S.type==="fill-extrusion"||S.type==="building")this.layers.push({layer:S,visible:o,visibilityChanged:d});else if(S.type==="model"){const C=this.style.getLayerSource(S);C&&C.type==="batched-model"&&this.layers.push({layer:S,visible:o,visibilityChanged:d})}}}onNewFrame(o){this.layersGotHidden=!1;for(const d of this.layers){const y=d.layer;let S=!1;y.type==="fill-extrusion"?S=!y.isHidden(o)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="building"?S=!y.isHidden(o)&&y.paint.get("building-opacity")>0:y.type==="model"&&(S=!y.isHidden(o)&&y.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!S&&d.visible,d.visible=S}}updateZOffset(o,d){this.currentBuildingBuckets=[];for(const S of this.layers){const C=S.layer,I=this.style.getLayerSourceCache(C);let j=1;C.type==="fill-extrusion"?j=S.visible?C.paint.get("fill-extrusion-vertical-scale"):0:C.type==="building"&&(j=S.visible?C.paint.get("building-vertical-scale"):0);let z=I?I.getTile(d):null;if(!z&&I)for(const $ in I._tiles){const q=I._tiles[$];if(d.canonical.isChildOf(q.tileID.canonical)){z=q;break}}this.currentBuildingBuckets.push({bucket:z?z.getBucket(C):null,tileID:z?z.tileID:d,verticalScale:j})}o.hasAnyZOffset=!1;let y=!1;for(let S=0;S<o.symbolInstances.length;S++){const C=o.symbolInstances.get(S),I=C.zOffset,j=this._getHeightAtTileOffset(d,C.tileAnchorX,C.tileAnchorY);C.zOffset=j!==Number.NEGATIVE_INFINITY?j:I,y||I===C.zOffset||(y=!0),o.hasAnyZOffset||C.zOffset===0||(o.hasAnyZOffset=!0)}y&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,d,y,S){let C=d,I=y;if(o.canonical.z!==S.canonical.z){const j=S.canonical,z=1/(1<<o.canonical.z-j.z);C=(d+o.canonical.x*r.al)*z-j.x*r.al|0,I=(y+o.canonical.y*r.al)*z-j.y*r.al|0}return{tileX:C,tileY:I}}_getHeightAtTileOffset(o,d,y){let S,C;for(let I=0;I<this.layers.length;++I){const j=this.layers[I].layer;if(j.type!=="fill-extrusion"&&j.type!=="building")continue;const{bucket:z,tileID:$,verticalScale:q}=this.currentBuildingBuckets[I];if(!z)continue;const{tileX:ee,tileY:Q}=this._mapCoordToOverlappingTile(o,d,y,$),ie=z.getHeightAtTileCoord(ee,Q);ie&&ie.height!==void 0&&(ie.hidden?S=ie.height:C=Math.max(ie.height*q,C||0))}if(C!==void 0)return C;for(let I=0;I<this.layers.length;++I){const j=this.layers[I];if(j.layer.type!=="model"||!j.visible)continue;const{bucket:z,tileID:$}=this.currentBuildingBuckets[I];if(!z)continue;const{tileX:q,tileY:ee}=this._mapCoordToOverlappingTile(o,d,y,$),Q=z.getHeightAtTileCoord(q,ee);if(Q&&!Q.hidden)return Q.height===void 0&&S!==void 0?Math.min(Q.maxHeight,S)*Q.verticalScale:Q.height?Q.height*Q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xd(g,o){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return r.bw.forEach((y=>{y in o&&(d[y]=o[y])})),d}function dh(g){g=g.slice();const o=Object.create(null);for(let d=0;d<g.length;d++)o[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=xd(g[d],o[g[d].ref]));return g}const Di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function hh(g,o,d){d.push({command:Di.addSource,args:[g,o[g]]})}function Mu(g,o,d){o.push({command:Di.removeSource,args:[g]}),d[g]=!0}function Kc(g,o,d,y){Mu(g,d,y),hh(g,o,d)}function gf(g,o,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!r.bx(g[d][y],o[d][y]))return!1;for(y in o[d])if(o[d].hasOwnProperty(y)&&y!=="data"&&!r.bx(g[d][y],o[d][y]))return!1;return!0}function Cp(g,o,d,y,S,C){let I;for(I in o=o||{},g=g||{})g.hasOwnProperty(I)&&(r.bx(g[I],o[I])||d.push({command:C,args:[y,I,o[I],S]}));for(I in o)o.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(r.bx(g[I],o[I])||d.push({command:C,args:[y,I,o[I],S]}))}function Mp(g){return g.id}function fh(g,o){return g[o.id]=o,g}function Yc(g,o,d){const y=o.createTileMatrix(g,g.worldSize,d.toUnwrapped());return r.aB(new Float32Array(16),g.projMatrix,y)}function pg(g,o,d){if(o.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(o.projection),Yc(y,o.getProjection(),g)}function kp(g,o,d){return o.name===d.projection.name?g.projMatrix:Yc(d,o,g)}class _d{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.aA(o,0,1);let d=1,y=this._distances[d];const S=o*this.paddedLength+this.padding;for(;y<S&&d<this._distances.length;)y=this._distances[++d];const C=d-1,I=this._distances[C],j=y-I,z=j>0?(S-I)/j:0;return this.points[C].mult(1-z).add(this.points[d].mult(z))}}class ph{constructor(o,d,y){const S=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(d/y);for(let I=0;I<this.xCellCount*this.yCellCount;I++)S.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,y,S,C){this._forEachCell(d,y,S,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(S),this.bboxes.push(C)}insertCircle(o,d,y,S){this._forEachCell(d-S,y-S,d+S,y+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(y),this.circles.push(S)}_insertBoxCell(o,d,y,S,C,I){this.boxCells[C].push(I)}_insertCircleCell(o,d,y,S,C,I){this.circleCells[C].push(I)}_query(o,d,y,S,C,I){if(y<0||o>this.width||S<0||d>this.height)return!C&&[];const j=[];if(o<=0&&d<=0&&this.width<=y&&this.height<=S){if(C)return!0;for(let z=0;z<this.boxKeys.length;z++)j.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const $=this.circles[3*z],q=this.circles[3*z+1],ee=this.circles[3*z+2];j.push({key:this.circleKeys[z],x1:$-ee,y1:q-ee,x2:$+ee,y2:q+ee})}return I?j.filter(I):j}return this._forEachCell(o,d,y,S,this._queryCell,j,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?j.length>0:j}_queryCircle(o,d,y,S,C){const I=o-y,j=o+y,z=d-y,$=d+y;if(j<0||I>this.width||$<0||z>this.height)return!S&&[];const q=[];return this._forEachCell(I,z,j,$,this._queryCellCircle,q,{hitTest:S,circle:{x:o,y:d,radius:y},seenUids:{box:{},circle:{}}},C),S?q.length>0:q}query(o,d,y,S,C){return this._query(o,d,y,S,!1,C)}hitTest(o,d,y,S,C){return this._query(o,d,y,S,!0,C)}hitTestCircle(o,d,y,S){return this._queryCircle(o,d,y,!0,S)}_queryCell(o,d,y,S,C,I,j,z){const $=j.seenUids,q=this.boxCells[C];if(q!==null){const Q=this.bboxes;for(const ie of q)if(!$.box[ie]){$.box[ie]=!0;const le=4*ie;if(o<=Q[le+2]&&d<=Q[le+3]&&y>=Q[le+0]&&S>=Q[le+1]&&(!z||z(this.boxKeys[ie]))){if(j.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[ie],x1:Q[le],y1:Q[le+1],x2:Q[le+2],y2:Q[le+3]})}}}const ee=this.circleCells[C];if(ee!==null){const Q=this.circles;for(const ie of ee)if(!$.circle[ie]){$.circle[ie]=!0;const le=3*ie;if(this._circleAndRectCollide(Q[le],Q[le+1],Q[le+2],o,d,y,S)&&(!z||z(this.circleKeys[ie]))){if(j.hitTest)return I.push(!0),!0;{const de=Q[le],be=Q[le+1],_e=Q[le+2];I.push({key:this.circleKeys[ie],x1:de-_e,y1:be-_e,x2:de+_e,y2:be+_e})}}}}}_queryCellCircle(o,d,y,S,C,I,j,z){const $=j.circle,q=j.seenUids,ee=this.boxCells[C];if(ee!==null){const ie=this.bboxes;for(const le of ee)if(!q.box[le]){q.box[le]=!0;const de=4*le;if(this._circleAndRectCollide($.x,$.y,$.radius,ie[de+0],ie[de+1],ie[de+2],ie[de+3])&&(!z||z(this.boxKeys[le])))return I.push(!0),!0}}const Q=this.circleCells[C];if(Q!==null){const ie=this.circles;for(const le of Q)if(!q.circle[le]){q.circle[le]=!0;const de=3*le;if(this._circlesCollide(ie[de],ie[de+1],ie[de+2],$.x,$.y,$.radius)&&(!z||z(this.circleKeys[le])))return I.push(!0),!0}}}_forEachCell(o,d,y,S,C,I,j,z){const $=this._convertToXCellCoord(o),q=this._convertToYCellCoord(d),ee=this._convertToXCellCoord(y),Q=this._convertToYCellCoord(S);for(let ie=$;ie<=ee;ie++)for(let le=q;le<=Q;le++)if(C.call(this,o,d,y,S,this.xCellCount*le+ie,I,j,z))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,y,S,C,I){const j=S-o,z=C-d,$=y+I;return $*$>j*j+z*z}_circleAndRectCollide(o,d,y,S,C,I,j){const z=(I-S)/2,$=Math.abs(o-(S+z));if($>z+y)return!1;const q=(j-C)/2,ee=Math.abs(d-(C+q));if(ee>q+y)return!1;if($<=z||ee<=q)return!0;const Q=$-z,ie=ee-q;return Q*Q+ie*ie<=y*y}}const wa={unknown:0,flipRequired:1,flipNotRequired:2},yf=Math.tan(85*Math.PI/180);function ku(g,o,d,y,S,C,I){const j=r.bB();if(d)if(C.name==="globe"){const z=r.bC(S,o);r.aB(j,j,z)}else{const z=r.bD([],I);j[0]=z[0],j[1]=z[1],j[4]=z[2],j[5]=z[3],y||r.bA(j,j,S.angle)}else r.aB(j,S.labelPlaneMatrix,g);return j}function vd(g,o,d,y,S,C,I){const j=ku(g,o,d,y,S,C,I);return C.name==="globe"&&d||(j[2]=j[6]=j[10]=j[14]=0),j}function Jc(g,o,d,y,S,C,I){if(d){if(C.name==="globe"){const j=ku(g,o,d,y,S,C,I);return r.bk(j,j),r.aB(j,g,j),j}{const j=r.by(g),z=r.bz([]);return z[0]=I[0],z[1]=I[1],z[4]=I[2],z[5]=I[3],r.aB(j,j,z),y||r.bA(j,j,-S.angle),j}}return S.glCoordMatrix}function bs(g,o,d,y){const S=[g,o,d,1];d?r.aC(S,S,y):ql(S,S,y);const C=S[3];return S[0]/=C,S[1]/=C,S[2]/=C,S}function bd(g,o){return Math.min(.5+g/o*.5,1.5)}function Ip(g,o){const d=g[0]/g[3],y=g[1]/g[3];return d>=-o[0]&&d<=o[0]&&y>=-o[1]&&y<=o[1]}function mh(g,o,d,y,S,C,I,j,z,$,q=1){const ee=d.transform,Q=y?g.textSizeData:g.iconSizeData,ie=r.bJ(Q,d.transform.zoom,q),le=ee.projection.name==="globe",de=[256/d.width*2+1,256/d.height*2+1],be=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;be.clear();let _e=null;le&&(_e=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const Se=g.lineVertexArray,Pe=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,Ee=d.transform.width/d.transform.height;let We,Ne=!1;for(let Xe=0;Xe<Pe.length;Xe++){const ze=Pe.get(Xe),{numGlyphs:De,writingMode:Qe}=ze;if(Qe!==r.bK.vertical||Ne||We===r.bK.horizontal||(Ne=!0),We=Qe,(ze.hidden||Qe===r.bK.vertical)&&!Ne){Iu(De,be);continue}Ne=!1;const dt=new r.P(ze.tileAnchorX,ze.tileAnchorY),lt=g.elevationType==="road",Lt=!!ee.elevation||lt;let{x:Tt,y:Gt,z:hn}=ee.projection.projectTilePoint(dt.x,dt.y,$.canonical),mt=null;if(Lt){const Bn=lt?g.getElevationFeatureForText(Xe):null;mt={getElevation:z,elevation:ee.elevation,elevationFeature:Bn};const[_r,mi,zr]=z(dt,ee.elevation,Bn);Tt+=_r,Gt+=mi,hn+=zr}const rt=[Tt,Gt,hn,1];if(r.aC(rt,rt,o),!Ip(rt,de)){Iu(De,be);continue}const zt=rt[3],Mt=bd(d.transform.getCameraToCenterDistance(ee.projection),zt),Jt=r.bL(Q,ie,ze),_n=I?Jt/Mt:Jt*Mt,Vn=bs(Tt,Gt,hn,S);if(Vn[3]<=0){Iu(De,be);continue}let fn={};const yn=r.an(g.layers[0].layout.get("text-max-angle")),$n=Math.cos(yn),On=I?null:mt,Cn=mg(ze,_n,!1,j,o,S,C,g.glyphOffsetArray,Se,be,_e,Vn,dt,fn,Ee,On,ee.projection,$,I,$n);Ne=Cn.useVertical,On&&Cn.needsFlipping&&(fn={}),(Cn.notEnoughRoom||Ne||Cn.needsFlipping&&mg(ze,_n,!0,j,o,S,C,g.glyphOffsetArray,Se,be,_e,Vn,dt,fn,Ee,On,ee.projection,$,I,$n).notEnoughRoom)&&Iu(De,be)}y?(g.text.dynamicLayoutVertexBuffer.updateData(be),_e&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(_e)):(g.icon.dynamicLayoutVertexBuffer.updateData(be),_e&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(_e))}function Wi(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be){const{lineStartIndex:_e,glyphStartIndex:Se,segment:Pe}=j,Ee=Se+j.numGlyphs,We=_e+j.lineLength,Ne=o.getoffsetX(Se),Xe=o.getoffsetX(Ee-1),ze=_f(g*Ne,d,y,S,C,I,Pe,_e,We,z,$,q,ee,Q,!0,ie,le,de,be);if(!ze)return null;const De=_f(g*Xe,d,y,S,C,I,Pe,_e,We,z,$,q,ee,Q,!0,ie,le,de,be);return De?{first:ze,last:De}:null}function Pp(g,o,d,y){return g===r.bK.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===r.bK.vertical?y>0?{needsFlipping:!0}:null:o!==wa.unknown&&(function(S,C){return S===0||Math.abs(C/S)>yf})(d,y)?o===wa.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function mg(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se,Pe){const Ee=o/24,We=g.lineOffsetX*Ee,Ne=g.lineOffsetY*Ee,{lineStartIndex:Xe,glyphStartIndex:ze,numGlyphs:De,segment:Qe,writingMode:dt,flipState:lt}=g,Lt=Xe+g.lineLength,Tt=Gt=>{if(q){const[zt,Mt,Jt]=Gt.up,_n=$.length;r.bM(q,_n+0,zt,Mt,Jt),r.bM(q,_n+1,zt,Mt,Jt),r.bM(q,_n+2,zt,Mt,Jt),r.bM(q,_n+3,zt,Mt,Jt)}const[hn,mt,rt]=Gt.point;r.bN($,hn,mt,rt,Gt.angle)};if(De>1){const Gt=Wi(Ee,j,We,Ne,d,ee,Q,g,z,C,ie,de,!1,be,_e,Se,Pe);if(!Gt)return{notEnoughRoom:!0};if(y&&!d){let[hn,mt,rt]=Gt.first.point,[zt,Mt,Jt]=Gt.last.point;[hn,mt]=bs(hn,mt,rt,I),[zt,Mt]=bs(zt,Mt,Jt,I);const _n=Pp(dt,lt,(zt-hn)*le,Mt-mt);if(g.flipState=_n&&_n.needsFlipping?wa.flipRequired:wa.flipNotRequired,_n)return _n}Tt(Gt.first);for(let hn=ze+1;hn<ze+De-1;hn++){const mt=_f(Ee*j.getoffsetX(hn),We,Ne,d,ee,Q,Qe,Xe,Lt,z,C,ie,de,!1,!1,be,_e,Se,Pe);if(!mt)return $.length-=4*(hn-ze),{notEnoughRoom:!0};Tt(mt)}Tt(Gt.last)}else{if(y&&!d){const hn=bs(Q.x,Q.y,0,S),mt=Xe+Qe+1,rt=new r.P(z.getx(mt),z.gety(mt)),zt=bs(rt.x,rt.y,0,S),Mt=zt[3]>0?zt:Ar(Q,rt,hn,1,S,void 0,be,_e.canonical),Jt=Pp(dt,lt,(Mt[0]-hn[0])*le,Mt[1]-hn[1]);if(g.flipState=Jt&&Jt.needsFlipping?wa.flipRequired:wa.flipNotRequired,Jt)return Jt}const Gt=_f(Ee*j.getoffsetX(ze),We,Ne,d,ee,Q,Qe,Xe,Lt,z,C,ie,de,!1,!1,be,_e,Se,Pe);if(!Gt)return{notEnoughRoom:!0};Tt(Gt)}return{}}function xf(g,o,d,y,S){const{x:C,y:I,z:j}=y.projectTilePoint(g.x,g.y,o);if(!S)return bs(C,I,j,d);const[z,$,q]=S.getElevation(g,S.elevation,S.elevationFeature);return bs(C+z,I+$,j+q,d)}function Ar(g,o,d,y,S,C,I,j){const z=xf(g.sub(o)._unit()._add(g),j,S,I,C);return r.av(z,d,z),r.aw(z,z),r.bG(z,d,z,y)}function _f(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se){const Pe=y?g-o:g+o;let Ee=Pe>0?1:-1,We=0;y&&(Ee*=-1,We=Math.PI),Ee<0&&(We+=Math.PI);let Ne=j+I+(Ee>0?0:1)|0,Xe=S,ze=S,De=0,Qe=0;const dt=Math.abs(Pe),lt=[],Lt=[];let Tt=C,Gt=Tt,hn=r.bE([]);const mt=()=>Ar(Gt,Tt,ze,dt-De+1,q,Q,de,be.canonical);for(;De+Qe<=dt;){if(Ne+=Ee,Ne<j||Ne>=z)return null;if(ze=Xe,Gt=Tt,lt.push(ze),ie&&Lt.push(Gt),Tt=new r.P($.getx(Ne),$.gety(Ne)),Xe=ee[Ne],!Xe){const On=xf(Tt,be.canonical,q,de,Q);Xe=On[3]>0?ee[Ne]=On:mt()}De+=Qe;const yn=r.av([],Xe,ze),$n=r.bF(ze,Xe);if(d&&$n>0&&Qe>0&&r.bI(hn,yn)/(Qe*$n)<Se)return null;Qe=$n,hn=yn}le&&Q&&(ee[Ne]&&(Xe=mt(),Qe=r.bF(ze,Xe),hn=r.av([],Xe,ze)),ee[Ne]=Xe);const rt=(dt-De)/Qe,zt=Tt.sub(Gt)._mult(rt)._add(Gt),Mt=r.bG([],ze,hn,rt);let Jt=[0,0,1],_n=hn[0],Vn=hn[1];if(_e&&(Jt=de.upVector(be.canonical,zt.x,zt.y),Jt[0]!==0||Jt[1]!==0||Jt[2]!==1)){const yn=[Jt[2],0,-Jt[0]],$n=r.bH([],Jt,yn);r.aw(yn,yn),r.aw($n,$n),_n=r.bI(hn,yn),Vn=r.bI(hn,$n)}if(d){const yn=r.bH([],Jt,hn);r.aw(yn,yn),r.bG(Mt,Mt,yn,d*Ee)}const fn=We+Math.atan2(Vn,_n);return lt.push(Mt),ie&&Lt.push(zt),{point:Mt,angle:fn,path:lt,tilePath:Lt,up:Jt}}function Iu(g,o){const d=o.length,y=d+4*g;o.resize(y),o.float32.fill(-1/0,4*d,4*y)}function ql(g,o,d){const y=o[0],S=o[1];return g[0]=d[0]*y+d[4]*S+d[12],g[1]=d[1]*y+d[5]*S+d[13],g[3]=d[3]*y+d[7]*S+d[15],g}const Xl=100;class wd{constructor(o,d,y=new ph(o.width+200,o.height+200,25),S=new ph(o.width+200,o.height+200,25)){this.transform=o,this.grid=y,this.ignoredGrid=S,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Xl,this.screenBottomBoundary=o.height+Xl,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,y,S,C,I,j,z,$,q,ee){let Q=y.projectedAnchorX,ie=y.projectedAnchorY,le=y.projectedAnchorZ;const de=y.tileAnchorX,be=y.tileAnchorY,_e=y.elevation,Se=y.tileID,Pe=o.getProjection();if(_e&&Se){const[Lt,Tt,Gt]=Pe.upVector(Se.canonical,y.tileAnchorX,y.tileAnchorY),hn=Pe.upVectorScale(Se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Q+=Lt*_e*hn,ie+=Tt*_e*hn,le+=Gt*_e*hn}const Ee=o.projection.name==="globe",We=o.projection.name==="globe"?r.aj(this.transform.zoom):0;if(Se&&Ee&&We<1&&!I){const Lt=1<<Se.canonical.z,Tt=r.bO(de,be);r.bP(Tt,Tt,1/r.al),r.bQ(Tt,Tt,r.bO(Se.canonical.x,Se.canonical.y)),r.bP(Tt,Tt,1/Lt),r.bR(Tt,Tt,r.bO(S[0],S[1])),Tt[0]=r.bS(Tt[0],-.5,.5),r.bP(Tt,Tt,r.al);const Gt=r.bT(Tt[0],Tt[1],r.al/(2*Math.PI),1);r.aC(Gt,Gt,C),Q=r.ak(Q,Gt[0],We),ie=r.ak(ie,Gt[1],We),le=r.ak(le,Gt[2],We)}const Ne=this.projectAndGetPerspectiveRatio(q,Q,ie,le,y.tileID,Pe.name==="globe"||!!_e||this.transform.pitch>0,Pe),Xe=$*Ne.perspectiveRatio,ze=(y.x1*d+j.x-y.padding)*Xe+Ne.point.x,De=(y.y1*d+j.y-y.padding)*Xe+Ne.point.y,Qe=(y.x2*d+j.x+y.padding)*Xe+Ne.point.x,dt=(y.y2*d+j.y+y.padding)*Xe+Ne.point.y,lt=Ne.perspectiveRatio<=.55||Ne.occluded;return!this.isInsideGrid(ze,De,Qe,dt)||!z&&this.grid.hitTest(ze,De,Qe,dt,ee)||lt?{box:[],offscreen:!1,occluded:Ne.occluded}:{box:[ze,De,Qe,dt],offscreen:this.isOffscreen(ze,De,Qe,dt),occluded:!1}}placeCollisionCircles(o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be){const _e=[],Se=this.transform.elevation,Pe=o.getProjection(),Ee=o.elevationType==="road",We=!!Se||Ee,Ne=r.bU.getAtTileOffsetFunc(be,this.transform.center.lat,this.transform.worldSize,Pe),Xe=new r.P(y.tileAnchorX,y.tileAnchorY),ze=new r.P(y.tileAnchorX,y.tileAnchorY);let{x:De,y:Qe,z:dt}=Pe.projectTilePoint(ze.x,ze.y,be.canonical),lt=null;if(We){const $n=Ee?o.getElevationFeatureForText(S):null;lt={getElevation:Ne,elevation:Se,elevationFeature:$n};const[On,Cn,Bn]=Ne(Xe,Se,$n);De+=On,Qe+=Cn,dt+=Bn}const Lt=Pe.name==="globe",Tt=this.projectAndGetPerspectiveRatio(z,De,Qe,dt,be,Lt||!!Se||this.transform.pitch>0,Pe),{perspectiveRatio:Gt}=Tt,hn=(Q?j/Gt:j*Gt)/r.bX,mt=bs(De,Qe,dt,$),rt=y.lineOffsetX*hn,zt=y.lineOffsetY*hn,Mt=r.an(o.layers[0].layout.get("text-max-angle")),Jt=Math.cos(Mt),_n=Tt.signedDistanceFromCamera>0?Wi(hn,I,rt,zt,Ee&&y.flipState===1,mt,ze,y,C,$,{},We&&!Q?lt:null,Q&&We,Pe,be,Q,Jt):null;let Vn=!1,fn=!1,yn=!0;if(_n&&!Tt.occluded){const $n=.5*le*Gt+de,On=new r.P(-100,-100),Cn=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Bn=new _d,{first:_r,last:mi}=_n,zr=_r.path.length;let ts=[];for(let Kr=zr-1;Kr>=1;Kr--)ts.push(_r.path[Kr]);for(let Kr=1;Kr<mi.path.length;Kr++)ts.push(mi.path[Kr]);const Ir=2.5*$n;q&&(ts=ts.map((([Kr,Xi,wi],ss)=>(We&&!Lt&&(wi=Ne(ss<zr-1?_r.tilePath[zr-1-ss]:mi.tilePath[ss-zr+2],Se,lt.elevationFeature)[2]),bs(Kr,Xi,wi,q)))),ts.some((Kr=>Kr[3]<=0))&&(ts=[]));let bi=[];if(ts.length>0){let Kr=1/0,Xi=-1/0,wi=1/0,ss=-1/0;for(const gi of ts)Kr=Math.min(Kr,gi[0]),wi=Math.min(wi,gi[1]),Xi=Math.max(Xi,gi[0]),ss=Math.max(ss,gi[1]);Xi>=On.x&&Kr<=Cn.x&&ss>=On.y&&wi<=Cn.y&&(bi=[ts.map((gi=>new r.P(gi[0],gi[1])))],(Kr<On.x||Xi>Cn.x||wi<On.y||ss>Cn.y)&&(bi=r.bV(bi,On.x,On.y,Cn.x,Cn.y)))}for(const Kr of bi){Bn.reset(Kr,.25*$n);let Xi=0;Xi=Bn.length<=.5*$n?1:Math.ceil(Bn.paddedLength/Ir)+1;for(let wi=0;wi<Xi;wi++){const ss=wi/Math.max(Xi-1,1),gi=Bn.lerp(ss),Xr=gi.x+Xl,Oi=gi.y+Xl;_e.push(Xr,Oi,$n,0);const Gr=Xr-$n,os=Oi-$n,Ei=Xr+$n,Pr=Oi+$n;if(yn=yn&&this.isOffscreen(Gr,os,Ei,Pr),fn=fn||this.isInsideGrid(Gr,os,Ei,Pr),!d&&this.grid.hitTestCircle(Xr,Oi,$n,ie)&&(Vn=!0,!ee))return{circles:[],offscreen:!1,collisionDetected:Vn,occluded:!1}}}}return{circles:!ee&&Vn||!fn?[]:_e,offscreen:yn,collisionDetected:Vn,occluded:Tt.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,S=1/0,C=-1/0,I=-1/0;for(const q of o){const ee=new r.P(q.x+Xl,q.y+Xl);y=Math.min(y,ee.x),S=Math.min(S,ee.y),C=Math.max(C,ee.x),I=Math.max(I,ee.y),d.push(ee)}const j=this.grid.query(y,S,C,I).concat(this.ignoredGrid.query(y,S,C,I)),z={},$={};for(const q of j){const ee=q.key;if(z[ee.bucketInstanceId]===void 0&&(z[ee.bucketInstanceId]={}),z[ee.bucketInstanceId][ee.featureIndex])continue;const Q=[new r.P(q.x1,q.y1),new r.P(q.x2,q.y1),new r.P(q.x2,q.y2),new r.P(q.x1,q.y2)];r.bW(d,Q)&&(z[ee.bucketInstanceId][ee.featureIndex]=!0,$[ee.bucketInstanceId]===void 0&&($[ee.bucketInstanceId]=[]),$[ee.bucketInstanceId].push(ee.featureIndex))}return $}insertCollisionBox(o,d,y,S,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:S,collisionGroupID:C},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,y,S,C){const I=d?this.ignoredGrid:this.grid,j={bucketInstanceId:y,featureIndex:S,collisionGroupID:C};for(let z=0;z<o.length;z+=4)I.insertCircle(j,o[z],o[z+1],o[z+2])}projectAndGetPerspectiveRatio(o,d,y,S,C,I,j){const z=[d,y,S,1];let $=!1;S||this.transform.pitch>0?(r.aC(z,z,o),this.fogState&&C&&j.name!=="globe"&&($=(function(Q,ie,le,de,be,_e){const Se=_e.calculateFogTileMatrix(be),Pe=[ie,le,de];return r.af(Pe,Pe,Se),un(Q,r.ag(Pe),_e.pitch,_e._fov)})(this.fogState,d,y,S,C.toUnwrapped(),this.transform)>.9)):ql(z,z,o);const q=z[3];return{point:new r.P((z[0]/q+1)/2*this.transform.width+Xl,(-z[1]/q+1)/2*this.transform.height+Xl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/q*.5,1.5),signedDistanceFromCamera:q,occluded:I&&z[2]>q||$}}isOffscreen(o,d,y,S){return y<Xl||o>=this.screenRightBoundary||S<Xl||d>this.screenBottomBoundary}isInsideGrid(o,d,y,S){return y>=0&&o<this.gridRightBoundary&&S>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=r.bz([]);return r.bq(o,o,[-100,-100,0]),o}}class sr{constructor(o,d,y,S){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):S&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Ii{constructor(o,d,y,S,C,I=!1){this.text=new sr(o?o.text:null,d,y,C),this.icon=new sr(o?o.icon:null,d,S,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ui{constructor(o,d,y,S=!1){this.text=o,this.icon=d,this.skipFade=y,this.clipped=S}}class ol{constructor(){this.invProjMatrix=r.bB(),this.viewportMatrix=r.bB(),this.circles=[]}}class vf{constructor(o,d,y,S,C){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=S,this.tileID=C}}class qi{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[o]}}function Rp(g,o,d,y,S){const{horizontalAlign:C,verticalAlign:I}=r.c0(g),j=-(C-.5)*o,z=-(I-.5)*d,$=r.c1(g,y);return new r.P(j+$[0]*S,z+$[1]*S)}function gh(g,o,d,y,S){const C=new r.P(g,o);return d&&C._rotate(y?S:-S),C}class Np{constructor(o,d,y,S,C,I){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new wd(this.transform,C),this.buildingIndex=I,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new qi(y),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,y,S,C=1){const I=y.getBucket(d),j=y.latestFeatureIndex;if(!I||!j||d.fqid!==I.layerIds[0])return;const z=I.layers[0].layout,$=I.layers[0].paint,q=y.collisionBoxArray,ee=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Q=y.tileSize/r.al,ie=y.tileID.toUnwrapped();this.transform.setProjection(I.projection);const le=(de=y.tileID,be=I.getProjection(),_e=this.transform,be.name===this.projection?_e.calculateProjMatrix(de.toUnwrapped()):Yc(_e,be,de));var de,be,_e;const Se=z.get("text-pitch-alignment")==="map",Pe=z.get("text-rotation-alignment")==="map";d.compileFilter(d.options);const Ee=d.dynamicFilter(),We=d.dynamicFilterNeedsFeature(),Ne=this.transform.calculatePixelsToTileUnitsMatrix(y),Xe=vd(le,y.tileID.canonical,Se,Pe,this.transform,I.getProjection(),Ne);let ze=null;const De=I.getProjection().createInversionMatrix(this.transform,y.tileID.canonical);if(Se){const rt=Jc(le,y.tileID.canonical,Se,Pe,this.transform,I.getProjection(),Ne);ze=r.aB([],this.transform.labelPlaneMatrix,rt)}let Qe=null;Ee&&y.latestFeatureIndex&&(Qe={unwrappedTileID:ie,dynamicFilter:Ee,dynamicFilterNeedsFeature:We}),this.retainedQueryData[I.bucketInstanceId]=new vf(I.bucketInstanceId,j,I.sourceLayerIndex,I.index,y.tileID);const[dt,lt]=I.layers[0].layout.get("text-size-scale-range"),Lt=r.aA(C,dt,lt),[Tt,Gt]=z.get("icon-size-scale-range"),hn=r.aA(C,Tt,Gt),mt={bucket:I,layout:z,paint:$,posMatrix:le,invMatrix:De,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Xe,labelToScreenMatrix:ze,clippingData:Qe,scale:ee,textPixelRatio:Q,holdingForFade:y.holdingForFade(),collisionBoxArray:q,partiallyEvaluatedTextSize:r.bJ(I.textSizeData,this.transform.zoom,Lt),partiallyEvaluatedIconSize:r.bJ(I.iconSizeData,this.transform.zoom,hn),collisionGroup:this.collisionGroups.get(I.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(S)for(const rt of I.sortKeyRanges){const{sortKey:zt,symbolInstanceStart:Mt,symbolInstanceEnd:Jt}=rt;o.push({sortKey:zt,symbolInstanceStart:Mt,symbolInstanceEnd:Jt,parameters:mt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:mt})}attemptAnchorPlacement(o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se,Pe,Ee,We){const{textOffset0:Ne,textOffset1:Xe,crossTileID:ze}=de,De=[Ne,Xe],Qe=Rp(o,I,j,De,z),dt=this.collisionIndex.placeCollisionBox(_e,z,d,y,S,C,gh(Qe.x,Qe.y,$,q,this.transform.angle),le,ee,Q,ie.predicate);if(Pe){const lt=_e.getSymbolInstanceIconSize(We,this.transform.zoom,de.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(_e,lt,Pe,y,S,C,gh(Qe.x,Qe.y,$,q,this.transform.angle),le,ee,Q,ie.predicate).box.length===0)return}if(dt.box.length>0){let lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&(lt=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:De,width:I,height:j,anchor:o,textScale:z,prevAnchor:lt},this.markUsedJustification(_e,o,de,Se),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,Se,de),this.placedOrientations[ze]=Se),{shift:Qe,placedGlyphBoxes:dt}}}placeLayerBucketPart(o,d,y,S,C=1){const{bucket:I,layout:j,paint:z,posMatrix:$,textLabelPlaneMatrix:q,labelToScreenMatrix:ee,clippingData:Q,textPixelRatio:ie,mercatorCenter:le,invMatrix:de,holdingForFade:be,collisionBoxArray:_e,partiallyEvaluatedTextSize:Se,partiallyEvaluatedIconSize:Pe,collisionGroup:Ee,latestFeatureIndex:We}=o.parameters,Ne=j.get("text-optional"),Xe=j.get("icon-optional"),ze=j.get("text-allow-overlap"),De=j.get("icon-allow-overlap"),Qe=j.get("text-rotation-alignment")==="map",dt=j.get("icon-rotation-alignment")==="map",lt=j.get("text-pitch-alignment")==="map",Lt=z.get("symbol-z-offset"),Tt=j.get("symbol-elevation-reference")==="sea",Gt=j.get("symbol-placement"),[hn,mt]=j.get("text-size-scale-range"),[rt,zt]=j.get("icon-size-scale-range"),Mt=r.aA(C,hn,mt),Jt=r.aA(C,rt,zt),_n=j.get("text-variable-anchor"),Vn=Qe&&Gt!=="point",fn=dt&&Gt!=="point",yn=_n&&I.hasTextData(),$n=I.hasIconTextFit()&&yn&&I.hasIconData();this.transform.setProjection(I.projection);const On=yn||Vn,Cn=fn||$n;let Bn=ze&&(De||!I.hasIconData()||Xe),_r=De&&(ze||!I.hasTextData()||Ne);const mi=!Lt.isConstant();!I.collisionArrays&&_e&&I.deserializeCollisionBoxes(_e),y&&S&&I.updateCollisionDebugBuffers(this.transform.zoom,_e,Mt,Jt);const zr=(Ir,bi,Kr)=>{const{crossTileID:Xi,numVerticalGlyphVertices:wi}=Ir;let ss=null;if(Q&&Q.dynamicFilterNeedsFeature||mi){const Ss=this.retainedQueryData[I.bucketInstanceId];ss=We.loadFeature({featureIndex:Ir.featureIndex,bucketIndex:Ss.bucketIndex,sourceLayerIndex:Ss.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Q&&!(0,Q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:I.worldview},ss,this.retainedQueryData[I.bucketInstanceId].tileID.canonical,new r.P(Ir.tileAnchorX,Ir.tileAnchorY),this.transform.calculateDistanceTileData(Q.unwrappedTileID)))return this.placements[Xi]=new Ui(!1,!1,!1,!0),void d.add(Xi);const gi=Lt.evaluate(ss,{});if(d.has(Xi))return;if(be)return void(this.placements[Xi]=new Ui(!1,!1,!1));let Xr=!1,Oi=!1,Gr=!0,os=!1,Ei=!1,Pr=null,Si={box:null,offscreen:null,occluded:null},xs={box:null},qs=null,ws=null,Os=null,Aa=0,ga=0,To=0;Kr.textFeatureIndex?Aa=Kr.textFeatureIndex:Ir.useRuntimeCollisionCircles&&(Aa=Ir.featureIndex),Kr.verticalTextFeatureIndex&&(ga=Kr.verticalTextFeatureIndex);const jo=I.elevationFeatures?I.elevationFeatures[Ir.elevationFeatureIndex]:void 0,gl=Ss=>{Ss.tileID=this.retainedQueryData[I.bucketInstanceId].tileID;const Fs=this.transform.elevation;Ss.elevation=Tt?gi:gi+r.bU.getAtTileOffset(Ss.tileID,new r.P(Ss.tileAnchorX,Ss.tileAnchorY),Fs,jo),Ss.elevation+=Ir.zOffset},Do=Kr.textBox;if(Do){gl(Do);const Ss=Ji=>{let Xs=r.bK.horizontal;if(I.allowVerticalPlacement&&!Ji&&this.prevPlacement){const Lo=this.prevPlacement.placedOrientations[Xi];Lo&&(this.placedOrientations[Xi]=Lo,Xs=Lo,this.markUsedOrientation(I,Xs,Ir))}return Xs},Fs=(Ji,Xs)=>{if(I.allowVerticalPlacement&&wi>0&&Kr.verticalTextBox){for(const Lo of I.writingModes)if(Lo===r.bK.vertical?(Si=Xs(),xs=Si):Si=Ji(),Si&&Si.box&&Si.box.length)break}else Si=Ji()};if(_n){let Ji=_n;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xi]){const Ts=this.prevPlacement.variableOffsets[Xi];Ji.indexOf(Ts.anchor)>0&&(Ji=Ji.filter((zl=>zl!==Ts.anchor)),Ji.unshift(Ts.anchor))}const Xs=(Ts,zl,hu)=>{const $u=I.getSymbolInstanceTextSize(Se,Ir,this.transform.zoom,bi),Wu=(Ts.x2-Ts.x1)*$u+2*Ts.padding,b=(Ts.y2-Ts.y1)*$u+2*Ts.padding,M=Ir.hasIconTextFit&&!De?zl:null;M&&gl(M);let B={box:[],offscreen:!1,occluded:!1};const Z=ze?2*Ji.length:Ji.length;for(let se=0;se<Z;++se){const ge=this.attemptAnchorPlacement(Ji[se%Ji.length],Ts,le,de,On,Wu,b,$u,Qe,lt,ie,$,Ee,se>=Ji.length,Ir,bi,I,hu,M,Se,Pe);if(ge&&(B=ge.placedGlyphBoxes,B&&B.box&&B.box.length)){Xr=!0,Pr=ge.shift;break}}return B};Fs((()=>Xs(Do,Kr.iconBox,r.bK.horizontal)),(()=>{const Ts=Kr.verticalTextBox;return Ts&&gl(Ts),I.allowVerticalPlacement&&!(Si&&Si.box&&Si.box.length)&&wi>0&&Ts?Xs(Ts,Kr.verticalIconBox,r.bK.vertical):{box:null,offscreen:null,occluded:null}})),Si&&(Xr=Si.box,Gr=Si.offscreen,os=Si.occluded);const Lo=Ss(!(!Si||!Si.box));if(!Xr&&this.prevPlacement){const Ts=this.prevPlacement.variableOffsets[Xi];Ts&&(this.variableOffsets[Xi]=Ts,this.markUsedJustification(I,Ts.anchor,Ir,Lo))}}else{const Ji=(Xs,Lo)=>{const Ts=I.getSymbolInstanceTextSize(Se,Ir,this.transform.zoom,bi),zl=this.collisionIndex.placeCollisionBox(I,Ts,Xs,le,de,On,new r.P(0,0),ze,ie,$,Ee.predicate);return zl&&zl.box&&zl.box.length&&(this.markUsedOrientation(I,Lo,Ir),this.placedOrientations[Xi]=Lo),zl};Fs((()=>Ji(Do,r.bK.horizontal)),(()=>{const Xs=Kr.verticalTextBox;return I.allowVerticalPlacement&&wi>0&&Xs?(gl(Xs),Ji(Xs,r.bK.vertical)):{box:null,offscreen:null,occluded:null}})),Ss(!!(Si&&Si.box&&Si.box.length))}}if(qs=Si,Xr=qs&&qs.box&&qs.box.length>0,Gr=qs&&qs.offscreen,os=qs&&qs.occluded,Ir.useRuntimeCollisionCircles){const Ss=Ir.centerJustifiedTextSymbolIndex>=0?Ir.centerJustifiedTextSymbolIndex:Ir.verticalPlacedTextSymbolIndex,Fs=I.text.placedSymbolArray.get(Ss),Ji=r.bL(I.textSizeData,Se,Fs),Xs=j.get("text-padding");ws=this.collisionIndex.placeCollisionCircles(I,ze,Fs,Ss,I.lineVertexArray,I.glyphOffsetArray,Ji,$,q,ee,y,lt,Ee.predicate,Ir.collisionCircleDiameter*Ji/r.bX,Xs,this.retainedQueryData[I.bucketInstanceId].tileID),Xr=ze||ws.circles.length>0&&!ws.collisionDetected,Gr=Gr&&ws.offscreen,os=ws.occluded}if(Kr.iconFeatureIndex&&(To=Kr.iconFeatureIndex),Kr.iconBox){const Ss=Fs=>{gl(Fs);const Ji=Ir.hasIconTextFit&&Pr?gh(Pr.x,Pr.y,Qe,lt,this.transform.angle):new r.P(0,0),Xs=I.getSymbolInstanceIconSize(Pe,this.transform.zoom,Ir.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(I,Xs,Fs,le,de,Cn,Ji,De,ie,$,Ee.predicate)};xs&&xs.box&&xs.box.length&&Kr.verticalIconBox?(Os=Ss(Kr.verticalIconBox),Oi=Os.box.length>0):(Os=Ss(Kr.iconBox),Oi=Os.box.length>0),Gr=Gr&&Os.offscreen,Ei=Os.occluded}const Fl=Ne||Ir.numHorizontalGlyphVertices===0&&wi===0,Bl=Xe||Ir.numIconVertices===0;if(Fl||Bl?Bl?Fl||(Oi=Oi&&Xr):Xr=Oi&&Xr:Oi=Xr=Oi&&Xr,Xr&&qs&&qs.box&&this.collisionIndex.insertCollisionBox(qs.box,j.get("text-ignore-placement"),I.bucketInstanceId,xs&&xs.box&&ga?ga:Aa,Ee.ID),Oi&&Os&&this.collisionIndex.insertCollisionBox(Os.box,j.get("icon-ignore-placement"),I.bucketInstanceId,To,Ee.ID),ws&&(Xr&&this.collisionIndex.insertCollisionCircles(ws.circles,j.get("text-ignore-placement"),I.bucketInstanceId,Aa,Ee.ID),y)){const Ss=I.bucketInstanceId;let Fs=this.collisionCircleArrays[Ss];Fs===void 0&&(Fs=this.collisionCircleArrays[Ss]=new ol);for(let Ji=0;Ji<ws.circles.length;Ji+=4)Fs.circles.push(ws.circles[Ji+0]),Fs.circles.push(ws.circles[Ji+1]),Fs.circles.push(ws.circles[Ji+2]),Fs.circles.push(ws.collisionDetected?1:0)}const _o=I.projection.name!=="globe";Bn=Bn&&(_o||!os),_r=_r&&(_o||!Ei),this.placements[Xi]=new Ui(Xr||Bn,Oi||_r,Gr||I.justReloaded),d.add(Xi)},ts=this.retainedQueryData[I.bucketInstanceId].tileID;if(I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,ts),I.elevationType==="road"&&I.updateRoadElevation(ts.canonical),I.updateZOffset(),I.sortFeaturesByY){const Ir=I.getSortedSymbolIndexes(this.transform.angle);for(let bi=Ir.length-1;bi>=0;--bi){const Kr=Ir[bi];zr(I.symbolInstances.get(Kr),Kr,I.collisionArrays[Kr])}I.hasAnyZOffset&&r.w(`${I.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(I.hasAnyZOffset){const Ir=I.getSortedIndexesByZOffset();for(let bi=0;bi<Ir.length;++bi){const Kr=Ir[bi];zr(I.symbolInstances.get(Kr),Kr,I.collisionArrays[Kr])}}else for(let Ir=o.symbolInstanceStart;Ir<o.symbolInstanceEnd;Ir++)zr(I.symbolInstances.get(Ir),Ir,I.collisionArrays[Ir]);if(y&&I.bucketInstanceId in this.collisionCircleArrays){const Ir=this.collisionCircleArrays[I.bucketInstanceId];r.bk(Ir.invProjMatrix,$),Ir.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(o,d,y,S){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:z,crossTileID:$}=y,q=r.c2(d),ee=S===r.bK.vertical?z:q==="left"?C:q==="center"?I:q==="right"?j:-1;C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=ee>=0&&C!==ee?0:$),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=ee>=0&&I!==ee?0:$),j>=0&&(o.text.placedSymbolArray.get(j).crossTileID=ee>=0&&j!==ee?0:$),z>=0&&(o.text.placedSymbolArray.get(z).crossTileID=ee>=0&&z!==ee?0:$)}markUsedOrientation(o,d,y){const S=d===r.bK.horizontal||d===r.bK.horizontalOnly?d:0,C=d===r.bK.vertical?d:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:$}=y,q=o.text.placedSymbolArray;I>=0&&(q.get(I).placedOrientation=S),j>=0&&(q.get(j).placedOrientation=S),z>=0&&(q.get(z).placedOrientation=S),$>=0&&(q.get($).placedOrientation=C)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const S=d?d.symbolFadeChange(o):1,C=d?d.opacities:{},I=d?d.variableOffsets:{},j=d?d.placedOrientations:{};for(const z in this.placements){const $=this.placements[z],q=C[z];q?(this.opacities[z]=new Ii(q,S,$.text,$.icon,null,$.clipped),y=y||$.text!==q.text.placed||$.icon!==q.icon.placed):(this.opacities[z]=new Ii(null,S,$.text,$.icon,$.skipFade,$.clipped),y=y||$.text||$.icon)}for(const z in C){const $=C[z];if(!this.opacities[z]){const q=new Ii($,S,!1,!1);q.isHidden()||(this.opacities[z]=q,y=y||$.text.placed||$.icon.placed)}}for(const z in I)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=I[z]);for(const z in j)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=j[z]);y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d,y,S){const C=new Set;for(const I of d){const j=I.getBucket(o);j&&I.latestFeatureIndex&&o.fqid===j.layerIds[0]&&(this.updateBucketOpacities(j,C,I,I.collisionBoxArray,y,S,I.tileID,o.scope),j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,I.tileID),j.elevationType==="road"&&j.updateRoadElevation(I.tileID.canonical),j.updateZOffset())}}updateBucketOpacities(o,d,y,S,C,I,j,z){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const $=o.layers[0].layout,q=o.layers[0].paint,ee=!!o.layers[0].dynamicFilter(),Q=new Ii(null,0,!1,!1,!0),ie=$.get("text-allow-overlap"),le=$.get("icon-allow-overlap"),de=$.get("text-variable-anchor"),be=$.get("text-rotation-alignment")==="map",_e=$.get("text-pitch-alignment")==="map",Se=q.get("symbol-z-offset"),Pe=$.get("symbol-elevation-reference")==="sea",Ee=!Se.isConstant(),We=new Ii(null,0,ie&&(le||!o.hasIconData()||$.get("icon-optional")),le&&(ie||!o.hasTextData()||$.get("text-optional")),!0);!o.collisionArrays&&S&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(S);const Ne=(ze,De,Qe)=>{for(let dt=0;dt<De/4;dt++)ze.opacityVertexArray.emplaceBack(Qe)};let Xe=0;I&&o.updateReplacement(j,I);for(let ze=0;ze<o.symbolInstances.length;ze++){const De=o.symbolInstances.get(ze),{numHorizontalGlyphVertices:Qe,numVerticalGlyphVertices:dt,crossTileID:lt,numIconVertices:Lt,tileAnchorX:Tt,tileAnchorY:Gt}=De;let hn=null;const mt=this.retainedQueryData[o.bucketInstanceId];Ee&&De&&mt&&(hn=y.latestFeatureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:mt.bucketIndex,sourceLayerIndex:mt.sourceLayerIndex,layoutVertexArrayOffset:0}));const rt=Se.evaluate(hn,{}),zt=d.has(lt);let Mt=this.opacities[lt];zt?Mt=Q:Mt||(Mt=We,this.opacities[lt]=Mt),d.add(lt);const Jt=Qe>0||dt>0,_n=Lt>0,Vn=this.placedOrientations[lt],fn=Vn===r.bK.vertical,yn=Vn===r.bK.horizontal||Vn===r.bK.horizontalOnly;!Jt&&!_n||Mt.isHidden()||Xe++;let $n=!1;if((Jt||_n)&&I)for(const On of o.activeReplacements){if(r.bY(On,C,r.bZ.Symbol,z)||On.min.x>Tt||Tt>On.max.x||On.min.y>Gt||Gt>On.max.y)continue;const Cn=r.b_(Tt,Gt,j.canonical,On.footprintTileId.canonical);if($n=r.b$(Cn,On.footprint),$n)break}if(Jt){const On=$n?Io:Dp(Mt.text);Ne(o.text,Qe,fn?Io:On),Ne(o.text,dt,yn?Io:On);const Cn=Mt.text.isHidden(),{leftJustifiedTextSymbolIndex:Bn,centerJustifiedTextSymbolIndex:_r,rightJustifiedTextSymbolIndex:mi,verticalPlacedTextSymbolIndex:zr}=De,ts=o.text.placedSymbolArray,Ir=Cn||fn?1:0;Bn>=0&&(ts.get(Bn).hidden=Ir),_r>=0&&(ts.get(_r).hidden=Ir),mi>=0&&(ts.get(mi).hidden=Ir),zr>=0&&(ts.get(zr).hidden=Cn||yn?1:0);const bi=this.variableOffsets[lt];bi&&this.markUsedJustification(o,bi.anchor,De,Vn);const Kr=this.placedOrientations[lt];Kr&&(this.markUsedJustification(o,"left",De,Kr),this.markUsedOrientation(o,Kr,De))}if(_n){const On=$n?Io:Dp(Mt.icon),{placedIconSymbolIndex:Cn,verticalPlacedIconSymbolIndex:Bn}=De,_r=o.icon.placedSymbolArray,mi=Mt.icon.isHidden()?1:0;Cn>=0&&(Ne(o.icon,Lt,fn?Io:On),_r.get(Cn).hidden=mi),Bn>=0&&(Ne(o.icon,De.numVerticalIconVertices,yn?Io:On),_r.get(Bn).hidden=mi)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const On=o.collisionArrays[ze];if(On){let Cn=new r.P(0,0),Bn=!0;if(On.textBox||On.verticalTextBox){if(de){const mi=this.variableOffsets[lt];mi?(Cn=Rp(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textScale),be&&Cn._rotate(_e?this.transform.angle:-this.transform.angle)):Bn=!1}ee&&(Bn=!Mt.clipped),On.textBox&&Bo(o.textCollisionBox.collisionVertexArray,Mt.text.placed,!Bn||fn,rt,Pe,Cn.x,Cn.y),On.verticalTextBox&&Bo(o.textCollisionBox.collisionVertexArray,Mt.text.placed,!Bn||yn,rt,Pe,Cn.x,Cn.y)}const _r=Bn&&!!(!yn&&On.verticalIconBox);On.iconBox&&Bo(o.iconCollisionBox.collisionVertexArray,Mt.icon.placed,_r,rt,Pe,De.hasIconTextFit?Cn.x:0,De.hasIconTextFit?Cn.y:0),On.verticalIconBox&&Bo(o.iconCollisionBox.collisionVertexArray,Mt.icon.placed,!_r,rt,Pe,De.hasIconTextFit?Cn.x:0,De.hasIconTextFit?Cn.y:0)}}}if(o.fullyClipped=Xe===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ze.invProjMatrix,o.placementViewportMatrix=ze.viewportMatrix,o.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function Bo(g,o,d,y,S,C,I){g.emplaceBack(o?1:0,d?1:0,C||0,I||0,y,S?1:0),g.emplaceBack(o?1:0,d?1:0,C||0,I||0,y,S?1:0),g.emplaceBack(o?1:0,d?1:0,C||0,I||0,y,S?1:0),g.emplaceBack(o?1:0,d?1:0,C||0,I||0,y,S?1:0)}const io=Math.pow(2,25),Mb=Math.pow(2,24),jp=Math.pow(2,17),ey=Math.pow(2,16),bf=Math.pow(2,9),gg=Math.pow(2,8),ty=Math.pow(2,1);function Dp(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,d=Math.floor(127*g.opacity);return d*io+o*Mb+d*jp+o*ey+d*bf+o*gg+d*ty+o}const Io=0;class Pu{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,d,y,S,C,I){const j=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(j,S,o[this._currentTileIndex],this._sortAcrossTiles,I),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort(((z,$)=>z.sortKey-$.sortKey)));this._currentPartIndex<j.length;){const z=j[this._currentPartIndex];if(d.placeLayerBucketPart(z,this._seenCrossTileIDs,y,z.symbolInstanceStart===0,I),this._currentPartIndex++,C())return!0}return!1}}class za{constructor(o,d,y,S,C,I,j,z,$){this.placement=new Np(o,C,I,j,z,$),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,d,y,S,C){const I=r.o.now(),j=()=>{const z=r.o.now()-I;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=d[o[this._currentPlacementIndex]],$=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=$)&&(!z.maxzoom||z.maxzoom>$)){const q=z,ee=q.layout.get("symbol-z-elevate"),Q=q.layout.get("symbol-sort-key").constantOr(1)!==void 0,ie=q.layout.get("symbol-z-order"),le=ie==="viewport-y"||ie==="auto"&&!(ie!=="viewport-y"&&Q),de=q.layout.get("text-allow-overlap")||q.layout.get("icon-allow-overlap")||q.layout.get("text-ignore-placement")||q.layout.get("icon-ignore-placement"),be=le&&de,_e=this._inProgressLayer=this._inProgressLayer||new Pu(q),Se=r.B(z.source,z.scope);if(_e.continuePlacement(ee||be?S[Se]:y[Se],this.placement,this._showCollisionBoxes,z,j,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const yg=512/r.al/2;class Sd{constructor(o,d,y){this.tileID=o,this.bucketInstanceId=y,this.index=new r.c3(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=o.canonical.x*r.al,C=o.canonical.y*r.al;for(let I=0;I<d.length;I++){const{key:j,crossTileID:z,tileAnchorX:$,tileAnchorY:q}=d.get(I),ee=Math.floor((S+$)*yg),Q=Math.floor((C+q)*yg);this.index.add(ee,Q),this.keys.push(j),this.crossTileIDs.push(z)}this.index.finish()}findMatches(o,d,y){const S=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=yg/Math.pow(2,d.canonical.z-this.tileID.canonical.z),I=d.canonical.x*r.al,j=d.canonical.y*r.al;for(let z=0;z<o.length;z++){const $=o.get(z);if($.crossTileID)continue;const{key:q,tileAnchorX:ee,tileAnchorY:Q}=$,ie=Math.floor((I+ee)*C),le=Math.floor((j+Q)*C),de=this.index.range(ie-S,le-S,ie+S,le+S).sort(((be,_e)=>be-_e));for(const be of de){const _e=this.crossTileIDs[be];if(this.keys[be]===q&&!y.has(_e)){y.add(_e),$.crossTileID=_e;break}}}}}class so{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const y in this.indexes){const S=this.indexes[y],C={};for(const I in S){const j=S[I];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+d),C[j.tileID.key]=j}this.indexes[y]=C}this.lng=o}addBucket(o,d,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const S=this.usedCrossTileIDs[o.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>o.overscaledZ)for(const j in I){const z=I[j];z.tileID.isChildOf(o)&&z.findMatches(d.symbolInstances,o,S)}else{const j=I[o.scaledTo(Number(C)).key];j&&j.findMatches(d.symbolInstances,o,S)}}for(let C=0;C<d.symbolInstances.length;C++){const I=d.symbolInstances.get(C);I.crossTileID||(I.crossTileID=y.generate(),S.add(I.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Sd(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const y of d.crossTileIDs)this.usedCrossTileIDs[o].delete(y)}removeStaleBuckets(o){let d=!1;for(const y in this.indexes){const S=this.indexes[y];for(const C in S)o[S[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,S[C]),delete S[C],d=!0)}return d}}class tu{constructor(){this.layerIndexes={},this.crossTileIDs=new so,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,y,S){let C=this.layerIndexes[o.fqid];C===void 0&&(C=this.layerIndexes[o.fqid]=new eu);let I=!1;const j={};S.name!=="globe"&&C.handleWrapJump(y);for(const z of d){const $=z.getBucket(o);$&&o.fqid===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(z.tileID,$,this.crossTileIDs)&&(I=!0),j[$.bucketInstanceId]=!0)}return C.removeStaleBuckets(j)&&(I=!0),I}pruneUnusedLayers(o){const d={};o.forEach((y=>{d[y]=!0}));for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const $s=771;class si{constructor(o,d,y,S){this.blendFunction=o,this.blendColor=d.toNonPremultipliedRenderColor(null),this.mask=y,this.blendEquation=S}}si.Replace=[1,0,1,0],si.disabled=new si(si.Replace,r.ao.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,r.ao.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,$s,1,$s],r.ao.transparent,[!0,!0,!0,!0]),si.alphaBlendedNonPremultiplied=new si([770,$s,770,$s],r.ao.transparent,[!0,!0,!0,!0]),si.multiply=new si([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),si.additive=new si([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class Xn{constructor(o,d,y){this.func=o,this.mask=d,this.range=y}}Xn.ReadOnly=!1,Xn.ReadWrite=!0,Xn.disabled=new Xn(519,Xn.ReadOnly,[0,1]);const Td=7680;class Cr{constructor(o,d,y,S,C,I){this.test=o,this.ref=d,this.mask=y,this.fail=S,this.depthFail=C,this.pass=I}}Cr.disabled=new Cr({func:519,mask:0},0,0,Td,Td,Td);const wf=1029,xg=2305;class Dr{constructor(o,d,y){this.enable=o,this.mode=d,this.frontFace=y}}function Sf(g,o){const d=r.c9(g,3);r.cb(g,o),r.cf(g,3,d)}function Lp(g,o){const d=r.c6([]);return r.c7(d,d,-o),r.c8(d,d,-g),d}function Tf(g,o){const d=[g[0],g[1],0],y=[o[0],o[1],0];if(r.ag(d)>=1e-15){const I=r.aw([],d);r.c4(y,I,r.bI(y,I)),o[0]=y[0],o[1]=y[1]}const S=r.bH([],o,g);if(r.c5(S)<1e-15)return null;const C=Math.atan2(-S[1],S[0]);return Lp(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}Dr.disabled=new Dr(!1,wf,xg),Dr.backCCW=new Dr(!0,wf,xg),Dr.backCW=new Dr(!0,wf,2304),Dr.frontCW=new Dr(!0,1028,2304),Dr.frontCCW=new Dr(!0,1028,xg);class al{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof r.ae?o:new r.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=r.bS(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d,y){if(this.orientation=null,!this.position)return;const S=this.position,C=y||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(o)):0),I=r.ae.fromLngLat(o,C),j=[I.x-S.x,I.y-S.y,I.z-S.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Tf(j,d)}setPitchBearing(o,d){this.orientation=Lp(r.an(o),r.an(-d))}}class _g{constructor(o,d){this._transform=r.bz([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new r.ae(o[0],o[1],o[2])}get position(){const o=r.c9(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&r.cf(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.c6([]),o&&Sf(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=Lp(o,d),Sf(this._transform,this._orientation)}forward(){const o=r.c9(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=r.c9(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=r.c9(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const y=new Float64Array(16);return r.bk(y,this.getWorldToCamera(o,d)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,d,y){const S=this.position;r.c4(S,S,-o);const C=new Float64Array(16);return r.bp(C,[y,y,y]),r.bq(C,C,S),C[10]*=d,C}getWorldToCamera(o,d){const y=new Float64Array(16),S=new Float64Array(4),C=this.position;return r.ca(S,this._orientation),r.c4(C,C,-o),r.cb(y,S),r.bq(y,y,C),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(o,d,y,S){const C=new Float64Array(16);return r.cc(C,o,d,y,S),C}getCameraToClipOrthographic(o,d,y,S,C,I){const j=new Float64Array(16);return r.cd(j,o,d,y,S,C,I),j}getDistanceToElevation(o,d=!1){const y=o===0?0:r.ce(o,d?r.a_(this.position[1]):this.position[1]),S=this.forward();return(y-this.position[2])/S[2]}clone(){return new _g([...this.position],[...this.orientation])}}const go={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ha{constructor(o=0,d=0,y=0,S=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=y,this.right=S}interpolate(o,d,y){return d.top!=null&&o.top!=null&&(this.top=r.ak(o.top,d.top,y)),d.bottom!=null&&o.bottom!=null&&(this.bottom=r.ak(o.bottom,d.bottom,y)),d.left!=null&&o.left!=null&&(this.left=r.ak(o.left,d.left,y)),d.right!=null&&o.right!=null&&(this.right=r.ak(o.right,d.right,y)),this}getCenter(o,d){const y=r.aA((this.left+o-this.right)/2,0,o),S=r.aA((this.top+d-this.bottom)/2,0,d);return new r.P(y,S)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ha(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ed=15;class Ad{constructor(o,d,y,S,C,I,j){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=S??60,this.setProjection(I),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new r.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ha,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new _g,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Ad(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ed}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(o||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const y=this.getProjection(),S=!r.bx(d,y);return S&&this._calcMatrices(),this.mercatorFromTransition=!1,S}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const d=o!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bS(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=r.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let S=0,C=0;for(let I=0;I<d.length;I++){const j=new r.P(d[I][0]*this.width,y+d[I][1]*(this.height-y)),z=o.pointCoordinate(j);if(!z)continue;const $=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);S+=z[3]*$,C+=$}return C===0?NaN:S/C}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,S=this._mercatorZfromZoom(o),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(S-y,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let y;y=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const S=r.ag(r.av([],this._camera.position,y));return r.aA(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!r.co(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const y=[o.position.x,o.position.y,o.position.z];r.cp(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new al;return d.position=new r.ae(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!r.cq(o))return!1;r.cr(o,o);const d=r.cs([],[0,0,-1],o),y=r.cs([],[0,-1,0],o);if(y[2]<0)return!1;const S=Tf(d,y);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;o[2]=r.aA(o[2],S/y,S/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,y){this._unmodified=!1,this._edgeInsets.interpolate(o,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new r.ct(0,o)];if(this.renderWorldCopies){const y=this.pointCoordinate(new r.P(0,0)),S=this.pointCoordinate(new r.P(this.width,0)),C=this.pointCoordinate(new r.P(this.width,this.height)),I=this.pointCoordinate(new r.P(0,this.height)),j=Math.floor(Math.min(y.x,S.x,C.x,I.x)),z=Math.floor(Math.max(y.x,S.x,C.x,I.x)),$=1;for(let q=j-$;q<=z+$;q++)q!==0&&d.push(new r.ct(q,o))}return d}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,d,y){let S=[];const C=y!=null,I=!C;if(I&&this.zoom<d||C&&y[0]===0&&y[1]===0)return S;const j=new Set,z=(q,ee,Q,ie,le)=>{const de=r.cX(ee,q,Q,ie,le);j.has(de)||(S.push(new r.aP(q,ee,Q,ie,le)),j.add(de))};for(let q=0;q<o.length;q++){const ee=o[q];if(I&&ee.canonical.z!==d)continue;const Q=ee.canonical,ie=ee.overscaledZ,le=ee.wrap,de=1<<Q.z,be=Q.x+1<de,_e=Q.x>0,Se=Q.y+1<de,Pe=Q.y>0,Ee=ee.wrap-(_e?0:1),We=ee.wrap+(be?0:1),Ne=_e?Q.x-1:de-1,Xe=be?Q.x+1:0;if(C)y[0]<0?(z(ie,We,Q.z,Xe,Q.y),y[1]<0&&Se&&(z(ie,le,Q.z,Q.x,Q.y+1),z(ie,We,Q.z,Xe,Q.y+1)),y[1]>0&&Pe&&(z(ie,le,Q.z,Q.x,Q.y-1),z(ie,We,Q.z,Xe,Q.y-1))):y[0]>0?(z(ie,Ee,Q.z,Ne,Q.y),y[1]<0&&Se&&(z(ie,le,Q.z,Q.x,Q.y+1),z(ie,Ee,Q.z,Ne,Q.y+1)),y[1]>0&&Pe&&(z(ie,le,Q.z,Q.x,Q.y-1),z(ie,Ee,Q.z,Ne,Q.y-1))):y[1]<0&&Se?z(ie,le,Q.z,Q.x,Q.y+1):Pe&&z(ie,le,Q.z,Q.x,Q.y-1);else{const ze=ee.visibleQuadrants;1&ze&&(z(ie,Ee,Q.z,Ne,Q.y),Pe&&(z(ie,le,Q.z,Q.x,Q.y-1),z(ie,Ee,Q.z,Ne,Q.y-1))),2&ze&&(z(ie,We,Q.z,Xe,Q.y),Pe&&(z(ie,le,Q.z,Q.x,Q.y-1),z(ie,We,Q.z,Xe,Q.y-1))),4&ze&&(z(ie,Ee,Q.z,Ne,Q.y),Se&&(z(ie,le,Q.z,Q.x,Q.y+1),z(ie,Ee,Q.z,Ne,Q.y+1))),8&ze&&(z(ie,We,Q.z,Xe,Q.y),Se&&(z(ie,le,Q.z,Q.x,Q.y+1),z(ie,We,Q.z,Xe,Q.y+1)))}}const $=[];for(const q of S)S.some((ee=>q.isChildOf(ee)))||$.push(q);if(S=$.filter((q=>!o.some((ee=>!!(q.overscaledZ<d&&ee.isChildOf(q))||q.equals(ee)||q.isChildOf(ee))))),I){const q=1<<d,ee=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=[q*ee.x,q*ee.y],ie=4,le=ie*ie;S=S.filter((de=>{const be=de.canonical.x+.5-Q[0],_e=de.canonical.y+.5-Q[1];return be*be+_e*_e<le}))}return S}extendTileCoverToNearPlane(o,d,y){const S=[],C=new Set;for(const Se of o)C.add(Se.key);const I=(Se,Pe,Ee,We,Ne)=>{const Xe=r.cX(Pe,Se,Ee,We,Ne);C.has(Xe)||(S.push(new r.aP(Se,Pe,Ee,We,Ne)),C.add(Xe))},j=o.reduce(((Se,Pe)=>Math.max(Se,Pe.overscaledZ)),y),z=1<<y,$=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],q=new r.P(0,0),ee=new r.P(0,0),Q=(Se,Pe)=>{const Ee=Math.floor(Se[0]),We=Math.floor(Se[1]),Ne=(Se[0]-Ee)*r.al,Xe=(Se[1]-We)*r.al,ze=Math.floor(Pe[0]),De=Math.floor(Pe[1]),Qe=(Pe[0]-ze)*r.al,dt=(Pe[1]-De)*r.al;for(let lt=-1;lt<=1;lt++){const Lt=Ee+lt;if(!(Lt<0||Lt>=z)){q.x=Ne-lt*r.al,ee.x=Qe-(Lt-ze)*r.al;for(let Tt=-1;Tt<=1;Tt++){const Gt=We+Tt;q.y=Xe-Tt*r.al,ee.y=dt-(Gt-De)*r.al,r.cY(q,ee,$)&&I(j,0,y,Lt,Gt)}}}},ie=d.points,le=ie[r.cu],de=ie[r.cv],be=this._projectToGround(le,ie[r.cw]),_e=this._projectToGround(de,ie[r.cx]);return Q(le,be),Q(de,_e),S}_projectToGround(o,d){return r.cy(r.cz(),o,d,o[2]/(o[2]-d[2]))}coveringTiles(o){let d=this.coveringZoomLevel(o);const y=d,S=this.elevation&&this.elevation.exaggeration(),C=S&&!o.isTerrainDEM,I=this.projection.name==="mercator";if(o.minzoom!==void 0&&d<o.minzoom)return[];o.maxzoom!==void 0&&d>o.maxzoom&&(d=o.maxzoom);const j=this.locationCoordinate(this.center),z=this.center.lat,$=1<<d,q=[$*j.x,$*j.y,0],ee=this.projection.name==="globe",Q=!ee,ie=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,Q),le=ee?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),de=$*r.ce(1,this.center.lat),be=this._camera.position[2]/r.ce(1,this.center.lat),_e=[$*le.x,$*le.y,be*(Q?1:de)],Se=ee||S,Pe=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Ee=this.isLODDisabled(!0)?d:0;let We;if(this._elevation&&o.isTerrainDEM)We=1e4*this._elevation.exaggeration();else if(this._elevation){const rt=this._elevation.getMinMaxForVisibleTiles();We=rt?rt.max:this._centerAltitude}else We=this._centerAltitude;const Ne=o.isTerrainDEM?-We:this._elevation?this._elevation.getMinElevationBelowMSL():0,Xe=this.projection.isReprojectedInTileSpace?r.cB(this):1,ze=rt=>{const Mt=new r.ae(rt.x+25e-6,rt.y,rt.z),Jt=new r.ae(rt.x,rt.y+25e-6,rt.z),_n=rt.toLngLat(),Vn=Mt.toLngLat(),fn=Jt.toLngLat(),yn=this.locationCoordinate(_n),$n=this.locationCoordinate(Vn),On=this.locationCoordinate(fn),Cn=Math.hypot($n.x-yn.x,$n.y-yn.y),Bn=Math.hypot(On.x-yn.x,On.y-yn.y);return Math.sqrt(Cn*Bn)*Xe/25e-6},De=rt=>{const zt=We,Mt=Ne;return{aabb:r.cE(this,$,0,0,0,rt,Mt,zt,this.projection),zoom:0,x:0,y:0,minZ:Mt,maxZ:zt,wrap:rt,fullyVisible:!1}},Qe=[];let dt=[];const lt=d,Lt=o.reparseOverscaled?y:d,Tt=(be-this._centerAltitude)*de,Gt=rt=>{if(!this._elevation||!rt.tileID||!I)return;const zt=this._elevation.getMinMaxForTile(rt.tileID),Mt=rt.aabb;zt?(Mt.min[2]=zt.min,Mt.max[2]=zt.max,Mt.center[2]=(Mt.min[2]+Mt.max[2])/2):(rt.shouldSplit=mt(rt),rt.shouldSplit||(Mt.min[2]=Mt.max[2]=Mt.center[2]=this._centerAltitude))},hn=(rt,zt)=>{if(.707*zt<rt)return 1;const Mt=zt/rt;return Mt/(1.4144271570014144+(Math.pow(1.1,Mt-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=rt=>{if(rt.zoom<Ee)return!0;if(rt.zoom===lt)return!1;if(rt.shouldSplit!=null)return rt.shouldSplit;const zt=rt.aabb.distanceX(_e),Mt=rt.aabb.distanceY(_e);let Jt=Tt,_n=1;if(ee){Jt=rt.aabb.distanceZ(_e);const Bn=Math.pow(2,rt.zoom),_r=r.a_((rt.y+1)/Bn),mi=r.a_(rt.y/Bn),zr=Math.min(Math.max(z,_r),mi),ts=r.d0(zr)/r.d0(z);if(_n=zr===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ts/this._mercatorScaleRatio),this.zoom<=r.cZ&&rt.zoom===lt-1&&ts>=.9)return!0}else if(C&&(Jt=rt.aabb.distanceZ(_e)*de),this.projection.isReprojectedInTileSpace&&y<=5){const Bn=Math.pow(2,rt.zoom),_r=ze(new r.ae((rt.x+.5)/Bn,(rt.y+.5)/Bn));_n=_r>.85?1:_r}if(!I&&!ee){const Bn=Math.sqrt(zt*zt+Mt*Mt+Jt*Jt);let _r=(1<<lt-rt.zoom)*Pe*_n;return _r*=hn(Math.max(Jt,Tt),Bn),Bn<_r}let Vn=Number.MAX_VALUE,fn=0;const yn=rt.aabb.getCorners(),$n=[];for(const Bn of yn){r.av($n,Bn,_e),ee||(C?$n[2]*=de:$n[2]=Tt);const _r=r.bI($n,this._camera.forward());_r<Vn&&(Vn=_r,fn=Math.abs($n[2]))}let On=(1<<lt-rt.zoom)*Pe*_n;if(On*=hn(Math.max(fn,Tt),Vn),Vn<On)return!0;const Cn=rt.aabb.closestPoint(q);return Cn[0]===q[0]&&Cn[1]===q[1]};if(this.renderWorldCopies)for(let rt=1;rt<=3;rt++)Qe.push(De(-rt)),Qe.push(De(rt));for(Qe.push(De(0));Qe.length>0;){const rt=Qe.pop(),zt=rt.x,Mt=rt.y;let Jt=rt.fullyVisible;const _n=()=>this.projection.name==="globe"&&(rt.y===0||rt.y===(1<<rt.zoom)-1);if(!Jt){let Vn=Se?rt.aabb.intersects(ie):rt.aabb.intersectsFlat(ie);if(Vn===0&&_n()){const fn=new r.cC(rt.zoom,zt,Mt);Vn=r.cD(this,$,fn,!0).intersects(ie)}if(Vn===0)continue;Jt=Vn===2}if(rt.zoom!==lt&&mt(rt))for(let Vn=0;Vn<4;Vn++){const fn=(zt<<1)+Vn%2,yn=(Mt<<1)+(Vn>>1),$n={aabb:I?rt.aabb.quadrant(Vn):r.cE(this,$,rt.zoom+1,fn,yn,rt.wrap,rt.minZ,rt.maxZ,this.projection),zoom:rt.zoom+1,x:fn,y:yn,wrap:rt.wrap,fullyVisible:Jt,tileID:void 0,shouldSplit:void 0,minZ:rt.minZ,maxZ:rt.maxZ};C&&!ee&&($n.tileID=new r.aP(rt.zoom+1===lt?Lt:rt.zoom+1,rt.wrap,rt.zoom+1,fn,yn),Gt($n)),Qe.push($n)}else{const Vn=rt.zoom===lt?Lt:rt.zoom;if(o.minzoom&&o.minzoom>Vn)continue;let fn=0;if(!Jt){let Cn=Se?rt.aabb.intersectsPrecise(ie):rt.aabb.intersectsPreciseFlat(ie);if(Cn===0&&_n()){const Bn=new r.cC(rt.zoom,zt,Mt);Cn=r.cD(this,$,Bn,!0).intersectsPrecise(ie)}if(Cn===0)continue;if(o.calculateQuadrantVisibility)if(ie.containsPoint(rt.aabb.center))fn=15;else for(let Bn=0;Bn<4;Bn++)rt.aabb.quadrant(Bn).intersects(ie)!==0&&(fn|=1<<Bn)}const yn=q[0]-(.5+zt+(rt.wrap<<rt.zoom))*(1<<d-rt.zoom),$n=q[1]-.5-Mt,On=rt.tileID?rt.tileID:new r.aP(Vn,rt.wrap,rt.zoom,zt,Mt);o.calculateQuadrantVisibility&&(On.visibleQuadrants=fn),dt.push({tileID:On,distanceSq:yn*yn+$n*$n})}}if(this.fogCullDistSq){const rt=this.fogCullDistSq,zt=this.horizonLineFromTop();dt=dt.filter((Mt=>{const Jt=[0,0,0,1],_n=[r.al,r.al,0,1],Vn=this.calculateFogTileMatrix(Mt.tileID.toUnwrapped());r.aC(Jt,Jt,Vn),r.aC(_n,_n,Vn);const fn=r.cF([],Jt,_n),yn=r.cG([],Jt,_n),$n=r.c_(fn,yn);if($n===0)return!0;let On=!1;const Cn=this._elevation;if(Cn&&$n>rt&&zt!==0){const Bn=this.calculateProjMatrix(Mt.tileID.toUnwrapped());let _r;o.isTerrainDEM||(_r=Cn.getMinMaxForTile(Mt.tileID)),_r||(_r={min:Ne,max:We});const mi=r.cH(this.rotation),zr=[mi[0]*r.al,mi[1]*r.al,_r.max];r.af(zr,zr,Bn),On=(1-zr[1])*this.height*.5<zt}return $n<rt||On}))}return dt.sort(((rt,zt)=>rt.distanceSq-zt.distanceSq)).map((rt=>rt.tileID))}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const d=r.aA(o.lat,-r.cI,r.cI),y=this.projection.project(o.lng,d);return new r.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,d){let y,S;const C=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;y=(d.x-C.x)/j,S=(d.y-C.y)/j}else{const j=this.pointCoordinate(d),z=this.pointCoordinate(C);y=j.x-z.x,S=j.y-z.y}const I=this.locationCoordinate(o);this.setLocation(new r.ae(I.x-y,I.y-S))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,d){return this.projection.locationPoint(this,o,d)}locationPoint3D(o,d){return this.projection.locationPoint(this,o,d,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,d){return this.coordinateLocation(this.pointCoordinate3D(o,d))}locationCoordinate(o,d){const y=d?r.ce(d,o.lat):void 0,S=this.projection.project(o.lng,o.lat);return new r.ae(S.x,S.y,y)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const y=d??this._centerAltitude,S=[o.x,o.y,0,1],C=[o.x,o.y,1,1];r.aC(S,S,this.pixelMatrixInverse),r.aC(C,C,this.pixelMatrixInverse);const I=C[3];r.cJ(S,S,1/S[3]),r.cJ(C,C,1/I);const j=S[2],z=C[2];return{p0:S,p1:C,t:j===z?0:(y-j)/(z-j)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],y=[o.x,o.y,1,1];return r.aC(d,d,this.pixelMatrixInverse),r.aC(y,y,this.pixelMatrixInverse),r.cJ(d,d,1/d[3]),r.cJ(y,y,1/y[3]),d[2]=r.ce(d[2],this._center.lat)*this.worldSize,y[2]=r.ce(y[2],this._center.lat)*this.worldSize,r.cJ(d,d,1/this.worldSize),r.cJ(y,y,1/this.worldSize),new r.ax([d[0],d[1],d[2]],r.aw([],r.av([],y,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:y,t:S}=o,C=r.ce(d[2],this._center.lat),I=r.ce(y[2],this._center.lat);return new r.ae(r.ak(d[0],y[0],S)/this.worldSize,r.ak(d[1],y[1],S)/this.worldSize,r.ak(C,I,S))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o,d){if(!this.elevation)return this.pointCoordinate(o,d);let y=this.projection.pointCoordinate3D(this,o.x,o.y);if(y)return new r.ae(y[0],y[1],y[2]);let S=0,C=this.horizonLineFromTop();if(o.y>C)return this.pointCoordinate(o,d);const I=.02*C,j=o.clone();for(let z=0;z<10&&C-S>I;z++){j.y=r.ak(S,C,.66);const $=this.projection.pointCoordinate3D(this,j.x,j.y);$?(C=j.y,y=$):S=j.y}return y?new r.ae(y[0],y[1],y[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(o);const d=this.pointCoordinate(o);return d.y>=0&&d.y<=1}_coordinatePoint(o,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,S=[o.x*this.worldSize,o.y*this.worldSize,y+o.toAltitude(),1];return r.aC(S,S,this.pixelMatrix),S[3]>0?new r.P(S[0]/S[3],S[1]/S[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=this.pointLocation3D(new r.P(d,o)),I=this.pointLocation3D(new r.P(S,o)),j=this.pointLocation3D(new r.P(S,y)),z=this.pointLocation3D(new r.P(d,y));let $=Math.min(C.lng,I.lng,j.lng,z.lng),q=Math.max(C.lng,I.lng,j.lng,z.lng),ee=Math.min(C.lat,I.lat,j.lat,z.lat),Q=Math.max(C.lat,I.lat,j.lat,z.lat);const ie=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,de=(be,_e,Se,Pe,Ee)=>{const We=(be+Se)/2,Ne=(_e+Pe)/2,Xe=new r.P(We,Ne),{lng:ze,lat:De}=this.pointLocation3D(Xe),Qe=Math.max(0,$-ze,ee-De,ze-q,De-Q);$=Math.min($,ze),q=Math.max(q,ze),ee=Math.min(ee,De),Q=Math.max(Q,De),(Ee<le||Qe>ie)&&(de(be,_e,We,Ne,Ee+1),de(We,Ne,Se,Pe,Ee+1))};if(de(d,o,S,o,1),de(S,o,S,y,1),de(S,y,d,y,1),de(d,y,d,o,1),this.projection.name==="globe"){const[be,_e]=r.cL(this);be?(Q=90,q=180,$=-180):_e&&(ee=-90,q=180,$=-180)}return new r.aI(new r.aS($,ee),new r.aS(q,Q))}_getBoundsRectangular(o,d){const{top:y,left:S}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,j=new r.P(S,y),z=new r.P(I,y),$=new r.P(I,C),q=new r.P(S,C);let ee=this.pointCoordinate(j,o),Q=this.pointCoordinate(z,o);const ie=this.pointCoordinate($,d),le=this.pointCoordinate(q,d),de=(be,_e)=>(_e.y-be.y)/(_e.x-be.x);return ee.y>1&&Q.y>=0?ee=new r.ae((1-le.y)/de(le,ee)+le.x,1):ee.y<0&&Q.y<=1&&(ee=new r.ae(-le.y/de(le,ee)+le.x,0)),Q.y>1&&ee.y>=0?Q=new r.ae((1-ie.y)/de(ie,Q)+ie.x,1):Q.y<0&&ee.y<=1&&(Q=new r.ae(-ie.y/de(ie,Q)+ie.x,0)),new r.aI().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(ie))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=o.visibleDemTiles.reduce(((y,S)=>{if(S.dem){const C=S.dem.tree;y.min=Math.min(y.min,C.minimums[0]),y.max=Math.max(y.max,C.maximums[0])}return y}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,y=this._distanceTileDataCache;if(y[d])return y[d];const S=o.canonical,C=1/this.height,I=this.cameraWorldSize,j=I/this.zoomScale(S.z),z=(S.x+Math.pow(2,S.z)*o.wrap)*j,$=S.y*j,q=this.point;q.x*=I/this.worldSize,q.y*=I/this.worldSize;const ee=this.angle,Q=Math.sin(-ee),ie=-Math.cos(-ee);return y[d]={bearing:[Q,ie],center:[(q.x-z)*C,(q.y-$)*C],scale:j/r.al*C},y[d]}calculateFogTileMatrix(o){const d=o.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.aB(S,this.worldToFogMatrix,S),y[d]=new Float32Array(S),y[d]}calculateProjMatrix(o,d=!1,y=!1){const S=o.key;let C;if(C=y?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,C[S])return C[S];const I=this.calculatePosMatrix(o,this.worldSize);let j;return j=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,r.aB(I,j,I),C[S]=new Float32Array(I),C[S]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const S=r.cM(o,this);return y[d]=S,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,d=r.bp([],[o,o,o]);return r.aB(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const d=r.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),S=this._camera.forward(),C=r.ce(1,this._center.lat);y[2]/=C,S[2]/=C,r.aw(S,S);const I=o.raycast(y,S,o.exaggeration());if(I){const j=r.bG([],y,S,I),z=new r.ae(j[0],j[1],r.ce(j[2],r.a_(j[1]))),$=(z.z+r.ag([z.x-y[0],z.y-y[1],z.z-y[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const d=this._elevation,y=r.ce(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(y),C=d.getAtPointOrZero(new r.ae(...S)),I=this.pixelsPerMeter/this.worldSize*C,j=this._minimumHeightOverTerrain(),z=S[2]-I;if(z<=j)if(z<0||o){const $=this.locationCoordinate(this._center,this._centerAltitude),q=[S[0],S[1],$.z-S[2]],ee=r.ag(q);q[2]-=(j-z)/this._pixelsPerMercatorPixel;const Q=r.ag(q);if(Q===0)return;r.c4(q,q,ee/Q*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],$.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Q=this.center;return Q.lat=r.aA(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Q.lng=r.aA(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:S}=this.point;let C=0,I=y,j=S;const z=this.width/2,$=this.height/2,q=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(S-$<q&&(j=q+$),S+$>ee&&(j=ee-$),ee-q<this.height&&(C=Math.max(C,this.height/(ee-q)),j=(ee+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,ie=this.worldMaxX*this.scale,le=this.worldSize/2-(Q+ie)/2;I=(y+le+this.worldSize)%this.worldSize-le,I-z<Q&&(I=Q+z),I+z>ie&&(I=ie-z),ie-Q<this.width&&(C=Math.max(C,this.width/(ie-Q)),I=(ie+Q)/2)}I===y&&j===S||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(I,j))),C&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const S=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,S),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C=this.projection.zAxisUnit==="meters"?y:1,I=this._camera.getWorldToCamera(this.worldSize,C);let j;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-o.x/this.width,z[9]=2*o.y/this.height,this.isOrthographic){let De=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Qe=De*this.aspect,dt=-Qe,lt=-De;Qe-=o.x,dt-=o.x,De+=o.y,lt+=o.y,j=this._camera.getCameraToClipOrthographic(dt,Qe,lt,De,this._nearZ,this._farZ),((Lt,Tt,Gt,hn)=>{for(let mt=0;mt<16;mt++)Lt[mt]=r.ak(Tt[mt],Gt[mt],hn)})(j,j,z,r.c$(this.pitch>=Ed?1:this.pitch/Ed))}else j=z;const $=r.cO([],z,I);let q=r.cO([],j,I);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),Qe=r.bz([]);r.bq(Qe,Qe,[De.x*this.worldSize,De.y*this.worldSize,0]),r.aB(Qe,Qe,r.cP(this)),r.bq(Qe,Qe,[-De.x*this.worldSize,-De.y*this.worldSize,0]),r.aB(q,q,Qe),r.aB($,$,Qe),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],q,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=q,this.invProjMatrix=r.bk(new Float64Array(16),this.projMatrix),d){const De=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);De[8]=2*-o.x/this.width,De[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.cO([],De,I)}else this.expandedFarZProjMatrix=this.projMatrix;const ee=r.bk([],j);this.frustumCorners=r.cS.fromInvProjectionMatrix(ee,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const Q=new Float32Array(16);r.bz(Q),r.cR(Q,Q,[1,-1,1]),r.cT(Q,Q,this._pitch),r.bA(Q,Q,this.angle);const ie=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.by(ie);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ie[8]=2*-o.x/this.width,ie[9]=2*(o.y+le)/this.height,this.skyboxMatrix=r.aB(Q,ie,Q);const de=this.point,be=de.x,_e=de.y,Se=this.width%2/2,Pe=this.height%2/2,Ee=Math.cos(this.angle),We=Math.sin(this.angle),Ne=be-Math.round(be)+Ee*Se+We*Pe,Xe=_e-Math.round(_e)+Ee*Pe+We*Se,ze=new Float64Array(q);if(r.bq(ze,ze,[Ne>.5?Ne-1:Ne,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=ze,q=r.bB(),r.cR(q,q,[this.width/2,-this.height/2,1]),r.bq(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=r.bB(),r.cR(q,q,[1,-1,1]),r.bq(q,q,[-1,-1,0]),r.cR(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,$),this._calcFogMatrices(),this._distanceTileDataCache={},q=r.bk(new Float64Array(16),this.pixelMatrix),!q)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=q,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(De,De,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=q;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,C=[o,o,d];r.c4(C,C,S),r.c4(y,y,-1),r.cV(y,y,C);const I=r.bB();r.bq(I,I,y),r.cR(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,S)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),S=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-y[0]*C,S.y/this.worldSize-y[1]*C,o/this.worldSize*this._centerAltitude-y[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],S=o[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(C=Math.min((d-y)/S,1)),this._camera.position=r.bG([],this._camera.position,o,C),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:S}=this._camera.getPitchBearing(),C=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),j=Math.max((o[2]-C)/Math.cos(y),I),z=this._zoomFromMercatorZ(j);r.bG(o,o,d,j),this._pitch=r.aA(y,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bS(S,-Math.PI,Math.PI),this._setZoom(r.aA(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let d=0,y=r.cK,S=0,C=1/0;for(;y-d>1e-6&&y>d;){const I=d+.5*(y-d),j=this.tileSize*Math.pow(2,I),z=this.getCameraToCenterDistance(this.projection,I,j),$=this.scaleZoom(z/(Math.max(0,o)*this.tileSize)),q=Math.abs(I-$);q<C&&(C=q,S=I),I<$?d=I:y=I}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,d){const y=Math.min(o.x,d.x),S=Math.max(o.x,d.x),C=Math.min(o.y,d.y),I=Math.max(o.y,d.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new r.P(y,C),new r.P(S,I),new r.P(y,I),new r.P(S,C)],z=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const q of j){const ee=this.pointRayIntersection(q);if(ee.t<0)return!0;const Q=this.rayIntersectionCoordinate(ee);if(Q.x<z||Q.y<0||Q.x>$||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,d){const y=r.ag(r.av([],this._camera.position,o)),S=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const o=(function([d,y,S],C){const I=[d,y,S,1];r.aC(I,I,C);const j=I[3]=Math.max(I[3],1e-6);return I[0]/=j,I[1]/=j,I[2]/=j,I})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,d=this.zoom,y=this.worldSize){const S=r.cN(o,d,this.width,this.height,1024),C=o.pixelSpaceConversion(this.center.lat,y,S);let I=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(I=r.ak(1,I,r.c$(this.pitch>=Ed?1:this.pitch/Ed))),I}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(o,o,this.globeMatrix),o}getFrustum(o){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const _c=(g,o)=>{if(o>0&&g.terrain&&r.w("Cutoff is currently disabled on terrain"),o<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,y=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),S=d.isLODDisabled(!1)?r.ah(60,45,d.pitch):r.ah(30,15,d.pitch),C=d._farZ-d._nearZ,I=o*d.height,j=((1-(z=S))*d.cameraToCenterDistance+z*(d._farZ+I))*y;var z;return{shouldRenderCutoff:S<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(j-d._nearZ)/C,(j-I-d._nearZ)/C]}}},Po={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class e_{constructor(o,d){this.aabb=o,this.lastCascade=d}}class t_{add(o,d){const y=this.receivers[o.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],d.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],d.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],d.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],d.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],d.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],d.max[2])):this.receivers[o.key]=new e_(d,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,d,y){const S=r.d8.fromPoints(o.points);let C=0;for(const I in this.receivers){const j=this.receivers[I];if(!j||!S.intersectsAabb(j.aabb))continue;j.aabb.min=S.closestPoint(j.aabb.min),j.aabb.max=S.closestPoint(j.aabb.max);const z=j.aabb.getCorners();for(let $=0;$<y.length;$++){let q=!0;for(const ee of z){const Q=[ee[0]*d,ee[1]*d,ee[2]];if(r.af(Q,Q,y[$].matrix),Q[0]<-1||Q[0]>1||Q[1]<-1||Q[1]>1){q=!1;break}}if(j.lastCascade=$,C=Math.max(C,$),q)break}}return C+1}}class Op{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new t_,this._depthMode=new Xn(o.context.gl.LEQUAL,Xn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),o.tp.registerParameter(Po,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Po,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(Po,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,d){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const S=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||S<=0||(this._shadowLayerCount=y.style.order.reduce(((le,de)=>{const be=y.style._mergedLayers[de];return le+(be.hasShadowPass()&&!be.isHidden(o.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=y.context,I=Po.shadowMapResolution,j=Po.shadowMapResolution;if(this._cascades.length===0||Po.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<Po.cascadeCount;++le){const de=y._shadowMapDebug,be=C.gl,_e=C.createFramebuffer(I,j,de,"texture"),Se=new r.T(C,{width:I,height:j,data:null},be.DEPTH_COMPONENT16);if(_e.depthAttachment.set(Se.texture),de){const Pe=new r.T(C,{width:I,height:j,data:null},be.RGBA8);_e.colorAttachment.set(Pe.texture)}this._cascades.push({framebuffer:_e,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=n_(d);let z=0;if(o.elevation){const le=o.elevation,de=[1e4,-1e4];le.visibleDemTiles.filter((be=>be.dem)).forEach((be=>{const _e=be.dem.tree;de[0]=Math.min(de[0],_e.minimums[0]),de[1]=Math.max(de[1],_e.maximums[0])})),de[0]!==1e4&&(z=(de[1]-de[0])*le.exaggeration())}const $=1.5*o.cameraToCenterDistance,q=3*$,ee=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const de=this._cascades[le];let be=o.height/50,_e=1;Po.cascadeCount===1?_e=q:le===0?_e=$:(be=$,_e=q);const[Se,Pe]=r_(o,this.shadowDirection,be,_e,Po.shadowMapResolution,z);de.scale=o.scale,de.matrix=Se,de.boundingSphereRadius=Pe,r.bk(ee,de.matrix),de.frustum=r.cA.fromInvProjectionMatrix(ee,1,0,!0),de.far=_e}const Q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Q].far,this._cascades[Q].far],this._uniformValues.u_shadow_intensity=S,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Po.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Po.shadowMapResolution,this._uniformValues.u_shadowmap_0=go.ShadowMap0,this._uniformValues.u_shadowmap_1=go.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ie=y.transform.elevation;for(const le of this._groundShadowTiles){let de={min:0,max:0};if(ie){const be=ie.getMinMaxForTile(le);be&&(de=be)}this.addShadowReceiver(le.toUnwrapped(),de.min,de.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,d){if(!this.enabled)return;const y=this.painter,S=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),S.viewport.set([0,0,Po.shadowMapResolution,Po.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){y.currentShadowCascade=C,S.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),S.clear({color:r.ao.white,depth:1});for(const I of o.order){const j=o._mergedLayers[I];if(!j.hasShadowPass()||j.isHidden(y.transform.zoom))continue;const z=o.getLayerSourceCache(j),$=z?d[z.id]:void 0;(j.type==="model"||$&&$.length)&&y.renderLayer(y,z,j,$)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,d=o.style,y=o.context,S=y.gl,C=d.directionalLight,I=d.ambientLight;if(!C||!I)return;const j=[],z=_c(o,o.longestCutoffRange);z.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),j.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&j.push("NORMAL_OFFSET");const $=Zl(d,C,I),q=new Xn(S.LEQUAL,Xn.ReadOnly,o.depthRangeFor3D),ee=new Cr({func:S.EQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.KEEP);for(const Q of this._groundShadowTiles){const ie=Q.toUnwrapped(),le=o.isTileAffectedByFog(Q),de=o.getOrCreateProgram("groundShadow",{defines:j,overrideFog:le});this.setupShadows(ie,de),o.uploadCommonUniforms(y,de,ie,null,z);const be={u_matrix:o.transform.calculateProjMatrix(ie),u_ground_shadow_factor:$};de.draw(o,S.TRIANGLES,q,ee,si.multiply,Dr.disabled,be,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?si.unblended:si.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const d=this.painter.transform,y=d.calculatePosMatrix(o,d.worldSize);return r.aB(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(o){const d=r.by(o);return r.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,o),d}setupShadows(o,d,y){if(!this.enabled)return;const S=this.painter.transform,C=this.painter.context,I=C.gl,j=this._uniformValues,z=new Float64Array(16),$=S.calculatePosMatrix(o,S.worldSize);for(let q=0;q<this._cascades.length;q++)r.aB(z,this._cascades[q].matrix,$),j[q===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),C.activeTexture.set(I.TEXTURE0+go.ShadowMap0+q),this._cascades[q].texture.bindExtraParam(I.LINEAR,I.LINEAR,I.CLAMP_TO_EDGE,I.CLAMP_TO_EDGE,I.GREATER);if(this.useNormalOffset=!!y,this.useNormalOffset){const q=r.d6(o.canonical),ee=2/S.tileSize*r.al/Po.shadowMapResolution,Q=ee*this._cascades[0].boundingSphereRadius,ie=ee*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(y==="vector-tile"?1:3)*(function(de,be,_e,Se,Pe){const Ee=r.aA((de-22)/-22,0,1);return .125*(1-Ee)+4*Ee})(S.zoom);j.u_shadow_normal_offset=[q,Q*le,ie*le],j.u_shadow_bias=[1e-4,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(C,j)}setupShadowsFromMatrix(o,d,y=!1){if(!this.enabled)return;const S=this.painter.context,C=S.gl,I=this._uniformValues,j=new Float64Array(16);for(let z=0;z<Po.cascadeCount;z++)r.aB(j,this._cascades[z].matrix,o),I[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),S.activeTexture.set(C.TEXTURE0+go.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(C.LINEAR,C.LINEAR,C.CLAMP_TO_EDGE,C.CLAMP_TO_EDGE,C.GREATER);if(this.useNormalOffset=y,y){const z=Po.normalOffset;I.u_shadow_normal_offset=[1,z,z],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,I)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,d,y,S){if(S[2]>=0)return{};const C=(function(z,$,q){const ee=q/(1<<z.canonical.z);return new r.d8([z.canonical.x*ee+z.wrap*q,z.canonical.y*ee+z.wrap*q,0],[(z.canonical.x+1)*ee+z.wrap*q,(z.canonical.y+1)*ee+z.wrap*q,$])})(o,d,y).getCorners(),I=d/-S[2];S[0]<0?(r.d7(C[0],C[0],[S[0]*I,0,0]),r.d7(C[3],C[3],[S[0]*I,0,0])):S[0]>0&&(r.d7(C[1],C[1],[S[0]*I,0,0]),r.d7(C[2],C[2],[S[0]*I,0,0])),S[1]<0?(r.d7(C[0],C[0],[0,S[1]*I,0]),r.d7(C[1],C[1],[0,S[1]*I,0])):S[1]>0&&(r.d7(C[2],C[2],[0,S[1]*I,0]),r.d7(C[3],C[3],[0,S[1]*I,0]));const j={};return j.vertices=C,j.planes=[Cd(C[1],C[0],C[4]),Cd(C[2],C[1],C[5]),Cd(C[3],C[2],C[6]),Cd(C[0],C[3],C[7])],j}addShadowReceiver(o,d,y){this._receivers.add(o,r.d8.fromTileIdAndHeight(o,d,y))}getMaxCascadeForTile(o){const d=this._receivers.get(o);return d&&d.lastCascade?d.lastCascade:0}}function Cd(g,o,d){const y=r.av([],d,o),S=r.av([],g,o),C=r.bH([],y,S),I=r.ag(C);return I===0?[0,0,1,0]:(r.c4(C,C,1/I),[C[0],C[1],C[2],-r.bI(C,o)])}function n_(g){const o=g.properties.get("direction"),d=r.d3(o.x,o.y,o.z);d[2]=r.aA(d[2],0,75);const y=r.d5([d[0],d[1],d[2]]);return r.d4(y.x,y.y,y.z)}function Zl(g,o,d){const y=o.properties.get("color-use-theme")==="none",S=o.properties.get("color"),C=o.properties.get("intensity"),I=o.properties.get("direction"),j=[I.x,I.y,I.z],z=d.properties.get("color-use-theme")==="none",$=d.properties.get("color"),q=d.properties.get("intensity"),ee=Math.max(r.bI([0,0,1],j),0),Q=[0,0,0];r.c4(Q,$.toPremultipliedRenderColor(z?null:g.getLut(o.scope)).toArray01Linear().slice(0,3),q);const ie=[0,0,0];return r.c4(ie,S.toPremultipliedRenderColor(y?null:g.getLut(d.scope)).toArray01Linear().slice(0,3),ee*C),r.da([Q[0]>0?Q[0]/(Q[0]+ie[0]):0,Q[1]>0?Q[1]/(Q[1]+ie[1]):0,Q[2]>0?Q[2]/(Q[2]+ie[2]):0])}function r_(g,o,d,y,S,C){const I=g.zoom,j=g.scale,z=g.worldSize,$=1/z,q=g.aspect,ee=Math.sqrt(1+q*q)*Math.tan(.5*g.fovX),Q=ee*ee,ie=y-d,le=y+d;let de,be;Q>ie/le?(de=y,be=y*ee):(de=.5*le*(1+Q),be=.5*Math.sqrt(ie*ie+2*(y*y+d*d)*Q+le*le*Q*Q));const _e=g.projection.pixelsPerMeter(g.center.lat,z),Se=g._camera.getCameraToWorldMercator(),Pe=[0,0,-de*$];r.af(Pe,Pe,Se);let Ee=be*$;const We=g._edgeInsets;if(!(We.left===0&&We.top===0&&We.right===0&&We.bottom===0||We.left===We.right&&We.top===We.bottom)){const Jt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?_e:1),_n=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,y);_n[8]=2*-g.centerOffset.x/g.width,_n[9]=2*g.centerOffset.y/g.height;const Vn=new Float64Array(16);r.cO(Vn,_n,Jt);const fn=new Float64Array(16);r.bk(fn,Vn);const yn=r.cA.fromInvProjectionMatrix(fn,z,I,!0);for(const $n of yn.points){const On=((Ne=$n)[0]/=j,Ne[1]/=j,Ne[2]=r.ce(Ne[2],g._center.lat),Ne);Ee=Math.max(Ee,r.c5(r.d9([],Pe,On)))}}var Ne;Ee*=S/(S-1);const Xe=Math.acos(o[2]),ze=Math.atan2(-o[0],-o[1]),De=new _g;De.position=Pe,De.setPitchBearing(Xe,ze);const Qe=De.getWorldToCamera(z,_e),dt=Ee*z,lt=Math.min(g._mercatorZfromZoom(17)*z*-2,-2*dt),Lt=De.getCameraToClipOrthographic(-dt,dt,-dt,dt,lt,(dt+C*_e)/o[2]),Tt=new Float64Array(16);r.aB(Tt,Lt,Qe);const Gt=r.d4(Math.floor(1e6*Pe[0])/1e6*z,Math.floor(1e6*Pe[1])/1e6*z,0),hn=.5*S,mt=[0,0,0];r.af(mt,Gt,Tt),r.c4(mt,mt,hn);const rt=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],zt=[0,0,0];r.av(zt,mt,rt),r.c4(zt,zt,-1/hn);const Mt=new Float64Array(16);return r.bz(Mt),r.bq(Mt,Mt,zt),r.aB(Tt,Mt,Tt),[Tt,dt]}class ll extends r.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,d){return r.db(this.requestManager.transformRequest(d,r.R.Model).url).then((y=>{if(!y)return;const S=r.dc(y),C=new r.dd(o,d,void 0,void 0,S);return C.computeBoundsAndApplyParent(),C})).catch((y=>{if(y&&y.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${o} from ${d}: ${y.message}`)))}))}load(o,d,y={forceReload:!1}){this.models[d]||(this.models[d]={});const S=Object.keys(o),C=[],I=[];for(const j of S){const z=o[j];this.hasURLBeenRequested(z)&&!y.forceReload||(this.modelByURL[z]={modelId:j,scope:d},C.push(this.loadModel(j,z)),I.push(j)),this.models[d][j]||(this.models[d][j]={model:null,numReferences:1})}this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+I.length,Promise.allSettled(C).then((j=>{for(let z=0;z<j.length;z++){const{status:$}=j[z];if($==="rejected")continue;const{value:q}=j[z];this.models[d][I[z]]||(this.models[d][I[z]]={model:null,numReferences:1}),this.models[d][I[z]].model=q}this.numModelsLoading[d]-=I.length,this.fire(new r.z("data",{dataType:"style"}))})).catch((j=>{this.fire(new r.y(new Error(`Could not load models: ${j.message}`)))}))}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,d,y={exactIdMatch:!1}){return!!(y.exactIdMatch?this.getModel(o,d):this.getModelByURL(this.modelUris[d][o]))}getModel(o,d){return this.models[d]||(this.models[d]={}),this.models[d][o]?this.models[d][o].model:void 0}getModelByURL(o){if(!o)return null;const d=this.modelByURL[o];return d?this.models[d.scope][d.modelId].model:null}hasModelBeenAdded(o,d){return this.models[d]&&this.models[d][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,d,y){this.models[y]||(this.models[y]={}),this.modelUris[y]||(this.modelUris[y]={});const S=this.requestManager.normalizeModelURL(d);if((this.hasModel(o,y,{exactIdMatch:!0})||this.hasModelBeenAdded(o,y))&&this.modelUris[y][o]===S)this.models[y][o].numReferences++;else if(this.hasURLBeenRequested(S)){const{scope:C,modelId:I}=this.modelByURL[S];this.models[C][I].numReferences++}else this.modelUris[y][o]=S,this.load({[o]:this.modelUris[y][o]},y)}addModelURLs(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y=this.modelUris[d];for(const S in o)y[S]=this.requestManager.normalizeModelURL(o[S])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y={};for(const S of o)this.hasModel(S,d,{exactIdMatch:!0})||this.hasURLBeenRequested(S)?this.models[d][S].numReferences++:this.modelUris[d][S]&&!this.hasURLBeenRequested(S)?y[S]=this.modelUris[d][S]:!this.hasURLBeenRequested(S)&&r.de(S,!1)&&(this.modelUris[d][S]=this.requestManager.normalizeModelURL(S),y[S]=this.modelUris[d][S]);this.load(y,d)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,d,y=!1,S=!1){if(this.models[d]&&this.models[d][o]&&(this.models[d][o].numReferences--,this.models[d][o].numReferences===0||S)){const C=this.modelUris[d][o];y||delete this.modelUris[d][o],delete this.modelByURL[C];const I=this.models[d][o].model;if(!I)return;delete this.models[d][o],I.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const d of Object.keys(this.models[o])){const y=this.models[o][d].model;delete this.models[o][d],y&&y.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,d){this.models[d]||(this.models[d]={});for(const y in this.models[d])this.models[d][y].model&&this.models[d][y].model.upload(o.context)}}const Ru=r.a6.colorTheme,Nu=new r.a9({data:new r.aa(Ru.data)});function i_(g){if(!g.metadata||!g.metadata.content_area)return;const o=r.o.devicePixelRatio,{left:d,top:y,width:S,height:C}=g.metadata.content_area,I=d*o,j=y*o;return[I,j,I+S*o,j+C*o]}function ny(g){if(g)return g.map((([o,d])=>[o*r.o.devicePixelRatio,d*r.o.devicePixelRatio]))}class s_{constructor(o,d,y){this.id=o,this.scope=d,this.sourceCache=y,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const d=this.sourceCache.getVisibleCoordinates();if(d.length===0)return o;const y=this.sourceCache.getSource();if(!(y instanceof Gs))return o;const S=d.map((I=>this.sourceCache.getTile(I))),C=y.getImages(S,Array.from(this.pendingRequests));for(const[I,j]of C)o.set(r.I.from({name:I,iconsetId:this.id}),j),this.pendingRequests.delete(I);for(const I of this.pendingRequests)this.missingRequests.add(I);return this.pendingRequests.clear(),o}}const nu=(g,o)=>me(g,o&&o.filter((d=>d.identifier!=="source.canvas"))),kb=r.aH(Di,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ry=r.aH(Di,["setCenter","setZoom","setBearing","setPitch"]),ju=new Set(["background","sky","slot","custom"]),Fp={version:8,layers:[],sources:{}},yh={duration:300,delay:0};class cl extends r.E{constructor(o,d={}){super(),this.map=o,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=Object.assign({},yh),this._buildingIndex=new fg(this),this.crossTileSymbolIndex=new tu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=d.styleChanges||new ht,this.dispatcher=d.dispatcher?d.dispatcher:new r.D(r.dg(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Br(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new r.dh(o._requestManager,d.localFontFamily?r.di.all:d.localIdeographFontFamily?r.di.ideographs:r.di.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new ll(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._indoorDependentLayers=d.indoorDependentLayers?d.indoorDependentLayers:new Set,this._config=d.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:d.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",r.dj());const y=this;this._rtlTextPluginCallback=cl.registerForPluginStateChange((S=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},((C,I)=>{if(r.dk(C),I&&I.every((j=>j)))for(const j in y._sourceCaches){const z=y._sourceCaches[j],$=z.getSource().type;$!=="vector"&&$!=="geojson"||z.reload()}}))})),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const C=this.getOwnSource(S.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const j=this._layers[I];j.source===C.id&&this._validateLayer(j)}}))}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(r.h(o))return o;const d=r.dl(o);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${r.dm(JSON.stringify(o))}`}_diffStyle(o,d,y){this.globalId=this._getGlobalId(o);const S=(C,I)=>{try{I(null,this.setState(C,y))}catch(j){I(j,!1)}};if(typeof o=="string"){const C=this.map._requestManager.normalizeStyleURL(o),I=this.map._requestManager.transformRequest(C,r.R.Style);r.m(I,((j,z)=>{j?this.fire(new r.y(j)):z&&S(z,d)}))}else typeof o=="object"&&S(o,d)}loadURL(o,d={}){this.fire(new r.z("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!r.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,d.accessToken),this.resolvedImports.add(o);const S=this.importsCache.get(o);if(S)return this._load(S,y);const C=this.map._requestManager.transformRequest(o,r.R.Style);this._request=r.m(C,((I,j)=>{if(this._request=null,I)this.fire(new r.y(I));else if(j)return this.importsCache.set(o,j),this._load(j,y)}))}loadJSON(o,d={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=r.o.frame((()=>{this._request=null,this._load(o,d.validate!==!1)}))}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Fp,!1)}_loadImports(o,d,y){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const S=[];for(const C of o){const I=this._createFragmentStyle(C),j=new Promise((q=>{I.once("style.import.load",q),I.once("error",q)})).then((()=>this.mergeAll()));if(S.push(j),this.resolvedImports.has(C.url)){I.loadEmpty();continue}const z=C.data||this.importsCache.get(C.url);z?(I.loadJSON(z,{validate:d}),this._isInternalStyle(z)&&(I.globalId=null)):C.url?I.loadURL(C.url,{validate:d}):I.loadEmpty();const $={style:I,id:C.id,config:C.config};if(y){const q=this.fragments.findIndex((({id:ee})=>ee===y));this.fragments=this.fragments.slice(0,q).concat($).concat(this.fragments.slice(q))}else this.fragments.push($)}return Promise.allSettled(S)}getImportGlobalIds(o=this,d=new Set){for(const y of o.fragments)y.style.globalId&&d.add(y.style.globalId),this.getImportGlobalIds(y.style,d);return[...d.values()]}_createFragmentStyle(o){const d=this.scope?r.B(o.id,this.scope):o.id;let y;const S=this._initialConfig&&this._initialConfig[d];(o.config||S)&&(y=Object.assign({},o.config,S));const C=new cl(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,d){if(this._isInternalStyle(o)){const C=Object.assign({},Fp,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(C,d)}if(this.updateConfig(this._config,o.schema),d&&nu(this,ln(o)))return;this._loaded=!0,this.stylesheet=r.dn(o);const y=()=>{for(const z in o.sources)this.addSource(z,o.sources[z],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const z in o.iconsets)this.addIconset(z,o.iconsets[z]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const C=dh(this.stylesheet.layers);if(this._order=C.map((z=>z.id)),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new tt(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tt(this.stylesheet.light)),this._layers={};for(const z of C){const $=r.dt(z,this.scope,this._styleColorTheme.lut,this.options);$.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add($.fqid),$.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add($.fqid),this._hasAppearances=this._hasAppearances||$.getAppearances().length!==0,$.setEventedParent(this,{layer:{id:$.id}}),this._layers[$.id]=$;const q=this.getOwnLayerSourceCache($),ee=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&$.canCastShadows()&&ee&&(q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const j=this.isRootStyle();o.imports?this._loadImports(o.imports,d).then((()=>{this._reloadImports(),this.fire(new r.z(j?"style.load":"style.import.load"))})).catch((z=>{this.fire(new r.y(new Error("Failed to load imports",z))),this.fire(new r.z(j?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new r.z(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const S=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(S){const C=this._evaluateColorThemeData(S);this._loadColorTheme(C).then((()=>{y()})).catch((I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),y()}))}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let o,d,y,S,C,I,j,z,$,q;const ee={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((Q=>{if(Q.stylesheet){if(Q.light!=null&&(o=Q.light),Q.stylesheet.lights)for(const ie of Q.stylesheet.lights)ie.type==="ambient"&&Q.ambientLight!=null&&(d=Q.ambientLight),ie.type==="directional"&&Q.directionalLight!=null&&(y=Q.directionalLight);S=this._prioritizeTerrain(S,Q.terrain,Q.stylesheet.terrain),Q.stylesheet.fog&&Q.fog!=null&&(C=Q.fog),Q.stylesheet.snow&&Q.snow!=null&&(I=Q.snow),Q.stylesheet.rain&&Q.rain!=null&&(j=Q.rain),Q.stylesheet.camera!=null&&(q=Q.stylesheet.camera),Q.stylesheet.projection!=null&&(z=Q.stylesheet.projection),Q.stylesheet.transition!=null&&($=Q.stylesheet.transition),ee[Q.scope]=Q._styleColorTheme}})),this.light=o,this.ambientLight=d,this.directionalLight=y,this.fog=C,this.snow=I,this.rain=j,this._styleColorThemeForScope=ee,S===null?delete this.terrain:this.terrain=S,this.camera=q||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=Object.assign({},yh,$),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const d=y=>{for(const S of y.fragments)d(S.style);o(y)};d(this)}_prioritizeTerrain(o,d,y){const S=o&&o.drapeRenderMode===0;return y===null?d&&d.drapeRenderMode===0?d:S?o:null:d!=null&&(!o||S||d&&d.drapeRenderMode===1)?d:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((d=>{o=this._prioritizeTerrain(o,d.terrain,d.stylesheet.terrain)})),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle((d=>{d.stylesheet.projection!=null&&(o=d.stylesheet.projection)})),this.projection=o||{name:"mercator"}}mergeSources(){const o={},d={},y={};this.forEachFragmentStyle((S=>{for(const C in S._sourceCaches){const I=r.B(C,S.scope);o[I]=S._sourceCaches[C]}for(const C in S._otherSourceCaches){const I=r.B(C,S.scope);d[I]=S._otherSourceCaches[C]}for(const C in S._symbolSourceCaches){const I=r.B(C,S.scope);y[I]=S._symbolSourceCaches[C]}})),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=y}mergeIndoor(){this.forEachFragmentStyle((o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const d of Object.values(o.stylesheet.indoor)){const y=d,S=r.B(y.sourceId,o.scope);this._mergedIndoor[S]=new Set(y.sourceLayers||[])}}))}mergeLayers(){const o={},d=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((I=>{for(const j of I._order){const z=I._layers[j];if(z.type==="slot"){const $=r.dp(j);if(o[$])continue;o[$]=[]}z.slot&&o[z.slot]?o[z.slot].push(z):d.push(z)}})),this._mergedOrder=[];let S=-1;const C=(I=[])=>{for(const j of I)if(j.type==="slot"){const z=r.dp(j.id);o[z]&&C(o[z]),this._mergedSlots.push(z)}else{const z=r.B(j.id,j.scope);this._mergedOrder.push(z),y[z]=j,j.is3D(!!this.terrain)&&(this._has3DLayers=!0,S=this._mergedOrder.length-1),j.type==="circle"&&(this._hasCircleLayers=!0),j.type==="symbol"&&(this._hasSymbolLayers=!0),j.type==="clip"&&(this._clipLayerPresent=!0)}};if(C(d),this._has3DLayers){const I={};for(let j=0;j<this._mergedOrder.length;++j){const z=this._mergedOrder[j];I[z]=j===S?1:j<S?y[z].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((j,z)=>I[j]-I[z]))}this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?(function(d,y,S,C){const I=Object.assign({},y);for(const z of Object.keys(Ru))I[z]===void 0&&(I[z]=Ru[z].default);const j=new r.a8(Nu,d,new Map(S));return j.setTransitionOrValue(I,S),j.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((y,S)=>{const C="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let I=o;I.startsWith(C)||(I=C+I);const j=r.I.from("mapbox-reserved-lut"),z=new Image;z.src=I,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,S(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void y();this._styleColorTheme.lutLoading=!1;const{width:$,height:q,data:ee}=r.o.getImageData(z);if(q>32)return void S(new Error("The height of the image must be less than or equal to 32 pixels."));if($!==q*q)return void S(new Error("The width of the image must be equal to the height squared."));this.getImage(j)&&this.removeImage(j),this.addImage(j,{data:new r.q({width:$,height:q},ee),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Q=this.imageManager.getImage(j,this.scope);Q?(this._styleColorTheme.lut={image:Q.data,data:o},y()):S(new Error("Missing LUT image."))}}))}getLut(o){const d=this._styleColorThemeForScope[o];return d?d.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=(function(d,y,S){let C,I,j;const z=r.o.devicePixelRatio>1?"@2x":"";let $=r.m(y.transformRequest(y.normalizeSpriteURL(d,z,".json"),r.R.SpriteJSON),((Q,ie)=>{$=null,j||(j=Q,C=ie,ee())})),q=r.n(y.transformRequest(y.normalizeSpriteURL(d,z,".png"),r.R.SpriteImage),((Q,ie)=>{q=null,j||(j=Q,I=ie,ee())}));function ee(){if(j)S(j);else if(C&&I){const Q=r.o.getImageData(I),ie={};for(const le in C){const{width:de,height:be,x:_e,y:Se,sdf:Pe,pixelRatio:Ee,stretchX:We,stretchY:Ne,content:Xe}=C[le],ze=new r.q({width:de,height:be});r.q.copy(Q,ze,{x:_e,y:Se},{x:0,y:0},{width:de,height:be},null),ie[le]={data:ze,pixelRatio:Ee!==void 0?Ee:1,sdf:Pe!==void 0&&Pe,stretchX:We,stretchY:Ne,content:Xe,usvg:!1,version:0}}S(null,ie)}}return{cancel(){$&&($.cancel(),$=null),q&&(q.cancel(),q=null)}}})(o,this.map._requestManager,((d,y)=>{if(this._spriteRequest=null,d)this.fire(new r.y(d));else if(y){const S=new Map;for(const C in y)S.set(r.I.from(C),y[C]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))}))}addIconset(o,d){if(d.type==="sprite")return void this._loadSprite(d.url);const y=this.getOwnSourceCache(d.source);if(!y)return void this.fire(new r.y(new Error(`Source "${d.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const S=y.getSource();if(S.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${d.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));S.partial=!1;const C=new s_(o,this.scope,y);this.imageManager.addImageProvider(C,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!r.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const d=this.map._spriteFormat==="auto";var y,S;this._spriteRequest=(S=(C,I)=>{if(this._spriteRequest=null,C)d?this._loadSprite(o):this.fire(new r.y(C));else if(I){const j=new Map;for(const z in I)j.set(r.I.from(z),I[z]);this.addImages(j)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bt((y=this.map._requestManager).transformRequest(y.normalizeIconsetURL(o),r.R.Iconset),((C,I)=>{if(C)return void S(C);const j={},z=r.df(new r.bs(I));for(const $ of z.icons){const q={version:1,pixelRatio:r.o.devicePixelRatio,content:i_($),stretchX:$.metadata?ny($.metadata.stretch_x_areas):void 0,stretchY:$.metadata?ny($.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:$};j[$.name]=q}S(null,j)})))}_validateLayer(o){const d=this.getOwnSource(o.source);if(!d)return;const y=o.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new r.y(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((o,d)=>{const y=this.fragments[d];return y&&y.style&&(o.data=y.style.serialize()),o}))}_serializeSources(){const o={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();o[y.id]||(o[y.id]=y.serialize())}return o}_serializeLayers(o){const d=[];for(const y of o){const S=this._layers[y];S&&S.type!=="custom"&&d.push(S.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const d=this.getOwnLayer(o);if(d)return d;this.fire(new r.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const d=this.getOwnSource(o);if(d)return d;this.fire(new r.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,d){const y=this.map.painter;if(y)for(let S=o.minzoom||0;S<(o.maxzoom||25.5);S++){const C=o.getProgramIds();if(C)for(const I of C){const j=o.getDefaultProgramParams(I,d.zoom,this._styleColorTheme.lut);j&&(y.style=this,this.fog&&(y._fogVisible=!0,j.overrideFog=!0,y.getOrCreateProgram(I,j)),y._fogVisible=!1,j.overrideFog=!1,y.getOrCreateProgram(I,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,y.getOrCreateProgram(I,j)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const d=this.calculateLightsBrightness();o.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const y=this._changes.isDirty();let S=!1;if(this._changes.isDirty()){const j=this._changes.getLayerUpdatesByScope();for(const z in j){const{updatedIds:$,removedIds:q}=j[z];($||q)&&(this._updateWorkerLayers(z,$,q),S=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const C={};for(const j in this._mergedSourceCaches){const z=this._mergedSourceCaches[j];C[j]=z.used,z.used=!1,z.tileCoverLift=0}for(const j of this._mergedOrder){const z=this._mergedLayers[j];if(z.recalculate(o,this._availableImages),!z.isHidden(o.zoom)){const $=this.getLayerSourceCache(z);$&&($.used=!0,$.tileCoverLift=Math.max($.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(z,o)})):this.precompilePrograms(z,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&S&&this.mergeLayers();const I=this.imageManager.getPendingImageProviders();for(const j of I)j.sourceCache.used=!0;for(const j in C){const z=this._mergedSourceCaches[j];C[j]!==z.used&&z.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),y&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const d of o){const y=d.resolvePendingRequests(),S=this.getFragmentStyle(d.scope);S&&S.addImages(y)}}_updateTilesForChangedImages(){const o={};for(const d in this._mergedSourceCaches){const y=this._mergedSourceCaches[d].getSource().scope;o[y]=o[y]||this._changes.getUpdatedImages(y),o[y].length!==0&&this._mergedSourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o[y])}for(const d in o)this._changes.resetUpdatedImages(d)}_updateWorkerLayers(o,d,y){const S=this.getFragmentStyle(o);S&&this.dispatcher.broadcast("updateLayers",{layers:d?S._serializeLayers(d):[],scope:o,removedIds:y||[],options:S.options})}setState(o,d){if(this._checkLoaded(),nu(this,ln(o)))return!1;(o=r.dn(o)).layers=dh(o.layers);const y=(function(I,j){if(!I)return[{command:Di.setStyle,args:[j]}];let z=[];try{if(!r.bx(I.version,j.version))return[{command:Di.setStyle,args:[j]}];if(r.bx(I.center,j.center)||z.push({command:Di.setCenter,args:[j.center]}),r.bx(I.zoom,j.zoom)||z.push({command:Di.setZoom,args:[j.zoom]}),r.bx(I.bearing,j.bearing)||z.push({command:Di.setBearing,args:[j.bearing]}),r.bx(I.pitch,j.pitch)||z.push({command:Di.setPitch,args:[j.pitch]}),r.bx(I.sprite,j.sprite)||z.push({command:Di.setSprite,args:[j.sprite]}),r.bx(I.glyphs,j.glyphs)||z.push({command:Di.setGlyphs,args:[j.glyphs]}),r.bx(I.imports,j.imports)||(function(ie=[],le=[],de){le=le||[];const be=(ie=ie||[]).map(Mp),_e=le.map(Mp),Se=ie.reduce(fh,{}),Pe=le.reduce(fh,{}),Ee=be.slice();let We,Ne,Xe,ze;for(We=0,Ne=0;We<be.length;We++)Xe=be[We],Pe.hasOwnProperty(Xe)?Ne++:(de.push({command:Di.removeImport,args:[Xe]}),Ee.splice(Ee.indexOf(Xe,Ne),1));for(We=0,Ne=0;We<_e.length;We++)Xe=_e[_e.length-1-We],Ee[Ee.length-1-We]!==Xe&&(Se.hasOwnProperty(Xe)?(de.push({command:Di.removeImport,args:[Xe]}),Ee.splice(Ee.lastIndexOf(Xe,Ee.length-Ne),1)):Ne++,ze=Ee[Ee.length-We],de.push({command:Di.addImport,args:[Pe[Xe],ze]}),Ee.splice(Ee.length-We,0,Xe));for(const De of le){const Qe=Se[De.id];Qe&&(delete Qe.data,r.bx(Qe,De)||de.push({command:Di.updateImport,args:[De.id,De]}))}})(I.imports,j.imports,z),r.bx(I.transition,j.transition)||z.push({command:Di.setTransition,args:[j.transition]}),r.bx(I.light,j.light)||z.push({command:Di.setLight,args:[j.light]}),r.bx(I.fog,j.fog)||z.push({command:Di.setFog,args:[j.fog]}),r.bx(I.snow,j.snow)||z.push({command:Di.setSnow,args:[j.snow]}),r.bx(I.rain,j.rain)||z.push({command:Di.setRain,args:[j.rain]}),r.bx(I.projection,j.projection)||z.push({command:Di.setProjection,args:[j.projection]}),r.bx(I.lights,j.lights)||z.push({command:Di.setLights,args:[j.lights]}),r.bx(I.camera,j.camera)||z.push({command:Di.setCamera,args:[j.camera]}),r.bx(I.iconsets,j.iconsets)||(function(ie,le,de){let be;for(be in le=le||{},ie=ie||{})ie.hasOwnProperty(be)&&(le.hasOwnProperty(be)||de.push({command:Di.removeIconset,args:[be]}));for(be in le){if(!le.hasOwnProperty(be))continue;const _e=le[be];ie.hasOwnProperty(be)?r.bx(ie[be],_e)||(de.push({command:Di.removeIconset,args:[be]}),de.push({command:Di.addIconset,args:[be,_e]})):de.push({command:Di.addIconset,args:[be,_e]})}})(I.iconsets,j.iconsets,z),!r.bx(I["color-theme"],j["color-theme"]))return[{command:Di.setStyle,args:[j]}];const $={},q=[];(function(ie,le,de,be){let _e;for(_e in le=le||{},ie=ie||{})ie.hasOwnProperty(_e)&&(le.hasOwnProperty(_e)||Mu(_e,de,be));for(_e in le){if(!le.hasOwnProperty(_e))continue;const Se=le[_e];ie.hasOwnProperty(_e)?r.bx(ie[_e],Se)||(ie[_e].type==="geojson"&&Se.type==="geojson"&&gf(ie,le,_e)?de.push({command:Di.setGeoJSONSourceData,args:[_e,Se.data]}):Kc(_e,le,de,be)):hh(_e,le,de)}})(I.sources,j.sources,q,$);const ee=[];I.layers&&I.layers.forEach((ie=>{ie.source&&$[ie.source]?z.push({command:Di.removeLayer,args:[ie.id]}):ee.push(ie)}));let Q=I.terrain;Q&&$[Q.source]&&(z.push({command:Di.setTerrain,args:[void 0]}),Q=void 0),z=z.concat(q),r.bx(Q,j.terrain)||z.push({command:Di.setTerrain,args:[j.terrain]}),(function(ie,le,de){le=le||[];const be=(ie=ie||[]).map(Mp),_e=le.map(Mp),Se=ie.reduce(fh,{}),Pe=le.reduce(fh,{}),Ee=be.slice(),We=Object.create(null);let Ne,Xe,ze,De,Qe,dt,lt;for(Ne=0,Xe=0;Ne<be.length;Ne++)ze=be[Ne],Pe.hasOwnProperty(ze)?Xe++:(de.push({command:Di.removeLayer,args:[ze]}),Ee.splice(Ee.indexOf(ze,Xe),1));for(Ne=0,Xe=0;Ne<_e.length;Ne++)ze=_e[_e.length-1-Ne],Ee[Ee.length-1-Ne]!==ze&&(Se.hasOwnProperty(ze)?(de.push({command:Di.removeLayer,args:[ze]}),Ee.splice(Ee.lastIndexOf(ze,Ee.length-Xe),1)):Xe++,dt=Ee[Ee.length-Ne],de.push({command:Di.addLayer,args:[Pe[ze],dt]}),Ee.splice(Ee.length-Ne,0,ze),We[ze]=!0);for(Ne=0;Ne<_e.length;Ne++)if(ze=_e[Ne],De=Se[ze],Qe=Pe[ze],!We[ze]&&!r.bx(De,Qe))if(r.bx(De.source,Qe.source)&&r.bx(De["source-layer"],Qe["source-layer"])&&r.bx(De.type,Qe.type)){for(lt in Cp(De.layout,Qe.layout,de,ze,null,Di.setLayoutProperty),Cp(De.paint,Qe.paint,de,ze,null,Di.setPaintProperty),r.bx(De.slot,Qe.slot)||de.push({command:Di.setSlot,args:[ze,Qe.slot]}),r.bx(De.filter,Qe.filter)||de.push({command:Di.setFilter,args:[ze,Qe.filter]}),r.bx(De.minzoom,Qe.minzoom)&&r.bx(De.maxzoom,Qe.maxzoom)||de.push({command:Di.setLayerZoomRange,args:[ze,Qe.minzoom,Qe.maxzoom]}),De)De.hasOwnProperty(lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&lt!=="slot"&&(lt.indexOf("paint.")===0?Cp(De[lt],Qe[lt],de,ze,lt.slice(6),Di.setPaintProperty):r.bx(De[lt],Qe[lt])||de.push({command:Di.setLayerProperty,args:[ze,lt,Qe[lt]]}));for(lt in Qe)Qe.hasOwnProperty(lt)&&!De.hasOwnProperty(lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&lt!=="slot"&&(lt.indexOf("paint.")===0?Cp(De[lt],Qe[lt],de,ze,lt.slice(6),Di.setPaintProperty):r.bx(De[lt],Qe[lt])||de.push({command:Di.setLayerProperty,args:[ze,lt,Qe[lt]]}))}else de.push({command:Di.removeLayer,args:[ze]}),dt=Ee[Ee.lastIndexOf(ze)+1],de.push({command:Di.addLayer,args:[Qe,dt]})})(ee,j.layers,z)}catch($){console.warn("Unable to compute style diff:",$),z=[{command:Di.setStyle,args:[j]}]}return z})(this.serialize(),o).filter((I=>!(I.command in ry)));if(y.length===0)return!1;const S=y.filter((I=>!(I.command in kb)));if(S.length>0)throw new Error(`Unimplemented: ${S.map((I=>I.command)).join(", ")}.`);const C=[];return y.forEach((I=>{C.push(this[I.command](...I.args))})),d&&Promise.all(C).then(d).catch(d),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[d,y]of o.entries()){if(this.getImage(d))return this.fire(new r.y(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,this.scope,y),this._changes.updateImage(d,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(o,d){return this.getImage(o)?this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(o,d,y=!1){this.imageManager.updateImage(o,this.scope,d),y&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(o,d,y={}){return this._checkLoaded(),this._validate(Hl,`models.${o}`,d,null,y)||(this.modelManager.addModel(o,d,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,d,y={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(Tr,`sources.${o}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const S=mo(o,d,this.dispatcher,this);S.scope=this.scope,S.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(S.id),source:S.serialize(),sourceId:S.id})));const C=I=>{const j=(I?"symbol:":"other:")+S.id,z=r.B(j,this.scope),$=this._sourceCaches[j]=new Wl(z,S,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[S.id]=$,$.onAdd(this.map)};C(!1),d.type!=="vector"&&d.type!=="geojson"||C(!0),S.onAdd&&S.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const d=this.getOwnSource(o);if(!d)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const S=Object.entries(this.stylesheet.iconsets).find((([C,I])=>I.type==="source"&&I.source===o));if(S)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while iconset "${S[0]}" is using it.`)))}const y=this.getOwnSourceCaches(o);for(const S of y){const C=r.dp(S.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(S.id),S.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getOwnSource(o).setData(d),this._changes.setDirty()}getOwnSource(o){const d=this.getOwnSourceCache(o);return d&&d.getSource()}getOwnSources(){const o=[];for(const d in this._otherSourceCaches){const y=this.getOwnSourceCache(d);y&&o.push(y.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const d in o){const y=o[d]._tiles;for(const S in y){const C=y[S];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const C of o){if(this._validate(Yi,"lights",C))return;switch(C.type){case"ambient":if(this.ambientLight){const I=this.ambientLight;I.set(C),I.updateTransitions(d)}else this.ambientLight=new Er(C,Hn||(Hn=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const I=this.directionalLight;I.set(C),I.updateTransitions(d)}else this.directionalLight=new Er(C,xr||(xr=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=Object.assign(d,{worldview:this.map.getWorldview()}),S=new r.ac(this.z||0,y);this.ambientLight&&this.ambientLight.recalculate(S),this.directionalLight&&this.directionalLight.recalculate(S),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,d=this.ambientLight;if(!o||!d)return;const y=Q=>.2126*(Q[0]<=.03928?Q[0]/12.92:Math.pow((Q[0]+.055)/1.055,2.4))+.7152*(Q[1]<=.03928?Q[1]/12.92:Math.pow((Q[1]+.055)/1.055,2.4))+.0722*(Q[2]<=.03928?Q[2]/12.92:Math.pow((Q[2]+.055)/1.055,2.4)),S=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),C=o.properties.get("intensity"),I=o.properties.get("direction"),j=1-r.d3(I.x,I.y,I.z)[2]/90,z=y(S)*C*j,$=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),q=d.properties.get("intensity"),ee=y($)*q;return Number(((z+ee)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(r.dq(o)){const d=r.dr(o),y=this.fragments.find((({id:C})=>C===d));if(!y)return;const S=r.dp(o);return y.style.getFragmentStyle(S)}{const d=this.fragments.find((({id:y})=>y===o));return d?d.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const d={},y=(S,C="")=>`${S}::${C}`;this._featuresetSelectors={};for(const S in o){const C=this._featuresetSelectors[S]=[];for(const I of o[S].selectors){if(I.featureNamespace){const z=this.getOwnLayer(I.layer);if(!z){r.w(`Layer is undefined for selector: ${I.layer}`);continue}const $=y(z.source,z.sourceLayer);if($ in d&&d[$]!==I.featureNamespace){r.w(`"featureNamespace ${I.featureNamespace} of featureset ${S}'s selector is not associated to the same source, skip this selector`);continue}d[$]=I.featureNamespace}let j;if(I.properties)for(const z in I.properties){const $=r.U(I.properties[z]);$.result==="success"&&(j=j||{},j[z]=$.value)}C.push({layerId:I.layer,namespace:I.featureNamespace,properties:j,uniqueFeatureID:I._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const d=this.getFragmentStyle(o);if(!d||!d.stylesheet.featuresets)return[];const y=[];for(const S in d.stylesheet.featuresets)y.push({featuresetId:S,importId:d.scope?d.scope:void 0});return y}getFeaturesetLayers(o,d){const y=this.getFragmentStyle(d),S=y.stylesheet.featuresets;if(!S||!S[o])return this.fire(new r.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const C=[];for(const I of S[o].selectors){const j=y.getOwnLayer(I.layer);j&&C.push(j)}return C}getConfigProperty(o,d){const y=this.getFragmentStyle(o);if(!y)return null;const S=r.B(d,y.scope),C=y.options.get(S),I=C?C.value||C.default:null;return I?I.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,d){const y=r.B(o,d);return this._mergedIndoor[y]}setIndoorData(o,d){this.map.indoor.setIndoorData(d)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,d,y){const S=this.getFragmentStyle(o);if(!S)return;const C=S.stylesheet.schema;if(!C||!C[d])return;const I=r.U(y);if(I.result!=="success")return void nu(this,I.value);const j=I.value.expression,z=r.B(d,S.scope),$=S.options.get(z);if(!$)return;let q;const{minValue:ee,maxValue:Q,stepValue:ie,type:le,values:de}=C[d],be=r.U(C[d].default);be.result==="success"&&(q=be.value.expression),q?(this.options.set(z,Object.assign({},$,{value:j,default:q,minValue:ee,maxValue:Q,stepValue:ie,type:le,values:de})),this.updateConfigDependencies(d)):this.fire(new r.y(new Error(`No schema defined for the config option "${d}" in the "${o}" fragment.`)))}getConfig(o){const d=this.getFragmentStyle(o);if(!d)return null;const y=d.stylesheet.schema;if(!y)return null;const S={};for(const C in y){const I=r.B(C,d.scope),j=d.options.get(I),z=j?j.value||j.default:null;S[C]=z?z.serialize():null}return S}setConfig(o,d){const y=this.getFragmentStyle(o);y&&(y.updateConfig(d,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const d=this.getFragmentStyle(o);return d?d.stylesheet.schema:null}setSchema(o,d){const y=this.getFragmentStyle(o);y&&(y.stylesheet.schema=d,y.updateConfig(y._config,d),this.updateConfigDependencies())}updateConfig(o,d){if(this._config=o,o||d)if(d)for(const y in d){let S,C;const I=r.U(d[y].default);if(I.result==="success"&&(S=I.value.expression),o&&o[y]!==void 0){const Q=r.U(o[y]);Q.result==="success"&&(C=Q.value.expression)}const{minValue:j,maxValue:z,stepValue:$,type:q,values:ee}=d[y];if(S){const Q=r.B(y,this.scope);this.options.set(Q,{default:S,value:C,minValue:j,maxValue:z,stepValue:$,type:q,values:ee})}else this.fire(new r.y(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,d=(()=>!0)){for(const y of o){const S=this.getLayer(y);S&&d(S)&&(S.possiblyEvaluateVisibility(),this._updateLayer(S),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,(d=>!o||d.expressionDependencies.configDependencies.has(o))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((d=>{const y=d._styleColorTheme.colorThemeOverride?d._styleColorTheme.colorThemeOverride:d._styleColorTheme.colorTheme;if(y){const S=d._evaluateColorThemeData(y);(!d._styleColorTheme.lut&&S!==""||d._styleColorTheme.lut&&S!==d._styleColorTheme.lut.data)&&d.setColorTheme(y)}})),this._changes.setDirty()}addLayer(o,d,y={}){this._checkLoaded();const S=o.id;if(this._layers[S])return void this.fire(new r.y(new Error(`Layer with id "${S}" already exists on this map`)));let C;if(o.type==="custom"){if(nu(this,r.ds(o)))return;C=r.dt(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(S,o.source),o=r.dn(o),o=Object.assign(o,{source:S})),this._validate(ho,`layers.${S}`,o,{arrayIndex:-1},y))return;C=r.dt(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:S}})}const I=r.B(C.source,C.scope);C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(I),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(I);let j=this._order.length;if(d){const ee=this._order.indexOf(d);if(ee===-1)return void this.fire(new r.y(new Error(`Layer with id "${d}" does not exist on this map.`)));C.slot===this._layers[d].slot?j=ee:r.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,S),this._layerOrderChanged=!0,this._layers[S]=C;const z=this.getOwnLayerSourceCache(C),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&C.canCastShadows()&&$&&(z.castsShadows=!0);const q=this._changes.getRemovedLayer(C);if(q&&C.source&&z&&C.type!=="custom"){this._changes.discardLayerRemoval(C);const ee=r.B(C.source,C.scope);q.type!==C.type?this._changes.updateSourceCache(ee,"clear"):(this._changes.updateSourceCache(ee,"reload"),z.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(o,d){this._checkLoaded();const y=this._checkLayer(o);if(!y||o===d)return;const S=this._order.indexOf(o);this._order.splice(S,1);let C=this._order.length;if(d){const I=this._order.indexOf(d);if(I===-1)return void this.fire(new r.y(new Error(`Layer with id "${d}" does not exist on this map.`)));y.slot===this._layers[d].slot?C=I:r.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const d=this._checkLayer(o);if(!d)return;d.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._indoorDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const S=this.getOwnLayerSourceCache(d);if(S&&S.castsShadows){let C=!1;for(const I in this._layers)if(this._layers[I].source===d.source&&this._layers[I].canCastShadows()){C=!0;break}S.castsShadows=C}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,y){this._checkLoaded();const S=this._checkLayer(o);S&&(S.minzoom===d&&S.maxzoom===y||(d!=null&&(S.minzoom=d),y!=null&&(S.maxzoom=y),this._updateLayer(S)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,d){this._checkLoaded();const y=this._checkLayer(o);y&&y.slot!==d&&(y.slot=d,this._updateLayer(y))}setFilter(o,d,y={}){this._checkLoaded();const S=this._checkLayer(o);if(S&&!r.bx(S.filter,d))return d==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(Qr,`layers.${S.id}.filter`,d,{layerType:S.type},y)||(S.filter=r.dn(d),this._updateLayer(S)))}getFilter(o){const d=this._checkLayer(o);if(d)return r.dn(d.filter)}setLayoutProperty(o,d,y,S={}){this._checkLoaded();const C=this._checkLayer(o);if(C&&!r.bx(C.getLayoutProperty(d),y)){if(y!=null&&(!S||S.validate!==!1)&&nu(C,ea.call(ln,{key:`layers.${o}.layout.${d}`,layerType:C.type,objectKey:d,value:y,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(d,y),C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(C.fqid),this._updateLayer(C)}}setLayerProperty(o,d,y,S={}){this._checkLoaded();const C=this._checkLayer(o);C&&(d==="appearances"?(C.setAppearances(y),this._changes.setDirty()):C.isPaintProperty(d)?this.setPaintProperty(o,d,y,S):this.setLayoutProperty(o,d,y,S))}getLayoutProperty(o,d){const y=this._checkLayer(o);if(y)return y.getLayoutProperty(d)}setPaintProperty(o,d,y,S={}){this._checkLoaded();const C=this._checkLayer(o);if(!C||r.bx(C.getPaintProperty(d),y)||y!=null&&(!S||S.validate!==!1)&&nu(C,Rs.call(ln,{key:`layers.${o}.paint.${d}`,layerType:C.type,objectKey:d,value:y,styleSpec:r.a6})))return;const I=C.setPaintProperty(d,y);C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(C.fqid),I&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(o,d){const y=this._checkLayer(o);if(y)return y.getPaintProperty(d)}setFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:z,importId:$}=o.target,q=this.getFragmentStyle($),ee=q.getFeaturesetLayers(z);for(const{source:Q,sourceLayer:ie}of ee)q.setFeatureState({id:o.id,source:Q,sourceLayer:ie},d)}else if("layerId"in o.target){const{layerId:z}=o.target,$=this.getLayer(z);this.setFeatureState({id:o.id,source:$.source,sourceLayer:$.sourceLayer},d)}return}const y=o.source,S=o.sourceLayer,C=this._checkSource(y);if(!C)return;const I=C.type;if(I==="geojson"&&S)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!S)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const j=this.getOwnSourceCaches(y);for(const z of j)z.setFeatureState(S,o.id,d)}removeFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:z,importId:$}=o.target,q=this.getFragmentStyle($),ee=q.getFeaturesetLayers(z);for(const{source:Q,sourceLayer:ie}of ee)q.removeFeatureState({id:o.id,source:Q,sourceLayer:ie},d)}else if("layerId"in o.target){const{layerId:z}=o.target,$=this.getLayer(z);this.removeFeatureState({id:o.id,source:$.source,sourceLayer:$.sourceLayer},d)}return}const y=o.source,S=this._checkSource(y);if(!S)return;const C=S.type,I=C==="vector"?o.sourceLayer:void 0;if(C==="vector"&&!I)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const j=this.getOwnSourceCaches(y);for(const z of j)z.removeFeatureState(I,o.id,d)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let C;if("featuresetId"in o.target){const{featuresetId:I,importId:j}=o.target,z=this.getFragmentStyle(j),$=z.getFeaturesetLayers(I);for(const{source:q,sourceLayer:ee}of $){const Q=z.getFeatureState({id:o.id,source:q,sourceLayer:ee});if(Q&&!C)C=Q;else if(!r.bx(C,Q))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:I}=o.target,j=this.getLayer(I);C=this.getFeatureState({id:o.id,source:j.source,sourceLayer:j.sourceLayer})}return C}const d=o.source,y=o.sourceLayer,S=this._checkSource(d);if(S){if(S.type!=="vector"||y)return o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(y,o.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),d=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(y=>y!==void 0))}_updateFilteredLayers(o){for(const d of Object.values(this._mergedLayers))o(d)&&this._updateLayer(d)}_updateLayer(o){this._changes.updateLayer(o);const d=this.getLayerSourceCache(o),y=r.B(o.source,o.scope),S=this._changes.getUpdatedSourceCaches();o.source&&!S[y]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),d.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=j=>this._mergedLayers[j].is3D(!!this.terrain),y=this.order,S={},C=[];for(let j=y.length-1;j>=0;j--){const z=y[j];if(d(z)){S[z]=j;for(const $ of o){const q=$[z];if(q)for(const ee of q)C.push(ee)}}}C.sort(((j,z)=>z.intersectionZ-j.intersectionZ));const I=[];for(let j=y.length-1;j>=0;j--){const z=y[j];if(d(z))for(let $=C.length-1;$>=0;$--){const q=C[$].feature;if(q.layer&&S[q.layer.id]<j)break;I.push(q),C.pop()}else for(const $ of o){const q=$[z];if(q)for(const ee of q)I.push(ee.feature)}}return I}queryRasterValue(o,d,y){const S=this.getOwnSource(o);return S?S.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):S.queryRasterArrayValue(d,y):(this.fire(new r.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,d,y){let S;d&&!Array.isArray(d)&&d.filter&&(this._validate(Qr,"queryRenderedFeatures.filter",d.filter,null,d),S=r.b5(d.filter));const C={},I=q=>{if(ju.has(q.type))return;const ee=this.getOwnLayerSourceCache(q),Q=C[ee.id]=C[ee.id]||{sourceCache:ee,layers:{},has3DLayers:!1};q.is3D(!!this.terrain)&&(Q.has3DLayers=!0),Q.layers[q.fqid]=Q.layers[q.fqid]||{styleLayer:q,targets:[]},Q.layers[q.fqid].targets.push({filter:S})};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const q of d.layers){const ee=this._layers[q];if(!ee)return this.fire(new r.y(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];I(ee)}}else for(const q in this._layers)I(this._layers[q]);const j=this._queryRenderedFeatures(o,C,y),z=this._flattenAndSortRenderedFeatures(j),$=[];for(const q of z)r.dv(q.layer.id)===this.scope&&$.push(q);return $}queryRenderedFeatureset(o,d,y){let S;d&&!Array.isArray(d)&&d.filter&&(this._validate(Qr,"queryRenderedFeatures.filter",d.filter,null,d),S=r.b5(d.filter));const C="mock",I=[];if(d&&d.target)I.push(Object.assign({},d,{targetId:C,filter:S}));else{const q=this.getFeaturesetDescriptors();for(const ee of q)I.push({targetId:C,filter:S,target:ee});for(const{style:ee}of this.fragments){const Q=ee.getFeaturesetDescriptors();for(const ie of Q)I.push({targetId:C,filter:S,target:ie})}}const j=this.queryRenderedTargets(o,I,y),z=[],$=new Set;for(const q of j)for(const ee of q.variants[C])Is(ee,q,$)||z.push(new r.dw(q,ee));return z}queryRenderedTargets(o,d,y){const S={},C=(j,z,$,q)=>{const ee=S[z.id]=S[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};if(ee.layers[j.fqid]=ee.layers[j.fqid]||{styleLayer:j,targets:[]},j.is3D(!!this.terrain)&&(ee.has3DLayers=!0),!q)return $.uniqueFeatureID=!1,void ee.layers[j.fqid].targets.push($);ee.layers[j.fqid].targets.push(Object.assign({},$,{namespace:q.namespace,properties:q.properties,uniqueFeatureID:q.uniqueFeatureID}))};for(const j of d)if("featuresetId"in j.target){const{featuresetId:z,importId:$}=j.target,q=this.getFragmentStyle($);if(!q||!q._featuresetSelectors)continue;const ee=q._featuresetSelectors[z];if(!ee){this.fire(new r.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Q of ee){const ie=q.getOwnLayer(Q.layerId);ie&&!ju.has(ie.type)&&C(ie,q.getOwnLayerSourceCache(ie),j,Q)}}else if("layerId"in j.target){const{layerId:z}=j.target,$=this.getLayer(z);if(!$||ju.has($.type))continue;C($,this.getLayerSourceCache($),j)}const I=this._queryRenderedFeatures(o,S,y);return this._flattenAndSortRenderedFeatures(I)}_queryRenderedFeatures(o,d,y){const S=[],C=!!this.map._showQueryGeometry,I=fr.createFromScreenPoints(o,y);for(const j in d){const z=eo(I,d[j],this._availableImages,y,C);Object.keys(z).length&&S.push(z)}if(this.placement)for(const j in d){if(!d[j].sourceCache._onlySymbols)continue;const z=wo(I.screenGeometry,d[j],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(z).length&&S.push(z)}return S}querySourceFeatures(o,d){const y=d&&d.filter;y&&this._validate(Qr,"querySourceFeatures.filter",y,null,d);let S=[];const C=this.getOwnSourceCaches(o);for(const I of C)S=S.concat(ji(I,d));return S}addSourceType(o,d,y){return cl.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(cl.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,d,y={}){this._checkLoaded();const S=this.light.getLight();let C=!1;for(const j in o)if(!r.bx(o[j],S[j])){C=!0;break}if(!C)return;const I=this._getTransitionParameters();this.light.setLight(o,d,y),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,d=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=o;const S=o.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const j="terrain-dem-src";this.addSource(j,y.source),y=r.dn(y),y=Object.assign(y,{source:j})}const C=Object.assign({},y),I={};if(this.terrain&&S){C.source=this.terrain.get().source;const j=this.terrain?this.getFragmentStyle(this.terrain.scope):null;j&&(I.style=j.serialize())}if(this._validate(ns,"terrain",C,I))return}if(!this.terrain||this.terrain.scope!==this.scope&&!S||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d),this.fire(new r.z("data",{dataType:"style"}))}else{const C=this.terrain,I=C.get();for(const j of Object.keys(r.a6.terrain))!y.hasOwnProperty(j)&&r.a6.terrain[j].default&&(y[j]=r.a6.terrain[j].default);for(const j in o)if(!r.bx(o[j],I[j])){C.set(o,this.options),this.stylesheet.terrain=o;const z=this._getTransitionParameters({duration:0});C.updateTransitions(z),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new It(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_createSnow(o){const d=this.snow=new vr(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_createRain(o){const d=this.rain=new jr(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const o of this.map._markers)o._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!r.bx(d.get(),o)){d.set(o,this.options),this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const d=this.snow;if(!r.bx(d.get(),o)){d.set(o,this.options),this.stylesheet.snow=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const d=this.rain;if(!r.bx(d.get(),o)){d.set(o,this.options),this.stylesheet.rain=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const S in this._layers)this._layers[S].lut=this._styleColorTheme.lut;for(const S in this._sourceCaches)this._sourceCaches[S].clearTiles()},d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!d)return this._styleColorTheme.lut=null,void o();const y=this._evaluateColorThemeData(d);this._loadColorTheme(y).then((()=>{this.fire(new r.z("colorthemeset")),o()})).catch((S=>{r.w(`Couldn't set color theme: ${S}`)}))}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,d){const y=this.getFragmentStyle(o);y&&(y._styleColorTheme.colorThemeOverride=d,y._reloadColorTheme())}_getTransitionParameters(o){return{now:r.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],d=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?o.push(y):d.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const y=this.terrain=new at(o,d,this.scope,this.options,this.map.getWorldview());d===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const S=this._getTransitionParameters({duration:0});y.updateTransitions(S)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="symbol"&&this._updateLayer(d)}}_validate(o,d,y,S,C={}){if(C&&C.validate===!1)return!1;const I=Object.assign({},this.serialize());return nu(this,o.call(ln,Object.assign({key:d,style:I,value:y,styleSpec:r.a6},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const d=this.getSourceCaches(o);for(const y of d)y.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const d=this._mergedLayers[o];d._clear&&d._clear()}}reloadSource(o){const d=this.getSourceCaches(o);for(const y of d)y.resume(),y.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((o=>{o.modelManager.reloadModels(o.scope)}))}updateSources(o){let d;this.directionalLight&&(d=n_(this.directionalLight));const y=new Set;for(const S in this._mergedLayers){const C=this._mergedLayers[S];C.hasElevation()&&!y.has(C.source)&&y.add(C.source)}for(const S in this._mergedSourceCaches){const C=this._mergedSourceCaches[S],I=y.has(C._source.id);C.update(o,void 0,void 0,d,I)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,y,S,C,I,j=!1){let z=!1,$=!1;const q={},ee={};for(const Q of this._mergedOrder){const ie=this._mergedLayers[Q];if(ie.type!=="symbol")continue;const le=r.B(ie.source,ie.scope);let de=q[le];if(!de){const _e=this.getLayerSourceCache(ie);if(!_e)continue;const Se=_e.getRenderableIds(!0).map((Pe=>_e.getTileByID(Pe)));ee[le]=Se.slice(),de=q[le]=Se.sort(((Pe,Ee)=>Ee.tileID.overscaledZ-Pe.tileID.overscaledZ||(Pe.tileID.isLessThan(Ee.tileID)?-1:1)))}const be=this.crossTileSymbolIndex.addLayer(ie,de,d.center.lng,d.projection);z=z||be}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),j=j||this._layerOrderChanged||S===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(j||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),d.zoom))&&(this.pauseablePlacement=new za(d,this._mergedOrder,j,y,S,C,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,q,ee,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),$=!0),z&&this.pauseablePlacement.placement.setStale()),$||z){this._buildingIndex.onNewFrame(d.zoom);for(let Q=0;Q<this._mergedOrder.length;Q++){const ie=this._mergedLayers[this._mergedOrder[Q]];if(ie.type!=="symbol")continue;const le=this.isLayerClipped(ie);this.placement.updateLayerOpacities(ie,q[r.B(ie.source,ie.scope)],Q,le?I:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,d){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex((({id:C})=>C===o.id))!==-1)return void this.fire(new r.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!d)return y.push(o),this._loadImports([o],!0);const S=y.findIndex((({id:C})=>C===d));return S===-1&&this.fire(new r.y(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,S).concat(o).concat(y.slice(S)),this._loadImports([o],!0,d)}updateImport(o,d){this._checkLoaded();const y=this.stylesheet.imports||[],S=this.getImportIndex(o);return S===-1?this:typeof d=="string"?(this.setImportUrl(o,d),this):(d.url&&d.url!==y[S].url&&this.setImportUrl(o,d.url),r.bx(d.config,y[S].config)||this.setImportConfig(o,d.config,d.data.schema),r.bx(d.data,y[S].data)||this.setImportData(o,d.data),this)}moveImport(o,d){this._checkLoaded();let y=this.stylesheet.imports||[];const S=this.getImportIndex(o);if(S===-1)return this;const C=this.getImportIndex(d);if(C===-1)return this;const I=y[S],j=this.fragments[S];return y=y.filter((({id:z})=>z!==o)),this.fragments=this.fragments.filter((({id:z})=>z!==o)),this.stylesheet.imports=y.slice(0,C).concat(I).concat(y.slice(C)),this.fragments=this.fragments.slice(0,C).concat(j).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(o,d){this._checkLoaded();const y=this.stylesheet.imports||[],S=this.getImportIndex(o);if(S===-1)return this;y[S].url=d;const C=this.fragments[S];return C.style=this._createFragmentStyle(y[S]),C.style.on("style.import.load",(()=>this.mergeAll())),C.style.loadURL(d),this}setImportData(o,d){this._checkLoaded();const y=this.getImportIndex(o),S=this.stylesheet.imports||[];return y===-1?this:d?(this.fragments[y].style.setState(d),this._reloadImports(),this):(delete S[y].data,this.setImportUrl(o,S[y].url))}setImportConfig(o,d,y){this._checkLoaded();const S=this.getImportIndex(o),C=this.stylesheet.imports||[];if(S===-1)return this;d?C[S].config=d:delete C[S].config;const I=this.fragments[S];y&&I.style.stylesheet&&(I.style.stylesheet.schema=y);const j=I.style.stylesheet&&I.style.stylesheet.schema;return I.config=d,I.style.updateConfig(d,j),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(o);y!==-1&&(d.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(o){const d=(this.stylesheet.imports||[]).findIndex((y=>y.id===o));return d===-1&&this.fire(new r.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),d}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const d in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[d];y&&o.push(y.getSource())}return o}getSource(o,d){const y=this.getSourceCache(o,d);return y&&y.getSource()}getLayerSource(o){const d=this.getLayerSourceCache(o);return d&&d.getSource()}getSourceCache(o,d){const y=r.B(o,d);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(o){const d=r.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[o]&&d.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&d.push(this._mergedSymbolSourceCaches[o]),d}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const d in o){const y=o[d];y==="reload"?this.reloadSource(d):y==="clear"&&this.clearSource(d)}}updateLayers(o){const d=this._changes.getUpdatedPaintProperties();for(const y of d){const S=this.getLayer(y);S&&S.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,d,y){this.imageManager.getImages(d.images,d.scope,y),this._updateTilesForChangedImages();const S=I=>{if(I){const j=d.images.map((z=>r.I.toString(z)));I.setDependencies(d.tileID.key,d.type,j)}},C=r.B(d.source,d.scope);S(this._mergedOtherSourceCaches[C]),S(this._mergedSymbolSourceCaches[C]),d.images.some((I=>I.iconsetId))&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(o,d,y){this.imageManager.rasterizeImages(d,y)}getGlyphs(o,d,y){this.glyphManager.getGlyphs(d.stacks,y)}getResource(o,d,y){return r.dy(d,y)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this.getOwnSourceCaches(o);return d.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${o}'`))),!1):d.every((y=>y.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,d){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const y=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),S=o.type==="building";if(o.is3D(!!this.terrain)){if(y||S||d&&d.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((o=>{o.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}cl.getSourceType=function(g){return Zs[g]},cl.setSourceType=function(g,o){Zs[g]=o},cl.registerForPluginStateChange=r.dz;class Md extends r.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[d,y]of Object.entries(o.buildings))if(this._buildings[d])for(const S of y.floorIds)this._buildings[d].floors[S]||(this._buildings[d].floors[S]=y.floors[S]);else this._buildings[d]=y;for(const d of o.activeFloors)this._activeFloors.add(d);this._updateIndoorSelector()}getIndoorTileOptions(o,d){const y=this._style.getIndoorSourceLayers(o,d);return y&&this._indoorState?{sourceLayers:y,indoorState:this._indoorState}:null}_updateUI(o,d,y){const S=(function(C,I,j,z){let $=null,q=Number.MAX_SAFE_INTEGER;if(z<16)return null;for(const[ee,Q]of Object.entries(C)){const ie=Q.center;if(ie){const le=I.distanceTo(r.aS.convert(ie));le<q&&j.contains(ie)&&(q=le,$=ee)}}return $})(this._buildings,d,y,o);S!==this._closestBuildingId&&(this._closestBuildingId=S,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,d=this._closestBuildingId,y=d&&o?o[d]:void 0;if(!y)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let S=null;for(const I of y.floorIds)if(this._activeFloors&&this._activeFloors.has(I)){S=I;break}const C=Array.from(y.floorIds).map((I=>({id:I,name:y.floors[I].name,zIndex:y.floors[I].zIndex}))).sort(((I,j)=>j.zIndex-I.zIndex));this.fire(new r.z("selector-update",{selectedFloorId:S,activeFloorsVisible:this._activeFloorsVisible,floors:C}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var kd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Id=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Bp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,xh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Du=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,vg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,zp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ul=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Up=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,xn=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,bg=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Al=[];Ql(kd,Al),Ql(Bp,Al),Ql(Id,Al);const Pd={"_prelude_fog.vertex.glsl":vg,"_prelude_terrain.vertex.glsl":Du,"_prelude_shadow.vertex.glsl":xn,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":zp,"_prelude_shadow.fragment.glsl":bg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ul,"_prelude_raster_particle.glsl":Up},_h={};xi("",Du),xi(zp,vg),xi(bg,xn),xi(ul,""),xi(Up,"");const Vp=xi(Id,Bp),ru=kd;var Rd={background:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:xi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:xi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:xi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:xi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:xi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:xi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:xi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:xi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:xi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:xi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:xi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:xi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:xi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:xi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:xi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:xi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xh),skyboxGradient:xi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xh),skyboxCapture:xi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:xi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:xi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:xi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:xi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:xi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:xi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:xi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:xi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ql(g,o){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=y.split(" ");for(const C of S)o.includes(C)||o.push(C)}}function xi(g,o){const d=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,S={},C=[],I=[];if(g=g.replace(d,((z,$)=>(I.push($),""))),(o=o.replace(d,((z,$)=>(C.push($),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let j=[...Al];Ql(g,j),Ql(o,j);for(const z of[...C,...I])Pd[z]||console.error(`Undefined include: ${z}`),_h[z]||(_h[z]=[],Ql(Pd[z],_h[z])),j=[...j,..._h[z]];return{fragmentSource:g=g.replace(y,((z,$,q,ee,Q)=>(S[Q]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${q} ${ee} ${Q};
#else
uniform ${q} ${ee} u_${Q};
#endif
`:$==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${q} ${ee} ${Q} = u_${Q};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${q} ${ee} ${Q};
#endif
`:$==="initialize-attribute"?"":void 0))),vertexSource:o=o.replace(y,((z,$,q,ee,Q)=>{const ie=`MATERIAL_ATTRIBUTE_OFFSET_${Q}`,le=ee==="float"?"vec2":ee,de=`GET_ATTRIBUTE_${le}(a_${Q}, materialInfo, ${ie})`,be=Q.match(/color/)?"color":le;return $==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${q} ${ee} a_${Q};
#endif
`:S[Q]?$==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
    #if !defined(${ie})
        in ${q} ${le} a_${Q};
    #endif
out ${q} ${ee} ${Q};
#else
uniform ${q} ${ee} u_${Q};
#endif
`:$==="initialize"?be==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${q} ${ee} ${Q} = u_${Q};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${Q}) 
    #ifdef ${ie}
        ${Q} = unpack_mix_${be}(${de}, u_${Q}_t);
    #else
        ${Q} = unpack_mix_${be}(a_${Q}, u_${Q}_t);
    #endif
#else
    ${q} ${ee} ${Q} = u_${Q};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${q} ${ee} a_${Q};
    out ${q} ${ee} ${Q};
#endif
`:$==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:$==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
    #if !defined(${ie})
        in ${q} ${le} a_${Q};
    #endif  
#else
uniform ${q} ${ee} u_${Q};
#endif
`:$==="define-instanced"?be==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${q} ${ee} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${q} ${le} a_${Q};
#else
uniform ${q} ${ee} u_${Q};
#endif
`:$==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${q} ${ee} ${Q} = a_${Q};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    #ifdef ${ie}
        ${q} ${ee} ${Q} = ${de};
    #else
        ${q} ${ee} ${Q} = a_${Q};
    #endif
#else
    ${q} ${ee} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    #ifdef ${ie}
        ${q} ${ee} ${Q} = unpack_mix_${be}(${de}, u_${Q}_t);
    #else
        ${q} ${ee} ${Q} = unpack_mix_${be}(a_${Q}, u_${Q}_t);
    #endif
#else
    ${q} ${ee} ${Q} = u_${Q};
#endif
`})),usedDefines:j,vertexIncludes:C,fragmentIncludes:I}}class vh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,d,y,S,C,I,j,z){this.context=o;let $=this.boundPaintVertexBuffers.length!==S.length;for(let ee=0;!$&&ee<S.length;ee++)this.boundPaintVertexBuffers[ee]!==S[ee]&&($=!0);let q=this.boundDynamicVertexBuffers.length!==j.length;for(let ee=0;!q&&ee<j.length;ee++)this.boundDynamicVertexBuffers[ee]!==j[ee]&&(q=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||$||q||this.boundIndexBuffer!==C||this.boundVertexOffset!==I)this.freshBind(d,y,S,C,I,j,z);else{o.bindVertexArrayOES.set(this.vao);for(const ee of j)ee&&(ee.bind(),z&&ee.instanceCount&&ee.setVertexAttribDivisor(o.gl,d,z));C&&C.dynamicDraw&&C.bind()}}freshBind(o,d,y,S,C,I,j){const z=this.context,$=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=S,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=I,d.enableAttributes($,o),d.bind(),d.setVertexAttribPointers($,o,C);for(const q of y)q.enableAttributes($,o),q.bind(),q.setVertexAttribPointers($,o,C);for(const q of I)q&&(q.enableAttributes($,o),q.bind(),q.setVertexAttribPointers($,o,C),j&&q.instanceCount&&q.setVertexAttribDivisor($,o,j));S&&S.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function co(g,o){const d=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new r.ae(0,y/d).toLngLat().lat,new r.ae(0,(y+1)/d).toLngLat().lat]}function iy(g,o,d,y,S,C,I){const j=g.context,z=j.gl,$=d.hillshadeFBO;if(!$)return;g.prepareDrawTile();const q=g.isTileAffectedByFog(o),ee=g.getOrCreateProgram("hillshade",{overrideFog:q});j.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,$.colorAttachment.get());const Q=((be,_e,Se,Pe)=>{const Ee=Se.paint.get("hillshade-shadow-color"),We=Se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ne=Se.paint.get("hillshade-highlight-color"),Xe=Se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ze=Se.paint.get("hillshade-accent-color"),De=Se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Qe=Se.paint.get("hillshade-emissive-strength");let dt=r.an(Se.paint.get("hillshade-illumination-direction"));if(Se.paint.get("hillshade-illumination-anchor")==="viewport")dt-=be.transform.angle;else if(be.style&&be.style.enable3dLights()&&be.style.directionalLight){const Lt=be.style.directionalLight.properties.get("direction"),Tt=r.d3(Lt.x,Lt.y,Lt.z);dt=r.an(Tt[1])}const lt=!be.options.moving;return{u_matrix:Pe||be.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),lt),u_image:0,u_latrange:co(0,_e.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),dt],u_shadow:Ee.toPremultipliedRenderColor(We?null:Se.lut),u_highlight:Ne.toPremultipliedRenderColor(Xe?null:Se.lut),u_emissive_strength:Qe,u_accent:ze.toPremultipliedRenderColor(De?null:Se.lut)}})(g,d,y,g.terrain?o.projMatrix:null);g.uploadCommonUniforms(j,ee,o.toUnwrapped());const{tileBoundsBuffer:ie,tileBoundsIndexBuffer:le,tileBoundsSegments:de}=g.getTileBoundsBuffers(d);ee.draw(g,z.TRIANGLES,S,C,I,Dr.disabled,Q,y.id,ie,le,de)}function bh(g,o,d){if(!o.needsDEMTextureUpload)return;const y=g.context,S=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(d.stride);const C=d.getPixels();o.demTexture?o.demTexture.update(C,{premultiply:!1}):o.demTexture=new r.T(y,C,S.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Hp(g,o,d){const y=g.context,S=y.gl;if(!o.dem)return;const C=o.dem;if(y.activeTexture.set(S.TEXTURE1),bh(g,o,C),!o.demTexture)return;o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const I=C.dim;y.activeTexture.set(S.TEXTURE0);let j=o.hillshadeFBO;if(!j){const Q=new r.T(y,{width:I,height:I,data:null},S.RGBA8);Q.bind(S.LINEAR,S.CLAMP_TO_EDGE),j=o.hillshadeFBO=y.createFramebuffer(I,I,!0,"renderbuffer"),j.colorAttachment.set(Q.texture)}y.bindFramebuffer.set(j.framebuffer),y.viewport.set([0,0,I,I]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:$,tileBoundsSegments:q}=g.getMercatorTileBoundsBuffers(),ee=[];g.linearFloatFilteringSupported()&&ee.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:ee}).draw(g,S.TRIANGLES,Xn.disabled,Cr.disabled,si.unblended,Dr.disabled,((Q,ie)=>{const le=ie.stride,de=r.bB();return r.cd(de,0,r.al,-r.al,0,0,1),r.bq(de,de,[0,-r.al,0]),{u_matrix:de,u_image:1,u_dimension:[le,le],u_zoom:Q.overscaledZ}})(o.tileID,C),d.id,z,$,q),o.needsHillshadePrepare=!1}class Es{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wg extends Es{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class wh extends Es{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Sg extends Es{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ef extends Es{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class o_ extends Es{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Ib extends Es{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class a_ extends Es{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class l_ extends Es{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Sh extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Tg extends Es{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Eg extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Gp extends Es{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Af extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class $p extends Es{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Th extends Es{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Eh extends Es{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Wp extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Cf extends Es{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ag extends Es{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let iu=class extends Es{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class sy extends Es{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class vc extends Es{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Cl extends Es{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Nd extends Es{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class bc extends Es{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Mf extends Es{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class qp extends Es{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class c_ extends Es{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class jd extends Es{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class kf extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class wc extends Es{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ah extends Es{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class oy extends Ah{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ch extends Ah{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Dd extends Ah{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class to extends Ch{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Qs=(g,o,d)=>({u_matrix:g,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:d}),Sc=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:S,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:j,u_frustum_br:z,u_frustum_bl:$,u_globe_pos:q,u_globe_radius:ee,u_viewport:Q,u_grid_matrix:de?Float32Array.from(de):new Float32Array(9),u_skirt_height:ie,u_far_z_cutoff:le});function Go(g,o){return g!=null&&o!=null&&!(!g.hasData()||!o.hasData())&&g.demTexture!=null&&o.demTexture!=null&&g.tileID.key!==o.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(g,o,d,y,S){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==d.tileID.key&&(C.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:S,from:o,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const o=this.operations[g];return{from:o.from,to:o.to,phase:o.phase}}update(g){for(const o in this.operations){const d=this.operations[o];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[o];break}}}_nextOp(g,o){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=o,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Lu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Mh(g,o,d){if(o===0)return 0;const y=o<1&&d===514?.25/o:1;return 6*Math.pow(1.5,22-g)*Math.max(o,1)*y}function ta(g,o){const d=1<<g.z;return!o&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const su=g=>({u_matrix:g});function Xp(g,o,d,y,S){if(S>0){const C=r.o.now(),I=(C-g.timeAdded)/S,j=o?(C-o.timeAdded)/S:-1,z=d.getSource(),$=y.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),q=!o||Math.abs(o.tileID.overscaledZ-$)>Math.abs(g.tileID.overscaledZ-$),ee=q&&g.refreshedUponExpiration?1:r.aA(q?I:1-j,0,1);return o?{opacity:1,mix:1-ee,isFading:I<1}:{opacity:ee,mix:0,isFading:I<1}}return{opacity:1,mix:0,isFading:!1}}class dl extends Wl{constructor(o){const d=mo("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class If extends Wl{constructor(o){const d=mo("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,y){if(o.freezeTileCoverage)return;this.transform=o;const S=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const j=new da(I,this._source.tileSize*I.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);j.state="loaded",this._tiles[I.key]=j}return C}),{});for(const C in this._tiles)C in S||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(o){const d=this.proxyCachedFBO[o];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach((o=>o.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pf extends r.aP{constructor(o,d,y){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class Ml extends r.bU{constructor(o,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,S,C]=(function(z){const $=new r.bc,q=new r.b0,ee=131;$.reserve(17161),q.reserve(33800);const Q=r.al/128,ie=r.al+Q/2,le=ie+Q;for(let be=-Q;be<le;be+=Q)for(let _e=-Q;_e<le;_e+=Q){const Se=_e<0||_e>ie||be<0||be>ie?24575:0,Pe=r.aA(Math.round(_e),0,r.al),Ee=r.aA(Math.round(be),0,r.al);$.emplaceBack(Pe+Se,Ee)}const de=(be,_e)=>{const Se=_e*ee+be;q.emplaceBack(Se+1,Se,Se+ee),q.emplaceBack(Se+ee,Se+ee+1,Se+1)};for(let be=1;be<129;be++)for(let _e=1;_e<129;_e++)de(_e,be);return[0,129].forEach((be=>{for(let _e=0;_e<130;_e++)de(_e,be),de(be,_e)})),[$,q,32768]})(),I=o.context;this.gridBuffer=I.createVertexBuffer(y,r.be.members),this.gridIndexBuffer=I.createIndexBuffer(S),this.gridSegments=r.bf.simpleSegment(0,0,y.length,S.length),this.gridNoSkirtSegments=r.bf.simpleSegment(0,0,y.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new If(d.map),this.orthoMatrix=r.bB(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const j=I.gl;this._overlapStencilMode=new Cr({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new dl(d.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(o,d,y){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const S=o.terrain.properties,C=o.terrain.drapeRenderMode===0,I=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const j=o.terrain&&o.terrain.scope,z=S.get("source"),$=C?this._mockSourceCache:o.getSourceCache(z,j);if(!$)return void r.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=$,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=I?this.calculateExaggeration(d):S.get("exaggeration"),!d.projection.requiresDraping&&I&&this._exaggeration===0)return void this._disable();this.enabled=!0;const q=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ee=this.getScaledDemTileSize();this.sourceCache.update(d,ee,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,q(),this._initializing=!0),q(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const d=this._previousCameraAltitude,y=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=y;const S=d!=null?y-d:Number.MAX_VALUE;if(Math.abs(S)<2)return this._exaggeration;const C=o.zoom,I=this._style.terrain;if(!this._previousUpdateTimestamp)return I.getExaggeration(C);let j=C-this._previousZoom;const z=this._previousUpdateTimestamp;let $=C;this._evaluationZoom!=null&&($=this._evaluationZoom,Math.abs(C-$)>.5&&(j=.5*(C-$+j)),j*S<0&&($+=j)),this._evaluationZoom=$;const q=I.getExaggeration($),ee=q===I.getExaggeration(Math.max(0,$-.1));if(ee&&Math.abs(q-this._exaggeration)<.01)return q;let Q=Math.min(.1,.00375*(this._updateTimestamp-z));return(ee||q<.1||Math.abs(j)<1e-4)&&(Q=Math.min(.2,4*Q)),r.ak(this._exaggeration,q,Q)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((o=>o.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=d.getIds().map((z=>{const $=d.getTileByID(z).tileID;return $.projMatrix=y.calculateProjMatrix($.toUnwrapped()),$}));(function(z,$){const q=$.transform.pointCoordinate($.transform.getCameraPoint()),ee=new r.P(q.x,q.y);z.sort(((Q,ie)=>{if(ie.overscaledZ-Q.overscaledZ)return ie.overscaledZ-Q.overscaledZ;const le=new r.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),de=new r.P(ie.canonical.x+(1<<ie.canonical.z)*ie.wrap,ie.canonical.y),be=ee.mult(1<<Q.canonical.z);return be.x-=.5,be.y-=.5,be.distSqr(le)-be.distSqr(de)}))})(S,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},S.forEach((z=>{this.proxyToSource[z.key]={}})),this.terrainTileForTile={};const I=this._style._mergedSourceCaches;for(const z in I){const $=I[z];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,o[z],C),$.usedForTerrain))continue;const q=o[z];$.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[d.id]=S.map((z=>new Pf(z,z.key,this.orthoMatrix))),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const j={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const $=this.terrainTileForTile[z.key];if(!$)continue;const q=$.tileID.key;q in j||(this._visibleDemTiles.push($),j[q]=q)}}_assignTerrainTiles(o){this._initializing||o.forEach((d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)}))}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const y in this.terrainTileForTile){const S=this.terrainTileForTile[y],C=S.dem;!C||S.demTexture&&!S.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),bh(this.painter,S,C))}}_prepareDemTileUniforms(o,d,y,S){if(!d||d.demTexture==null)return!1;const C=o.tileID.canonical,I=Math.pow(2,d.tileID.canonical.z-C.z),j=S||"";return y[`u_dem_tl${j}`]=[C.x*I%1,C.y*I%1],y[`u_dem_scale${j}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const d=this._visibleDemTiles.reduce(((y,S)=>{if(!S.dem)return y;const C=S.dem.tree.minimums[0];return C>0&&o++,y+C}),0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),S=new r.dK({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(S,{premultiply:!1}):C=this._emptyDEMTexture=new r.T(o,S,d.R32F,{premultiply:!1}),C}setupElevationDraw(o,d,y){const S=this.painter.context,C=S.gl,I={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};I.u_exaggeration=this.exaggeration();let j=null,z=null,$=1;if(y&&y.morphing&&this._useVertexMorphing){const ie=y.morphing.srcDemTile,le=y.morphing.dstDemTile;$=y.morphing.phase,ie&&le&&(this._prepareDemTileUniforms(o,ie,I,"_prev")&&(z=ie),this._prepareDemTileUniforms(o,le,I)&&(j=le))}const q=ie=>ie&&ie.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let ee=null;var Q;if(this.enabled?z&&j?(ee=j.demTexture,S.activeTexture.set(C.TEXTURE4),z.demTexture.bind(q(z),C.CLAMP_TO_EDGE),I.u_dem_lerp=$):(j=this.terrainTileForTile[o.tileID.key],ee=this._prepareDemTileUniforms(o,j,I)?j.demTexture:this.emptyDEMTexture):ee=this.emptyDEMTexture,S.activeTexture.set(C.TEXTURE2),ee&&(I.u_dem_size=(Q=ee).size[0]===1?1:Q.size[0]-2,ee.bind(q(j),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,d,I),y&&y.useMeterToDem&&j){const ie=(1<<j.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=ie}if(y&&y.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(S,I),this.painter.transform.projection.name==="globe"){const ie=this.globeUniformValues(this.painter.transform,o.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(S,ie)}}globeUniformValues(o,d,y){const S=o.projection;return{u_tile_tl_up:S.upVector(d,0,0),u_tile_tr_up:S.upVector(d,r.al,0),u_tile_br_up:S.upVector(d,r.al,r.al),u_tile_bl_up:S.upVector(d,0,r.al),u_tile_up_scale:y?r.dL(1):S.upVectorScale(d,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const d=this.painter,y=this.painter.context;o.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(S,C,I,j,z){if(S.transform.projection.name==="globe")(function($,q,ee,Q,ie){const le=$.context,de=le.gl;let be,_e;const Se=$.transform,Pe=r.dD($,le,Se),Ee=(Lt,Tt)=>{if(_e===Tt)return;const Gt=[Lu[Tt],"PROJECTION_GLOBE_VIEW"];Pe&&Gt.push("CUSTOM_ANTIALIASING");const hn=$.isTileAffectedByFog(Lt);be=$.getOrCreateProgram("globeRaster",{defines:Gt,overrideFog:hn}),_e=Tt},We=$.colorModeForRenderPass(),Ne=new Xn(de.LEQUAL,Xn.ReadWrite,$.depthRangeFor3D);zo.update(ie);const Xe=r.dE(Se),ze=[r.aF(Se.center.lng),r.aJ(Se.center.lat)],De=$.globeSharedBuffers,Qe=[Se.width*r.o.devicePixelRatio,Se.height*r.o.devicePixelRatio],dt=Float32Array.from(Se.globeMatrix),lt={useDenormalizedUpVectorScale:!0};{const Lt=$.transform,Tt=Mh(Lt.zoom,q.exaggeration(),q.sourceCache._source.tileSize);_e=-1;const Gt=de.TRIANGLES;for(const hn of Q){const mt=ee.getTile(hn),rt=Cr.disabled,zt=q.prevTerrainTileForTile[hn.key],Mt=q.terrainTileForTile[hn.key];Go(zt,Mt)&&zo.newMorphing(hn.key,zt,Mt,ie,250),le.activeTexture.set(de.TEXTURE0),mt.texture&&mt.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Jt=zo.getMorphValuesForProxy(hn.key),_n=Jt?1:0;Jt&&Object.assign(lt,{morphing:{srcDemTile:Jt.from,dstDemTile:Jt.to,phase:r.dC(Jt.phase)}});const Vn=r.dF(hn.canonical),fn=r.dG(Vn.getCenter().lat),yn=r.dH(hn.canonical,Vn,fn,Lt.worldSize/Lt._pixelsPerMercatorPixel),$n=r.bj(r.dI(hn.canonical)),On=Sc(Lt.expandedFarZProjMatrix,dt,Xe,$n,r.aj(Lt.zoom),ze,Lt.frustumCorners.TL,Lt.frustumCorners.TR,Lt.frustumCorners.BR,Lt.frustumCorners.BL,Lt.globeCenterInViewSpace,Lt.globeRadius,Qe,Tt,Lt._farZ,yn);if(Ee(hn,_n),be&&(q.setupElevationDraw(mt,be,lt),$.uploadCommonUniforms(le,be,hn.toUnwrapped()),De)){const[Cn,Bn,_r]=De.getGridBuffers(fn,Tt!==0);be.draw($,Gt,Ne,rt,We,Dr.backCCW,On,"globe_raster",Cn,Bn,_r)}}}if(De&&($.renderDefaultNorthPole||$.renderDefaultSouthPole)){const Lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Pe&&Lt.push("CUSTOM_ANTIALIASING"),be=$.getOrCreateProgram("globeRaster",{defines:Lt});for(const Tt of Q){const{x:Gt,y:hn,z:mt}=Tt.canonical,rt=hn===0,zt=hn===(1<<mt)-1,[Mt,Jt,_n,Vn]=De.getPoleBuffers(mt,!1);if(Vn&&(rt||zt)){const fn=ee.getTile(Tt);le.activeTexture.set(de.TEXTURE0),fn.texture&&fn.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);let yn=r.dJ(mt,Gt,Se);const $n=r.bj(r.dI(Tt.canonical)),On=(Cn,Bn)=>Cn.draw($,de.TRIANGLES,Ne,Cr.disabled,We,Dr.disabled,Sc(Se.expandedFarZProjMatrix,yn,yn,$n,0,ze,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Qe,0,Se._farZ),"globe_pole_raster",Bn,_n,Vn);q.setupElevationDraw(fn,be,lt),$.uploadCommonUniforms(le,be,Tt.toUnwrapped()),rt&&$.renderDefaultNorthPole&&On(be,Mt),zt&&$.renderDefaultSouthPole&&(yn=r.cR(r.bB(),yn,[1,-1,1]),On(be,Jt))}}}})(S,C,I,j,z);else{const $=S.context,q=$.gl;let ee,Q;const ie=S.shadowRenderer,le=_c(S,S.longestCutoffRange),de=We=>{if(Q===We)return;const Ne=[];Ne.push(Lu[We]),le.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF"),ie&&(Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ie.useNormalOffset&&Ne.push("NORMAL_OFFSET")),ee=S.getOrCreateProgram("terrainRaster",{defines:Ne}),Q=We},be=S.colorModeForRenderPass(),_e=new Xn(q.LEQUAL,Xn.ReadWrite,S.depthRangeFor3D);zo.update(z);const Se=S.transform,Pe=Mh(Se.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let Ee=[0,0,0];if(ie){const We=S.style.directionalLight,Ne=S.style.ambientLight;We&&Ne&&(Ee=Zl(S.style,We,Ne))}{Q=-1;const We=q.TRIANGLES,[Ne,Xe]=[C.gridIndexBuffer,C.gridSegments];for(const ze of j){const De=I.getTile(ze),Qe=Cr.disabled,dt=C.prevTerrainTileForTile[ze.key],lt=C.terrainTileForTile[ze.key];Go(dt,lt)&&zo.newMorphing(ze.key,dt,lt,z,250),$.activeTexture.set(q.TEXTURE0),De.texture&&De.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const Lt=zo.getMorphValuesForProxy(ze.key),Tt=Lt?1:0;let Gt;Lt&&(Gt={morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:r.dC(Lt.phase)}});const hn=Qs(ze.projMatrix,ta(ze.canonical,Se.renderWorldCopies)?Pe/10:Pe,Ee);if(de(Tt),!ee)continue;C.setupElevationDraw(De,ee,Gt);const mt=ze.toUnwrapped();ie&&ie.setupShadows(mt,ee),S.uploadCommonUniforms($,ee,mt,null,le),ee.draw(S,We,_e,Qe,be,Dr.backCCW,hn,"terrain_raster",C.gridBuffer,Ne,Xe)}}}})(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,S=this.proxySourceCache,C=this.proxiedCoords[S.id],I=this._drapedRenderBatches.shift(),j=d.style.order,z=[];let $=0;for(const q of C){const ee=S.getTileByID(q.proxyTileKey),Q=S.proxyCachedFBO[q.key]?S.proxyCachedFBO[q.key][o]:void 0,ie=Q!==void 0?S.renderCache[Q]:this.pool[$++],le=Q!==void 0;if(ee.texture=ie.tex,le&&!ie.dirty){z.push(ee.tileID);continue}let de;y.bindFramebuffer.set(ie.fb.framebuffer),this.renderedToTile=!1,ie.dirty&&(y.clear({color:r.ao.transparent,stencil:0}),ie.dirty=!1);for(let be=I.start;be<=I.end;++be){const _e=d.style._mergedLayers[j[be]];if(_e.isHidden(d.transform.zoom))continue;const Se=d.style.getLayerSourceCache(_e),Pe=Se?this.proxyToSource[q.key][Se.id]:[q];if(!Pe)continue;const Ee=Pe;y.viewport.set([0,0,ie.fb.width,ie.fb.height]),de!==(Se?Se.id:null)&&(this._setupStencil(ie,Pe,_e,Se),de=Se?Se.id:null),d.renderLayer(d,Se,_e,Ee)}if(this._drapedRenderBatches.length===0)for(const be of this._pendingGroundEffectLayers){const _e=d.style._mergedLayers[j[be]];if(_e.isHidden(d.transform.zoom))continue;const Se=d.style.getLayerSourceCache(_e),Pe=Se?this.proxyToSource[q.key][Se.id]:[q];if(!Pe)continue;const Ee=Pe;y.viewport.set([0,0,ie.fb.width,ie.fb.height]),de!==(Se?Se.id:null)&&(this._setupStencil(ie,Pe,_e,Se),de=Se?Se.id:null),d.renderLayer(d,Se,_e,Ee)}this.renderedToTile?(ie.dirty=!0,z.push(ee.tileID)):le||--$,$===5&&($=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),I.end+1}postRender(){}isLayerOrderingCorrect(o){const d=o.order.length;let y=-1,S=d;for(let C=0;C<d;++C)this._style.isLayerDraped(o._mergedLayers[o.order[C]])?y=Math.max(y,C):S=Math.min(S,C);return S>y}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter((d=>d.dem)).forEach((d=>{o=Math.min(o,d.dem.tree.minimums[0])})),o===0?o:(o-30)*this._exaggeration}raycast(o,d,y){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter((C=>C.dem)).map((C=>{const I=C.tileID,j=1<<I.overscaledZ,{x:z,y:$}=I.canonical,q=z/j,ee=(z+1)/j,Q=$/j,ie=($+1)/j;return{minx:q,miny:Q,maxx:ee,maxy:ie,t:C.dem.tree.raycastRoot(q,Q,ee,ie,o,d,y),tile:C}}));S.sort(((C,I)=>(C.t!==null?C.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE)));for(const C of S){if(C.t==null)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,o,d,y);if(I!=null)return I}return null}_createFBO(){const o=this.painter.context,d=o.gl,y=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const S=new r.T(o,{width:y[0],height:y[1],data:null},d.RGBA8);S.bind(d.LINEAR,d.CLAMP_TO_EDGE);const C=o.createFramebuffer(y[0],y[1],!0,null);return C.colorAttachment.set(S.texture),C.depthAttachment=new to(o,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:C,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some((o=>{const d=this._style._mergedLayers[o],y=d.isHidden(this.painter.transform.zoom);return d.type==="hillshade"||d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()}))}_clearLineLayersFromRenderCache(){let o=!1;for(const y of this._style.getSources())if(y instanceof Qi){o=!0;break}if(!o)return;const d={};for(let y=0;y<this._style.order.length;++y){const S=this._style._mergedLayers[this._style.order[y]],C=this._style.getLayerSourceCache(S);if(C&&!d[C.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof r.ad){d[C.id]=!0;for(const I of this.proxyCoords){const j=this.proxyToSource[I.key][C.id];if(j)for(const z of j)this._clearRenderCacheForTile(C.id,z)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Ni){o=!0;break}if(!o)return;const d={};for(let y=0;y<this._style.order.length;++y){const S=this._style._mergedLayers[this._style.order[y]],C=this._style.getLayerSourceCache(S);if(!C||d[C.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const I=S.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const z=this.proxyToSource[j.key][C.id];if(z)for(const $ of z){const q=Xp(C.getTile($),C.findLoadedParent($,0),C,this.painter.transform,I);(q.opacity!==1||q.mix!==0)&&this._clearRenderCacheForTile(C.id,$)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,d=o.length;if(d===0)return;const y=[];this._pendingGroundEffectLayers=[];let S,C=0,I=this._style._mergedLayers[o[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<d;)I=this._style._mergedLayers[o[C]];for(;C<d;++C){const j=this._style._mergedLayers[o[C]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?S===void 0&&(S=C):(j.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),S!==void 0&&(y.push({start:S,end:C-1}),S=void 0)))}if(S!==void 0&&y.push({start:S,end:C-1}),y.length!==0){const j=y[y.length-1];this._pendingGroundEffectLayers.every((z=>z>j.end))||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const I=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let j=0;j<I.length;++j){const z=Object.values(I[j]);d.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,S=this._tilesDirty;for(let I=y.length-1;I>=0;I--){const j=y[I];if(d.getTileByID(j.key),d.proxyCachedFBO[j.key]!==void 0){const z=o[j.key],$=this.proxyToSource[j.key];let q=0;for(const ee in $){const Q=$[ee],ie=z[ee];if(!ie||ie.length!==Q.length||Q.some(((le,de)=>le!==ie[de]||S[ee]&&S[ee].hasOwnProperty(le.key)))){q=-1;break}++q}for(const ee in d.proxyCachedFBO[j.key])d.renderCache[d.proxyCachedFBO[j.key][ee]].dirty=q<0||q!==Object.values(z).length}}const C=[...this._drapedRenderBatches];C.sort(((I,j)=>j.end-j.start-(I.end-I.start)));for(const I of C)for(const j of y){if(d.proxyCachedFBO[j.key])continue;let z=d.renderCachePool.pop();z===void 0&&d.renderCache.length<50&&(z=d.renderCache.length,d.renderCache.push(this._createFBO())),z!==void 0&&(d.proxyCachedFBO[j.key]={},d.proxyCachedFBO[j.key][I.start]=z,d.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,y,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let j;if(y.isTileClipped())j=d.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Cr.disabled}_renderTileClippingMasks(o,d){const y=this.painter,S=this.painter.context,C=S.gl;y._tileClippingMaskIDs={},S.setColorMode(si.disabled),S.setDepthMode(Xn.disabled);const I=y.getOrCreateProgram("clippingMask");for(const j of o){const z=y._tileClippingMaskIDs[j.key]=--d;I.draw(y,C.TRIANGLES,Xn.disabled,new Cr({func:C.ALWAYS,mask:0},z,255,C.KEEP,C.KEEP,C.REPLACE),si.disabled,Dr.disabled,su(j.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const y=[o.x,o.y,1,1];r.aC(y,y,d.pixelMatrixInverse),r.cJ(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const S=d._camera.position,C=r.ce(1,d.center.lat),I=[S[0],S[1],S[2]/C,0],j=r.d9([],y.slice(0,3),I);r.aw(j,j);const z=this.raycast(I,j,this._exaggeration);return z!==null&&z?(r.bG(I,I,j,z),I[3]=I[2],I[2]*=C,I):null}_setupProxiedCoordsForOrtho(o,d,y){if(o.getSource()instanceof r.aT)return this._setupProxiedCoordsForImageSource(o,d,y);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const S=this.proxiedCoords[o.id]=[],C=this.proxyCoords;for(let z=0;z<C.length;z++){const $=C[z],q=this._findTileCoveringTileID($,o);if(q){const ee=this._createProxiedId($,q,y[$.key]&&y[$.key][o.id]);S.push(ee),this.proxyToSource[$.key][o.id]=[ee]}}let I=!1;const j=new Set;for(let z=0;z<d.length;z++){const $=o.getTile(d[z]);if(!$||!$.hasData())continue;const q=this._findTileCoveringTileID($.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==$.tileID.canonical.z){const ee=this.proxyToSource[q.tileID.key][o.id],Q=this._createProxiedId(q.tileID,$,y[q.tileID.key]&&y[q.tileID.key][o.id]);ee?ee.splice(ee.length-1,0,Q):this.proxyToSource[q.tileID.key][o.id]=[Q];const ie=this.proxyToSource[q.tileID.key][o.id];j.has(ie)||j.add(ie),S.push(Q),I=!0}}if(this._sourceTilesOverlap[o.id]=I,I&&this._debugParams.sortTilesHiZFirst)for(const z of j)z.sort((($,q)=>q.overscaledZ-$.overscaledZ))}_setupProxiedCoordsForImageSource(o,d,y){if(!o.getSource().loaded())return;const S=this.proxiedCoords[o.id]=[],C=this.proxyCoords,I=o.getSource(),j=I.tileID;if(!j)return;const z=new r.P(j.x,j.y)._div(1<<j.z),$=I.coordinates.map(r.ae.fromLngLat).reduce(((ee,Q)=>(ee.min.x=Math.min(ee.min.x,Q.x-z.x),ee.min.y=Math.min(ee.min.y,Q.y-z.y),ee.max.x=Math.max(ee.max.x,Q.x-z.x),ee.max.y=Math.max(ee.max.y,Q.y-z.y),ee)),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(ee,Q)=>{const ie=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),le=ee.canonical.y/(1<<ee.canonical.z),de=r.al/(1<<ee.canonical.z),be=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),_e=Q.canonical.y/(1<<Q.canonical.z);return ie+de<be+$.min.x||ie>be+$.max.x||le+de<_e+$.min.y||le>_e+$.max.y};for(let ee=0;ee<C.length;ee++){const Q=C[ee];for(let ie=0;ie<d.length;ie++){const le=o.getTile(d[ie]);if(!le||!le.hasData()||q(Q,le.tileID))continue;const de=this._createProxiedId(Q,le,y[Q.key]&&y[Q.key][o.id]),be=this.proxyToSource[Q.key][o.id];be?be.push(de):this.proxyToSource[Q.key][o.id]=[de],S.push(de)}}}_createProxiedId(o,d,y){let S=this.orthoMatrix;if(y){const C=y.find((I=>I.key===d.tileID.key));if(C)return C}if(d.tileID.key!==o.key){const C=o.canonical.z-d.tileID.canonical.z;let I,j,z;S=r.bB();const $=d.tileID.wrap-o.wrap<<o.overscaledZ;C>0?(I=r.al>>C,j=I*((d.tileID.canonical.x<<C)-o.canonical.x+$),z=I*((d.tileID.canonical.y<<C)-o.canonical.y)):(I=r.al<<-C,j=r.al*(d.tileID.canonical.x-(o.canonical.x+$<<-C)),z=r.al*(d.tileID.canonical.y-(o.canonical.y<<-C))),r.cd(S,0,I,0,I,0,1),r.bq(S,S,[j,z,0])}return new Pf(d.tileID,o.key,S)}_findTileCoveringTileID(o,d){let y=d.getTile(o);if(y&&y.hasData())return y;const S=this._findCoveringTileCache[d.id],C=S[o.key];if(y=C?d.getTileByID(C):null,y&&y.hasData()||C===null)return y;let I=y?y.tileID:o,j=I.overscaledZ;const z=d.getSource().minzoom,$=[];if(!C){const ee=d.getSource().maxzoom;if(o.canonical.z>=ee){const Q=o.canonical.z-ee;d.getSource().reparseOverscaled?(j=Math.max(o.canonical.z+2,d.transform.tileZoom),I=new r.aP(j,o.wrap,ee,o.canonical.x>>Q,o.canonical.y>>Q)):Q!==0&&(j=ee,I=new r.aP(j,o.wrap,ee,o.canonical.x>>Q,o.canonical.y>>Q))}I.key!==o.key&&($.push(I.key),y=d.getTile(I))}const q=ee=>{$.forEach((Q=>{S[Q]=ee})),$.length=0};for(j-=1;j>=z&&(!y||!y.hasData());j--){y&&q(y.tileID.key);const ee=I.calculateScaledKey(j);if(y=d.getTileByID(ee),y&&y.hasData())break;const Q=S[ee];if(Q===null)break;Q===void 0?$.push(ee):y=d.getTileByID(Q)}return q(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let y=this._tilesDirty[o];y||(y=this._tilesDirty[o]={}),y[d.key]=!0}}function Rf(g,o,d){const y=(function(j,z,$){const q=r.bI(z,j),ee=r.bI($,[.2126,.7152,.0722]),Q=(le,de,be)=>(1-be)*le+be*de,ie=Q(1-.3*Math.min(ee,1),1,Math.min(q+1,1));return Q(.92,1,Math.asin(r.aA(z[2],-1,1))/Math.PI+.5)*ie})(g,[0,0,1],o),S=[0,0,0];r.c4(S,d.slice(0,3),y);const C=[0,0,0];r.c4(C,o.slice(0,3),g[2]);const I=[0,0,0];return r.d7(I,S,C),r.da(I)}const Zp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Cg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Qp{static cacheKey(o,d,y,S){let C=`${d}${S?S.cacheKey:""}`;for(const I of y)o.usedDefines.includes(I)&&(C+=`/${I}`);return C}constructor(o,d,y,S,C,I){const j=o.gl;this.program=j.createProgram(),this.configuration=S,this.name=d,this.fixedDefines=[...I];let z=S?S.defines():[];z=z.concat(I.map((le=>`#define ${le}`)));const $=`#version 300 es
`;let q=$+z.concat("precision mediump float;",ru,Vp.fragmentSource).join(`
`);for(const le of y.fragmentIncludes)q+=`
${Pd[le]}`;q+=`
${y.fragmentSource}`;let ee=$+z.concat("precision highp float;",ru,Vp.vertexSource).join(`
`);for(const le of y.vertexIncludes)ee+=`
${Pd[le]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&y.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(ee+=`
uniform int u_instanceID;
`),ee+=`
${y.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(ee=ee.replaceAll("gl_InstanceID","u_instanceID"));const Q=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(Q,q),j.compileShader(Q),j.attachShader(this.program,Q);const ie=j.createShader(j.VERTEX_SHADER);j.isContextLost()?this.failedToCreate=!0:(j.shaderSource(ie,ee),j.compileShader(ie),j.attachShader(this.program,ie),this.attributes={},j.linkProgram(this.program),j.deleteShader(ie),j.deleteShader(Q),this.fixedUniforms=C(o),this.binderUniforms=S?S.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new r.cg(le)}))(o)),(I.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new r.cg(le),u_dem_prev:new r.cg(le),u_dem_tl:new r.cj(le),u_dem_scale:new r.ci(le),u_dem_tl_prev:new r.cj(le),u_dem_scale_prev:new r.ci(le),u_dem_size:new r.ci(le),u_dem_lerp:new r.ci(le),u_exaggeration:new r.ci(le),u_depth:new r.cg(le),u_depth_size_inv:new r.cj(le),u_depth_range_unpack:new r.cj(le),u_occluder_half_size:new r.ci(le),u_occlusion_depth_offset:new r.ci(le),u_meter_to_dem:new r.ci(le),u_label_plane_matrix_inv:new r.ck(le)}))(o)),I.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new r.ch(le),u_tile_tr_up:new r.ch(le),u_tile_br_up:new r.ch(le),u_tile_bl_up:new r.ch(le),u_tile_up_scale:new r.ci(le)}))(o)),I.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new r.ck(le),u_fog_range:new r.cj(le),u_fog_color:new r.d2(le),u_fog_horizon_blend:new r.ci(le),u_fog_vertical_limit:new r.cj(le),u_fog_temporal_offset:new r.ci(le),u_frustum_tl:new r.ch(le),u_frustum_tr:new r.ch(le),u_frustum_br:new r.ch(le),u_frustum_bl:new r.ch(le),u_globe_pos:new r.ch(le),u_globe_radius:new r.ci(le),u_globe_transition:new r.ci(le),u_is_globe:new r.cg(le),u_viewport:new r.cj(le)}))(o)),I.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new r.d2(le)}))(o)),I.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new r.ch(le),u_lighting_directional_dir:new r.ch(le),u_lighting_directional_color:new r.ch(le),u_ground_radiance:new r.ch(le)}))(o)),I.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new r.ck(le),u_light_matrix_1:new r.ck(le),u_fade_range:new r.cj(le),u_shadow_normal_offset:new r.ch(le),u_shadow_intensity:new r.ci(le),u_shadow_texel_size:new r.ci(le),u_shadow_map_resolution:new r.ci(le),u_shadow_direction:new r.ch(le),u_shadow_bias:new r.ch(le),u_shadowmap_0:new r.cg(le),u_shadowmap_1:new r.cg(le)}))(o)))}getAttributeLocation(o,d){let y=this.attributes[d];return y===void 0&&(y=this.attributes[d]=o.getAttribLocation(this.program,d)),y}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)y[S]&&y[S].set(this.program,S,d[S])}}setGlobeUniformValues(o,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)y[S]&&y[S].set(this.program,S,d[S])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)y[S].set(this.program,S,d[S])}}setCutoffUniformValues(o,d){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)y[S].set(this.program,S,d[S])}}setLightsUniformValues(o,d){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)y[S].set(this.program,S,d[S])}}setShadowUniformValues(o,d){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;o.program.set(this.program);for(const S in d)y[S].set(this.program,S,d[S])}_drawDebugWireframe(o,d,y,S,C,I,j,z,$,q){const ee=o.options.wireframe;if(ee.terrain===!1&&ee.layers2D===!1&&ee.layers3D===!1)return;const Q=o.context;if(!(!(!ee.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ee.layers2D||o._terrain&&o._terrain.renderingToTexture||!Zp.includes(this.name))||!(!ee.layers3D||!Cg.includes(this.name))))return;const ie=Q.gl,le=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,C,Q);if(!le)return;const de=[...this.fixedDefines];de.push("DEBUG_WIREFRAME");const be=o.getOrCreateProgram(this.name,{config:this.configuration,defines:de});Q.program.set(be.program);const _e=(Ee,We,Ne)=>{if(We[Ee]&&Ne[Ee])for(const Xe in We[Ee])Ne[Ee][Xe]&&Ne[Ee][Xe].set(Ne.program,Xe,We[Ee][Xe].current)};$&&$.setUniforms(be.program,Q,be.binderUniforms,j,{zoom:z}),_e("fixedUniforms",this,be),_e("terrainUniforms",this,be),_e("globeUniforms",this,be),_e("fogUniforms",this,be),_e("lightsUniforms",this,be),_e("shadowUniforms",this,be),le.bind(),Q.setColorMode(new si([ie.ONE,ie.ONE_MINUS_SRC_ALPHA,ie.ZERO,ie.ONE],r.ao.transparent,[!0,!0,!0,!1])),Q.setDepthMode(new Xn(d.func===ie.LESS?ie.LEQUAL:d.func,Xn.ReadOnly,d.range)),Q.setStencilMode(Cr.disabled);const Se=3*I.primitiveLength*2,Pe=3*I.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ee=q||1;for(let We=0;We<Ee;++We)be.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",We),ie.drawElements(ie.LINES,Se,ie.UNSIGNED_SHORT,Pe)}else q&&q>1?ie.drawElementsInstanced(ie.LINES,Se,ie.UNSIGNED_SHORT,Pe,q):ie.drawElements(ie.LINES,Se,ie.UNSIGNED_SHORT,Pe);C.bind(),Q.program.set(this.program),Q.setDepthMode(d),Q.setStencilMode(y),Q.setColorMode(S)}checkUniforms(o,d,y){if(this.fixedDefines.includes(d)){for(const S of Object.keys(y))if(!y[S].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${S} not set but required by ${d} being defined`)}}draw(o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be){const _e=o.context,Se=_e.gl;if(this.failedToCreate)return;_e.program.set(this.program),_e.setDepthMode(y),_e.setStencilMode(S),_e.setColorMode(C),_e.setCullFace(I);for(const We of Object.keys(this.fixedUniforms))this.fixedUniforms[We].set(this.program,We,j[We]);le&&le.setUniforms(this.program,_e,this.binderUniforms,Q,{zoom:ie});const Pe={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[d];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const Ee=be&&be>0?1:void 0;for(const We of ee.get()){const Ne=We.vaos||(We.vaos={});if((Ne[z]||(Ne[z]=new vh)).bind(_e,this,$,le?le.getPaintVertexBuffers():[],q,We.vertexOffset,de||[],Ee),this.forceManualRenderingForInstanceIDShaders){const Xe=be||1;for(let ze=0;ze<Xe;++ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),q?Se.drawElements(d,We.primitiveLength*Pe,Se.UNSIGNED_SHORT,We.primitiveOffset*Pe*2):Se.drawArrays(d,We.vertexOffset,We.vertexLength)}else be&&be>1?Se.drawElementsInstanced(d,We.primitiveLength*Pe,Se.UNSIGNED_SHORT,We.primitiveOffset*Pe*2,be):q?Se.drawElements(d,We.primitiveLength*Pe,Se.UNSIGNED_SHORT,We.primitiveOffset*Pe*2):Se.drawArrays(d,We.vertexOffset,We.vertexLength);d===Se.TRIANGLES&&q&&this._drawDebugWireframe(o,y,S,C,q,We,Q,ie,le,be)}}}function Tc(g,o,d=0){const y=Math.pow(2,o.tileID.overscaledZ),S=o.tileSize*Math.pow(2,g.transform.tileZoom)/y,C=S*(o.tileID.canonical.x+o.tileID.wrap*y),I=S*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(o,1,g.transform.tileZoom),u_pixel_coord_upper:[C>>16,I>>16],u_pixel_coord_lower:[65535&C,65535&I],u_pattern_transition:d}}const Ec={terrain:0,flat:1},Ou=r.bB(),kh=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e)=>{const Se=o.style.light,Pe=Se.properties.get("position"),Ee=[Pe.x,Pe.y,Pe.z],We=r.dN();Se.properties.get("anchor")==="viewport"&&(r.dO(We,-o.transform.angle),r.dP(Ee,Ee,We));const Ne=Se.properties.get("color").toPremultipliedRenderColor(null),Xe=o.transform,ze={u_matrix:g,u_lightpos:Ee,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ou,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ec[$],u_base_type:Ec[q],u_ao:S,u_edge_radius:C,u_width_scale:I,u_flood_light_color:le,u_vertical_scale:de,u_flood_light_intensity:be,u_ground_shadow_factor:_e};return Xe.projection.name==="globe"&&(ze.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ze.u_zoom_transition=ee,ze.u_inv_rot_matrix=ie,ze.u_merc_center=Q,ze.u_up_dir=Xe.projection.upVector(new r.cC(0,0,0),Q[0]*r.al,Q[1]*r.al),ze.u_height_lift=z),ze},Kp=(g,o,d,y,S,C)=>({u_matrix:g,u_edge_radius:o,u_width_scale:d,u_vertical_scale:y,u_height_type:Ec[S],u_base_type:Ec[C]}),kl=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e)=>{const Se=kh(g,o,d,y,S,C,I,j,$,q,ee,Q,ie,le,de,be,1,[0,0,0]),Pe={u_height_factor:-Math.pow(2,j.overscaledZ)/z.tileSize/8};return Object.assign(Se,Tc(o,z,_e),Pe)},fa=(g,o,d,y,S,C,I,j,z,$,q)=>({u_matrix:o,u_opacity:d,u_ao_pass:y?1:0,u_meter_to_tile:S,u_ao:C,u_flood_light_intensity:I,u_flood_light_color:j,u_attenuation:z,u_edge_radius:$,u_fb:0,u_fb_size:q,u_dynamic_offset:1}),Ld=(g,o,d)=>({u_matrix:g,u_emissive_strength:o,u_ground_shadow_factor:d}),ou=(g,o,d,y,S,C=0)=>Object.assign(Ld(g,o,S),Tc(d,y,C)),Fu=(g,o,d,y)=>({u_matrix:g,u_world:d,u_emissive_strength:o,u_ground_shadow_factor:y}),Ih=(g,o,d,y,S,C,I=0)=>Object.assign(ou(g,o,d,y,C,I),{u_world:S}),u_=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o}),Nf=(g,o,d,y,S)=>({u_matrix:g,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:d,u_height_scale:y,u_reset_depth:S}),Yp=(g,o,d,y,S,C,I,j,z)=>({u_matrix:g,u_normal_matrix:o,u_opacity:d,u_faux_facade_ao_intensity:y,u_camera_pos:S,u_tile_to_meter:C,u_facade_emissive_chance:I,u_flood_light_color:j,u_flood_light_intensity:z}),Ua=g=>({u_matrix:g}),hl=g=>({u_matrix:g}),Ws=(g,o,d,y,S,C,I,j)=>{const z=r.al/C.tileSize;return{u_matrix:g,u_inv_rot_matrix:o,u_camera_to_center_distance:d.getCameraToCenterDistance(j),u_extrude_scale:[d.pixelsToGLUnits[0]/z,d.pixelsToGLUnits[1]/z],u_zoom_transition:y,u_tile_id:I,u_merc_center:S}},Il=(g,o,d=1)=>({u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:d}),ay=r.bB(),ly=(g,o,d,y,S,C,I)=>{const j=g.transform,z=j.projection.name==="globe",$=z?r.dQ(j.zoom,o.canonical)*j._pixelsPerMercatorPixel:r.ay(d,1,C),q={u_matrix:o.projMatrix,u_extrude_scale:$,u_intensity:I,u_inv_rot_matrix:ay,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){q.u_inv_rot_matrix=y,q.u_merc_center=S,q.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],q.u_zoom_transition=r.aj(j.zoom);const ee=S[0]*r.al,Q=S[1]*r.al;q.u_up_dir=j.projection.upVector(new r.cC(0,0,0),ee,Q)}return q};function jf(g,[o,d,y,S],[C,I]){if(C===I)return[0,0,0,0];const j=255*(g-1)/(g*(I-C));return[o*j,d*j,y*j,S*j]}function Ac(g,o,[d,y]){return d===y?0:.5/g+(o-d)*(g-1)/(g*(y-d))}const Df=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se,Pe,Ee)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:S,u_tl_parent:C,u_scale_parent:$,u_fade_t:q.mix,u_opacity:q.opacity*ee.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ee.paint.get("raster-brightness-min"),u_brightness_high:ee.paint.get("raster-brightness-max"),u_saturation_factor:r.dS(ee.paint.get("raster-saturation")),u_contrast_factor:r.dR(ee.paint.get("raster-contrast")),u_spin_weights:Ph(ee.paint.get("raster-hue-rotate")),u_perspective_transform:Q,u_raster_elevation:ie,u_zoom_transition:I,u_merc_center:j,u_cutoff_params:z,u_colorization_mix:jf(r.dT,de,_e),u_colorization_offset:Ac(r.dT,be,_e),u_color_ramp:le,u_texture_offset:[Pe/(Se+2*Pe),Se/(Se+2*Pe)],u_texture_res:[Se+2*Pe,Se+2*Pe],u_emissive_strength:Ee});function Ph(g){g*=Math.PI/180;const o=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Od=.05,Pl=(g,o,d,y,S,C,I,j,z,$,q,ee)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:S,u_tl_parent:C,u_scale_parent:$,u_fade_t:q.mix,u_opacity:q.opacity,u_image0:0,u_image1:1,u_raster_elevation:ee,u_zoom_transition:I,u_merc_center:j,u_cutoff_params:z}),Jp=(g,o,d,y,S,C,I,j,z,$)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_tile_offset:d,u_velocity:y,u_color_ramp:C,u_velocity_res:S,u_max_speed:I,u_uv_offset:j,u_data_scale:[255*z[0],255*z[1]],u_data_offset:$,u_particle_pos_scale:1.1,u_particle_pos_offset:[Od,Od]}),Mg=(g,o,d,y,S,C,I,j,z,$)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_velocity:d,u_velocity_res:y,u_max_speed:S,u_speed_factor:C,u_reset_rate:I,u_rand_seed:Math.random(),u_uv_offset:j,u_data_scale:[255*z[0],255*z[1]],u_data_offset:$,u_particle_pos_scale:1.1,u_particle_pos_offset:[Od,Od]}),Rh=r.bB(),Lf=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se,Pe,Ee,We,Ne,Xe)=>{const ze=S.transform,De={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ze.getCameraToCenterDistance(Se),u_rotate_symbol:+d,u_aspect_ratio:ze.width/ze.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:j,u_is_text:+$,u_elevation_from_sea:z?1:0,u_pitch_with_map:+y,u_texsize:q,u_texsize_icon:ee,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Rh,u_up_vector:[0,-1,0],u_color_adj_mat:We,u_icon_transition:Ne||0,u_gamma_scale:y?S.transform.getCameraToCenterDistance(Se)*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Xe||1,u_ground_shadow_factor:Pe,u_inv_matrix:r.bk(r.bB(),I),u_normal_scale:Ee,u_lutTexture:go.LUT};return Se.name==="globe"&&(De.u_tile_id=[ie.canonical.x,ie.canonical.y,1<<ie.canonical.z],De.u_zoom_transition=le,De.u_inv_rot_matrix=be,De.u_merc_center=de,De.u_camera_forward=ze._camera.forward(),De.u_ecef_origin=r.dU(ze.globeMatrix,ie.toUnwrapped()),De.u_tile_matrix=Float32Array.from(ze.globeMatrix),De.u_up_vector=_e),De},em=(g,o,d,y)=>({u_matrix:g,u_emissive_strength:o,u_opacity:d,u_color:y}),tm=(g,o,d,y,S,C,I,j,z)=>Object.assign((function($,q,ee,Q,ie,le){const{width:de,height:be}=Q.imageManager.getPixelSize(q),_e=Math.pow(2,le.tileID.overscaledZ),Se=le.tileSize*Math.pow(2,Q.transform.tileZoom)/_e,Pe=Se*(le.tileID.canonical.x+le.tileID.wrap*_e),Ee=Se*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:ee.tl,u_pattern_br:ee.br,u_texsize:[de,be],u_pattern_size:ee.displaySize,u_pattern_units_to_pixels:ie?[Q.transform.width,-1*Q.transform.height]:[1/r.ay(le,1,Q.transform.tileZoom),1/r.ay(le,1,Q.transform.tileZoom)],u_pixel_coord_upper:[Pe>>16,Ee>>16],u_pixel_coord_lower:[65535&Pe,65535&Ee]}})(0,C,I,y,j,z),{u_matrix:g,u_emissive_strength:o,u_opacity:d}),Fd=new Float32Array(r.bz([])),nm=(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie=[0,0,0],le,de,be)=>{const _e=S.style.light,Se=_e.properties.get("position"),Pe=[-Se.x,-Se.y,Se.z],Ee=r.dN();_e.properties.get("anchor")==="viewport"&&(r.dO(Ee,-S.transform.angle),r.dP(Pe,Pe,Ee));const We=q.alphaMode==="MASK",Ne=_e.properties.get("color").toNonPremultipliedRenderColor(null),Xe=Q.paint.get("model-ambient-occlusion-intensity"),ze=Q.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return ze.a=Q.paint.get("model-color-mix-intensity").constantOr(0),be&&(ze.r=be[0],ze.g=be[1],ze.b=be[2],ze.a=be[3]),de&&(ze.r=de.color.r,ze.g=de.color.g,ze.b=de.color.b,ze.a=de.colorMix,ee=de.emissionStrength,C=de.opacity),{u_matrix:g,u_lighting_matrix:o,u_normal_matrix:d,u_node_matrix:y||Fd,u_lightpos:Pe,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_camera_pos:ie,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+We,u_alphaCutoff:q.alphaCutoff,u_baseColorFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:j.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:z,u_roughnessFactor:$,u_baseColorTexture:go.BaseColor,u_metallicRoughnessTexture:go.MetallicRoughness,u_normalTexture:go.Normal,u_occlusionTexture:go.Occlusion,u_emissionTexture:go.Emission,u_lutTexture:go.LUT,u_color_mix:ze.toArray01(),u_aoIntensity:Xe,u_emissive_strength:ee,u_occlusionTextureTransform:le||[0,0,0,0]}},Bu=(g,o=Fd,d=Fd)=>({u_matrix:g,u_instance:o,u_node_matrix:d}),kg={fillExtrusion:g=>({u_matrix:new r.ck(g),u_lightpos:new r.ch(g),u_lightintensity:new r.ci(g),u_lightcolor:new r.ch(g),u_vertical_gradient:new r.ci(g),u_opacity:new r.ci(g),u_edge_radius:new r.ci(g),u_width_scale:new r.ci(g),u_ao:new r.cj(g),u_height_type:new r.cg(g),u_base_type:new r.cg(g),u_tile_id:new r.ch(g),u_zoom_transition:new r.ci(g),u_inv_rot_matrix:new r.ck(g),u_merc_center:new r.cj(g),u_up_dir:new r.ch(g),u_height_lift:new r.ci(g),u_flood_light_color:new r.ch(g),u_vertical_scale:new r.ci(g),u_flood_light_intensity:new r.ci(g),u_ground_shadow_factor:new r.ch(g)}),fillExtrusionDepth:g=>({u_matrix:new r.ck(g),u_edge_radius:new r.ci(g),u_width_scale:new r.ci(g),u_vertical_scale:new r.ci(g),u_height_type:new r.cg(g),u_base_type:new r.cg(g)}),fillExtrusionPattern:g=>({u_matrix:new r.ck(g),u_lightpos:new r.ch(g),u_lightintensity:new r.ci(g),u_lightcolor:new r.ch(g),u_vertical_gradient:new r.ci(g),u_height_factor:new r.ci(g),u_edge_radius:new r.ci(g),u_width_scale:new r.ci(g),u_ao:new r.cj(g),u_height_type:new r.cg(g),u_base_type:new r.cg(g),u_tile_id:new r.ch(g),u_zoom_transition:new r.ci(g),u_inv_rot_matrix:new r.ck(g),u_merc_center:new r.cj(g),u_up_dir:new r.ch(g),u_height_lift:new r.ci(g),u_image:new r.cg(g),u_texsize:new r.cj(g),u_pixel_coord_upper:new r.cj(g),u_pixel_coord_lower:new r.cj(g),u_tile_units_to_pixels:new r.ci(g),u_opacity:new r.ci(g),u_pattern_transition:new r.ci(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new r.ck(g),u_opacity:new r.ci(g),u_ao_pass:new r.ci(g),u_meter_to_tile:new r.ci(g),u_ao:new r.cj(g),u_flood_light_intensity:new r.ci(g),u_flood_light_color:new r.ch(g),u_attenuation:new r.ci(g),u_edge_radius:new r.ci(g),u_fb:new r.cg(g),u_fb_size:new r.ci(g),u_dynamic_offset:new r.ci(g)}),fill:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_ground_shadow_factor:new r.ch(g)}),fillPattern:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_image:new r.cg(g),u_texsize:new r.cj(g),u_pixel_coord_upper:new r.cj(g),u_pixel_coord_lower:new r.cj(g),u_tile_units_to_pixels:new r.ci(g),u_ground_shadow_factor:new r.ch(g),u_pattern_transition:new r.ci(g)}),fillOutline:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_world:new r.cj(g),u_ground_shadow_factor:new r.ch(g)}),fillOutlinePattern:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_world:new r.cj(g),u_image:new r.cg(g),u_texsize:new r.cj(g),u_pixel_coord_upper:new r.cj(g),u_pixel_coord_lower:new r.cj(g),u_tile_units_to_pixels:new r.ci(g),u_ground_shadow_factor:new r.ch(g),u_pattern_transition:new r.ci(g)}),building:g=>({u_matrix:new r.ck(g),u_normal_matrix:new r.ck(g),u_opacity:new r.ci(g),u_faux_facade_ao_intensity:new r.ci(g),u_camera_pos:new r.ch(g),u_tile_to_meter:new r.ci(g),u_facade_emissive_chance:new r.ci(g),u_flood_light_color:new r.ch(g),u_flood_light_intensity:new r.ci(g)}),buildingBloom:g=>({u_matrix:new r.ck(g)}),buildingDepth:g=>({u_matrix:new r.ck(g)}),elevatedStructuresDepth:g=>({u_matrix:new r.ck(g),u_depth_bias:new r.ci(g)}),elevatedStructures:g=>({u_matrix:new r.ck(g),u_ground_shadow_factor:new r.ch(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new r.ck(g),u_camera_pos:new r.ch(g),u_depth_bias:new r.ci(g),u_height_scale:new r.ci(g),u_reset_depth:new r.ci(g)}),circle:r.dX,collisionBox:g=>({u_matrix:new r.ck(g),u_inv_rot_matrix:new r.ck(g),u_camera_to_center_distance:new r.ci(g),u_extrude_scale:new r.cj(g),u_zoom_transition:new r.ci(g),u_merc_center:new r.cj(g),u_tile_id:new r.ch(g)}),collisionCircle:g=>({u_matrix:new r.ck(g),u_inv_matrix:new r.ck(g),u_camera_to_center_distance:new r.ci(g),u_viewport_size:new r.cj(g)}),debug:g=>({u_color:new r.dA(g),u_matrix:new r.ck(g),u_overlay:new r.cg(g),u_overlay_scale:new r.ci(g)}),clippingMask:g=>({u_matrix:new r.ck(g)}),heatmap:g=>({u_extrude_scale:new r.ci(g),u_intensity:new r.ci(g),u_matrix:new r.ck(g),u_inv_rot_matrix:new r.ck(g),u_merc_center:new r.cj(g),u_tile_id:new r.ch(g),u_zoom_transition:new r.ci(g),u_up_dir:new r.ch(g)}),heatmapTexture:g=>({u_image:new r.cg(g),u_color_ramp:new r.cg(g),u_opacity:new r.ci(g)}),hillshade:g=>({u_matrix:new r.ck(g),u_image:new r.cg(g),u_latrange:new r.cj(g),u_light:new r.cj(g),u_shadow:new r.dA(g),u_highlight:new r.dA(g),u_emissive_strength:new r.ci(g),u_accent:new r.dA(g)}),hillshadePrepare:g=>({u_matrix:new r.ck(g),u_image:new r.cg(g),u_dimension:new r.cj(g),u_zoom:new r.ci(g)}),line:r.dW,linePattern:r.dV,raster:g=>({u_matrix:new r.ck(g),u_normalize_matrix:new r.ck(g),u_globe_matrix:new r.ck(g),u_merc_matrix:new r.ck(g),u_grid_matrix:new r.dB(g),u_tl_parent:new r.cj(g),u_scale_parent:new r.ci(g),u_fade_t:new r.ci(g),u_opacity:new r.ci(g),u_image0:new r.cg(g),u_image1:new r.cg(g),u_brightness_low:new r.ci(g),u_brightness_high:new r.ci(g),u_saturation_factor:new r.ci(g),u_contrast_factor:new r.ci(g),u_spin_weights:new r.ch(g),u_perspective_transform:new r.cj(g),u_raster_elevation:new r.ci(g),u_zoom_transition:new r.ci(g),u_merc_center:new r.cj(g),u_cutoff_params:new r.d2(g),u_colorization_mix:new r.d2(g),u_colorization_offset:new r.ci(g),u_color_ramp:new r.cg(g),u_texture_offset:new r.cj(g),u_texture_res:new r.cj(g),u_emissive_strength:new r.ci(g)}),rasterParticle:g=>({u_matrix:new r.ck(g),u_normalize_matrix:new r.ck(g),u_globe_matrix:new r.ck(g),u_merc_matrix:new r.ck(g),u_grid_matrix:new r.dB(g),u_tl_parent:new r.cj(g),u_scale_parent:new r.ci(g),u_fade_t:new r.ci(g),u_opacity:new r.ci(g),u_image0:new r.cg(g),u_image1:new r.cg(g),u_raster_elevation:new r.ci(g),u_zoom_transition:new r.ci(g),u_merc_center:new r.cj(g),u_cutoff_params:new r.d2(g)}),rasterParticleTexture:g=>({u_texture:new r.cg(g),u_opacity:new r.ci(g)}),rasterParticleDraw:g=>({u_particle_texture:new r.cg(g),u_particle_texture_side_len:new r.ci(g),u_tile_offset:new r.cj(g),u_velocity:new r.cg(g),u_color_ramp:new r.cg(g),u_velocity_res:new r.cj(g),u_max_speed:new r.ci(g),u_uv_offset:new r.cj(g),u_data_scale:new r.cj(g),u_data_offset:new r.ci(g),u_particle_pos_scale:new r.ci(g),u_particle_pos_offset:new r.cj(g)}),rasterParticleUpdate:g=>({u_particle_texture:new r.cg(g),u_particle_texture_side_len:new r.ci(g),u_velocity:new r.cg(g),u_velocity_res:new r.cj(g),u_max_speed:new r.ci(g),u_speed_factor:new r.ci(g),u_reset_rate:new r.ci(g),u_rand_seed:new r.ci(g),u_uv_offset:new r.cj(g),u_data_scale:new r.cj(g),u_data_offset:new r.ci(g),u_particle_pos_scale:new r.ci(g),u_particle_pos_offset:new r.cj(g)}),symbol:g=>({u_is_size_zoom_constant:new r.cg(g),u_is_size_feature_constant:new r.cg(g),u_size_t:new r.ci(g),u_size:new r.ci(g),u_camera_to_center_distance:new r.ci(g),u_rotate_symbol:new r.cg(g),u_aspect_ratio:new r.ci(g),u_fade_change:new r.ci(g),u_matrix:new r.ck(g),u_label_plane_matrix:new r.ck(g),u_coord_matrix:new r.ck(g),u_is_text:new r.cg(g),u_elevation_from_sea:new r.cg(g),u_pitch_with_map:new r.cg(g),u_texsize:new r.cj(g),u_texsize_icon:new r.cj(g),u_texture:new r.cg(g),u_texture_icon:new r.cg(g),u_gamma_scale:new r.ci(g),u_device_pixel_ratio:new r.ci(g),u_tile_id:new r.ch(g),u_zoom_transition:new r.ci(g),u_inv_rot_matrix:new r.ck(g),u_merc_center:new r.cj(g),u_camera_forward:new r.ch(g),u_tile_matrix:new r.ck(g),u_up_vector:new r.ch(g),u_ecef_origin:new r.ch(g),u_is_halo:new r.cg(g),u_icon_transition:new r.ci(g),u_color_adj_mat:new r.ck(g),u_scale_factor:new r.ci(g),u_ground_shadow_factor:new r.ch(g),u_inv_matrix:new r.ck(g),u_normal_scale:new r.ci(g),u_lutTexture:new r.cg(g)}),background:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_opacity:new r.ci(g),u_color:new r.dA(g)}),backgroundPattern:g=>({u_matrix:new r.ck(g),u_emissive_strength:new r.ci(g),u_opacity:new r.ci(g),u_image:new r.cg(g),u_pattern_tl:new r.cj(g),u_pattern_br:new r.cj(g),u_texsize:new r.cj(g),u_pattern_size:new r.cj(g),u_pixel_coord_upper:new r.cj(g),u_pixel_coord_lower:new r.cj(g),u_pattern_units_to_pixels:new r.cj(g)}),terrainRaster:g=>({u_matrix:new r.ck(g),u_image0:new r.cg(g),u_skirt_height:new r.ci(g),u_ground_shadow_factor:new r.ch(g)}),skybox:g=>({u_matrix:new r.ck(g),u_sun_direction:new r.ch(g),u_cubemap:new r.cg(g),u_opacity:new r.ci(g),u_temporal_offset:new r.ci(g)}),skyboxGradient:g=>({u_matrix:new r.ck(g),u_color_ramp:new r.cg(g),u_center_direction:new r.ch(g),u_radius:new r.ci(g),u_opacity:new r.ci(g),u_temporal_offset:new r.ci(g)}),skyboxCapture:g=>({u_matrix_3f:new r.dB(g),u_sun_direction:new r.ch(g),u_sun_intensity:new r.ci(g),u_color_tint_r:new r.d2(g),u_color_tint_m:new r.d2(g),u_luminance:new r.ci(g)}),globeRaster:g=>({u_proj_matrix:new r.ck(g),u_globe_matrix:new r.ck(g),u_normalize_matrix:new r.ck(g),u_merc_matrix:new r.ck(g),u_zoom_transition:new r.ci(g),u_merc_center:new r.cj(g),u_image0:new r.cg(g),u_grid_matrix:new r.dB(g),u_skirt_height:new r.ci(g),u_far_z_cutoff:new r.ci(g),u_frustum_tl:new r.ch(g),u_frustum_tr:new r.ch(g),u_frustum_br:new r.ch(g),u_frustum_bl:new r.ch(g),u_globe_pos:new r.ch(g),u_globe_radius:new r.ci(g),u_viewport:new r.cj(g)}),globeAtmosphere:g=>({u_frustum_tl:new r.ch(g),u_frustum_tr:new r.ch(g),u_frustum_br:new r.ch(g),u_frustum_bl:new r.ch(g),u_horizon:new r.ci(g),u_transition:new r.ci(g),u_fadeout_range:new r.ci(g),u_atmosphere_fog_color:new r.d2(g),u_high_color:new r.d2(g),u_space_color:new r.d2(g),u_temporal_offset:new r.ci(g),u_horizon_angle:new r.ci(g)}),model:g=>({u_matrix:new r.ck(g),u_lighting_matrix:new r.ck(g),u_normal_matrix:new r.ck(g),u_node_matrix:new r.ck(g),u_lightpos:new r.ch(g),u_lightintensity:new r.ci(g),u_lightcolor:new r.ch(g),u_camera_pos:new r.ch(g),u_opacity:new r.ci(g),u_baseColorFactor:new r.d2(g),u_emissiveFactor:new r.d2(g),u_metallicFactor:new r.ci(g),u_roughnessFactor:new r.ci(g),u_baseTextureIsAlpha:new r.cg(g),u_alphaMask:new r.cg(g),u_alphaCutoff:new r.ci(g),u_baseColorTexture:new r.cg(g),u_metallicRoughnessTexture:new r.cg(g),u_normalTexture:new r.cg(g),u_occlusionTexture:new r.cg(g),u_emissionTexture:new r.cg(g),u_lutTexture:new r.cg(g),u_color_mix:new r.d2(g),u_aoIntensity:new r.ci(g),u_emissive_strength:new r.ci(g),u_occlusionTextureTransform:new r.d2(g)}),modelDepth:g=>({u_matrix:new r.ck(g),u_instance:new r.ck(g),u_node_matrix:new r.ck(g)}),groundShadow:g=>({u_matrix:new r.ck(g),u_ground_shadow_factor:new r.ch(g)}),stars:g=>({u_matrix:new r.ck(g),u_up:new r.ch(g),u_right:new r.ch(g),u_intensity_multiplier:new r.ci(g)}),snowParticle:g=>({u_modelview:new r.ck(g),u_projection:new r.ck(g),u_time:new r.ci(g),u_cam_pos:new r.ch(g),u_velocityConeAperture:new r.ci(g),u_velocity:new r.ci(g),u_horizontalOscillationRadius:new r.ci(g),u_horizontalOscillationRate:new r.ci(g),u_boxSize:new r.ci(g),u_billboardSize:new r.ci(g),u_simpleShapeParameters:new r.cj(g),u_screenSize:new r.cj(g),u_thinningCenterPos:new r.cj(g),u_thinningShape:new r.ch(g),u_thinningAffectedRatio:new r.ci(g),u_thinningParticleOffset:new r.ci(g),u_particleColor:new r.d2(g),u_direction:new r.ch(g)}),rainParticle:g=>({u_modelview:new r.ck(g),u_projection:new r.ck(g),u_time:new r.ci(g),u_cam_pos:new r.ch(g),u_texScreen:new r.cg(g),u_velocityConeAperture:new r.ci(g),u_velocity:new r.ci(g),u_boxSize:new r.ci(g),u_rainDropletSize:new r.cj(g),u_distortionStrength:new r.ci(g),u_rainDirection:new r.ch(g),u_color:new r.d2(g),u_screenSize:new r.cj(g),u_thinningCenterPos:new r.cj(g),u_thinningShape:new r.ch(g),u_thinningAffectedRatio:new r.ci(g),u_thinningParticleOffset:new r.ci(g),u_shapeDirectionalPower:new r.ci(g),u_shapeNormalPower:new r.ci(g),u_mode:new r.ci(g)}),vignette:g=>({u_vignetteShape:new r.ch(g),u_vignetteColor:new r.d2(g)}),occlusion:g=>({u_matrix:new r.ck(g),u_anchorPos:new r.ch(g),u_screenSizePx:new r.cj(g),u_occluderSizePx:new r.cj(g),u_color:new r.d2(g)})};class Rl{constructor(o,d,y,S){this.id=Rl.uniqueIdxCounter,Rl.uniqueIdxCounter++,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||S||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Rl.uniqueIdxCounter,Rl.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Rl.uniqueIdxCounter=0;const Ig={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cy{constructor(o,d,y,S,C,I){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=S,this.instanceCount=I,this.context=o;const j=o.gl;this.buffer=j.createBuffer(),o.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||C||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let y=0;y<this.attributes.length;y++){const S=d.getAttributeLocation(o,this.attributes[y].name);S!==-1&&o.enableVertexAttribArray(S)}}setVertexAttribPointers(o,d,y){for(let S=0;S<this.attributes.length;S++){const C=this.attributes[S],I=d.getAttributeLocation(o,C.name);I!==-1&&o.vertexAttribPointer(I,C.components,o[Ig[C.type]],!1,this.itemSize,C.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(o,d,y){for(let S=0;S<this.attributes.length;S++){const C=d.getAttributeLocation(o,this.attributes[S].name);C!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(C,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Of{constructor(o,d,y,S,C){this.context=o,this.width=d,this.height=y;const I=this.framebuffer=o.gl.createFramebuffer();S&&(this.colorAttachment=new oy(o,I)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new Ch(o,I):new Dd(o,I))}destroy(){const o=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&o.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&o.deleteTexture(d)}o.deleteFramebuffer(this.framebuffer)}}class Ff{constructor(o,d){this.gl=o,this.clearColor=new wg(this),this.clearDepth=new wh(this),this.clearStencil=new Sg(this),this.colorMask=new Ef(this),this.depthMask=new o_(this),this.stencilMask=new Ib(this),this.stencilFunc=new a_(this),this.stencilOp=new l_(this),this.stencilTest=new Sh(this),this.depthRange=new Tg(this),this.depthTest=new Eg(this),this.depthFunc=new Gp(this),this.blend=new Af(this),this.blendFunc=new $p(this),this.blendColor=new Th(this),this.blendEquation=new Eh(this),this.cullFace=new Wp(this),this.cullFaceSide=new Cf(this),this.frontFace=new Ag(this),this.program=new iu(this),this.activeTexture=new sy(this),this.viewport=new vc(this),this.bindFramebuffer=new Cl(this),this.bindRenderbuffer=new Nd(this),this.bindTexture=new bc(this),this.bindVertexBuffer=new Mf(this),this.bindElementBuffer=new qp(this),this.bindVertexArrayOES=new c_(this),this.pixelStoreUnpack=new jd(this),this.pixelStoreUnpackPremultiplyAlpha=new kf(this),this.pixelStoreUnpackFlipY=new wc(this),this.options=d?Object.assign({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=d&&!!d.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d,y){return new Rl(this,o,d,y)}createVertexBuffer(o,d,y,S,C){return new cy(this,o,d,y,S,C)}createRenderbuffer(o,d,y){const S=this.gl,C=S.createRenderbuffer();return this.bindRenderbuffer.set(C),S.renderbufferStorage(S.RENDERBUFFER,o,d,y),this.bindRenderbuffer.set(null),C}createFramebuffer(o,d,y,S){return new Of(this,o,d,y,S)}clear({color:o,depth:d,stencil:y,colorMask:S}){const C=this.gl;let I=0;o&&(I|=C.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(S||[!0,!0,!0,!0])),d!==void 0&&(I|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(I|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),C.clear(I)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){r.bx(o.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Va;function Sa(g,o,d,y,S,C,I){const j=g.context,z=j.gl,$=g.transform,q=[r.aF($.center.lng),r.aJ($.center.lat)],ee=d.layout.get("symbol-placement"),Q=d.layout.get("text-variable-anchor"),ie=d.layout.get("icon-rotation-alignment")==="map",le=d.layout.get("text-rotation-alignment")==="map",de=ee!=="point",be=[];let _e=0,Se=0;for(let De=0;De<y.length;De++){const Qe=y[De],dt=o.getTile(Qe),lt=dt.getBucket(d);if(!lt)continue;const Lt=lt.getProjection().createInversionMatrix($,Qe.canonical),Tt=[],Gt=pg(Qe,lt,$),hn=!I&&ie&&de,mt=I&&le&&de,rt=Q&&lt.hasTextData(),zt=lt.hasIconTextFit()&&rt&&lt.hasIconData(),Mt=hn||mt||I&&rt||zt,Jt=lt.projection.name==="globe",_n=Jt?r.aj($.zoom):0;Jt&&(Tt.push("PROJECTION_GLOBE_VIEW"),Mt&&Tt.push("PROJECTED_POS_ON_VIEWPORT"));const Vn=g.getOrCreateProgram("collisionBox",{defines:Tt});let fn=Gt;S[0]===0&&S[1]===0||(fn=g.translatePosMatrix(Gt,dt,S,C));const yn=I?lt.textCollisionBox:lt.iconCollisionBox,$n=lt.collisionCircleArray;if($n.length>0){const Cn=r.bB(),Bn=fn;r.cO(Cn,lt.placementInvProjMatrix,$.glCoordMatrix),r.cO(Cn,Cn,lt.placementViewportMatrix),be.push({circleArray:$n,circleOffset:Se,transform:Bn,invTransform:Cn,projection:lt.getProjection()}),_e+=$n.length/4,Se=_e}if(!yn)continue;g.terrain&&g.terrain.setupElevationDraw(dt,Vn);const On=Jt?[Qe.canonical.x,Qe.canonical.y,1<<Qe.canonical.z]:[0,0,0];Vn.draw(g,z.LINES,Xn.disabled,Cr.disabled,g.colorModeForRenderPass(),Dr.disabled,Ws(fn,Lt,$,_n,q,dt,On,lt.getProjection()),d.id,yn.layoutVertexBuffer,yn.indexBuffer,yn.segments,null,$.zoom,null,[yn.collisionVertexBuffer,yn.collisionVertexBufferExt])}if(!I||!be.length)return;const Pe=g.getOrCreateProgram("collisionCircle"),Ee=new r.dY;Ee.resize(4*_e),Ee._trim();let We=0;for(const De of be)for(let Qe=0;Qe<De.circleArray.length/4;Qe++){const dt=4*Qe,lt=De.circleArray[dt+0],Lt=De.circleArray[dt+1],Tt=De.circleArray[dt+2],Gt=De.circleArray[dt+3];Ee.emplace(We++,lt,Lt,Tt,Gt,0),Ee.emplace(We++,lt,Lt,Tt,Gt,1),Ee.emplace(We++,lt,Lt,Tt,Gt,2),Ee.emplace(We++,lt,Lt,Tt,Gt,3)}(!Va||Va.length<2*_e)&&(Va=(function(De){const Qe=2*De,dt=new r.b0;dt.resize(Qe),dt._trim();for(let lt=0;lt<Qe;lt++){const Lt=6*lt;dt.uint16[Lt+0]=4*lt+0,dt.uint16[Lt+1]=4*lt+1,dt.uint16[Lt+2]=4*lt+2,dt.uint16[Lt+3]=4*lt+2,dt.uint16[Lt+4]=4*lt+3,dt.uint16[Lt+5]=4*lt+0}return dt})(_e));const Ne=j.createIndexBuffer(Va,!0),Xe=j.createVertexBuffer(Ee,r.dZ.members,!0);for(const De of be){const Qe={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(ze=$).getCameraToCenterDistance(De.projection),u_viewport_size:[ze.width,ze.height]};Pe.draw(g,z.TRIANGLES,Xn.disabled,Cr.disabled,g.colorModeForRenderPass(),Dr.disabled,Qe,d.id,Xe,Ne,r.bf.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,$.zoom)}var ze;Xe.destroy(),Ne.destroy()}const fl=r.bB();function rm(g){const o=g._camera.getWorldToCamera(g.worldSize,1),d=r.aB([],o,g.globeMatrix);r.bk(d,d);const y=[0,0,0],S=[0,1,0,0];return r.aC(S,S,d),y[0]=S[0],y[1]=S[1],y[2]=S[2],r.aw(y,y),y}function im({width:g,height:o,anchor:d,textOffset:y,textScale:S},C){const{horizontalAlign:I,verticalAlign:j}=r.c0(d),z=-(I-.5)*g,$=-(j-.5)*o,q=r.c1(d,y);return new r.P((z/S+q[0])*C,($/S+q[1])*C)}function Kl(g,o,d,y,S,C,I,j,z,$){const q=g.text.placedSymbolArray,ee=g.text.dynamicLayoutVertexArray,Q=g.icon.dynamicLayoutVertexArray,ie={},le=g.getProjection(),de=kp(I,le,S),be=S.elevation,_e=le.upVectorScale(I.canonical,S.center.lat,S.worldSize).metersToTile;ee.clear();for(let Se=0;Se<q.length;Se++){const Pe=q.get(Se),{tileAnchorX:Ee,tileAnchorY:We,numGlyphs:Ne}=Pe,Xe=Pe.hidden||!Pe.crossTileID||g.allowVerticalPlacement&&!Pe.placedOrientation?null:y[Pe.crossTileID];if(Xe){let ze=0,De=0,Qe=0;const dt=g.elevationType==="road";if(be||dt){const Mt=dt?g.getElevationFeatureForText(Se):null,Jt=r.bU.getAtTileOffset(I,new r.P(Ee,We),be,Mt),[_n,Vn,fn]=le.upVector(I.canonical,Ee,We);ze=Jt*_n*_e,De=Jt*Vn*_e,Qe=Jt*fn*_e}let[lt,Lt,Tt,Gt]=bs(Pe.projectedAnchorX+ze,Pe.projectedAnchorY+De,Pe.projectedAnchorZ+Qe,d?de:C);const hn=bd(S.getCameraToCenterDistance(le),Gt);let mt=r.bL(g.textSizeData,z,Pe)*hn/r.bX;d&&(mt*=g.tilePixelRatio/j);const rt=im(Xe,mt);d?({x:lt,y:Lt,z:Tt}=le.projectTilePoint(Ee+rt.x,We+rt.y,I.canonical),[lt,Lt,Tt]=bs(lt+ze,Lt+De,Tt+Qe,C)):(o&&rt._rotate(-S.angle),lt+=rt.x,Lt+=rt.y,Tt=0);const zt=g.allowVerticalPlacement&&Pe.placedOrientation===r.bK.vertical?Math.PI/2:0;for(let Mt=0;Mt<Ne;Mt++)r.bN(ee,lt,Lt,Tt,zt);$&&Pe.associatedIconIndex>=0&&(ie[Pe.associatedIconIndex]={x:lt,y:Lt,z:Tt,angle:zt})}else Iu(Ne,ee)}if($){Q.clear();const Se=g.icon.placedSymbolArray;for(let Pe=0;Pe<Se.length;Pe++){const Ee=Se.get(Pe),{numGlyphs:We}=Ee,Ne=ie[Pe];if(Ee.hidden||!Ne)Iu(We,Q);else{const{x:Xe,y:ze,z:De,angle:Qe}=Ne;for(let dt=0;dt<We;dt++)r.bN(Q,Xe,ze,De,Qe)}}g.icon.dynamicLayoutVertexBuffer.updateData(Q)}g.text.dynamicLayoutVertexBuffer.updateData(ee)}function Yl(g,o,d,y,S,C,I={}){const j=d.paint.get("icon-translate"),z=d.paint.get("text-translate"),$=d.paint.get("icon-translate-anchor"),q=d.paint.get("text-translate-anchor"),ee=d.layout.get("icon-rotation-alignment"),Q=d.layout.get("text-rotation-alignment"),ie=d.layout.get("icon-pitch-alignment"),le=d.layout.get("text-pitch-alignment"),de=d.layout.get("icon-keep-upright"),be=d.layout.get("text-keep-upright"),_e=d.paint.get("icon-color-saturation"),Se=d.paint.get("icon-color-contrast"),Pe=d.paint.get("icon-color-brightness-min"),Ee=d.paint.get("icon-color-brightness-max"),We=d.layout.get("symbol-elevation-reference")==="sea",Ne=d.layout.get("icon-image-use-theme")==="none",Xe=g.context,ze=Xe.gl,De=g.transform,Qe=ee==="map",dt=Q==="map",lt=ie==="map",Lt=le==="map",Tt=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Gt=!1;const hn=g.depthModeForSublayer(0,Xn.ReadOnly),mt=new Xn(g.context.gl.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D),rt=[r.aF(De.center.lng),r.aJ(De.center.lat)],zt=d.layout.get("text-variable-anchor"),Mt=De.projection.name==="globe",Jt=[],_n=[0,-1,0];for(const Vn of y){const fn=o.getTile(Vn),yn=fn.getBucket(d);if(!yn||yn.projection.name==="mercator"&&Mt||yn.fullyClipped)continue;const $n=yn.projection.name==="globe",On=$n?r.aj(De.zoom):0,Cn=kp(Vn,yn.getProjection(),De),Bn=De.calculatePixelsToTileUnitsMatrix(fn),_r=zt&&yn.hasTextData(),mi=yn.hasIconTextFit()&&_r&&yn.hasIconData(),zr=yn.getProjection().createInversionMatrix(De,Vn.canonical),ts=(1<<fn.tileID.canonical.z)*r.al/g.transform.worldSize,Ir=Ei=>{let Pr=[0,0,0];if(Ei){const Si=g.style.directionalLight,xs=g.style.ambientLight;Si&&xs&&(Pr=Zl(g.style,Si,xs))}return Pr},bi=Ei=>{De.depthOcclusionForSymbolsAndCircles&&(d.hasOcclusionOpacityProperties||g.terrain)&&(Ei.push("DEPTH_D24"),Ei.push("DEPTH_OCCLUSION"))},Kr=Ei=>{d.lut&&!Ne&&(d.lut.texture||(d.lut.texture=new r.d_(g.context,d.lut.image,[d.lut.image.height,d.lut.image.height,d.lut.image.height],Xe.gl.RGBA8)),Xe.activeTexture.set(Xe.gl.TEXTURE0+go.LUT),d.lut.texture&&d.lut.texture.bind(Xe.gl.LINEAR,Xe.gl.CLAMP_TO_EDGE),Ei.push("APPLY_LUT_ON_GPU"))},Xi=()=>{const Ei=Qe&&d.layout.get("symbol-placement")!=="point",Pr=[];bi(Pr),Kr(Pr);const Si=Ei||mi,xs=yn.elevationType==="road",qs=g.shadowRenderer,ws=xs&&lt&&!!qs&&qs.enabled,Os=Ir(ws),Aa=xs&&lt&&!g.terrain?mt:hn,ga=d.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&lt&&Pr.push("PITCH_WITH_MAP_TERRAIN"),$n&&(Pr.push("PROJECTION_GLOBE_VIEW"),Si&&Pr.push("PROJECTED_POS_ON_VIEWPORT")),ga>0&&yn.hasAnySecondaryIcon&&Pr.push("ICON_TRANSITION"),!yn.icon.zOffsetVertexBuffer||xs&&g.terrain||Pr.push("Z_OFFSET"),_e===0&&Se===0&&Pe===0&&Ee===1||Pr.push("COLOR_ADJUSTMENT"),yn.sdfIcons&&Pr.push("RENDER_SDF"),ws&&Pr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xs&&lt&&!g.terrain&&yn.icon.orientationVertexBuffer&&Pr.push("ELEVATED_ROADS");const To=yn.icon.programConfigurations.get(d.id),jo=g.getOrCreateProgram("symbol",{config:To,defines:Pr}),gl=fn.imageAtlasTexture?fn.imageAtlasTexture.size:[0,0],Do=yn.iconSizeData,Fl=r.bJ(Do,De.zoom),Bl=lt||!De.isOrthographic,_o=ku(Cn,fn.tileID.canonical,lt,Qe,De,yn.getProjection(),Bn),Ss=Jc(Cn,fn.tileID.canonical,lt,Qe,De,yn.getProjection(),Bn),Fs=g.translatePosMatrix(Ss,fn,j,$,!0),Ji=g.translatePosMatrix(Cn,fn,j,$),Xs=Si?fl:_o,Lo=Qe&&!lt&&!Ei;let Ts=_n;!Mt&&!De.mercatorFromTransition||Qe||(Ts=rm(De));const zl=$n?Ts:_n,hu=d.getColorAdjustmentMatrix(_e,Se,Pe,Ee),$u=Lf(Do.kind,Fl,Lo,lt,g,Ji,Xs,Fs,We,!1,gl,[0,0],0,Vn,On,rt,zr,zl,yn.getProjection(),Os,ts,hu,ga,null),Wu=fn.imageAtlasTexture?fn.imageAtlasTexture:null,b=d.layout.get("icon-size").constantOr(0)!==1||yn.iconsNeedLinear,M=yn.sdfIcons||g.options.rotating||g.options.zooming||b||Bl?ze.LINEAR:ze.NEAREST,B=yn.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,Z=g.terrain&&lt&&Ei?r.bk(r.bB(),_o):fl;if(Ei&&yn.icon){const se=r.bU.getAtTileOffsetFunc(Vn,De.center.lat,De.worldSize,yn.getProjection()),ge=vd(Cn,fn.tileID.canonical,lt,Qe,De,yn.getProjection(),Bn),Ue=d.layout.get("icon-size-scale-range"),xt=r.aA(g.scaleFactor,Ue[0],Ue[1]);mh(yn,Cn,g,!1,ge,Ss,lt,de,se,Vn,xt)}return{program:jo,buffers:yn.icon,uniformValues:$u,atlasTexture:Wu,atlasTextureIcon:null,atlasInterpolation:M,atlasInterpolationIcon:null,isSDF:yn.sdfIcons,hasHalo:B,depthMode:Aa,tile:fn,renderWithShadows:ws,labelPlaneMatrixInv:Z}},wi=()=>{const Ei=dt&&d.layout.get("symbol-placement")!=="point",Pr=[],Si=Ei||zt||mi,xs=yn.elevationType==="road",qs=g.shadowRenderer,ws=xs&&Lt&&!!qs&&qs.enabled,Os=Ir(ws),Aa=xs&&Lt&&!g.terrain?mt:hn;g.terrainRenderModeElevated()&&Lt&&Pr.push("PITCH_WITH_MAP_TERRAIN"),$n&&(Pr.push("PROJECTION_GLOBE_VIEW"),Si&&Pr.push("PROJECTED_POS_ON_VIEWPORT")),!yn.text.zOffsetVertexBuffer||xs&&g.terrain||Pr.push("Z_OFFSET"),yn.iconsInText&&Pr.push("RENDER_TEXT_AND_SYMBOL"),Pr.push("RENDER_SDF"),ws&&Pr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xs&&Lt&&!g.terrain&&yn.text.orientationVertexBuffer&&Pr.push("ELEVATED_ROADS"),bi(Pr);const ga=yn.text.programConfigurations.get(d.id),To=g.getOrCreateProgram("symbol",{config:ga,defines:Pr});let jo,gl=[0,0],Do=null;const Fl=yn.textSizeData;yn.iconsInText&&(gl=fn.imageAtlasTexture?fn.imageAtlasTexture.size:[0,0],Do=fn.imageAtlasTexture?fn.imageAtlasTexture:null,jo=Lt||!De.isOrthographic||g.options.rotating||g.options.zooming||Fl.kind==="composite"||Fl.kind==="camera"?ze.LINEAR:ze.NEAREST);const Bl=fn.glyphAtlasTexture?fn.glyphAtlasTexture.size:[0,0],_o=d.layout.get("text-size-scale-range"),Ss=r.aA(g.scaleFactor,_o[0],_o[1]),Fs=r.bJ(Fl,De.zoom,Ss),Ji=ku(Cn,fn.tileID.canonical,Lt,dt,De,yn.getProjection(),Bn),Xs=Jc(Cn,fn.tileID.canonical,Lt,dt,De,yn.getProjection(),Bn),Lo=g.translatePosMatrix(Xs,fn,z,q,!0),Ts=g.translatePosMatrix(Cn,fn,z,q),zl=Si?fl:Ji,hu=dt&&!Lt&&!Ei;let $u=_n;!Mt&&!De.mercatorFromTransition||dt||($u=rm(De));const Wu=Lf(Fl.kind,Fs,hu,Lt,g,Ts,zl,Lo,We,!0,Bl,gl,0,Vn,On,rt,zr,$n?$u:_n,yn.getProjection(),Os,ts,null,null,Ss),b=fn.glyphAtlasTexture?fn.glyphAtlasTexture:null,M=ze.LINEAR,B=d.paint.get("text-halo-width").constantOr(1)!==0,Z=g.terrain&&Lt&&Ei?r.bk(r.bB(),Ji):fl;if(Ei&&yn.text){const se=r.bU.getAtTileOffsetFunc(Vn,De.center.lat,De.worldSize,yn.getProjection()),ge=vd(Cn,fn.tileID.canonical,Lt,dt,De,yn.getProjection(),Bn);mh(yn,Cn,g,!0,ge,Xs,Lt,be,se,Vn,Ss)}return{program:To,buffers:yn.text,uniformValues:Wu,atlasTexture:b,atlasTextureIcon:Do,atlasInterpolation:M,atlasInterpolationIcon:jo,isSDF:!0,hasHalo:B,depthMode:Aa,tile:fn,renderWithShadows:ws,labelPlaneMatrixInv:Z}},ss=yn.icon.segments.get().length,gi=yn.text.segments.get().length,Xr=ss&&!I.onlyText?Xi():null,Oi=gi&&!I.onlyIcons?wi():null,Gr=d.paint.get("icon-opacity").constantOr(1),os=d.paint.get("text-opacity").constantOr(1);if(Tt&&yn.canOverlap){Gt=!0;const Ei=Gr&&!I.onlyText?yn.icon.segments.get():[],Pr=os&&!I.onlyIcons?yn.text.segments.get():[];for(const Si of Ei)Jt.push({segments:new r.bf([Si]),sortKey:Si.sortKey,state:Xr});for(const Si of Pr)Jt.push({segments:new r.bf([Si]),sortKey:Si.sortKey,state:Oi})}else I.onlyText||Jt.push({segments:Gr?yn.icon.segments:new r.bf([]),sortKey:0,state:Xr}),I.onlyIcons||Jt.push({segments:os?yn.text.segments:new r.bf([]),sortKey:0,state:Oi})}Gt&&Jt.sort(((Vn,fn)=>Vn.sortKey-fn.sortKey));for(const Vn of Jt){const fn=Vn.state;if(fn)if(g.terrain?g.terrain.setupElevationDraw(fn.tile,fn.program,{useDepthForOcclusion:De.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:fn.labelPlaneMatrixInv}):g.setupDepthForOcclusion(De.depthOcclusionForSymbolsAndCircles,fn.program),Xe.activeTexture.set(ze.TEXTURE0),fn.atlasTexture&&fn.atlasTexture.bind(fn.atlasInterpolation,ze.CLAMP_TO_EDGE,!0),fn.atlasTextureIcon&&(Xe.activeTexture.set(ze.TEXTURE1),fn.atlasTextureIcon&&fn.atlasTextureIcon.bind(fn.atlasInterpolationIcon,ze.CLAMP_TO_EDGE,!0)),fn.renderWithShadows&&g.shadowRenderer.setupShadows(fn.tile.tileID.toUnwrapped(),fn.program,"vector-tile"),g.uploadCommonLightUniforms(g.context,fn.program),fn.hasHalo){const yn=fn.uniformValues;yn.u_is_halo=1,Bf(fn.buffers,Vn.segments,d,g,fn.program,fn.depthMode,S,C,yn,2),yn.u_is_halo=0}else{if(fn.isSDF){const yn=fn.uniformValues;fn.hasHalo&&(yn.u_is_halo=1,Bf(fn.buffers,Vn.segments,d,g,fn.program,fn.depthMode,S,C,yn,1)),yn.u_is_halo=0}Bf(fn.buffers,Vn.segments,d,g,fn.program,fn.depthMode,S,C,fn.uniformValues,1)}}}function Bf(g,o,d,y,S,C,I,j,z,$){const q=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];S.draw(y,y.context.gl.TRIANGLES,C,I,j,Dr.disabled,z,d.id,g.layoutVertexBuffer,g.indexBuffer,o,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),q,$)}function uy(g,o){const d=1<<g.canonical.z,y=(o.x*d-g.canonical.x-g.wrap*d)*r.al,S=(o.y*d-g.canonical.y)*r.al,C=r.e7(o.z,o.y);return r.d4(y,S,C)}function Ha(g,o,d,y,S){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const C=g.context.gl,I=new Xn(g.context.gl.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D),j=new Xn(g.context.gl.GREATER,Xn.ReadWrite,g.depthRangeFor3D),z=(function(ie){let le=.01;return ie.isOrthographic&&(le=r.ak(1e-4,le,r.c$(ie.pitch>=Ed?1:ie.pitch/Ed))),2*le})(g.transform),$=g.transform.getFreeCameraOptions().position,q="elevatedStructuresDepthReconstruct",ee=g.getOrCreateProgram(q,{defines:["DEPTH_RECONSTRUCTION"]}),Q=g.getOrCreateProgram(q);for(const ie of y){const le=o.getTile(ie),de=le.getBucket(d);if(!de)continue;const be=de.elevatedStructures;if(!be)continue;const _e=de.elevationBufferData.heightRange,Se=uy(ie.toUnwrapped(),$),Pe=g.translatePosMatrix(ie.projMatrix,le,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));let Ee,We,Ne,Xe;if(S==="initialize"){if(!_e||_e.min>=1||be.depthSegments.segments[0].primitiveLength===0)continue;Ee=Nf(Pe,Se,z,1,0),We=I,Ne=be.depthSegments,Xe=ee}else if(S==="reset"){if(!_e||_e.min>=0||be.maskSegments.segments[0].primitiveLength===0)continue;Ee=Nf(Pe,Se,0,0,1),We=j,Ne=be.maskSegments,Xe=ee}else if(S==="geometry"){if(be.depthSegments.segments[0].primitiveLength===0)continue;Ee=Nf(Pe,Se,z,1,0),We=I,Ne=be.depthSegments,Xe=Q}Xe.draw(g,C.TRIANGLES,We,Cr.disabled,si.disabled,Dr.disabled,Ee,d.id,be.vertexBuffer,be.indexBuffer,Ne,d.paint,g.transform.zoom)}}function Nl(g,o,d){const{painter:y,sourceCache:S,layer:C,coords:I,colorMode:j,elevationType:z,terrainEnabled:$,pass:q}=g,ee=y.context.gl,Q=C.paint.get("fill-pattern"),ie=C.paint.get("fill-pattern-cross-fade"),le=Q.constantOr(null);let de=z;z!=="road"||o&&!$||(de="none");const be=de==="road",_e=g.painter.shadowRenderer,Se=be&&!!_e&&_e.enabled,Pe=new Xn(y.context.gl.LEQUAL,Xn.ReadOnly,y.depthRangeFor3D);let Ee=[0,0,0];if(Se){const Xe=y.style.directionalLight,ze=y.style.ambientLight;Xe&&ze&&(Ee=Zl(y.style,Xe,ze))}const We=Q&&Q.constantOr(1),Ne=(Xe,ze)=>{let De,Qe,dt,lt,Lt;ze?(De=We&&!C.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",dt=ee.LINES):(De=We?"fillPattern":"fill",dt=ee.TRIANGLES);for(const Tt of I){const Gt=S.getTile(Tt);if(We&&!Gt.patternsLoaded())continue;const hn=Gt.getBucket(C);if(!hn)continue;const mt=o?hn.elevationBufferData:hn.bufferData;if(mt.isEmpty())continue;y.prepareDrawTile();const rt=mt.programConfigurations.get(C.id),zt=y.isTileAffectedByFog(Tt),Mt=[],Jt=[];be&&(Mt.push("ELEVATED_ROADS"),Jt.push(mt.elevatedLayoutVertexBuffer)),Se&&Mt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),We&&(y.context.activeTexture.set(ee.TEXTURE0),Gt.imageAtlasTexture&&Gt.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),rt.updatePaintBuffers());let _n=!1;if(le&&Gt.imageAtlas){const On=Gt.imageAtlas,Cn=r.e2.from(le),Bn=Cn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),_r=Cn.getSecondary(),mi=On.patternPositions.get(Bn),zr=_r?On.patternPositions.get(_r.scaleSelf(r.o.devicePixelRatio).toString()):null;_n=!!mi&&!!zr,mi&&rt.setConstantPatternPositions(mi,zr)}ie>0&&(_n||rt.getPatternTransitionVertexBuffer("fill-pattern"))&&Mt.push("FILL_PATTERN_TRANSITION");const Vn=y.getOrCreateProgram(De,{config:rt,overrideFog:zt,defines:Mt}),fn=y.translatePosMatrix(Tt.projMatrix,Gt,C.paint.get("fill-translate"),C.paint.get("fill-translate-anchor"));Se&&_e.setupShadows(Gt.tileID.toUnwrapped(),Vn,"vector-tile");const yn=C.paint.get("fill-emissive-strength");if(ze){lt=mt.lineIndexBuffer,Lt=mt.lineSegments;const On=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[ee.drawingBufferWidth,ee.drawingBufferHeight];Qe=De==="fillOutlinePattern"&&We?Ih(fn,yn,y,Gt,On,Ee,ie):Fu(fn,yn,On,Ee)}else lt=mt.indexBuffer,Lt=mt.triangleSegments,Qe=We?ou(fn,yn,y,Gt,Ee,ie):Ld(fn,yn,Ee);y.uploadCommonUniforms(y.context,Vn,Tt.toUnwrapped());let $n=Xe;(z==="road"&&!$||z==="offset")&&($n=Pe),Vn.draw(y,dt,$n,d||y.stencilModeForClipping(Tt),j,Dr.disabled,Qe,C.id,mt.layoutVertexBuffer,lt,Lt,C.paint,y.transform.zoom,rt,Jt)}};y.renderPass===q&&Ne(y.depthModeForSublayer(1,y.renderPass==="opaque"?Xn.ReadWrite:Xn.ReadOnly),!1),de==="none"&&y.renderPass==="translucent"&&C.paint.get("fill-antialias")&&Ne(y.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Xn.ReadOnly),!0)}function Fn(g,o,d,y,S,C,I,j){d.resetLayerRenderingStats(g);const z=g.context,$=z.gl,q=g.transform,ee=d.paint.get("fill-extrusion-pattern"),Q=d.paint.get("fill-extrusion-pattern-cross-fade"),ie=ee.constantOr(null),le=ee.constantOr(1),de=d.paint.get("fill-extrusion-opacity"),be=g.style.enable3dLights(),_e=d.paint.get(be&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Se=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),_e],Pe=d.layout.get("fill-extrusion-edge-radius"),Ee=Pe>0&&!d.paint.get("fill-extrusion-rounded-roof"),We=Ee?0:Pe,Ne=q.projection.name==="globe"?r.ea():0,Xe=q.projection.name==="globe",ze=Xe?r.aj(q.zoom):0,De=[r.aF(q.center.lng),r.aJ(q.center.lat)],Qe=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",dt=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Qe?null:d.lut).toArray01().slice(0,3),lt=d.paint.get("fill-extrusion-flood-light-intensity"),Lt=d.paint.get("fill-extrusion-vertical-scale"),Tt=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Gt=d.paint.get("fill-extrusion-height-alignment"),hn=d.paint.get("fill-extrusion-base-alignment"),mt=_c(g,d.paint.get("fill-extrusion-cutoff-fade-range")),rt=[];let zt;Xe&&rt.push("PROJECTION_GLOBE_VIEW"),Se[0]>0&&rt.push("FAUX_AO"),Ee&&rt.push("ZERO_ROOF_RADIUS"),j&&rt.push("HAS_CENTROID"),lt>0&&rt.push("FLOOD_LIGHT"),mt.shouldRenderCutoff&&rt.push("RENDER_CUTOFF"),Tt&&rt.push("RENDER_WALL_MODE");const Mt=g.renderPass==="shadow",Jt=g.shadowRenderer,_n=Mt&&!!Jt,Vn=Mt?Dr.disabled:Dr.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let fn=[0,0,0];if(Jt){const On=g.style.directionalLight,Cn=g.style.ambientLight;On&&Cn&&(fn=Zl(g.style,On,Cn)),Mt||(rt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Jt.useNormalOffset&&rt.push("NORMAL_OFFSET")),zt=rt.concat(["SHADOWS_SINGLE_CASCADE"])}const yn=_n?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",$n=d.getLayerRenderingStats();for(const On of y){const Cn=o.getTile(On),Bn=Cn.getBucket(d);if(!Bn||Bn.projection.name!==q.projection.name)continue;let _r=!1;Jt&&(_r=Jt.getMaxCascadeForTile(On.toUnwrapped())===0);const mi=g.isTileAffectedByFog(On),zr=Bn.programConfigurations.get(d.id);let ts=!1;if(ie&&Cn.imageAtlas){const gi=Cn.imageAtlas,Xr=r.e2.from(ie),Oi=Xr.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Gr=Xr.getSecondary(),os=gi.patternPositions.get(Oi),Ei=Gr?gi.patternPositions.get(Gr.scaleSelf(r.o.devicePixelRatio).toString()):null;ts=!!os&&!!Ei,os&&zr.setConstantPatternPositions(os,Ei)}Q>0&&(ts||zr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&rt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ir=g.getOrCreateProgram(yn,{config:zr,defines:_r?zt:rt,overrideFog:mi});if(g.terrain&&g.terrain.setupElevationDraw(Cn,Ir,{useMeterToDem:!0}),!Bn.centroidVertexBuffer){const gi=Ir.getAttributeLocation($,"a_centroid_pos");gi!==-1&&$.vertexAttrib2f(gi,0,0)}!Mt&&Jt&&Jt.setupShadows(Cn.tileID.toUnwrapped(),Ir,"vector-tile"),le&&(g.context.activeTexture.set($.TEXTURE0),Cn.imageAtlasTexture&&Cn.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),zr.updatePaintBuffers());const bi=d.paint.get("fill-extrusion-vertical-gradient"),Kr=1/Bn.tileToMeter;let Xi;if(Mt&&Jt){if(zf(Cn.tileID,Bn.maxHeight,g))continue;const gi=Jt.calculateShadowPassMatrixFromTile(Cn.tileID.toUnwrapped());Xi=Kp(gi,We,Kr,Lt,Gt,hn)}else{const gi=g.translatePosMatrix(On.expandedProjMatrix,Cn,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Xr=q.projection.createInversionMatrix(q,On.canonical);Xi=le?kl(gi,g,bi,de,Se,We,Kr,On,Cn,Ne,Gt,hn,ze,De,Xr,dt,Lt,Q):kh(gi,g,bi,de,Se,We,Kr,On,Ne,Gt,hn,ze,De,Xr,dt,Lt,lt,fn)}g.uploadCommonUniforms(z,Ir,On.toUnwrapped(),null,mt);let wi=Bn.segments;if(q.projection.name==="mercator"&&!Mt&&(wi=Bn.getVisibleSegments(Cn.tileID,g.terrain,g.transform.getFrustum(0)),!wi.get().length))continue;if($n)if(Mt)for(const gi of wi.get())$n.numRenderedVerticesInShadowPass+=gi.primitiveLength;else for(const gi of wi.get())$n.numRenderedVerticesInTransparentPass+=gi.primitiveLength;const ss=[];(g.terrain||j)&&ss.push(Bn.centroidVertexBuffer),Xe&&ss.push(Bn.layoutVertexExtBuffer),Tt&&ss.push(Bn.wallVertexBuffer),Ir.draw(g,z.gl.TRIANGLES,S,C,I,Vn,Xi,d.id,Bn.layoutVertexBuffer,Bn.indexBuffer,wi,d.paint,g.transform.zoom,zr,ss)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}class Pg{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Jl(g,o,d,y,S,C,I,j,z,$,q,ee,Q,ie,le,de,be,_e,Se,Pe){const Ee=o.context,We=Ee.gl,Ne=o.transform,Xe=o.transform.zoom,ze=[],De=g.translate,Qe=g.translateAnchor,dt=g.edgeRadius,lt=_c(o,g.cutoffFadeRange);q==="clear"?(ze.push("CLEAR_SUBPASS"),Pe&&(ze.push("CLEAR_FROM_TEXTURE"),Ee.activeTexture.set(We.TEXTURE0),Pe.bind(We.LINEAR,We.CLAMP_TO_EDGE))):q==="sdf"&&ze.push("SDF_SUBPASS"),_e&&ze.push("HAS_CENTROID"),lt.shouldRenderCutoff&&ze.push("RENDER_CUTOFF");const Lt=(Tt,Gt,hn,mt,rt)=>{let zt=ze;Gt.groundRadiusBuffer!=null&&(zt=ze.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Mt=Gt.programConfigurations.get(y.id),Jt=o.isTileAffectedByFog(Tt),_n=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Mt,defines:zt,overrideFog:Jt}),Vn=fa(o,mt,ee,$,rt,[Q,ie*rt],le,de,be,Xe>=17?0:dt*rt,Pe?Pe.size[0]:0),fn=[];_e&&fn.push(Gt.hiddenByLandmarkVertexBuffer),Gt.groundRadiusBuffer!=null&&fn.push(Gt.groundRadiusBuffer),o.uploadCommonUniforms(Ee,_n,Tt.toUnwrapped(),null,lt),_n.draw(o,Ee.gl.TRIANGLES,C,I,j,z,Vn,y.id,Gt.vertexBuffer,Gt.indexBuffer,hn,y.paint,Xe,Mt,fn)};for(const Tt of S){const Gt=d.getTile(Tt),hn=Gt.getBucket(y);if(!hn||hn.projection.name!==Ne.projection.name||!hn.groundEffect||hn.groundEffect&&!hn.groundEffect.hasData())continue;const mt=hn.groundEffect,rt=1/hn.tileToMeter;{const zt=o.translatePosMatrix(Tt.projMatrix,Gt,De,Qe),Mt=mt.getDefaultSegment();Lt(Tt,mt,Mt,zt,rt)}if(Se)for(let zt=0;zt<4;zt++){const Mt=r.e8[zt](Tt),Jt=d.getTile(Mt);if(!Jt)continue;const _n=Jt.getBucket(y);if(!_n||_n.projection.name!==Ne.projection.name||!_n.groundEffect||_n.groundEffect&&!_n.groundEffect.hasData())continue;const Vn=_n.groundEffect;let fn,yn;zt===0?(fn=[-r.al,0,0],yn=1):zt===1?(fn=[r.al,0,0],yn=0):zt===2?(fn=[0,-r.al,0],yn=3):(fn=[0,r.al,0],yn=2);const $n=Vn.regionSegments[yn];if(!$n)continue;const On=new Float32Array(16);r.bq(On,Tt.projMatrix,fn),Lt(Tt,Vn,$n,o.translatePosMatrix(On,Gt,De,Qe),rt)}}}function zu(g,o,d,y,S,C,I){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const j=C?C.findDEMTileFor(d):null;if(!(j&&j.dem||I))return;C&&j&&j.dem&&y.selfDEMTileTimestamp!==j.dem._timestamp&&(y.borderDoneWithNeighborZ=[-1,-1,-1,-1],y.selfDEMTileTimestamp=j.dem._timestamp);const z=_e=>new r.P(Math.ceil((_e+r.ec)*r.ed),0),$=_e=>{const Se=o.getSource().minzoom,Pe=We=>{const Ne=o.getTileByID(We);if(Ne&&Ne.hasData())return Ne.getBucket(S)},Ee=[0,-1,1];for(const We of Ee){if(_e.overscaledZ+We<Se)continue;const Ne=Pe(_e.calculateScaledKey(_e.overscaledZ+We));if(Ne)return Ne}},q=[0,0,0],ee=(_e,Se)=>(q[0]=Math.min(_e.min.y,Se.min.y),q[1]=Math.max(_e.max.y,Se.max.y),q[2]=r.al-Se.min.x>_e.max.x?Se.min.x-r.al:_e.max.x,q),Q=(_e,Se)=>(q[0]=Math.min(_e.min.x,Se.min.x),q[1]=Math.max(_e.max.x,Se.max.x),q[2]=r.al-Se.min.y>_e.max.y?Se.min.y-r.al:_e.max.y,q),ie=[(_e,Se)=>ee(_e,Se),(_e,Se)=>ee(Se,_e),(_e,Se)=>Q(_e,Se),(_e,Se)=>Q(Se,_e)],le=(_e,Se,Pe,Ee,We,Ne,Xe)=>{if(!C)return 0;const ze=[[Ne?Pe:_e,Ne?_e:Pe,0],[Ne?Pe:Se,Ne?Se:Pe,0]],De=Xe<0?r.al+Xe:Xe,Qe=[Ne?De:(_e+Se)/2,Ne?(_e+Se)/2:De,0];return Pe===0&&Xe<0||Pe!==0&&Xe>0?C.getForTilePoints(We,[Qe],!0,Ee):ze.push(Qe),C.getForTilePoints(d,ze,!0,j),Math.max(ze[0][2],ze[1][2],Qe[2])/C.exaggeration()};for(let _e=0;_e<4;_e++){const Se=y.borderFeatureIndices[_e];if(Se.length===0)continue;const Pe=r.e8[_e](d),Ee=$(Pe);if(!(Ee&&Ee instanceof r.e9))continue;const We=C?C.findDEMTileFor(Pe):null;if(!(We&&We.dem||I)||(C&&We&&We.dem&&y.borderDEMTileTimestamp[_e]!==We.dem._timestamp&&(y.borderDoneWithNeighborZ[_e]=-1,y.borderDEMTileTimestamp[_e]=We.dem._timestamp),y.borderDoneWithNeighborZ[_e]===Ee.canonical.z))continue;Ee.centroidVertexArray.length===0&&Ee.createCentroidsBuffer();const Ne=(_e<2?1:5)-_e,Xe=Ee.borderDoneWithNeighborZ[Ne]!==y.canonical.z,ze=Ee.borderFeatureIndices[Ne];let De=0;if(y.canonical.z!==Ee.canonical.z){for(const Qe of Se)y.showCentroid(y.featuresOnBorder[Qe]);if(Xe)for(const Qe of ze)Ee.showCentroid(Ee.featuresOnBorder[Qe]);y.borderDoneWithNeighborZ[_e]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[Ne]=y.canonical.z}for(const Qe of Se){const dt=y.featuresOnBorder[Qe],lt=y.centroidData[dt.centroidDataIndex],Lt=dt.borders[_e];let Tt;for(;De<ze.length;){Tt=Ee.featuresOnBorder[ze[De]];const Gt=Tt.borders[Ne];if(Gt[1]>Lt[0]+3||Gt[0]>Lt[0]-3)break;Ee.showCentroid(Tt),De++}if(Tt&&De<ze.length){const Gt=De;let hn=0;for(;!(Tt.borders[Ne][0]>Lt[1]-3)&&(hn++,++De!==ze.length);)Tt=Ee.featuresOnBorder[ze[De]];Tt=Ee.featuresOnBorder[ze[Gt]];let mt=!1;if(hn>=1){const Mt=Tt.borders[Ne];Math.abs(Lt[0]-Mt[0])<3&&Math.abs(Lt[1]-Mt[1])<3&&(hn=1,mt=!0,De=Gt+1)}else if(hn===0){y.showCentroid(dt);continue}const rt=Ee.centroidData[Tt.centroidDataIndex];I&&mt&&(((de=lt).flags|(be=rt).flags)&r.eb?(de.flags|=r.eb,be.flags|=r.eb):(de.flags&=~r.eb,be.flags&=~r.eb));const zt=dt.intersectsCount()>1||Tt.intersectsCount()>1;if(hn>1)De=Gt,lt.centroidXY=rt.centroidXY=new r.P(0,0);else if(We&&We.dem&&!zt){const Mt=ie[_e](lt,rt),Jt=_e%2?r.al-1:0,_n=le(Mt[0],Math.min(r.al-1,Mt[1]),Jt,We,Pe,_e<2,Mt[2]);lt.centroidXY=rt.centroidXY=z(_n)}else zt?lt.centroidXY=rt.centroidXY=new r.P(0,0):(lt.centroidXY=y.encodeBorderCentroid(dt),rt.centroidXY=Ee.encodeBorderCentroid(Tt));y.writeCentroidToBuffer(lt),Ee.writeCentroidToBuffer(rt)}else y.showCentroid(dt)}y.borderDoneWithNeighborZ[_e]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[Ne]=y.canonical.z}var de,be;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const ec=[1,0,0],pr=[0,1,0],Nh=[0,0,1];function zf(g,o,d){const y=d.transform,S=d.shadowRenderer;if(!S)return!0;const C=g.toUnwrapped(),I=y.tileSize*S._cascades[d.currentShadowCascade].scale;let j=o;if(y.elevation){const de=y.elevation.getMinMaxForTile(g);de&&(j+=de.max)}const z=[...S.shadowDirection];z[2]=-z[2];const $=S.computeSimplifiedTileShadowVolume(C,j,I,z);if(!$)return!1;const q=[ec,pr,Nh,z,[z[0],0,z[2]],[0,z[1],z[2]]],ee=y.projection.name==="globe",Q=y.scaleZoom(I),ie=r.cA.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,Q,!ee),le=S.getCurrentCascadeFrustum();return ie.intersectsPrecise($.vertices,$.planes,q)===0||le.intersectsPrecise($.vertices,$.planes,q)===0}function au(g){const{painter:o,source:d,layer:y,coords:S}=g;let C=g.defines;const I=o.context,j=o.renderPass==="shadow",z=o.renderPass==="light-beam",$=o.shadowRenderer,q=r.ee(o.transform.center.lat,o.transform.zoom),ee=_c(o,y.paint.get("building-cutoff-fade-range"));ee.shouldRenderCutoff&&(C=C.concat("RENDER_CUTOFF")),g.floodLightIntensity>0&&(C=C.concat("FLOOD_LIGHT"));for(const Q of S){const ie=d.getTile(Q),le=ie.getBucket(y);if(!le)continue;$&&$.getMaxCascadeForTile(Q.toUnwrapped())===0&&(C=C.concat("SHADOWS_SINGLE_CASCADE"));const de=le.programConfigurations.get(y.id);let be,_e,Se,Pe=o.translatePosMatrix(Q.expandedProjMatrix,ie,[0,0],"map");if(Pe=r.cR(r.bB(),Pe,[1,1,g.verticalScale]),j&&$){if(zf(ie.tileID,le.maxHeight*q,o))continue;let We=$.calculateShadowPassMatrixFromTile(ie.tileID.toUnwrapped());We=r.cR(r.bB(),We,[1,1,g.verticalScale]),Se=hl(We),be=_e=o.getOrCreateProgram("buildingDepth",{config:de,defines:C,overrideFog:!1})}else if(z)be=_e=o.getOrCreateProgram("buildingBloom",{config:de,defines:C,overrideFog:!1}),Se=Ua(Pe);else{const We=o.transform.calculatePosMatrix(Q.toUnwrapped(),o.transform.worldSize);r.cR(We,We,[1,1,g.verticalScale]);const Ne=r.bB();r.cR(Ne,We,[1,-1,1/q]),r.bk(Ne,Ne),r.ef(Ne,Ne);const Xe=o.transform.getFreeCameraOptions().position,ze=1<<Q.canonical.z;if(Se=Yp(Pe,Ne,g.opacity,g.facadeAOIntensity,[((Xe.x-Q.wrap)*ze-Q.canonical.x)*r.al,(Xe.y*ze-Q.canonical.y)*r.al,Xe.z*ze*r.al],le.tileToMeter,g.facadeEmissiveChance,g.floodLightColor,g.floodLightIntensity),_e=o.getOrCreateProgram("building",{config:de,defines:C,overrideFog:!1}),g.depthOnly===!0)be=_e;else{const De=C.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);be=o.getOrCreateProgram("building",{config:de,defines:De,overrideFog:!1})}$&&($.setupShadowsFromMatrix(We,_e,!0),be!==_e&&$.setupShadowsFromMatrix(We,be,!0))}const Ee=(We,Ne)=>{if(z){const Xe=We.entranceBloom;Ne.draw(o,I.gl.TRIANGLES,g.depthMode,Cr.disabled,g.blendMode,Dr.disabled,Se,y.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segmentsBucket,y.paint,o.transform.zoom,de,[Xe.layoutAttenuationBuffer,Xe.layoutColorBuffer])}else{const Xe=We.segmentsBucket;let ze=[We.layoutNormalBuffer,We.layoutCentroidBuffer,We.layoutColorBuffer,We.layoutFloodLightDataBuffer];We.layoutFacadePaintBuffer&&(ze=ze.concat([We.layoutFacadeDataBuffer,We.layoutFacadeVerticalRangeBuffer,We.layoutFacadePaintBuffer])),Ne.draw(o,I.gl.TRIANGLES,g.depthMode,Cr.disabled,g.blendMode,j?Dr.disabled:Dr.backCW,Se,y.id,We.layoutVertexBuffer,We.indexBuffer,Xe,y.paint,o.transform.zoom,de,ze)}};o.uploadCommonUniforms(I,_e,Q.toUnwrapped(),null,ee),le.buildingWithoutFacade&&Ee(le.buildingWithoutFacade,_e),le.buildingWithFacade&&(be!==_e&&o.uploadCommonUniforms(I,be,Q.toUnwrapped(),null,ee),Ee(le.buildingWithFacade,be))}}function Uf(g,o,d,y,S,C,I,j,z,$,q,ee,Q){const ie=g.context.gl,le=g.depthModeForSublayer(1,Xn.ReadOnly,ie.LEQUAL,!0),de=.1*(1-(be=q))+3*be;var be;const _e=g._showOverdrawInspector,Se=ee,Pe=new Pg;_e||Jl(Pe,g,o,d,y,le,new Cr({func:ie.ALWAYS,mask:255},255,255,ie.KEEP,ie.KEEP,ie.REPLACE),new si([ie.ONE,ie.ONE,ie.ONE,ie.ONE],r.ao.transparent,[!1,!1,!1,!0],ie.MIN),Dr.disabled,S,"sdf",C,I,j,z,$,de,Se,!1);{const Ee=_e?Cr.disabled:new Cr({func:ie.EQUAL,mask:255},255,255,ie.KEEP,ie.DECR,ie.DECR),We=_e?g.colorModeForRenderPass():new si([ie.ONE_MINUS_DST_ALPHA,ie.DST_ALPHA,ie.ONE,ie.ONE],r.ao.transparent,[!0,!0,!0,!0]);Jl(Pe,g,o,d,y,le,Ee,We,Dr.disabled,S,"color",C,I,j,z,$,de,Se,!1)}}function Bd(g){return[g[0]*r.eg,g[1]*r.eg,g[2]*r.eg,0]}function Rg(g,o,d,y,S,C,I,j,z){const $=y.getSource(),q=d.globeSharedBuffers;if(!q)return;let ee,Q,ie;if(o&&(ee=y.getTile(o)),$ instanceof r.aT?(Q=$.texture,ie=r.dJ(0,0,d.transform)):ee&&o&&(Q=ee.texture,ie=r.dJ(o.canonical.z,o.canonical.x,d.transform)),!Q||!ie)return;g||(ie=r.cR(r.bB(),ie,[1,-1,1]));const le=d.context,de=le.gl,be=S.paint.get("raster-resampling")==="nearest"?de.NEAREST:de.LINEAR,_e=d.colorModeForDrapableLayerRenderPass(C),Se=I.defines;Se.push("GLOBE_POLES");const Pe=new Xn(de.LEQUAL,Xn.ReadWrite,d.depthRangeFor3D),Ee=Float32Array.from(d.transform.expandedFarZProjMatrix),We=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),le.activeTexture.set(de.TEXTURE0),Q.bind(be,de.CLAMP_TO_EDGE),le.activeTexture.set(de.TEXTURE1),Q.bind(be,de.CLAMP_TO_EDGE),"useMipmap"in Q&&le.extTextureFilterAnisotropic&&d.transform.pitch>20&&de.texParameterf(de.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Ne,Xe,ze,De]=o?q.getPoleBuffers(o.canonical.z,!1):q.getPoleBuffers(0,!0),Qe=S.paint.get("raster-elevation");let dt;g?(dt=Ne,d.renderDefaultNorthPole=Qe!==0):(dt=Xe,d.renderDefaultSouthPole=Qe!==0);const lt=Bd(I.mix),Lt=((Gt,hn,mt,rt,zt,Mt,Jt,_n,Vn,fn,yn,$n,On)=>Df(Gt,hn,mt,new Float32Array(16),new Float32Array(9),[0,0],rt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Mt,[0,0],_n,2,fn,yn,$n,1,0,On))(Ee,We,ie,r.aj(d.transform.zoom),0,S,0,Qe,0,lt,I.offset,I.range,C),Tt=d.getOrCreateProgram("raster",{defines:Se});d.uploadCommonUniforms(le,Tt,null),Tt.draw(d,de.TRIANGLES,Pe,z,_e,j,Lt,S.id,dt,ze,De)}function Ng(g){const o=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-o,S=.2*g.height,C=o+S;return[o,d,(C-S-o)/y,(C-o)/y]}function yo(g,o,d,y){if(g)return o instanceof Gs&&g instanceof $l?o.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:Bd(y.mix),offset:y.offset,buffer:0,tileSize:1}}var jg=r.eh([{name:"a_index",type:"Int16",components:1}]);class Ta{constructor(o,d,y,S){const C={width:y[0],height:y[1],data:null},I=o.gl;this.targetColorTexture=new r.T(o,C,I.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(o,C,I.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(d,S),this.lastInvalidatedAt=0}updateParticleTexture(o,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,S=d.width*d.height;this.particleTexture0=new r.T(this.context,d,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,d,y.RGBA8,{premultiply:!1,useMipmap:!1});const C=new r.ei;C.reserve(S);for(let I=0;I<S;I++)C.emplaceBack(I);this.particleIndexBuffer=this.context.createVertexBuffer(C,jg.members,!0),this.particleSegment=r.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function sm(g,o,d){if(!g)return null;const y=o.getTextureDescriptor(g,d,!0);if(!y)return null;let{texture:S,mix:C,offset:I,tileSize:j,buffer:z,format:$}=y;if(!S||!$)return null;let q=!1;return $==="uint32"&&(q=!0,C[3]=0,C=jf(r.ej,C,[0,d.paint.get("raster-particle-max-speed")]),I=Ac(r.ej,I,[0,d.paint.get("raster-particle-max-speed")])),{texture:S,textureOffset:[z/(j+2*z),j/(j+2*z)],tileSize:j,scalarData:q,scale:C,offset:I,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[$]]}}function $o(g){const o=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-o,S=.2*g.height,C=o+S;return[o,d,(C-S-o)/y,(C-o)/y]}const lu=new r.ao(1,0,0,1),zd=new r.ao(0,1,0,1),uo=new r.ao(0,0,1,1),Ro=new r.ao(1,0,1,1),Uo=new r.ao(0,1,1,1);function Vf(g,o,d,y,S,C){for(let I=0;I<d.length;I++)if(S){const $=new r.ao(y.r*.8,y.g*.8,y.b*.8,1);na(g,o,d[I],y,-1,-1,C),na(g,o,d[I],y,-1,1,C),na(g,o,d[I],y,1,1,C),na(g,o,d[I],y,1,-1,C),na(g,o,d[I],$,0,0,C)}else na(g,o,d[I],y,0,0,C)}function na(g,o,d,y,S,C,I){const j=g.context,z=g.transform,$=j.gl,q=z.projection.name==="globe",ee=q?["PROJECTION_GLOBE_VIEW"]:[];let Q=r.by(d.projMatrix);if(q&&r.aj(z.zoom)>0){const lt=r.bi(d.canonical,z),Lt=r.ek(lt);Q=r.aB(new Float32Array(16),z.globeMatrix,Lt),r.aB(Q,z.projMatrix,Q)}const ie=r.bB();ie[12]+=2*S/(r.o.devicePixelRatio*z.width),ie[13]+=2*C/(r.o.devicePixelRatio*z.height),r.aB(Q,ie,Q);const le=g.getOrCreateProgram("debug",{defines:ee}),de=o.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(de,le);const be=Xn.disabled,_e=Cr.disabled,Se=g.colorModeForRenderPass(),Pe="$debug";j.activeTexture.set($.TEXTURE0),g.emptyTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),q?de._makeGlobeTileDebugBuffers(g.context,z):de._makeDebugTileBoundsBuffers(g.context,z.projection);const Ee=de._tileDebugBuffer||g.debugBuffer,We=de._tileDebugIndexBuffer||g.debugIndexBuffer,Ne=de._tileDebugSegments||g.debugSegments;if(le.draw(g,$.LINE_STRIP,be,_e,Se,Dr.disabled,Il(Q,y.toPremultipliedRenderColor(null)),Pe,Ee,We,Ne,null,null,null,[de._globeTileDebugBorderBuffer]),I){const lt=de.latestRawTileData,Lt=Math.floor((lt&&lt.byteLength||0)/1024);let Tt=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Tt+=` => ${d.overscaledZ}`),Tt+=` ${de.state}`,Tt+=` ${Lt}kb`,(function(Gt,hn){Gt.initDebugOverlayCanvas();const mt=Gt.debugOverlayCanvas,rt=Gt.context.gl,zt=Gt.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,mt.width,mt.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(hn,5,5),zt.strokeText(hn,5,5),Gt.debugOverlayTexture.update(mt),Gt.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)})(g,Tt)}const Xe=o.getTile(d).tileSize,ze=512/Math.min(Xe,512)*(d.overscaledZ/z.zoom)*.5,De=de._tileDebugTextBuffer||g.debugBuffer,Qe=de._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,dt=de._tileDebugTextSegments||g.debugSegments;le.draw(g,$.TRIANGLES,be,_e,si.alphaBlended,Dr.disabled,Il(Q,r.ao.transparent.toPremultipliedRenderColor(null),ze),Pe,De,Qe,dt,null,null,null,[de._globeTileDebugTextBuffer])}function rs(g,o,d,y){No(g,0,o+d/2,g.transform.width,d,y)}function om(g,o,d,y){No(g,o-d/2,0,d,g.transform.height,y)}function No(g,o,d,y,S,C){const I=g.context,j=I.gl;j.enable(j.SCISSOR_TEST),j.scissor(o*r.o.devicePixelRatio,d*r.o.devicePixelRatio,y*r.o.devicePixelRatio,S*r.o.devicePixelRatio),I.clear({color:C}),j.disable(j.SCISSOR_TEST)}const Dg=r.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lg}=Dg;function Cc(g,o,d,y){g.emplaceBack(o,d,y)}class tc{constructor(o){this.vertexArray=new r.el,this.indices=new r.b0,Cc(this.vertexArray,-1,-1,1),Cc(this.vertexArray,1,-1,1),Cc(this.vertexArray,-1,1,1),Cc(this.vertexArray,1,1,1),Cc(this.vertexArray,-1,-1,-1),Cc(this.vertexArray,1,-1,-1),Cc(this.vertexArray,-1,1,-1),Cc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Lg),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.bf.simpleSegment(0,0,36,12)}}function xo(g,o,d,y,S,C){const I=g.context.gl,j=o.paint.get("sky-atmosphere-color"),z=o.paint.get("sky-atmosphere-halo-color"),$=o.paint.get("sky-atmosphere-sun-intensity"),q=((ee,Q,ie,le,de)=>({u_matrix_3f:ee,u_sun_direction:Q,u_sun_intensity:ie,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[de.r,de.g,de.b,de.a],u_luminance:5e-5}))(r.en(r.dN(),y),S,$,j.toPremultipliedRenderColor(null),z.toPremultipliedRenderColor(null));I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,o.skyboxTexture,0),d.draw(g,I.TRIANGLES,Xn.disabled,Cr.disabled,si.unblended,Dr.frontCW,q,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Mc=r.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dn{constructor(o){const d=new r.eo;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new r.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(d,Mc.members),this.indexBuffer=o.createIndexBuffer(y),this.segments=r.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pn=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ns{constructor(o){this.colorModeAlphaBlendedWriteRGB=new si([1,$s,1,$s],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new si([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new jh,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(o){const d=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dn(d);const y=this.params.sizeRange,S=this.params.intensityRange,C=(function(q){const ee=r.eq(30),Q=[];for(let ie=0;ie<q;++ie){const le=2*Math.PI*ee(),de=Math.acos(1-2*ee())-.5*Math.PI;Q.push(r.d4(Math.cos(de)*Math.cos(le),Math.cos(de)*Math.sin(le),Math.sin(de)))}return Q})(this.params.starsCount),I=r.eq(300),j=new r.ep,z=new r.b0;let $=0;for(let q=0;q<C.length;++q){const ee=r.c4([],C[q],200),Q=Math.max(0,1+.01*y*(1*I()-.5)),ie=Math.max(0,1+.01*S*(1*I()-.5));j.emplaceBack(ee[0],ee[1],ee[2],-1,-1,Q,ie),j.emplaceBack(ee[0],ee[1],ee[2],1,-1,Q,ie),j.emplaceBack(ee[0],ee[1],ee[2],1,1,Q,ie),j.emplaceBack(ee[0],ee[1],ee[2],-1,1,Q,ie),z.emplaceBack($+0,$+1,$+2),z.emplaceBack($+0,$+2,$+3),$+=4}this.starsVx=d.createVertexBuffer(j,Pn.members),this.starsIdx=d.createIndexBuffer(z),this.starsSegments=r.bf.simpleSegment(0,0,j.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,d){const y=o.context,S=y.gl,C=o.transform,I=new Xn(S.LEQUAL,Xn.ReadOnly,[0,1]),j=r.aj(C.zoom),z=o.style.getLut(d.scope),$=d.properties.get("color-use-theme")==="none",q=d.properties.get("color").toNonPremultipliedRenderColor($?null:z),ee=d.properties.get("high-color-use-theme")==="none",Q=d.properties.get("high-color").toNonPremultipliedRenderColor(ee?null:z),ie=d.properties.get("space-color-use-theme")==="none",le=d.properties.get("space-color").toNonPremultipliedRenderColor(ie?null:z),de=5e-4,be=r.er(d.properties.get("horizon-blend"),0,1,de,.25),_e=r.dD(o,y,C)&&be===de?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,Se=o.frameCounter/1e3%1,Pe=r.ag(C.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Pe,2)-Math.pow(_e,2)),We=Math.acos(Ee/Pe),Ne=Xe=>{const ze=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Xe&&ze.push("ALPHA_PASS");const De=o.getOrCreateProgram("globeAtmosphere",{defines:ze}),Qe=((lt,Lt,Tt,Gt,hn,mt,rt,zt,Mt,Jt,_n,Vn)=>({u_frustum_tl:lt,u_frustum_tr:Lt,u_frustum_br:Tt,u_frustum_bl:Gt,u_horizon:hn,u_transition:mt,u_fadeout_range:rt,u_atmosphere_fog_color:zt.toArray01(),u_high_color:Mt.toArray01(),u_space_color:Jt.toArray01(),u_temporal_offset:_n,u_horizon_angle:Vn}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,j,be,q,Q,le,Se,We);o.uploadCommonUniforms(y,De);const dt=this.atmosphereBuffer;dt&&De.draw(o,S.TRIANGLES,I,Cr.disabled,Xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dr.backCW,Qe,Xe?"atmosphere_glow_alpha":"atmosphere_glow",dt.vertexBuffer,dt.indexBuffer,dt.segments)};Ne(!1),Ne(!0)}drawStars(o,d){const y=r.aA(d.properties.get("star-intensity"),0,1);if(y===0)return;const S=o.context,C=S.gl,I=o.transform,j=o.getOrCreateProgram("stars"),z=r.c6([]);r.c8(z,z,-I._pitch),r.c7(z,z,-I.angle),r.c8(z,z,r.an(I._center.lat)),r.es(z,z,-r.an(I._center.lng));const $=r.cb(new Float32Array(16),z),q=r.aB([],I.starsProjMatrix,$),ee=r.en([],$),Q=r.et([],ee),ie=[0,1,0];r.dP(ie,ie,Q),r.c4(ie,ie,this.params.sizeMultiplier);const le=[1,0,0];r.dP(le,le,Q),r.c4(le,le,this.params.sizeMultiplier);const de=(be=ie,_e=le,Se=y,{u_matrix:Float32Array.from(q),u_up:be,u_right:_e,u_intensity_multiplier:Se});var be,_e,Se;o.uploadCommonUniforms(S,j),this.starsVx&&this.starsIdx&&j.draw(o,C.TRIANGLES,Xn.disabled,Cr.disabled,this.colorModeAlphaBlendedWriteRGB,Dr.disabled,de,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ft{constructor(){this.visibleTiles=[]}updateBorders(o,d){const y=[],S=[],C=o._getRenderableCoordinates(!1,!0);for(const z of C){const $=o.getTile(z);if(!$.hasData())continue;const q=$.getBucket(d);q&&(q.isEmpty()||(y.push(z.key),S.push({bucket:q,tileID:z.canonical})))}let I=y.length!==this.visibleTiles.length;if(!I){y.sort();for(let z=0;z<y.length;z++)if(y[z]!==this.visibleTiles[z]){I=!0;break}}if(!I)return;const j=new Set;this.visibleTiles=y,S.sort(((z,$)=>z.tileID.z-$.tileID.z||z.tileID.x-$.tileID.x||z.tileID.y-$.tileID.y));for(const z of S){const $=new Array,q=new Array,ee=z.bucket;for(const Q of ee.featuresOnBorder)j.has(Q.featureId)?q.push(Q.footprintIndex):(j.add(Q.featureId),$.push(Q.footprintIndex));ee.updateFootprintHiddenFlags($,r.eu,!1),ee.updateFootprintHiddenFlags(q,r.eu,!0)}}}function Og(g,o){const d=[...g],y=o.cameraWorldSizeForFog/o.worldSize,S=r.bz([]);return r.cR(S,S,[y,y,1]),r.aB(d,S,d),r.aB(d,o.worldToFogMatrix,d),d}function Dh(g,o,d,y,S){const C=d.material,I=y.context,{baseColorTexture:j,metallicRoughnessTexture:z}=C.pbrMetallicRoughness,{normalTexture:$,occlusionTexture:q,emissionTexture:ee}=C;function Q(le,de,be){if(le&&(g.push(de),I.activeTexture.set(I.gl.TEXTURE0+be),le.gfxTexture)){const{minFilter:_e,magFilter:Se,wrapS:Pe,wrapT:Ee}=le.sampler;le.gfxTexture.bindExtraParam(_e,Se,Pe,Ee)}}Q(j,"HAS_TEXTURE_u_baseColorTexture",go.BaseColor),Q(z,"HAS_TEXTURE_u_metallicRoughnessTexture",go.MetallicRoughness),Q($,"HAS_TEXTURE_u_normalTexture",go.Normal),Q(q,"HAS_TEXTURE_u_occlusionTexture",go.Occlusion),Q(ee,"HAS_TEXTURE_u_emissionTexture",go.Emission),S&&(S.texture||(S.texture=new r.d_(y.context,S.image,[S.image.height,S.image.height,S.image.height],I.gl.RGBA8)),I.activeTexture.set(I.gl.TEXTURE0+go.LUT),S.texture&&S.texture.bind(I.gl.LINEAR,I.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(d.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||g.push("DIFFUSE_SHADED");const ie=y.shadowRenderer;ie&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ie.useNormalOffset&&g.push("NORMAL_OFFSET"))}function Lh(g,o,d,y,S,C){const I=d.paint.get("model-opacity").constantOr(1),j=o.context,z=new Xn(o.context.gl.LEQUAL,g.isLightMesh?Xn.ReadOnly:Xn.ReadWrite,o.depthRangeFor3D),$=o.transform,q=g.mesh,ee=q.material,Q=ee.pbrMetallicRoughness,ie=o.style.fog;let le;le=o.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:r.aB([],y.zScaleMatrix,g.nodeModelMatrix),r.aB(le,y.negCameraPosMatrix,le);const de=r.bk([],le);r.ef(de,de);const be=d.paint.get("model-color-use-theme").constantOr("default")==="none",_e=d.paint.get("model-emissive-strength").constantOr(0),Se=nm(new Float32Array(g.worldViewProjection),new Float32Array(le),new Float32Array(de),null,o,I,Q.baseColorFactor,ee.emissiveFactor,Q.metallicFactor,Q.roughnessFactor,ee,_e,d,void 0,void 0,g.materialOverride,g.modelColor),Pe={defines:[]},Ee=[],We=o.shadowRenderer;We&&(We.useNormalOffset=!1),Dh(Pe.defines,Ee,q,o,be?null:d.lut);let Ne=null;if(ie){const De=Og(g.nodeModelMatrix,o.transform);if(Ne=new Float32Array(De),$.projection.name!=="globe"){const Qe=q.aabb.min,dt=q.aabb.max,[lt,Lt]=ie.getOpacityForBounds(De,Qe[0],Qe[1],dt[0],dt[1]);Pe.overrideFog=lt>=Ct||Lt>=Ct}}const Xe=_c(o,d.paint.get("model-cutoff-fade-range"));Xe.shouldRenderCutoff&&Pe.defines.push("RENDER_CUTOFF");const ze=o.getOrCreateProgram("model",Pe);o.uploadCommonUniforms(j,ze,null,Ne,Xe),o.renderPass!=="shadow"&&We&&We.setupShadowsFromMatrix(g.nodeModelMatrix,ze),ze.draw(o,j.gl.TRIANGLES,z,S,C,q.material.doubleSided?Dr.disabled:Dr.backCCW,Se,d.id,q.vertexBuffer,q.indexBuffer,q.segments,d.paint,o.transform.zoom,void 0,Ee)}function am(g,o,d){return g.type==="vector"?o.scope:d?"basemap":""}function lm(g,o,d,y,S,C,I,j,z){const $=g.transform,q=!!o.isGeometryBloom&&o.isGeometryBloom;if(q&&g.renderPass==="shadow")return;const ee=$.projection.name==="globe"?r.eC(d,$):[...d];r.aB(ee,ee,o.globalMatrix);const Q=r.aB([],y,ee);if(o.meshes)for(const ie of o.meshes){const le=j.get(ie.material.name);if(le&&le.opacity<=0)continue;if(ie.material.alphaMode!=="BLEND"){I.push({mesh:ie,depth:0,modelIndex:S,worldViewProjection:Q,nodeModelMatrix:ee,isLightMesh:q,materialOverride:le,modelColor:z});continue}const de=r.af([],ie.centroid,Q);!$.isOrthographic&&de[2]<=0||C.push({mesh:ie,depth:de[2],modelIndex:S,worldViewProjection:Q,nodeModelMatrix:ee,isLightMesh:q,materialOverride:le,modelColor:z})}if(o.children)for(const ie of o.children)lm(g,ie,d,y,S,C,I,j,z)}function cu(g,o,d,y){const S=d.shadowRenderer;if(!S)return;const C=S.getShadowPassDepthMode(),I=S.getShadowPassColorMode(),j=S.calculateShadowPassMatrixFromMatrix(o),z=Bu(j);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,C,Cr.disabled,I,Dr.disabled,z,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,d.transform.zoom,void 0,void 0)}function Oh(g,o,d,y,S,C){for(const I of S){const j=Object.assign({},y);j.part=I;const z={type:"Unknown",id:o,properties:j},$={orientation:g.paint.get("model-rotation").evaluate(z,d)};C.set(I,$)}}function Fg(g,o,d,y,S,C){for(const I of S){const j=Object.assign({},y);j.part=I;const z={type:"Unknown",id:o,properties:j},$={color:g.paint.get("model-color").evaluate(z,d),colorMix:g.paint.get("model-color-mix-intensity").evaluate(z,d),opacity:g.paint.get("model-opacity").evaluate(z,d),emissionStrength:g.paint.get("model-emissive-strength").evaluate(z,d)};C.set(I,$)}}function cm(g,o,d,y,S,C){if(d===1)for(const j of S)Lh(j,g,o,C[j.modelIndex],Cr.disabled,g.colorModeForRenderPass());else{for(const j of S)Lh(j,g,o,C[j.modelIndex],Cr.disabled,si.disabled);for(const j of S)Lh(j,g,o,C[j.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}const I=si.additive;for(const j of y)Lh(j,g,o,C[j.modelIndex],Cr.disabled,j.isLightMesh?I:g.colorModeForRenderPass())}function dy(g,o,d){const y=o.updateZoomBasedPaintProperties(),S=(function(C,I,j){let z,$,q,ee=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&ee>0){const Q=C.terrain,ie=Q.findDEMTileFor(j);ie&&ie.dem?z=r.eE.create(Q,j,ie):ee=0}if(ee===0&&(I.terrainElevationMin=0,I.terrainElevationMax=0),ee===I.validForExaggeration&&(ee===0||z&&z._demTile&&z._demTile.tileID===I.validForDEMTile.id&&z._dem._timestamp===I.validForDEMTile.timestamp))return!1;for(const Q in I.instancesPerModel){const ie=I.instancesPerModel[Q];for(let le=0;le<ie.instancedDataArray.length;++le){const de=(z?ee*z.getElevationAt(0|ie.instancedDataArray.float32[16*le],0|ie.instancedDataArray.float32[16*le+1],!0,!0):0)+ie.instancesEvaluatedElevation[le];ie.instancedDataArray.float32[16*le+6]=de,$=$?Math.min(I.terrainElevationMin,de):de,q=q?Math.max(I.terrainElevationMax,de):de}}return I.terrainElevationMin=$||0,I.terrainElevationMax=q||0,I.validForExaggeration=ee,I.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0})(g,o,d);(y||S)&&(o.uploaded=!1,o.upload(g.context))}const Ga={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function Bg(g,o){const d=1<<g.canonical.z,y=o.getFreeCameraOptions().position,S=o.elevation,C=g.canonical.x/d,I=(g.canonical.x+1)/d,j=g.canonical.y/d,z=(g.canonical.y+1)/d;let $=o._centerAltitude;if(S){const ie=S.getMinMaxForTile(g);ie&&ie.max>$&&($=ie.max)}const q=r.aA(y.x,C,I)-y.x,ee=r.aA(y.y,j,z)-y.y,Q=r.ce($,o.center.lat)-y.z;return o._zoomFromMercatorZ(Math.sqrt(q*q+ee*ee+Q*Q))}function zg(g,o,d,y,S,C,I){const j=g.context,z=g.renderPass==="shadow",$=g.shadowRenderer,q=z&&$?$.getShadowPassDepthMode():new Xn(j.gl.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D),ee=g.isTileAffectedByFog(C),Q=g.transform.projection.name==="globe";if(d.meshes)for(const ie of d.meshes){const le=Q?[]:["MODEL_POSITION_ON_GPU"],de=[];let be,_e,Se;const Pe=!Q&&y.instancedDataArray.length>20;Pe&&le.push("INSTANCED_ARRAYS");const Ee=_c(g,o.paint.get("model-cutoff-fade-range"));if(Ee.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),z&&$)be=g.getOrCreateProgram("modelDepth",{defines:le}),_e=Bu(I.shadowTileMatrix,I.shadowTileMatrix,Float32Array.from(d.globalMatrix)),Se=$.getShadowPassColorMode();else{Dh(le,de,ie,g,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),be=g.getOrCreateProgram("model",{defines:le,overrideFog:ee});const Ne=ie.material,Xe=Ne.pbrMetallicRoughness,ze=o.paint.get("model-opacity").constantOr(1),De=o.paint.get("model-emissive-strength").constantOr(0);_e=nm(C.expandedProjMatrix,Float32Array.from(d.globalMatrix),new Float32Array(16),null,g,ze,Xe.baseColorFactor,Ne.emissiveFactor,Xe.metallicFactor,Xe.roughnessFactor,Ne,De,o,S),$&&(I.shadowUniformsInitialized?be.setShadowUniformValues(j,$.getShadowUniformValues()):($.setupShadows(C.toUnwrapped(),be,"model-tile"),I.shadowUniformsInitialized=!0)),Se=Ee.shouldRenderCutoff||ze<1||Ne.alphaMode!=="OPAQUE"?si.alphaBlended:si.unblended}g.uploadCommonUniforms(j,be,C.toUnwrapped(),null,Ee);const We=ie.material.doubleSided?Dr.disabled:Dr.backCCW;if(Pe)de.push(y.instancedDataBuffer),be.draw(g,j.gl.TRIANGLES,q,Cr.disabled,Se,We,_e,o.id,ie.vertexBuffer,ie.indexBuffer,ie.segments,o.paint,g.transform.zoom,void 0,de,y.instancedDataArray.length);else{const Ne=z?"u_instance":"u_normal_matrix";for(let Xe=0;Xe<y.instancedDataArray.length;++Xe)_e[Ne]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Xe,16),be.draw(g,j.gl.TRIANGLES,q,Cr.disabled,Se,We,_e,o.id,ie.vertexBuffer,ie.indexBuffer,ie.segments,o.paint,g.transform.zoom,void 0,de)}}if(d.children)for(const ie of d.children)zg(g,o,ie,y,S,C,I)}const hy=[1,-1,1];function um(g,o,d,y){if(!d.modelManager)return!0;const S=d.modelManager;if(!d.shadowRenderer)return!0;const C=d.shadowRenderer,I=o.aabb;let j=!0,z=g.maxHeight;if(z===0){let q=0;for(const ee in g.instancesPerModel){const Q=S.getModel(ee,y);Q?q=Math.max(q,Math.max(Math.max(Q.aabb.max[0],Q.aabb.max[1]),Q.aabb.max[2])):j=!1}z=g.maxScale*q*1.41+g.maxVerticalOffset,j&&(g.maxHeight=z)}I.max[2]=z,I.min[2]+=g.terrainElevationMin,I.max[2]+=g.terrainElevationMax,r.af(I.min,I.min,o.tileMatrix),r.af(I.max,I.max,o.tileMatrix);const $=I.intersects(C.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=$===2),$===0}function Fh(g,o){const d=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],S=g.uniformValues.u_cutoff_params[2],C=g.uniformValues.u_cutoff_params[3];return y===d||C===S?1:r.aA(((o-d)/(y-d)-S)/(C-S),0,1)}function Ud(g,o,d,y){if(o.pitch<20)return 1;const S=o.getWorldToCameraMatrix();r.aB(S,S,g);const C=r.bT(d.min[0],d.min[1],d.min[2],1);let I=r.aC(r.eF(),C,S),j=I,z=I;C[1]=d.max[1],I=r.aC(r.eF(),C,S),j=I[1]<j[1]?I:j,z=I[1]>z[1]?I:z,C[0]=d.max[0],I=r.aC(r.eF(),C,S),j=I[1]<j[1]?I:j,z=I[1]>z[1]?I:z,C[1]=d.min[1],I=r.aC(r.eF(),C,S),j=I[1]<j[1]?I:j,z=I[1]>z[1]?I:z;const $=r.aA(y[0],0,1),q=100*o.pixelsPerMeter*r.aA(y[1],0,1),ee=r.aA(y[2],0,1),Q=r.eG(r.eF(),j,z,$),ie=Math.tan(.5*o.fovX),le=-Q[2]*ie;if(q===0)return Q[1]<-Math.abs(le)?ee:1;const de=(-Math.abs(le)-Q[1])/q,be=(Se,Pe,Ee)=>(1-Ee)*Se+Ee*Pe,_e=r.aA(be(1,ee,de),ee,1);return be(1,_e,r.aA((o.pitch-20)/20,0,1))}class fy{}class py{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,d,y){{const ee=this._storage.get(d.id);if(ee)return ee.lastUsedFrameIdx=o,ee.buf}const S=y.gl,C=S.getBufferParameter(S.ELEMENT_ARRAY_BUFFER,S.BUFFER_SIZE),I=new ArrayBuffer(C),j=new Int16Array(I);S.getBufferSubData(S.ELEMENT_ARRAY_BUFFER,0,new Int16Array(I));const z=new r.eI;for(let ee=0;ee<C/2;ee+=3){const Q=j[ee],ie=j[ee+1],le=j[ee+2];z.emplaceBack(Q,ie),z.emplaceBack(ie,le),z.emplaceBack(le,Q)}const $=y.bindVertexArrayOES.current,q=new fy;return q.buf=new Rl(y,z),q.lastUsedFrameIdx=o,this._storage.set(d.id,q),y.bindVertexArrayOES.set($),q.buf}update(o){for(const[d,y]of this._storage)o-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(d))}destroy(){for(const[o,d]of this._storage)d.buf.destroy(),this._storage.delete(o)}}class Pb{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const my=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Rb{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class pa{constructor(o,d){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...d,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...d,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const d_=r.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Hf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,d){const y=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const I=new r.eJ,j=new r.b0;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(1,1),I.emplaceBack(-1,1),j.emplaceBack(0,1,2),j.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(I,d_.members),this.vignetteIdx=o.context.createIndexBuffer(j)}const S=r.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,y);const I={u_vignetteShape:(C={vignetteShape:[d.start,d.range,Math.pow(10,d.fadePower)],vignetteColor:[d.color.r,d.color.g,d.color.b,d.color.a*d.strength]}).vignetteShape,u_vignetteColor:C.vignetteColor};y.draw(o,o.context.gl.TRIANGLES,Xn.disabled,Cr.disabled,si.alphaBlended,Dr.disabled,I,"vignette",this.vignetteVx,this.vignetteIdx,S)}var C}}class hs{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,d){const y=o.getFreeCameraOptions().position,S=y.toAltitude(),C=y.toLngLat(),I=r.an(C.lng),j=r.an(C.lat),z=o.pixelsPerMeter/d,$=I*r.eL,q=r.eL*Math.log(Math.tan(Math.PI/4+j/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ee=-this._offsetYPrev+q,Q=-this._elevationPrev+S;this._accumulatedOffsetX+=(-this._offsetXPrev+$)*z,this._accumulatedOffsetY+=ee*z,this._accumulatedElevation+=Q*z,this._offsetXPrev=$,this._offsetYPrev=q,this._elevationPrev=S}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function di(g,o){return[-(g[0]-Math.floor(g[0]/o)*o),-(g[1]-Math.floor(g[1]/o)*o),-(g[2]-Math.floor(g[2]/o)*o)]}function gy(g){const o=r.eq(1323123451230),d=[];for(let y=0;y<g;++y){const S=2*o()-1,C=2*o()-1,I=2*o()-1;d.push(r.d4(S,C,I))}return d}function $a(g,o,d,y,S){const C=r.aA((S-d)/(y-d),0,1);return(1-C)*g+C*o}class Bh{constructor(o){this._movement=new hs,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Hf,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,d){const y=o.transform;this._movement.update(y,this._ppmScaleFactor);const S=y.starsProjMatrix,C=r.c6([]);r.c8(C,C,r.an(90)-y._pitch),r.c7(C,C,-y.angle);const I=r.cb(new Float32Array(16),C),j=r.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=r.ef([],j),$=r.aB([],z,I),q=Date.now()/1e3;return this._accumulatedTimeFromStart+=(q-this._prevTime)*d,this._prevTime=q,{projectionMatrix:S,modelviewMatrix:$}}}class Ea extends Bh{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new pa(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const y=gy(this.particlesCount),S=new r.eM,C=new r.b0;let I=0;const j=r.eq(1323123451230);for(let z=0;z<y.length;++z){const $=y[z],q=[2*j()-1,j(),j(),j()];S.emplaceBack($[0],$[1],$[2],-1,-1,...q),S.emplaceBack($[0],$[1],$[2],1,-1,...q),S.emplaceBack($[0],$[1],$[2],1,1,...q),S.emplaceBack($[0],$[1],$[2],-1,1,...q),C.emplaceBack(I+0,I+1,I+2),C.emplaceBack(I+0,I+2,I+3),I+=4}this.particlesVx=d.createVertexBuffer(S,my.members),this.particlesIdx=d.createIndexBuffer(C)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const d=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=o.transform.zoom;if(d.revealStart>y)return;const S=$a(0,1,d.revealStart,d.revealStart+d.revealRange,y);if(!this.particlesVx||!this.particlesIdx)return;const C=structuredClone(this._params);let I=[-C.direction.x,C.direction.y,-100];r.aw(I,I);const j=structuredClone(this._vignetteParams);j.strength*=S,C.overrideStyleParameters||(C.intensity=o.style.rain.state.density,C.timeFactor=o.style.rain.state.intensity,C.color=structuredClone(o.style.rain.state.color),I=structuredClone(o.style.rain.state.direction),C.screenThinning.intensity=o.style.rain.state.centerThinning,C.dropletSizeX=o.style.rain.state.dropletSize[0],C.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],C.distortionStrength=100*o.style.rain.state.distortionStrength,j.strength=1,j.color=structuredClone(o.style.rain.state.vignetteColor));const z=this.updateOnRender(o,C.timeFactor),$=o.context,q=$.gl,ee=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new r.T($,{width:o.width,height:o.height,data:null},q.RGBA8)),C.distortionStrength>0&&($.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),q.copyTexSubImage2D(q.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Q=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms($,Q),$.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ie=[C.color.r,C.color.g,C.color.b,C.color.a],le=(de,be)=>{const _e=di(this._movement.getPosition(),de),Se=C.dropletSizeX,Pe=C.dropletSizeX*C.dropletSizeYScale,Ee=o.width/2,We=o.height/2,Ne=$a(0,C.screenThinning.start,0,1,C.screenThinning.intensity),Xe=$a(.001,C.screenThinning.range,0,1,C.screenThinning.intensity),ze=$a(0,C.screenThinning.particleOffset,0,1,C.screenThinning.intensity),De=(Qe={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:_e,velocityConeAperture:C.velocityConeAperture,velocity:C.velocity,boxSize:de,rainDropletSize:[Se,Pe],distortionStrength:C.distortionStrength,rainDirection:I,color:ie,screenSize:[ee.width,ee.height],thinningCenterPos:[Ee,We],thinningShape:[Ne,Xe,Math.pow(10,C.screenThinning.fadePower)],thinningAffectedRatio:C.screenThinning.affectedRatio,thinningParticleOffset:ze,shapeDirectionalPower:C.shapeDirPower,shapeNormalPower:C.shapeNormalPower,mode:be?0:1},{u_modelview:Float32Array.from(Qe.modelview),u_projection:Float32Array.from(Qe.projection),u_time:Qe.time,u_cam_pos:Qe.camPos,u_texScreen:0,u_velocityConeAperture:Qe.velocityConeAperture,u_velocity:Qe.velocity,u_boxSize:Qe.boxSize,u_rainDropletSize:Qe.rainDropletSize,u_distortionStrength:Qe.distortionStrength,u_rainDirection:Qe.rainDirection,u_color:Qe.color,u_screenSize:Qe.screenSize,u_thinningCenterPos:Qe.thinningCenterPos,u_thinningShape:Qe.thinningShape,u_thinningAffectedRatio:Qe.thinningAffectedRatio,u_thinningParticleOffset:Qe.thinningParticleOffset,u_shapeDirectionalPower:Qe.shapeDirectionalPower,u_shapeNormalPower:Qe.shapeNormalPower,u_mode:Qe.mode});var Qe;const dt=Math.round(C.intensity*this.particlesCount),lt=r.bf.simpleSegment(0,0,4*dt,2*dt);Q.draw(o,q.TRIANGLES,Xn.disabled,Cr.disabled,si.alphaBlended,Dr.disabled,De,"rain_particles",this.particlesVx,this.particlesIdx,lt)};C.distortionStrength>0&&le(C.boxSize,!0),le(C.boxSize,!1),this._vignette.draw(o,j)}}const kc=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Gf extends Bh{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new pa(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const y=gy(this.particlesCount),S=new r.eN,C=new r.b0;let I=0;const j=r.eq(1323123451230);for(let z=0;z<y.length;++z){const $=y[z],q=j(),ee=j(),Q=j(),ie=[z/y.length,q,ee,Q],le=[j(),j()];S.emplaceBack($[0],$[1],$[2],-1,-1,...ie,...le),S.emplaceBack($[0],$[1],$[2],1,-1,...ie,...le),S.emplaceBack($[0],$[1],$[2],1,1,...ie,...le),S.emplaceBack($[0],$[1],$[2],-1,1,...ie,...le),C.emplaceBack(I+0,I+1,I+2),C.emplaceBack(I+0,I+2,I+3),I+=4}this.particlesVx=d.createVertexBuffer(S,kc.members),this.particlesIdx=d.createIndexBuffer(C)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const d=structuredClone(this._params);let y=[-d.direction.x,d.direction.y,-100];r.aw(y,y);const S=structuredClone(this._vignetteParams),C=d.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},I=o.transform.zoom;if(C.revealStart>I)return;const j=$a(0,1,C.revealStart,C.revealStart+C.revealRange,I);S.strength*=j,d.overrideStyleParameters||(d.intensity=o.style.snow.state.density,d.timeFactor=o.style.snow.state.intensity,d.color=structuredClone(o.style.snow.state.color),y=structuredClone(o.style.snow.state.direction),d.screenThinning.intensity=o.style.snow.state.centerThinning,d.billboardSize=2.79*o.style.snow.state.flakeSize,S.strength=1,S.color=structuredClone(o.style.snow.state.vignetteColor));const z=this.updateOnRender(o,d.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const $=o.context,q=$.gl,ee=o.transform,Q=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms($,Q),((ie,le,de)=>{const be=di(this._movement.getPosition(),ie),_e=ee.width/2,Se=ee.height/2,Pe=$a(0,de.screenThinning.start,0,1,de.screenThinning.intensity),Ee=$a(.001,de.screenThinning.range,0,1,de.screenThinning.intensity),We=$a(0,de.screenThinning.particleOffset,0,1,de.screenThinning.intensity),Ne=(Xe={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:be,velocityConeAperture:de.velocityConeAperture,velocity:de.velocity,horizontalOscillationRadius:de.horizontalOscillationRadius,horizontalOscillationRate:de.horizontalOscillationRate,boxSize:ie,billboardSize:1*de.billboardSize,simpleShapeParameters:[de.shapeFadeStart,de.shapeFadePower],screenSize:[ee.width,ee.height],thinningCenterPos:[_e,Se],thinningShape:[Pe,Ee,Math.pow(10,de.screenThinning.fadePower)],thinningAffectedRatio:de.screenThinning.affectedRatio,thinningParticleOffset:We,color:[de.color.r,de.color.g,de.color.b,de.color.a],direction:y},{u_modelview:Float32Array.from(Xe.modelview),u_projection:Float32Array.from(Xe.projection),u_time:Xe.time,u_cam_pos:Xe.camPos,u_velocityConeAperture:Xe.velocityConeAperture,u_velocity:Xe.velocity,u_horizontalOscillationRadius:Xe.horizontalOscillationRadius,u_horizontalOscillationRate:Xe.horizontalOscillationRate,u_boxSize:Xe.boxSize,u_billboardSize:Xe.billboardSize,u_simpleShapeParameters:Xe.simpleShapeParameters,u_screenSize:Xe.screenSize,u_thinningCenterPos:Xe.thinningCenterPos,u_thinningShape:Xe.thinningShape,u_thinningAffectedRatio:Xe.thinningAffectedRatio,u_thinningParticleOffset:Xe.thinningParticleOffset,u_particleColor:Xe.color,u_direction:Xe.direction});var Xe;const ze=Math.round(de.intensity*this.particlesCount),De=r.bf.simpleSegment(0,0,4*ze,2*ze);this.particlesVx&&this.particlesIdx&&Q.draw(o,q.TRIANGLES,Xn.disabled,Cr.disabled,si.alphaBlended,Dr.disabled,Ne,"snow_particles",this.particlesVx,this.particlesIdx,De)})(d.boxSize,0,d),this._vignette.draw(o,S)}}const Ug={symbol:function(g,o,d,y,S){if(g.renderPass!=="translucent")return;const C=Cr.disabled,I=g.colorModeForRenderPass(),j=d.layout.get("text-variable-anchor"),z=d.layout.get("text-size-scale-range"),$=r.aA(g.scaleFactor,z[0],z[1]);j&&(function(Q,ie,le,de,be,_e,Se,Pe){const Ee=ie.transform,We=be==="map",Ne=_e==="map";for(const Xe of Q){const ze=de.getTile(Xe),De=ze.getBucket(le);if(!De||!De.text||!De.text.segments.get().length)continue;const Qe=r.bJ(De.textSizeData,Ee.zoom,Pe),dt=kp(Xe,De.getProjection(),Ee),lt=Ee.calculatePixelsToTileUnitsMatrix(ze),Lt=ku(dt,ze.tileID.canonical,Ne,We,Ee,De.getProjection(),lt),Tt=De.hasIconTextFit()&&De.hasIconData();Qe&&Kl(De,We,Ne,Se,Ee,Lt,Xe,Math.pow(2,Ee.zoom-ze.tileID.overscaledZ),Qe,Tt)}})(y,g,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),S,$);const q=d.paint.get("icon-opacity").constantOr(1)!==0,ee=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(q||ee)?Yl(g,o,d,y,C,I):(q&&Yl(g,o,d,y,C,I,{onlyIcons:!0}),ee&&Yl(g,o,d,y,C,I,{onlyText:!0})),o.map.showCollisionBoxes&&(Sa(g,o,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Sa(g,o,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,d,y){if(g.renderPass!=="translucent")return;const S=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),I=d.paint.get("circle-stroke-opacity"),j=d.layout.get("circle-sort-key").constantOr(1)!==void 0,z=d.paint.get("circle-emissive-strength");if(S.constantOr(1)===0&&(C.constantOr(1)===0||I.constantOr(1)===0))return;const $=g.context,q=$.gl,ee=g.transform,Q=!(!g.terrain||!g.terrain.enabled),ie=d.layout.get("circle-elevation-reference"),le=g.depthModeForSublayer(0,Xn.ReadOnly),de=new Xn(g.context.gl.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D),be=ie==="none"||Q?le:de,_e=Cr.disabled,Se=g.colorModeForDrapableLayerRenderPass(z),Pe=ee.projection.name==="globe",Ee=[r.aF(ee.center.lng),r.aJ(ee.center.lat)],We=[];for(let Xe=0;Xe<y.length;Xe++){const ze=y[Xe],De=o.getTile(ze),Qe=De.getBucket(d);if(!Qe||Qe.projection.name!==ee.projection.name)continue;const dt=Qe.programConfigurations.get(d.id),lt=Qe.layoutVertexBuffer,Lt=Qe.globeExtVertexBuffer,Tt=Qe.indexBuffer,Gt=r.d$(d),hn=[Lt],mt=g.isTileAffectedByFog(ze);Pe&&Gt.push("PROJECTION_GLOBE_VIEW"),Gt.push("DEPTH_D24"),g.terrain&&ee.depthOcclusionForSymbolsAndCircles&&Gt.push("DEPTH_OCCLUSION"),Qe.hasElevation&&!g.terrain&&(Gt.push("ELEVATED_ROADS"),hn.push(Qe.elevatedLayoutVertexBuffer));const rt=g.getOrCreateProgram("circle",{config:dt,defines:Gt,overrideFog:mt}),zt=ee.projection.createInversionMatrix(ee,ze.canonical),Mt={programConfiguration:dt,program:rt,layoutVertexBuffer:lt,dynamicBuffers:hn,indexBuffer:Tt,uniformValues:r.e0(g,ze,De,zt,Ee,d),tile:De};if(j){const Jt=Qe.segments.get();for(const _n of Jt)We.push({segments:new r.bf([_n]),sortKey:_n.sortKey,state:Mt})}else We.push({segments:Qe.segments,sortKey:0,state:Mt})}j&&We.sort(((Xe,ze)=>Xe.sortKey-ze.sortKey));const Ne={useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles};for(const Xe of We){const{programConfiguration:ze,program:De,layoutVertexBuffer:Qe,dynamicBuffers:dt,indexBuffer:lt,uniformValues:Lt,tile:Tt}=Xe.state,Gt=Xe.segments;g.terrain&&g.terrain.setupElevationDraw(Tt,De,Ne),g.uploadCommonUniforms($,De,Tt.tileID.toUnwrapped()),De.draw(g,q.TRIANGLES,be,_e,Se,Dr.disabled,Lt,d.id,Qe,lt,Gt,d.paint,ee.zoom,ze,dt)}},heatmap:function(g,o,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const S=g.context,C=S.gl,I=Cr.disabled,j=new si([C.ONE,C.ONE,C.ONE,C.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(ie,le,de,be){const _e=ie.gl,Se=le.width*be,Pe=le.height*be;ie.activeTexture.set(_e.TEXTURE1),ie.viewport.set([0,0,Se,Pe]);let Ee=de.heatmapFbo;if(!Ee||Ee&&(Ee.width!==Se||Ee.height!==Pe)){Ee&&Ee.destroy();const We=_e.createTexture();_e.bindTexture(_e.TEXTURE_2D,We),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),Ee=de.heatmapFbo=ie.createFramebuffer(Se,Pe,!0,null),(function(Ne,Xe,ze,De,Qe,dt){const lt=Ne.gl;lt.texImage2D(lt.TEXTURE_2D,0,Ne.extRenderToTextureHalfFloat?lt.RGBA16F:lt.RGBA,Qe,dt,0,lt.RGBA,Ne.extRenderToTextureHalfFloat?lt.HALF_FLOAT:lt.UNSIGNED_BYTE,null),De.colorAttachment.set(ze)})(ie,0,We,Ee,Se,Pe)}else _e.bindTexture(_e.TEXTURE_2D,Ee.colorAttachment.get()),ie.bindFramebuffer.set(Ee.framebuffer)})(S,g,d,g.transform.projection.name==="globe"?.5:.25),S.clear({color:r.ao.transparent});const z=g.transform,$=z.projection.name==="globe",q=$?["PROJECTION_GLOBE_VIEW"]:[],ee=$?Dr.frontCCW:Dr.disabled,Q=[r.aF(z.center.lng),r.aJ(z.center.lat)];for(let ie=0;ie<y.length;ie++){const le=y[ie];if(o.hasRenderableParent(le))continue;const de=o.getTile(le),be=de.getBucket(d);if(!be||be.projection.name!==z.projection.name)continue;const _e=g.isTileAffectedByFog(le),Se=be.programConfigurations.get(d.id),Pe=g.getOrCreateProgram("heatmap",{config:Se,defines:q,overrideFog:_e}),{zoom:Ee}=g.transform;g.terrain&&g.terrain.setupElevationDraw(de,Pe),g.uploadCommonUniforms(S,Pe,le.toUnwrapped());const We=z.projection.createInversionMatrix(z,le.canonical);Pe.draw(g,C.TRIANGLES,Xn.disabled,I,j,ee,ly(g,le,de,We,Q,Ee,d.paint.get("heatmap-intensity")),d.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,d.paint,g.transform.zoom,Se,$?[be.globeExtVertexBuffer]:null)}S.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),(function(S,C){const I=S.context,j=I.gl,z=C.heatmapFbo;if(!z)return;I.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,z.colorAttachment.get()),I.activeTexture.set(j.TEXTURE1);let $=C.colorRampTexture;$||($=C.colorRampTexture=new r.T(I,C.colorRamp,j.RGBA8)),$.bind(j.LINEAR,j.CLAMP_TO_EDGE),S.getOrCreateProgram("heatmapTexture").draw(S,j.TRIANGLES,Xn.disabled,Cr.disabled,S.colorModeForRenderPass(),Dr.disabled,((q,ee,Q,ie)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,C),C.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,C.paint,S.transform.zoom)})(g,d))},line:function(g,o,d,y){if(g.renderPass!=="translucent")return;const S=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(S.constantOr(1)===0||C.constantOr(1)===0)return;const I=d.paint.get("line-emissive-strength"),j=d.paint.get("line-occlusion-opacity"),z=d.layout.get("line-elevation-reference"),$=d.layout.get("line-width-unit")==="meters",q=z==="sea",ee=!(!g.terrain||!g.terrain.enabled),Q=g.context,ie=Q.gl;if(d.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const le=d.layout.get("line-cross-slope"),de=le!==void 0,be=le<1,_e=g.colorModeForDrapableLayerRenderPass(I),Se=g.terrain&&g.terrain.renderingToTexture,Pe=Se?1:r.o.devicePixelRatio,Ee=d.paint.get("line-dasharray"),We=Ee.constantOr(1),Ne=d.layout.get("line-cap"),Xe=Ee.constantOr(null),ze=Ne.constantOr(null),De=d.paint.get("line-pattern"),Qe=De.constantOr(1),dt=d.paint.get("line-pattern-cross-fade"),lt=De.constantOr(null),Lt=d.paint.get("line-opacity").constantOr(1);let Tt=!Qe&&Lt!==1||g.depthOcclusion&&j>0&&j<1;const Gt=d.paint.get("line-gradient"),hn=Qe?"linePattern":"line",mt=r.e1(d);let rt;if(Se&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Tt=!1),j!==0&&g.depthOcclusion){const _n=d.paint._values["line-opacity"];_n&&_n.value&&_n.value.kind==="constant"?rt=_n.value:r.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}C.value.kind!=="constant"&&C.value.isLineProgressConstant===!1&&mt.push("VARIABLE_LINE_WIDTH");const zt=(_n,Vn,fn,yn,$n,On)=>{for(const Cn of _n){const Bn=o.getTile(Cn);if(Qe&&!Bn.patternsLoaded())continue;const _r=Bn.getBucket(d);if(!_r||_r.elevationType!=="none"&&!$n||_r.elevationType==="none"&&$n)continue;g.prepareDrawTile();const mi=[...Vn],zr=g.shadowRenderer,ts=_r.elevationType==="road"&&!!zr&&zr.enabled;let Ir=[0,0,0];if(ts){const Pr=g.style.directionalLight,Si=g.style.ambientLight;Pr&&Si&&(Ir=Zl(g.style,Pr,Si)),mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const bi=_r.programConfigurations.get(d.id);let Kr=!1;if(lt&&Bn.imageAtlas){const Pr=r.e2.from(lt),Si=Pr.getPrimary().scaleSelf(Pe).toString(),xs=Bn.imageAtlas.patternPositions.get(Si),qs=Pr.getSecondary(),ws=qs?Bn.imageAtlas.patternPositions.get(qs.scaleSelf(Pe).toString()):null;Kr=!!xs&&!!ws,xs&&bi.setConstantPatternPositions(xs,ws)}dt>0&&(Kr||bi.getPatternTransitionVertexBuffer("line-pattern"))&&mi.push("LINE_PATTERN_TRANSITION");const Xi=g.isTileAffectedByFog(Cn),wi=g.getOrCreateProgram(hn,{config:bi,defines:mi,overrideFog:Xi});if(!Qe&&Xe&&ze&&Bn.lineAtlas){const Pr=Bn.lineAtlas.getDash(Xe,ze);Pr&&bi.setConstantPatternPositions(Pr)}ts&&zr.setupShadows(Bn.tileID.toUnwrapped(),wi,"vector-tile");let[ss,gi]=d.paint.get("line-trim-offset");(ze==="round"||ze==="square")&&ss!==gi&&(ss===0&&(ss-=1),gi===1&&(gi+=1));const Xr=Se?Cn.projMatrix:null,Oi=$?1/_r.tileToMeter/r.ay(Bn,1,g.transform.zoom):1,Gr=$?1/_r.tileToMeter/r.ay(Bn,1,Math.floor(g.transform.zoom)):1,os=Qe?r.e3(g,Bn,d,Xr,Pe,Oi,Gr,[ss,gi],Ir,dt):r.e4(g,Bn,d,Xr,_r.lineClipsArray.length,Pe,Oi,Gr,[ss,gi],Ir);if(Gt){const Pr=_r.gradients[d.id];let Si=Pr.texture;if(d.gradientVersion!==Pr.version){let xs=256;if(d.stepInterpolant){const qs=o.getSource().maxzoom,ws=Cn.canonical.z===qs?Math.ceil(1<<g.transform.maxZoom-Cn.canonical.z):1;xs=r.aA(r.e5(_r.maxLineLength/r.al*1024*ws),256,Q.maxTextureSize)}Pr.gradient=r.e6({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:xs,image:Pr.gradient||void 0,clips:_r.lineClipsArray}),Pr.texture?Pr.texture.update(Pr.gradient):Pr.texture=new r.T(Q,Pr.gradient,ie.RGBA8),Pr.version=d.gradientVersion,Si=Pr.texture}Q.activeTexture.set(ie.TEXTURE1),Si.bind(d.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}We&&(Q.activeTexture.set(ie.TEXTURE0),Bn.lineAtlasTexture&&Bn.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),bi.updatePaintBuffers()),Qe&&(Q.activeTexture.set(ie.TEXTURE0),Bn.imageAtlasTexture&&Bn.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),bi.updatePaintBuffers()),$n&&!q&&g.terrain.setupElevationDraw(Bn,wi),g.uploadCommonUniforms(Q,wi,Cn.toUnwrapped());const Ei=Pr=>{rt!=null&&(rt.value=Lt*j),wi.draw(g,ie.TRIANGLES,fn,Pr,_e,Dr.disabled,os,d.id,_r.layoutVertexBuffer,_r.indexBuffer,_r.segments,d.paint,g.transform.zoom,bi,[_r.layoutVertexBuffer2,_r.patternVertexBuffer,_r.zOffsetVertexBuffer]),rt!=null&&(rt.value=Lt)};if(Tt&&!$n){const Pr=g.stencilModeForClipping(Cn).ref;Pr===0&&Se&&Q.clear({stencil:0});const Si={func:ie.EQUAL,mask:255};os.u_alpha_discard_threshold=.8,Ei(new Cr(Si,Pr,255,ie.KEEP,ie.KEEP,ie.INVERT)),os.u_alpha_discard_threshold=0,Ei(new Cr(Si,Pr,255,ie.KEEP,ie.KEEP,ie.KEEP))}else os.u_alpha_discard_threshold=Tt&&$n&&On?.8:0,Ei($n?yn:g.stencilModeForClipping(Cn))}};let Mt=g.depthModeForSublayer(0,Xn.ReadOnly);const Jt=new Xn(g.depthOcclusion?ie.GREATER:ie.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D);if(d.hasNonElevatedBuckets){const _n=!Se&&g.terrain;j!==0&&_n?r.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has line-z-offset enabled.`):_n?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${d.id}.`):zt(y,mt,Mt,Cr.disabled,!1,!0)}if(d.hasElevatedBuckets){z==="hd-road-markup"?ee||(Mt=Jt,mt.push("ELEVATED_ROADS")):(mt.push("ELEVATED"),Mt=Jt,de&&mt.push(be?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),q&&mt.push("ELEVATION_REFERENCE_SEA"));const _n=Tt?g.stencilModeFor3D():Cr.disabled;g.forceTerrainMode=!0,zt(y,mt,Mt,_n,!0,!0),Tt&&zt(y,mt,Mt,_n,!0,!1),g.forceTerrainMode=!1}Tt&&(g.resetStencilClippingMasks(),Se&&Q.clear({stencil:0})),j===0||g.depthOcclusion||Se||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,o,d,y){const S=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const I=d.paint.get("fill-emissive-strength"),j=g.colorModeForDrapableLayerRenderPass(I),z=d.paint.get("fill-pattern"),$=g.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(r.ao.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";let q="none";d.layout.get("fill-elevation-reference")!=="none"?q="road":d.paint.get("fill-z-offset").constantOr(1)!==0&&(q="offset");const ee=!(!g.terrain||!g.terrain.enabled),Q={painter:g,sourceCache:o,layer:d,coords:y,colorMode:j,elevationType:q,terrainEnabled:ee,pass:$};if(g.renderPass!=="shadow")if(q!=="offset"){if(Nl(Q,!1),q==="road"){const ie=!ee&&g.renderPass==="translucent";ie&&Ha(g,o,d,y,"geometry"),Nl(Q,!0,Cr.disabled),ie&&(function(le){const{painter:de,sourceCache:be,layer:_e,coords:Se,colorMode:Pe}=le,Ee=de.context.gl,We=le.painter.shadowRenderer,Ne=!!We&&We.enabled,Xe=new Xn(de.context.gl.LEQUAL,Xn.ReadOnly,de.depthRangeFor3D);let ze=[0,0,0];if(Ne){const Qe=de.style.directionalLight,dt=de.style.ambientLight;Qe&&dt&&(ze=Zl(de.style,Qe,dt))}const De=Qe=>{for(const dt of Se){const lt=be.getTile(dt),Lt=lt.getBucket(_e);if(!Lt)continue;const Tt=Lt.elevatedStructures;if(!Tt)continue;let Gt,hn;if(Qe?(Gt=Tt.renderableBridgeSegments,hn=Tt.bridgeProgramConfigurations.get(_e.id)):(Gt=Tt.renderableTunnelSegments,hn=Tt.tunnelProgramConfigurations.get(_e.id)),!Gt||Gt.segments[0].primitiveLength===0)continue;hn.updatePaintBuffers(),de.prepareDrawTile();const mt=de.isTileAffectedByFog(dt),rt=[];Ne&&rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const zt=de.getOrCreateProgram("elevatedStructures",{config:hn,overrideFog:mt,defines:rt}),Mt=de.translatePosMatrix(dt.projMatrix,lt,_e.paint.get("fill-translate"),_e.paint.get("fill-translate-anchor"));Ne&&We.setupShadows(lt.tileID.toUnwrapped(),zt,"vector-tile");const Jt=u_(Mt,ze);de.uploadCommonUniforms(de.context,zt,dt.toUnwrapped()),zt.draw(de,Ee.TRIANGLES,Xe,Cr.disabled,Pe,Dr.backCCW,Jt,_e.id,Tt.vertexBuffer,Tt.indexBuffer,Gt,_e.paint,de.transform.zoom,hn,[Tt.vertexBufferNormal])}};De(!0),De(!1)})(Q)}}else Nl(Q,!1,g.stencilModeFor3D());else g.shadowRenderer&&q==="road"&&!ee&&(function(ie){const{painter:le,sourceCache:de,layer:be,coords:_e}=ie,Se=le.context.gl,Pe=ie.painter.shadowRenderer;for(const Ee of _e){const We=de.getTile(Ee),Ne=We.getBucket(be);if(!Ne)continue;const Xe=Ne.elevatedStructures;if(!Xe||!Xe.shadowCasterSegments||Xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const ze=Ne.bufferData.programConfigurations.get(be.id),De=le.isTileAffectedByFog(Ee),Qe=le.getOrCreateProgram("elevatedStructuresDepth",{config:ze,overrideFog:De}),dt=Pe.calculateShadowPassMatrixFromTile(We.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,Qe,Ee.toUnwrapped());const lt={u_matrix:dt,u_depth_bias:0};Qe.draw(le,Se.TRIANGLES,Pe.getShadowPassDepthMode(),Cr.disabled,Pe.getShadowPassColorMode(),Dr.disabled,lt,be.id,Xe.vertexBuffer,Xe.indexBuffer,Xe.shadowCasterSegments,be.paint,le.transform.zoom,ze)}})(Q)},"fill-extrusion":function(g,o,d,y){const S=d.paint.get("fill-extrusion-opacity"),C=g.context,I=C.gl,j=g.terrain,z=j&&j.renderingToTexture;if(S===0)return;const $=g.conflationActive&&g.style.isLayerClipped(d,o.getSource()),q=g.style.order.indexOf(d.fqid);if($&&(function(ee,Q,ie,le,de){for(const be of le){const _e=Q.getTile(be).getBucket(ie);_e&&(_e.updateReplacement(be,ee.replacementSource,de),_e.uploadCentroid(ee.context))}})(g,o,d,y,q),j||$)for(const ee of y){const Q=o.getTile(ee).getBucket(d);Q&&zu(g.context,o,ee,Q,d,j,$)}if(g.renderPass==="shadow"&&g.shadowRenderer){const ee=g.shadowRenderer;if(j&&S<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const Q=ee.getShadowPassDepthMode(),ie=ee.getShadowPassColorMode();Fn(g,o,d,y,Q,Cr.disabled,ie,$)}else if(g.renderPass==="translucent"){const ee=!d.paint.get("fill-extrusion-pattern").constantOr(1),Q=d.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!z&&Q.a!==0){const ie=new Xn(g.context.gl.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D);S===1&&ee?Fn(g,o,d,y,ie,Cr.disabled,si.unblended,$):(Fn(g,o,d,y,ie,Cr.disabled,si.disabled,$),Fn(g,o,d,y,ie,g.stencilModeFor3D(),g.colorModeForRenderPass(),$),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&ee&&(!j&&g.transform.projection.name!=="globe"||z)){const ie=d.paint.get("fill-extrusion-opacity"),le=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),de=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),be=d.paint.get("fill-extrusion-flood-light-intensity"),_e=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(_e?null:d.lut).toArray01().slice(0,3),Pe=le>0&&de>0,Ee=be>0,We=(ze,De,Qe)=>(1-Qe)*ze+Qe*De,Ne=new Pg;Ne.translate=d.paint.get("fill-extrusion-translate"),Ne.translateAnchor=d.paint.get("fill-extrusion-translate-anchor"),Ne.edgeRadius=d.layout.get("fill-extrusion-edge-radius"),Ne.cutoffFadeRange=d.paint.get("fill-extrusion-cutoff-fade-range");const Xe=ze=>{const De=g.depthModeForSublayer(1,Xn.ReadOnly,I.LEQUAL,!0),Qe=d.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=We(.1,3,Qe),lt=g._showOverdrawInspector;if(!lt){const Lt=new Cr({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),Tt=new si([I.ONE,I.ONE,I.ONE,I.ONE],r.ao.transparent,[!1,!1,!1,!0],I.MIN);Jl(Ne,g,o,d,y,De,Lt,Tt,Dr.disabled,ze,"sdf",ie,le,de,be,Se,dt,$,!1)}{const Lt=lt?Cr.disabled:new Cr({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),Tt=lt?g.colorModeForRenderPass():new si([I.ONE_MINUS_DST_ALPHA,I.DST_ALPHA,I.ONE,I.ONE],r.ao.transparent,[!0,!0,!0,!0]);Jl(Ne,g,o,d,y,De,Lt,Tt,Dr.disabled,ze,"color",ie,le,de,be,Se,dt,$,!1)}};if(z){const ze=(De,Qe,dt)=>{const lt=g.depthModeForSublayer(1,Xn.ReadOnly,I.LEQUAL,!1),Lt=d.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Tt=We(.1,3,Lt);{const Gt=new si([I.ONE,I.ONE,I.ONE,I.ONE],r.ao.transparent,[!1,!1,!1,!0]);Jl(Ne,g,o,d,y,lt,Cr.disabled,Gt,Dr.disabled,De,"clear",ie,le,de,be,Se,Tt,$,Qe)}{const Gt=new Cr({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),hn=new si([I.ONE,I.ONE,I.ONE,I.ONE],r.ao.transparent,[!1,!1,!1,!0],I.MIN);Jl(Ne,g,o,d,y,lt,Gt,hn,Dr.disabled,De,"sdf",ie,le,de,be,Se,Tt,$,Qe)}{const Gt=De?I.ZERO:I.ONE_MINUS_DST_ALPHA,hn=new Cr({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),mt=new si([Gt,I.DST_ALPHA,I.ONE_MINUS_DST_ALPHA,I.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Jl(Ne,g,o,d,y,lt,hn,mt,Dr.disabled,De,"color",ie,le,de,be,Se,Tt,$,Qe)}{const Gt=new si([I.ONE,I.ONE,I.ONE,De?I.ZERO:I.ONE],r.ao.transparent,[!1,!1,!1,!0],De?I.FUNC_ADD:I.MAX);Jl(Ne,g,o,d,y,lt,Cr.disabled,Gt,Dr.disabled,De,"clear",ie,le,de,be,Se,Tt,$,Qe,dt)}};if(Pe||Ee){let De;if(g.prepareDrawTile(),j){const Qe=j.drapeBufferSize[0],dt=j.drapeBufferSize[1];De=j.framebufferCopyTexture,De&&(!De||De.size[0]===Qe&&De.size[1]===dt)||(De&&De.destroy(),De=j.framebufferCopyTexture=new r.T(C,new r.q({width:Qe,height:dt}),I.RGBA8)),De.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,Qe,dt)}Pe&&ze(!0,!1,De),Ee&&ze(!1,!0,De)}}else Pe&&Xe(!0),Ee&&Xe(!1),(Pe||Ee)&&g.resetStencilClippingMasks()}}},building:function(g,o,d,y){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);const S=d.paint.get("building-ambient-occlusion-ground-intensity"),C=d.paint.get("building-ambient-occlusion-ground-radius"),I=d.paint.get("building-ambient-occlusion-ground-attenuation"),j=d.paint.get("building-opacity");if(j<=0)return;let z=S>0&&C>0,$=!0;const q=d.paint.get("building-vertical-scale");if(q<=0)return;(!g.shadowRenderer||q<1)&&($=!1);const ee=g.conflationActive&&g.style.isLayerClipped(d,o.getSource()),Q=g.style.order.indexOf(d.fqid);if((function(ie,le,de,be,_e,Se){for(const Pe of Se){const Ee=le.getTile(Pe).getBucket(de);Ee&&(_e&&Ee.updateReplacement(Pe,ie.replacementSource,be),Ee.uploadUpdatedIndexBuffer(ie.context))}})(g,o,d,Q,ee,y),(function(ie,le,de,be){for(const _e of be){const Se=le.getTile(_e).getBucket(de);Se&&Se.needsEvaluation()&&Se.uploadUpdatedColorBuffer(ie.context)}})(g,o,d,y),d.resetLayerRenderingStats(g),g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0),g.renderPass==="shadow"&&g.shadowRenderer){const ie=g.shadowRenderer,le=[],de=ie.getShadowPassDepthMode();au({painter:g,source:o,layer:d,coords:y,defines:le,blendMode:ie.getShadowPassColorMode(),depthMode:de,opacity:j,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(g.renderPass==="translucent"){let ie=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];$&&(ie=ie.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),g.shadowRenderer&&g.shadowRenderer.useNormalOffset&&(ie=ie.concat("NORMAL_OFFSET"));const le=d.paint.get("building-facade-emissive-chance"),de=d.paint.get("building-ambient-occlusion-intensity"),be=d.paint.get("building-flood-light-intensity"),_e=d.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Se=d.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(_e?null:d.lut).toArray01().slice(0,3),Pe=d.paint.get("building-flood-light-ground-attenuation"),Ee=be>0,We=new Xn(g.context.gl.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D);j<1&&au({painter:g,source:o,layer:d,coords:y,defines:ie,blendMode:si.disabled,depthMode:We,opacity:j,verticalScale:q,facadeEmissiveChance:le,facadeAOIntensity:de,floodLightIntensity:be,floodLightColor:Se,depthOnly:!0});const Ne=g.colorModeForRenderPass();au({painter:g,source:o,layer:d,coords:y,defines:ie,blendMode:Ne,depthMode:We,opacity:j,verticalScale:q,facadeEmissiveChance:le,facadeAOIntensity:de,floodLightIntensity:be,floodLightColor:Se}),z&&Uf(g,o,d,y,!0,j,S,C,be,Se,I,ee),Ee&&Uf(g,o,d,y,!1,j,S,C,be,Se,Pe,ee)}else if(g.renderPass==="light-beam"){const ie=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Xn(g.context.gl.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D);au({painter:g,source:o,layer:d,coords:y,defines:ie,blendMode:si.alphaBlended,depthMode:le,opacity:j,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1),g.resetStencilClippingMasks()},hillshade:function(g,o,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const S=g.context,C=g.terrain&&g.terrain.renderingToTexture,[I,j]=g.renderPass!=="translucent"||C?[{},y]:g.stencilConfigForOverlap(y);for(const z of j){const $=o.getTile(z);if($.needsHillshadePrepare&&g.renderPass==="offscreen")Hp(g,$,d);else if(g.renderPass==="translucent"){const q=g.depthModeForSublayer(0,Xn.ReadOnly),ee=d.paint.get("hillshade-emissive-strength"),Q=g.colorModeForDrapableLayerRenderPass(ee),ie=C&&g.terrain?g.terrain.stencilModeForRTTOverlap(z):I[z.overscaledZ];iy(g,z,$,d,q,ie,Q)}}S.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,o,d,y,S,C){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const I=g.transform.projection.name==="globe",j=d.paint.get("raster-elevation")!==0,z=j&&I;if(g.renderElevatedRasterBackface&&!z)return;const $=g.context,q=$.gl,ee=o.getSource(),Q=(function(Ne,Xe,ze,De){const Qe=Xe.paint.get("raster-color"),dt=Ne.type==="raster-array",lt=[],Lt=Xe.paint.get("raster-resampling"),Tt=Xe.paint.get("raster-color-mix");let Gt=Xe.paint.get("raster-color-range");const hn=[Tt[0],Tt[1],Tt[2],0],mt=Tt[3];let rt=Lt==="nearest"?De.NEAREST:De.LINEAR;if(dt&&(lt.push("RASTER_ARRAY"),Qe||lt.push("RASTER_COLOR"),Lt==="linear"&&lt.push("RASTER_ARRAY_LINEAR"),rt=De.NEAREST,!Gt&&Ne.rasterLayers)){const zt=Ne.rasterLayers.find((({id:Mt})=>Mt===Xe.sourceLayer));zt&&zt.fields&&zt.fields.range&&(Gt=zt.fields.range)}if(Gt=Gt||[0,1],Qe){lt.push("RASTER_COLOR"),ze.activeTexture.set(De.TEXTURE2),Xe.updateColorRamp(Gt);let zt=Xe.colorRampTexture;zt||(zt=Xe.colorRampTexture=new r.T(ze,Xe.colorRamp,De.RGBA8)),zt.bind(De.LINEAR,De.CLAMP_TO_EDGE)}return{mix:hn,range:Gt,offset:mt,defines:lt,resampling:rt}})(ee,d,$,q);if(ee instanceof r.aT&&!y.length&&!I)return;const ie=d.paint.get("raster-emissive-strength"),le=g.colorModeForDrapableLayerRenderPass(ie),de=g.terrain&&g.terrain.renderingToTexture,be=!g.options.moving,_e=d.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;if(ee instanceof r.aT&&!y.length&&(ee.onNorthPole||ee.onSouthPole)){const Ne=j?g.stencilModeFor3D():Cr.disabled;return void Rg(!!ee.onNorthPole,null,g,o,d,ie,Q,Dr.disabled,Ne)}if(!y.length)return;const[Se,Pe]=ee instanceof r.aT||de?[{},y]:g.stencilConfigForOverlap(y),Ee=Pe[Pe.length-1].overscaledZ;z&&Q.defines.push("PROJECTION_GLOBE_VIEW"),j&&Q.defines.push("RENDER_CUTOFF");const We=(Ne,Xe,ze)=>{for(const De of Ne){const Qe=De.toUnwrapped(),dt=o.getTile(De);if(de&&(!dt||!dt.hasData()))continue;$.activeTexture.set(q.TEXTURE0);const lt=yo(dt,ee,d,Q);if(!lt||!lt.texture)continue;const{texture:Lt,mix:Tt,offset:Gt,tileSize:hn,buffer:mt}=lt;let rt,zt;de?(rt=Xn.disabled,zt=De.projMatrix):j?(rt=new Xn(q.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D),zt=I?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Qe,be)):(rt=g.depthModeForSublayer(De.overscaledZ-Ee,d.paint.get("raster-opacity")===1?Xn.ReadWrite:Xn.ReadOnly,q.LESS),zt=g.transform.calculateProjMatrix(Qe,be));const Mt=g.terrain&&de?g.terrain.stencilModeForRTTOverlap(De):Se[De.overscaledZ],Jt=C?0:d.paint.get("raster-fade-duration");dt.registerFadeDuration(Jt);const _n=o.findLoadedParent(De,0),Vn=Xp(dt,_n,o,g.transform,Jt);let fn,yn;!Vn.isFading&&dt.refreshedUponExpiration&&(dt.refreshedUponExpiration=!1),g.terrain&&g.terrain.prepareDrawTile(),$.activeTexture.set(q.TEXTURE0),Lt.bind(_e,q.CLAMP_TO_EDGE),$.activeTexture.set(q.TEXTURE1),_n?(_n.texture&&_n.texture.bind(_e,q.CLAMP_TO_EDGE),fn=Math.pow(2,_n.tileID.overscaledZ-dt.tileID.overscaledZ),yn=[dt.tileID.canonical.x*fn%1,dt.tileID.canonical.y*fn%1]):Lt.bind(_e,q.CLAMP_TO_EDGE),"useMipmap"in Lt&&$.extTextureFilterAnisotropic&&g.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const $n=g.transform;let On;const Cn=j?Ng($n):[0,0,0,0];let Bn,_r,mi,zr,ts,Ir=0;if(z&&ee instanceof r.aT&&ee.coordinates.length>3)Bn=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0)))),_r=Float32Array.from($n.globeMatrix),mi=Float32Array.from(r.dE($n)),zr=[r.aF($n.center.lng),r.aJ($n.center.lat)],On=ee.elevatedGlobePerspectiveTransform,ts=ee.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const wi=r.dF(De.canonical);Ir=r.dG(wi.getCenter().lat),Bn=Float32Array.from(r.bj(r.dI(De.canonical))),_r=Float32Array.from($n.globeMatrix),mi=Float32Array.from(r.dE($n)),zr=[r.aF($n.center.lng),r.aJ($n.center.lat)],On=[0,0],ts=Float32Array.from(r.dH(De.canonical,wi,Ir,$n.worldSize/$n._pixelsPerMercatorPixel))}else On=ee instanceof r.aT?ee.perspectiveTransform:[0,0],Bn=new Float32Array(16),_r=new Float32Array(9),mi=new Float32Array(16),zr=[0,0],ts=new Float32Array(9);const bi=Df(zt,Bn,_r,mi,ts,yn||[0,0],r.aj(g.transform.zoom),zr,Cn,fn||1,Vn,d,On,j?d.paint.get("raster-elevation"):0,2,Tt,Gt,Q.range,hn,mt,ie),Kr=g.isTileAffectedByFog(De),Xi=g.getOrCreateProgram("raster",{defines:Q.defines,overrideFog:Kr});if(g.uploadCommonUniforms($,Xi,Qe),ee instanceof r.aT){const wi=ee.elevatedGlobeVertexBuffer,ss=ee.elevatedGlobeIndexBuffer;if(de||!I)ee.boundsBuffer&&ee.boundsSegments&&Xi.draw(g,q.TRIANGLES,rt,Cr.disabled,le,Dr.disabled,bi,d.id,ee.boundsBuffer,g.quadTriangleIndexBuffer,ee.boundsSegments);else if(wi&&ss){const gi=$n.zoom<=r.cZ?ee.elevatedGlobeSegments:ee.getSegmentsForLongitude($n.center.lng);gi&&Xi.draw(g,q.TRIANGLES,rt,Cr.disabled,le,Xe,bi,d.id,wi,ss,gi)}}else if(z){rt=new Xn(q.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D);const wi=g.globeSharedBuffers;if(wi){const[ss,gi,Xr]=wi.getGridBuffers(Ir,!1);Xi.draw(g,q.TRIANGLES,rt,ze||Mt,g.colorModeForRenderPass(),Xe,bi,d.id,ss,gi,Xr)}}else{const{tileBoundsBuffer:wi,tileBoundsIndexBuffer:ss,tileBoundsSegments:gi}=g.getTileBoundsBuffers(dt);Xi.draw(g,q.TRIANGLES,rt,Mt,le,Dr.disabled,bi,d.id,wi,ss,gi)}}if(!(ee instanceof r.aT)&&z)for(const De of Ne){const Qe=De.canonical.y===(1<<De.canonical.z)-1;De.canonical.y===0&&Rg(!0,De,g,o,d,ie,Q,Xe,ze||Cr.disabled),Qe&&Rg(!1,De,g,o,d,ie,Q,Xe===Dr.frontCW?Dr.backCW:Dr.frontCW,ze||Cr.disabled)}};z?We(Pe,g.renderElevatedRasterBackface?Dr.backCW:Dr.frontCW,g.stencilModeFor3D()):We(Pe,Dr.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,o,d,y,S,C){g.renderPass==="offscreen"&&(function(I,j,z,$){if(!$.length)return;const q=I.context,ee=q.gl,Q=j.getSource();if(!(Q instanceof Gs))return;const ie=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let le=z.particlePositionRGBAImage;if(!le||le.width!==ie){const Pe=(function(Ee){const We=Ee*Ee,Ne=new Uint8Array(4*We),Xe=function(De){return De|=0,De=Math.imul(2747636419^De,2654435769),De=Math.imul(De^De>>>16,2654435769),((De=Math.imul(De^De>>>16,2654435769))>>>0)/4294967296},ze=1/1.1;for(let De=0;De<We;De++){const Qe=ze*(Xe(2*De+0)+Od),dt=ze*(Xe(2*De+1)+Od),lt=255*Qe%1,Lt=255*dt%1,Tt=lt,Gt=dt-Lt/255,hn=Lt;Ne[4*De+0]=255*(Qe-lt/255),Ne[4*De+1]=255*Tt,Ne[4*De+2]=255*Gt,Ne[4*De+3]=255*hn}return Ne})(ie);le=z.particlePositionRGBAImage=new r.q({width:ie,height:ie},Pe)}let de=z.particleFramebuffer;de?de.width!==ie&&(de.destroy(),de=z.particleFramebuffer=q.createFramebuffer(ie,ie,!0,null)):de=z.particleFramebuffer=q.createFramebuffer(ie,ie,!0,null);const be=[];for(const Pe of $){const Ee=j.getTile(Pe);if(!(Ee instanceof $l))continue;const We=sm(Ee,Q,z);if(!We)continue;const Ne=[Ee.tileSize,Ee.tileSize];let Xe=z.tileFramebuffer;Xe||(Xe=z.tileFramebuffer=q.createFramebuffer(Ne[0],Ne[1],!0,null));let ze=Ee.rasterParticleState;ze||(ze=Ee.rasterParticleState=new Ta(q,Pe,Ne,le));const De=ze.update(z.lastInvalidatedAt);ze.particleTextureDimension!==ie&&ze.updateParticleTexture(Pe,le);const Qe=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=Qe;const dt=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=dt,be.push([Pe,We,ze,De])}if(be.length===0)return;const _e=r.o.now(),Se=z.previousDrawTimestamp?.001*(_e-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=_e,z.hasColorMap()){q.activeTexture.set(ee.TEXTURE0+2);let Pe=z.colorRampTexture;Pe||(Pe=z.colorRampTexture=new r.T(q,z.colorRamp,ee.RGBA8)),Pe.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}q.bindFramebuffer.set(z.tileFramebuffer.framebuffer),(function(Pe,Ee,We){const Ne=Pe.context,Xe=Ne.gl,ze=Ee.tileFramebuffer;Ne.activeTexture.set(Xe.TEXTURE0);const De={u_texture:0,u_opacity:1.05*(dt=Ee.paint.get("raster-particle-fade-opacity-factor"))/(dt+.05)},Qe=Pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var dt;for(const lt of We){const[,,Lt,Tt]=lt;ze.colorAttachment.set(Lt.targetColorTexture.texture),Ne.viewport.set([0,0,ze.width,ze.height]),Ne.clear({color:r.ao.transparent}),Tt&&(Lt.backgroundColorTexture.bind(Xe.NEAREST,Xe.CLAMP_TO_EDGE),Qe.draw(Pe,Xe.TRIANGLES,Xn.disabled,Cr.disabled,si.alphaBlended,Dr.disabled,De,Ee.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments))}})(I,z,be),(function(Pe,Ee,We,Ne){const Xe=Pe.context,ze=Xe.gl,De=We.tileFramebuffer,Qe=Pe.transform.projection.name==="globe",dt=We.paint.get("raster-particle-max-speed");for(const lt of Ne){const[Lt,Tt,Gt]=lt;Xe.activeTexture.set(ze.TEXTURE0+0),Tt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),De.colorAttachment.set(Gt.targetColorTexture.texture);const hn=Pe.getOrCreateProgram("rasterParticleDraw",{defines:Tt.defines,overrideFog:!1});Xe.activeTexture.set(ze.TEXTURE0+1);const mt=Tt.scalarData?[]:[0,1,2,3].map((Mt=>r.e8[Mt](Lt)));mt.push(Lt);const rt=Lt.canonical.x,zt=Lt.canonical.y;for(const Mt of mt){const Jt=Ee.getTile(Qe?Mt.wrapped():Mt);if(!Jt)continue;const _n=Jt.rasterParticleState;if(!_n)continue;const Vn=Mt.canonical.x+(1<<Mt.canonical.z)*(Mt.wrap-Lt.wrap),fn=Mt.canonical.y;_n.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const yn=Jp(1,_n.particleTexture0.size[0],[Vn-rt,fn-zt],0,Tt.texture.size,2,dt,Tt.textureOffset,Tt.scale,Tt.offset);hn.draw(Pe,ze.POINTS,Xn.disabled,Cr.disabled,si.alphaBlended,Dr.disabled,yn,We.id,_n.particleIndexBuffer,void 0,_n.particleSegment)}}})(I,j,z,be),q.bindFramebuffer.set(z.particleFramebuffer.framebuffer),(function(Pe,Ee,We,Ne){const Xe=Pe.context,ze=Xe.gl,De=Ee.paint.get("raster-particle-max-speed"),Qe=Ne*Ee.paint.get("raster-particle-speed-factor")*.15,dt=(function(Lt){return Math.pow(Lt,6)})(.01+1*Ee.paint.get("raster-particle-reset-rate-factor")),lt=Ee.particleFramebuffer;Xe.viewport.set([0,0,lt.width,lt.height]);for(const Lt of We){const[,Tt,Gt]=Lt;Xe.activeTexture.set(ze.TEXTURE0+0),Tt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Xe.activeTexture.set(ze.TEXTURE0+1);const hn=Gt.particleTexture0;hn.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const mt=Mg(1,hn.size[0],0,Tt.texture.size,De,Qe,dt,Tt.textureOffset,Tt.scale,Tt.offset);lt.colorAttachment.set(Gt.particleTexture1.texture),Xe.clear({color:r.ao.transparent}),Pe.getOrCreateProgram("rasterParticleUpdate",{defines:Tt.defines}).draw(Pe,ze.TRIANGLES,Xn.disabled,Cr.disabled,si.unblended,Dr.disabled,mt,Ee.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments)}})(I,z,be,Se)})(g,o,d,y),g.renderPass==="translucent"&&((function(I,j,z,$,q){const ee=I.context,Q=ee.gl,ie=j.getSource().tileSize,le=5*(1-r.ah(r.cK,r.cK+1,I.transform.zoom))*ie+z.paint.get("raster-particle-elevation"),de=!I.options.moving,be=I.transform.projection.name==="globe";if(!$.length)return;const[_e,Se]=I.stencilConfigForOverlap($),Pe=[];be&&Pe.push("PROJECTION_GLOBE_VIEW");const Ee=I.stencilModeFor3D();for(const We of Se){const Ne=We.toUnwrapped(),Xe=j.getTile(We);if(!Xe.rasterParticleState)continue;const ze=Xe.rasterParticleState,De=100;Xe.registerFadeDuration(De);const Qe=j.findLoadedParent(We,0),dt=Xp(Xe,Qe,j,I.transform,De);let lt,Lt;I.terrain&&I.terrain.prepareDrawTile(),ee.activeTexture.set(Q.TEXTURE0),ze.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),ee.activeTexture.set(Q.TEXTURE1),Qe&&Qe.rasterParticleState?(Qe.rasterParticleState.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),lt=Math.pow(2,Qe.tileID.overscaledZ-Xe.tileID.overscaledZ),Lt=[Xe.tileID.canonical.x*lt%1,Xe.tileID.canonical.y*lt%1]):ze.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Tt=be?Float32Array.from(I.transform.expandedFarZProjMatrix):I.transform.calculateProjMatrix(Ne,de),Gt=I.transform,hn=$o(Gt),mt=r.dF(We.canonical),rt=r.dG(mt.getCenter().lat);let zt,Mt,Jt,_n,Vn;be?(zt=Float32Array.from(r.bj(r.dI(We.canonical))),Mt=Float32Array.from(Gt.globeMatrix),Jt=Float32Array.from(r.dE(Gt)),_n=[r.aF(Gt.center.lng),r.aJ(Gt.center.lat)],Vn=Float32Array.from(r.dH(We.canonical,mt,rt,Gt.worldSize/Gt._pixelsPerMercatorPixel))):(zt=new Float32Array(16),Mt=new Float32Array(9),Jt=new Float32Array(16),_n=[0,0],Vn=new Float32Array(9));const fn=Pl(Tt,zt,Mt,Jt,Vn,Lt||[0,0],r.aj(I.transform.zoom),_n,hn,lt||1,dt,le),yn=I.isTileAffectedByFog(We),$n=I.getOrCreateProgram("rasterParticle",{defines:Pe,overrideFog:yn});if(I.uploadCommonUniforms(ee,$n,Ne),be){const On=new Xn(Q.LEQUAL,Xn.ReadOnly,I.depthRangeFor3D),Cn=0,Bn=I.globeSharedBuffers;if(Bn){const[_r,mi,zr]=Bn.getGridBuffers(rt,Cn!==0);$n.draw(I,Q.TRIANGLES,On,Ee,si.alphaBlended,I.renderElevatedRasterBackface?Dr.frontCCW:Dr.backCCW,fn,z.id,_r,mi,zr)}}else{const On=I.depthModeForSublayer(0,Xn.ReadOnly),Cn=_e[We.overscaledZ],{tileBoundsBuffer:Bn,tileBoundsIndexBuffer:_r,tileBoundsSegments:mi}=I.getTileBoundsBuffers(Xe);$n.draw(I,Q.TRIANGLES,On,Cn,si.alphaBlended,Dr.disabled,fn,z.id,Bn,_r,mi)}}I.resetStencilClippingMasks()})(g,o,d,y),g.style.map.triggerRepaint())},background:function(g,o,d,y){const S=d.paint.get("background-color"),C=d.paint.get("background-color-use-theme").constantOr("default")==="none",I=d.paint.get("background-opacity"),j=d.paint.get("background-emissive-strength"),z=d.paint.get("background-pitch-alignment")==="viewport";if(I===0)return;const $=g.context,q=$.gl,ee=g.transform,Q=ee.tileSize,ie=d.paint.get("background-pattern");let le;if(ie!==void 0&&(ie===null||(le=g.imageManager.getPattern(r.I.from(ie.toString()),d.scope,g.style.getLut(d.scope)),!le)))return;const de=!ie&&S.a===1&&I===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==de)return;const be=Cr.disabled,_e=g.depthModeForSublayer(0,de==="opaque"?Xn.ReadWrite:Xn.ReadOnly),Se=g.colorModeForDrapableLayerRenderPass(j),Pe=ie?"backgroundPattern":"background";let Ee,We=y;if(We||(Ee=g.getBackgroundTiles(),We=Object.values(Ee).map((Ne=>Ne.tileID))),ie&&($.activeTexture.set(q.TEXTURE0),g.imageManager.bind(g.context,d.scope)),z){const Ne=g.getOrCreateProgram(Pe,{overrideFog:!1,overrideRtt:!0}),Xe=new Float32Array(r.bz([])),ze=new r.aP(0,0,0,0,0),De=ie?tm(Xe,j,I,g,0,d.scope,le,z,{tileID:ze,tileSize:Q}):em(Xe,j,I,S.toPremultipliedRenderColor(C?null:d.lut));Ne.draw(g,q.TRIANGLES,_e,be,Se,Dr.disabled,De,d.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Ne of We){const Xe=g.isTileAffectedByFog(Ne),ze=g.getOrCreateProgram(Pe,{overrideFog:Xe}),De=Ne.toUnwrapped(),Qe=y?Ne.projMatrix:g.transform.calculateProjMatrix(De);g.prepareDrawTile();const dt=o?o.getTile(Ne):Ee?Ee[Ne.key]:new da(Ne,Q,ee.zoom,g),lt=ie?tm(Qe,j,I,g,0,d.scope,le,z,{tileID:Ne,tileSize:Q}):em(Qe,j,I,S.toPremultipliedRenderColor(C?null:d.lut));g.uploadCommonUniforms($,ze,De);const{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:Tt,tileBoundsSegments:Gt}=g.getTileBoundsBuffers(dt);ze.draw(g,q.TRIANGLES,_e,be,Se,Dr.disabled,lt,d.id,Lt,Tt,Gt)}},sky:function(g,o,d){const y=g._atmosphere?r.aj(g.transform.zoom):1,S=d.paint.get("sky-opacity")*y;if(S===0)return;const C=g.context,I=d.paint.get("sky-type"),j=new Xn(C.gl.LEQUAL,Xn.ReadOnly,[0,1]),z=g.frameCounter/1e3%1;I==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&((function($,q,ee,Q){const ie=$.context,le=ie.gl;let de=q.skyboxFbo;if(!de){de=q.skyboxFbo=ie.createFramebuffer(32,32,!0,null),q.skyboxGeometry=new tc(ie),q.skyboxTexture=ie.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,q.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Pe=0;Pe<6;++Pe)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(de.framebuffer),ie.viewport.set([0,0,32,32]);const be=q.getCenter($,!0),_e=$.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);r.bz(Se),r.em(Se,Se,.5*-Math.PI),xo($,q,_e,Se,be,0),r.bz(Se),r.em(Se,Se,.5*Math.PI),xo($,q,_e,Se,be,1),r.bz(Se),r.cT(Se,Se,.5*-Math.PI),xo($,q,_e,Se,be,2),r.bz(Se),r.cT(Se,Se,.5*Math.PI),xo($,q,_e,Se,be,3),r.bz(Se),xo($,q,_e,Se,be,4),r.bz(Se),r.em(Se,Se,Math.PI),xo($,q,_e,Se,be,5),ie.viewport.set([0,0,$.width,$.height])})(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&(function($,q,ee,Q,ie){const le=$.context,de=le.gl,be=$.transform,_e=$.getOrCreateProgram("skybox");le.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,q.skyboxTexture);const Se=((Pe,Ee,We,Ne,Xe)=>({u_matrix:Pe,u_sun_direction:Ee,u_cubemap:0,u_opacity:Ne,u_temporal_offset:Xe}))(be.skyboxMatrix,q.getCenter($,!1),0,Q,ie);$.uploadCommonUniforms(le,_e),_e.draw($,de.TRIANGLES,ee,Cr.disabled,$.colorModeForRenderPass(),Dr.backCW,Se,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)})(g,d,j,S,z):I==="gradient"&&g.renderPass==="sky"&&(function($,q,ee,Q,ie){const le=$.context,de=le.gl,be=$.transform,_e=$.getOrCreateProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new tc(le)),le.activeTexture.set(de.TEXTURE0);let Se=q.colorRampTexture;Se||(Se=q.colorRampTexture=new r.T(le,q.colorRamp,de.RGBA8)),Se.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Pe=((Ee,We,Ne,Xe,ze)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:We,u_radius:r.an(Ne),u_opacity:Xe,u_temporal_offset:ze}))(be.skyboxMatrix,q.getCenter($,!1),q.paint.get("sky-gradient-radius"),Q,ie);$.uploadCommonUniforms(le,_e),_e.draw($,de.TRIANGLES,ee,Cr.disabled,$.colorModeForRenderPass(),Dr.backCW,Pe,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)})(g,d,j,S,z)},custom:function(g,o,d,y){const S=g.context,C=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(o)){if(g.renderPass==="offscreen"){const I=C.prerender;if(I){if(g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const j=g.transform.pointMerc;I.call(C,S.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),r.aj(g.transform.zoom),[j.x,j.y],g.transform.pixelsPerMeterRatio)}else I.call(C,S.gl,g.transform.customLayerMatrix());S.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const j=C.renderToTile;if(j){const z=y[0].canonical,$={x:z.x+y[0].wrap*(C.wrapTileId?0:1<<z.z),y:z.y,z:z.z};S.setDepthMode(Xn.disabled),S.setStencilMode(Cr.disabled),S.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),j.call(C,S.gl,$),S.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),S.setStencilMode(Cr.disabled);const I=C.renderingMode==="3d"?new Xn(g.context.gl.LEQUAL,Xn.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Xn.ReadOnly);if(S.setDepthMode(I),g.transform.projection.name==="globe"){const j=g.transform.pointMerc;C.render(S.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),r.aj(g.transform.zoom),[j.x,j.y],g.transform.pixelsPerMeterRatio)}else C.render(S.gl,g.transform.customLayerMatrix());S.setDirty(),g.setBaseState(),S.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,o,d,y){if(g.renderPass==="opaque")return;const S=d.paint.get("model-opacity").constantOr(1),C=d.paint.get("model-elevation-reference"),I=C==="ground",j=C==="ground";if(S===0)return;const z=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!z||g.terrain&&S<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const $=g.shadowRenderer,q=d.paint.get("model-receive-shadows");$&&($.useNormalOffset=!0,q||($.enabled=!1));const ee=()=>{$&&($.useNormalOffset=!0,q||($.enabled=!0))},Q=o.getSource();if(g.renderPass==="light-beam"&&Q.type!=="batched-model")return;if(Q.type==="vector"||Q.type==="geojson")return(function(Ee,We,Ne,Xe,ze){const De=Ee.transform,Qe=De.projection.name==="globe",dt=De.getFreeCameraOptions().position;if(!Ee.modelManager)return;const lt=Ee.modelManager;Ne.modelManager=lt;const Lt=Ee.shadowRenderer;if(!Ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Tt=Ne._unevaluatedLayout._values["model-id"],Gt=Object.assign({},Ne.layout.get("model-id").parameters),hn=Ee.style.order.indexOf(Ne.fqid);for(const mt of Xe){const rt=We.getTile(mt).getBucket(Ne);if(!rt||rt.projection.name!==De.projection.name)continue;const zt=rt.getModelUris();if(zt&&!rt.modelsRequested&&(lt.addModelsFromBucket(zt,ze),rt.modelsRequested=!0),Qe)Gt.zoom=mt.overscaledZ;else{const On=Bg(mt,De);Gt.zoom=On}const Mt=Tt.possiblyEvaluate(Gt);if(dy(Ee,rt,mt),Ga.shadowUniformsInitialized=!1,Ga.useSingleShadowCascade=!!Lt&&Lt.getMaxCascadeForTile(mt.toUnwrapped())===0,Ee.renderPass==="shadow"&&Lt){if(Ee.currentShadowCascade===1&&rt.isInsideFirstShadowMapFrustum)continue;const On=De.calculatePosMatrix(mt.toUnwrapped(),De.worldSize);if(Ga.tileMatrix.set(On),Ga.shadowTileMatrix=Float32Array.from(Lt.calculateShadowPassMatrixFromMatrix(On)),Ga.aabb.min=[0,0,0],Ga.aabb.max[0]=Ga.aabb.max[1]=r.al,Ga.aabb.max[2]=0,um(rt,Ga,Ee,Ne.scope))continue}const Jt=1<<mt.canonical.z,_n=[((dt.x-mt.wrap)*Jt-mt.canonical.x)*r.al,(dt.y*Jt-mt.canonical.y)*r.al,dt.z*Jt*r.al];Ee.conflationActive&&Object.keys(rt.instancesPerModel).length>0&&Ee.style.isLayerClipped(Ne,We.getSource())&&rt.updateReplacement(mt,Ee.replacementSource,hn,ze)&&(rt.uploaded=!1,rt.upload(Ee.context));let Vn=0;const fn=new Array,yn=new Array,$n=new Array;for(let On in rt.instancesPerModel){const Cn=rt.instancesPerModel[On];Cn.features.length>0&&!Qe&&(On=Mt.evaluate(Cn.features[0].feature,{}));const Bn=lt.getModel(On,ze);if(Bn||lt.hasURLBeenRequested(On)||rt.modelUris.includes(On)||(rt.modelUris.push(On),rt.modelsRequested=!1),Bn&&Bn.uploaded)if(Qe){const _r=r.c4([],[dt.x,dt.y,dt.z],Ee.transform.worldSize);r.ev(_r,_r);for(let mi=0;mi<Cn.instancedDataArray.length;++mi){const zr=[0,0,0],ts=[1,1,1],Ir=r.ew(),bi=Cn.tileCoordinatesForInstance(mi),Kr=Cn.transformForInstance(mi);r.ex(ts,Kr),r.ey(Ir,Kr),r.ez(zr,Ir);const Xi=Cn.translationForInstance(mi),wi=new r.aS(0,0);r.eA(rt.canonical,wi,bi.x,bi.y);const ss=r.bB();r.eB(ss,Bn,Ee.transform,wi,zr,ts,Xi,!0,!1,!1);const gi=Cn.colorForInstance(mi),Xr=r.bz([]),Oi=r.ee(wi.lat,Ee.transform.zoom),Gr=r.bp([],[1,1,1/Oi]);r.bq(Xr,Xr,_r),$n.push({zScaleMatrix:Gr,negCameraPosMatrix:Xr});for(const os of Bn.nodes)lm(Ee,os,ss,Ee.transform.expandedFarZProjMatrix,Vn,fn,yn,Bn.materialOverrides,gi);++Vn}}else for(const _r of Bn.nodes)zg(Ee,Ne,_r,Cn,_n,mt,Ga)}if(Qe)if(Ee.renderPass==="shadow"){for(const On of yn)cu(On.mesh,On.nodeModelMatrix,Ee,Ne);for(const On of fn)cu(On.mesh,On.nodeModelMatrix,Ee,Ne)}else cm(Ee,Ne,1,fn,yn,$n)}})(g,o,d,y,am(Q,d,g.style._importedAsBasemap)),void ee();if(!Q.loaded())return;if(Q.type==="batched-model")return(function(Ee,We,Ne,Xe){Ne.resetLayerRenderingStats(Ee);const ze=Ee.context,De=Ee.transform,Qe=Ee.style.fog,dt=Ee.shadowRenderer;if(De.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${De.projection.name} projection is not yet implemented`);const lt=Ee.transform.getFreeCameraOptions().position,Lt=r.c4([],[lt.x,lt.y,lt.z],Ee.transform.worldSize),Tt=r.ev([],Lt),Gt=r.bz([]),hn=r.ee(De.center.lat,De.zoom),mt=r.bp([],[1,1,1/hn]);r.bq(Gt,Gt,Tt);const rt=Ne.paint.get("model-opacity").constantOr(1),zt=new Xn(ze.gl.LEQUAL,Xn.ReadWrite,Ee.depthRangeFor3D),Mt=new Xn(ze.gl.LEQUAL,Xn.ReadOnly,Ee.depthRangeFor3D),Jt=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_n=Ee.renderPass==="shadow",Vn=_n&&dt?dt.getCurrentCascadeFrustum():De.getFrustum(De.scaleZoom(De.worldSize)),fn=Ne.paint.get("model-front-cutoff"),yn=fn[2]<1,$n=_c(Ee,Ne.paint.get("model-cutoff-fade-range")),On=Ne.getLayerRenderingStats();(function(Cn,Bn,_r,mi){const zr=Cn.terrain?Cn.terrain.exaggeration():0,ts=Cn.transform.zoom;for(const Ir of mi){const bi=Bn.getTile(Ir).getBucket(_r);bi&&(bi.setFilter(_r.filter),Cn.conflationActive&&bi.updateReplacement(Ir,Cn.replacementSource),bi.evaluateTransform(Cn,_r),Cn.terrain&&zr>0&&bi.elevationUpdate(Cn.terrain,zr,Ir,_r.source),bi.needsReEvaluation(Cn,ts,_r)&&bi.evaluate(_r))}})(Ee,We,Ne,Xe),(function(){let Cn,Bn,_r;yn?(Cn=Xe.length-1,Bn=-1,_r=-1):(Cn=0,Bn=Xe.length,_r=1);const mi=new Float64Array(16),zr=r.cz(),ts=new r.P(0,0);for(let Ir=Cn;Ir!==Bn;Ir+=_r){const bi=Xe[Ir],Kr=We.getTile(bi).getBucket(Ne);if(!Kr||!Kr.uploaded)continue;let Xi=!1;dt&&(Xi=dt.getMaxCascadeForTile(bi.toUnwrapped())===0);const wi=De.calculatePosMatrix(bi.toUnwrapped(),De.worldSize),ss=Kr.modelTraits;!_n&&yn&&(r.bk(mi,wi),r.af(zr,Lt,mi),ts.x=zr[0],ts.y=zr[1]);const gi=[];Kr.setFilter(Ne.filter);for(const Xr of Kr.getNodesInfo()){if(Xr.hiddenByReplacement||!Xr.node.meshes)continue;const Oi=Xr.node;let Gr=0;Ee.terrain&&Oi.elevation&&(Gr=Oi.elevation*Ee.terrain.exaggeration());const os=(()=>{const jo=Xr.aabb;return Jt.min=[...jo.min],Jt.max=[...jo.max],Jt.min[2]+=Gr,Jt.max[2]+=Gr,r.af(Jt.min,Jt.min,wi),r.af(Jt.max,Jt.max,wi),Jt})(),Ei=Xr.evaluatedScale;if(Ei[0]<=1&&Ei[1]<=1&&Ei[2]<=1&&os.intersects(Vn)===0)continue;if(!_n&&yn){const jo=.16666666666666666;Xr.cameraCollisionOpacity=Lt[0]>os.min[0]&&Lt[0]<os.max[0]&&Lt[1]>os.min[1]&&Lt[1]<os.max[1]&&Lt[2]*hn<os.max[2]&&Oi.footprint&&r.b$(ts,Oi.footprint)?Math.max(Xr.cameraCollisionOpacity-jo,0):Math.min(1,Xr.cameraCollisionOpacity+jo)}const Pr=[...wi],Si=1/r.d6(bi.canonical),xs=Oi.anchor?Oi.anchor[0]:0,qs=Oi.anchor?Oi.anchor[1]:0;r.bq(Pr,Pr,[xs*(Ei[0]-1)+Xr.evaluatedTranslation[0]*Si,qs*(Ei[1]-1)+Xr.evaluatedTranslation[1]*Si,Gr+Xr.evaluatedTranslation[2]]),r.cp(Ei,r.eD)||r.cR(Pr,Pr,Ei);const ws=r.aB([],Pr,Oi.globalMatrix),Os=r.aB([],De.expandedFarZProjMatrix,ws),Aa=r.aB([],De.expandedFarZProjMatrix,Pr),ga=r.aC([],[xs,qs,Gr,1],Os)[2];Oi.hidden=!1;let To=rt;_n||(yn&&(To*=Xr.cameraCollisionOpacity,To*=Ud(Pr,De,Xr.aabb,fn)),To*=Fh($n,ga)),To!==0?gi.push({nodeInfo:Xr,depth:ga,opacity:To,wvpForNode:Os,wvpForTile:Aa,nodeModelMatrix:ws,tileModelMatrix:Pr}):Oi.hidden=!0}_n||gi.sort(((Xr,Oi)=>!yn||Xr.opacity===1&&Oi.opacity===1?Xr.depth<Oi.depth?-1:1:Xr.opacity===1?-1:Oi.opacity===1?1:Xr.depth>Oi.depth?-1:1));for(const Xr of gi){const Oi=Xr.nodeInfo,Gr=Oi.node;let os=r.aB([],mt,Xr.tileModelMatrix);r.aB(os,Gt,os);const Ei=r.bk([],os);r.ef(Ei,Ei),r.cR(Ei,Ei,hy),os=r.aB(os,os,Gr.globalMatrix);const Pr=Ee.renderPass==="light-beam",Si=Ne.paint.get("model-color-use-theme").constantOr("default")==="none",xs=ss&r.eH.HasMapboxMeshFeatures,qs=xs?0:Oi.evaluatedRMEA[0][2];for(let ws=0;ws<Gr.meshes.length;++ws){const Os=Gr.meshes[ws],Aa=ws===Gr.lightMeshIndex;let ga=Xr.wvpForNode;if(Aa){if(!Pr&&!Ee.terrain&&Ee.shadowRenderer){Ee.currentLayer<Ee.firstLightBeamLayer&&(Ee.firstLightBeamLayer=Ee.currentLayer);continue}ga=Xr.wvpForTile}else if(Pr)continue;const To={defines:[]},jo=[];if(!_n&&dt&&(dt.useNormalOffset=!!Os.normalBuffer),Dh(To.defines,jo,Os,Ee,Si?null:Ne.lut),xs||To.defines.push("DIFFUSE_SHADED"),Xi&&To.defines.push("SHADOWS_SINGLE_CASCADE"),On&&(_n?On.numRenderedVerticesInShadowPass+=Os.vertexArray.length:On.numRenderedVerticesInTransparentPass+=Os.vertexArray.length),_n){cu(Os,Xr.nodeModelMatrix,Ee,Ne);continue}let gl=null;if(Qe){const Fs=Og(Xr.nodeModelMatrix,Ee.transform);if(gl=new Float32Array(Fs),De.projection.name!=="globe"){const Ji=Os.aabb.min,Xs=Os.aabb.max,[Lo,Ts]=Qe.getOpacityForBounds(Fs,Ji[0],Ji[1],Xs[0],Xs[1]);To.overrideFog=Lo>=Ct||Ts>=Ct}}const Do=Os.material;let Fl;Do.occlusionTexture&&Do.occlusionTexture.offsetScale&&(Fl=Do.occlusionTexture.offsetScale,To.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Bl=Ee.getOrCreateProgram("model",To);!_n&&dt&&dt.setupShadowsFromMatrix(Xr.tileModelMatrix,Bl,dt.useNormalOffset),Ee.uploadCommonUniforms(ze,Bl,null,gl);const _o=Do.pbrMetallicRoughness;_o.metallicFactor=.9,_o.roughnessFactor=.5;const Ss=nm(new Float32Array(ga),new Float32Array(os),new Float32Array(Ei),new Float32Array(Gr.globalMatrix),Ee,Xr.opacity,_o.baseColorFactor,Do.emissiveFactor,_o.metallicFactor,_o.roughnessFactor,Do,qs,Ne,[0,0,0],Fl);!Aa&&(Oi.hasTranslucentParts||Xr.opacity<1)&&Bl.draw(Ee,ze.gl.TRIANGLES,zt,Cr.disabled,si.disabled,Dr.backCCW,Ss,Ne.id,Os.vertexBuffer,Os.indexBuffer,Os.segments,Ne.paint,Ee.transform.zoom,void 0,jo),Bl.draw(Ee,ze.gl.TRIANGLES,Aa?Mt:zt,Cr.disabled,Aa||Xr.opacity<1||Oi.hasTranslucentParts?si.alphaBlended:si.unblended,Dr.backCCW,Ss,Ne.id,Os.vertexBuffer,Os.indexBuffer,Os.segments,Ne.paint,Ee.transform.zoom,void 0,jo)}}}})()})(g,o,d,y),void ee();if(Q.type!=="model")return;const ie=Q.getModels(),le=[],de=g.transform.getFreeCameraOptions().position,be=r.c4([],[de.x,de.y,de.z],g.transform.worldSize);r.ev(be,be);const _e=[],Se=[];let Pe=0;for(const Ee of ie){const We=o.getFeatureState("",Ee.id),Ne={type:"Unknown",id:Ee.id,properties:Ee.featureProperties},Xe=d.paint.get("model-rotation").evaluate(Ne,We),ze=d.paint.get("model-scale").evaluate(Ne,We),De=d.paint.get("model-translation").evaluate(Ne,We);Oh(d,Ee.id,We,Ee.featureProperties,Ee.nodeOverrideNames,Ee.nodeOverrides),Fg(d,Ee.id,We,Ee.featureProperties,Ee.materialOverrideNames,Ee.materialOverrides),Ee.nodeOverrides.size>0&&Ee.computeBoundsAndApplyParent(),Ee.computeModelMatrix(g,Xe,ze,De,j,I,!1);const Qe=r.bz([]),dt=r.ee(Ee.position.lat,g.transform.zoom),lt=r.bp([],[1,1,1/dt]);r.bq(Qe,Qe,be),le.push({zScaleMatrix:lt,negCameraPosMatrix:Qe});for(const Lt of Ee.nodes)lm(g,Lt,Ee.matrix,g.transform.expandedFarZProjMatrix,Pe,_e,Se,Ee.materialOverrides);Pe++}if(_e.sort(((Ee,We)=>We.depth-Ee.depth)),g.renderPass!=="shadow")cm(g,d,S,_e,Se,le),ee();else{for(const Ee of Se)cu(Ee.mesh,Ee.nodeModelMatrix,g,d);for(const Ee of _e)cu(Ee.mesh,Ee.nodeModelMatrix,g,d);ee()}}},dm={line:function(g,o,d){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const y=o.getVisibleCoordinates();for(const S of y){const C=o.getTile(S).getBucket(g);if(C&&(C.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,o,d){const y=o.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson"){const C=am(y,g,d.style._importedAsBasemap);return void(d.modelManager&&d.modelManager.upload(d,C))}if(y.type==="batched-model"||y.type!=="model")return;const S=y.getModels();for(const C of S)C.upload(d.context)},raster:function(g,o,d){const y=o.getSource();if(!(y instanceof Gs&&y.loaded()))return;const S=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!S)return;const C=g.paint.get("raster-array-band")||y.getInitialBand(S);if(C==null)return;const I=o.getIds().map((j=>o.getTileByID(j)));for(const j of I)j.updateNeeded(g.id,C)&&y.prepareTile(j,S,g.id,C)},"raster-particle":function(g,o,d){const y=o.getSource();if(!(y instanceof Gs&&y.loaded()))return;const S=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!S)return;const C=g.paint.get("raster-particle-array-band")||y.getInitialBand(S);if(C==null)return;const I=o.getIds().map((j=>o.getTileByID(j)));for(const j of I)j.updateNeeded(g.id,C)&&y.prepareTile(j,S,g.id,C)}},hm={fill:Ha},Wa={fill:function(g,o,d,y){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const S=g.context.gl,C=new Xn(S.LEQUAL,Xn.ReadOnly,g.depthRangeFor3D),I=new Cr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),j=g.transform.getFreeCameraOptions().position,z=g.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const $ of y){const q=o.getTile($),ee=q.getBucket(d);if(!ee)continue;const Q=ee.elevatedStructures;if(!Q||Q.depthSegments.segments[0].primitiveLength===0)continue;const ie=uy($.toUnwrapped(),j),le=g.translatePosMatrix($.projMatrix,q,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),de=Nf(le,ie,0,1,0);z.draw(g,S.TRIANGLES,C,I,si.disabled,Dr.disabled,de,d.id,Q.vertexBuffer,Q.indexBuffer,Q.depthSegments,d.paint,g.transform.zoom)}}};class jl{constructor(o,d,y,S,C,I){this.context=new Ff(o,d),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=C,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const j=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const $ of j)this._debugParams.enabledLayers[$]=!0;C.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),C.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),C.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),C.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const $ of j)C.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],$);this.occlusionParams=new Pb(C),this.setup(),this.numSublayers=Wl.maxUnderzooming+Wl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Op(this),this._wireframeDebugCache=new py,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const z=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,z,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=S,this.worldview=I}updateTerrain(o,d){const y=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ml(this,o));const S=this._terrain;this.transform.elevation=y?S:null,S.update(o,this.transform,d),this.transform.elevation&&!S.enabled&&(this.transform.elevation=null)}_updateFog(o){const d=o.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,S]=d.getFovAdjustedRange(this.transform._fov);if(y>S)return void(this.transform.fogCullDistSq=null);const C=y+.78*(S-y);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Ml(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,d){if(this.width=o*r.o.devicePixelRatio,this.height=d*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const o=this.context,d=new r.bc;d.emplaceBack(0,0),d.emplaceBack(r.al,0),d.emplaceBack(0,r.al),d.emplaceBack(r.al,r.al),this.tileExtentBuffer=o.createVertexBuffer(d,r.be.members),this.tileExtentSegments=r.bf.simpleSegment(0,0,4,2);const y=new r.bc;y.emplaceBack(0,0),y.emplaceBack(r.al,0),y.emplaceBack(0,r.al),y.emplaceBack(r.al,r.al),this.debugBuffer=o.createVertexBuffer(y,r.be.members),this.debugSegments=r.bf.simpleSegment(0,0,4,5);const S=new r.bc;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(S,r.be.members),this.viewportSegments=r.bf.simpleSegment(0,0,4,2);const C=new r.a$;C.emplaceBack(0,0,0,0),C.emplaceBack(r.al,0,r.al,0),C.emplaceBack(0,r.al,0,r.al),C.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=o.createVertexBuffer(C,r.bh.members),this.mercatorBoundsSegments=r.bf.simpleSegment(0,0,4,2);const I=new r.b0;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const j=new r.bd;for(const $ of[0,1,3,2,0])j.emplaceBack($);this.debugIndexBuffer=o.createIndexBuffer(j),this.emptyTexture=new r.T(o,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=r.bB();const z=this.context.gl;this.stencilClearMode=new Cr({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Xn.disabled,this.stencilClearMode,si.disabled,Dr.disabled,su(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,d,y){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const z of y)if(this._tileClippingMaskIDs[z.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=d.id;const S=this.context,C=S.gl;this.nextStencilID+y.length>256&&this.clearStencil(),S.setColorMode(si.disabled),S.setDepthMode(Xn.disabled);const I=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of y){const z=d.getTile(j),$=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=this.getTileBoundsBuffers(z);I.draw(this,C.TRIANGLES,Xn.disabled,new Cr({func:C.ALWAYS,mask:0},$,255,C.KEEP,C.KEEP,C.REPLACE),si.disabled,Dr.disabled,su(j.projMatrix),"$clipping",q,ee,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Cr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new Cr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,y=o.sort(((I,j)=>j.overscaledZ-I.overscaledZ)),S=y[y.length-1].overscaledZ,C=y[0].overscaledZ-S+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let j=0;j<C;j++)I[j+S]=new Cr({func:d.GEQUAL,mask:255},j+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[I,y]}return[{[S]:Cr.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new si([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}colorModeForDrapableLayerRenderPass(o){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new si([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,d,y,S=!1){if(this.depthOcclusion)return new Xn(this.context.gl.GREATER,Xn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!S)return Xn.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Xn(y||this.context.gl.LEQUAL,d,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,d=Math.ceil(this.width),y=Math.ceil(this.height),S=this.context.bindFramebuffer.get(),C=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&y!==0&&(this.depthFBO=new Of(this.context,d,y,!1,"texture"),this.depthTexture=new r.T(this.context,{width:d,height:y,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(S),o.bindTexture(o.TEXTURE_2D,C),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,d,y,0,0,d,y,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((o,d)=>o+d/this._fpsHistory.length),0))}render(o,d){const y=r.o.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=d;const S=this.style._mergedLayers,C=!(!this.terrain||!this.terrain.enabled),I=()=>this.style._getOrder(C).filter((mt=>{const rt=S[mt];return!(rt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[rt.type]}));let j=I(),z=!1,$=!1,q=null;for(const mt of j){const rt=S[mt];rt.type==="circle"?z=!0:rt.type==="building"?q=rt:rt.type==="symbol"&&(rt.hasOcclusionOpacityProperties?$=!0:z=!0)}let ee=j.map((mt=>S[mt]));const Q=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let ie=0,le=!1;for(const mt in Q){const rt=Q[mt];rt.used&&(rt.prepare(this.context),rt.getSource().usedInConflation&&++ie)}let de=!1;for(const mt of ee)mt.isHidden(this.transform.zoom)||(mt.type==="clip"&&(de=!0),this.prepareLayer(mt));const be={},_e={},Se={},Pe={},Ee={};for(const mt in Q){const rt=Q[mt];be[mt]=rt.getVisibleCoordinates(),_e[mt]=be[mt].slice().reverse(),Se[mt]=rt.getVisibleCoordinates(!0).reverse(),Pe[mt]=rt.getShadowCasterCoordinates(),Ee[mt]=rt.sortCoordinatesByDistance(be[mt])}const We=mt=>{const rt=this.style.getLayerSourceCache(mt);return rt&&rt.used?rt.getSource():null};if(ie||de||this._clippingActiveLastFrame){const mt=[],rt=[];let zt=0;for(const Mt of ee)this.isSourceForClippingOrConflation(Mt,We(Mt))&&(mt.push(Mt),rt.push(zt)),zt++;if(mt&&(de||mt.length>1)||this._clippingActiveLastFrame){de=!1;const Mt=[];for(let Jt=0;Jt<mt.length;Jt++){const _n=mt[Jt],Vn=rt[Jt],fn=this.style.getLayerSourceCache(_n);if(!fn||!fn.used||!fn.getSource().usedInConflation&&_n.type!=="clip"&&_n.type!=="building")continue;let yn=r.eP,$n=r.bZ.None;const On=[];let Cn=!0;if(_n.type==="building")yn=r.eR;else if(_n.type==="clip"){yn=Vn;for(const Bn of _n.layout.get("clip-layer-types"))$n|=Bn==="model"?r.bZ.Model:Bn==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const Bn of _n.layout.get("clip-layer-scope"))On.push(Bn);_n.isHidden(this.transform.zoom)?Cn=!1:de=!0}Cn&&Mt.push({layer:_n.fqid,cache:fn,order:yn,clipMask:$n,clipScope:On})}this.replacementSource.setSources(Mt),le=!0}}this._clippingActiveLastFrame=de,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let mt=0;mt<ee.length;mt++){const rt=ee[mt],zt=rt.cutoffRange();if(this.longestCutoffRange=Math.max(zt,this.longestCutoffRange),zt>0){const Mt=We(rt);Mt&&(this.minCutoffZoom=Math.max(Mt.minzoom,this.minCutoffZoom)),rt.minzoom&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom))}rt.is3D(C)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=mt),this._lastOcclusionLayer=mt)}const Ne=this.style&&this.style.fog;Ne?(this._fogVisible=Ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Se),this.opaquePassCutoff=0,j=I(),ee=j.map((mt=>S[mt])));const Xe=this._shadowRenderer;if(Xe){Xe.updateShadowParameters(this.transform,this.style.directionalLight);for(const mt in Q)for(const rt of be[mt]){let zt={min:0,max:0};this.terrain&&(zt=this.terrain.getMinMaxForTile(rt)||zt),Xe.addShadowReceiver(rt.toUnwrapped(),zt.min,zt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ns(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ze=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ze&&!this._snow&&(this._snow=new Gf(this)),!ze&&this._snow&&(this._snow.destroy(),delete this._snow),De&&!this._rain&&(this._rain=new Ea(this)),!De&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),q){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ft);const mt=this.style.getLayerSourceCache(q);this.buildingTileBorderManager.updateBorders(mt,q)}if(!Un.has(this.context.gl))return;this.renderPass="offscreen";for(const mt of ee){const rt=o.getLayerSourceCache(mt);if(!mt.hasOffscreenPass()||mt.isHidden(this.transform.zoom))continue;const zt=rt?_e[rt.id]:void 0;(mt.type==="custom"||mt.type==="raster"||mt.type==="raster-particle"||mt.isSky()||zt&&zt.length)&&this.renderLayer(this,rt,mt,zt)}this.depthRangeFor3D=[0,1-(ee.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Qe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),dt=(()=>{if(d.showOverdrawInspector)return r.ao.black;const mt=this.style.fog;if(mt&&this.transform.projection.supportsFog){const rt=this.style.getLut(mt.scope);if(!Qe){const zt=mt.properties.get("color-use-theme")==="none",Mt=mt.properties.get("color").toNonPremultipliedRenderColor(zt?null:rt).toArray01();return new r.ao(...Mt)}if(Qe){const zt=mt.properties.get("space-color-use-theme")==="none",Mt=mt.properties.get("space-color").toNonPremultipliedRenderColor(zt?null:rt).toArray01();return new r.ao(...Mt)}}return r.ao.transparent})();if(this.context.clear({color:dt,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const mt=ee[this.currentLayer],rt=o.getLayerSourceCache(mt);if(mt.isSky())continue;const zt=rt?(mt.is3D(C)?Ee:_e)[rt.id]:void 0;this._renderTileClippingMasks(mt,rt,zt),this.renderLayer(this,rt,mt,zt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const mt=ee[this.currentLayer],rt=o.getLayerSourceCache(mt);mt.isSky()&&this.renderLayer(this,rt,mt,rt?_e[rt.id]:void 0)}function lt(mt,rt){let zt;return rt&&(zt=(mt.type==="symbol"?Se:mt.is3D(C)?Ee:_e)[rt.id]),zt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<j.length;){const mt=ee[this.currentLayer];if(mt.type==="raster"||mt.type==="raster-particle"){const rt=o.getLayerSourceCache(mt);this.renderLayer(this,rt,mt,lt(mt,rt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Lt=0;Xe&&(Lt=Xe.getShadowCastingLayerCount());let Tt=!1,Gt=-1;for(let mt=0;mt<j.length;++mt){const rt=ee[mt];rt.isHidden(this.transform.zoom)||rt.is3D(C)&&(Gt=mt)}$&&Gt===-1&&(z=!0);let hn=!1;for(;this.currentLayer<j.length;){const mt=ee[this.currentLayer],rt=o.getLayerSourceCache(mt);if(mt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(mt)){if(mt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!hn&&mt.is3D(C)&&!C){const zt=this.currentLayer,Mt=Jt=>{for(this.currentLayer=0;this.currentLayer<ee.length;this.currentLayer++){const _n=ee[this.currentLayer];if(hm[_n.type]){const Vn=this.style.getLayerSourceCache(_n);hm[_n.type](this,Vn,_n,lt(_n,Vn),Jt)}}};Mt("initialize"),Mt("reset"),this.currentLayer=zt,hn=!0}if(z&&!Tt&&this.terrain&&!this.transform.isOrthographic&&(Tt=!0,this.blitDepth()),$&&Gt!==-1&&this.currentLayer===Gt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(mt,rt,rt?be[rt.id]:void 0),this.renderLayer(this,rt,mt,lt(mt,rt)),!this.terrain&&Xe&&Lt>0&&mt.hasShadowPass()&&--Lt==0){{this.clearStencil(),this.resetStencilClippingMasks();const zt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<ee.length;this.currentLayer++){const Mt=ee[this.currentLayer];if(Wa[Mt.type]){const Jt=this.style.getLayerSourceCache(Mt);Wa[Mt.type](this,Jt,Mt,lt(Mt,Jt))}}this.currentLayer=zt}if(Xe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const zt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=zt;this.currentLayer++){const Mt=ee[this.currentLayer];if(!Mt.hasLightBeamPass())continue;const Jt=o.getLayerSourceCache(Mt);this.renderLayer(this,Jt,Mt,Jt?_e[Jt.id]:void 0)}this.currentLayer=zt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const zt=this.currentLayer;this.depthOcclusion=!0;for(const Mt of this.layersWithOcclusionOpacity){this.currentLayer=Mt;const Jt=ee[this.currentLayer],_n=o.getLayerSourceCache(Jt),Vn=_n?_e[_n.id]:void 0;this.terrain||this._renderTileClippingMasks(Jt,_n,_n?be[_n.id]:void 0),this.renderLayer(this,_n,Jt,Vn)}this.depthOcclusion=!1,this.currentLayer=zt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let mt=null;ee.forEach((rt=>{const zt=o.getLayerSourceCache(rt);zt&&!rt.isHidden(this.transform.zoom)&&zt.getVisibleCoordinates().length&&(!mt||mt.getSource().maxzoom<zt.getSource().maxzoom)&&(mt=zt)})),mt&&this.options.showTileBoundaries&&Vf(this,mt,mt.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Vf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(mt){const rt=mt.transform.padding;rs(mt,mt.transform.height-(rt.top||0),3,lu),rs(mt,rt.bottom||0,3,zd),om(mt,rt.left||0,3,uo),om(mt,mt.transform.width-(rt.right||0),3,Ro);const zt=mt.transform.centerPoint;(function(Mt,Jt,_n,Vn){No(Mt,Jt-1,_n-10,2,20,Vn),No(Mt,Jt-10,_n-1,20,2,Vn)})(mt,zt.x,mt.transform.height-zt.y,Uo)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:d}=this.transform.projection,y=!d||!d.includes(o.type);if(dm[o.type]&&(y||this.terrain&&o.type==="custom")){const S=this.style.getLayerSourceCache(o);dm[o.type](o,S,this)}this.gpuTimingEnd()}renderLayer(o,d,y,S){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||S&&S.length)&&(this.id=y.id,this.gpuTimingStart(y),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(y.type)&&(!o.terrain||y.type!=="custom")||y.type==="clip"||Ug[y.type](o,d,y,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,y=this.context.gl;let S=this.gpuTimers[o.id];S||(S=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:y.createQuery()}),S.calls++,y.beginQuery(d.TIME_ELAPSED_EXT,S.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,d=this.context.gl,y=d.createQuery();this.deferredRenderGpuTimeQueries.push(y),d.beginQuery(o.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const d={};for(const y in o){const S=o[y],C=this.context.extTimerQuery,I=C.getQueryParameter(S.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(S.query),d[y]=I}return d}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.gl;let y=0;for(const S of o)y+=d.getQueryParameter(S,d.QUERY_RESULT)/1e6,d.deleteQuery(S);return y}translatePosMatrix(o,d,y,S,C){if(!y[0]&&!y[1])return o;const I=C?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(I){const $=Math.sin(I),q=Math.cos(I);y=[y[0]*q-y[1]*$,y[0]*$+y[1]*q]}const j=[C?y[0]:r.ay(d,y[0],this.transform.zoom),C?y[1]:r.ay(d,y[1],this.transform.zoom),0],z=new Float32Array(16);return r.bq(z,o,j),z}saveTileTexture(o){if(o.context!==this.context)return;const d=o.size[0],y=this._tileTextures[d];y?y.push(o):this._tileTextures[d]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,d,y){const S=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,C=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):S||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||C.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||S||d!==void 0&&!d||C.push("FOG","FOG_DITHERING"),S&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(o,d){this.cache=this.cache||{};const y=d&&d.defines||[],S=d&&d.config,C=this.currentGlobalDefines(o,d&&d.overrideFog,d&&d.overrideRtt).concat(y),I=Qp.cacheKey(Rd[o],o,C,S);return this.cache[I]||(this.cache[I]=new Qp(this.context,o,Rd[o],S,kg[o],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,d){if(this.style.enable3dLights()){const y=this.style.directionalLight,S=this.style.ambientLight;if(y&&S){const C=((I,j,z)=>{const $=I.properties.get("direction"),q=I.properties.get("color-use-theme")==="none",ee=I.properties.get("color").toNonPremultipliedRenderColor(q?null:z.getLut(I.scope)).toArray01(),Q=I.properties.get("intensity"),ie=j.properties.get("color-use-theme")==="none",le=j.properties.get("color").toNonPremultipliedRenderColor(ie?null:z.getLut(j.scope)).toArray01(),de=j.properties.get("intensity"),be=[$.x,$.y,$.z],_e=r.dM(le,de),Se=r.dM(ee,Q);return{u_lighting_ambient_color:_e,u_lighting_directional_dir:be,u_lighting_directional_color:Se,u_ground_radiance:Rf(be,Se,_e)}})(y,S,this.style);d.setLightsUniformValues(o,C)}}}uploadCommonUniforms(o,d,y,S,C){if(this.uploadCommonLightUniforms(o,d),this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const j=I.getOpacity(this.transform.pitch),z=(($,q,ee,Q,ie,le,de,be,_e,Se,Pe,Ee)=>{const We=$.transform,Ne=q.properties.get("color-use-theme")==="none",Xe=q.properties.get("color").toNonPremultipliedRenderColor(Ne?null:$.style.getLut(q.scope)).toArray01();Xe[3]=Q;const ze=$.frameCounter/1e3%1,[De,Qe]=q.properties.get("vertical-range");return{u_fog_matrix:ee?We.calculateFogTileMatrix(ee):Ee||$.identityMat,u_fog_range:q.getFovAdjustedRange(We._fov),u_fog_color:Xe,u_fog_horizon_blend:q.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(De,Qe),Qe],u_fog_temporal_offset:ze,u_frustum_tl:ie,u_frustum_tr:le,u_frustum_br:de,u_frustum_bl:be,u_globe_pos:_e,u_globe_radius:Se,u_viewport:Pe,u_globe_transition:r.aj(We.zoom),u_is_globe:+(We.projection.name==="globe")}})(this,I,y,j,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],S);d.setFogUniformValues(o,z)}C&&d.setCutoffUniformValues(o,C.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const S of y)d[S.key]=o[S.key]||new da(S,512,this.transform.tileZoom,this,void 0,this.worldview);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,d){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!d||d.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[o.key];return d||(this._cachedTileFogOpacities[o.key]=d=this.style.fog.getOpacityForTile(o)),d[0]>=Ct||d[1]>=Ct}setupDepthForOcclusion(o,d,y){const S=this.context,C=S.gl,I=!!y;var j;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),S.activeTexture.set(C.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((j=this.depthRangeFor3D)[1]-j[0]),-1-2*j[0]/(j[1]-j[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),S.activeTexture.set(C.TEXTURE0),I||d.setTerrainUniformValues(S,y)}}function Uu(g,o){let d=!1,y=null;const S=()=>{y=null,d&&(g(),y=setTimeout(S,o),d=!1)};return()=>(d=!0,y||S(),y)}class $f{constructor(o){this._hashName=o&&encodeURIComponent(o),r.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Uu(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const d=Vg(o);if(this._hashName){const y=this._hashName;let S=!1;const C=location.hash.slice(1).split("&").map((I=>{const j=I.split("=")[0];return j===y?(S=!0,`${j}=${d}`):I})).filter((I=>I));return S||C.push(`${y}=${d}`),`#${C.join("&")}`}return`#${d}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map((y=>y.split("="))).forEach((y=>{y[0]===this._hashName&&(d=y)})),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some((y=>isNaN(Number(y))))){const y=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Vg(g,o){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,S=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,S),I=Math.round(d.lng*C)/C,j=Math.round(d.lat*C)/C,z=g.getBearing(),$=g.getPitch();let q=o?`/${I}/${j}/${y}`:`${y}/${j}/${I}`;return(z||$)&&(q+="/"+Math.round(10*z)/10),$&&(q+=`/${Math.round($)}`),q}const zh={linearity:.3,easing:r.eS(0,0,.3,1)},Vu=Object.assign({deceleration:2500,maxSpeed:1400},zh),Hg=Object.assign({deceleration:20,maxSpeed:1400},zh),Dl=Object.assign({deceleration:1e3,maxSpeed:360},zh),Gg=Object.assign({deceleration:1e3,maxSpeed:90},zh);class $g{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=r.o.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(d.pan.mag()){const C=Vo(d.pan.mag(),y,Object.assign({},Vu,o||{}));S.offset=d.pan.mult(C.amount/d.pan.mag()),S.center=this._map.transform.center,Wo(S,C)}if(d.zoom){const C=Vo(d.zoom,y,Hg);S.zoom=this._map.transform.zoom+C.amount,Wo(S,C)}if(d.bearing){const C=Vo(d.bearing,y,Dl);S.bearing=this._map.transform.bearing+r.aA(C.amount,-179,179),Wo(S,C)}if(d.pitch){const C=Vo(d.pitch,y,Gg);S.pitch=this._map.transform.pitch+C.amount,Wo(S,C)}if(S.zoom||S.bearing){const C=d.pinchAround===void 0?d.around:d.pinchAround;S.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function Wo(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function Vo(g,o,d){const{maxSpeed:y,linearity:S,deceleration:C}=d,I=r.aA(g*S/(o/1e3),-y,y),j=Math.abs(I)/(C*S);return{easing:d.easing,duration:1e3*j,amount:I*(j/2)}}class ys extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y,S={}){const C=xe(d.getCanvasContainer(),y),I=d.unproject(C);super(o,Object.assign({point:C,lngLat:I,originalEvent:y},S)),this._defaultPrevented=!1,this.target=d}}class Uh extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y){const S=o==="touchend"?y.changedTouches:y.touches,C=ae(d.getCanvasContainer(),S),I=C.map((z=>d.unproject(z))),j=C.reduce(((z,$,q,ee)=>z.add($.div(ee.length))),new r.P(0,0));super(o,{points:C,point:j,lngLats:I,lngLat:d.unproject(j),originalEvent:y}),this._defaultPrevented=!1}}class Wg extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class qg{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Wg(this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new ys(o.type,this._map,o))}mouseup(o){this._map.fire(new ys(o.type,this._map,o))}preclick(o){const d=new MouseEvent("preclick",o);this._map.fire(new ys(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new ys(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new ys(o.type,this._map,o))}mouseover(o){this._map.fire(new ys(o.type,this._map,o))}mouseout(o){this._map.fire(new ys(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Uh(o.type,this._map,o))}touchmove(o){this._map.fire(new Uh(o.type,this._map,o))}touchend(o){this._map.fire(new Uh(o.type,this._map,o))}touchcancel(o){this._map.fire(new Uh(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vd{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new ys(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ys("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new ys(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fm{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(K(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const y=d,S=this._startPos,C=this._lastPos;if(!S||!C||C.equals(y)||!this._box&&y.dist(S)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=O("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const I=Math.min(S.x,y.x),j=Math.max(S.x,y.x),z=Math.min(S.y,y.y),$=Math.max(S.y,y.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${I}px,${z}px)`,this._box.style.width=j-I+"px",this._box.style.height=$-z+"px")}))}mouseupWindow(o,d){if(!this._active)return;const y=this._startPos,S=d;if(y&&o.button===0){if(this.reset(),re(),y.x!==S.x||y.y!==S.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:o})),{cameraAnimation:C=>C.fitScreenCoordinates(y,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new r.z(o,{originalEvent:d}))}}function Wf(g,o){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=o[y];return d}class pm{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=(function(S){const C=new r.P(0,0);for(const I of S)C._add(I);return C.div(S.length)})(d),this.touches=Wf(y,d)))}touchmove(o,d,y){if(this.aborted||!this.centroid)return;const S=Wf(y,d);for(const C in this.touches){const I=S[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(o,d,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class Hu{constructor(o){this.singleTap=new pm(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,y){this.singleTap.touchstart(o,d,y)}touchmove(o,d,y){this.singleTap.touchmove(o,d,y)}touchend(o,d,y){const S=this.singleTap.touchend(o,d,y);if(S){const C=o.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(S)<30;if(C&&I||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Xg{constructor(){this._zoomIn=new Hu({numTouches:1,numTaps:2}),this._zoomOut=new Hu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,y){this._zoomIn.touchstart(o,d,y),this._zoomOut.touchstart(o,d,y)}touchmove(o,d,y){this._zoomIn.touchmove(o,d,y),this._zoomOut.touchmove(o,d,y)}touchend(o,d,y){const S=this._zoomIn.touchend(o,d,y),C=this._zoomOut.touchend(o,d,y);return S?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(S)},{originalEvent:o})}):C?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qf={0:1,2:2},Xf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Vh{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const y=ce(o);this._correctButton(o,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(o,d){const y=this._lastPoint;if(y){if(o.preventDefault(),this._eventButton!=null&&(function(S,C){const I=qf[C];return S.buttons===void 0||(S.buttons&I)!==I})(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(o){this._lastPoint&&ce(o)===this._eventButton&&(this._moved&&re(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mm extends Vh{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class Hh extends Vh{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Xf[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const y=.8*(d.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class yy extends Vh{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Xf[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const y=-.5*(d.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class xy{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),r.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,d,y){return this._calculateTransform(o,d,y)}touchmove(o,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!r.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,d,y)}}touchend(o,d,y){this._calculateTransform(o,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,y){y.length>0&&(this._active=!0);const S=Wf(y,d),C=new r.P(0,0),I=new r.P(0,0);let j=0;for(const $ in S){const q=S[$],ee=this._touches[$];ee&&(C._add(q),I._add(q.sub(ee)),j++,S[$]=q)}if(this._touches=S,j<this._minTouches||!I.mag())return;const z=I.div(j);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(j),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Zf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,y){return{}}touchstart(o,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,y){const S=this._firstTwoTouches;if(!S)return;o.preventDefault();const[C,I]=S,j=Qf(y,d,C),z=Qf(y,d,I);if(!j||!z)return;const $=this._aroundCenter?null:j.add(z).div(2);return this._move([j,z],$,o)}touchend(o,d,y){if(!this._firstTwoTouches)return;const[S,C]=this._firstTwoTouches,I=Qf(y,d,S),j=Qf(y,d,C);I&&j||(this._active&&re(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qf(g,o,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return o[y]}function Kf(g,o){return Math.log2(g/o)}class uu extends Zf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Kf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kf(this._distance,y),pinchAround:d}}}function _y(g,o){return 180*g.angleWith(o)/Math.PI}class vy extends Zf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const y=this._vector;if(this._vector=o[0].sub(o[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:_y(this._vector,y),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const S=_y(o,y);return Math.abs(S)<d}}function Yf(g){return Math.abs(g.y)>Math.abs(g.x)}class by extends Zf{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Yf(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,y){const S=this._lastPoints;if(!S)return;const C=o[0].sub(S[0]),I=o[1].sub(S[1]);return this._map._cooperativeGestures&&!r.eT()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,y.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(o,d,y){if(this._valid!==void 0)return this._valid;const S=o.mag()>=2,C=d.mag()>=2;if(!S&&!C)return;if(!S||!C)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const I=o.y>0==d.y>0;return Yf(o)&&Yf(d)&&I}}const wy={panStep:100,bearingStep:15,pitchStep:10};class Jf{constructor(){const o=wy;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,y=0,S=0,C=0,I=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),C=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),C=1);break;case 38:o.shiftKey?S=1:(o.preventDefault(),I=-1);break;case 40:o.shiftKey?S=-1:(o.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(y=0,S=0),{cameraAnimation:j=>{const z=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:ma,zoom:d?Math.round(z)+d*(o.shiftKey?2:1):z,bearing:j.getBearing()+y*this._bearingStep,pitch:j.getPitch()+S*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:j.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ma(g){return g*(2-g)}const h_=4.000244140625,Nb=1/450;class Zg{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nb,r.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=r.o.now(),S=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%h_==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(S*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=xe(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const $=this._type==="wheel"&&Math.abs(this._delta)>h_?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*$)));this._delta<0&&q!==0&&(q=1/q);const ee=d(),Q=Math.pow(2,ee),ie=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(ie*q))),this._type==="wheel"&&(this._startZoom=ee,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),S=this._startZoom,C=this._easing;let I,j=!1;if(this._type==="wheel"&&S&&C){const $=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),q=C($);I=r.ak(S,y,q),$<1?this._frameId||(this._frameId=!0):j=!0}else I=y,j=!0;this._active=!0,j&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let z=I-d();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!j,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=r.eU;if(this._prevEase){const y=this._prevEase,S=(r.o.now()-y.start)/y.duration,C=y.easing(S+.01)-y.easing(S),I=.27/Math.sqrt(C*C+1e-4)*.01,j=Math.sqrt(.0729-I*I);d=r.eS(I,j,.25,1)}return this._prevEase={start:r.o.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Li{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class f_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oi{constructor(){this._tap=new Hu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,d,y))}touchmove(o,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const S=d[0],C=S.y-this._swipePoint.y;return this._swipePoint=S,o.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(o,d,y)}touchend(o,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,d,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep{constructor(o,d,y){this._el=o,this._mousePan=d,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sy{constructor(o,d,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tp{constructor(o,d,y,S){this._el=o,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gm=g=>g.zoom||g.drag||g.pitch||g.rotate;class Gh extends r.z{}class $h{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const y=r.av([],d,o);this.radius=r.ag(y[2]<0?r.eW([],y,this.constants):[y[0],y[1],0])}projectRay(o){r.eW(o,o,this.constants),r.aw(o,o),r.eX(o,o,this.constants);const d=r.c4([],o,this.radius);if(d[2]>0){const y=r.c4([],[0,0,1],r.bI(d,[0,0,1])),S=r.c4([],r.aw([],[d[0],d[1],0]),this.radius),C=r.d7([],d,r.c4([],r.av([],r.d7([],S,y),d),2));d[0]=C[0],d[1]=C[1]}return d}}function pl(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ym{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $g(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $h,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),r.aX(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[S,C,I]of this._listeners){const j=S===document?this.handleWindowEvent:this.handleEvent;S.addEventListener(C,j,I)}}destroy(){for(const[o,d,y]of this._listeners){const S=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(d,S,y)}}_addDefaultHandlers(o){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new qg(d,o));const S=d.boxZoom=new fm(d,o);this._add("boxZoom",S);const C=new Xg,I=new f_;d.doubleClickZoom=new Li(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const j=new oi;this._add("tapDragZoom",j);const z=d.touchPitch=new by(d);this._add("touchPitch",z);const $=new Hh(o),q=new yy(o);d.dragRotate=new Sy(o,$,q),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const ee=new mm(o),Q=new xy(d,o);d.dragPan=new ep(y,ee,Q),this._add("mousePan",ee),this._add("touchPan",Q,["touchZoom","touchRotate"]);const ie=new vy,le=new uu;d.touchZoomRotate=new tp(y,le,ie,j),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vd(d));const de=d.scrollZoom=new Zg(d,this);this._add("scrollZoom",de,["mousePan"]);const be=d.keyboard=new Jf;this._add("keyboard",be);for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&d[_e].enable(o[_e])}_add(o,d,y){this._handlers.push({handlerName:o,handler:d,allowed:y}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gm(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,d,y){for(const S in o)if(S!==y&&(!d||d.indexOf(S)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const y of o)this._el.contains(y.target)&&d.push(y);return d}handleEvent(o,d){this._updatingCamera=!0;const y=o.type==="renderFrame",S=y?void 0:o,C={needsRenderFrame:!1},I={},j={},z=o.touches?this._getMapTouches(o.touches):void 0,$=z?ae(this._el,z):y?void 0:xe(this._el,o);for(const{handlerName:Q,handler:ie,allowed:le}of this._handlers){if(!ie.isEnabled())continue;let de;this._blockedByActive(j,le,Q)?ie.reset():ie[d||o.type]&&(de=ie[d||o.type](o,$,z),this.mergeHandlerResult(C,I,de,Q,S),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||ie.isActive())&&(j[Q]=ie)}const q={};for(const Q in this._previousActiveHandlers)j[Q]||(q[Q]=S);this._previousActiveHandlers=j,(Object.keys(q).length||pl(C))&&(this._changes.push([C,I,q]),this._triggerRenderFrame()),(Object.keys(j).length||pl(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=C;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(o,d,y,S,C){if(!y)return;Object.assign(o,y);const I={handlerName:S,originalEvent:y.originalEvent||C};y.zoomDelta!==void 0&&(d.zoom=I),y.panDelta!==void 0&&(d.drag=I),y.pitchDelta!==void 0&&(d.pitch=I),y.bearingDelta!==void 0&&(d.rotate=I)}_applyChanges(){const o={},d={},y={};for(const[S,C,I]of this._changes)S.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(S.panDelta)),S.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(o.around=S.around),S.aroundCoord!==void 0&&(o.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(o.pinchAround=S.pinchAround),S.noInertia&&(o.noInertia=S.noInertia),Object.assign(d,C),Object.assign(y,I);this._updateMapTransform(o,d,y),this._changes=[]}_updateMapTransform(o,d,y){const S=this._map,C=S.transform,I=Se=>[Se.x,Se.y,Se.z];if((Se=>{const Pe=this._eventsInProgress.drag;return Pe&&!this._handlersById[Pe.handlerName].isActive()})()&&!pl(o)){const Se=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),Se!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&S._stop(!0),!pl(o))return void this._fireEvents(d,y,!0);let{panDelta:j,zoomDelta:z,bearingDelta:$,pitchDelta:q,around:ee,aroundCoord:Q,pinchAround:ie}=o;C._isCameraConstrained&&(z>0&&(z=0),C._isCameraConstrained=!1),ie!==void 0&&(ee=ie),(z||(Se=>d[Se]&&!this._eventsInProgress[Se])("drag"))&&ee&&(this._dragOrigin=I(C.pointCoordinate3D(ee)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",S._stop(!0),ee=ee||S.transform.centerPoint,$&&(C.bearing+=$),q&&(C.pitch+=q),C._updateCameraState();const le=[0,0,0];if(j)if(C.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ee).dir),Pe=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ee.sub(j)).dir);le[0]=Pe[0]-Se[0],le[1]=Pe[1]-Se[1]}else{const Se=C.pointCoordinate(ee);if(C.projection.name==="globe"){j=j.rotate(-C.angle);const Pe=C._pixelsPerMercatorPixel/C.worldSize;le[0]=-j.x*r.eV(r.a_(Se.y))*Pe,le[1]=-j.y*r.eV(C.center.lat)*Pe}else{const Pe=C.pointCoordinate(ee.sub(j));Se&&Pe&&(le[0]=Pe.x-Se.x,le[1]=Pe.y-Se.y)}}const de=C.zoom,be=[0,0,0];if(z){const Se=I(Q||C.pointCoordinate3D(ee)),Pe={dir:r.aw([],r.av([],Se,C._camera.position))};if(Pe.dir[2]<0){const Ee=C.zoomDeltaToMovement(Se,z);r.c4(be,Pe.dir,Ee)}}const _e=r.d7(le,le,be);C._translateCameraConstrained(_e),z&&Math.abs(C.zoom-de)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,y,!0)}_fireEvents(o,d,y){const S=gm(this._eventsInProgress),C=gm(o),I={};for(const q in o){const{originalEvent:ee}=o[q];this._eventsInProgress[q]||(I[`${q}start`]=ee),this._eventsInProgress[q]=o[q]}!S&&C&&this._fireEvent("movestart",C.originalEvent);for(const q in I)this._fireEvent(q,I[q]);C&&this._fireEvent("move",C.originalEvent);for(const q in o){const{originalEvent:ee}=o[q];this._fireEvent(q,ee)}const j={};let z;for(const q in this._eventsInProgress){const{handlerName:ee,originalEvent:Q}=this._eventsInProgress[q];this._handlersById[ee].isActive()||(delete this._eventsInProgress[q],z=d[ee]||Q,j[`${q}end`]=z)}for(const q in j)this._fireEvent(q,j[q]);const $=gm(this._eventsInProgress);if(y&&(S||C)&&!$){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;q?(ee(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:z})):(this._map.fire(new r.z("moveend",{originalEvent:z})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new r.z(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((o=>{this._frameId=void 0,this.handleEvent(new Gh("renderFrame",{timeStamp:o})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ks="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ic extends r.E{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,r.aX(["_renderFrameCallback"],this)}getCenter(){return new r.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,y){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},d),y)}panTo(o,d,y){return this.easeTo(Object.assign({center:o},d),y)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,y){return this.easeTo(Object.assign({zoom:o},d),y)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,y){return this.easeTo(Object.assign({bearing:o},d),y)}resetNorth(o,d){return this.rotateTo(0,Object.assign({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=r.aI.convert(o);const y=d&&d.bearing||0,S=d&&d.pitch||0,C=o.getNorthWest(),I=o.getSouthEast();return this._cameraForBounds(this.transform,C,I,y,S,d)}_extendPadding(o){const d={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},d,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},d,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,d){const y=d.max[0]-d.min[0],S=d.max[1]-d.min[1];return y/S>o.aspect?y/(2*Math.tan(.5*o.fovX)*o.aspect):S/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,d,y,S,C,I){const j=o.clone(),z=this._extendCameraOptions(I);j.bearing=S,j.pitch=C;const $=r.aS.convert(d),q=r.aS.convert(y),ee=.5*($.lat+q.lat),Q=.5*($.lng+q.lng),ie=r.eY(ee,Q),le=r.aw([],ie),de=r.aw([],r.bH([],le,[0,1,0])),be=r.bH([],de,le),_e=[de[0],de[1],de[2],0,be[0],be[1],be[2],0,le[0],le[1],le[2],0,0,0,0,1],Se=[ie,r.eY($.lat,$.lng),r.eY(q.lat,$.lng),r.eY(q.lat,q.lng),r.eY($.lat,q.lng),r.eY(ee,$.lng),r.eY(ee,q.lng),r.eY($.lat,Q),r.eY(q.lat,Q)];let Pe=r.d8.fromPoints(Se.map((Mt=>[r.bI(de,Mt),r.bI(be,Mt),r.bI(le,Mt)])));const Ee=r.af([],Pe.center,_e);r.eZ(Ee)===0&&r.e_(Ee,0,0,1),r.aw(Ee,Ee),r.c4(Ee,Ee,r.aD),j.center=r.e$(Ee);const We=j.getWorldToCameraMatrix(),Ne=r.bk(new Float64Array(16),We);Pe=r.d8.applyTransform(Pe,r.aB([],We,_e));const Xe=this._extendAABB(Pe,j,z,S);if(!Xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Pe=Xe,r.af(Ee,Ee,We);const ze=.5*(Pe.max[2]-Pe.min[2]),De=this._minimumAABBFrustumDistance(j,Pe),Qe=r.c4([],[0,0,1],ze),dt=r.d7(Qe,Ee,Qe),lt=De+(j.pitch===0?0:r.bF(Ee,dt)),Lt=j.globeCenterInViewSpace,Tt=r.av([],Ee,[Lt[0],Lt[1],Lt[2]]);r.aw(Tt,Tt),r.c4(Tt,Tt,lt);const Gt=r.d7([],Ee,Tt);r.af(Gt,Gt,Ne);const hn=r.eL/r.aD,mt=r.ag(Gt),rt=r.ce(Math.max(mt*hn-r.eL,Number.EPSILON),0),zt=Math.min(j.zoomFromMercatorZAdjusted(rt),z.maxZoom);return zt>.5*(r.cZ+r.cK)?(j.setProjection({name:"mercator"}),j.zoom=zt,this._cameraForBounds(j,d,y,S,C,I)):{center:j.center,zoom:zt,bearing:S,pitch:C}}_extendAABB(o,d,y,S){const C=.5*((y.padding.left||0)+(y.padding.right||0)),I=.5*((y.padding.top||0)+(y.padding.bottom||0)),j=I,z=C,$=C,q=I,ee=d.width-(z+$),Q=d.height-(j+q),ie=r.av([],o.max,o.min),le=Math.min(ee/ie[0],Q/ie[1]),de=Math.min(d.scaleZoom(d.scale*le),y.maxZoom);if(isNaN(de))return null;const be=d.scale/d.zoomScale(de),_e=new r.d8([o.min[0]-z*be,o.min[1]-q*be,o.min[2]],[o.max[0]+$*be,o.max[1]+j*be,o.max[2]]),Se=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new r.P(y.offset.x,y.offset.y):r.P.convert(y.offset)).rotate(-r.an(S));return _e.center[0]-=Se.x*be,_e.center[1]+=Se.y*be,_e}queryTerrainElevation(o,d){const y=this.transform.elevation;return y?(d=Object.assign({},{exaggerated:!0},d),y.getAtPoint(r.ae.fromLngLat(o),null,d.exaggerated)):null}_cameraForBounds(o,d,y,S,C,I){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,d,y,S,C,I);const j=o.clone(),z=this._extendCameraOptions(I);j.bearing=S,j.pitch=C;const $=r.aS.convert(d),q=r.aS.convert(y),ee=new r.aS($.lng,q.lat),Q=new r.aS(q.lng,$.lat),ie=j.project($),le=j.project(q),de=this.queryTerrainElevation($),be=this.queryTerrainElevation(q),_e=this.queryTerrainElevation(ee),Se=this.queryTerrainElevation(Q),Pe=[[ie.x,ie.y,Math.min(de||0,be||0,_e||0,Se||0)],[le.x,le.y,Math.max(de||0,be||0,_e||0,Se||0)]];let Ee=r.d8.fromPoints(Pe);const We=j.getWorldToCameraMatrix(),Ne=r.bk(new Float64Array(16),We);Ee=r.d8.applyTransform(Ee,We);const Xe=this._extendAABB(Ee,j,z,S);if(!Xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ee=Xe;const ze=.5*r.av([],Ee.max,Ee.min)[2],De=this._minimumAABBFrustumDistance(j,Ee),Qe=[0,0,1,0];r.aC(Qe,Qe,We),r.f0(Qe,Qe);const dt=r.c4([],Qe,De+ze),lt=r.d7([],Ee.center,dt);r.af(Ee.center,Ee.center,Ne),r.af(lt,lt,Ne);const Lt=j.unproject(new r.P(Ee.center[0],Ee.center[1])),Tt=r.f1(j.projection,Lt),Gt=Math.pow(2,Tt),hn=Math.min(j._zoomFromMercatorZ(lt[2]*j.pixelsPerMeter*Gt/j.worldSize),z.maxZoom);return j.mercatorFromTransition&&hn<.5*(r.cZ+r.cK)?(j.setProjection({name:"globe"}),j.zoom=hn,this._cameraForBounds(j,d,y,S,C,I)):{center:Lt,zoom:hn,bearing:S,pitch:C}}fitBounds(o,d,y){const S=this.cameraForBounds(o,d);return this._fitInternal(S,d,y)}fitScreenCoordinates(o,d,y,S,C){const I=r.P.convert(o),j=r.P.convert(d),z=new r.P(Math.min(I.x,j.x),Math.min(I.y,j.y)),$=new r.P(Math.max(I.x,j.x),Math.max(I.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,j))return this;const q=this.transform.pointLocation3D(z),ee=this.transform.pointLocation3D($),Q=this.transform.pointLocation3D(new r.P(z.x,$.y)),ie=this.transform.pointLocation3D(new r.P($.x,z.y)),le=[Math.min(q.lng,ee.lng,Q.lng,ie.lng),Math.min(q.lat,ee.lat,Q.lat,ie.lat)],de=[Math.max(q.lng,ee.lng,Q.lng,ie.lng),Math.max(q.lat,ee.lat,Q.lat,ie.lat)],be=S&&S.pitch?S.pitch:this.getPitch(),_e=this._cameraForBounds(this.transform,le,de,y,be,S);return this._fitInternal(_e,S,C)}_fitInternal(o,d,y){return o?(d=Object.assign(o,d)).linear?this.easeTo(d,y):this.flyTo(d,y):this}jumpTo(o,d){this.stop();const y=o.preloadOnly?this.transform.clone():this.transform;let S=!1,C=!1,I=!1;"zoom"in o&&y.zoom!==+o.zoom&&(S=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=r.aS.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(C=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(I=!0,y.pitch=+o.pitch);const j=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!y.isPaddingEqual(j))if(o.retainPadding===!1){const z=y.clone();z.padding=j,y.setLocationAtPoint(y.center,z.centerPoint)}else y.padding=j;return o.preloadOnly?(this._preloadTiles(y),this):(this.fire(new r.z("movestart",d)).fire(new r.z("move",d)),S&&this.fire(new r.z("zoomstart",d)).fire(new r.z("zoom",d)).fire(new r.z("zoomend",d)),C&&this.fire(new r.z("rotatestart",d)).fire(new r.z("rotate",d)).fire(new r.z("rotateend",d)),I&&this.fire(new r.z("pitchstart",d)).fire(new r.z("pitch",d)).fire(new r.z("pitchend",d)),this.fire(new r.z("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Ks),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return r.w(Ks),this;this.stop();const S=y.zoom,C=y.pitch,I=y.bearing;y.setFreeCameraOptions(o);const j=S!==y.zoom,z=C!==y.pitch,$=I!==y.bearing;return this.fire(new r.z("movestart",d)).fire(new r.z("move",d)),j&&this.fire(new r.z("zoomstart",d)).fire(new r.z("zoom",d)).fire(new r.z("zoomend",d)),$&&this.fire(new r.z("rotatestart",d)).fire(new r.z("rotate",d)).fire(new r.z("rotateend",d)),z&&this.fire(new r.z("pitchstart",d)).fire(new r.z("pitch",d)).fire(new r.z("pitchend",d)),this.fire(new r.z("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:r.eU},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const y=this.transform,S=this.getZoom(),C=this.getBearing(),I=this.getPitch(),j=this.getPadding(),z="zoom"in o?+o.zoom:S,$="bearing"in o?this._normalizeBearing(o.bearing,C):C,q="pitch"in o?+o.pitch:I,ee=this._extendPadding(o.padding),Q=r.P.convert(o.offset);let ie,le,de;if(y.projection.name==="globe"){const Qe=r.ae.fromLngLat(y.center),dt=Q.rotate(-y.angle);Qe.x+=dt.x/y.worldSize,Qe.y+=dt.y/y.worldSize;const lt=Qe.toLngLat(),Lt=r.aS.convert(o.center||lt);this._normalizeCenter(Lt),ie=y.centerPoint.add(dt),le=new r.P(Qe.x,Qe.y).mult(y.worldSize),de=new r.P(r.aF(Lt.lng),r.aJ(Lt.lat)).mult(y.worldSize).sub(le)}else{ie=y.centerPoint.add(Q);const Qe=y.pointLocation(ie),dt=r.aS.convert(o.center||Qe);this._normalizeCenter(dt),le=y.project(Qe),de=y.project(dt).sub(le)}const be=y.zoomScale(z-S);let _e,Se;o.around&&(_e=r.aS.convert(o.around),Se=y.locationPoint(_e));const Pe=this._zooming||z!==S,Ee=this._rotating||C!==$,We=this._pitching||q!==I,Ne=!y.isPaddingEqual(ee),Xe=o.retainPadding===!1?y.clone():y,ze=Qe=>dt=>{if(Pe&&(Qe.zoom=r.ak(S,z,dt)),Ee&&(Qe.bearing=r.ak(C,$,dt)),We&&(Qe.pitch=r.ak(I,q,dt)),Ne&&(Xe.interpolatePadding(j,ee,dt),ie=Xe.centerPoint.add(Q)),_e)Qe.setLocationAtPoint(_e,Se);else{const lt=Qe.zoomScale(Qe.zoom-S),Lt=z>S?Math.min(2,be):Math.max(.5,be),Tt=Math.pow(Lt,1-dt),Gt=Qe.unproject(le.add(de.mult(dt*Tt)).mult(lt));Qe.setLocationAtPoint(Qe.renderWorldCopies?Gt.wrap():Gt,ie)}return o.preloadOnly||this._fireMoveEvents(d),Qe};if(o.preloadOnly){const Qe=this._emulate(ze,o.duration,y);return this._preloadTiles(Qe),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Pe,this._rotating=Ee,this._pitching=We,this._padding=Ne,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,De),this._ease(ze(y),(Qe=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(d,Qe)}),o),this}_prepareEase(o,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||y.moving||this.fire(new r.z("movestart",o)),this._zooming&&!y.zooming&&this.fire(new r.z("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new r.z("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new r.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.z("move",o)),this._zooming&&this.fire(new r.z("zoom",o)),this._rotating&&this.fire(new r.z("rotate",o)),this._pitching&&this.fire(new r.z("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,S=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new r.z("zoomend",o)),S&&this.fire(new r.z("rotateend",o)),C&&this.fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o))}flyTo(o,d){if(this._prefersReducedMotion(o)){const Mt=r.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Mt,d)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eU},o);const y=this.transform,S=this.getZoom(),C=this.getBearing(),I=this.getPitch(),j=this.getPadding(),z="zoom"in o?r.aA(+o.zoom,y.minZoom,y.maxZoom):S,$="bearing"in o?this._normalizeBearing(o.bearing,C):C,q="pitch"in o?+o.pitch:I,ee=this._extendPadding(o.padding),Q=y.zoomScale(z-S),ie=r.P.convert(o.offset);let le=y.centerPoint.add(ie);const de=y.pointLocation(le),be=r.aS.convert(o.center||de);this._normalizeCenter(be);const _e=y.project(de),Se=y.project(be).sub(_e);let Pe=o.curve;const Ee=Math.max(y.width,y.height),We=Ee/Q,Ne=Se.mag();if("minZoom"in o){const Mt=r.aA(Math.min(o.minZoom,S,z),y.minZoom,y.maxZoom),Jt=Ee/y.zoomScale(Mt-S);Pe=Math.sqrt(Jt/Ne*2)}const Xe=Pe*Pe;function ze(Mt){const Jt=(We*We-Ee*Ee+(Mt?-1:1)*Xe*Xe*Ne*Ne)/(2*(Mt?We:Ee)*Xe*Ne);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function De(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function Qe(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const dt=ze(0);let lt=function(Mt){return Qe(dt)/Qe(dt+Pe*Mt)},Lt=function(Mt){return Ee*((Qe(dt)*(De(Jt=dt+Pe*Mt)/Qe(Jt))-De(dt))/Xe)/Ne;var Jt},Tt=(ze(1)-dt)/Pe;if(Math.abs(Ne)<1e-6||!isFinite(Tt)){if(Math.abs(Ee-We)<1e-6)return this.easeTo(o,d);const Mt=We<Ee?-1:1;Tt=Math.abs(Math.log(We/Ee))/Pe,Lt=function(){return 0},lt=function(Jt){return Math.exp(Mt*Pe*Jt)}}o.duration="duration"in o?+o.duration:1e3*Tt/("screenSpeed"in o?+o.screenSpeed/Pe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Gt=C!==$,hn=q!==I,mt=!y.isPaddingEqual(ee),rt=o.retainPadding===!1?y.clone():y,zt=Mt=>Jt=>{const _n=Jt*Tt,Vn=1/lt(_n);Mt.zoom=Jt===1?z:S+Mt.scaleZoom(Vn),Gt&&(Mt.bearing=r.ak(C,$,Jt)),hn&&(Mt.pitch=r.ak(I,q,Jt)),mt&&(rt.interpolatePadding(j,ee,Jt),le=rt.centerPoint.add(ie));const fn=Jt===1?be:Mt.unproject(_e.add(Se.mult(Lt(_n))).mult(Vn));return Mt.setLocationAtPoint(Mt.renderWorldCopies?fn.wrap():fn,le),Mt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),Mt};if(o.preloadOnly){const Mt=this._emulate(zt,o.duration,y);return this._preloadTiles(Mt),this}return this._zooming=!0,this._rotating=Gt,this._pitching=hn,this._padding=mt,this._prepareEase(d,!1),this._ease(zt(y),(()=>this._afterEase(d)),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,d,y){y.animate===!1||y.duration===0?(o(1),d()):(this._easeStart=r.o.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=r.bS(o,-180,180);const y=Math.abs(o-d);return Math.abs(o-360-d)<y&&(o-=360),Math.abs(o+360-d)<y&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const y=o.lng-d.center.lng;o.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,d,y){const S=Math.ceil(15*d/1e3),C=[],I=o(y.clone());for(let j=0;j<=S;j++){const z=I(j/S);C.push(z.clone())}return C}_preloadTiles(o,d){}}class Hd{constructor(o={}){this.options=o,r.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact,y=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const S=O("span","mapboxgl-ctrl-icon",this._compactButton);return S.setAttribute("aria-hidden","true"),S.setAttribute("title",y),this._innerContainer=O("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(o){const y=d.reduce(((S,C,I)=>(C.value&&(S+=`${C.key}=${C.value}${I<d.length-1?"&":""}`),S)),"?");o.href=`${r.e.FEEDBACK_URL}/${y}#${Vg(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const d=this._map.style._mergedSourceCaches;for(const S in d){const C=d[S];if(C.used){const I=C.getSource();I.attribution&&o.indexOf(I.attribution)<0&&o.push(I.attribution)}}o.sort(((S,C)=>S.length-C.length)),o=o.filter(((S,C)=>{for(let I=C+1;I<o.length;I++)if(o[I].indexOf(S)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wh{constructor(){r.aX(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=O("div","mapboxgl-ctrl");const d=O("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const d in o){const y=o[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class qo{constructor(){r.aX(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(d=>this._onIndoorUpdate(d))),this._container}_createButton(o,d){const y=O("button",o,this._container);return y.type="button",y.addEventListener("click",d),y}_createSeparator(){return O("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,d){this._map&&(o.setAttribute("aria-label",d),o.textContent=d)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const d=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",d&&Array.from(this._container.children).forEach((y=>y.remove())),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const d=this._map;this._model&&d&&d._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));O("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,d){for(let y=0;y<o.length;y++){const S=o[y],C=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(S.id)}));this._setButtonTitle(C,S.zIndex.toString()),this._model&&S.id===this._model.selectedFloorId&&d&&C.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(C),y<o.length-1&&this._createSeparator()}}}class nc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const S of y)if(S.id===o)return void(S.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class rc{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=r.dC((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,y){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+y}}const p_={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ty extends r.z{constructor(o,d,y,S){const{point:C,lngLat:I,originalEvent:j,target:z}=o;super(o.type,{point:C,lngLat:I,originalEvent:j,target:z}),this.preventDefault=()=>{o.preventDefault()},this.id=d,this.interaction=y,this.feature=S}}class Ll{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,d){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const y=d.filter;let S=d.type;y&&this.filters.set(o,r.b5(y)),S==="mouseover"&&(S="mouseenter"),S==="mouseout"&&(S="mouseleave");const C=this.interactionsByType.get(S)||new Map;S==="mouseenter"||S==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,d)):C.size===0&&this.map.on(S,this.handleType),C.size===0&&this.interactionsByType.set(S,C),C.set(o,d),this.typeById.set(o,S)}get(o){const d=this.typeById.get(o);if(!d)return;const y=this.interactionsByType.get(d);return y?y.get(o):void 0}remove(o){const d=this.typeById.get(o);if(!d)return;this.typeById.delete(o),this.filters.delete(o);const y=this.interactionsByType.get(d);y&&(y.delete(o),d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):y.size===0&&this.map.off(d,this.handleType))}queryTargets(o,d){const y=[];for(const[S,C]of d)C.target&&y.push({targetId:S,target:C.target,filter:this.filters.get(S)});return this.map.style.queryRenderedTargets(o,y,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const d=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());d.length&&(o.type="mouseenter",this.handleType(o,d));const y=new Map;for(const[S,{feature:C}]of this.prevHoveredFeatures)this.hoveredFeatures.has(S)||y.set(C.id,C);y.size&&(o.type="mouseleave",this.handleType(o,Array.from(y.values())))}handleOut(o){const d=Array.from(this.hoveredFeatures.values()).map((({feature:y})=>y));d.length&&(o.type="mouseleave",this.handleType(o,d)),this.hoveredFeatures.clear()}handleType(o,d){const y=o.type==="mouseenter";if(y&&!this.interactionsByType.has(o.type))return void r.w("mouseenter interaction required for mouseleave to work.");const S=Array.from(this.interactionsByType.get(o.type)).reverse(),C=!!d;d=d||this.queryTargets(o.point,S);let I=!1;const j=new Set;for(const z of d){for(const[$,q]of S){if(!q.target)continue;const ee=z.variants?z.variants[$]:null;if(ee){for(const Q of ee){if(Is(Q,z,j,$))continue;const ie=new r.dw(z,Q),le=ds(Q,z,$);C&&ie.id!==void 0&&(ie.state=this.map.getFeatureState(ie));const de=y?this.prevHoveredFeatures.get(le):null,be=new Ty(o,$,q,ie),_e=de?de.stop:q.handler(be);if(y&&this.hoveredFeatures.set(le,{feature:z,stop:_e}),_e!==!1){I=!0;break}}if(I)break}}if(I)break}if(!I)for(const[z,$]of S){const{handler:q,target:ee}=$;if(!ee&&q(new Ty(o,z,$,null))!==!1)break}}}function Qg(g,o){if(Array.isArray(g)&&Array.isArray(o)){const d=new Set(g),y=new Set(o);return d.size===y.size&&g.every((S=>y.has(S)))}return r.bx(g,o)}const Ol={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Kg={showCompass:!0,showZoom:!0,visualizePitch:!1};class np{constructor(o,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Hh({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new yy({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),K()}move(o,d){const y=this.map,S=this.mouseRotate.mousemoveWindow(o,d),C=S&&S.bearingDelta;if(C&&y.setBearing(y.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(o,d),j=I&&I.pitchDelta;j&&y.setPitch(y.getPitch()+j)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),xe(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,xe(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ae(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=ae(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function du(g,o,d){if(g=new r.aS(g.lng,g.lat),o){const y=new r.aS(g.lng-360,g.lat),S=new r.aS(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),I=d.locationPoint3D(g).distSqr(o),j=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint3D(y).distSqr(o)<I&&(j||Math.abs(y.lng-d.center.lng)<C)?g=y:d.locationPoint3D(S).distSqr(o)<I&&(j||Math.abs(S.lng-d.center.lng)<C)&&(g=S)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint3D(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const ic={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Xo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Gu extends r.E{constructor(o,d){super(),(o instanceof HTMLElement||d)&&(o=Object.assign({element:o},d)),r.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:y="center",color:S="#3FB1CE",scale:C=1,draggable:I=!1,clickTolerance:j=0,rotation:z=Xo.rotation,rotationAlignment:$=Xo.rotationAlignment,pitchAlignment:q=Xo.pitchAlignment,occludedOpacity:ee=Xo.occludedOpacity,altitude:Q=Xo.altitude}=o||{};this._anchor=y,this._color=S,this._scale=C,this._draggable=I,this._clickTolerance=j,this._rotation=z,this._rotationAlignment=$,this._pitchAlignment=q,this._occludedOpacity=ee,this._altitude=Q,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(de=>{de.preventDefault()})),this._element.addEventListener("mousedown",(de=>{de.preventDefault()}));const ie=this._element.classList;for(const de in ic)ie.remove(`mapboxgl-marker-anchor-${de}`);ie.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=o&&o.className?o.className.trim().split(/\s+/):[];ie.add(...le),this._popup=null}_createDefaultMarker(){const o=O("div"),d=F("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const y=F("radialGradient",{id:"shadowGradient"},F("defs",{},d));F("stop",{offset:"10%","stop-opacity":.4},y),F("stop",{offset:"100%","stop-opacity":.05},y),F("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d)}return F("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),F("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),F("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.aS.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Xo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,y=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,d=this._pos;if(!o||!d)return!1;const y=o.unproject(d,this._altitude),S=o.getFreeCameraOptions();if(!S.position)return!1;const C=S.position.toLngLat();return C.distanceTo(y)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const y=o.unproject(d,this._altitude);let S;o._showingGlobe()&&r.f4(o.transform,this._lngLat)?S=0:(S=1-o._queryFogOpacity(y),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${ic[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const o=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!o||y!=="map")return"";if(!d._showingGlobe()){const z=d.getPitch();return z?`rotateX(${z}deg)`:""}const S=r.cW(r.f5(d.transform,this._lngLat)),C=o.sub(r.f6(d.transform)),I=Math.abs(C.x)+Math.abs(C.y);if(I===0)return"";const j=S/I;return`rotateX(${-C.y*j}deg) rotateY(${C.x*j}deg)`}_calculateZTransform(){const o=this._pos,d=this._map;if(!d||!o)return"";let y=0;const S=this.getRotationAlignment();if(S==="map")if(d._showingGlobe()){const C=d.project(new r.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),I=d.project(new r.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(C);y=r.cW(Math.atan2(I.y,I.x))-90}else y=-d.getBearing();else if(S==="horizon"){const C=r.ah(4,6,d.getZoom()),I=r.f6(d.transform);I.y+=C*d.transform.height;const j=o.sub(I),z=r.cW(Math.atan2(j.y,j.x));y=(z>90?z-270:z+90)*(1-C)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=du(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),d._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const d=this._map;if(!d)return;const y=this._pointerdownPos,S=this._positionDelta;if(y&&S){if(!this._isDragging){const C=this._clickTolerance||d._clickTolerance;if(o.point.dist(y)<C)return;this._isDragging=!0}this._pos=o.point.sub(S),this._lngLat=d.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map,y=this._pos;d&&y&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(y),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Xo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Xo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Xo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Xo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ey={maxWidth:100,unit:"metric"},sc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ps={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ra=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function So(g=new r.P(0,0),o="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(o){case"top":return new r.P(0,g);case"top-left":return new r.P(d,d);case"top-right":return new r.P(-d,d);case"bottom":return new r.P(0,-g);case"bottom-left":return new r.P(d,-d);case"bottom-right":return new r.P(-d,-d);case"left":return new r.P(g,0);case"right":return new r.P(-g,0)}return new r.P(0,0)}return g instanceof r.P||Array.isArray(g)?r.P.convert(g):r.P.convert(g[o]||[0,0])}return{version:v,supported:D.supported,setRTLTextPlugin:r.fa,getRTLTextPluginStatus:r.f9,Map:class extends Ic{constructor(g){E.mark(w.create);const o=g;if((g=Object.assign({},Ol,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&r.f2(window)&&(g.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ad(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new nc,this._domRenderTaskQueue=new nc,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b1(),this._locale=Object.assign({},p_,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new rc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new Ke(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,r.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Rb),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ym(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||r.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new $f(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,Object.assign({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Hd({customAttribution:g.customAttribution})),this._logoControl=new Wh,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(d=>{this._update(d.dataType==="style"),this.fire(new r.z(`${d.dataType}data`,d))})),this.on("dataloading",(d=>{this.fire(new r.z(`${d.dataType}dataloading`,d))})),this._interactions=new Ll(this)}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new r.z("movestart",g)).fire(new r.z("move",g)),this.fire(new r.z("resize",g)),o&&this.fire(new r.z("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(r.aI.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((o=>o.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map((o=>o==="auto"?navigator.language:o)):g}setLanguage(g){const o=this._parseLanguage(g);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,o=g.projection.name;let d;o==="globe"&&g.zoom>=r.cK?(g.setMercatorFromTransition(),d=!0):o==="mercator"&&g.zoom<r.cK&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,o){return this._updateProjection(g||o||{name:"mercator"})}_updateProjection(g){let o;const d=this.transform.mercatorFromTransition;o=g.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate();const y=this.transform.getProjection().name==="mercator"&&d!==this.transform.mercatorFromTransition;return(o||y)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,o){return this.transform.locationPoint3D(r.aS.convert(g),o)}unproject(g,o){return this.transform.pointLocation3D(r.P.convert(g),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,o,d){const y=S=>{let C=[];if(Array.isArray(o)){const I=o.filter((j=>this.getLayer(j)));C=I.length?this.queryRenderedFeatures(S,{layers:I}):[]}else C=this.queryRenderedFeatures(S,{target:o});return C};if(g==="mouseenter"||g==="mouseover"){let S=!1;return{listener:d,targets:o,delegates:{mousemove:I=>{const j=y(I.point);j.length?S||(S=!0,d.call(this,new ys(g,this,I.originalEvent,{features:j}))):S=!1},mouseout:()=>{S=!1}}}}if(g==="mouseleave"||g==="mouseout"){let S=!1;return{listener:d,targets:o,delegates:{mousemove:j=>{y(j.point).length?S=!0:S&&(S=!1,d.call(this,new ys(g,this,j.originalEvent)))},mouseout:j=>{S&&(S=!1,d.call(this,new ys(g,this,j.originalEvent)))}}}}{const S=C=>{const I=y(C.point);I.length&&(C.features=I,d.call(this,C),delete C.features)};return{listener:d,targets:o,delegates:{[g]:S}}}}on(g,o,d){if(typeof o=="function"||d===void 0)return super.on(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const S in y.delegates)this.on(S,y.delegates[S]);return this}once(g,o,d){if(typeof o=="function"||d===void 0)return super.once(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,d);for(const S in y.delegates)this.once(S,y.delegates[S]);return this}off(g,o,d){if(typeof o=="function"||d===void 0)return super.off(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._delegatedListeners?this._delegatedListeners[g]:void 0;return y&&(S=>{for(let C=0;C<S.length;C++){const I=S[C];if(I.listener===d&&Qg(I.targets,o)){for(const j in I.delegates)this.off(j,I.delegates[j]);return S.splice(C,1),this}}})(y),this}queryRenderedFeatures(g,o){if(!this.style)return[];if(g===void 0||g instanceof r.P||Array.isArray(g)||o!==void 0||(o=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!o){const C=this.style.queryRenderedFeatures(g,void 0,this.transform),I=this.style.queryRenderedFeatureset(g,void 0,this.transform);return C.concat(I)}let d=!0;if(o.target&&(d=this._isTargetValid(o.target),d&&!o.layers))return this.style.queryRenderedFeatureset(g,o,this.transform);let y=!0;if(o.layers&&Array.isArray(o.layers)){for(const C of o.layers)if(!this._isValidId(C)){y=!1;break}if(y&&!o.target)return this.style.queryRenderedFeatures(g,o,this.transform)}let S=[];return y&&(S=S.concat(this.style.queryRenderedFeatures(g,o,this.transform))),d&&(S=S.concat(this.style.queryRenderedFeatureset(g,o,this.transform))),S}querySourceFeatures(g,o){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,o)}queryRasterValue(g,o,d){return this._isValidId(g)?this.style.queryRasterValue(g,o,d):Promise.resolve(null)}isPointOnSurface(g){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(g))}addInteraction(g,o){return this._interactions.add(g,o),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&g&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(g,((d,y)=>{if(d){const S=typeof d=="string"?d:d instanceof Error?d.message:d.error;r.w(`Unable to perform style diff: ${S}. Rebuilding the style from scratch.`),this._updateStyle(g,o)}else y&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(g,o))}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=Object.assign({},o);o&&o.config&&(d.initialConfig=o.config,delete d.config),this.style=new cl(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new cl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dq(g)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const o of g)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(g)}addSource(g,o){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,o,{pixelRatio:d=1,sdf:y=!1,stretchX:S,stretchY:C,content:I}={}){this._lazyInitEmptyStyle();const j=r.I.from(g);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:z,height:$,data:q}=r.o.getImageData(o);this.style.addImage(j,{data:new r.q({width:z,height:$},q),pixelRatio:d,stretchX:S,stretchY:C,content:I,sdf:y,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:$}=o,q=o;this.style.addImage(j,{data:new r.q({width:z,height:$},new Uint8Array(q.data)),pixelRatio:d,stretchX:S,stretchY:C,content:I,sdf:y,usvg:!1,version:0,userImage:q}),q.onAdd&&q.onAdd(this,g)}}updateImage(g,o){this._lazyInitEmptyStyle();const d=r.I.from(g),y=this.style.getImage(d);if(!y)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.o.getImageData(o):o,{width:C,height:I,data:j}=S;if(C===void 0||I===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==(y.usvg?y.icon.usvg_tree.width:y.data.width)||I!==(y.usvg?y.icon.usvg_tree.height:y.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${C}, ${I})
                must be that same as the previous version of the image
                (${y.data.width}, ${y.data.height})`)));const z=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let $=!1;y.usvg?(y.data=new r.q({width:C,height:I},new Uint8Array(j)),y.usvg=!1,y.icon=void 0,$=!0):y.data.replace(j,z),this.style.updateImage(d,y,$)}hasImage(g){return g?!!this.style&&!!this.style.getImage(r.I.from(g)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(r.I.from(g))}loadImage(g,o){r.n(this._requestManager.transformRequest(g,r.R.Image),((d,y)=>{o(d,y instanceof HTMLImageElement?r.o.getImageData(y):y)}))}listImages(){return this.style.listImages().map((g=>g.name))}addModel(g,o){this._lazyInitEmptyStyle(),this.style.addModel(g,o)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,o){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)):this}getSlot(g){const o=this.getLayer(g);return o&&o.slot||null}setSlot(g,o){return this.style.setSlot(g,o),this.style.mergeLayers(),this._update(!0)}addImport(g,o){return this.style.addImport(g,o).catch((d=>this.fire(new r.y(new Error("Failed to add import",d))))),this}updateImport(g,o){return typeof o!="string"&&o.id!==g?(this.removeImport(g),this.addImport(o)):(this.style.updateImport(g,o),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,o){return this.style.moveImport(g,o),this._update(!0)}moveLayer(g,o){return this._isValidId(g)?(this.style.moveLayer(g,o),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const o=this.style.getOwnLayer(g);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,o,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,o,d),this._update(!0)):this}setFilter(g,o,d={}){return this._isValidId(g)?(this.style.setFilter(g,o,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,o,d,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,o,d,y),this._update(!0)):this}getPaintProperty(g,o){return this._isValidId(g)?this.style.getPaintProperty(g,o):null}setLayoutProperty(g,o,d,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,o,d,y),this._update(!0)):this}getLayoutProperty(g,o){return this._isValidId(g)?this.style.getLayoutProperty(g,o):null}setLayerProperty(g,o,d,y={}){return this._isValidId(g)?(this.style.setLayerProperty(g,o,d,y),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,o){return this.style.setSchema(g,o),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,o){return this.style.setConfig(g,o),this._update(!0)}getConfigProperty(g,o){return this.style.getConfigProperty(g,o)}setConfigProperty(g,o,d){return this.style.setConfigProperty(g,o,d),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const o=g[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,o),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aS.convert(g),this.transform):0}setFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,o),this._update())}removeFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,o),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_selectIndoorFloor(g){this.indoor.selectFloor(g)}_setIndoorActiveFloorsVisibility(g){this.indoor.setActiveFloorsVisibility(g)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new qo),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,y,S,C=this._container;for(;C&&(!y||!S);){const I=window.getComputedStyle(C).transform;I&&I!=="none"&&(d=I.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(S=d[3])),C=C.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=S?Math.abs(o/S):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Md(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=O("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=O("div","mapboxgl-canvas-container",g);this._canvas=O("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=O("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((S=>{y[S]=O("div",`mapboxgl-ctrl-${S}`,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o){const d=r.o.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const o=this._markers.indexOf(g);o!==-1&&this._markers.splice(o,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const o=this._popups.indexOf(g);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const g=Object.assign({},D.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",g);o?($r(o,!0),this.painter=new jl(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),r.k.testSupport(o)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let o;this.fire(new r.z("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,y=r.o.now(),S=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=S.createQuery(),S.beginQuery(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,q=this.transform.pitch,ee=r.o.now(),Q=new r.ac($,{now:ee,fadeDuration:C,pitch:q,transition:this.style.transition,worldview:this._worldview});this.style.update(Q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(y),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(y);const j=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),j&&(this._placementDirty=j.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,E.mark(w.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const $=r.o.now()-y;S.endQuery(d.TIME_ELAPSED_EXT),setTimeout((()=>{const q=S.getQueryParameter(o,S.QUERY_RESULT)/1e6;S.deleteQuery(o),this.fire(new r.z("gpu-timing-frame",{cpuTime:$,gpuTime:q}))}),50)}if(this.listens("gpu-timing-layer")){const $=this.painter.collectGpuTimers();setTimeout((()=>{const q=this.painter.queryGpuTimers($);this.fire(new r.z("gpu-timing-layer",{layerTimes:q}))}),50)}if(this.listens("gpu-timing-deferred-render")){const $=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const q=this.painter.queryGpuTimeDeferredRender($);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:q}))}),50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(z||this._repaint)this.triggerRepaint();else{const $=this.idle();if($&&(I=this._updateAverageElevation(y,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),$&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const q=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,E.mark(w.fullLoad),this._performanceMetricsCollection&&on(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const o of this._markers)g&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!g||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(g,o=!1){const d=S=>(this.transform.averageElevation=S,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(o||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const S=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=g;const I=Math.abs(S-C);if(I>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(C),d(C);this._averageElevation.easeTo(C,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(C),d(C)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){Hr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(g=>{if(g&&(g.message===Me||g.status===401)){const o=this.painter.context.gl;$r(o,!1),this._logoControl instanceof Wh&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),yt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&_t(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&qt(this._requestManager._customAccessToken)}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function S(C){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,C,0);const I=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,I),I}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(S(g),o.canvasCopies.map(S),o.timeStamps)}_canvasPixelComparison(g,o,d){let y=d[1]-d[0];const S=g.length/4;for(let C=0;C<o.length;C++){const I=o[C];let j=0;for(let z=0;z<I.length;z+=4)I[z]===g[z]&&I[z+1]===g[z+1]&&I[z+2]===g[z+2]&&I[z+3]===g[z+3]&&(j+=1);y+=(d[C+2]-d[C+1])*(1-j/S)}return y}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Un.delete(this.painter.context.gl),mn.remove(),bt.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=r.o.frame((o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)})))}_preloadTiles(g){const o=this.style?this.style.getSourceCaches():[];return r.bv(o,((d,y)=>d._preloadTiles(g,y)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,o){r.f3(g,o)}get version(){return v}},NavigationControl:class{constructor(g={}){this.options=Object.assign({},Kg,g),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this.options.showZoom&&(r.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(o=>{this._map&&this._map.zoomIn({},{originalEvent:o})})),O("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(o=>{this._map&&this._map.zoomOut({},{originalEvent:o})})),O("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))})),this._compassIcon=O("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const o=g.getZoom(),d=o===g.getMaxZoom(),y=o===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=o)}))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new np(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,o){const d=O("button",g,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(g,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends r.E{constructor(g={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},ml,g),r.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Uu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const o=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((d=>o(d.state!=="denied"))).catch((()=>o())):o()}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),d=g.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:g.coords,timestamp:g.timestamp},g.toJSON?{toJSON:g.toJSON.bind(g)}:{}))),this._finish()}}_updateCamera(g){const o=new r.aS(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),S=Object.assign({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),S,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new r.aS(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,o=r.ce(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this._geolocateButton=O("button","mapboxgl-ctrl-geolocate",this._container),O("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O("div","mapboxgl-user-location"),this._dotElement.appendChild(O("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(O("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=O("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))}))}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((o=>{o==="granted"&&g()})).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hd,ScaleControl:class{constructor(g={}){this.options=Object.assign({},Ey,g),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),r.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,o=this._map,d=o._containerHeight/2,y=o._containerWidth/2-g/2,S=o.unproject([y,d]),C=o.unproject([y+g,d]),I=S.distanceTo(C);if(this.options.unit==="imperial"){const j=3.2808*I;j>5280?this._setScale(g,j/5280,"mile"):this._setScale(g,j,"foot")}else this.options.unit==="nautical"?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,o,d){this._map._requestDomTask((()=>{const y=(function(C){const I=Math.pow(10,`${Math.floor(C)}`.length-1);let j=C/I;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:(function(z){const $=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*$)/$})(j),I*j})(o),S=y/o;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(y):`${y}&nbsp;${sc[d]}`,this._container.style.width=g*S+"px"}))}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:r.w("Full screen control 'container' must be a DOM element.")),r.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=O("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:qo,Popup:class extends r.E{constructor(g){super(),this.options=Object.assign(Object.create(Ps),g),this._altitude=this.options.altitude,r.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=r.aS.convert(g),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=O("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(g),this.options.closeButton){const d=this._closeButton=O("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.innerHTML='<span aria-hidden="true">&#215;</span>',d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let o;return this._classList.delete(g)?o=!1:(this._classList.add(g),o=!0),this._updateClassList(),o}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,y=this._pos;if(!o||!d||!y)return"bottom";const S=d.offsetWidth,C=d.offsetHeight,I=y.x<S/2,j=y.x>o.transform.width-S/2;if(y.y+g<C)return I?"top-left":j?"top-right":"top";if(y.y>o.transform.height-C){if(I)return"bottom-left";if(j)return"bottom-right"}return I?"left":j?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),g.className=o.join(" ")}_update(g){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=O("div","mapboxgl-popup",o.getContainer()),this._tip=O("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=du(this._lngLat,this._pos,o.transform)),!this._trackPointer||g){const S=this._pos=this._trackPointer&&g instanceof r.P?g:o.project(this._lngLat,this._altitude),C=So(this.options.offset),I=this._anchor=this._getAnchor(C.y),j=So(this.options.offset,I),z=S.add(j).round();o._requestDomTask((()=>{this._container&&I&&(this._container.style.transform=`${ic[I]} translate(${z.x}px,${z.y}px)`)}))}if(!this._marker&&o._showingGlobe()){const S=r.f4(o.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ra);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Gu,Style:cl,LngLat:r.aS,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:al,Evented:r.E,config:r.e,prewarm:r.f8,clearPrewarmedResources:r.f7,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(g){r.e.ACCESS_TOKEN=g},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(g){r.e.API_URL=g},get workerCount(){return r.fh.workerCount},set workerCount(g){r.fh.workerCount=g},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){r.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){r.fg(g)},get workerUrl(){return r.ff.workerUrl},set workerUrl(g){r.ff.workerUrl=g},get workerClass(){return r.ff.workerClass},set workerClass(g){r.ff.workerClass=g},get workerParams(){return r.ff.workerParams},set workerParams(g){r.ff.workerParams=g},get dracoUrl(){return r.fe()},set dracoUrl(g){r.fd(g)},get meshoptUrl(){return r.fc()},set meshoptUrl(g){r.fb(g)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}}));var p=l;return p}))})(QT)),QT.exports}var fve=hve();const Na=Wx(fve),pve="pk.eyJ1IjoicGFoaXYiLCJhIjoiY21ocm1pbDl6MDlxbDJxc2RmZTFxanhhdyJ9.0NYhap2uwOXs6slRCnKS4g";Na.accessToken=pve;const up={1:"#10b981",2:"#3b82f6",3:"#f59e0b",4:"#ef4444",5:"#8b5cf6"},mve=({quests:t,userLocation:e,onQuestSelect:n,height:s="600px",questToZoom:l,onZoomComplete:u,onAcceptQuest:p})=>{const r=he.useRef(null),v=he.useRef(null),[w,E]=he.useState(null),[T,k]=he.useState(!1),R=he.useRef(null),D=he.useRef(!1),[O,F]=he.useState(2.5),U=he.useRef(null),[X,W]=he.useState(!1),[K,ne]=he.useState(!1),{user:te}=ba(),{user:re}=El(),xe=te||re,ae=he.useCallback(()=>{if(!v.current||!T||(v.current.getLayer("quests-circles")&&v.current.removeLayer("quests-circles"),v.current.getLayer("quests-labels")&&v.current.removeLayer("quests-labels"),v.current.getSource("quests")&&v.current.removeSource("quests"),t.length===0))return;const ye=t.filter(Ce=>Ce.latitude&&Ce.longitude).map(Ce=>({type:"Feature",geometry:{type:"Point",coordinates:[Ce.longitude,Ce.latitude]},properties:{id:Ce.id,difficulty:Ce.difficulty,quest_type:Ce.quest_type||"standard",title:Ce.title,location:Ce.location,description:Ce.description,reward_tokens:Ce.reward_tokens,reward_xp:Ce.reward_xp}}));v.current.addSource("quests",{type:"geojson",data:{type:"FeatureCollection",features:ye}}),v.current.addLayer({id:"quests-circles",type:"circle",source:"quests",paint:{"circle-radius":["interpolate",["linear"],["zoom"],2,4,5,8,10,12,14,16],"circle-color":["match",["get","difficulty"],1,up[1],2,up[2],3,up[3],4,up[4],5,up[5],up[1]],"circle-stroke-width":["interpolate",["linear"],["zoom"],2,1,5,2,10,3,14,4],"circle-stroke-color":"#ffffff","circle-opacity":.9}}),v.current.addLayer({id:"quests-labels",type:"symbol",source:"quests",layout:{"text-field":["get","title"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.5],"text-anchor":"top","text-size":["interpolate",["linear"],["zoom"],10,10,14,12]},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":2,"text-halo-blur":1},minzoom:10}),v.current.on("click","quests-circles",Ce=>{var Me;if(Ce.features&&Ce.features[0]){const Ke=(Me=Ce.features[0].properties)==null?void 0:Me.id,ke=t.find(je=>je.id===Ke);ke&&n&&n(ke)}}),v.current.on("mouseenter","quests-circles",()=>{v.current&&(v.current.getCanvas().style.cursor="pointer")}),v.current.on("mouseleave","quests-circles",()=>{v.current&&(v.current.getCanvas().style.cursor="")})},[t,T,n]);he.useEffect(()=>{if(!r.current||v.current)return;let ye=[0,0];if(t.length>0){const Ce=new Na.LngLatBounds;if(t.forEach(Me=>{Me.latitude&&Me.longitude&&Ce.extend([Me.longitude,Me.latitude])}),!Ce.isEmpty()){const Me=Ce.getCenter();ye=[Me.lng,Me.lat]}}return v.current=new Na.Map({container:r.current,style:"mapbox://styles/mapbox/dark-v11",center:ye,zoom:2.5,pitch:0,bearing:0}),v.current.on("load",()=>{k(!0),F(v.current.getZoom()),t.length>0&&setTimeout(()=>{v.current&&ae()},100)}),v.current.on("zoom",()=>{v.current&&F(v.current.getZoom())}),v.current.addControl(new Na.NavigationControl,"top-right"),v.current.addControl(new Na.FullscreenControl,"top-right"),()=>{v.current&&(v.current.getLayer("quests-circles")&&v.current.removeLayer("quests-circles"),v.current.getLayer("quests-labels")&&v.current.removeLayer("quests-labels"),v.current.getSource("quests")&&v.current.removeSource("quests"),v.current.remove(),v.current=null),R.current&&(R.current.remove(),R.current=null),k(!1)}},[]),he.useEffect(()=>{!v.current||!T||l||D.current||ae()},[t,T,l,ae]),he.useEffect(()=>{if(!v.current||!T||!l)return;const ye=l;if(!ye.latitude||!ye.longitude)return;const Ce=U.current&&U.current.id!==ye.id;D.current=!0,v.current.stop();const Me=v.current.getZoom();Ce||Me>3?(v.current.flyTo({center:[ye.longitude,ye.latitude],zoom:2,pitch:0,bearing:0,duration:1e3,essential:!0,easing:Ke=>Ke<.5?4*Ke*Ke*Ke:1-Math.pow(-2*Ke+2,3)/2}),v.current.once("moveend",()=>{v.current&&(v.current.flyTo({center:[ye.longitude,ye.latitude],zoom:17,pitch:0,bearing:0,duration:2e3,essential:!0,easing:Ke=>Ke<.5?4*Ke*Ke*Ke:1-Math.pow(-2*Ke+2,3)/2}),v.current.once("moveend",()=>{v.current&&(D.current=!1,F(17),ae(),v.current.getLayer("quests-circles")&&(v.current.setPaintProperty("quests-circles","circle-radius",["case",["==",["get","id"],ye.id],20,["interpolate",["linear"],["zoom"],2,4,5,8,10,12,14,16]]),setTimeout(()=>{v.current&&v.current.getLayer("quests-circles")&&v.current.setPaintProperty("quests-circles","circle-radius",["interpolate",["linear"],["zoom"],2,4,5,8,10,12,14,16])},1e3)),U.current=ye,E(ye),W(!0),u&&u())}))})):(v.current.flyTo({center:[ye.longitude,ye.latitude],zoom:17,pitch:0,bearing:0,duration:2e3,essential:!0,easing:Ke=>Ke<.5?4*Ke*Ke*Ke:1-Math.pow(-2*Ke+2,3)/2}),v.current.once("moveend",()=>{v.current&&(D.current=!1,F(17),ae(),v.current.getLayer("quests-circles")&&(v.current.setPaintProperty("quests-circles","circle-radius",["case",["==",["get","id"],ye.id],20,["interpolate",["linear"],["zoom"],2,4,5,8,10,12,14,16]]),setTimeout(()=>{v.current&&v.current.getLayer("quests-circles")&&v.current.setPaintProperty("quests-circles","circle-radius",["interpolate",["linear"],["zoom"],2,4,5,8,10,12,14,16])},1e3)),U.current=ye,E(ye),W(!0),u&&u())}))},[l,T,u,ae]),he.useEffect(()=>{if(!(!v.current||!e))if(R.current)R.current.setLngLat([e.lng,e.lat]);else{const ye=document.createElement("div");ye.style.width="20px",ye.style.height="20px",ye.style.borderRadius="50%",ye.style.backgroundColor="#3b82f6",ye.style.border="3px solid white",ye.style.boxShadow="0 0 15px rgba(59, 130, 246, 0.6)",R.current=new Na.Marker(ye).setLngLat([e.lng,e.lat]).addTo(v.current)}},[e]);const ce=ye=>({1:"Easy",2:"Medium",3:"Hard",4:"Very Hard",5:"Expert"})[ye]||"Unknown";return f.jsxs("div",{className:"relative w-full",style:{height:s,minHeight:s},children:[f.jsx("div",{ref:r,className:"absolute inset-0 w-full h-full",style:{borderRadius:"0.75rem"}}),!T&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm z-0",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent"})}),w&&X&&f.jsx("div",{className:"absolute top-4 left-4 max-w-sm z-10",children:f.jsxs("div",{className:"backdrop-blur-xl bg-black/80 border border-white/10 rounded-xl p-4 shadow-2xl",children:[f.jsxs("div",{className:"flex items-start justify-between mb-3",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:w.title}),f.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[f.jsx(Mo,{className:"w-3 h-3"}),f.jsx("span",{children:w.location})]})]}),f.jsx("button",{onClick:()=>{E(null),W(!1)},className:"ml-2 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white transition-all",children:f.jsx(Qa,{className:"w-4 h-4"})})]}),f.jsx("p",{className:"text-sm text-white/80 mb-3 line-clamp-2",children:w.description}),f.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[f.jsx("div",{className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:`${up[w.difficulty]}20`,color:up[w.difficulty],border:`1px solid ${up[w.difficulty]}40`},children:ce(w.difficulty)}),w.quest_type==="sponsored"&&f.jsx("div",{className:"px-2 py-1 rounded-lg text-xs font-medium bg-yellow-500/20 text-yellow-400 border border-yellow-500/40",children:"Sponsored"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(Ja,{className:"w-4 h-4 text-yellow-400"}),f.jsxs("span",{className:"text-white/80",children:[w.reward_tokens," TPX"]})]}),f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx(F0,{className:"w-4 h-4 text-blue-400"}),f.jsxs("span",{className:"text-white/80",children:[w.reward_xp," XP"]})]})]}),f.jsx("button",{onClick:async()=>{if(!xe||!w){alert("Please connect your wallet or sign in to accept quests");return}ne(!0);try{await IN(xe.id,w.id),p&&p(w),alert('Quest accepted! You can now find it in "My Quests" section.'),E(null),W(!1)}catch(ye){console.error("Error accepting quest:",ye),alert(ye.message||"Failed to accept quest")}finally{ne(!1)}},disabled:K||!xe,className:"w-full py-2.5 px-4 rounded-lg font-semibold text-white backdrop-blur-xl bg-white/10 border border-white/30 hover:bg-white/15 hover:border-white/40 transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:K?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),f.jsx("span",{children:"Accepting..."})]}):xe?f.jsxs(f.Fragment,{children:[f.jsx(la,{className:"w-4 h-4"}),f.jsx("span",{children:"Accept Quest"})]}):f.jsxs(f.Fragment,{children:[f.jsx(la,{className:"w-4 h-4"}),f.jsx("span",{children:"Sign In to Accept"})]})})]})}),f.jsx("div",{className:"absolute bottom-4 left-4 z-10",children:f.jsxs("div",{className:"backdrop-blur-xl bg-black/60 border border-white/10 rounded-xl p-3",children:[f.jsx("div",{className:"text-xs text-white/60 mb-2",children:"Quest Difficulty"}),f.jsx("div",{className:"space-y-1",children:Object.entries(up).map(([ye,Ce])=>f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Ce}}),f.jsxs("span",{className:"text-xs text-white/80",children:["Level ",ye]})]},ye))})]})}),f.jsx("div",{className:"absolute bottom-4 right-4 z-10",children:f.jsx("div",{className:"backdrop-blur-xl bg-black/60 border border-white/10 rounded-xl px-3 py-2",children:f.jsxs("div",{className:"text-sm font-medium text-white",children:[t.length," ",t.length===1?"Quest":"Quests"]})})})]})},FW=he.createContext(void 0),gve=({children:t})=>{const[e,n]=he.useState(!1),[s,l]=he.useState(!0),[u,p]=he.useState(typeof window<"u"?window.innerWidth:1920);he.useEffect(()=>{const w=window.matchMedia("(prefers-reduced-motion: reduce)"),E=T=>{n(T.matches)};return E(w),w.addEventListener("change",E),()=>{w.removeEventListener("change",E)}},[]),he.useEffect(()=>{const w=()=>{p(window.innerWidth)};return window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w)}},[]);const r=he.useMemo(()=>e||!s?0:u<768?5:u<1024?7:10,[u,e,s]),v=he.useMemo(()=>({theme:gs,animations:{enabled:s&&!e,particleCount:r,reducedMotion:e},setAnimationsEnabled:l}),[s,r,e]);return f.jsx(FW.Provider,{value:v,children:t})},BW=()=>{const t=he.useContext(FW);if(t===void 0)throw new Error("useHalloweenTheme must be used within a HalloweenProvider");return t},Jx=()=>{const{animations:t}=BW();return t.enabled},yve=()=>{const{animations:t}=BW();return t.particleCount},xve={sm:"px-3 py-1.5 text-sm rounded-lg",md:"px-6 py-3 rounded-lg",lg:"px-8 py-4 text-lg rounded-xl"},_ve={primary:{bg:gs.colors.primary.bloodOrange,hoverBg:gs.colors.accent.pumpkinOrange,text:gs.colors.accent.ghostlyWhite,border:"transparent",glow:gs.colors.primary.bloodOrange},secondary:{bg:gs.colors.primary.deepPurple,hoverBg:gs.colors.primary.midnightBlue,text:gs.colors.accent.ghostlyWhite,border:gs.colors.accent.pumpkinOrange,glow:gs.colors.accent.pumpkinOrange},ghost:{bg:"transparent",hoverBg:`${gs.colors.primary.deepPurple}33`,text:gs.colors.accent.ghostlyWhite,border:gs.colors.accent.ghostlyWhite,glow:gs.colors.accent.ghostlyWhite}},Vc=({children:t,variant:e="primary",size:n="md",onClick:s,disabled:l=!1,className:u="",type:p="button","aria-label":r})=>{const v=Jx(),[w,E]=he.useState(!1),T=_ve[e],k=()=>{l||(v&&(E(!0),setTimeout(()=>E(!1),1e3)),s==null||s())},R={initial:{scale:1,boxShadow:`0 0 10px ${T.glow}33`},hover:{scale:1.05,boxShadow:`0 0 20px ${T.glow}66, 0 0 40px ${T.glow}33`},tap:{scale:.95}};return f.jsxs("div",{className:"relative inline-block",children:[f.jsxs(it.button,{type:p,className:`
          relative font-semibold
          transition-all duration-300
          disabled:opacity-50 disabled:cursor-not-allowed
          overflow-hidden flex items-center justify-center
          focus:outline-none focus-visible:ring-2 focus-visible:ring-pumpkinOrange focus-visible:ring-offset-2 focus-visible:ring-offset-deepPurple
          ${xve[n]}
          ${u}
        `,style:{backgroundColor:T.bg,color:T.text,border:`2px solid ${T.border}`},variants:v&&!l?R:{},initial:"initial",whileHover:l?void 0:"hover",whileTap:l?void 0:"tap",onClick:k,disabled:l,"aria-label":r,"aria-disabled":l,children:[v&&!l&&f.jsx(it.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0",style:{backgroundSize:"200% 100%"},whileHover:{opacity:[0,.3,0],backgroundPosition:["0% 0%","200% 0%"]},transition:{duration:1,ease:"linear"}}),f.jsx("span",{className:"relative z-10",children:t})]}),f.jsx(Xc,{children:w&&v&&f.jsx(it.div,{className:"absolute text-2xl pointer-events-none",style:{left:"50%",top:"50%"},initial:{x:-50,y:0,opacity:0,rotate:-45},animate:{x:100,y:-50,opacity:[0,1,1,0],rotate:0},exit:{opacity:0},transition:{duration:1,ease:"easeOut"},children:""})})]})},vve={badge:["","","",""],quest:["","","",""],achievement:["","","",""],levelUp:["","","",""]},bve=(t,e=20)=>{const n=vve[t],s=[];for(let l=0;l<e;l++)s.push({id:l,emoji:n[Math.floor(Math.random()*n.length)],x:50,y:50,rotation:Math.random()*360,scale:Math.random()*.5+.5,velocityX:(Math.random()-.5)*100,velocityY:(Math.random()-.5)*100-50});return s},XA=({type:t,onComplete:e,duration:n=3e3})=>{const s=Jx(),[l]=he.useState(()=>bve(t)),[u,p]=he.useState(!0);return he.useEffect(()=>{if(!s){e==null||e();return}const r=setTimeout(()=>{p(!1),setTimeout(()=>{e==null||e()},500)},n);return()=>clearTimeout(r)},[n,e,s]),s?f.jsx(Xc,{children:u&&f.jsxs("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:[f.jsx(it.div,{className:"absolute",initial:{scale:0,opacity:1},animate:{scale:3,opacity:0},exit:{opacity:0},transition:{duration:1.5,ease:"easeOut"},children:f.jsx("div",{className:"w-32 h-32 rounded-full",style:{background:"radial-gradient(circle, rgba(255, 107, 53, 0.8) 0%, rgba(255, 149, 0, 0) 70%)"}})}),(t==="quest"||t==="achievement")&&f.jsx(it.div,{className:"absolute text-8xl",initial:{y:100,opacity:0,scale:0},animate:{y:[100,-20,0,-10,0],opacity:[0,1,1,1,0],scale:[0,1.2,1,1.1,.8]},transition:{duration:2,times:[0,.3,.5,.7,1],ease:"easeOut"},children:""}),[...Array(3)].map((r,v)=>f.jsx(it.div,{className:"absolute text-4xl",initial:{x:-100,y:Math.random()*200-100,opacity:0},animate:{x:window.innerWidth+100,y:Math.random()*200-100,opacity:[0,1,1,0]},transition:{duration:2,delay:v*.3,ease:"linear"},children:""},`bat-${v}`)),l.map(r=>f.jsx(it.div,{className:"absolute text-2xl",style:{left:"50%",top:"50%"},initial:{x:0,y:0,opacity:1,rotate:r.rotation,scale:r.scale},animate:{x:r.velocityX,y:r.velocityY,opacity:0,rotate:r.rotation+360},transition:{duration:1.5,ease:"easeOut"},children:r.emoji},r.id)),t==="levelUp"&&f.jsx(it.div,{className:"absolute text-6xl font-bold text-pumpkinOrange",initial:{scale:0,opacity:0},animate:{scale:[0,1.2,1],opacity:[0,1,1,0]},transition:{duration:2,times:[0,.3,.7,1]},style:{textShadow:"0 0 20px rgba(255, 149, 0, 0.8)"},children:"LEVEL UP!"})]})}):null},mz=({onNavigate:t})=>{const{user:e,address:n,isConnected:s,tpxBalance:l}=ba(),{user:u}=El(),p=e||u,r=l||0,[v,w]=he.useState([]),[E,T]=he.useState({xp:0,level:1,questsCompleted:0,tokens:0,totalTokensEarned:0}),[k,R]=he.useState(!1),[D,O]=he.useState(!1),[F,U]=he.useState(null),[X,W]=he.useState(!1),[K,ne]=he.useState(null),[te,re]=he.useState(null),[xe,ae]=he.useState(null),[ce,ye]=he.useState(!1);he.useEffect(()=>{Me(),p&&Ce()},[p]),he.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(je=>{ne({lat:je.coords.latitude,lng:je.coords.longitude})},()=>{});const ke=je=>{const $e=je.detail;O(!0),ae($e)};return window.addEventListener("showQuestOnMap",ke),()=>{window.removeEventListener("showQuestOnMap",ke)}},[O,ae]);const Ce=async()=>{if(p)try{const ke=await bN(p.id);if(ke){const je=typeof ke.total_tokens_earned=="string"?parseFloat(ke.total_tokens_earned)||0:ke.total_tokens_earned||0,$e=ke.total_xp||0,Ae=Math.floor(Math.sqrt($e/100))+1,He=E.level;Ae>He&&He>0&&(console.log("[Dashboard] Level up detected!",{oldLevel:He,newLevel:Ae}),ye(!0)),T({xp:$e,level:Ae,questsCompleted:ke.quests_completed||0,tokens:r||0,totalTokensEarned:je})}}catch(ke){console.error("Error loading user data:",ke)}finally{R(!1)}};he.useEffect(()=>{p&&T(ke=>({...ke,tokens:r||0}))},[r,p]);const Me=async()=>{try{const ke=await NW();let je=[];p&&(je=await jW(p.id));let $e=[...ke,...je];if(p){const{data:Ae,error:He}=await Kt.from("user_quests").select("quest_id, status").eq("user_id",p.id).in("status",["completed","verified"]);if(!He&&Ae&&Ae.length>0){const qe=new Set(Ae.map(Le=>Le.quest_id));$e=$e.filter(Le=>!qe.has(Le.id)),console.log("[Dashboard] Filtered out",qe.size,"already completed quests")}}w($e)}catch(ke){console.error("Error loading quests:",ke),w([])}},Ke=[{label:"Quests Completed",value:E.questsCompleted.toString(),icon:Ja,color:"cyan"},{label:"TPX Earned",value:Number(E.totalTokensEarned).toFixed(0),icon:Ya,color:"purple"},{label:"Wallet Balance",value:r.toFixed(2),icon:Ho,color:"green"},{label:"Level",value:E.level.toString(),icon:Vl,color:"amber"}];return f.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[f.jsxs(it.div,{initial:{opacity:0,y:-20,filter:"blur(20px)"},animate:{opacity:1,y:0,filter:"blur(0px)"},transition:{duration:1,ease:[.16,1,.3,1]},className:"relative overflow-hidden rounded-[2.5rem] p-10 md:p-16",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 50%, rgba(255,255,255,0.02) 100%)",backdropFilter:"blur(60px) saturate(200%)",WebkitBackdropFilter:"blur(60px) saturate(200%)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:`
            0 20px 60px rgba(0,0,0,0.3),
            0 8px 16px rgba(0,0,0,0.2),
            inset 0 2px 0 rgba(255,255,255,0.1),
            inset 0 -2px 0 rgba(0,0,0,0.3)
          `},children:[f.jsx(it.div,{animate:{opacity:[.1,.2,.1],scale:[1,1.15,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"},className:"absolute -top-20 -right-20 w-[600px] h-[600px] bg-gradient-to-br from-pumpkinOrange/8 via-transparent to-transparent rounded-full blur-[120px] pointer-events-none"}),f.jsx(it.div,{animate:{opacity:[.08,.15,.08],scale:[1.1,1,1.1]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute -bottom-20 -left-20 w-[500px] h-[500px] bg-gradient-to-tr from-bloodOrange/6 via-transparent to-transparent rounded-full blur-[100px] pointer-events-none"}),f.jsx("div",{className:"absolute inset-0 rounded-[2.5rem] pointer-events-none",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.08) 0%, transparent 40%, rgba(255,255,255,0.02) 100%)"}}),f.jsx("div",{className:"absolute inset-0 rounded-[2.5rem] pointer-events-none",style:{background:"radial-gradient(circle at 30% 20%, rgba(255,255,255,0.06) 0%, transparent 50%)"}}),f.jsx("div",{className:"absolute inset-[1px] rounded-[2.5rem] pointer-events-none",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 20%)"}}),f.jsxs("div",{className:"relative z-10",children:[f.jsxs(it.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.8,ease:[.16,1,.3,1]},className:"inline-flex items-center gap-2.5 px-5 py-2.5 rounded-full mb-8",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%)",backdropFilter:"blur(30px)",WebkitBackdropFilter:"blur(30px)",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 4px 16px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.15)"},children:[f.jsx(Ho,{className:"w-4 h-4 text-pumpkinOrange"}),f.jsx("span",{className:"text-sm font-light text-white/80 tracking-wide",children:"Welcome to TripX"})]}),f.jsx(it.h1,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.8},className:"text-5xl md:text-6xl font-bold mb-6 text-white tracking-tight leading-tight",style:{textShadow:"0 2px 20px rgba(0,0,0,0.3)"},children:"Explore. Complete. Earn."}),f.jsx(it.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6,duration:.8},className:"text-white/80 text-lg md:text-xl mb-10 max-w-2xl leading-relaxed font-light",children:"Discover quests at real locations worldwide. Earn TPX tokens and level up your NFT Passport."}),f.jsxs("div",{className:"flex flex-wrap gap-4",children:[f.jsx(Vc,{variant:"primary",onClick:()=>O(!D),children:f.jsxs("span",{className:"flex items-center gap-2",children:[D?f.jsx(k$,{className:"w-5 h-5"}):f.jsx(Ep,{className:"w-5 h-5"}),D?"Hide Map":"View Quest Map"]})}),f.jsx(Vc,{variant:"secondary",onClick:()=>t("create"),children:f.jsxs("span",{className:"flex items-center gap-2",children:["Create Custom Trip",f.jsx(Sx,{className:"w-5 h-5"})]})})]})]})]}),f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:Ke.map((ke,je)=>{const $e=ke.icon;return f.jsxs(it.div,{initial:{opacity:0,y:20,scale:.95,filter:"blur(10px)"},animate:{opacity:1,y:0,scale:1,filter:"blur(0px)"},transition:{delay:.8+je*.1,duration:.8,ease:[.16,1,.3,1]},className:"relative overflow-hidden rounded-[1.5rem] p-6",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[f.jsx("div",{className:"absolute inset-0 rounded-[1.5rem] pointer-events-none",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.06) 0%, transparent 50%)"}}),f.jsx(it.div,{whileHover:{scale:1.1,rotate:5},transition:{duration:.3},className:"relative inline-flex p-3 rounded-xl mb-4",style:{background:ke.color==="cyan"?"rgba(6, 182, 212, 0.1)":ke.color==="purple"?"rgba(168, 85, 247, 0.1)":ke.color==="green"?"rgba(34, 197, 94, 0.1)":"rgba(251, 191, 36, 0.1)",backdropFilter:"blur(20px)",border:`1px solid ${ke.color==="cyan"?"rgba(6, 182, 212, 0.2)":ke.color==="purple"?"rgba(168, 85, 247, 0.2)":ke.color==="green"?"rgba(34, 197, 94, 0.2)":"rgba(251, 191, 36, 0.2)"}`,boxShadow:`0 4px 16px ${ke.color==="cyan"?"rgba(6, 182, 212, 0.1)":ke.color==="purple"?"rgba(168, 85, 247, 0.1)":ke.color==="green"?"rgba(34, 197, 94, 0.1)":"rgba(251, 191, 36, 0.1)"}`},children:f.jsx($e,{className:`w-5 h-5 ${ke.color==="cyan"?"text-cyan-400":ke.color==="purple"?"text-purple-400":ke.color==="green"?"text-green-400":"text-amber-400"}`})}),f.jsx("h3",{className:"relative text-3xl font-bold text-white mb-1",children:ke.value}),f.jsx("p",{className:"relative text-white/70 text-sm font-light",children:ke.label})]},ke.label)})}),f.jsxs(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1,ease:[.16,1,.3,1],delay:1.2},className:"relative overflow-hidden rounded-[2rem] p-8 md:p-10",style:{background:"linear-gradient(135deg, rgba(255,149,0,0.04) 0%, rgba(255,107,53,0.02) 50%, rgba(255,149,0,0.04) 100%)",backdropFilter:"blur(50px) saturate(180%)",WebkitBackdropFilter:"blur(50px) saturate(180%)",border:"1px solid rgba(255,149,0,0.15)",boxShadow:"0 12px 40px rgba(255,149,0,0.08), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[f.jsx(it.div,{animate:{opacity:[.1,.2,.1],scale:[1,1.1,1]},transition:{duration:8,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-pumpkinOrange/10 via-transparent to-bloodOrange/10 rounded-[2rem] pointer-events-none"}),f.jsx("div",{className:"absolute inset-0 rounded-[2rem] pointer-events-none",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.06) 0%, transparent 50%)"}}),f.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-6",children:[f.jsxs("div",{className:"flex items-center gap-6",children:[f.jsxs(it.div,{animate:{rotate:[0,-3,3,-3,0]},transition:{duration:6,repeat:1/0,ease:"easeInOut"},className:"relative",children:[f.jsx("div",{className:"absolute inset-0 blur-2xl bg-pumpkinOrange/30 rounded-full scale-150"}),f.jsx("span",{className:"relative text-6xl filter drop-shadow-[0_0_20px_rgba(255,149,0,0.6)]",children:""})]}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl md:text-4xl font-spooky mb-2 text-white tracking-wide",children:"Spooky Destinations"}),f.jsx("p",{className:"text-white/80 text-base md:text-lg font-light",children:"Discover haunted destinations  Unlock exclusive badges  Earn rewards"})]})]}),f.jsx(Vc,{variant:"primary",onClick:()=>t("spooky"),children:f.jsx("span",{className:"flex items-center gap-2 text-base font-semibold",children:" Explore Now"})})]})]}),f.jsx(Xc,{children:D&&f.jsx(it.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.5},className:"rounded-3xl overflow-hidden backdrop-blur-xl bg-white/[0.03] border border-white/[0.08] shadow-[0_8px_32px_rgba(0,0,0,0.12)]",style:FE.inlineStyles.glass,children:v.length>0?f.jsx(mve,{quests:v,userLocation:K,onQuestSelect:ke=>{U(ke),ae(null)},height:"600px",questToZoom:xe,onZoomComplete:()=>{ae(null)},onAcceptQuest:ke=>{Me(),p&&Ce()}}):f.jsx("div",{className:"h-[600px] flex items-center justify-center bg-slate-800/50",children:f.jsxs("div",{className:"text-center",children:[f.jsx(Mo,{className:"w-16 h-16 text-white/60 mx-auto mb-4"}),f.jsx("p",{className:"text-white/80 text-lg",children:"No quests available"}),f.jsx("p",{className:"text-white/60 text-sm mt-2",children:"Create a trip to generate quests or wait for global quests to load"})]})})})}),(p||n)&&f.jsxs(f.Fragment,{children:[p&&f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:"lg:col-span-2",children:f.jsx("div",{className:"space-y-4",children:s&&n&&f.jsxs("div",{className:"flex flex-col items-center gap-3",children:[f.jsx(IW,{address:n}),f.jsx(K_e,{})]})})}),f.jsx(it.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>W(!X),className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6 text-left hover:bg-white/8 transition-all",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Transaction History"}),f.jsx("p",{className:"text-white/70 text-sm",children:"View all your token transactions"})]}),f.jsx(Sx,{className:`w-5 h-5 text-white/80 transition-transform ${X?"rotate-90":""}`})]})})]}),n&&f.jsx("div",{className:"mt-6",children:f.jsx(ive,{})})]}),X&&p&&f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:f.jsx(wW,{})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Available Quests"}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map((ke,je)=>{const $e=ke.quest_type==="sponsored",Ae=ke.quest_type==="hidden_gem";return f.jsx(it.div,{"data-quest-id":ke.id,initial:{opacity:0,y:20,scale:.95,filter:"blur(10px)"},animate:{opacity:1,y:0,scale:1,filter:"blur(0px)"},transition:{delay:je*.1,duration:.6},whileHover:{y:-12,scale:1.03},className:"relative group h-full",children:f.jsxs("div",{className:`relative backdrop-blur-xl bg-white/[0.03] rounded-3xl p-6 border-2 ${$e?"border-amber-500/50 shadow-2xl shadow-amber-500/20":Ae?"border-purple-500/50 shadow-2xl shadow-purple-500/20":"border-white/10 shadow-xl shadow-white/5"} overflow-hidden h-full transition-all duration-500 hover:shadow-3xl ${$e?"hover:shadow-amber-500/30":Ae?"hover:shadow-purple-500/30":"hover:shadow-white/10"}`,children:[f.jsx(it.div,{animate:{scale:[1,1.5,1],opacity:[.2,.4,.2],rotate:[0,180,360]},transition:{duration:15,repeat:1/0,ease:"easeInOut"},className:`absolute top-0 right-0 w-40 h-40 rounded-full blur-3xl ${$e?"bg-gradient-to-br from-amber-400/30 to-transparent":Ae?"bg-gradient-to-br from-purple-400/30 to-transparent":"bg-gradient-to-br from-white/10 to-transparent"}`}),$e&&f.jsx(it.div,{animate:{opacity:[.1,.3,.1]},transition:{duration:3,repeat:1/0},className:"absolute inset-0 bg-gradient-to-br from-amber-500/10 via-transparent to-transparent"}),Ae&&f.jsx(it.div,{animate:{opacity:[.1,.3,.1]},transition:{duration:3,repeat:1/0},className:"absolute inset-0 bg-gradient-to-br from-purple-500/10 via-transparent to-transparent"}),f.jsxs("div",{className:"relative z-10",children:[f.jsx("div",{className:"flex items-start justify-between mb-4",children:f.jsxs("div",{className:"flex-1",children:[$e&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-amber-500/20 border border-amber-500/30 mb-2 w-fit",children:[f.jsx(Ja,{className:"w-3 h-3 text-amber-400"}),f.jsx("span",{className:"text-xs font-semibold text-amber-400",children:"Sponsored"})]}),Ae&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-purple-500/20 border border-purple-500/30 mb-2 w-fit",children:[f.jsx(Ho,{className:"w-3 h-3 text-purple-400"}),f.jsx("span",{className:"text-xs font-semibold text-purple-400",children:"Hidden Gem"})]}),f.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:ke.title}),f.jsx("p",{className:"text-sm text-white/80 mb-3",children:ke.description}),ke.sponsor_name&&f.jsxs("p",{className:"text-xs text-amber-400 mb-2",children:["by ",ke.sponsor_name]})]})}),f.jsxs("div",{className:"flex items-center gap-2 mb-4 text-white/80",children:[f.jsx(Mo,{className:"w-4 h-4"}),f.jsx("span",{className:"text-sm",children:ke.location})]}),f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10",children:[f.jsx(Ya,{className:"w-4 h-4 text-amber-400"}),f.jsxs("span",{className:"text-sm font-semibold text-white",children:[ke.reward_tokens," TPX"]})]}),f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10",children:[f.jsx(md,{className:"w-4 h-4 text-white"}),f.jsxs("span",{className:"text-sm font-semibold text-white",children:[ke.reward_xp," XP"]})]})]})}),f.jsx(it.button,{ref:He=>{He&&(F==null?void 0:F.id)===ke.id&&(He.questButtonRef=He)},"data-quest-button-id":ke.id,whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{U(ke)},className:`w-full mt-4 px-6 py-3 rounded-xl font-semibold text-sm transition-all duration-300 ${$e?"bg-gradient-to-r from-amber-500 to-yellow-500 text-black shadow-lg shadow-amber-500/50":Ae?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/50":"bg-white text-black shadow-lg"}`,children:"View Details"})]})]})},ke.id)})})]}),F&&f.jsx(LW,{quest:F,onClose:()=>U(null),onShowOnMap:ke=>{O(!0),ae(ke)},onAcceptQuest:ke=>{Me(),p&&Ce()}}),ce&&f.jsx(XA,{type:"levelUp",onComplete:()=>ye(!1)})]})},mI=({label:t,value:e,onChange:n,getSuggestions:s,placeholder:l})=>{const[u,p]=he.useState([]),[r,v]=he.useState(!1),[w,E]=he.useState(!1),T=he.useRef(null),k=he.useRef(null);he.useEffect(()=>{const O=F=>{T.current&&!T.current.contains(F.target)&&v(!1)};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}},[]);const R=O=>{const F=O.target.value;if(n(F),k.current&&clearTimeout(k.current),F.length<2){E(!1),p([]),v(!1);return}v(!0),E(!0),k.current=window.setTimeout(async()=>{try{const U=await s(F);p(U)}catch(U){console.error("Error fetching place suggestions:",U),p([])}finally{E(!1)}},500)},D=O=>{n(O),p([]),v(!1)};return f.jsxs("div",{className:"relative",ref:T,children:[f.jsxs("label",{htmlFor:t,className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-2",children:[t.includes("Skd")?f.jsx(Mo,{className:"w-4 h-4 text-teal-400"}):f.jsx(Mv,{className:"w-4 h-4 text-teal-400"}),t]}),f.jsx("input",{type:"text",id:t,value:e,onChange:R,onFocus:()=>e.length>=2&&(u.length>0||w)&&v(!0),placeholder:l,autoComplete:"off",className:"w-full backdrop-blur-lg bg-white/[0.03] border border-white/[0.08] rounded-xl px-4 py-3 text-white placeholder-white/40 focus:outline-none focus:border-white/[0.15] focus:bg-white/[0.05] transition-all duration-300"}),r&&f.jsx("ul",{className:"absolute z-20 w-full mt-2 backdrop-blur-xl bg-white/[0.05] border border-white/[0.08] rounded-xl shadow-[0_8px_32px_rgba(0,0,0,0.16)] max-h-60 overflow-auto",children:w?f.jsx("li",{className:"px-4 py-3 text-sm text-white/60 italic",children:"Loading..."}):u.length>0?u.map((O,F)=>f.jsx("li",{onClick:()=>D(O),className:"px-4 py-3 text-sm text-white hover:bg-white/[0.05] cursor-pointer transition-all duration-200 border-b border-white/[0.05] last:border-0",children:O},F)):f.jsx("li",{className:"px-4 py-3 text-sm text-white/60 italic",children:"No suggestions."})})]})},wve="AIzaSyD_1ZDqPYBQKFqk0bZ-5gkBSqH8G6bisTc";let KT=!1,h0=!1,K_=null;const ZA=(t="places,geometry")=>{var n;return KT&&((n=window.google)!=null&&n.maps)?Promise.resolve():h0&&K_?K_:document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')?(h0=!0,K_=new Promise(s=>{const l=setInterval(()=>{var u;(u=window.google)!=null&&u.maps&&(KT=!0,h0=!1,clearInterval(l),s())},100);setTimeout(()=>{var u;clearInterval(l),(u=window.google)!=null&&u.maps||console.error("Google Maps API failed to load"),h0=!1,s()},1e4)}),K_):(h0=!0,K_=new Promise((s,l)=>{const u=document.createElement("script");u.src=`https://maps.googleapis.com/maps/api/js?key=${wve}&libraries=${t}&language=en&region=US&loading=async`,u.async=!0,u.defer=!0,u.id="google-maps-script",u.onload=()=>{setTimeout(()=>{var p;(p=window.google)!=null&&p.maps?(KT=!0,h0=!1,console.log(" Google Maps API loaded successfully"),s()):(h0=!1,l(new Error("Google Maps API loaded but not available")))},100)},u.onerror=()=>{h0=!1;const p=new Error("Failed to load Google Maps API");console.error(p),l(p)},document.head.appendChild(u)}),K_)};typeof window<"u"&&(window.googleMapsLoader={isLoaded:KT,load:ZA});console.log(" Google Maps API Key:","ZAADOWANY ");const gz=new Map,Sve=300*1e3;async function zW(t,e){if(console.log(" getPlacesSuggestionsSimple - query:",t),!t||t.length<2)return console.log(" Query za krtkie (<2 znaki)"),[];const n=`${t}_${e==null?void 0:e.lat}_${e==null?void 0:e.lng}`,s=gz.get(n);if(s&&Date.now()-s.timestamp<Sve)return console.log(" Zwracam z cache:",s.results),s.results;try{console.log(" aduj Google Maps API..."),await ZA(),console.log(" Google Maps API zaadowane!");const l=window.google;if(!l||!l.maps||!l.maps.places)throw new Error("Google Maps API nie zaadowane poprawnie");let u=[];try{console.log(" Trying NEW Autocomplete API..."),u=await Tve(l,t,e)}catch(r){console.warn(" New API not available, using old API:",r),u=await Eve(l,t,e)}const p=u.map(r=>r.description||r.text||r);return console.log(" Google Places zwrcio:",p.length,"sugestii"),gz.set(n,{results:p,timestamp:Date.now()}),p}catch(l){return console.error(" Google Places API error:",l),[]}}async function Tve(t,e,n){return new Promise((s,l)=>{try{const u=new t.maps.places.AutocompleteSuggestionService,p={input:e,languageCode:"pl",regionCode:"pl"};n&&(p.locationBias={circle:{center:{lat:n.lat,lng:n.lng},radius:5e4}},console.log(" Uywam lokalizacji uytkownika:",n)),console.log(" Wysyam request do Google Places API (NEW API)..."),u.getSuggestions(p,(r,v)=>{console.log(" Google Places API Status (NEW):",v,"| Wyniki:",(r==null?void 0:r.length)||0),v==="OK"&&r?s(r):v==="ZERO_RESULTS"?(console.log(" Google zwrcio 0 wynikw (NEW API)"),s([])):l(new Error(`Google Places API error (NEW): ${v}`))})}catch(u){l(u)}})}async function Eve(t,e,n){return new Promise((s,l)=>{try{const u=new t.maps.places.AutocompleteService,p={input:e,language:"pl"};n&&(p.locationBias={center:{lat:n.lat,lng:n.lng},radius:5e4},console.log(" Uywam lokalizacji uytkownika:",n)),console.log(" Wysyam request do Google Places API (OLD API)..."),u.getPlacePredictions(p,(r,v)=>{console.log(" Google Places API Status (OLD):",v,"| Wyniki:",(r==null?void 0:r.length)||0),v===t.maps.places.PlacesServiceStatus.OK&&r?s(r):v===t.maps.places.PlacesServiceStatus.ZERO_RESULTS?(console.log(" Google zwrcio 0 wynikw (OLD API)"),s([])):l(new Error(`Google Places API error (OLD): ${v}`))})}catch(u){l(u)}})}const Ave={ghost:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M12 2C8.5 2 6 4.5 6 8v8c0 1 .5 2 1.5 2s1.5-.5 1.5-1.5c0 .5.5 1.5 1.5 1.5s1.5-1 1.5-1.5c0 .5.5 1.5 1.5 1.5s1.5-1 1.5-2V8c0-3.5-2.5-6-6-6z",fill:"currentColor"}),f.jsx("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor"}),f.jsx("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor"})]}),cauldron:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M4 8h16M6 8l1 10c.2 1.5 1.5 2 3 2h4c1.5 0 2.8-.5 3-2l1-10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),f.jsx("ellipse",{cx:"12",cy:"8",rx:"8",ry:"2",fill:"currentColor"}),f.jsx("path",{d:"M8 6c0-1 1-2 2-2h4c1 0 2 1 2 2",stroke:"currentColor",strokeWidth:"2",fill:"none"}),f.jsx("circle",{cx:"10",cy:"12",r:"1",fill:"currentColor",opacity:"0.6"}),f.jsx("circle",{cx:"14",cy:"14",r:"1",fill:"currentColor",opacity:"0.6"}),f.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"currentColor",opacity:"0.6"})]}),hauntedCastle:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M4 22h16V10L12 4 4 10z",fill:"currentColor"}),f.jsx("rect",{x:"9",y:"14",width:"6",height:"8",fill:"currentColor",opacity:"0.7"}),f.jsx("rect",{x:"6",y:"12",width:"3",height:"4",fill:"currentColor"}),f.jsx("rect",{x:"15",y:"12",width:"3",height:"4",fill:"currentColor"}),f.jsx("path",{d:"M2 10h4M18 10h4M10 8h4M8 2v4M16 2v4",stroke:"currentColor",strokeWidth:"2"}),f.jsx("circle",{cx:"11",cy:"18",r:"0.5",fill:"white"}),f.jsx("circle",{cx:"13",cy:"18",r:"0.5",fill:"white"})]}),skull:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M12 2C8 2 5 5 5 9c0 3 1.5 5.5 3.5 7L8 22h8l-.5-6c2-1.5 3.5-4 3.5-7 0-4-3-7-7-7z",fill:"currentColor"}),f.jsx("circle",{cx:"9",cy:"10",r:"1.5",fill:"white"}),f.jsx("circle",{cx:"15",cy:"10",r:"1.5",fill:"white"}),f.jsx("path",{d:"M10 14h1M13 14h1",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round"}),f.jsx("path",{d:"M12 15v2",stroke:"white",strokeWidth:"1",strokeLinecap:"round"})]}),witchBroom:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M8 2l8 8M14 8l8 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),f.jsx("path",{d:"M16 10l-2 12h2l2-12z",fill:"currentColor"}),f.jsx("path",{d:"M18 18l2 2M20 18l2 2M22 18l2 2M16 20l-2 2M14 20l-2 2M12 20l-2 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),ghostTrain:f.jsxs(f.Fragment,{children:[f.jsx("rect",{x:"4",y:"10",width:"16",height:"8",rx:"2",fill:"currentColor"}),f.jsx("circle",{cx:"7",cy:"19",r:"1.5",fill:"currentColor"}),f.jsx("circle",{cx:"17",cy:"19",r:"1.5",fill:"currentColor"}),f.jsx("rect",{x:"6",y:"12",width:"4",height:"3",fill:"white",opacity:"0.3"}),f.jsx("rect",{x:"14",y:"12",width:"4",height:"3",fill:"white",opacity:"0.3"}),f.jsx("path",{d:"M2 10h20M12 6v4",stroke:"currentColor",strokeWidth:"2"}),f.jsx("path",{d:"M8 4h8l-2 2H10z",fill:"currentColor"}),f.jsx("circle",{cx:"10",cy:"14",r:"0.5",fill:"white"}),f.jsx("circle",{cx:"14",cy:"14",r:"0.5",fill:"white"})]}),vampireBat:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M12 8c-2 0-3 1-4 2-1-1-2-1-3 0-1 1-1 2 0 3l3 3 4 6 4-6 3-3c1-1 1-2 0-3-1-1-2-1-3 0-1-1-2-2-4-2z",fill:"currentColor"}),f.jsx("circle",{cx:"10",cy:"10",r:"1",fill:"red"}),f.jsx("circle",{cx:"14",cy:"10",r:"1",fill:"red"}),f.jsx("path",{d:"M2 10c0-2 1-3 2-3s2 1 2 3M18 10c0-2 1-3 2-3s2 1 2 3",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})]}),pumpkin:f.jsxs(f.Fragment,{children:[f.jsx("ellipse",{cx:"12",cy:"13",rx:"7",ry:"8",fill:"currentColor"}),f.jsx("path",{d:"M12 5c0-1 .5-2 1.5-2s1.5.5 1.5 1.5",stroke:"currentColor",strokeWidth:"2",fill:"none"}),f.jsx("path",{d:"M5 13c1-1 2-1 3 0M16 13c1-1 2-1 3 0",fill:"none",stroke:"black",strokeWidth:"1.5"}),f.jsx("path",{d:"M8 16l1 1 1-1 1 1 1-1 1 1 1-1 1 1",stroke:"black",strokeWidth:"1.5",fill:"none"}),f.jsx("path",{d:"M12 5v8",stroke:"currentColor",strokeWidth:"1",opacity:"0.3"})]}),potion:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M8 2h8v4l2 2v10c0 2-1.5 4-4 4h-4c-2.5 0-4-2-4-4V8l2-2V2z",fill:"currentColor"}),f.jsx("rect",{x:"9",y:"2",width:"6",height:"2",fill:"currentColor",opacity:"0.7"}),f.jsx("ellipse",{cx:"12",cy:"14",rx:"4",ry:"6",fill:"currentColor",opacity:"0.5"}),f.jsx("circle",{cx:"10",cy:"12",r:"1",fill:"white",opacity:"0.6"}),f.jsx("circle",{cx:"14",cy:"14",r:"1",fill:"white",opacity:"0.6"}),f.jsx("circle",{cx:"11",cy:"16",r:"0.5",fill:"white",opacity:"0.6"})]}),spellBook:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M6 2h12c1 0 2 1 2 2v16c0 1-1 2-2 2H6c-1 0-2-1-2-2V4c0-1 1-2 2-2z",fill:"currentColor"}),f.jsx("path",{d:"M4 4v16c0 1 1 2 2 2",stroke:"currentColor",strokeWidth:"2",fill:"none"}),f.jsx("path",{d:"M10 8h6M10 12h6M10 16h4",stroke:"white",strokeWidth:"1.5",opacity:"0.7"}),f.jsx("circle",{cx:"12",cy:"6",r:"1",fill:"white",opacity:"0.5"})]}),crystalBall:f.jsxs(f.Fragment,{children:[f.jsx("circle",{cx:"12",cy:"12",r:"7",fill:"currentColor",opacity:"0.8"}),f.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"currentColor",opacity:"0.4"}),f.jsx("path",{d:"M8 10c1-1 2-1 3 0M13 10c1-1 2-1 3 0",stroke:"white",strokeWidth:"1",opacity:"0.6"}),f.jsx("circle",{cx:"10",cy:"11",r:"1",fill:"white",opacity:"0.8"}),f.jsx("circle",{cx:"14",cy:"13",r:"0.5",fill:"white",opacity:"0.6"}),f.jsx("ellipse",{cx:"12",cy:"20",rx:"4",ry:"1",fill:"currentColor"}),f.jsx("path",{d:"M8 19h8",stroke:"currentColor",strokeWidth:"2"})]}),cobweb:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M12 2L12 22M2 12L22 12M4 4L20 20M20 4L4 20",stroke:"currentColor",strokeWidth:"0.5",opacity:"0.6"}),f.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"none",stroke:"currentColor",strokeWidth:"0.5"}),f.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"none",stroke:"currentColor",strokeWidth:"0.5"}),f.jsx("circle",{cx:"12",cy:"12",r:"8",fill:"none",stroke:"currentColor",strokeWidth:"0.5"}),f.jsx("circle",{cx:"12",cy:"12",r:"11",fill:"none",stroke:"currentColor",strokeWidth:"0.5"}),f.jsx("circle",{cx:"20",cy:"4",r:"1",fill:"currentColor"})]}),candyCorn:f.jsxs(f.Fragment,{children:[f.jsx("path",{d:"M12 2L6 14h12L12 2z",fill:"#FFD700"}),f.jsx("path",{d:"M6 14h12v4H6z",fill:"#FF8C00"}),f.jsx("path",{d:"M6 18h12l-2 4H8z",fill:"#FFFFFF"}),f.jsx("path",{d:"M12 2L6 14M12 2L18 14M6 14v4M18 14v4M8 22l2-4M16 22l-2-4",stroke:"currentColor",strokeWidth:"0.5",opacity:"0.3"})]})},Za=({name:t,size:e=24,color:n="currentColor",animated:s=!1,className:l=""})=>{const u=s?"halloween-icon-animated":"";return f.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`halloween-icon ${u} ${l}`,style:{color:n},"aria-label":`${t} icon`,role:"img",children:Ave[t]})},Bw=({variant:t="pumpkin",text:e,size:n=48})=>{const s=Jx(),l=()=>{switch(t){case"pumpkin":return f.jsx(it.div,{animate:s?{rotate:[0,10,-10,0],scale:[1,1.1,1]}:{},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:f.jsx(Za,{name:"pumpkin",size:n,className:"text-pumpkinOrange"})});case"witch":return f.jsx(it.div,{animate:s?{y:[0,-10,0],rotate:[0,5,-5,0]}:{},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:f.jsx(Za,{name:"witchBroom",size:n,className:"text-ghostlyWhite"})});case"ghost":return f.jsx(it.div,{animate:s?{y:[0,-15,0],opacity:[.5,1,.5]}:{},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:f.jsx(Za,{name:"ghost",size:n,className:"text-ghostlyWhite"})});case"cauldron":return f.jsxs("div",{className:"relative",children:[f.jsx(Za,{name:"cauldron",size:n,className:"text-toxicGreen"}),f.jsx("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 flex gap-1",children:[0,1,2].map(u=>f.jsx(it.div,{className:"w-2 h-2 rounded-full bg-toxicGreen",animate:s?{y:[0,-20,-40],opacity:[1,.5,0],scale:[.5,1,.5]}:{},transition:{duration:1.5,repeat:1/0,delay:u*.3,ease:"easeOut"}},u))})]});default:return null}};return f.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 p-8",children:[l(),e&&f.jsx(it.p,{className:"text-ghostlyWhite text-lg font-medium",animate:s?{opacity:[.5,1,.5]}:{},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:e})]})},yz=[{id:"food",label:"Food & Coffee",icon:l0e,color:"from-orange-400 to-red-500"},{id:"culture",label:"Culture & History",icon:y0e,color:"from-purple-400 to-pink-500"},{id:"nature",label:"Nature & Parks",icon:A0e,color:"from-green-400 to-emerald-500"},{id:"nightlife",label:"Nightlife & Fun",icon:v0e,color:"from-blue-400 to-cyan-500"}],Cve=({onTripGenerated:t,onNavigate:e})=>{var Ae,He,qe,Le,st,bt,yt,Vt,_t,vt,qt;const{user:n}=ba(),{user:s}=El(),l=n||s,[u,p]=he.useState(""),[r,v]=he.useState(3),[w,E]=he.useState("medium"),[T,k]=he.useState(["food","culture"]),[R,D]=he.useState(!1),[O,F]=he.useState(null),[U,X]=he.useState(!1),[W,K]=he.useState(null),[ne,te]=he.useState(!1),[re,xe]=he.useState(null),[ae,ce]=he.useState(!1),[ye,Ce]=he.useState(null),[Me,Ke]=he.useState(!1),ke=kt=>{k(on=>on.includes(kt)?on.filter(mn=>mn!==kt):[...on,kt])},je=async()=>{var kt,on,mn,Hr;if(console.log("CreateTrip: handleGenerate called",{destination:u,interests:T,user:!!l}),!u.trim()){F("Please enter a destination");return}if(T.length===0){F("Please select at least one interest");return}D(!0),F(null);try{const{generateTripPlan:Un}=await hr(async()=>{const{generateTripPlan:Br}=await import("./aiTripService-CPD-SVa-.js");return{generateTripPlan:Br}},[]),{saveTripToSupabase:$r}=await hr(async()=>{const{saveTripToSupabase:Br}=await Promise.resolve().then(()=>xz);return{saveTripToSupabase:Br}},void 0);console.log("Generating trip plan with AI...");const ht=await Un({destination:u,days:r,budget:w,interests:T});console.log("Trip plan generated:",ht),xe(ht),Ce(null),te(!0);const Lr=(Hr=(mn=(on=(kt=ht.daily_plan)==null?void 0:kt[0])==null?void 0:on.attractions)==null?void 0:mn[0])==null?void 0:Hr.coordinates;Lr&&(K({lat:Lr.lat,lng:Lr.lng}),X(!0)),t&&t(ht)}catch(Un){console.error("CreateTrip: Error generating trip:",Un),F(Un.message||"Failed to generate trip. Please try again.")}finally{D(!1)}},$e=async()=>{var kt,on,mn,Hr,Un,$r,ht,Lr,Br,wn,Nn,mr,Qn;if(re){if(!l||!l.id){F("Please log in to save your trip"),Ke(!0);return}ce(!0),F(null);try{console.log(" handleSaveTrip STARTED"),console.log(" generatedTrip:",re),console.log(" generatedTrip.daily_plan:",re==null?void 0:re.daily_plan);const{saveTripToSupabase:Nt}=await hr(async()=>{const{saveTripToSupabase:Bt}=await Promise.resolve().then(()=>xz);return{saveTripToSupabase:Bt}},void 0),et=((kt=re.destination_info)==null?void 0:kt.coordinates)||{lat:(($r=(Un=(Hr=(mn=(on=re.daily_plan)==null?void 0:on[0])==null?void 0:mn.attractions)==null?void 0:Hr[0])==null?void 0:Un.coordinates)==null?void 0:$r.lat)||0,lng:((Nn=(wn=(Br=(Lr=(ht=re.daily_plan)==null?void 0:ht[0])==null?void 0:Lr.attractions)==null?void 0:Br[0])==null?void 0:wn.coordinates)==null?void 0:Nn.lng)||0};console.log(" Destination coords:",et),console.log(" About to call saveTripToSupabase with:"),console.log("  - userId:",l.id),console.log("  - destination:",u),console.log("  - daily_plan length:",(mr=re==null?void 0:re.daily_plan)==null?void 0:mr.length);const Oe=await Nt(l.id,{destination:u,duration:r,interests:T,budget:w,quests:[]},et,{hotels:re.hotels||[],daily_plan:re.daily_plan||[],total_estimated_cost:((Qn=re.trip_overview)==null?void 0:Qn.total_estimated_cost)||{min:0,max:0,total:0},generated_quests:re.generated_quests||[],destination_info:re.destination_info||{},metadata:re.metadata||{}});Ce(Oe.tripId),console.log("Trip saved successfully!",Oe),setTimeout(()=>{e("trips")},1500)}catch(Nt){console.error("Error saving trip:",Nt),F(Nt.message||"Failed to save trip")}finally{ce(!1)}}};return f.jsxs("div",{className:"max-w-4xl mx-auto",children:[f.jsxs(it.div,{initial:{opacity:0,y:-20,filter:"blur(10px)"},animate:{opacity:1,y:0,filter:"blur(0px)"},transition:{duration:.6,ease:[.22,1,.36,1]},className:"mb-8 relative",children:[f.jsx(it.div,{animate:{opacity:[.3,.5,.3],scale:[1,1.1,1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},className:"absolute -inset-4 bg-gradient-to-r from-teal-500/20 via-cyan-500/20 to-teal-500/20 rounded-3xl blur-2xl pointer-events-none"}),f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx(it.div,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.95},className:"w-12 h-12 backdrop-blur-xl bg-gradient-to-br from-teal-400/80 to-cyan-500/80 rounded-xl flex items-center justify-center shadow-[0_8px_24px_rgba(20,184,166,0.3)] border border-white/[0.15]",children:f.jsx(Ho,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"Create Your Trip"}),f.jsx("p",{className:"text-white",style:{textShadow:"0 1px 5px rgba(0,0,0,0.5)"},children:"AI will generate personalized quests for your journey"})]})]})]}),O&&f.jsxs(it.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/30 flex items-center gap-3",children:[f.jsx(Kk,{className:"w-5 h-5 text-red-400"}),f.jsx("p",{className:"text-red-400 text-sm",children:O})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs(it.div,{initial:{opacity:0,y:20,filter:"blur(10px)"},animate:{opacity:1,y:0,filter:"blur(0px)"},transition:{delay:.1,duration:.6,ease:[.22,1,.36,1]},whileHover:{scale:1.01,transition:{duration:.3}},className:"relative rounded-2xl bg-slate-900/30 backdrop-blur-2xl border border-slate-700/30 p-8 shadow-2xl",style:{backdropFilter:"blur(20px)",backgroundColor:"rgba(15, 23, 42, 0.3)"},children:[f.jsx(it.div,{animate:{opacity:[.1,.2,.1]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},className:"absolute -inset-px bg-gradient-to-r from-teal-500/20 via-cyan-500/20 to-teal-500/20 rounded-2xl blur-xl pointer-events-none"}),f.jsxs("div",{className:"space-y-6",children:[f.jsx("div",{children:f.jsx(mI,{label:"Where do you want to go?",value:u,onChange:p,getSuggestions:zW,placeholder:"Enter destination (e.g., Paris, Tokyo, New York)"})}),f.jsxs("div",{children:[f.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-3",children:[f.jsx(ig,{className:"w-4 h-4 text-teal-400"}),"Trip Duration: ",r," ",r===1?"day":"days"]}),f.jsx("input",{type:"range",min:"1",max:"7",value:r,onChange:kt=>v(parseInt(kt.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-teal-500"}),f.jsxs("div",{className:"flex justify-between text-xs text-white/60 mt-2",children:[f.jsx("span",{children:"1 day"}),f.jsx("span",{children:"7 days"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-3",children:[f.jsx(id,{className:"w-4 h-4 text-teal-400"}),"Budget Level"]}),f.jsx("div",{className:"grid grid-cols-3 gap-3",children:["low","medium","high"].map(kt=>f.jsxs(it.button,{onClick:()=>E(kt),whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:`relative overflow-hidden py-3 px-4 rounded-xl font-medium transition-all duration-300 ${w===kt?"backdrop-blur-xl bg-gradient-to-r from-teal-500/90 to-cyan-500/90 border border-white/[0.15] text-white shadow-[0_8px_24px_rgba(20,184,166,0.3)]":"backdrop-blur-xl bg-white/[0.05] border border-white/[0.08] text-white/70 hover:bg-white/[0.10] hover:text-white hover:border-white/[0.15]"}`,children:[w===kt&&f.jsx(it.div,{animate:{opacity:[.1,.3,.1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-to-r from-white/[0.05] via-white/[0.15] to-white/[0.05] rounded-xl blur-xl pointer-events-none"}),f.jsx("span",{className:"relative",children:kt.charAt(0).toUpperCase()+kt.slice(1)})]},kt))})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-3",children:[f.jsx(p0e,{className:"w-4 h-4 text-teal-400"}),"Your Interests"]}),f.jsx("div",{className:"grid grid-cols-2 gap-3",children:yz.map(kt=>{const on=kt.icon,mn=T.includes(kt.id);return f.jsxs(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},onClick:()=>ke(kt.id),className:`relative overflow-hidden p-4 rounded-xl backdrop-blur-xl transition-all duration-300 ${mn?"bg-white/[0.08] border-2 border-teal-500/50 shadow-[0_8px_24px_rgba(20,184,166,0.3)]":"bg-white/[0.03] border-2 border-white/[0.05] hover:border-white/[0.12] hover:bg-white/[0.05] hover:shadow-lg"}`,children:[mn&&f.jsx(it.div,{animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-to-r from-teal-500/20 via-cyan-500/20 to-teal-500/20 rounded-xl blur-xl pointer-events-none"}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(it.div,{whileHover:{scale:1.1,rotate:5},className:`w-10 h-10 backdrop-blur-lg bg-gradient-to-br ${kt.color} rounded-lg flex items-center justify-center border border-white/[0.15] shadow-lg`,children:f.jsx(on,{className:"w-5 h-5 text-white"})}),f.jsx("span",{className:`font-medium ${mn?"text-white":"text-white/70"}`,children:kt.label})]}),mn&&f.jsx(it.div,{layoutId:`selected-${kt.id}`,className:"absolute top-2 right-2 w-2 h-2 bg-teal-400 rounded-full shadow-lg shadow-teal-400/50"})]},kt.id)})})]})]})]}),f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:f.jsxs(it.button,{onClick:je,disabled:!u.trim()||R,whileHover:R?{}:{scale:1.02,y:-2},whileTap:R?{}:{scale:.98},className:"w-full group relative overflow-hidden py-5 rounded-xl backdrop-blur-2xl bg-gradient-to-r from-teal-500 to-cyan-500 border-2 border-white/[0.2] text-white font-bold text-lg transition-all duration-300 shadow-[0_8px_32px_rgba(20,184,166,0.5)] hover:shadow-[0_16px_64px_rgba(20,184,166,0.6)] disabled:opacity-50 disabled:cursor-not-allowed",style:{backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)"},children:[f.jsx("div",{className:"absolute inset-0 bg-black/20 rounded-xl"}),f.jsx(it.div,{animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0,repeatDelay:1,ease:"linear"},className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500 to-teal-500 opacity-0 group-hover:opacity-30 transition-opacity duration-300"}),f.jsx("span",{className:"relative flex items-center justify-center gap-3",children:R?f.jsxs(f.Fragment,{children:[f.jsx(Bw,{variant:"witch",size:"sm"}),"AI is planning your adventure..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Ho,{className:"w-5 h-5"}),"Generate Trip with AI",f.jsx(Sx,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform duration-300"})]})})]})})]}),f.jsx(Xc,{children:re&&ne&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"mt-8 space-y-6",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Your Trip to ",(Ae=re.trip_overview)==null?void 0:Ae.city]}),f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>te(!1),className:"p-2 rounded-xl bg-slate-800/50 hover:bg-slate-700/50 text-white transition-colors",children:f.jsx(Qa,{className:"w-5 h-5"})})]}),f.jsxs(it.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-2xl bg-slate-900/30 backdrop-blur-2xl border border-slate-700/30 p-6",children:[f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:(He=re.trip_overview)==null?void 0:He.city}),f.jsx("p",{className:"text-slate-300",children:((qe=re.trip_overview)==null?void 0:qe.vibe)||"An amazing journey awaits"}),((Le=re.trip_overview)==null?void 0:Le.best_time_to_visit)&&f.jsxs("p",{className:"text-sm text-teal-400 mt-2",children:["Best time to visit: ",re.trip_overview.best_time_to_visit]}),f.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:T.map(kt=>{const on=yz.find(mn=>mn.id===kt);return on?f.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-teal-500/20 text-teal-400",children:on.label},kt):null})})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:"text-2xl font-bold text-teal-400",children:["$",((bt=(st=re.trip_overview)==null?void 0:st.total_estimated_cost)==null?void 0:bt.total)||0]}),f.jsx("p",{className:"text-xs text-slate-400",children:"Estimated total"}),((Vt=(yt=re.trip_overview)==null?void 0:yt.total_estimated_cost)==null?void 0:Vt.breakdown)&&f.jsxs("div",{className:"mt-2 text-xs text-slate-400 space-y-1",children:[f.jsxs("div",{className:"flex justify-between gap-4",children:[f.jsx("span",{children:"Activities:"}),f.jsxs("span",{className:"text-white",children:["$",re.trip_overview.total_estimated_cost.breakdown.activities||0]})]}),f.jsxs("div",{className:"flex justify-between gap-4",children:[f.jsx("span",{children:"Food:"}),f.jsxs("span",{className:"text-white",children:["$",re.trip_overview.total_estimated_cost.breakdown.food||0]})]}),f.jsxs("div",{className:"flex justify-between gap-4",children:[f.jsx("span",{children:"Transport:"}),f.jsxs("span",{className:"text-white",children:["$",re.trip_overview.total_estimated_cost.breakdown.transport||0]})]}),re.trip_overview.total_estimated_cost.hotel_estimate&&f.jsxs("div",{className:"flex justify-between gap-4 pt-1 border-t border-white/10",children:[f.jsx("span",{children:"Hotels:"}),f.jsxs("span",{className:"text-white",children:["$",re.trip_overview.total_estimated_cost.hotel_estimate]})]})]}),((vt=(_t=re.trip_overview)==null?void 0:_t.total_estimated_cost)==null?void 0:vt.min)&&f.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Range: $",re.trip_overview.total_estimated_cost.min," - $",re.trip_overview.total_estimated_cost.max]})]})]}),((qt=re.trip_overview)==null?void 0:qt.total_activities)&&f.jsxs("div",{className:"mt-4 flex gap-4 text-sm",children:[f.jsxs("span",{className:"text-slate-300",children:[f.jsx("strong",{className:"text-white",children:re.trip_overview.total_days})," days"]}),f.jsxs("span",{className:"text-slate-300",children:[f.jsx("strong",{className:"text-white",children:re.trip_overview.total_activities})," activities"]}),re.generated_quests&&f.jsxs("span",{className:"text-slate-300",children:[f.jsx("strong",{className:"text-white",children:re.generated_quests.length})," quests"]}),re.hotels&&f.jsxs("span",{className:"text-slate-300",children:[f.jsx("strong",{className:"text-white",children:re.hotels.length})," hotels"]})]}),f.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center gap-3",children:[f.jsx("span",{className:"text-sm text-slate-400",children:"Budget Level:"}),f.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${w==="low"?"bg-green-500/20 text-green-400":w==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-purple-500/20 text-purple-400"}`,children:w.charAt(0).toUpperCase()+w.slice(1)})]})]}),f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05},className:"flex justify-center",children:ye?f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-green-500/20 border border-green-500/50 text-green-400",children:[f.jsx(nb,{className:"w-5 h-5"}),f.jsx("span",{className:"font-medium",children:"Trip Saved!"})]}):l?f.jsxs(it.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:$e,disabled:ae,className:"group relative overflow-hidden px-8 py-4 rounded-xl backdrop-blur-2xl bg-gradient-to-r from-teal-500 to-cyan-500 border-2 border-white/[0.2] text-white font-bold text-lg transition-all duration-300 shadow-[0_8px_32px_rgba(20,184,166,0.5)] hover:shadow-[0_16px_64px_rgba(20,184,166,0.6)] disabled:opacity-50 disabled:cursor-not-allowed",children:[f.jsx("div",{className:"absolute inset-0 bg-black/20 rounded-xl"}),f.jsx(it.div,{animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0,repeatDelay:1,ease:"linear"},className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"}),f.jsx("span",{className:"relative flex items-center justify-center gap-3",children:ae?f.jsxs(f.Fragment,{children:[f.jsx(Bw,{variant:"pumpkin",size:"sm"}),"Saving..."]}):f.jsxs(f.Fragment,{children:[f.jsx(nb,{className:"w-5 h-5"}),"Save Trip to My Trips"]})})]}):f.jsxs(it.div,{whileHover:{scale:1.02,y:-2},className:"px-8 py-4 rounded-xl backdrop-blur-2xl bg-slate-800/50 border-2 border-white/[0.1] text-center",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[f.jsx(hN,{className:"w-5 h-5 text-slate-400"}),f.jsx("p",{className:"text-white font-semibold",children:"Login Required"})]}),f.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connect your wallet or sign in to save trips and earn rewards"}),f.jsx("div",{className:"flex gap-2 justify-center",children:f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>Ke(!0),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-teal-500 to-cyan-500 text-white text-sm font-medium",children:"Login to Save Trip"})})]})}),re.hotels&&re.hotels.length>0&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-slate-900/30 backdrop-blur-2xl border border-slate-700/30 p-6",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(dN,{className:"w-5 h-5 text-teal-400"}),"Recommended Accommodations",f.jsxs("span",{className:"text-sm font-normal text-slate-400",children:["(",r," ",r===1?"night":"nights",")"]})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:re.hotels.slice(0,4).map((kt,on)=>f.jsxs(it.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:border-teal-500/50 transition-colors",children:[kt.photos&&kt.photos[0]&&f.jsx("img",{src:kt.photos[0],alt:kt.name,className:"w-full h-32 object-cover rounded-lg mb-3"}),f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsx("h4",{className:"font-medium text-white",children:kt.name}),kt.rating&&f.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[f.jsx(F0,{className:"w-3 h-3 text-yellow-400 fill-yellow-400"}),f.jsx("span",{className:"text-white",children:kt.rating}),kt.total_reviews&&f.jsxs("span",{className:"text-slate-400",children:["(",kt.total_reviews,")"]})]})]}),f.jsx("p",{className:"text-sm text-slate-400 mb-2",children:kt.address}),f.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-white/10",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-slate-400",children:"Per night"}),f.jsxs("div",{className:"text-teal-400 font-semibold",children:["$",kt.price_per_night_estimate||"~50"]})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:"text-xs text-slate-400",children:["Total stay (",r,"n)"]}),f.jsxs("div",{className:"text-white font-bold",children:["$",kt.total_stay_estimate||(kt.price_per_night_estimate?kt.price_per_night_estimate*r:50*r)]})]})]}),kt.price_level&&f.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[f.jsxs("span",{className:"text-xs text-teal-400",children:["$".repeat(kt.price_level),f.jsx("span",{className:"text-slate-500",children:"$".repeat(4-kt.price_level)})]}),f.jsx("span",{className:"text-xs text-slate-400",children:kt.price_level===1?"Budget":kt.price_level===2?"Economy":kt.price_level===3?"Mid-range":"Luxury"})]}),f.jsxs("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:[kt.website&&f.jsx("a",{href:kt.website,target:"_blank",rel:"noopener noreferrer",className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors",children:"Book Now"}),kt.phone&&f.jsx("a",{href:`tel:${kt.phone}`,className:"text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors",children:kt.phone})]}),kt.top_review&&f.jsxs("div",{className:"mt-3 p-2 rounded-lg bg-white/5 text-xs",children:[f.jsxs("p",{className:"text-slate-300 italic",children:['"',kt.top_review.text,'..."']}),f.jsxs("p",{className:"text-slate-500 mt-1",children:["- ",kt.top_review.author]})]})]},on))})]}),re.daily_plan&&re.daily_plan.length>0&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[f.jsx("h3",{className:"text-xl font-semibold text-white",children:"Daily Itinerary"}),re.daily_plan.map((kt,on)=>f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+on*.1},className:"rounded-2xl bg-slate-900/30 backdrop-blur-2xl border border-slate-700/30 p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{children:[f.jsxs("h4",{className:"text-lg font-semibold text-white",children:["Day ",kt.day_number]}),kt.theme&&f.jsx("p",{className:"text-sm text-teal-400",children:kt.theme})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:"text-lg font-semibold text-white",children:["$",Math.round(kt.estimated_cost||0)]}),f.jsxs("p",{className:"text-xs text-slate-400",children:[kt.total_duration||0,"h total"]})]})]}),f.jsx("div",{className:"space-y-3",children:kt.attractions&&kt.attractions.map((mn,Hr)=>f.jsxs(it.div,{whileHover:{scale:1.01,x:4},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:border-teal-500/50 transition-all",children:[f.jsxs("div",{className:"flex items-start justify-between gap-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[mn.start_time&&f.jsx("span",{className:"text-xs font-medium text-teal-400",children:mn.start_time}),f.jsx("h5",{className:"font-medium text-white",children:mn.name}),mn.rating&&f.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[f.jsx(F0,{className:"w-3 h-3 text-yellow-400 fill-yellow-400"}),f.jsx("span",{className:"text-white",children:mn.rating})]})]}),f.jsx("p",{className:"text-sm text-slate-300 mb-2",children:mn.description}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400 flex-wrap",children:[f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(Mo,{className:"w-3 h-3"}),mn.address]}),mn.duration_hours&&f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(nh,{className:"w-3 h-3"}),mn.duration_hours,"h"]}),mn.estimated_cost&&mn.estimated_cost>0&&f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(id,{className:"w-3 h-3"}),"$",mn.estimated_cost]}),mn.price_level&&f.jsx("span",{className:"flex items-center gap-1 text-teal-400",children:"$".repeat(mn.price_level)})]}),mn.opening_hours&&mn.opening_hours.length>0&&f.jsx("div",{className:"mt-2 text-xs",children:f.jsxs("details",{className:"cursor-pointer",children:[f.jsx("summary",{className:"text-slate-400 hover:text-slate-300",children:"Opening Hours"}),f.jsx("div",{className:"mt-1 space-y-0.5 text-slate-500 pl-2",children:mn.opening_hours.slice(0,3).map((Un,$r)=>f.jsx("div",{children:Un},$r))})]})}),f.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[mn.is_open_now!==void 0&&f.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${mn.is_open_now?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:mn.is_open_now?"Open Now":"Closed"}),mn.website&&f.jsx("a",{href:mn.website,target:"_blank",rel:"noopener noreferrer",className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors",children:"Website"}),mn.phone&&f.jsx("a",{href:`tel:${mn.phone}`,className:"text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors",children:mn.phone})]})]}),mn.photos&&mn.photos[0]&&f.jsx("img",{src:mn.photos[0],alt:mn.name,className:"w-20 h-20 rounded-lg object-cover"})]}),mn.google_maps_url&&f.jsxs("a",{href:mn.google_maps_url,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-flex items-center gap-1 text-xs text-teal-400 hover:text-teal-300 transition-colors",children:["View on Google Maps",f.jsx(Jo,{className:"w-3 h-3"})]})]},Hr))})]},on))]}),re.generated_quests&&re.generated_quests.length>0&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"rounded-2xl bg-slate-900/30 backdrop-blur-2xl border border-slate-700/30 p-6",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(Ho,{className:"w-5 h-5 text-teal-400"}),"Generated Quests (",re.generated_quests.length,")"]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:re.generated_quests.map((kt,on)=>f.jsxs(it.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:border-teal-500/50 transition-colors",children:[f.jsxs("div",{className:"flex items-start justify-between mb-2",children:[f.jsx("h4",{className:"font-medium text-white",children:kt.title}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(F0,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),f.jsxs("span",{className:"text-sm text-white",children:[kt.reward_xp," XP"]})]})]}),f.jsx("p",{className:"text-sm text-slate-400 mb-2",children:kt.description}),f.jsxs("div",{className:"flex items-center justify-between text-xs",children:[f.jsxs("span",{className:"text-slate-400",children:["Difficulty: ",kt.difficulty,"/10"]}),f.jsxs("span",{className:"text-teal-400",children:[kt.reward_tokens," tokens"]})]})]},on))})]})]})}),f.jsx(Xc,{children:R&&f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm",children:f.jsx("div",{className:"bg-slate-800/90 backdrop-blur-xl border border-slate-700/50 rounded-3xl p-12 max-w-md mx-4",children:f.jsxs("div",{className:"flex flex-col items-center text-center",children:[f.jsxs("div",{className:"relative mb-6",children:[f.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-2xl flex items-center justify-center animate-pulse",children:f.jsx(Ho,{className:"w-10 h-10 text-slate-900"})}),f.jsx("div",{className:"absolute -inset-2 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-2xl blur-xl opacity-50 animate-pulse"})]}),f.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Creating Your Journey"}),f.jsx("p",{className:"text-slate-400",children:"AI is analyzing the best spots and generating personalized quests..."})]})})})}),f.jsx(bW,{isOpen:Me,onClose:()=>Ke(!1)})]})};async function Mve(t,e={}){console.log("[getUserQuests] Called with userId:",t),console.log("[getUserQuests] Filters:",e);let n=Kt.from("user_quests").select(`
      *,
      quests (
        *
      )
    `).eq("user_id",t);e.status&&(n=n.eq("status",e.status)),n=n.order("created_at",{ascending:!1}),e.limit&&(n=n.limit(e.limit)),console.log("[getUserQuests] Executing query...");const{data:s,error:l}=await n;if(l)throw console.error("[getUserQuests] Query failed:",{message:l.message,code:l.code,details:l.details,hint:l.hint}),new Error(`Failed to fetch user quests: ${l.message}`);if(s&&s.length>0){const u=s.map(r=>r.quest_id).filter(Boolean),{data:p}=await Kt.from("nft_transactions").select("quest_id, token_id, tx_hash").eq("user_id",t).in("quest_id",u).eq("nft_type","achievement").eq("status","confirmed");if(p&&p.length>0){console.log("[getUserQuests] Found",p.length,"NFT transactions to sync");const r=new Map(p.map(v=>[v.quest_id,v]));for(const v of s){const w=r.get(v.quest_id);w&&!v.nft_minted&&(console.log("[getUserQuests] Syncing NFT status for quest:",v.quest_id),v.nft_minted=!0,v.nft_token_id=w.token_id,v.nft_tx_hash=w.tx_hash,Kt.from("user_quests").update({nft_minted:!0,nft_token_id:w.token_id,nft_tx_hash:w.tx_hash}).eq("id",v.id).then(({error:E})=>{E&&console.warn("[getUserQuests] Failed to sync NFT status to DB:",E)}))}}}return console.log("[getUserQuests] Query success - found",(s==null?void 0:s.length)||0,"quests"),s||[]}const zi="https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images",kve={"eiffel tower":`${zi}/quest-eiffel-tower.png`,paris:`${zi}/quest-eiffel-tower.png`,colosseum:`${zi}/quest-colosseum.png`,rome:`${zi}/quest-colosseum.png`,"big ben":`${zi}/quest-big-ben.png`,westminster:`${zi}/quest-big-ben.png`,london:`${zi}/quest-big-ben.png`,"statue of liberty":`${zi}/quest-statue-liberty.png`,"new york":`${zi}/quest-statue-liberty.png`,"taj mahal":`${zi}/quest-taj-mahal.png`,agra:`${zi}/quest-taj-mahal.png`,"great wall":`${zi}/quest-great-wall.png`,beijing:`${zi}/quest-great-wall.png`,china:`${zi}/quest-great-wall.png`,"machu picchu":`${zi}/quest-machu-picchu.png`,peru:`${zi}/quest-machu-picchu.png`,"sydney opera":`${zi}/quest-sydney-opera.png`,sydney:`${zi}/quest-sydney-opera.png`,"christ redeemer":`${zi}/quest-christ-redeemer.png`,rio:`${zi}/quest-christ-redeemer.png`,petra:`${zi}/quest-petra.png`,jordan:`${zi}/quest-petra.png`,pyramids:`${zi}/quest-pyramids-giza.png`,giza:`${zi}/quest-pyramids-giza.png`,egypt:`${zi}/quest-pyramids-giza.png`,sphinx:`${zi}/quest-pyramids-giza.png`,barcelona:`${zi}/quest-barcelona.png`,sagrada:`${zi}/quest-barcelona.png`,amsterdam:`${zi}/quest-amsterdam.png`,prague:`${zi}/quest-prague.png`,vienna:`${zi}/quest-vienna.png`,tokyo:`${zi}/quest-tokyo.png`,"tokyo tower":`${zi}/quest-tokyo.png`,kyoto:`${zi}/quest-kyoto.png`,fushimi:`${zi}/quest-kyoto.png`,bangkok:`${zi}/quest-bangkok.png`,thailand:`${zi}/quest-bangkok.png`,singapore:`${zi}/quest-singapore.png`,"marina bay":`${zi}/quest-singapore.png`,"grand canyon":`${zi}/quest-grand-canyon.png`,arizona:`${zi}/quest-grand-canyon.png`,niagara:`${zi}/quest-niagara-falls.png`,warsaw:`${zi}/quest-warsaw-walk.png`,"palace of culture":`${zi}/quest-palace-culture-v2.png`,"palac kultury":`${zi}/quest-palace-culture-v2.png`,"uprising museum":`${zi}/quest-warsaw-uprising-v2.png`,"powstania warszawskiego":`${zi}/quest-warsaw-uprising-v2.png`,francuska:`${zi}/quest-francuska-street.png`,legia:`${zi}/quest-legia-warszawa.png`,"legia warszawa":`${zi}/quest-legia-warszawa.png`,"stadion legii":`${zi}/quest-legia-warszawa.png`};function UW(t,e){const n=`${t} ${e}`.toLowerCase();for(const[s,l]of Object.entries(kve))if(n.includes(s))return l;return`${zi}/achievement-default.png`}const Ive="pk.eyJ1IjoicGFoaXYiLCJhIjoiY21ocm1pbDl6MDlxbDJxc2RmZTFxanhhdyJ9.0NYhap2uwOXs6slRCnKS4g",Pve=({latitude:t,longitude:e,name:n,className:s="w-full h-64"})=>{const l=he.useRef(null),u=he.useRef(null);return he.useEffect(()=>{if(!(!l.current||u.current))return Na.accessToken=Ive,u.current=new Na.Map({container:l.current,style:"mapbox://styles/mapbox/dark-v11",center:[e,t],zoom:14,pitch:0,bearing:0}),new Na.Marker({color:"#06b6d4"}).setLngLat([e,t]).setPopup(new Na.Popup({offset:25}).setHTML(`<div style="color: #fff; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 8px;">
            <strong>${n}</strong>
          </div>`)).addTo(u.current),u.current.addControl(new Na.NavigationControl,"top-right"),()=>{u.current&&(u.current.remove(),u.current=null)}},[t,e,n]),f.jsx("div",{ref:l,className:s})},Rve={"bran-castle":{name:"Dracula's Castle Explorer",description:"You've visited the legendary Bran Castle in Romania, home of the Dracula legend.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/bran-castle.png",attributes:[{trait_type:"Location",value:"Bran Castle, Romania"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Vampire"},{trait_type:"Season",value:"Halloween 2025"}]},"edinburgh-vaults":{name:"Edinburgh Ghost Hunter",description:"You've explored the haunted underground vaults of Edinburgh.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/edinburgh-vaults.png",attributes:[{trait_type:"Location",value:"Edinburgh, Scotland"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Paranormal"},{trait_type:"Season",value:"Halloween 2025"}]},"paris-catacombs":{name:"Catacombs Explorer",description:"You've walked among 6 million souls in the Paris Catacombs.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/paris-catacombs.png",attributes:[{trait_type:"Location",value:"Paris, France"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Ossuary"},{trait_type:"Season",value:"Halloween 2025"}]},chernobyl:{name:"Chernobyl Survivor",description:"You've explored the abandoned Chernobyl Exclusion Zone.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/chernobyl.png",attributes:[{trait_type:"Location",value:"Pripyat, Ukraine"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Abandoned"},{trait_type:"Season",value:"Halloween 2025"},{trait_type:"Rarity",value:"Legendary"}]},"salem-witch-trials":{name:"Witch Trial Historian",description:"You've explored the history of the Salem Witch Trials.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/salem-witch.png",attributes:[{trait_type:"Location",value:"Salem, Massachusetts"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Historical"},{trait_type:"Season",value:"Halloween 2025"}]},"tower-of-london":{name:"Tower of Terror Survivor",description:"You've explored the haunted Tower of London.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/tower-london.png",attributes:[{trait_type:"Location",value:"London, UK"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Castle"},{trait_type:"Season",value:"Halloween 2025"}]},"bone-church":{name:"Bone Church Pilgrim",description:"You've visited the Sedlec Ossuary decorated with 40,000 skeletons.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/bone-church.png",attributes:[{trait_type:"Location",value:"Kutn Hora, Czech Republic"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Ossuary"},{trait_type:"Season",value:"Halloween 2025"}]},"island-of-dolls":{name:"Island of Dolls Explorer",description:"You've visited the creepy Island of the Dolls in Mexico.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/island-dolls.png",attributes:[{trait_type:"Location",value:"Xochimilco, Mexico"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Paranormal"},{trait_type:"Season",value:"Halloween 2025"}]},"waverly-hills":{name:"Sanatorium Survivor",description:"You've survived a night at Waverly Hills Sanatorium.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/waverly-hills.png",attributes:[{trait_type:"Location",value:"Louisville, Kentucky"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Hospital"},{trait_type:"Season",value:"Halloween 2025"},{trait_type:"Rarity",value:"Legendary"}]},"eastern-state-penitentiary":{name:"Prison Break Survivor",description:"You've explored the haunted Eastern State Penitentiary.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/eastern-state.png",attributes:[{trait_type:"Location",value:"Philadelphia, Pennsylvania"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Prison"},{trait_type:"Season",value:"Halloween 2025"}]},"catacombs-rome":{name:"Capuchin Crypt Explorer",description:"You've visited the Capuchin Crypt in Rome with 3,700 skeletal remains.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/capuchin-crypt.png",attributes:[{trait_type:"Location",value:"Rome, Italy"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Crypt"},{trait_type:"Season",value:"Halloween 2025"}]},"poveglia-island":{name:"Poveglia Island Survivor",description:"You've visited the haunted Poveglia Island in the Venetian Lagoon.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/poveglia.png",attributes:[{trait_type:"Location",value:"Venice, Italy"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Island"},{trait_type:"Season",value:"Halloween 2025"},{trait_type:"Rarity",value:"Legendary"}]},"hellfire-caves":{name:"Hellfire Caves Explorer",description:"You've explored the mysterious Hellfire Caves of the secret society.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/hellfire-caves.png",attributes:[{trait_type:"Location",value:"West Wycombe, UK"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Caves"},{trait_type:"Season",value:"Halloween 2025"}]},"aokigahara-forest":{name:"Aokigahara Forest Explorer",description:"You've walked through the mysterious Sea of Trees at Mount Fuji.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/aokigahara.png",attributes:[{trait_type:"Location",value:"Mount Fuji, Japan"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Forest"},{trait_type:"Season",value:"Halloween 2025"}]},"hill-of-crosses":{name:"Hill of Crosses Pilgrim",description:"You've visited the haunting Hill of Crosses in Lithuania.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/hill-crosses.png",attributes:[{trait_type:"Location",value:"iauliai, Lithuania"},{trait_type:"Spookiness",value:"3/5"},{trait_type:"Category",value:"Memorial"},{trait_type:"Season",value:"Halloween 2025"}]},"prague-cemetery":{name:"Prague Cemetery Explorer",description:"You've explored the ancient Old Jewish Cemetery in Prague.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/prague-cemetery.png",attributes:[{trait_type:"Location",value:"Prague, Czech Republic"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Cemetery"},{trait_type:"Season",value:"Halloween 2025"}]},"gettysburg-battlefield":{name:"Gettysburg Ghost Hunter",description:"You've walked the haunted grounds of Gettysburg Battlefield.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/gettysburg.png",attributes:[{trait_type:"Location",value:"Gettysburg, Pennsylvania"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Battlefield"},{trait_type:"Season",value:"Halloween 2025"}]},"monte-cristo-homestead":{name:"Monte Cristo Survivor",description:"You've survived a visit to Australia's most haunted house.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/monte-cristo.png",attributes:[{trait_type:"Location",value:"Junee, Australia"},{trait_type:"Spookiness",value:"5/5"},{trait_type:"Category",value:"Mansion"},{trait_type:"Season",value:"Halloween 2025"}]},"highgate-cemetery":{name:"Highgate Cemetery Explorer",description:"You've explored the Gothic Victorian Highgate Cemetery.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/highgate.png",attributes:[{trait_type:"Location",value:"London, UK"},{trait_type:"Spookiness",value:"4/5"},{trait_type:"Category",value:"Cemetery"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-ghost-hunter-initiation":{name:"Ghost Hunter Initiation",description:"Completed the Ghost Hunter Initiation quest - your first step into the paranormal world.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/ghost-hunter-badge.png",attributes:[{trait_type:"Quest",value:"Ghost Hunter Initiation"},{trait_type:"Difficulty",value:"Easy"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-first-scare":{name:"First Scare",description:"Experienced your first haunted location and lived to tell the tale.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/first-scare.png",attributes:[{trait_type:"Quest",value:"First Scare"},{trait_type:"Difficulty",value:"Easy"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-vampire-chronicles":{name:"Vampire Chronicles",description:"Followed in the footsteps of legendary vampires at Bran Castle.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/vampire-hunter.png",attributes:[{trait_type:"Quest",value:"Vampire Chronicles"},{trait_type:"Difficulty",value:"Hard"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-witch-trial-historian":{name:"Witch Trial Historian",description:"Explored the dark history of the Salem Witch Trials.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/witch-historian.png",attributes:[{trait_type:"Quest",value:"Witch Trial Historian"},{trait_type:"Difficulty",value:"Medium"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-catacombs-explorer":{name:"Catacombs Explorer",description:"Descended into the Paris Catacombs and walked among 6 million souls.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/catacombs-explorer.png",attributes:[{trait_type:"Quest",value:"Catacombs Explorer"},{trait_type:"Difficulty",value:"Hard"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-paranormal-investigator":{name:"Paranormal Investigator",description:"Became a true paranormal investigator by visiting 3 different haunted locations.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/paranormal-investigator.png",attributes:[{trait_type:"Quest",value:"Paranormal Investigator"},{trait_type:"Difficulty",value:"Medium"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-graveyard-shift":{name:"Graveyard Shift",description:"Visited a historic cemetery or catacombs at night.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/graveyard-shift.png",attributes:[{trait_type:"Quest",value:"Graveyard Shift"},{trait_type:"Difficulty",value:"Hard"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"}]},"halloween-master-of-darkness":{name:"Master of Darkness",description:"Completed 10 spooky destination quests and became a true Master of Darkness.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/master-darkness.png",attributes:[{trait_type:"Quest",value:"Master of Darkness"},{trait_type:"Difficulty",value:"Legendary"},{trait_type:"Category",value:"Halloween Quest"},{trait_type:"Season",value:"Halloween 2025"},{trait_type:"Rarity",value:"Legendary"}]},"machu-picchu-journey":{name:"Machu Picchu Explorer",description:"You've completed the journey to Machu Picchu, one of the New Seven Wonders of the World!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-machu-picchu.png",attributes:[{trait_type:"Location",value:"Machu Picchu, Peru"},{trait_type:"Category",value:"World Wonder"},{trait_type:"Season",value:"Halloween 2025"}]},"great-wall-of-china":{name:"Great Wall Conqueror",description:"You've walked along the Great Wall of China, one of the most impressive architectural feats in history!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-great-wall.png",attributes:[{trait_type:"Location",value:"Beijing, China"},{trait_type:"Category",value:"World Wonder"},{trait_type:"Season",value:"Halloween 2025"}]},"pyramids-of-giza":{name:"Pyramid Explorer",description:"You've visited the ancient Pyramids of Giza and the Sphinx, one of the Seven Wonders of the Ancient World!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-pyramids-giza.png",attributes:[{trait_type:"Location",value:"Giza, Egypt"},{trait_type:"Category",value:"Ancient Wonder"},{trait_type:"Season",value:"Halloween 2025"}]},"colosseum-exploration":{name:"Colosseum Gladiator",description:"You've visited the ancient Colosseum in Rome and stepped back in time!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-colosseum.png",attributes:[{trait_type:"Location",value:"Rome, Italy"},{trait_type:"Category",value:"Historical"},{trait_type:"Season",value:"Halloween 2025"}]},"10000-steps-walk-in-warsaw":{name:"Warsaw Walker",description:"You've completed a 10,000-step walk through the beautiful streets of Warsaw!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-warsaw-walk.png",attributes:[{trait_type:"Location",value:"Warsaw, Poland"},{trait_type:"Category",value:"Fitness"},{trait_type:"Season",value:"Halloween 2025"}]},"taj-mahal-discovery":{name:"Taj Mahal Discoverer",description:"You've visited the magnificent Taj Mahal, a symbol of eternal love!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-taj-mahal.png",attributes:[{trait_type:"Location",value:"Agra, India"},{trait_type:"Category",value:"World Wonder"},{trait_type:"Season",value:"Halloween 2025"}]},"eiffel-tower-adventure":{name:"Eiffel Tower Adventurer",description:"You've visited the iconic Eiffel Tower in Paris!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-eiffel-tower.png",attributes:[{trait_type:"Location",value:"Paris, France"},{trait_type:"Category",value:"Landmark"},{trait_type:"Season",value:"Halloween 2025"}]},"statue-of-liberty-visit":{name:"Liberty Explorer",description:"You've seen the Statue of Liberty, a symbol of freedom and democracy!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-statue-liberty.png",attributes:[{trait_type:"Location",value:"New York, USA"},{trait_type:"Category",value:"Landmark"},{trait_type:"Season",value:"Halloween 2025"}]},"sydney-opera-house":{name:"Sydney Opera House Visitor",description:"You've visited the architectural masterpiece that is the Sydney Opera House!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-sydney-opera.png",attributes:[{trait_type:"Location",value:"Sydney, Australia"},{trait_type:"Category",value:"UNESCO Heritage"},{trait_type:"Season",value:"Halloween 2025"}]},"warsaw-uprising-museum":{name:"Warsaw Uprising Historian",description:"You've explored the Warsaw Uprising Museum and learned about the heroic resistance!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-warsaw-uprising.png",attributes:[{trait_type:"Location",value:"Warsaw, Poland"},{trait_type:"Category",value:"Historical"},{trait_type:"Season",value:"Halloween 2025"}]},"big-ben-westminster":{name:"Big Ben Explorer",description:"You've explored the historic Big Ben and Westminster area in London!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-big-ben.png",attributes:[{trait_type:"Location",value:"London, UK"},{trait_type:"Category",value:"Landmark"},{trait_type:"Season",value:"Halloween 2025"}]},"tokyo-tower-experience":{name:"Tokyo Tower Visitor",description:"You've visited Tokyo Tower and enjoyed panoramic views of the city!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-tokyo.png",attributes:[{trait_type:"Location",value:"Tokyo, Japan"},{trait_type:"Category",value:"Landmark"},{trait_type:"Season",value:"Halloween 2025"}]},"palace-of-culture-and-science":{name:"Palace of Culture Explorer",description:"You've visited the iconic Palace of Culture and Science in Warsaw!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-palace-culture.png",attributes:[{trait_type:"Location",value:"Warsaw, Poland"},{trait_type:"Category",value:"Landmark"},{trait_type:"Season",value:"Halloween 2025"}]},"legia-warszawa-stadium-visit":{name:"Legia Warszawa Fan",description:"You've visited the iconic Legia Warszawa stadium and experienced Polish football passion!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-legia-warszawa.png",attributes:[{trait_type:"Location",value:"Warsaw, Poland"},{trait_type:"Category",value:"Sports"},{trait_type:"Season",value:"Halloween 2025"}]},"coffee-on-francuska-street":{name:"Francuska Street Coffee Lover",description:"You've enjoyed a traditional Polish coffee at one of the charming cafes on Francuska Street!",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/quest-francuska-street.png",attributes:[{trait_type:"Location",value:"Warsaw, Poland"},{trait_type:"Category",value:"Culinary"},{trait_type:"Season",value:"Halloween 2025"}]},"ghost-hunter-badge":{name:"Ghost Hunter Badge",description:"Awarded for visiting your first spooky destination.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/ghost-hunter-badge.png",attributes:[{trait_type:"Type",value:"Achievement"},{trait_type:"Tier",value:"Bronze"},{trait_type:"Season",value:"Halloween 2025"}]},"paranormal-investigator":{name:"Paranormal Investigator",description:"Awarded for visiting 3 different haunted locations.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/paranormal-investigator.png",attributes:[{trait_type:"Type",value:"Achievement"},{trait_type:"Tier",value:"Silver"},{trait_type:"Season",value:"Halloween 2025"}]},"master-darkness":{name:"Master of Darkness",description:"Awarded for completing 10 spooky destination quests.",image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/master-darkness.png",attributes:[{trait_type:"Type",value:"Achievement"},{trait_type:"Tier",value:"Gold"},{trait_type:"Season",value:"Halloween 2025"},{trait_type:"Rarity",value:"Legendary"}]}},Nve=t=>Rve[t]||null,VW=async(t,e,n)=>{try{if(console.log("[HalloweenNFT] Sending",e,"TPX to",t,"for destination:",n),e<=0)return{success:!1,error:"Invalid reward amount"};const s=await SN(t,e);if(!s.success)return console.error("[HalloweenNFT] TPX transfer failed:",s.error),{success:!1,error:s.error||"Transfer failed"};console.log("[HalloweenNFT]  TPX transfer successful:",s.txHash);try{await Kt.from("token_transactions").insert({wallet_address:t.toLowerCase(),amount:e,tx_hash:s.txHash,status:"pending",type:"halloween_quest_reward",metadata:{destinationId:n,source:"spooky_destinations"}})}catch(l){console.warn("[HalloweenNFT] Failed to log transaction (non-critical):",l)}return{success:!0,txHash:s.txHash}}catch(s){return console.error("[HalloweenNFT] TPX reward error:",s),{success:!1,error:s.message||"Unknown error"}}},HW=async(t,e,n)=>{try{console.log("[HalloweenNFT] Direct minting NFT for destination:",e);const s=Nve(e),l=s?{name:s.name,description:s.description,image:s.image,attributes:s.attributes}:{name:`Spooky Explorer - ${e}`,description:`You've completed a spooky destination quest at ${e}!`,image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/generic-halloween.png",attributes:[{trait_type:"Category",value:"Halloween"},{trait_type:"Season",value:"Halloween 2025"}]},u=JSON.stringify(l),r=`data:application/json;base64,${btoa(unescape(encodeURIComponent(u)))}`;console.log("[HalloweenNFT] Minting with name:",l.name),console.log("[HalloweenNFT] Image URL:",l.image);const v=`spooky-${e}`,w=await TN(t,r,v);if(!w.success)return console.error("[HalloweenNFT] NFT mint failed:",w.error),{success:!1,error:w.error||"Mint failed"};console.log("[HalloweenNFT]  NFT minted:",w.tokenId,"tx:",w.txHash);try{await Kt.from("nft_transactions").insert({user_id:n||null,quest_id:`spooky-${e}`,nft_type:"halloween_achievement",token_id:w.tokenId,tx_hash:w.txHash,contract_address:"0x110D62545d416d3DFEfA12D0298aBf197CF0e828",status:"pending",metadata_uri:r})}catch(E){console.warn("[HalloweenNFT] Failed to log NFT transaction (non-critical):",E)}return{success:!0,tokenId:w.tokenId,txHash:w.txHash}}catch(s){return console.error("[HalloweenNFT] Direct mint error:",s),{success:!1,error:s.message||"Unknown error"}}},jve=t=>t.toLowerCase().replace(/['']/g,"").replace(/&/g,"").replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,""),Dve=({quest:t,userId:e,walletAddress:n,onClose:s,onComplete:l})=>{const[u,p]=he.useState(null),[r,v]=he.useState(null),[w,E]=he.useState(!1),[T,k]=he.useState("upload"),[R,D]=he.useState(null),[O,F]=he.useState(null),[U,X]=he.useState(null),W=ce=>{var Me;const ye=(Me=ce.target.files)==null?void 0:Me[0];if(!ye)return;p(ye);const Ce=new FileReader;Ce.onloadend=()=>{v(Ce.result)},Ce.readAsDataURL(ye)},K=async()=>{if(!u){dr.error("Please upload a photo first");return}E(!0),X(null);try{const ce=u.name.split(".").pop(),ye=Date.now(),Ce=`${e}/${t.id}/${ye}.${ce}`,{error:Me}=await Kt.storage.from("quest-proofs").upload(Ce,u,{cacheControl:"3600",upsert:!1});if(Me)throw new Error(`Upload failed: ${Me.message}`);const{data:{publicUrl:Ke}}=Kt.storage.from("quest-proofs").getPublicUrl(Ce);await Kt.from("user_quests").update({status:"completed",proof_image_url:Ke,completed_at:new Date().toISOString()}).eq("user_id",e).eq("quest_id",t.id),D({xp:t.reward_xp,tpx:t.reward_tokens,nft:t.nft_reward}),k("verified"),dr.success("Quest Verified! ",{description:"Your photo has been accepted. Claim your rewards!"})}catch(ce){X(ce.message||"Verification failed. Please try again."),dr.error("Verification failed",{description:ce.message})}finally{E(!1)}},ne=async()=>{if(R){k("claiming");try{const ce=await qA();let ye=null;const Ce=jve(t.title),Me="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd",Ke="0x110D62545d416d3DFEfA12D0298aBf197CF0e828";if(R.tpx>0){dr.loading(`Sending ${R.tpx} TPX tokens...`,{id:"tpx-claim"});const ke=await VW(n,R.tpx,t.id);ke.success?(dr.dismiss("tpx-claim"),dr.loading(" Waiting for TPX confirmation...",{id:"tpx-monitor"}),await new Promise(je=>{let $e=!1;EW(n,async Ae=>{if(!$e){if($e=!0,dr.dismiss("tpx-monitor"),dr.success(`${R.tpx} TPX confirmed!`,{action:{label:"View",onClick:()=>window.open(Cx(Ae.transactionHash),"_blank")}}),window.ethereum&&Me)try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:Me,symbol:"TPX",decimals:18,image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/assets/tpx-logo.png"}}})}catch{}je()}},()=>{},60,ce).then(()=>{$e||($e=!0,dr.dismiss("tpx-monitor"),je())})})):(dr.dismiss("tpx-claim"),dr.error("TPX transfer failed",{description:ke.error}))}if(R.nft){dr.loading("Minting Achievement NFT...",{id:"nft-mint"});const ke=await HW(n,Ce,e);if(ke.success&&ke.txHash){dr.dismiss("nft-mint"),dr.loading(" Waiting for NFT confirmation on blockchain...",{id:"nft-monitor"});const je=await C2(n,()=>{},()=>{},Ke,60,ce);if(dr.dismiss("nft-monitor"),je.found&&je.tokenId){ye=je.tokenId,dr.success(" NFT confirmed on blockchain!",{description:`Token #${ye}`,action:{label:"View TX",onClick:()=>window.open(Cx(je.transactionHash),"_blank")}}),F({tokenId:ye,contractAddress:Ke||""}),await Kt.from("user_quests").update({tokens_claimed:!0,nft_minted:!0,nft_token_id:ye,claimed_at:new Date().toISOString()}).eq("user_id",e).eq("quest_id",t.id),await WT(e),R.xp>0&&await $T(e,R.xp);try{R.tpx>0&&await Ax(e,R.tpx,""),await rb(e,"achievement",ye,je.transactionHash||""),await Ex(e,t.title,R.xp,R.tpx)}catch($e){console.warn("[QuestVerification] Failed to create notifications:",$e)}k("nft-success");return}else{ye=ke.tokenId||1,dr.success(" NFT minted! Awaiting confirmation...",{description:`TX: ${ke.txHash.slice(0,10)}...`,action:{label:"View TX",onClick:()=>window.open(Cx(ke.txHash),"_blank")}}),F({tokenId:ye,contractAddress:Ke||""}),await Kt.from("user_quests").update({tokens_claimed:!0,nft_minted:!0,nft_token_id:ye,claimed_at:new Date().toISOString()}).eq("user_id",e).eq("quest_id",t.id),await WT(e),R.xp>0&&await $T(e,R.xp);try{R.tpx>0&&await Ax(e,R.tpx,ke.txHash||""),await rb(e,"achievement",ye,ke.txHash||""),await Ex(e,t.title,R.xp,R.tpx)}catch($e){console.warn("[QuestVerification] Failed to create notifications:",$e)}k("nft-success");return}}else dr.dismiss("nft-mint"),dr.error("NFT mint failed",{description:ke.error})}await Kt.from("user_quests").update({tokens_claimed:!0,claimed_at:new Date().toISOString()}).eq("user_id",e).eq("quest_id",t.id),await WT(e),R.xp>0&&await $T(e,R.xp);try{R.tpx>0&&await Ax(e,R.tpx,""),await Ex(e,t.title,R.xp,R.tpx)}catch(ke){console.warn("[QuestVerification] Failed to create notifications:",ke)}dr.success("All rewards claimed! ",{description:`+${R.xp} XP, +${R.tpx} TPX`}),k("complete")}catch(ce){dr.error("Failed to claim rewards",{description:ce.message}),k("verified")}}},te=async()=>{if(!(!O||!window.ethereum))try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:O.contractAddress,tokenId:O.tokenId.toString()}}}),dr.success("NFT added to wallet!"),Zm(O.tokenId,O.contractAddress)}catch{Zm(O.tokenId,O.contractAddress)}},re=()=>{window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:{userId:e,walletAddress:n}})),l(),s(),window.location.reload()};t.image_url||UW(t.title,t.location||"");const xe=O?`https://sepolia.etherscan.io/nft/${O.contractAddress}/${O.tokenId}`:"",ae=f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/85 backdrop-blur-md",onClick:ce=>{T==="upload"&&s()},children:f.jsxs(it.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},onClick:ce=>ce.stopPropagation(),className:"bg-gradient-to-br from-deepPurple to-midnightBlue border border-pumpkinOrange/40 rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden",children:[f.jsxs("div",{className:"relative p-6 border-b border-pumpkinOrange/20",children:[T==="upload"&&f.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 rounded-full bg-black/30 hover:bg-black/50 transition-colors",children:f.jsx(Qa,{className:"w-5 h-5 text-ghostlyWhite"})}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(Ja,{className:"w-10 h-10 text-pumpkinOrange"}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-spooky text-ghostlyWhite",children:T==="nft-success"?" NFT Minted!":"Complete Quest"}),f.jsx("p",{className:"text-ghostlyWhite/60 text-sm line-clamp-1",children:t.title})]})]})]}),f.jsx("div",{className:"p-6",children:f.jsxs(Xc,{mode:"wait",children:[T==="upload"&&f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:[f.jsxs("div",{className:"mb-6",children:[f.jsxs("label",{className:"block text-ghostlyWhite font-medium mb-2",children:[f.jsx(Rw,{className:"w-4 h-4 inline mr-2"}),"Upload Photo Proof"]}),r?f.jsxs("div",{className:"relative rounded-xl overflow-hidden",children:[f.jsx("img",{src:r,alt:"Preview",className:"w-full h-48 object-cover"}),f.jsx("button",{onClick:()=>{p(null),v(null)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/50 hover:bg-black/70",children:f.jsx(Qa,{className:"w-4 h-4 text-white"})})]}):f.jsxs("label",{className:"flex flex-col items-center justify-center h-48 border-2 border-dashed border-pumpkinOrange/40 rounded-xl cursor-pointer hover:border-pumpkinOrange/60 transition-colors bg-deepPurple/30",children:[f.jsx(j$,{className:"w-10 h-10 text-pumpkinOrange/60 mb-2"}),f.jsx("span",{className:"text-ghostlyWhite/60 text-sm",children:"Click to upload photo"}),f.jsx("input",{type:"file",accept:"image/*",onChange:W,className:"hidden"})]})]}),f.jsxs("div",{className:"bg-deepPurple/40 rounded-xl p-4 mb-6 border border-ghostlyWhite/10",children:[f.jsx("h3",{className:"text-sm font-medium text-ghostlyWhite/70 mb-3",children:"Rewards you'll earn:"}),f.jsxs("div",{className:"flex items-center justify-around",children:[f.jsxs("div",{className:"text-center",children:[f.jsx(md,{className:"w-6 h-6 text-yellow-400 mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-yellow-400",children:t.reward_xp}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx(Ya,{className:"w-6 h-6 text-pumpkinOrange mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-pumpkinOrange",children:t.reward_tokens}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"TPX"})]}),t.nft_reward&&f.jsxs("div",{className:"text-center",children:[f.jsx(vp,{className:"w-6 h-6 text-purple-400 mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-purple-400",children:"1"}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"NFT"})]})]})]}),U&&f.jsx("div",{className:"mb-4 p-3 bg-bloodOrange/20 border border-bloodOrange/40 rounded-lg text-bloodOrange text-sm",children:U}),f.jsx("button",{onClick:K,disabled:!u||w,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-5 h-5 animate-spin"})," Verifying..."]}):f.jsxs(f.Fragment,{children:[f.jsx(la,{className:"w-5 h-5"})," Verify & Complete Quest"]})})]},"upload"),T==="verified"&&R&&f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0},animate:{scale:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-toxicGreen/20 flex items-center justify-center",children:f.jsx(la,{className:"w-10 h-10 text-toxicGreen"})}),f.jsx("h3",{className:"text-2xl font-spooky text-toxicGreen mb-2",children:"Quest Verified!"}),f.jsx("p",{className:"text-ghostlyWhite/70 mb-6",children:"Your photo has been accepted."}),f.jsxs("div",{className:"bg-deepPurple/40 rounded-xl p-4 mb-6 border border-toxicGreen/30",children:[f.jsx("h4",{className:"text-sm font-medium text-ghostlyWhite/70 mb-3",children:"Your Rewards:"}),f.jsxs("div",{className:"flex items-center justify-around",children:[f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:R.xp}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-pumpkinOrange",children:R.tpx}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"TPX"})]}),R.nft&&f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"1"}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"NFT"})]})]})]}),f.jsxs("button",{onClick:ne,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(vp,{className:"w-5 h-5"})," Claim All Rewards"]})]},"verified"),T==="claiming"&&f.jsxs(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-8",children:[f.jsx(va,{className:"w-16 h-16 text-pumpkinOrange mx-auto mb-4 animate-spin"}),f.jsx("h3",{className:"text-xl font-spooky text-ghostlyWhite mb-2",children:"Claiming Rewards..."}),f.jsx("p",{className:"text-ghostlyWhite/60",children:"Please wait and approve any wallet popups"})]},"claiming"),T==="nft-success"&&O&&f.jsxs(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",duration:.8},className:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500 to-pumpkinOrange flex items-center justify-center",children:f.jsx(Ho,{className:"w-12 h-12 text-white"})}),f.jsx("h3",{className:"text-2xl font-spooky text-purple-400 mb-2",children:"Achievement NFT Minted!"}),f.jsxs("p",{className:"text-ghostlyWhite/70 mb-2",children:["Token #",O.tokenId]}),f.jsx("p",{className:"text-ghostlyWhite/50 text-sm mb-6",children:t.title}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("button",{onClick:te,className:"w-full py-3 px-6 bg-gradient-to-r from-purple-600 to-purple-800 text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(vp,{className:"w-5 h-5"})," Add NFT to MetaMask"]}),f.jsxs("a",{href:xe,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-6 bg-deepPurple/50 text-ghostlyWhite font-medium rounded-xl hover:bg-deepPurple/70 transition-colors border border-ghostlyWhite/20 flex items-center justify-center gap-2",children:[f.jsx(Jo,{className:"w-5 h-5"})," View on Etherscan"]}),f.jsxs("button",{onClick:re,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(la,{className:"w-5 h-5"})," Done - Close & Refresh"]})]})]},"nft-success"),T==="complete"&&f.jsxs(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0},animate:{scale:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-toxicGreen/20 flex items-center justify-center",children:f.jsx(la,{className:"w-10 h-10 text-toxicGreen"})}),f.jsx("h3",{className:"text-2xl font-spooky text-toxicGreen mb-2",children:"All Rewards Claimed!"}),f.jsxs("p",{className:"text-ghostlyWhite/70 mb-6",children:["+",R==null?void 0:R.xp," XP, +",R==null?void 0:R.tpx," TPX"]}),f.jsxs("button",{onClick:re,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(la,{className:"w-5 h-5"})," Done - Close & Refresh"]})]},"complete")]})})]})});return typeof document<"u"?CA.createPortal(ae,document.body):ae},Lve=({onNavigate:t})=>{const{user:e,address:n,isConnected:s}=ba(),{user:l,isAuthenticated:u}=El(),p=e||l,r=s||u,[v,w]=he.useState([]),[E,T]=he.useState(!0),[k,R]=he.useState(null),[D,O]=he.useState(!1),[F,U]=he.useState(!1),[X,W]=he.useState(null),[K,ne]=he.useState(null),[te,re]=he.useState(null),[xe,ae]=he.useState(null),[ce,ye]=he.useState("all"),[Ce,Me]=he.useState(null),[Ke,ke]=he.useState(null),[je,$e]=he.useState(null),[Ae,He]=he.useState(!1),[qe,Le]=he.useState(null),st=he.useRef(new Set),[bt,yt]=he.useState(!1),[Vt,_t]=he.useState(0),[vt,qt]=he.useState(null),[kt,on]=he.useState(!1);he.useEffect(()=>{console.log("[MyQuests] Quests state updated. Total:",v.length),v.forEach((wn,Nn)=>{var mr,Qn;(wn.status==="completed"||wn.status==="verified")&&console.log(`  [${Nn}] ${(mr=wn.quests)==null?void 0:mr.title}: status=${wn.status}, nft_reward=${(Qn=wn.quests)==null?void 0:Qn.nft_reward}, nft_minted=${wn.nft_minted}, token_id=${wn.nft_token_id}`)})},[v]),he.useEffect(()=>{if(!r){w([]),T(!1);return}if(p)console.log("[MyQuests] User loaded, loading quests...",p.id),mn(),Hr();else{console.log("[MyQuests] Waiting for user data...");let wn=0;const Nn=5,mr=()=>{wn++,p?(console.log("[MyQuests] User loaded after wait, loading quests...",p.id),mn(),Hr()):wn<Nn?(console.log(`[MyQuests] Retry ${wn}/${Nn} - waiting for user...`),setTimeout(mr,1e3)):(console.log("[MyQuests] User still not loaded after all attempts"),T(!1))},Qn=setTimeout(mr,500);return()=>clearTimeout(Qn)}},[r,p]);const mn=async()=>{var wn;if(!p){console.log("[MyQuests] No user - cannot load quests");return}console.log("[MyQuests] Loading quests for user:",p.id),console.log("[MyQuests] User wallet:",p.wallet_address),T(!0);try{const{data:{session:Nn}}=await Kt.auth.getSession();console.log("[MyQuests] Current session:",Nn?"Active":"None"),Nn||console.warn("[MyQuests] No active session - quests may not load");const mr=await Mve(p.id,{});console.log("[MyQuests] Quests loaded:",(mr==null?void 0:mr.length)||0),mr&&mr.length>0&&console.log("[MyQuests] Sample quest:",{id:mr[0].id,title:(wn=mr[0].quests)==null?void 0:wn.title,status:mr[0].status,nft_minted:mr[0].nft_minted,nft_token_id:mr[0].nft_token_id}),w(mr||[])}catch(Nn){console.error("[MyQuests] Error loading quests:",Nn),console.error("[MyQuests] Error details:",{message:Nn.message,code:Nn.code,details:Nn.details}),w([])}finally{T(!1)}},Hr=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(wn=>{Me({lat:wn.coords.latitude,lng:wn.coords.longitude})},wn=>{console.log("Location not available:",wn)})},Un=async(wn,Nn)=>{if(!window.ethereum||!n){console.log("[MyQuests] MetaMask not available");return}const mr="0x110D62545d416d3DFEfA12D0298aBf197CF0e828";try{if(console.log("[MyQuests] Prompting user to add NFT to MetaMask..."),await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:mr,tokenId:wn.toString()}}})){const Nt=`quest_nft_added_${n.toLowerCase()}_${Nn}`;localStorage.setItem(Nt,"true"),console.log("[MyQuests]  NFT added to MetaMask!"),dr.success("NFT added to MetaMask!",{description:`Token ID ${wn} is now visible in your wallet`,duration:5e3})}}catch(Qn){console.error("[MyQuests] Error adding NFT to MetaMask:",Qn),Qn.code===4001&&console.log("[MyQuests] User rejected NFT addition")}},$r=async wn=>{if(!(!p||!confirm("Are you sure you want to remove this quest from your list?"))){$e(wn);try{await RW(wn,p.id),await mn()}catch(Nn){console.error("Error deleting quest:",Nn),alert(Nn.message||"Failed to delete quest")}finally{$e(null)}}},ht=async()=>{if(!(!qe||!window.ethereum))try{console.log("[MyQuests] Adding Achievement NFT to MetaMask...",qe),await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:qe.contractAddress,tokenId:qe.tokenId.toString()}}}),console.log("[MyQuests]  Achievement NFT added to MetaMask!"),He(!1)}catch(wn){console.log("[MyQuests] User rejected or MetaMask does not support ERC721:",wn.message),He(!1)}},Lr=async wn=>{if(!p||!wn){console.error("[MyQuests] handleMintNFT: Missing user or userQuest"),dr.error("Unable to mint NFT",{description:"Missing user or quest data"});return}const Nn=wn.quests;if(!Nn){console.error("[MyQuests] handleMintNFT: Quest not found in userQuest"),dr.error("Quest data not found");return}if(!Nn.nft_reward){dr.error("Quest does not have NFT reward");return}if(wn.status!=="completed"&&wn.status!=="verified"){dr.error("Quest must be completed first");return}if(!n){dr.error("Please connect your wallet to mint NFT");return}if(wn.nft_minted||wn.nft_token_id||st.current.has(Nn.id)){console.log("[MyQuests] NFT already minted:",{nft_minted:wn.nft_minted,nft_token_id:wn.nft_token_id,sessionMinted:st.current.has(Nn.id)}),dr.error("NFT already minted for this quest");return}if(xe===wn.id)return;try{const{data:Qn}=await Kt.from("nft_transactions").select("token_id, tx_hash").eq("user_id",p.id).eq("quest_id",Nn.id).eq("nft_type","achievement").maybeSingle();if(Qn){console.log("[MyQuests] NFT found in transactions table:",Qn),dr.error("NFT already minted for this quest"),st.current.add(Nn.id),w(Nt=>Nt.map(et=>et.id===wn.id?{...et,nft_minted:!0,nft_token_id:Qn.token_id}:et));return}}catch(Qn){console.warn("[MyQuests] Pre-check failed, continuing...",Qn)}ae(wn.id);const mr=dr.loading(" Minting Achievement NFT...",{description:`Creating NFT for "${Nn.title}"`});try{console.log("[MyQuests] Minting NFT for quest:",{userId:p.id,questId:Nn.id,walletAddress:n,userQuestId:wn.id,status:wn.status});const{mintAchievementAPI:Qn}=await hr(async()=>{const{mintAchievementAPI:et}=await Promise.resolve().then(()=>BE);return{mintAchievementAPI:et}},void 0),Nt=await Qn(p.id,Nn.id,n);if(console.log("[MyQuests] Mint result:",Nt),Nt.success&&Nt.data){console.log("[MyQuests]  Achievement NFT minted successfully!"),st.current.add(Nn.id),w(rn=>rn.map(wr=>wr.id===wn.id?{...wr,nft_minted:!0,nft_token_id:Nt.data.tokenId}:wr));const et="0x110D62545d416d3DFEfA12D0298aBf197CF0e828",Oe=Nn.image_url||UW(Nn.title,Nn.location||Nn.location_name||"");Le({tokenId:Nt.data.tokenId,txHash:Nt.data.txHash,contractAddress:et,questTitle:Nn.title,imageUrl:Oe}),dr.dismiss(mr);const Bt=dr.loading(" Checking Sepolia explorer for NFT...",{description:"Monitoring transaction every 2 seconds",duration:1/0}),En=await qA();(await C2(n,rn=>{console.log("[MyQuests]  NFT transaction found on explorer!",rn),dr.dismiss(Bt),dr.success(" NFT minted successfully!",{description:`Token #${Nt.data.tokenId} for "${Nn.title}"`,duration:5e3,action:{label:"View on Etherscan",onClick:()=>window.open(Cx(rn.transactionHash),"_blank")}}),setTimeout(()=>Un(Nt.data.tokenId,Nn.id),1e3)},rn=>{dr.loading(` Checking Sepolia explorer... (${rn}/100)`,{id:Bt,description:"Monitoring every 2 seconds",duration:1/0})},et,100,En)).found||(dr.dismiss(Bt),dr.warning(" NFT mint not confirmed yet",{description:"Transaction may still be pending. Check Etherscan manually.",duration:8e3,action:{label:"Open Etherscan",onClick:()=>window.open(kN(n),"_blank")}})),window.dispatchEvent(new CustomEvent("nftMintComplete",{detail:{questId:Nn.id,tokenId:Nt.data.tokenId,txHash:Nt.data.txHash}})),setTimeout(async()=>{console.log("[MyQuests] Refreshing quests after NFT mint..."),await mn()},2e3)}else{const et=Nt.error||"Failed to mint NFT";console.error("[MyQuests] Mint failed:",et),dr.dismiss(mr),dr.error("Failed to mint NFT",{description:et})}}catch(Qn){console.error("[MyQuests] Error minting NFT:",Qn),dr.dismiss(loadingToast),dr.error("Minting failed",{description:Qn.message||"An unexpected error occurred"})}finally{ae(null)}},Br=v.filter(wn=>ce==="all"?!0:ce==="pending"?wn.status!=="completed":ce==="completed"?wn.status==="completed":!0);return E&&r?f.jsx("div",{className:"max-w-7xl mx-auto flex items-center justify-center py-20",children:f.jsx(va,{className:"w-12 h-12 text-cyan-400 animate-spin"})}):r?v.length===0?f.jsx("div",{className:"max-w-7xl mx-auto",children:f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx(Mo,{className:"w-20 h-20 text-white/30 mb-6"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"No Quests Yet"}),f.jsx("p",{className:"text-white/60 mb-6",children:"Create a trip to generate quests automatically"}),t&&f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>t("create"),className:"px-8 py-4 rounded-xl bg-gradient-to-r from-white/20 to-white/10 backdrop-blur-xl text-white font-semibold border border-white/30 hover:border-white/50 hover:from-white/25 hover:to-white/15 transition-all duration-300 shadow-xl hover:shadow-white/30",children:"Create Trip"})]})}):f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[f.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"My Quests"}),f.jsx("p",{className:"text-sm sm:text-base text-white/60",children:"Complete quests and earn rewards"})]}),f.jsx("div",{className:"flex gap-2 mb-4 sm:mb-6 overflow-x-auto pb-2 -mb-2",children:["all","pending","completed"].map(wn=>f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>ye(wn),className:`px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-medium transition-all duration-300 whitespace-nowrap text-sm sm:text-base ${ce===wn?"bg-white/20 backdrop-blur-xl text-white shadow-lg shadow-white/10 border border-white/30":"bg-white/5 backdrop-blur-md text-white/50 hover:bg-white/10 hover:text-white/80 border border-white/10 hover:border-white/20"}`,children:wn.charAt(0).toUpperCase()+wn.slice(1)},wn))}),f.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:Br.map((wn,Nn)=>{const mr=wn.quests;if(!mr)return null;const Qn=wn.status==="completed"||wn.status==="verified";return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Nn*.1},whileHover:{y:-8,scale:1.02},className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6 hover:bg-white/10 hover:border-white/20 hover:shadow-xl hover:shadow-white/5 transition-all duration-300",children:[f.jsxs("div",{className:"flex items-start justify-between mb-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:mr.title}),f.jsx("p",{className:"text-white/60 text-sm line-clamp-2",children:mr.description})]}),Qn&&f.jsx(la,{className:"w-6 h-6 text-green-400 flex-shrink-0"})]}),f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(Mo,{className:"w-4 h-4 text-purple-400"}),f.jsx("span",{className:"text-white/60 text-sm",children:mr.location})]}),f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05,y:-2},transition:{duration:.3},className:"inline-flex px-4 py-2 rounded-xl backdrop-blur-xl bg-gradient-to-r from-teal-500/80 to-cyan-500/80 border border-white/[0.15] text-white text-sm font-semibold mb-4 shadow-[0_8px_24px_rgba(20,184,166,0.3)] hover:shadow-[0_16px_48px_rgba(20,184,166,0.5)] hover:border-white/[0.25] transition-all duration-300",children:f.jsxs("span",{className:"relative",children:["Difficulty: ",mr.difficulty,"/5",f.jsx("span",{className:"absolute inset-0 blur-sm bg-gradient-to-r from-white/[0.05] via-white/[0.15] to-white/[0.05] rounded-lg -z-10"})]})}),f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(md,{className:"w-4 h-4 text-yellow-400"}),f.jsxs("span",{className:"text-white font-semibold",children:[mr.reward_xp," XP"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Ya,{className:"w-4 h-4 text-cyan-400"}),f.jsxs("span",{className:"text-white font-semibold",children:[mr.reward_tokens," TPX"]})]}),mr.nft_reward&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gradient-to-r from-purple-500/30 to-pink-500/30 border border-purple-400/40",children:[f.jsx(Ho,{className:"w-3 h-3 text-purple-300"}),f.jsx("span",{className:"text-[10px] font-semibold text-purple-300",children:"NFT"})]})]}),f.jsxs("div",{className:"flex gap-2",children:[!Qn&&f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},onClick:()=>{n?qt(wn):dr.error("Please connect your wallet to complete quests")},className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-white/20 to-white/10 backdrop-blur-md text-white font-semibold border border-white/20 hover:border-white/40 hover:from-white/25 hover:to-white/15 transition-all duration-300 shadow-lg hover:shadow-white/20",children:"Complete Quest"}),Qn&&mr.nft_reward&&!wn.nft_minted&&!wn.nft_tx_hash&&!st.current.has(mr.id)&&n&&f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},onClick:()=>Lr(wn),disabled:xe===wn.id||!n,className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-purple-500/30 to-pink-500/30 backdrop-blur-md text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 border border-purple-400/30 hover:border-purple-400/60 hover:from-purple-500/40 hover:to-pink-500/40 transition-all duration-300 shadow-lg hover:shadow-purple-500/30",children:xe===wn.id?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-4 h-4 animate-spin"}),f.jsx("span",{children:"Minting..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(Ho,{className:"w-4 h-4"}),f.jsx("span",{children:"Mint NFT"})]})}),Qn&&mr.nft_reward&&(wn.nft_minted||wn.nft_tx_hash)&&f.jsxs("div",{className:"flex-1 py-3 rounded-xl bg-green-500/10 backdrop-blur-md border border-green-400/30 text-green-400 text-center font-semibold flex items-center justify-center gap-2 shadow-lg",children:[f.jsx(la,{className:"w-4 h-4"}),f.jsx("span",{children:"NFT Minted"})]}),f.jsx(it.button,{whileHover:{scale:1.1,y:-2},whileTap:{scale:.95},onClick:()=>ke(mr),className:"px-4 py-3 rounded-xl bg-white/5 hover:bg-white/15 backdrop-blur-md text-white/70 hover:text-white border border-white/10 hover:border-white/30 transition-all duration-300",title:"View Details",children:f.jsx(Ep,{className:"w-5 h-5"})}),!Qn&&f.jsx(it.button,{whileHover:{scale:1.1,y:-2},whileTap:{scale:.95},onClick:()=>$r(wn.id),disabled:je===wn.id,className:"px-4 py-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 backdrop-blur-md text-red-400/80 hover:text-red-400 border border-red-400/20 hover:border-red-400/40 transition-all duration-300 disabled:opacity-50",title:"Remove Quest",children:je===wn.id?f.jsx(va,{className:"w-5 h-5 animate-spin"}):f.jsx(E2,{className:"w-5 h-5"})})]})]},wn.id)})}),!1,Ke&&f.jsx(LW,{quest:Ke,onClose:()=>ke(null),onShowOnMap:wn=>{t&&(t("dashboard"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("showQuestOnMap",{detail:wn}))},100)),ke(null)},onAcceptQuest:()=>{mn()}}),qe&&f.jsx(AW,{isOpen:Ae,onClose:()=>He(!1),onAddToWallet:ht,nftType:"achievement",tokenId:qe.tokenId,contractAddress:qe.contractAddress,txHash:qe.txHash,questTitle:qe.questTitle,imageUrl:qe.imageUrl}),kt&&f.jsx(XA,{type:"quest",onComplete:()=>on(!1)}),vt&&p&&n&&f.jsx(Dve,{quest:{id:vt.quests.id,title:vt.quests.title,description:vt.quests.description,location:vt.quests.location,reward_tokens:vt.quests.reward_tokens||0,reward_xp:vt.quests.reward_xp||0,nft_reward:vt.quests.nft_reward||!1,image_url:vt.quests.image_url},userId:p.id,walletAddress:n,onClose:()=>qt(null),onComplete:()=>{on(!0),mn(),qt(null)}})]}):f.jsx("div",{className:"max-w-7xl mx-auto",children:f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx(Vl,{className:"w-20 h-20 text-white/30 mb-6"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Please Sign In"}),f.jsx("p",{className:"text-white/60",children:"Connect your wallet or sign in to view your quests"})]})})};async function Ove(t,e,n,s){var E,T,k;console.log(" saveTripToSupabase CALLED"),console.log(" userId:",t),console.log(" tripData:",JSON.stringify(e,null,2)),console.log(" detailedPlan:",s?"YES":"NO"),s!=null&&s.daily_plan&&(console.log(" daily_plan length:",s.daily_plan.length),console.log(" daily_plan:",JSON.stringify(s.daily_plan,null,2)));const l=e.destination.split(",").map(R=>R.trim()),u=l[0]||e.destination,p=l[l.length-1]||null,{data:r,error:v}=await Kt.from("trips").insert({user_id:t,destination:e.destination,duration_days:e.duration,interests:e.interests,budget:e.budget,status:"active",latitude:n.lat,longitude:n.lng,country:p,city:u,total_cost:((E=s==null?void 0:s.total_estimated_cost)==null?void 0:E.total)||0,route_data:s?{hotels:s.hotels,daily_plan:s.daily_plan,total_estimated_cost:s.total_estimated_cost,destination_info:s.destination_info,metadata:s.metadata}:null}).select().single();if(v)throw new Error(`Failed to create trip: ${v.message}`);const w=[];if(console.log(" QUEST CREATION SECTION"),console.log(" detailedPlan exists?",!!s),console.log(" daily_plan exists?",!!(s!=null&&s.daily_plan)),console.log(" daily_plan length:",(T=s==null?void 0:s.daily_plan)==null?void 0:T.length),s!=null&&s.daily_plan&&s.daily_plan.length>0){console.log(` Creating AI-generated quests from ${s.daily_plan.length} days...`);try{const{generateTripQuests:R,createQuestsFromGenerated:D}=await hr(async()=>{const{generateTripQuests:F,createQuestsFromGenerated:U}=await import("./aiQuestGenerationService-DDqt5LuK.js");return{generateTripQuests:F,createQuestsFromGenerated:U}},[]),O=[];console.log(" Collecting attractions from daily_plan...");for(let F=0;F<s.daily_plan.length;F++){const U=s.daily_plan[F],X=U.attractions||[],W=U.day_number||F+1;console.log(` Day ${W}: ${X.length} attractions`);for(const K of X)console.log(`   ${K.name}: place_id=${!!K.place_id}, coords=${!!K.coordinates}`),K.place_id&&K.coordinates?O.push({attraction:K,dayNumber:W}):console.log(`    Skipping ${K.name} - missing place_id or coordinates`)}if(console.log(` Total attractions collected: ${O.length}`),O.length>0){console.log(` Calling AI quest generation for ${O.length} attractions...`);const F=await R(O.map(X=>X.attraction),{destination:e.destination,duration:e.duration,interests:e.interests||[],budget:e.budget});console.log(` AI generated ${(F==null?void 0:F.length)||0} quests`),console.log(" Creating quests in database...");const U=await D(t,r.id,F,O.map(X=>X.attraction),O.map(X=>X.dayNumber));w.push(...U),console.log(` Created ${U.length} AI-generated quests for trip`)}}catch(R){console.error(" Error in AI quest generation, falling back to simple quests:",R),console.log(" FALLBACK MODE: Creating simple quests...");for(let D=0;D<s.daily_plan.length;D++){const O=s.daily_plan[D],F=O.attractions||[];console.log(` Fallback Day ${D+1}: ${F.length} attractions`);for(let U=0;U<F.length;U++){const X=F[U];if(console.log(` Processing: ${X.name}`),!X.place_id||!X.coordinates){console.log(`  Skipping ${X.name} - missing data`);continue}try{const W=X.rating>=4.5?3:X.rating>=4?2:1,K=W*50+Math.floor((X.rating||4)*20),ne=W*15+Math.floor((X.rating||4)*5),{data:te,error:re}=await Kt.from("quests").insert({title:`Visit ${X.name}`,description:X.description||`Explore ${X.name} and capture your experience.`,location:X.name,latitude:X.coordinates.lat,longitude:X.coordinates.lng,difficulty:W,reward_xp:K,reward_tokens:ne,quest_type:"standard",category:X.type==="restaurant"?"food":X.type==="museum"?"culture":X.type==="park"?"nature":"culture",creator_id:t,is_active:!0}).select().single();if(!re&&te){console.log(` Fallback quest created: ${te.title} (${te.id})`),w.push(te.id),await Kt.from("trip_quests").insert({trip_id:r.id,quest_id:te.id,day_number:O.day_number||D+1,order_in_day:U+1});try{await Kt.from("user_quests").insert({user_id:t,quest_id:te.id,status:"pending",created_at:new Date().toISOString()}),console.log(" Auto-assigned fallback quest to user")}catch(xe){console.error(" Could not auto-assign fallback quest:",xe)}}}catch(W){console.error("Error creating fallback quest:",W)}}}}}console.log(` Trip created: ${r.id} with ${((k=s==null?void 0:s.daily_plan)==null?void 0:k.length)||0} days, ${w.length} quests`);try{const{updateAllAchievementProgress:R,checkAchievements:D}=await hr(async()=>{const{updateAllAchievementProgress:O,checkAchievements:F}=await Promise.resolve().then(()=>ZW);return{updateAllAchievementProgress:O,checkAchievements:F}},void 0);await R(t),await D(t)}catch(R){console.error("Error updating achievements after trip creation:",R)}try{const{notifyTripCreated:R}=await hr(async()=>{const{notifyTripCreated:D}=await Promise.resolve().then(()=>CN);return{notifyTripCreated:D}},void 0);await R(t,e.destination,w.length)}catch(R){console.error("Failed to create trip notification:",R)}return{tripId:r.id,questIds:w,createdQuestIds:w}}async function GW(t){const{data:e,error:n}=await Kt.from("trips").select(`
      *,
      user_quests (
        *,
        quests (*)
      )
    `).eq("user_id",t).order("created_at",{ascending:!1});return n?(console.error("Error fetching trips:",n),[]):e||[]}async function $W(t,e,n){const{data:s,error:l}=await Kt.from("trips").update(n).eq("id",t).eq("user_id",e).select().single();if(l)throw l;return s}async function WW(t){const{data:e,error:n}=await Kt.from("trips").select("*").eq("user_id",t);if(n||!e)return null;const s=e.length,l=e.filter(w=>w.status==="completed").length,u=e.reduce((w,E)=>w+(E.duration_days||0),0),p=e.reduce((w,E)=>w+(E.total_cost||0),0),r=new Set(e.map(w=>w.country).filter(Boolean)),v=new Set(e.map(w=>w.city).filter(Boolean));return{totalTrips:s,completedTrips:l,activeTrips:s-l,totalDays:u,totalCost:p,countriesVisited:r.size,citiesVisited:v.size,averageTripDuration:s>0?u/s:0,averageTripCost:s>0?p/s:0}}const xz=Object.freeze(Object.defineProperty({__proto__:null,getTripStatistics:WW,getUserTrips:GW,saveTripToSupabase:Ove,updateTrip:$W},Symbol.toStringTag,{value:"Module"})),Fve=({trip:t,onClose:e})=>{const n=t.route_data||{},s=n.hotels||[],l=n.daily_plan||[],u=n.total_estimated_cost||{total:0},[p,r]=he.useState({}),v=k=>{r(R=>({...R,[k]:!R[k]}))},w=k=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),E=k=>{switch(k){case"OPERATIONAL":return f.jsx($0,{className:"w-4 h-4 text-green-400"});case"CLOSED_TEMPORARILY":return f.jsx(Kk,{className:"w-4 h-4 text-yellow-400"});case"CLOSED_PERMANENTLY":return f.jsx(fN,{className:"w-4 h-4 text-red-400"});default:return f.jsx($0,{className:"w-4 h-4 text-gray-400"})}},T=k=>{switch(k){case"OPERATIONAL":return"Open";case"CLOSED_TEMPORARILY":return"Temporarily Closed";case"CLOSED_PERMANENTLY":return"Permanently Closed";default:return"Unknown"}};return f.jsx(Xc,{children:f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e,children:f.jsxs(it.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:k=>k.stopPropagation(),className:"relative w-full max-w-6xl max-h-[90vh] overflow-hidden rounded-2xl",style:{backdropFilter:"blur(32px) saturate(200%)",WebkitBackdropFilter:"blur(32px) saturate(200%)",backgroundColor:"rgba(0, 0, 0, 0.4)",border:"1px solid rgba(255, 255, 255, 0.15)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:[f.jsx("div",{className:"sticky top-0 z-10 backdrop-blur-xl bg-black/30 border-b border-white/10 p-6",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold text-white mb-2",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:t.destination}),f.jsxs("div",{className:"flex items-center gap-4 text-white/60 text-sm",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ig,{className:"w-4 h-4"}),f.jsxs("span",{children:[t.duration_days," days"]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(id,{className:"w-4 h-4"}),f.jsxs("span",{className:"capitalize",children:[t.budget," budget"]})]}),u.total>0&&f.jsx("div",{className:"flex items-center gap-1 text-amber-400 font-semibold",children:f.jsx("span",{children:w(u.total)})})]})]}),f.jsx(it.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:e,className:"p-2 rounded-xl backdrop-blur-xl bg-white/10 hover:bg-white/20 border border-white/20 text-white transition-all",children:f.jsx(Qa,{className:"w-6 h-6"})})]})}),f.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)] p-6 space-y-8",children:[s.length>0&&f.jsxs("section",{children:[f.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[f.jsx(dN,{className:"w-6 h-6 text-cyan-400"}),"Recommended Hotels"]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((k,R)=>{var D;return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.1},className:"rounded-xl overflow-hidden backdrop-blur-xl bg-white/5 border border-white/10 hover:border-white/20 transition-all",children:[k.photos&&k.photos[0]&&f.jsx("div",{className:"h-48 overflow-hidden",children:f.jsx("img",{src:k.photos[0],alt:k.name,className:"w-full h-full object-cover"})}),f.jsxs("div",{className:"p-4 space-y-2",children:[f.jsx("h4",{className:"text-white font-semibold text-lg",children:k.name}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(F0,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),f.jsx("span",{className:"text-white/80",children:((D=k.rating)==null?void 0:D.toFixed(1))||"N/A"}),f.jsxs("span",{className:"text-white/50 text-sm",children:["(",k.user_ratings_total||0," reviews)"]})]}),f.jsx("p",{className:"text-white/60 text-sm line-clamp-2",children:k.address}),f.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-white/10",children:[f.jsx("span",{className:"text-amber-400 font-semibold",children:k.price_range||"Price on request"}),f.jsx("span",{className:"text-white/70",children:"$".repeat(k.price_level||2)})]}),f.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[E(k.business_status),f.jsx("span",{className:`text-sm ${k.business_status==="OPERATIONAL"?"text-green-400":"text-yellow-400"}`,children:T(k.business_status)})]}),f.jsxs("div",{className:"flex gap-2 pt-2",children:[k.website&&f.jsxs("a",{href:k.website,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 px-3 rounded-lg backdrop-blur-xl bg-white/10 hover:bg-white/20 border border-white/20 text-white text-sm flex items-center justify-center gap-2 transition-all",children:[f.jsx(PE,{className:"w-4 h-4"}),"Website"]}),f.jsxs("a",{href:k.booking_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 px-3 rounded-lg backdrop-blur-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 text-cyan-300 text-sm flex items-center justify-center gap-2 transition-all",children:[f.jsx(Jo,{className:"w-4 h-4"}),"Book"]})]})]})]},R)})})]}),l.length>0&&f.jsxs("section",{children:[f.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[f.jsx(ig,{className:"w-6 h-6 text-purple-400"}),"Daily Itinerary"]}),f.jsx("div",{className:"space-y-6",children:l.map((k,R)=>f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:R*.1},className:"rounded-xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{children:[f.jsxs("h4",{className:"text-xl font-bold text-white",children:["Day ",k.day_number]}),f.jsx("p",{className:"text-cyan-400 text-sm",children:k.theme})]}),k.estimated_cost>0&&f.jsx("div",{className:"text-amber-400 font-semibold",children:w(k.estimated_cost)})]}),f.jsx("div",{className:"space-y-4",children:k.attractions&&k.attractions.map((D,O)=>{var F,U,X,W;return f.jsxs("div",{className:"rounded-lg backdrop-blur-xl bg-white/5 border border-white/10 p-4",children:[f.jsxs("div",{className:"flex items-start justify-between mb-3",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h5",{className:"text-white font-semibold text-lg",children:D.name}),f.jsx("p",{className:"text-white/60 text-sm mt-1",children:D.description})]}),f.jsxs("div",{className:"flex flex-col items-end gap-1 ml-4",children:[f.jsx("span",{className:"text-cyan-400 text-sm font-medium",children:D.start_time||D.time_of_day||"9:00 AM"}),f.jsxs("span",{className:"text-white/50 text-xs flex items-center gap-1",children:[f.jsx(nh,{className:"w-3 h-3"}),D.duration_hours||2,"h"]})]})]}),D.photos&&D.photos.length>0&&f.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto",children:D.photos.slice(0,3).map((K,ne)=>f.jsx("img",{src:K,alt:D.name,className:"w-24 h-24 object-cover rounded-lg"},ne))}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-sm",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(F0,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),f.jsx("span",{className:"text-white/80",children:((F=D.rating)==null?void 0:F.toFixed(1))||"N/A"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(id,{className:"w-4 h-4 text-amber-400"}),f.jsx("span",{className:"text-white/80",children:D.estimated_cost?`$${D.estimated_cost}`:D.ticket_price||"Free"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[E(D.business_status),f.jsx("span",{className:`${D.business_status==="OPERATIONAL"?"text-green-400":"text-yellow-400"} text-xs`,children:(U=D.opening_hours)!=null&&U.open_now?"Open now":"Closed"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Mo,{className:"w-4 h-4 text-purple-400"}),f.jsx("span",{className:"text-white/60 text-xs",children:((X=D.address)==null?void 0:X.split(",")[0])||"Location"})]})]}),((W=D.opening_hours)==null?void 0:W.weekday_text)&&D.opening_hours.weekday_text.length>0&&f.jsxs("details",{className:"mt-3",children:[f.jsx("summary",{className:"text-cyan-400 text-sm cursor-pointer hover:text-cyan-300 transition-colors",children:"View Opening Hours"}),f.jsx("div",{className:"mt-2 p-3 rounded-lg bg-black/20 space-y-1",children:D.opening_hours.weekday_text.map((K,ne)=>f.jsx("p",{className:"text-white/60 text-xs",children:K},ne))})]}),D.reviews_summary&&f.jsxs("details",{className:"mt-3",children:[f.jsx("summary",{className:"text-cyan-400 text-sm cursor-pointer hover:text-cyan-300 transition-colors",children:"View Reviews"}),f.jsx("div",{className:"mt-2 p-3 rounded-lg bg-black/20",children:f.jsx("p",{className:"text-white/60 text-xs whitespace-pre-wrap",children:D.reviews_summary})})]}),D.coordinates&&f.jsxs("div",{className:"mt-4",children:[f.jsxs("button",{onClick:()=>v(`${R}-${O}`),className:"w-full py-2 px-3 rounded-lg backdrop-blur-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 text-cyan-300 text-sm flex items-center justify-center gap-2 transition-all mb-3",children:[f.jsx(VA,{className:"w-4 h-4"}),p[`${R}-${O}`]?"Hide Map":"Show Map"]}),p[`${R}-${O}`]&&f.jsx(it.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-lg overflow-hidden mb-3",children:f.jsx(Pve,{latitude:D.coordinates.lat,longitude:D.coordinates.lng,name:D.name,className:"w-full h-64 rounded-lg"})})]}),f.jsxs("div",{className:"flex gap-2 mt-4",children:[D.website&&f.jsxs("a",{href:D.website,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 px-3 rounded-lg backdrop-blur-xl bg-white/10 hover:bg-white/20 border border-white/20 text-white text-sm flex items-center justify-center gap-2 transition-all",children:[f.jsx(PE,{className:"w-4 h-4"}),"Website"]}),D.google_maps_url&&f.jsxs("a",{href:D.google_maps_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 px-3 rounded-lg backdrop-blur-xl bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/30 text-purple-300 text-sm flex items-center justify-center gap-2 transition-all",children:[f.jsx(Mo,{className:"w-4 h-4"}),"Open in Maps"]})]})]},O)})})]},R))})]}),s.length===0&&l.length===0&&f.jsxs("div",{className:"text-center py-12",children:[f.jsx(Kk,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),f.jsx("p",{className:"text-white/60 text-lg",children:"No detailed plan data available for this trip."}),f.jsx("p",{className:"text-white/40 text-sm mt-2",children:"Try regenerating the trip to get detailed information."})]})]})]})})})},Bve=({trip:t,userId:e,onClose:n,onSave:s})=>{const[l,u]=he.useState(!1),[p,r]=he.useState({destination:t.destination||"",duration_days:t.duration_days||3,budget:t.budget||"medium",interests:t.interests||[],notes:t.notes||""}),v=["food","culture","nature","nightlife","adventure","shopping"],w=async T=>{T.preventDefault(),u(!0);try{await $W(t.id,e,p),s(),n()}catch(k){console.error("Error updating trip:",k),alert(k.message||"Failed to update trip")}finally{u(!1)}},E=T=>{r(k=>({...k,interests:k.interests.includes(T)?k.interests.filter(R=>R!==T):[...k.interests,T]}))};return f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:n,children:f.jsxs(it.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:T=>T.stopPropagation(),className:"w-full max-w-2xl rounded-2xl p-6",style:{backdropFilter:"blur(32px) saturate(200%)",WebkitBackdropFilter:"blur(32px) saturate(200%)",backgroundColor:"rgba(0, 0, 0, 0.4)",border:"1px solid rgba(255, 255, 255, 0.15)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:"Edit Trip"}),f.jsx(it.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:n,className:"p-2 rounded-xl backdrop-blur-xl bg-white/10 hover:bg-white/20 border border-white/20 text-white",children:f.jsx(Qa,{className:"w-5 h-5"})})]}),f.jsxs("form",{onSubmit:w,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Destination"}),f.jsx("input",{type:"text",value:p.destination,onChange:T=>r(k=>({...k,destination:T.target.value})),className:"w-full px-4 py-3 rounded-xl backdrop-blur-xl bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-cyan-500/50",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Duration (days)"}),f.jsx("input",{type:"number",min:"1",max:"30",value:p.duration_days,onChange:T=>r(k=>({...k,duration_days:parseInt(T.target.value)})),className:"w-full px-4 py-3 rounded-xl backdrop-blur-xl bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-cyan-500/50",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Budget"}),f.jsxs("select",{value:p.budget,onChange:T=>r(k=>({...k,budget:T.target.value})),className:"w-full px-4 py-3 rounded-xl backdrop-blur-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50",children:[f.jsx("option",{value:"low",children:"Low Budget"}),f.jsx("option",{value:"medium",children:"Medium Budget"}),f.jsx("option",{value:"high",children:"High Budget"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Interests"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(T=>f.jsx("button",{type:"button",onClick:()=>E(T),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${p.interests.includes(T)?"bg-cyan-500/30 border-cyan-500/50 text-cyan-300":"bg-white/10 border-white/20 text-white/60 hover:bg-white/20"} border backdrop-blur-xl`,children:T},T))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Notes"}),f.jsx("textarea",{value:p.notes,onChange:T=>r(k=>({...k,notes:T.target.value})),rows:4,className:"w-full px-4 py-3 rounded-xl backdrop-blur-xl bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 resize-none",placeholder:"Add any notes about your trip..."})]}),f.jsxs("div",{className:"flex gap-3 pt-4",children:[f.jsx(it.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:n,className:"flex-1 py-3 px-4 rounded-xl font-medium backdrop-blur-xl bg-white/10 border border-white/20 text-white hover:bg-white/20 transition-all",children:"Cancel"}),f.jsx(it.button,{type:"submit",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:l,className:"flex-1 py-3 px-4 rounded-xl font-medium backdrop-blur-xl bg-cyan-500/30 border border-cyan-500/50 text-cyan-300 hover:bg-cyan-500/40 transition-all flex items-center justify-center gap-2",children:l?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):f.jsxs(f.Fragment,{children:[f.jsx(nb,{className:"w-5 h-5"}),"Save Changes"]})})]})]})]})})},zve=({userId:t})=>{const[e,n]=he.useState(null),[s,l]=he.useState(!0);he.useEffect(()=>{u()},[t]);const u=async()=>{try{const r=await WW(t);n(r)}catch(r){console.error("Error loading stats:",r)}finally{l(!1)}};if(s||!e)return null;const p=[{icon:Mo,label:"Trips Created",value:e.totalTrips,color:"cyan"},{icon:$0,label:"Completed",value:e.completedTrips,color:"green"},{icon:nh,label:"Active Trips",value:e.activeTrips,color:"purple"},{icon:ig,label:"Total Days",value:e.totalDays,color:"amber"},{icon:sg,label:"Countries",value:e.countriesVisited,color:"pink"},{icon:id,label:"Total Budget",value:`$${Math.round(e.totalCost).toLocaleString()}`,color:"emerald"}];return f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:p.map((r,v)=>f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:v*.05},className:"rounded-xl p-4 backdrop-blur-xl bg-white/5 border border-white/10",children:[f.jsx("div",{className:`w-10 h-10 rounded-lg bg-${r.color}-500/20 flex items-center justify-center mb-3`,children:f.jsx(r.icon,{className:`w-5 h-5 text-${r.color}-400`})}),f.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:r.value}),f.jsx("div",{className:"text-xs text-white/60",children:r.label})]},r.label))})},Uve=({onNavigate:t})=>{const{user:e,isConnected:n}=ba(),{user:s,isAuthenticated:l}=El(),u=e||s,p=n||l,[r,v]=he.useState([]),[w,E]=he.useState(!0),[T,k]=he.useState(null),[R,D]=he.useState(null),[O,F]=he.useState(!0);he.useEffect(()=>{if(!p){v([]),E(!1);return}if(u)console.log("[MyTrips] User loaded, loading trips...",u.id),U();else{console.log("[MyTrips] Waiting for user data...");let te=0;const re=5,xe=()=>{te++,u?(console.log("[MyTrips] User loaded after wait, loading trips...",u.id),U()):te<re?(console.log(`[MyTrips] Retry ${te}/${re} - waiting for user...`),setTimeout(xe,1e3)):(console.log("[MyTrips] User still not loaded after all attempts"),E(!1))},ae=setTimeout(xe,500);return()=>clearTimeout(ae)}},[p,u]);const U=async()=>{if(u){E(!0);try{const te=await GW(u.id);v(te||[])}catch(te){console.error("Error loading trips:",te),v([])}finally{E(!1)}}},X=async te=>{if(!(!u||!confirm("Are you sure you want to delete this trip? This action cannot be undone.")))try{const{error:re}=await Kt.from("trips").delete().eq("id",te).eq("user_id",u.id);if(re)throw re;await U()}catch(re){console.error("Error deleting trip:",re),alert(re.message||"Failed to delete trip. Please try again.")}},W=te=>{const re={destination:te.destination,duration:te.duration_days,budget:te.budget,interests:te.interests,created_at:te.created_at,route_data:te.route_data,notes:te.notes},xe=new Blob([JSON.stringify(re,null,2)],{type:"application/json"}),ae=URL.createObjectURL(xe),ce=document.createElement("a");ce.href=ae,ce.download=`trip-${te.destination.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.json`,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),URL.revokeObjectURL(ae)},K=async te=>{if(u)try{const{error:re}=await Kt.from("trips").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",te).eq("user_id",u.id);if(re)throw re;await U()}catch(re){console.error("Error marking trip as complete:",re),alert(re.message||"Failed to update trip status.")}},ne=te=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(te);return w&&p?f.jsx("div",{className:"max-w-7xl mx-auto flex items-center justify-center py-20",children:f.jsx(Bw,{variant:"ghost",text:"Loading your trips..."})}):p?r.length===0?f.jsx("div",{className:"max-w-7xl mx-auto",children:f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx("div",{className:"w-20 h-20 rounded-full backdrop-blur-xl bg-white/[0.05] border border-white/[0.1] flex items-center justify-center mb-6",style:FE.inlineStyles.glass,children:f.jsx(Mo,{className:"w-10 h-10 text-white/60"})}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"No Trips Yet"}),f.jsx("p",{className:"text-white/60 mb-6",children:"Create a trip from the Create Trip page to start planning"}),t&&f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>t("create"),className:"px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300 backdrop-blur-xl bg-white/[0.12] border border-white/[0.20] hover:bg-white/[0.18] hover:shadow-[0_8px_32px_rgba(255,255,255,0.12)]",style:{backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:"Create Your First Trip"})]})}):f.jsxs("div",{className:"max-w-7xl mx-auto",children:[u&&f.jsx(zve,{userId:u.id}),f.jsxs(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white mb-2",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"My Trips"}),f.jsx("p",{className:"text-white/60",style:{textShadow:"0 1px 5px rgba(0,0,0,0.5)"},children:"View and manage your travel plans"})]}),f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>F(!O),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white transition-all duration-300 backdrop-blur-xl bg-white/[0.08] border border-white/[0.15] hover:bg-white/[0.12] hover:border-white/[0.20] hover:shadow-[0_8px_32px_rgba(255,255,255,0.08)]",style:{backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:O?f.jsxs(f.Fragment,{children:[f.jsx(k$,{className:"w-4 h-4"}),"Hide Map"]}):f.jsxs(f.Fragment,{children:[f.jsx(Ep,{className:"w-4 h-4"}),"Show Map"]})})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:`${O?"lg:col-span-2":"lg:col-span-3"} space-y-6`,children:r.map((te,re)=>{const xe=te.route_data||{},ae=xe.hotels||[],ce=xe.daily_plan||[],ye=xe.total_estimated_cost||{total:0};return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:re*.1},whileHover:{y:-4,scale:1.01},className:"relative rounded-2xl p-6 overflow-hidden transition-all duration-300",style:{backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",backgroundColor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05)"},children:[f.jsx(it.div,{animate:{opacity:[.1,.2,.1],scale:[1,1.05,1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-white/5 pointer-events-none"}),f.jsxs("div",{className:"relative z-10",children:[f.jsxs("div",{className:"flex items-start justify-between mb-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx("h3",{className:"text-2xl font-bold text-white",style:{textShadow:"0 1px 5px rgba(0,0,0,0.5)"},children:te.destination}),te.status==="completed"&&f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30",children:[f.jsx(la,{className:"w-4 h-4 text-green-400"}),f.jsx("span",{className:"text-xs text-green-400 font-medium",children:"Completed"})]})]}),f.jsxs("div",{className:"flex items-center gap-4 text-white/60 text-sm mb-3",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ig,{className:"w-4 h-4"}),f.jsxs("span",{children:[te.duration_days," ",te.duration_days===1?"day":"days"]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(id,{className:"w-4 h-4"}),f.jsxs("span",{className:"capitalize",children:[te.budget," budget"]})]}),ye.total>0&&f.jsx("div",{className:"flex items-center gap-1 text-amber-400",children:f.jsx("span",{className:"font-semibold",children:ne(ye.total)})})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(it.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>D(te),className:"p-2 rounded-lg backdrop-blur-xl bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/30 transition-all",title:"Edit trip",children:f.jsx(b0e,{className:"w-4 h-4"})}),f.jsx(it.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>W(te),className:"p-2 rounded-lg backdrop-blur-xl bg-purple-500/20 border border-purple-500/30 text-purple-400 hover:bg-purple-500/30 transition-all",title:"Export trip",children:f.jsx(UA,{className:"w-4 h-4"})}),te.status!=="completed"&&f.jsx(it.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>K(te.id),className:"p-2 rounded-lg backdrop-blur-xl bg-green-500/20 border border-green-500/30 text-green-400 hover:bg-green-500/30 transition-all",title:"Mark as completed",children:f.jsx(la,{className:"w-4 h-4"})}),f.jsx(it.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:()=>X(te.id),className:"p-2 rounded-lg backdrop-blur-xl bg-red-500/20 border border-red-500/30 text-red-400 hover:bg-red-500/30 transition-all",title:"Delete trip",children:f.jsx(E2,{className:"w-4 h-4"})})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[ae.length>0&&f.jsxs("div",{className:"text-center p-2 rounded-lg backdrop-blur-xl bg-white/[0.05] border border-white/[0.08]",children:[f.jsx(dN,{className:"w-4 h-4 text-cyan-400 mx-auto mb-1"}),f.jsx("p",{className:"text-xs text-white/60",children:"Hotels"}),f.jsx("p",{className:"text-white font-semibold",children:ae.length})]}),ce.length>0&&f.jsxs("div",{className:"text-center p-2 rounded-lg backdrop-blur-xl bg-white/[0.05] border border-white/[0.08]",children:[f.jsx(nh,{className:"w-4 h-4 text-purple-400 mx-auto mb-1"}),f.jsx("p",{className:"text-xs text-white/60",children:"Activities"}),f.jsx("p",{className:"text-white font-semibold",children:ce.reduce((Ce,Me)=>{var Ke;return Ce+(((Ke=Me.attractions)==null?void 0:Ke.length)||0)},0)})]}),ye.total>0&&f.jsxs("div",{className:"text-center p-2 rounded-lg backdrop-blur-xl bg-white/[0.05] border border-white/[0.08]",children:[f.jsx(id,{className:"w-4 h-4 text-amber-400 mx-auto mb-1"}),f.jsx("p",{className:"text-xs text-white/60",children:"Budget"}),f.jsx("p",{className:"text-white font-semibold text-xs",children:ne(ye.total)})]})]}),f.jsxs(it.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>k(te),className:"w-full mt-4 py-2.5 px-4 rounded-xl font-medium text-sm transition-all duration-300 flex items-center justify-center gap-2 backdrop-blur-xl bg-white/[0.12] border border-white/[0.20] text-white hover:bg-white/[0.18] hover:shadow-[0_8px_32px_rgba(255,255,255,0.12)]",style:{backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:["View Full Details",f.jsx(Jo,{className:"w-4 h-4"})]})]})]},te.id)})}),O&&f.jsx(it.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"rounded-2xl overflow-hidden",style:{backdropFilter:"blur(32px) saturate(200%)",WebkitBackdropFilter:"blur(32px) saturate(200%)",backgroundColor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",height:"500px",minHeight:"500px"},children:f.jsx("div",{className:"h-full flex items-center justify-center",children:f.jsx("p",{className:"text-white/60",children:"Map view coming soon"})})})]}),T&&f.jsx(Fve,{trip:T,onClose:()=>k(null)}),R&&u&&f.jsx(Bve,{trip:R,userId:u.id,onClose:()=>D(null),onSave:U})]}):f.jsx("div",{className:"max-w-7xl mx-auto",children:f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx("div",{className:"w-20 h-20 rounded-full backdrop-blur-xl bg-white/[0.05] border border-white/[0.1] flex items-center justify-center mb-6",style:FE.inlineStyles.glass,children:f.jsx(Mo,{className:"w-10 h-10 text-white/60"})}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"Please Sign In"}),f.jsx("p",{className:"text-white/60 mb-6",children:"Connect your wallet or sign in with email to view and manage your trips"}),t&&f.jsx(it.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>{window.ethereum&&window.ethereum.request({method:"eth_requestAccounts"})},className:"px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300 backdrop-blur-xl bg-white/[0.12] border border-white/[0.20] hover:bg-white/[0.18] hover:shadow-[0_8px_32px_rgba(255,255,255,0.12)]",style:{backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:"Connect Wallet"})]})})},Vve=()=>{const{user:t,address:e}=ba(),{user:n}=El(),s=t||n,[l,u]=he.useState([]),[p,r]=he.useState(!0);he.useEffect(()=>{console.log("[NFTTransactionHistory] User changed:",s==null?void 0:s.id,"address:",e),u([]),r(!0),s!=null&&s.id?(console.log("[NFTTransactionHistory] Loading NFT transactions for user:",s.id),v()):(console.log("[NFTTransactionHistory] No user - clearing transactions"),r(!1))},[s==null?void 0:s.id,e]);const v=async()=>{if(s){r(!0);try{const T=e||s.wallet_address;console.log("[NFTTransactionHistory] Loading transactions for:",{userId:s.id,walletAddress:T,limit:50});try{const{clearTransactionCache:R}=await hr(async()=>{const{clearTransactionCache:D}=await import("./blockchainTransactionService-CuBcSn_K.js");return{clearTransactionCache:D}},[]);R(),console.log("[NFTTransactionHistory] Cache cleared")}catch(R){console.warn("[NFTTransactionHistory] Could not clear cache:",R)}const k=await CW(s.id,50,T);console.log("[NFTTransactionHistory]  Loaded transactions:",k.length),k.length>0?console.log("[NFTTransactionHistory] Transaction details:",k.map(R=>{var D,O;return{id:R.id,type:R.nft_type,tokenId:R.token_id,contract:((D=R.contract_address)==null?void 0:D.substring(0,10))+"...",txHash:((O=R.tx_hash)==null?void 0:O.substring(0,10))+"..."}})):console.warn("[NFTTransactionHistory]  No transactions found!"),u(k)}catch(T){console.error("[NFTTransactionHistory]  Error loading NFT transactions:",T),console.error("[NFTTransactionHistory] Error details:",{message:T.message,stack:T.stack}),u([])}finally{r(!1)}}},w=T=>{switch(T){case"confirmed":return f.jsx($0,{className:"w-4 h-4 text-green-400"});case"pending":return f.jsx(nh,{className:"w-4 h-4 text-yellow-400"});case"failed":return f.jsx(fN,{className:"w-4 h-4 text-red-400"});default:return null}},E=T=>{const k=new Date(T),D=new Date().getTime()-k.getTime(),O=Math.floor(D/6e4),F=Math.floor(D/36e5),U=Math.floor(D/864e5);return O<1?"Just now":O<60?`${O}m ago`:F<24?`${F}h ago`:U<7?`${U}d ago`:k.toLocaleDateString()};return s?p?f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8",children:f.jsx("div",{className:"flex items-center justify-center",children:f.jsx(va,{className:"w-8 h-8 text-white/40 animate-spin"})})}):l.length===0?f.jsxs("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8 text-center",children:[f.jsx(Ho,{className:"w-12 h-12 text-white/30 mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No NFT Transactions Yet"}),f.jsx("p",{className:"text-white/60 text-sm",children:"Mint NFTs by completing quests with NFT rewards"})]}):f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"NFT Transaction History"}),f.jsx("div",{className:"space-y-3",children:l.map((T,k)=>{const R=Q_e(T.nft_type),D=Z_e(T.nft_type);return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:k*.05},className:"rounded-xl backdrop-blur-xl bg-white/5 border border-white/10 p-4 hover:bg-white/8 transition-all",children:[f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[f.jsx("div",{className:`w-12 h-12 rounded-full bg-${R}-500/20 border border-${R}-500/30 flex items-center justify-center`,children:f.jsx(Ho,{className:`w-6 h-6 text-${R}-400`})}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h4",{className:"text-white font-semibold",children:D}),w(T.status),T.token_id&&f.jsxs("span",{className:"text-xs text-white/60",children:["Token #",T.token_id]})]}),f.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/60 flex-wrap",children:[f.jsx("span",{children:E(T.created_at)}),T.blockchain_confirmed_at&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsx("span",{className:"text-xs",children:new Date(T.blockchain_confirmed_at).toLocaleTimeString()})]}),T.tx_hash&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${T.tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-cyan-400 hover:text-cyan-300 transition-colors",title:"View on Etherscan",children:[f.jsxs("span",{className:"text-xs font-mono",children:[T.tx_hash.slice(0,6),"...",T.tx_hash.slice(-4)]}),f.jsx(Jo,{className:"w-3 h-3"})]})]}),e&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsxs("a",{href:`https://sepolia.etherscan.io/address/${e}#nfttransfers`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-purple-400 hover:text-purple-300 transition-colors text-xs",title:"View Your NFT Transfers",children:["Your Wallet",f.jsx(Jo,{className:"w-3 h-3"})]})]}),T.token_id&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:""}),f.jsxs("a",{href:`https://sepolia.etherscan.io/nft/${T.contract_address}/${T.token_id}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-pink-400 hover:text-pink-300 transition-colors text-xs",title:"View NFT",children:["View NFT",f.jsx(m0e,{className:"w-3 h-3"})]})]})]})]})]})}),T.metadata&&Object.keys(T.metadata).length>0&&f.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:f.jsxs("details",{className:"text-xs text-white/60",children:[f.jsx("summary",{className:"cursor-pointer hover:text-white/80 transition-colors",children:"View Details"}),f.jsx("pre",{className:"mt-2 p-2 rounded bg-black/20 overflow-x-auto",children:JSON.stringify(T.metadata,null,2)})]})})]},T.id)})}),l.length>=50&&f.jsx("p",{className:"text-center text-white/40 text-sm pt-4",children:"Showing latest 50 transactions"})]}):null};async function Hve(t){try{const{data:e,error:n}=await Kt.rpc("check_achievements",{p_user_id:t});if(n)return console.error("Error checking achievements:",n),[];if(e&&e.length>0){const s=e.map(u=>u.achievement_id),{data:l}=await Kt.from("achievements").select("*").in("id",s);if(l&&l.length>0)try{const{notifyAchievementUnlocked:u}=await hr(async()=>{const{notifyAchievementUnlocked:p}=await Promise.resolve().then(()=>CN);return{notifyAchievementUnlocked:p}},void 0);for(const p of l)await u(t,p.title,p.reward_xp||0,p.reward_tokens||0)}catch(u){console.error("Failed to create achievement notifications:",u)}return l||[]}return[]}catch(e){return console.error("Error checking achievements:",e),[]}}async function PN(t){const{data:e,error:n}=await Kt.from("user_achievements").select(`
      *,
      achievements (*)
    `).eq("user_id",t).order("unlocked_at",{ascending:!1});return n?(console.error("Error fetching user achievements:",n),[]):e||[]}async function qW(){const{data:t,error:e}=await Kt.from("achievements").select("*").or("is_active.is.null,is_active.eq.true").order("requirement_value",{ascending:!0});return e?(console.error("Error fetching achievements:",e),[]):t||[]}async function XW(t,e){var n;try{const{data:s}=await Kt.from("achievements").select("requirement_type, requirement_value").eq("id",e).single();if(!s)return{current:0,unlocked:!1};const{data:l}=await Kt.from("user_achievements").select("unlocked_at, progress").eq("user_id",t).eq("achievement_id",e).maybeSingle();if(l!=null&&l.unlocked_at)return{current:s.requirement_value||0,unlocked:!0};let u=0;switch(s.requirement_type){case"quests":{const{data:p}=await Kt.from("users").select("quests_completed").eq("id",t).single();u=(p==null?void 0:p.quests_completed)||0;break}case"trips":{const{count:p}=await Kt.from("trips").select("*",{count:"exact",head:!0}).eq("user_id",t);u=p||0;break}case"cities":{const{count:p}=await Kt.from("trips").select("destination",{count:"exact",head:!0}).eq("user_id",t),{data:r}=await Kt.from("trips").select("destination").eq("user_id",t);r&&(u=new Set(r.map(w=>w.destination)).size);break}case"photos":{const{count:p}=await Kt.from("user_quests").select("*",{count:"exact",head:!0}).eq("user_id",t).not("proof_image_url","is",null);u=p||0;break}case"tokens":{const{data:p}=await Kt.from("users").select("total_tokens_earned").eq("id",t).single();u=parseFloat(((n=p==null?void 0:p.total_tokens_earned)==null?void 0:n.toString())||"0");break}default:u=(l==null?void 0:l.progress)||0}return{current:Math.min(u,s.requirement_value||0),unlocked:!1}}catch(s){return console.error("Error getting achievement progress:",s),{current:0,unlocked:!1}}}async function Gve(t){try{const{error:e}=await Kt.rpc("update_all_achievement_progress",{p_user_id:t});e&&console.error("Error updating achievement progress:",e)}catch(e){console.error("Error updating achievement progress:",e)}}const ZW=Object.freeze(Object.defineProperty({__proto__:null,checkAchievements:Hve,getAllAchievements:qW,getUserAchievementProgress:XW,getUserAchievements:PN,updateAllAchievementProgress:Gve},Symbol.toStringTag,{value:"Module"})),$ve=()=>{const{user:t}=ba(),{user:e}=El(),n=t||e,[s,l]=he.useState([]),[u,p]=he.useState(!0);he.useEffect(()=>{console.log("[AchievementHistory] User changed:",n==null?void 0:n.id),l([]),p(!0),n!=null&&n.id?(console.log("[AchievementHistory] Loading achievements for user:",n.id),r()):(console.log("[AchievementHistory] No user - clearing achievements"),p(!1))},[n==null?void 0:n.id]);const r=async()=>{if(n){p(!0);try{const T=await PN(n.id);l(T)}catch(T){console.error("Error loading achievements:",T)}finally{p(!1)}}},v=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=T=>{switch(T==null?void 0:T.toLowerCase()){case"travel":return Ja;case"quests":return F0;case"social":return Ho;default:return Vl}},E=T=>{switch(T==null?void 0:T.toLowerCase()){case"travel":return"from-blue-500 to-cyan-500";case"quests":return"from-purple-500 to-pink-500";case"social":return"from-yellow-500 to-orange-500";default:return"from-gray-500 to-gray-600"}};return n?u?f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8",children:f.jsx("div",{className:"flex items-center justify-center",children:f.jsx(va,{className:"w-8 h-8 text-white/40 animate-spin"})})}):s.length===0?f.jsxs("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-8 text-center",children:[f.jsx(Vl,{className:"w-12 h-12 text-white/30 mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Achievements Yet"}),f.jsx("p",{className:"text-white/60 text-sm",children:"Complete quests and reach milestones to unlock achievements"})]}):f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Achievement History"}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((T,k)=>{const R=T.achievements;if(!R)return null;const D=E(R.category),O=w(R.category);return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:k*.05},className:"rounded-xl backdrop-blur-xl bg-white/5 border border-white/10 p-4 hover:bg-white/8 transition-all",children:[f.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[f.jsx("div",{className:`w-12 h-12 rounded-full bg-gradient-to-br ${D} flex items-center justify-center flex-shrink-0`,children:O&&f.jsx(O,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("h4",{className:"text-white font-semibold mb-1 truncate",children:R.title}),R.description&&f.jsx("p",{className:"text-white/60 text-xs line-clamp-2",children:R.description})]})]}),T.unlocked_at&&f.jsx("div",{className:"flex items-center gap-4 text-xs text-white/60 mb-3",children:f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ig,{className:"w-3 h-3"}),f.jsx("span",{children:v(T.unlocked_at)})]})}),(R.reward_xp||R.reward_tokens)&&f.jsxs("div",{className:"flex items-center gap-3 pt-3 border-t border-white/10",children:[R.reward_xp&&f.jsxs("div",{className:"flex items-center gap-1 text-yellow-400",children:[f.jsx(md,{className:"w-3 h-3"}),f.jsxs("span",{className:"text-xs font-semibold",children:[R.reward_xp," XP"]})]}),R.reward_tokens&&f.jsxs("div",{className:"flex items-center gap-1 text-cyan-400",children:[f.jsx(Ya,{className:"w-3 h-3"}),f.jsxs("span",{className:"text-xs font-semibold",children:[R.reward_tokens," TPX"]})]})]})]},T.id)})})]}):null},Wve=({badge:t,isUnlocked:e,progress:n,showAnimation:s=!1,onAnimationComplete:l})=>{const u={common:"from-gray-400 to-gray-600",rare:"from-blue-400 to-blue-600",epic:"from-purple-400 to-purple-600",legendary:"from-orange-400 to-yellow-500"},p={common:"shadow-gray-500/50",rare:"shadow-blue-500/50",epic:"shadow-purple-500/50",legendary:"shadow-orange-500/50"};return f.jsx(it.div,{initial:s?{scale:0,rotate:-180}:!1,animate:s?{scale:1,rotate:0}:{},transition:{type:"spring",duration:.8},onAnimationComplete:l,className:"relative",children:f.jsxs("div",{className:`relative backdrop-blur-xl bg-white/[0.03] rounded-2xl p-6 border-2 transition-all duration-300 ${e?`border-${t.rarity==="legendary"?"pumpkinOrange":"white"}/30 ${p[t.rarity]} shadow-xl`:"border-white/10 opacity-60"}`,children:[e&&f.jsx(it.div,{animate:{opacity:[.1,.3,.1]},transition:{duration:3,repeat:1/0},className:`absolute inset-0 bg-gradient-to-br ${u[t.rarity]} opacity-10 rounded-2xl`}),f.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-4",children:[f.jsx("div",{className:"relative",children:e?f.jsx(it.div,{animate:s?{scale:[1,1.2,1],rotate:[0,10,-10,0]}:{},transition:{duration:.5,delay:.3},children:f.jsx(Za,{name:t.icon,size:64,className:"text-pumpkinOrange"})}):f.jsxs("div",{className:"relative",children:[f.jsx(Za,{name:t.icon,size:64,className:"text-white/20"}),f.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:f.jsx(hN,{className:"w-8 h-8 text-white/40"})})]})}),f.jsx("h3",{className:`text-lg font-bold text-center ${e?"text-white":"text-white/40"}`,children:t.name}),f.jsx("p",{className:`text-sm text-center ${e?"text-white/70":"text-white/30"}`,children:t.description}),f.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${e?`bg-gradient-to-r ${u[t.rarity]} text-white`:"bg-white/10 text-white/40"}`,children:t.rarity.toUpperCase()}),!e&&n&&f.jsxs("div",{className:"w-full",children:[f.jsxs("div",{className:"flex justify-between text-xs text-white/50 mb-2",children:[f.jsx("span",{children:"Progress"}),f.jsxs("span",{children:[n.current," / ",n.required]})]}),f.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:f.jsx(it.div,{initial:{width:0},animate:{width:`${n.percentage}%`},transition:{duration:.5},className:"h-full bg-gradient-to-r from-pumpkinOrange to-bloodOrange"})})]}),e&&t.unlockedAt&&f.jsxs("p",{className:"text-xs text-white/40",children:["Unlocked: ",new Date(t.unlockedAt).toLocaleDateString()]})]})]})})},qve={default:{borderGradient:gs.colors.gradients.hauntedGlow,glowColor:gs.colors.primary.bloodOrange,bgOpacity:"bg-opacity-10"},quest:{borderGradient:`linear-gradient(135deg, ${gs.colors.accent.pumpkinOrange} 0%, ${gs.colors.primary.bloodOrange} 100%)`,glowColor:gs.colors.accent.pumpkinOrange,bgOpacity:"bg-opacity-15"},trip:{borderGradient:`linear-gradient(135deg, ${gs.colors.primary.deepPurple} 0%, ${gs.colors.primary.midnightBlue} 100%)`,glowColor:gs.colors.primary.deepPurple,bgOpacity:"bg-opacity-20"},achievement:{borderGradient:`linear-gradient(135deg, ${gs.colors.accent.toxicGreen} 0%, ${gs.colors.accent.pumpkinOrange} 100%)`,glowColor:gs.colors.accent.toxicGreen,bgOpacity:"bg-opacity-15"}},YT=({children:t,variant:e="default",glowColor:n,hoverEffect:s=!0,className:l="",onClick:u})=>{const p=Jx(),r=qve[e],v=n||r.glowColor,w={initial:{scale:1,boxShadow:`0 0 20px ${v}33`},hover:{scale:s?1.02:1,boxShadow:`0 0 40px ${v}66, 0 0 80px ${v}33`}},E={animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"]}};return f.jsxs(it.div,{className:`relative rounded-xl overflow-hidden backdrop-blur-md ${u?"focus:outline-none focus-visible:ring-2 focus-visible:ring-pumpkinOrange focus-visible:ring-offset-2 focus-visible:ring-offset-deepPurple":""} ${l}`,variants:p?w:{},initial:"initial",whileHover:s&&p?"hover":void 0,transition:{duration:.3},onClick:u,onKeyDown:T=>{u&&(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),u())},tabIndex:u?0:void 0,role:u?"button":void 0,style:{cursor:u?"pointer":"default"},children:[f.jsx(it.div,{className:"absolute inset-0 rounded-xl p-[2px]",style:{background:r.borderGradient,backgroundSize:"200% 200%"},variants:p?E:{},animate:p?"animate":void 0,transition:{duration:3,repeat:1/0,ease:"linear"},children:f.jsx("div",{className:`h-full w-full rounded-xl bg-deepPurple ${r.bgOpacity} backdrop-blur-xl`,style:{background:`linear-gradient(135deg, ${gs.colors.primary.deepPurple}${r.bgOpacity==="bg-opacity-10"?"1a":r.bgOpacity==="bg-opacity-15"?"26":"33"}, ${gs.colors.primary.midnightBlue}${r.bgOpacity==="bg-opacity-10"?"1a":r.bgOpacity==="bg-opacity-15"?"26":"33"})`}})}),f.jsx("div",{className:"absolute top-2 left-2 opacity-30 pointer-events-none z-10",children:f.jsx(Za,{name:"cobweb",size:24,className:"text-ghostlyWhite"})}),f.jsx("div",{className:"absolute top-2 right-2 opacity-30 pointer-events-none z-10 transform scale-x-[-1]",children:f.jsx(Za,{name:"cobweb",size:24,className:"text-ghostlyWhite"})}),f.jsx("div",{className:"relative z-20 p-6",children:t})]})},QA=[{id:"spooky-explorer",name:"Spooky Explorer",description:"Visit your first spooky destination and begin your paranormal journey.",icon:"hauntedCastle",rarity:"common",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-spooky-explorer.png",requirement:{type:"spooky_destinations",count:1,description:"Visit 1 spooky destination"}},{id:"witch-apprentice",name:"Witch Apprentice",description:"Complete your first Halloween quest and start your magical training.",icon:"witchBroom",rarity:"common",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-witch-apprentice.png",requirement:{type:"halloween_quests",count:1,description:"Complete 1 Halloween quest"}},{id:"token-collector",name:"Token Collector",description:"Earn your first 100 TPX tokens from Halloween activities.",icon:"candyCorn",rarity:"common",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-token-collector.png",requirement:{type:"tokens_earned",count:100,description:"Earn 100 TPX tokens"}},{id:"ghost-hunter",name:"Ghost Hunter",description:"Visit 3 spooky destinations and document your paranormal experiences.",icon:"ghost",rarity:"rare",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-ghost-hunter.png",requirement:{type:"spooky_destinations",count:3,description:"Visit 3 spooky destinations"}},{id:"quest-seeker",name:"Quest Seeker",description:"Complete 3 Halloween quests and prove your dedication.",icon:"skull",rarity:"rare",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-quest-seeker.png",requirement:{type:"halloween_quests",count:3,description:"Complete 3 Halloween quests"}},{id:"treasure-hunter",name:"Treasure Hunter",description:"Earn 300 TPX tokens from Halloween activities.",icon:"cauldron",rarity:"rare",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-treasure-hunter.png",requirement:{type:"tokens_earned",count:300,description:"Earn 300 TPX tokens"}},{id:"pumpkin-master",name:"Pumpkin Master",description:"Complete 5 Halloween quests and prove your dedication to the spooky season.",icon:"pumpkin",rarity:"epic",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-pumpkin-master.png",requirement:{type:"halloween_quests",count:5,description:"Complete 5 Halloween quests"}},{id:"paranormal-expert",name:"Paranormal Expert",description:"Visit 5 spooky destinations and become a paranormal expert.",icon:"bat",rarity:"epic",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-paranormal-expert.png",requirement:{type:"spooky_destinations",count:5,description:"Visit 5 spooky destinations"}},{id:"wealthy-witch",name:"Wealthy Witch",description:"Earn 500 TPX tokens from Halloween activities.",icon:"witchHat",rarity:"epic",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-wealthy-witch.png",requirement:{type:"tokens_earned",count:500,description:"Earn 500 TPX tokens"}},{id:"candy-collector",name:"Candy Collector",description:"Earn 1000 TPX tokens during the Halloween season through quests and achievements.",icon:"candyCorn",rarity:"legendary",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-candy-collector.png",requirement:{type:"tokens_earned",count:1e3,description:"Earn 1000 TPX tokens in Halloween season"}},{id:"master-of-darkness",name:"Master of Darkness",description:"Visit 10 spooky destinations and become a true Master of Darkness.",icon:"tombstone",rarity:"legendary",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-master-of-darkness.png",requirement:{type:"spooky_destinations",count:10,description:"Visit 10 spooky destinations"}},{id:"halloween-legend",name:"Halloween Legend",description:"Complete 10 Halloween quests and become a Halloween Legend.",icon:"spider",rarity:"legendary",imageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/badge-halloween-legend.png",requirement:{type:"halloween_quests",count:10,description:"Complete 10 Halloween quests"}}],cd={VISITED_SPOOKY:"tripx_visited_spooky_destinations",HALLOWEEN_BADGES:"tripx_halloween_badges",HALLOWEEN_PROGRESS:"tripx_halloween_progress",USER_PREFERENCES:"tripx_user_preferences"};let zE=null;const QW=t=>{zE=t,console.log("[HalloweenStorage] Current user set to:",t)},Xve=()=>zE,Qm=t=>zE?`${t}_${zE}`:`${t}_anonymous`,Zve=cd,wb=()=>{try{const t=Qm(cd.VISITED_SPOOKY),e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch(t){return console.error("Error reading visited destinations:",t),[]}},KW=t=>{try{const e=Qm(cd.VISITED_SPOOKY),n=wb();n.includes(t)||(n.push(t),localStorage.setItem(e,JSON.stringify(n)))}catch(e){console.error("Error adding visited destination:",e)}},Qve=t=>wb().includes(t),KA=()=>{try{const t=Qm(cd.HALLOWEEN_BADGES),e=localStorage.getItem(t);return e?JSON.parse(e).map(s=>({...s,unlockedAt:s.unlockedAt?new Date(s.unlockedAt):void 0})):[]}catch(t){return console.error("Error reading badges:",t),[]}},YW=t=>{try{const e=Qm(cd.HALLOWEEN_BADGES),n=KA(),s=n.findIndex(u=>u.id===t.id),l={...t,unlockedAt:new Date};s>=0?n[s]=l:n.push(l),localStorage.setItem(e,JSON.stringify(n))}catch(e){console.error("Error unlocking badge:",e)}},RN=t=>KA().some(n=>n.id===t),bp=()=>{try{const t=Qm(cd.HALLOWEEN_PROGRESS),e=localStorage.getItem(t);return e?JSON.parse(e):{spookyDestinationsVisited:0,halloweenQuestsCompleted:0,tokensEarnedInSeason:0,unlockedBadges:[]}}catch(t){return console.error("Error reading progress:",t),{spookyDestinationsVisited:0,halloweenQuestsCompleted:0,tokensEarnedInSeason:0,unlockedBadges:[]}}},Sb=t=>{try{const e=Qm(cd.HALLOWEEN_PROGRESS),s={...bp(),...t};localStorage.setItem(e,JSON.stringify(s))}catch(e){console.error("Error updating progress:",e)}},NN=()=>{const t=bp();Sb({spookyDestinationsVisited:t.spookyDestinationsVisited+1})},JW=()=>{const t=bp();Sb({halloweenQuestsCompleted:t.halloweenQuestsCompleted+1})},eq=t=>{const e=bp();Sb({tokensEarnedInSeason:e.tokensEarnedInSeason+t})},Kve=()=>{try{localStorage.removeItem(Qm(cd.VISITED_SPOOKY)),localStorage.removeItem(Qm(cd.HALLOWEEN_BADGES)),localStorage.removeItem(Qm(cd.HALLOWEEN_PROGRESS))}catch(t){console.error("Error clearing Halloween data:",t)}},Yve=t=>{try{localStorage.removeItem(`${cd.VISITED_SPOOKY}_${t}`),localStorage.removeItem(`${cd.HALLOWEEN_BADGES}_${t}`),localStorage.removeItem(`${cd.HALLOWEEN_PROGRESS}_${t}`)}catch(e){console.error("Error clearing Halloween data for user:",e)}},Jve=Object.freeze(Object.defineProperty({__proto__:null,STORAGE_KEYS:Zve,addTokensEarned:eq,addVisitedDestination:KW,clearAllHalloweenData:Kve,clearHalloweenDataForUser:Yve,getBadges:KA,getCurrentUser:Xve,getProgress:bp,getVisitedDestinations:wb,incrementDestinationsVisited:NN,incrementQuestsCompleted:JW,isBadgeUnlocked:RN,isDestinationVisited:Qve,setCurrentUser:QW,unlockBadge:YW,updateProgress:Sb},Symbol.toStringTag,{value:"Module"})),tq=t=>{const e=[];for(const n of QA){if(RN(n.id))continue;let s=!1;switch(n.requirement.type){case"spooky_destinations":s=t.spookyDestinationsVisited>=n.requirement.count;break;case"halloween_quests":s=t.halloweenQuestsCompleted>=n.requirement.count;break;case"tokens_earned":s=t.tokensEarnedInSeason>=n.requirement.count;break}s&&e.push(n.id)}return{badges:e}},gI=t=>{const e=QA.find(s=>s.id===t);if(!e)return console.error(`Badge not found: ${t}`),null;YW(e);const n=bp();return n.unlockedBadges.includes(t)||Sb({unlockedBadges:[...n.unlockedBadges,t]}),e},ebe=(t,e)=>{const n=QA.find(r=>r.id===t);if(!n)return{current:0,required:0,percentage:0,isUnlocked:!1};let s=0;switch(n.requirement.type){case"spooky_destinations":s=e.spookyDestinationsVisited;break;case"halloween_quests":s=e.halloweenQuestsCompleted;break;case"tokens_earned":s=e.tokensEarnedInSeason;break}const l=n.requirement.count,u=Math.min(s/l*100,100),p=RN(t);return{current:s,required:l,percentage:u,isUnlocked:p}},tbe=()=>QA,nbe=({userId:t,onBadgeUnlock:e})=>{const[n,s]=he.useState([]),[l,u]=he.useState([]),[p,r]=he.useState("all"),[v,w]=he.useState(!0),[E,T]=he.useState(null),[k,R]=he.useState({spookyDestinationsVisited:0,halloweenQuestsCompleted:0,tokensEarnedInSeason:0,unlockedBadges:[]});he.useEffect(()=>{D()},[t]);const D=async()=>{w(!0);try{const re=tbe();s(re);const xe=KA();u(xe),t?await O(t):R(bp())}catch(re){console.error("Error loading badges:",re)}finally{w(!1)}},O=async re=>{try{const{data:xe,error:ae}=await Kt.from("users").select("total_tokens_earned, quests_completed").eq("id",re).single(),{count:ce,error:ye}=await Kt.from("user_spooky_quests").select("*",{count:"exact",head:!0}).eq("user_id",re).eq("status","completed"),Me={spookyDestinationsVisited:wb().length,halloweenQuestsCompleted:ce||0,tokensEarnedInSeason:xe!=null&&xe.total_tokens_earned?typeof xe.total_tokens_earned=="string"?parseFloat(xe.total_tokens_earned):xe.total_tokens_earned:0,unlockedBadges:bp().unlockedBadges};console.log("[HalloweenBadgesPanel] Synced progress from Supabase:",Me),R(Me),Sb(Me);const{badges:Ke}=tq(Me);Ke.forEach(ke=>{const je=gI(ke);je&&(console.log("[HalloweenBadgesPanel] Auto-unlocked badge:",je.name),u($e=>[...$e.filter(Ae=>Ae.id!==je.id),je]),e&&e(je))})}catch(xe){console.error("[HalloweenBadgesPanel] Error syncing from Supabase:",xe),R(bp())}},F=re=>ebe(re.id,k),U=re=>{if(l.some(ye=>ye.id===re))return!0;const ae=n.find(ye=>ye.id===re);if(!ae)return!1;let ce=0;switch(ae.requirement.type){case"spooky_destinations":ce=k.spookyDestinationsVisited;break;case"halloween_quests":ce=k.halloweenQuestsCompleted;break;case"tokens_earned":ce=k.tokensEarnedInSeason;break}if(ce>=ae.requirement.count){const ye=gI(re);return ye&&!l.some(Ce=>Ce.id===re)&&u(Ce=>[...Ce,ye]),!0}return!1},X=n.filter(re=>p==="all"?!0:re.rarity===p),W=[{value:"all",label:"All Badges"},{value:"common",label:"Common"},{value:"rare",label:"Rare"},{value:"epic",label:"Epic"},{value:"legendary",label:"Legendary"}],K=l.length,ne=n.length,te=ne>0?Math.round(K/ne*100):0;return v?f.jsx(YT,{variant:"default",className:"p-8",children:f.jsx("div",{className:"flex justify-center",children:f.jsx(Bw,{variant:"ghost",text:"Loading badges..."})})}):f.jsxs("div",{className:"space-y-6",children:[f.jsxs(YT,{variant:"default",className:"p-6",children:[f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Halloween Badges"}),f.jsx("p",{className:"text-white/70",children:"Collect badges by completing spooky challenges and quests"})]}),f.jsxs("div",{className:"flex flex-col items-end gap-2",children:[f.jsxs("div",{className:"text-3xl font-bold text-pumpkinOrange",children:[K," / ",ne]}),f.jsxs("div",{className:"text-sm text-white/60",children:[te,"% Complete"]})]})]}),f.jsx("div",{className:"mt-4 w-full h-3 bg-white/10 rounded-full overflow-hidden",children:f.jsx(it.div,{initial:{width:0},animate:{width:`${te}%`},transition:{duration:1,delay:.2},className:"h-full bg-gradient-to-r from-pumpkinOrange to-bloodOrange"})})]}),f.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[f.jsx(I$,{className:"w-5 h-5 text-white/60"}),W.map(re=>f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>r(re.value),className:`px-4 py-2 rounded-xl font-medium transition-all duration-300 ${p===re.value?"bg-pumpkinOrange text-white shadow-lg shadow-pumpkinOrange/30":"bg-white/10 text-white/60 hover:bg-white/20 hover:text-white"}`,children:re.label},re.value))]}),f.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:X.map((re,xe)=>{const ae=U(re.id),ce=ae?void 0:F(re);return f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:xe*.05},children:f.jsx(Wve,{badge:re,isUnlocked:ae,progress:ce,showAnimation:E===re.id,onAnimationComplete:()=>{T(null),e&&e(re)}})},re.id)})}),X.length===0&&f.jsx(YT,{variant:"default",className:"p-12 text-center",children:f.jsx("p",{className:"text-white/60 text-lg",children:"No badges found for this rarity"})})]})},rbe=({onNavigate:t})=>{var ce,ye;const{user:e,address:n,isConnected:s,tpxBalance:l}=ba(),{user:u,isAuthenticated:p}=El(),r=e||u,v=s||p,w=l||null,[E,T]=he.useState("overview"),[k,R]=he.useState(!1),[D,O]=he.useState(null),[F,U]=he.useState(!1),[X,W]=he.useState(null),[K,ne]=he.useState(!1);he.useEffect(()=>{const Ce=()=>{console.log("[Profile] Claim complete event received, refreshing data..."),te()};return window.addEventListener("claimComplete",Ce),()=>window.removeEventListener("claimComplete",Ce)},[]),fe.useEffect(()=>{const Ce=(r==null?void 0:r.id)||null;QW(Ce)},[r==null?void 0:r.id]),fe.useEffect(()=>{console.log("[Profile] User changed:",r==null?void 0:r.id,"address:",n),W(null),O(null),R(!1),U(!1),r!=null&&r.id?(console.log("[Profile] Loading data for user:",r.id),te(),xe()):console.log("[Profile] No user - showing empty state")},[r==null?void 0:r.id,n]);const te=async()=>{if(r!=null&&r.id)try{const Ce=await bN(r.id);Ce&&(W(Ce),re())}catch(Ce){console.error("Error loading user data:",Ce)}},re=()=>{try{const Ce=bp(),{badges:Me}=tq(Ce);Me.forEach(Ke=>{const ke=gI(Ke);ke&&(console.log("[Profile] Badge unlocked:",ke.name),ne(!0))})}catch(Ce){console.error("Error checking badges:",Ce)}},xe=async()=>{if(r!=null&&r.id){U(!0);try{console.log("[Profile] Loading passport data for user:",r.id);const{data:Ce,error:Me}=await Kt.from("nft_passports").select("*").eq("user_id",r.id).order("total_xp",{ascending:!1});if(console.log("[Profile] Passports from DB:",Ce,"Error:",Me),Me&&Me.code!=="PGRST116"&&console.error("[Profile] Error loading passports:",Me),Ce&&Ce.length>0){const Ke=["platinum","gold","silver","bronze"],ke=Ce.sort((je,$e)=>Ke.indexOf(je.tier)-Ke.indexOf($e.tier));console.log("[Profile]  Found",Ce.length,"passports, highest tier:",ke[0].tier),O(ke[0]),U(!1);return}console.log("[Profile] No passports found for user"),O(null)}catch(Ce){console.error("[Profile] Error loading passport data:",Ce),O(null)}finally{U(!1)}}};if(!v)return f.jsx("div",{className:"max-w-7xl mx-auto",children:f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx(GT,{className:"w-20 h-20 text-white/30 mb-6"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Please Sign In"}),f.jsx("p",{className:"text-white/60",children:"Connect your wallet or sign in to view your profile"})]})});const ae=[{id:"overview",label:"Overview",icon:GT},{id:"tokens",label:"Token History",icon:Ya},{id:"nfts",label:"NFT History",icon:Ho},{id:"achievements",label:"Achievements",icon:Vl}];return f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"My Profile"}),f.jsx("p",{className:"text-white/60",children:"View your stats, transactions, and achievements"})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6 mb-6",children:[f.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-cyan-500 to-purple-500 flex items-center justify-center",children:f.jsx(GT,{className:"w-8 h-8 text-white"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:(X==null?void 0:X.username)||(r==null?void 0:r.username)||"Traveler"}),f.jsxs("p",{className:"text-white/60 text-sm",children:["Level ",Math.floor(Math.sqrt(((X==null?void 0:X.total_xp)||(r==null?void 0:r.total_xp)||0)/100))+1]})]})]}),n&&f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center",children:f.jsx(NE,{className:"w-6 h-6 text-cyan-400"})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Wallet Address"}),f.jsxs("a",{href:`https://sepolia.etherscan.io/address/${n}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-cyan-400 hover:text-cyan-300 transition-colors text-sm font-mono",children:[n.slice(0,6),"...",n.slice(-4),f.jsx(Jo,{className:"w-3 h-3"})]})]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-amber-500 to-yellow-500 flex items-center justify-center",children:f.jsx(Ya,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 text-xs mb-1",children:"TPX Balance"}),k?f.jsx("p",{className:"text-white font-bold",children:"Loading..."}):f.jsxs("p",{className:"text-white font-bold text-lg",children:[w!==null?hI(w):"0"," TPX"]})]})]})]}),s&&n&&(r==null?void 0:r.id)&&f.jsx("div",{className:"mt-6 space-y-3",children:f.jsx("div",{className:"flex justify-center p-3 rounded-xl bg-white/5 border border-white/10",children:f.jsx(IW,{address:n})})}),f.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mt-6 pt-6 border-t border-white/10",children:[f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[f.jsx(md,{className:"w-5 h-5 text-yellow-400"}),f.jsx("span",{className:"text-2xl font-bold text-white",children:(X==null?void 0:X.total_xp)||(r==null?void 0:r.total_xp)||0})]}),f.jsx("p",{className:"text-white/60 text-xs",children:"Total XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[f.jsx(Ja,{className:"w-5 h-5 text-purple-400"}),f.jsx("span",{className:"text-2xl font-bold text-white",children:(X==null?void 0:X.quests_completed)||(r==null?void 0:r.quests_completed)||0})]}),f.jsx("p",{className:"text-white/60 text-xs",children:"Quests Completed"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[f.jsx(Ya,{className:"w-5 h-5 text-cyan-400"}),f.jsx("span",{className:"text-2xl font-bold text-white",children:hI(typeof((X==null?void 0:X.total_tokens_earned)||(r==null?void 0:r.total_tokens_earned))=="string"?parseFloat((X==null?void 0:X.total_tokens_earned)||(r==null?void 0:r.total_tokens_earned)||"0")||0:(X==null?void 0:X.total_tokens_earned)||(r==null?void 0:r.total_tokens_earned)||0)})]}),f.jsx("p",{className:"text-white/60 text-xs",children:"Tokens Earned"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[f.jsx(Mo,{className:"w-5 h-5 text-green-400"}),f.jsx("span",{className:"text-2xl font-bold text-white",children:Array.isArray(X==null?void 0:X.countries_visited)?X.countries_visited.length:((ce=D==null?void 0:D.countries_visited)==null?void 0:ce.length)||0})]}),f.jsx("p",{className:"text-white/60 text-xs",children:"Countries Visited"})]})]})]}),f.jsx("div",{className:"flex gap-2 mb-4 sm:mb-6 overflow-x-auto pb-2 -mb-2",children:ae.map(Ce=>{const Me=Ce.icon,Ke=E===Ce.id;return f.jsxs(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>T(Ce.id),className:`flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap text-sm sm:text-base ${Ke?"bg-cyan-500 text-white":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:[f.jsx(Me,{className:"w-4 h-4"}),f.jsx("span",{children:Ce.label})]},Ce.id)})}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[E==="overview"&&f.jsxs("div",{className:"space-y-6",children:[s&&n&&f.jsxs("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(Ho,{className:"w-5 h-5 text-cyan-400"}),"NFT Passport"]}),F?f.jsx("div",{className:"flex items-center justify-center py-8",children:f.jsx(va,{className:"w-6 h-6 text-white/40 animate-spin"})}):D?f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 text-sm mb-1",children:"Status"}),f.jsx("p",{className:"text-green-400 font-semibold",children:"Minted"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 text-sm mb-1",children:"Token ID"}),f.jsxs("p",{className:"text-white font-semibold",children:["#",D.token_id]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 text-sm mb-1",children:"Tier"}),f.jsx("p",{className:"text-white font-semibold capitalize",children:D.tier||"bronze"})]}),D.tx_hash&&f.jsxs("div",{children:[f.jsx("p",{className:"text-white/60 text-sm mb-1",children:"Transaction"}),f.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${D.tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-cyan-400 hover:text-cyan-300 transition-colors text-sm",children:["View",f.jsx(Jo,{className:"w-3 h-3"})]})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5",children:[f.jsx("p",{className:"text-2xl font-bold text-white",children:D.quests_completed||0}),f.jsx("p",{className:"text-white/60 text-xs mt-1",children:"Quests"})]}),f.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5",children:[f.jsx("p",{className:"text-2xl font-bold text-white",children:D.total_xp||0}),f.jsx("p",{className:"text-white/60 text-xs mt-1",children:"Total XP"})]}),f.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5",children:[f.jsx("p",{className:"text-2xl font-bold text-white",children:((ye=D.countries_visited)==null?void 0:ye.length)||0}),f.jsx("p",{className:"text-white/60 text-xs mt-1",children:"Countries"})]})]})]}):f.jsxs("div",{className:"text-center py-8",children:[f.jsx(Ho,{className:"w-12 h-12 text-white/30 mx-auto mb-4"}),f.jsx("p",{className:"text-white/60 text-sm",children:"No NFT Passport minted yet"}),f.jsx("p",{className:"text-white/40 text-xs mt-2",children:"Mint your NFT Passport from the Dashboard"})]})]}),f.jsx(nbe,{userId:r==null?void 0:r.id,onBadgeUnlock:Ce=>{console.log("[Profile] Badge unlocked:",Ce.name),ne(!0)}}),f.jsx(ibe,{userId:r==null?void 0:r.id})]}),E==="tokens"&&f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:f.jsx(wW,{})}),E==="nfts"&&f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:f.jsx(Vve,{})}),E==="achievements"&&f.jsx("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:f.jsx($ve,{})})]},E),K&&f.jsx(XA,{type:"badge",onComplete:()=>ne(!1)})]})},ibe=({userId:t})=>{const[e,n]=he.useState([]),[s,l]=he.useState(!0);he.useEffect(()=>{t?u():l(!1)},[t]);const u=async()=>{if(t){l(!0);try{const{data:r}=await Kt.from("user_quests").select("*, quests(title, location)").eq("user_id",t).order("created_at",{ascending:!1}).limit(5),{data:v}=await Kt.from("token_transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(5),{data:w}=await Kt.from("nft_transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(5),E=[];r==null||r.forEach(T=>{var k;E.push({type:"quest",title:((k=T.quests)==null?void 0:k.title)||"Quest",description:T.status==="completed"?"Completed quest":`Quest ${T.status}`,date:T.completed_at||T.created_at,icon:""})}),v==null||v.forEach(T=>{E.push({type:"token",title:`${T.amount} TPX`,description:T.transaction_type==="claim"?"Claimed tokens":"Token transaction",date:T.created_at,icon:""})}),w==null||w.forEach(T=>{E.push({type:"nft",title:`${T.nft_type} NFT`,description:`Minted ${T.nft_type} NFT #${T.token_id||"?"}`,date:T.created_at,icon:""})}),E.sort((T,k)=>new Date(k.date).getTime()-new Date(T.date).getTime()),n(E.slice(0,10))}catch(r){console.error("Error loading recent activity:",r)}finally{l(!1)}}},p=r=>{if(!r)return"";const v=new Date(r),E=new Date().getTime()-v.getTime(),T=Math.floor(E/6e4),k=Math.floor(E/36e5),R=Math.floor(E/864e5);return T<1?"Just now":T<60?`${T}m ago`:k<24?`${k}h ago`:R<7?`${R}d ago`:v.toLocaleDateString()};return f.jsxs("div",{className:"rounded-2xl backdrop-blur-xl bg-white/5 border border-white/10 p-6",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(ig,{className:"w-5 h-5 text-cyan-400"}),"Recent Activity"]}),s?f.jsx("div",{className:"flex items-center justify-center py-8",children:f.jsx(va,{className:"w-6 h-6 text-white/40 animate-spin"})}):e.length===0?f.jsx("p",{className:"text-white/60 text-sm text-center py-4",children:"No recent activity yet. Complete quests to see your activity here!"}):f.jsx("div",{className:"space-y-3",children:e.map((r,v)=>f.jsxs(it.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:[f.jsx("span",{className:"text-2xl",children:r.icon}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-white font-medium truncate",children:r.title}),f.jsx("p",{className:"text-white/60 text-xs",children:r.description})]}),f.jsx("span",{className:"text-white/40 text-xs whitespace-nowrap",children:p(r.date)})]},v))})]})},yI=t=>{var e;return Number(((e=t.users)==null?void 0:e.total_xp)??t.total_xp??0)},_z=t=>{var e;return Number(((e=t.users)==null?void 0:e.quests_completed)??t.quests_completed??0)},vz=t=>{const e=yI(t);return Math.floor(Math.sqrt(e/100))+1},bz=(t,e)=>{var s,l;const n=(s=t.users)==null?void 0:s.wallet_address;return n&&e[n]!==void 0?e[n]:Number(((l=t.users)==null?void 0:l.total_tokens_earned)??t.tokens_earned??0)},sbe=()=>{const{user:t}=ba(),{user:e}=El(),n=t||e,[s,l]=he.useState("all-time"),[u,p]=he.useState(!0),[r,v]=he.useState(!1),[w,E]=he.useState([]),[T,k]=he.useState({}),[R,D]=he.useState(null),[O,F]=he.useState(1),[U,X]=he.useState(0),W=50,K=fe.useCallback(async()=>{p(!0);try{if(console.log("[Leaderboard] Loading leaderboard for period:",s,"page:",O),n!=null&&n.id){console.log("[Leaderboard] Fetching user rank for user:",n.id);const Ce=await ave(n.id,s);console.log("[Leaderboard] User rank result:",Ce),D(Ce)}else console.log("[Leaderboard] No user logged in"),D(null);const ae=await lve(s);console.log("[Leaderboard] Total count:",ae),X(ae);const ce=(O-1)*W;console.log("[Leaderboard] Fetching entries with offset:",ce,"limit:",W);const ye=await sve(s,W,ce);console.log("[Leaderboard] Received data:",(ye==null?void 0:ye.length)||0,"entries (page",O,"of",Math.ceil(ae/W),")"),ye&&ye.length>0&&console.log("[Leaderboard] Sample entry:",{rank:ye[0].rank,user_id:ye[0].user_id,total_xp:ye[0].total_xp}),E(ye||[]),ye&&ye.length>0&&ne(ye)}catch(ae){console.error("[Leaderboard] Error loading leaderboard:",ae),E([]),D(null),X(0)}finally{p(!1)}},[s,O,n==null?void 0:n.id]),ne=async ae=>{const ce=ae.filter(Me=>{var Ke;return(Ke=Me.users)==null?void 0:Ke.wallet_address}).map(Me=>Me.users.wallet_address);if(ce.length===0)return;v(!0),console.log("[Leaderboard] Fetching blockchain balances for",ce.length,"wallets");const ye={},Ce=5;for(let Me=0;Me<ce.length;Me+=Ce){const Ke=ce.slice(Me,Me+Ce);(await Promise.all(Ke.map(async je=>{try{const $e=await Tx(je);return{wallet:je,balance:$e}}catch{return console.warn("[Leaderboard] Failed to fetch balance for",je),{wallet:je,balance:0}}}))).forEach(({wallet:je,balance:$e})=>{ye[je]=$e})}console.log("[Leaderboard] Fetched balances:",ye),k(ye),v(!1)};he.useEffect(()=>{K()},[K]),he.useEffect(()=>{const ae=setInterval(()=>{K()},3e4);return()=>clearInterval(ae)},[K]),he.useEffect(()=>{const ae=ce=>{console.log("[Leaderboard] User data update event received, refreshing leaderboard..."),setTimeout(()=>{K()},500)};return window.addEventListener("userDataUpdated",ae),()=>{window.removeEventListener("userDataUpdated",ae)}},[K]);const te=ae=>ae===1?f.jsx(u0e,{className:"w-6 h-6 text-amber-400"}):ae===2?f.jsx(MB,{className:"w-6 h-6 text-slate-300"}):ae===3?f.jsx(MB,{className:"w-6 h-6 text-orange-400"}):null,re=ae=>{var ce,ye;return(ce=ae.users)!=null&&ce.username?ae.users.username:(ye=ae.users)!=null&&ye.wallet_address?`${ae.users.wallet_address.slice(0,6)}...${ae.users.wallet_address.slice(-4)}`:"Anonymous"},xe=ae=>n?ae.user_id===n.id:!1;return f.jsxs("div",{className:"max-w-6xl mx-auto",children:[f.jsx(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/50",children:f.jsx(Ja,{className:"w-6 h-6 text-slate-900"})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Leaderboard"}),f.jsx("p",{className:"text-slate-400",children:"Top travelers  Real-time rankings"})]})]}),f.jsxs(it.button,{onClick:()=>K(),disabled:u,whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-white/70 hover:text-white transition-all duration-300 disabled:opacity-50",children:[f.jsx(R$,{className:`w-4 h-4 ${u?"animate-spin":""}`}),f.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})}),f.jsx("div",{className:"flex gap-3 mb-6 flex-wrap",children:["all-time","monthly","weekly"].map(ae=>f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{l(ae),F(1)},className:`px-4 sm:px-6 py-2 rounded-xl font-medium transition-all duration-300 text-sm sm:text-base ${s===ae?"bg-gradient-to-r from-amber-500 to-orange-500 text-slate-900 shadow-lg":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white"}`,children:ae.charAt(0).toUpperCase()+ae.slice(1)},ae))}),n&&f.jsx(it.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-xl bg-gradient-to-r from-amber-500/20 to-orange-500/20 backdrop-blur-xl border border-amber-500/30",children:f.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[f.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[f.jsx(Vl,{className:"w-5 h-5 text-amber-400 flex-shrink-0"}),R!=null?f.jsxs("div",{className:"flex items-center gap-2 flex-wrap min-w-0",children:[f.jsxs("span",{className:"text-white text-sm sm:text-base whitespace-nowrap",children:["Your rank: ",f.jsxs("span",{className:"font-bold text-amber-400 text-lg sm:text-xl",children:["#",R]})]}),U>0&&f.jsxs("span",{className:"text-white/60 text-xs sm:text-sm whitespace-nowrap",children:["(out of ",U," ",U===1?"player":"players",")"]})]}):u?f.jsx("span",{className:"text-white/60 text-sm sm:text-base",children:"Loading your rank..."}):f.jsx("span",{className:"text-white/60 text-sm sm:text-base",children:"Your rank will appear here once you complete your first quest"})]}),R!=null&&f.jsxs("div",{className:"text-xs sm:text-sm text-white/40 whitespace-nowrap",children:[R===1&&" Champion!",R===2&&" Runner-up!",R===3&&" Top 3!",R>3&&R<=10&&" Top 10!",R>10&&R<=50&&" Top 50!"]})]})}),f.jsx("div",{className:"rounded-2xl bg-white/5 backdrop-blur-xl border border-white/10 overflow-hidden",children:u?f.jsxs("div",{className:"p-12 text-center",children:[f.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"}),f.jsx("p",{className:"mt-4 text-white/60",children:"Loading leaderboard..."})]}):w.length===0?f.jsxs("div",{className:"p-12 text-center",children:[f.jsx(Ja,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),f.jsx("p",{className:"text-white/60",children:"No entries yet. Be the first!"})]}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"hidden md:block overflow-x-auto",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{children:f.jsxs("tr",{className:"border-b border-white/10",children:[f.jsx("th",{className:"px-4 lg:px-6 py-4 text-left text-sm font-semibold text-white/60",children:"Rank"}),f.jsx("th",{className:"px-4 lg:px-6 py-4 text-left text-sm font-semibold text-white/60",children:"User"}),f.jsx("th",{className:"px-4 lg:px-6 py-4 text-right text-sm font-semibold text-white/60",children:"XP"}),f.jsx("th",{className:"px-4 lg:px-6 py-4 text-right text-sm font-semibold text-white/60",children:"Quests"}),f.jsx("th",{className:"px-4 lg:px-6 py-4 text-right text-sm font-semibold text-white/60",children:"TPX"}),f.jsx("th",{className:"px-4 lg:px-6 py-4 text-right text-sm font-semibold text-white/60",children:"Level"})]})}),f.jsx("tbody",{children:w.map((ae,ce)=>{var Ce;const ye=ae.rank||(O-1)*W+ce+1;return f.jsxs(it.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:ce*.05},className:`border-b border-white/5 hover:bg-white/5 transition-colors ${xe(ae)?"bg-amber-500/10":""}`,children:[f.jsx("td",{className:"px-4 lg:px-6 py-4",children:f.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[te(ye),f.jsx("span",{className:"font-bold text-white text-sm lg:text-base",children:ye})]})}),f.jsx("td",{className:"px-4 lg:px-6 py-4",children:f.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[f.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-full bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center border-2 border-slate-600/50 flex-shrink-0",children:f.jsx("span",{className:"text-xs lg:text-sm font-bold text-white",children:re(ae).charAt(0).toUpperCase()})}),f.jsx("span",{className:"font-medium text-white text-sm lg:text-base truncate max-w-[150px] lg:max-w-none",children:re(ae)})]})}),f.jsx("td",{className:"px-4 lg:px-6 py-4 text-right",children:f.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.jsx(sg,{className:"w-3 h-3 lg:w-4 lg:h-4 text-blue-400"}),f.jsx("span",{className:"font-semibold text-white text-sm lg:text-base",children:yI(ae).toLocaleString()})]})}),f.jsx("td",{className:"px-4 lg:px-6 py-4 text-right",children:f.jsx("span",{className:"text-white text-sm lg:text-base",children:_z(ae)})}),f.jsx("td",{className:"px-4 lg:px-6 py-4 text-right",children:f.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.jsx(md,{className:"w-3 h-3 lg:w-4 lg:h-4 text-amber-400"}),f.jsx("span",{className:"font-bold text-amber-400 text-sm lg:text-base",children:r&&((Ce=ae.users)!=null&&Ce.wallet_address)?"...":bz(ae,T).toLocaleString()})]})}),f.jsx("td",{className:"px-4 lg:px-6 py-4 text-right",children:f.jsx("span",{className:"px-2 lg:px-3 py-1 rounded-full bg-white/10 text-white text-xs lg:text-sm font-medium",children:vz(ae)})})]},ae.id)})})]})}),f.jsx("div",{className:"md:hidden space-y-3 p-4",children:w.map((ae,ce)=>{var Ce;const ye=ae.rank||(O-1)*W+ce+1;return f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ce*.05},className:`rounded-xl backdrop-blur-xl bg-white/5 border border-white/10 p-4 ${xe(ae)?"bg-amber-500/10 border-amber-500/30":""}`,children:[f.jsxs("div",{className:"flex items-center justify-between mb-3",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[te(ye),f.jsxs("span",{className:"font-bold text-white text-lg",children:["#",ye]}),f.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center border-2 border-slate-600/50",children:f.jsx("span",{className:"text-sm font-bold text-white",children:re(ae).charAt(0).toUpperCase()})}),f.jsx("span",{className:"font-medium text-white",children:re(ae)})]}),f.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/10 text-white text-sm font-medium",children:["Level ",vz(ae)]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[f.jsxs("div",{children:[f.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:f.jsx(sg,{className:"w-4 h-4 text-blue-400"})}),f.jsx("p",{className:"text-xs text-white/60",children:"XP"}),f.jsx("p",{className:"font-semibold text-white",children:yI(ae).toLocaleString()})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Quests"}),f.jsx("p",{className:"font-semibold text-white",children:_z(ae)})]}),f.jsxs("div",{children:[f.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:f.jsx(md,{className:"w-4 h-4 text-amber-400"})}),f.jsx("p",{className:"text-xs text-white/60",children:"TPX"}),f.jsx("p",{className:"font-bold text-amber-400",children:r&&((Ce=ae.users)!=null&&Ce.wallet_address)?"...":bz(ae,T).toLocaleString()})]})]})]},ae.id)})})]})}),!u&&U>W&&f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-4 flex-wrap",children:[f.jsxs(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>F(ae=>Math.max(1,ae-1)),disabled:O===1,className:"flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-white/5 text-white/60 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm sm:text-base",children:[f.jsx(S2,{className:"w-4 h-4"}),f.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),f.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[f.jsxs("span",{className:"text-white/60 text-xs sm:text-sm",children:["Page ",f.jsx("span",{className:"font-bold text-white",children:O})," of"," ",f.jsx("span",{className:"font-bold text-white",children:Math.ceil(U/W)})]}),f.jsxs("span",{className:"text-white/40 text-xs",children:["(",U," total)"]})]}),f.jsxs(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>F(ae=>Math.min(Math.ceil(U/W),ae+1)),disabled:O>=Math.ceil(U/W),className:"flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-white/5 text-white/60 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm sm:text-base",children:[f.jsx("span",{className:"hidden sm:inline",children:"Next"}),f.jsx(T2,{className:"w-4 h-4"})]})]}),Math.ceil(U/W)<=10&&f.jsx("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:Array.from({length:Math.ceil(U/W)},(ae,ce)=>ce+1).map(ae=>f.jsx(it.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>F(ae),className:`w-8 h-8 rounded-lg text-sm font-medium transition-all ${O===ae?"bg-amber-500 text-slate-900":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white"}`,children:ae},ae))})]}),n&&R&&f.jsx("div",{className:"mt-4 text-center",children:(()=>{const ae=Math.ceil(R/W);return!w.some(ye=>ye.user_id===n.id)&&ae!==O?f.jsxs(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>F(ae),className:"px-4 py-2 rounded-xl bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 border border-amber-500/30 transition-all text-sm sm:text-base",children:["Jump to your position (Rank #",R,")"]}):null})()})]})},obe=t=>t>=15?"platinum":t>=10?"gold":t>=5?"silver":"bronze",abe=({level:t,totalXP:e,showProgress:n=!0})=>{const s=obe(t),u=Math.floor(Math.sqrt(e/100))+1,p=Math.pow(u-1,2)*100,r=Math.pow(u,2)*100,v=e-p,w=r-p,E=Math.max(0,Math.min(100,v/w*100)),T={bronze:"from-amber-600 to-amber-800",silver:"from-slate-300 to-slate-500",gold:"from-yellow-400 to-yellow-600",platinum:"from-cyan-300 to-cyan-500"},k={bronze:"rgba(217, 119, 6, 0.4)",silver:"rgba(148, 163, 184, 0.4)",gold:"rgba(250, 204, 21, 0.5)",platinum:"rgba(103, 232, 249, 0.5)"},R={bronze:"",silver:"",gold:"",platinum:""};return f.jsxs("div",{className:"flex flex-col gap-4",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs(it.div,{whileHover:{scale:1.1,rotate:[0,-10,10,0]},className:`w-16 h-16 bg-gradient-to-br ${T[s]} rounded-2xl flex items-center justify-center shadow-2xl border-2 border-white/30 relative`,children:[f.jsx("span",{className:"text-3xl",children:R[s]}),f.jsx("div",{className:"absolute -inset-1 bg-gradient-to-br ${tierColors[tier]} rounded-2xl blur-lg opacity-50"})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(Vl,{className:"w-5 h-5 text-white/80"}),f.jsxs("span",{className:"text-2xl font-bold text-white",children:["Level ",u]})]}),f.jsxs("span",{className:"text-sm text-white/60 capitalize font-medium",children:[s," Tier"]})]})]}),f.jsxs("div",{className:"text-right",children:[f.jsx("div",{className:"text-xs text-white/50 mb-1",children:"Total XP"}),f.jsx("div",{className:"text-2xl font-bold text-white",children:e.toLocaleString()})]})]}),n&&f.jsxs("div",{className:"w-full space-y-3",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{className:"text-sm text-white/70",children:[f.jsx("span",{className:"font-semibold text-white",children:e.toLocaleString()}),f.jsxs("span",{className:"text-white/50",children:[" / ",r.toLocaleString()," XP"]})]}),f.jsxs("div",{className:"text-sm text-white/70",children:[f.jsxs("span",{className:"font-semibold text-cyan-400",children:[Math.round(E),"%"]})," to Level ",u+1]})]}),f.jsx("div",{className:"relative",children:f.jsx("div",{className:"w-full h-4 bg-black/30 rounded-full overflow-hidden border border-white/10 relative",children:f.jsx(it.div,{initial:{width:0},animate:{width:`${Math.min(E,100)}%`},transition:{duration:1.2,ease:[.34,1.56,.64,1],delay:.2},className:`h-full bg-gradient-to-r ${T[s]} relative overflow-hidden`,style:{boxShadow:`0 0 20px ${k[s]}`},children:f.jsx(it.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",animate:{x:["-100%","200%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut",repeatDelay:1}})})})}),f.jsxs("div",{className:"flex justify-between text-xs text-white/50",children:[f.jsxs("div",{children:[f.jsxs("span",{className:"text-white/70",children:["Level ",u,":"]})," ",p.toLocaleString()," XP"]}),f.jsxs("div",{children:[f.jsxs("span",{className:"text-white/70",children:["Level ",u+1,":"]})," ",r.toLocaleString()," XP"]})]})]})]})},lbe=()=>{const{user:t}=ba(),{user:e}=El(),n=t||e,[s,l]=he.useState([]),[u,p]=he.useState([]),[r,v]=he.useState([]),[w,E]=he.useState(!0),[T,k]=he.useState(null),[R,D]=he.useState(null),{address:O}=ba(),F=he.useRef(new Set);he.useEffect(()=>{U()},[n]);const U=async()=>{if(!n){console.log("[Achievements] No user, skipping load"),E(!1);return}E(!0),k(null);try{console.log("[Achievements] Loading achievements for user:",n.id);const[ne,te]=await Promise.all([qW(),PN(n.id)]);if(console.log("[Achievements] All achievements:",(ne==null?void 0:ne.length)||0),console.log("[Achievements] User achievements:",(te==null?void 0:te.length)||0),l(ne||[]),p(te||[]),!ne||ne.length===0){console.warn("[Achievements] No achievements found in database"),v([]),E(!1);return}const re=await Promise.all(ne.map(async xe=>{const ae=await XW(n.id,xe.id),ce=te.find(ye=>ye.achievement_id===xe.id);return{...xe,progress:ae.current,unlocked:!!(ce!=null&&ce.unlocked_at),unlocked_at:ce==null?void 0:ce.unlocked_at,nft_minted:(ce==null?void 0:ce.nft_minted)||!1,nft_token_id:ce==null?void 0:ce.nft_token_id,nft_tx_hash:ce==null?void 0:ce.nft_tx_hash}}));console.log("[Achievements] Achievements with progress:",re.length),v(re)}catch(ne){console.error("[Achievements] Error loading achievements:",ne),console.error("[Achievements] Error details:",ne),k("Failed to load achievements. Please try again."),v([])}finally{E(!1)}},X=ne=>{if(!ne.requirement_value||ne.requirement_value===0)return 0;const te=ne.progress||0;return Math.min(te/ne.requirement_value*100,100)},W=async ne=>{if(F.current.has(ne)){console.log("[Achievements] Already minted in this session:",ne);return}if(!(n!=null&&n.id)||!O){dr.error("Please connect your wallet to mint achievement badge NFT");return}D(ne);const te=dr.loading(" Minting achievement badge NFT...");try{const re=await qA(),{mintAchievementAPI:xe}=await hr(async()=>{const{mintAchievementAPI:ye}=await Promise.resolve().then(()=>BE);return{mintAchievementAPI:ye}},void 0),ae=await xe(n.id,ne,O);if(!ae.success||!ae.data){dr.dismiss(te),dr.error(`Failed to mint achievement badge: ${ae.error}`),D(null);return}const ce=ae.data;if(ce.success){F.current.add(ne),dr.dismiss(te);const ye=dr.loading(" Checking Sepolia explorer for NFT...",{description:"Monitoring transaction every 2 seconds",duration:1/0});(await C2(O,Ke=>{console.log("[Achievements]  NFT transaction found on explorer!",Ke),dr.dismiss(ye),dr.success(" Achievement NFT minted successfully!",{description:`Token ID: ${ce.tokenId}`,duration:5e3,action:{label:"View on Etherscan",onClick:()=>window.open(Cx(Ke.transactionHash),"_blank")}}),setTimeout(()=>K(ce.tokenId,ne),1e3)},Ke=>{dr.loading(` Checking Sepolia explorer... (${Ke}/100)`,{id:ye,description:"Monitoring every 2 seconds",duration:1/0})},"0x110D62545d416d3DFEfA12D0298aBf197CF0e828",100,re)).found||(dr.dismiss(ye),dr.warning(" NFT mint not confirmed yet",{description:"Transaction may still be pending. Check Etherscan manually.",duration:8e3,action:{label:"Open Etherscan",onClick:()=>window.open(kN(O),"_blank")}})),v(Ke=>Ke.map(ke=>ke.id===ne?{...ke,nft_minted:!0,nft_token_id:ce.tokenId}:ke)),setTimeout(()=>{window.location.reload()},3e3)}else dr.dismiss(te),dr.error(`Failed to mint NFT: ${ce.error||"Unknown error"}`)}catch(re){console.error("Error minting achievement badge:",re),dr.dismiss(te),dr.error(`Error minting NFT: ${re.message||"Unknown error"}`)}finally{D(null)}},K=async(ne,te)=>{if(!window.ethereum||!O){console.log("[Achievements] MetaMask not available");return}const re="0x110D62545d416d3DFEfA12D0298aBf197CF0e828";try{if(console.log("[Achievements] Prompting user to add NFT to MetaMask..."),await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:re,tokenId:ne.toString()}}})){const ae=`achievement_badge_nft_added_${O.toLowerCase()}_${te}`;localStorage.setItem(ae,"true"),console.log("[Achievements]  NFT added to MetaMask!"),dr.success("NFT added to MetaMask!",{description:`Token ID ${ne} is now visible in your wallet`,duration:5e3})}}catch(xe){console.error("[Achievements] Error adding NFT to MetaMask:",xe),xe.code===4001&&console.log("[Achievements] User rejected NFT addition")}};return f.jsxs("div",{className:"max-w-6xl mx-auto",children:[f.jsx(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-xl flex items-center justify-center shadow-lg",children:f.jsx(Vl,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Achievements"}),f.jsx("p",{className:"text-slate-400",children:"Unlock badges by completing challenges"})]})]})}),n&&f.jsx("div",{className:"mb-8",children:f.jsx("div",{className:"rounded-2xl bg-white/5 backdrop-blur-xl border border-white/10 p-6",children:f.jsx(abe,{level:n.level,totalXP:n.total_xp,showProgress:!0})})}),T&&f.jsx("div",{className:"mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400",children:T}),w?f.jsxs("div",{className:"text-center py-12",children:[f.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"}),f.jsx("p",{className:"mt-4 text-white/60",children:"Loading achievements..."})]}):r.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(Vl,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),f.jsx("p",{className:"text-white/60",children:"No achievements available yet."})]}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((ne,te)=>{const re=ne.unlocked||!1,xe=X(ne),ae=ne.progress||0;return f.jsxs(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:te*.05},className:`rounded-2xl border backdrop-blur-xl p-6 transition-all duration-300 ${re?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 border-amber-500/30 shadow-lg shadow-amber-500/10":"bg-white/5 border-white/10 hover:border-white/20"}`,children:[f.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${re?"bg-gradient-to-br from-amber-400 to-orange-500":"bg-white/10 opacity-50 grayscale"}`,children:f.jsx("span",{className:"text-3xl",children:ne.icon||""})}),f.jsx("h3",{className:`text-lg font-bold mb-2 ${re?"text-white":"text-slate-400"}`,children:ne.title}),f.jsx("p",{className:"text-sm text-slate-400 mb-4",children:ne.description}),ne.requirement_value&&ne.requirement_value>0&&f.jsxs("div",{className:"mb-2",children:[f.jsxs("div",{className:"flex justify-between text-xs text-white/60 mb-1",children:[f.jsxs("span",{children:[ae," / ",ne.requirement_value]}),f.jsxs("span",{children:[Math.round(xe),"%"]})]}),f.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:f.jsx(it.div,{initial:{width:0},animate:{width:`${xe}%`},transition:{duration:.5},className:`h-full rounded-full ${re?"bg-gradient-to-r from-amber-400 to-orange-500":"bg-white/20"}`})})]}),(ne.reward_tokens>0||ne.reward_xp>0)&&f.jsxs("div",{className:"flex gap-3 text-xs text-white/60",children:[ne.reward_tokens>0&&f.jsxs("span",{children:[" ",ne.reward_tokens," TPX"]}),ne.reward_xp>0&&f.jsxs("span",{children:[" ",ne.reward_xp," XP"]})]}),re&&f.jsxs("div",{className:"mt-3 space-y-2",children:[f.jsxs(it.div,{initial:{scale:0},animate:{scale:1},className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/20 border border-amber-500/30",children:[f.jsx(Vl,{className:"w-4 h-4 text-amber-400"}),f.jsx("span",{className:"text-xs font-semibold text-amber-400",children:"Unlocked!"})]}),ne.nft_minted?f.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[f.jsx(Ho,{className:"w-3 h-3 text-green-400"}),f.jsx("span",{className:"text-green-400",children:"NFT Minted"}),ne.nft_tx_hash&&f.jsx("a",{href:`https://sepolia.etherscan.io/tx/${ne.nft_tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300",children:f.jsx(Jo,{className:"w-3 h-3"})})]}):O&&!F.current.has(ne.id)&&f.jsx(it.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>W(ne.id),disabled:R===ne.id,className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 text-purple-300 hover:from-purple-500/30 hover:to-pink-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium",children:R===ne.id?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-3 h-3 animate-spin"}),f.jsx("span",{children:"Minting..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(Ho,{className:"w-3 h-3"}),f.jsx("span",{children:"Mint NFT Badge"})]})})]})]},ne.id)})})]})},lT={north:52.35,south:52.1,east:21.25,west:20.8};function wz(t,e){return t>=lT.south&&t<=lT.north&&e>=lT.west&&e<=lT.east}function Sz(t){const e=["warszawa","warsaw","waw","ztm"],n=t.toLowerCase();return e.some(s=>n.includes(s))}async function Tz(t){try{await ZA();const e=window.google;if(!e||!e.maps)return null;const n=new e.maps.Geocoder;return new Promise(s=>{n.geocode({address:t,region:"pl"},(l,u)=>{if(u===e.maps.GeocoderStatus.OK&&l[0]){const p=l[0].geometry.location;s({lat:p.lat(),lng:p.lng()})}else s(null)})})}catch(e){return console.error("Geocoding error:",e),null}}async function cbe(t,e,n){try{const l=await fetch("http://localhost:3002/api/transit/ztm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:t,destination:e,departureTime:n==null?void 0:n.toISOString()})});if(!l.ok)return console.warn("ZTM API not available, falling back to Google Maps"),[];const u=await l.json();return u.success&&u.routes?u.routes:[]}catch(s){return console.warn("ZTM API error, falling back to Google Maps:",s),[]}}async function ube(t,e,n){try{const s=await Tz(t),l=await Tz(e),u=s?wz(s.lat,s.lng):Sz(t),p=l?wz(l.lat,l.lng):Sz(e);if(u&&p){console.log(" Both locations in Warsaw, trying ZTM API...");const T=await cbe(t,e,n);if(T.length>0)return console.log(` Found ${T.length} routes from ZTM API`),T;console.log(" ZTM API returned no routes, falling back to Google Maps")}await ZA();const r=window.google;if(!r||!r.maps)throw new Error("Google Maps API not loaded");const v=new r.maps.DirectionsService,w=n||new Date,E={origin:t,destination:e,travelMode:r.maps.TravelMode.TRANSIT,provideRouteAlternatives:!0,region:"PL",language:"pl",transitOptions:{modes:[r.maps.TransitMode.BUS,r.maps.TransitMode.SUBWAY,r.maps.TransitMode.TRAIN,r.maps.TransitMode.TRAM,r.maps.TransitMode.RAIL],routingPreference:r.maps.TransitRoutePreference.FEWER_TRANSFERS}};return n&&(E.transitOptions.departureTime=w),new Promise((T,k)=>{v.route(E,(R,D)=>{if(console.log(" Transit search status:",D),console.log(" Transit search result:",R),D===r.maps.DirectionsStatus.OK&&R){const O=R.routes.map(F=>{var ne,te,re,xe,ae,ce,ye,Ce,Me,Ke,ke,je,$e,Ae,He;const U=F.legs[0],X=U.steps.map(qe=>{var _t,vt,qt,kt,on,mn,Hr,Un,$r;const Le=qe.travel_mode||qe.travelMode,st=Le==="TRANSIT"||Le===((vt=(_t=r.maps)==null?void 0:_t.TravelMode)==null?void 0:vt.TRANSIT)||Le===3,bt=qe.transit||qe.transit_details,yt={mode:st?"TRANSIT":Le==="DRIVING"||Le===((kt=(qt=r.maps)==null?void 0:qt.TravelMode)==null?void 0:kt.DRIVING)||Le===0?"DRIVING":"WALKING",distance:((on=qe.distance)==null?void 0:on.text)||"0 m",duration:((mn=qe.duration)==null?void 0:mn.text)||"0 min",instructions:((Hr=qe.html_instructions)==null?void 0:Hr.replace(/<[^>]*>/g,""))||((Un=qe.instructions)==null?void 0:Un.replace(/<[^>]*>/g,""))||(($r=qe.distance)==null?void 0:$r.text)||"",startAddress:qe.start_location?"":U.start_address||"",endAddress:qe.end_location?"":U.end_address||"",steps:[]};if(st&&bt){const ht=bt.line||{},Lr=ht.vehicle||{},Br=bt.departure_stop||{},wn=bt.arrival_stop||{},Nn=bt.departure_time||{},mr=bt.arrival_time||{},Qn=Bt=>Bt?Bt.lat&&typeof Bt.lat=="function"?{lat:Bt.lat(),lng:Bt.lng()}:{lat:Bt.lat||0,lng:Bt.lng||0}:{lat:0,lng:0},Nt=Bt=>{if(!Bt)return"Unknown";if(Bt.text)return Bt.text;if(Bt instanceof Date)return Bt.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});if(Bt.value){const En=new Date(Bt.value);return typeof Bt.value=="number"?new Date(Bt.value*1e3).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):En.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}return"Unknown"},et=(Bt,En)=>{if(!Bt)return"Stop";const Dn=Bt.toLowerCase();if(Dn.includes("metro")||Dn.includes("subway")||Dn.includes("station")||Dn.includes("przystanek")||Dn.includes("dworzec")||Dn.includes("terminal"))return Bt;const rn=En.toUpperCase();return rn==="SUBWAY"||rn==="METRO_RAIL"?`Metro ${Bt}`:rn==="TRAIN"||rn==="RAIL"||rn==="HEAVY_RAIL"?`${Bt} Station`:rn==="BUS"?`${Bt} (Bus Stop)`:rn==="TRAM"?`${Bt} (Tram Stop)`:Bt},Oe=Lr.type||"BUS";yt.transitDetails={line:{name:ht.name||"Line",shortName:ht.short_name||"",vehicle:{type:Oe,icon:Lr.icon||""},color:ht.color||"#000000",agencies:ht.agencies||[]},departureStop:{name:et(Br.name||"Stop",Oe),location:Qn(Br.location||Br)},arrivalStop:{name:et(wn.name||"Stop",Oe),location:Qn(wn.location||wn)},departureTime:Nt(Nn),arrivalTime:Nt(mr),numStops:bt.num_stops||0,headsign:bt.headsign||""}}qe.polyline&&(yt.polyline=qe.polyline.points||qe.polyline);const Vt=ht=>{if(ht)return ht.lat&&typeof ht.lat=="function"?{lat:ht.lat(),lng:ht.lng()}:{lat:ht.lat||0,lng:ht.lng||0}};return yt.startLocation=Vt(qe.start_location),yt.endLocation=Vt(qe.end_location),yt}),W=((ne=F.overview_polyline)==null?void 0:ne.points)||F.overview_polyline||"",K=F.bounds?{northeast:{lat:typeof F.bounds.getNorthEast=="function"?F.bounds.getNorthEast().lat():((te=F.bounds.northeast)==null?void 0:te.lat)||((re=F.bounds.northeast)==null?void 0:re.lat())||0,lng:typeof F.bounds.getNorthEast=="function"?F.bounds.getNorthEast().lng():((xe=F.bounds.northeast)==null?void 0:xe.lng)||((ae=F.bounds.northeast)==null?void 0:ae.lng())||0},southwest:{lat:typeof F.bounds.getSouthWest=="function"?F.bounds.getSouthWest().lat():((ce=F.bounds.southwest)==null?void 0:ce.lat)||((ye=F.bounds.southwest)==null?void 0:ye.lat())||0,lng:typeof F.bounds.getSouthWest=="function"?F.bounds.getSouthWest().lng():((Ce=F.bounds.southwest)==null?void 0:Ce.lng)||((Me=F.bounds.southwest)==null?void 0:Me.lng())||0}}:void 0;return{summary:F.summary||"Public transit route",totalDuration:((Ke=U.duration)==null?void 0:Ke.text)||"Unknown",totalDistance:((ke=U.distance)==null?void 0:ke.text)||"0 km",departureTime:((je=U.departure_time)==null?void 0:je.text)||(($e=U.departure_time)!=null&&$e.value?new Date(U.departure_time.value*1e3).toLocaleTimeString("en-US"):"Now"),arrivalTime:((Ae=U.arrival_time)==null?void 0:Ae.text)||((He=U.arrival_time)!=null&&He.value?new Date(U.arrival_time.value*1e3).toLocaleTimeString("en-US"):"Unknown"),warnings:F.warnings||[],legs:X,polyline:W,bounds:K}});T(O)}else if(D===r.maps.DirectionsStatus.ZERO_RESULTS)console.log(" No routes found (ZERO_RESULTS)"),T([]);else{const F={[r.maps.DirectionsStatus.NOT_FOUND]:"One of the locations was not found. Please check the addresses.",[r.maps.DirectionsStatus.REQUEST_DENIED]:"No permission to search routes. Please check API key.",[r.maps.DirectionsStatus.OVER_QUERY_LIMIT]:"Query limit exceeded. Please try again later.",[r.maps.DirectionsStatus.INVALID_REQUEST]:"Invalid request. Please check search parameters."}[D]||`Search error: ${D}`;console.error(" Transit search error:",D,F),k(new Error(F))}})})}catch(s){throw console.error("Transit search error:",s),new Error(s.message||"Failed to search transit routes")}}var ZM={exports:{}},Ez;function dbe(){return Ez||(Ez=1,(function(t){(function(){var e=function(l){return typeof l=="number"?l={precision:l}:l=l||{},l.precision=l.precision||5,l.factor=l.factor||Math.pow(10,l.precision),l.dimension=l.dimension||2,l},n={encode:function(l,u){u=e(u);for(var p=[],r=0,v=l.length;r<v;++r){var w=l[r];if(u.dimension===2)p.push(w.lat||w[0]),p.push(w.lng||w[1]);else for(var E=0;E<u.dimension;++E)p.push(w[E])}return this.encodeDeltas(p,u)},decode:function(l,u){u=e(u);for(var p=this.decodeDeltas(l,u),r=[],v=0,w=p.length;v+(u.dimension-1)<w;){for(var E=[],T=0;T<u.dimension;++T)E.push(p[v++]);r.push(E)}return r},encodeDeltas:function(l,u){u=e(u);for(var p=[],r=0,v=l.length;r<v;)for(var w=0;w<u.dimension;++w,++r){var E=l[r].toFixed(u.precision),T=E-(p[w]||0);p[w]=E,l[r]=T}return this.encodeFloats(l,u)},decodeDeltas:function(l,u){u=e(u);for(var p=[],r=this.decodeFloats(l,u),v=0,w=r.length;v<w;)for(var E=0;E<u.dimension;++E,++v)r[v]=Math.round((p[E]=r[v]+(p[E]||0))*u.factor)/u.factor;return r},encodeFloats:function(l,u){u=e(u);for(var p=0,r=l.length;p<r;++p)l[p]=Math.round(l[p]*u.factor);return this.encodeSignedIntegers(l)},decodeFloats:function(l,u){u=e(u);for(var p=this.decodeSignedIntegers(l),r=0,v=p.length;r<v;++r)p[r]/=u.factor;return p},encodeSignedIntegers:function(l){for(var u=0,p=l.length;u<p;++u){var r=l[u];l[u]=r<0?~(r<<1):r<<1}return this.encodeUnsignedIntegers(l)},decodeSignedIntegers:function(l){for(var u=this.decodeUnsignedIntegers(l),p=0,r=u.length;p<r;++p){var v=u[p];u[p]=v&1?~(v>>1):v>>1}return u},encodeUnsignedIntegers:function(l){for(var u="",p=0,r=l.length;p<r;++p)u+=this.encodeUnsignedInteger(l[p]);return u},decodeUnsignedIntegers:function(l){for(var u=[],p=0,r=0,v=0,w=l.length;v<w;++v){var E=l.charCodeAt(v)-63;p|=(E&31)<<r,E<32?(u.push(p),p=0,r=0):r+=5}return u},encodeSignedInteger:function(l){return l=l<0?~(l<<1):l<<1,this.encodeUnsignedInteger(l)},encodeUnsignedInteger:function(l){for(var u,p="";l>=32;)u=(32|l&31)+63,p+=String.fromCharCode(u),l>>=5;return u=l+63,p+=String.fromCharCode(u),p}};if(t.exports=n,typeof L=="object"){L.Polyline.prototype.fromEncoded||(L.Polyline.fromEncoded=function(l,u){return L.polyline(n.decode(l),u)}),L.Polygon.prototype.fromEncoded||(L.Polygon.fromEncoded=function(l,u){return L.polygon(n.decode(l),u)});var s={encodePath:function(){return n.encode(this.getLatLngs())}};L.Polyline.prototype.encodePath||L.Polyline.include(s),L.Polygon.prototype.encodePath||L.Polygon.include(s),L.PolylineUtil=n}})()})(ZM)),ZM.exports}var hbe=dbe();const fbe=Wx(hbe),pbe="pk.eyJ1IjoicGFoaXYiLCJhIjoiY21ocm1pbDl6MDlxbDJxc2RmZTFxanhhdyJ9.0NYhap2uwOXs6slRCnKS4g";Na.accessToken=pbe;const Az=["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#14b8a6","#f97316","#ec4899"],mbe=({route:t,isOpen:e})=>{const n=he.useRef(null),s=he.useRef(null),l=he.useRef([]),[u,p]=he.useState(!1);return he.useEffect(()=>{if(!(!e||!n.current))return s.current&&(l.current.forEach(r=>r.remove()),l.current=[],s.current.remove(),s.current=null),s.current=new Na.Map({container:n.current,style:"mapbox://styles/mapbox/dark-v11",center:[0,0],zoom:10,pitch:0,bearing:0}),s.current.on("load",()=>{if(p(!0),!s.current)return;const r=new Na.LngLatBounds;let v=!1;t.legs.forEach((w,E)=>{var k,R,D;const T=Az[E%Az.length];if(w.polyline)try{const F=fbe.decode(w.polyline).map(([W,K])=>[K,W]);F.forEach(W=>{r.extend(W),v=!0});const U=`route-${E}`,X=`route-layer-${E}`;(k=s.current)!=null&&k.getSource(U)||((R=s.current)==null||R.addSource(U,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:F}}}),(D=s.current)==null||D.addLayer({id:X,type:"line",source:U,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":T,"line-width":5,"line-opacity":.9}}))}catch(O){console.warn("Failed to decode polyline for leg",E,O)}if(w.startLocation){r.extend([w.startLocation.lng,w.startLocation.lat]),v=!0;const O=document.createElement("div");O.style.width="20px",O.style.height="20px",O.style.borderRadius="50%",O.style.backgroundColor=T,O.style.border="3px solid white",O.style.boxShadow=`0 2px 8px ${T}80`;const F=new Na.Marker(O).setLngLat([w.startLocation.lng,w.startLocation.lat]).addTo(s.current);l.current.push(F)}if(w.endLocation&&E===t.legs.length-1){r.extend([w.endLocation.lng,w.endLocation.lat]),v=!0;const O=document.createElement("div");O.style.width="24px",O.style.height="24px",O.style.borderRadius="50%",O.style.backgroundColor="#ef4444",O.style.border="4px solid white",O.style.boxShadow="0 4px 16px rgba(239,68,68,0.6)";const F=new Na.Marker(O).setLngLat([w.endLocation.lng,w.endLocation.lat]).addTo(s.current);l.current.push(F)}}),v&&!r.isEmpty()&&s.current.fitBounds(r,{padding:{top:50,bottom:50,left:50,right:50},duration:1500,maxZoom:15}),s.current.addControl(new Na.NavigationControl,"top-right")}),()=>{l.current.forEach(r=>r.remove()),l.current=[],s.current&&(s.current.remove(),s.current=null),p(!1)}},[e,t]),e?f.jsxs("div",{className:"relative w-full h-[500px] overflow-hidden rounded-xl",children:[f.jsx("div",{ref:n,className:"absolute inset-0 w-full h-full",style:{borderRadius:"0.75rem"}}),!u&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",style:{backgroundColor:"transparent"},children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent"})}),u&&f.jsx("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:f.jsxs("div",{className:"p-3 rounded-lg backdrop-blur-xl bg-white/10 border border-white/20 shadow-xl",children:[f.jsx("h3",{className:"text-sm font-bold text-white mb-1",children:t.summary}),f.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/80",children:[f.jsx(Mv,{className:"w-3 h-3"}),f.jsxs("span",{children:[t.totalDistance,"  ",t.totalDuration]})]})]})})]}):null},gbe={"ZTM Warszawa":{url:"https://www.wtp.waw.pl/en/ticket-offer/",provider:"ZTM Warszawa",displayName:"ZTM Warsaw Ticket"},"Metro Warszawskie":{url:"https://www.metro.waw.pl/en/passenger-information/tickets/",provider:"Metro Warszawskie",displayName:"Metro Warsaw Ticket"},"PKP Intercity":{url:"https://www.intercity.pl/en/",provider:"PKP Intercity",displayName:"PKP Intercity Ticket"},PKP:{url:"https://www.intercity.pl/en/",provider:"PKP",displayName:"PKP Ticket"},"Koleje Mazowieckie":{url:"https://www.mazowieckie.com.pl/en",provider:"Koleje Mazowieckie",displayName:"KM Ticket"},"Koleje lskie":{url:"https://www.koleje-slaskie.eu/en/",provider:"Koleje lskie",displayName:"K Ticket"},MZK:{url:"https://www.google.com/search?q=MZK+ticket",provider:"MZK",displayName:"MZK Ticket"},MPK:{url:"https://www.google.com/search?q=MPK+ticket",provider:"MPK",displayName:"MPK Ticket"}},ybe={BUS:{url:"https://jakdojade.pl/",provider:"JakDojade",displayName:"Bus Ticket"},TRAM:{url:"https://jakdojade.pl/",provider:"JakDojade",displayName:"Tram Ticket"},SUBWAY:{url:"https://jakdojade.pl/",provider:"JakDojade",displayName:"Metro Ticket"},METRO:{url:"https://jakdojade.pl/",provider:"JakDojade",displayName:"Metro Ticket"},RAIL:{url:"https://www.intercity.pl/en/",provider:"PKP Intercity",displayName:"Train Ticket"},TRAIN:{url:"https://www.intercity.pl/en/",provider:"PKP Intercity",displayName:"Train Ticket"},HEAVY_RAIL:{url:"https://www.intercity.pl/en/",provider:"PKP Intercity",displayName:"Train Ticket"},COMMUTER_TRAIN:{url:"https://www.mazowieckie.com.pl/en",provider:"Koleje Mazowieckie",displayName:"Regional Train Ticket"}};function Cz(t){if(t.mode==="WALKING"||t.mode==="DRIVING"||!t.transitDetails)return null;const e=t.transitDetails.line.agencies||[];for(const s of e){const l=s.name;for(const[u,p]of Object.entries(gbe))if(l.toLowerCase().includes(u.toLowerCase()))return p}const n=t.transitDetails.line.vehicle.type.toUpperCase();for(const[s,l]of Object.entries(ybe))if(n.includes(s))return l;return{url:"https://jakdojade.pl/",provider:"JakDojade",displayName:"Buy Ticket"}}const xbe=(t,e)=>{if(t==="WALKING")return h0e;switch((e==null?void 0:e.toUpperCase())||"BUS"){case"BUS":return EB;case"TRAIN":case"RAIL":case"HEAVY_RAIL":return Nw;case"TRAM":return Nw;default:return EB}},_be=(t,e)=>{if(t==="WALKING")return"bg-gray-500/20 text-gray-400 border-gray-500/30";switch((e==null?void 0:e.toUpperCase())||"BUS"){case"BUS":return"bg-green-500/20 text-green-400 border-green-500/30";case"TRAIN":case"RAIL":case"HEAVY_RAIL":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"TRAM":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-blue-500/20 text-blue-400 border-blue-500/30"}},C1=t=>{var n;const e=((n=t.legs)==null?void 0:n.filter(s=>s.mode==="TRANSIT").length)||0;return Math.max(0,e-1)},Mz=t=>{const e=t.match(/(\d+)\s*h/i),n=t.match(/(\d+)\s*min/i);return(e?parseInt(e[1])*60:0)+(n?parseInt(n[1]):0)},vbe=t=>{const e=t.match(/([\d.]+)\s*km/i),n=t.match(/([\d.]+)\s*m(?!i)/i);return e?parseFloat(e[1]):n?parseFloat(n[1])/1e3:0},cT=t=>{var s,l,u,p,r,v,w,E,T,k;const e=((s=t.legs)==null?void 0:s.filter(R=>R.mode==="TRANSIT"))||[];let n=0;for(const R of e){const D=((r=(p=(u=(l=R.transitDetails)==null?void 0:l.line)==null?void 0:u.vehicle)==null?void 0:p.type)==null?void 0:r.toUpperCase())||"BUS",O=vbe(R.distance||"0"),F=((k=(T=(E=(w=(v=R.transitDetails)==null?void 0:v.line)==null?void 0:w.agencies)==null?void 0:E[0])==null?void 0:T.name)==null?void 0:k.toLowerCase())||"";F.includes("ztm")||F.includes("metro")?n+=4.4:D.includes("TRAIN")||D.includes("RAIL")||D.includes("HEAVY")?n+=10+O*.15:F.includes("koleje")||F.includes("km")?n+=5+O*.1:D==="BUS"||D==="TRAM"?n+=4:n+=5}return Math.round(n)},bbe=t=>{var s;const e=((s=t.legs)==null?void 0:s.filter(l=>l.mode==="TRANSIT"))||[];return e.length===0?"Walking route":e.map(l=>{var v,w,E,T,k,R,D,O;const u=((T=(E=(w=(v=l.transitDetails)==null?void 0:v.line)==null?void 0:w.vehicle)==null?void 0:E.type)==null?void 0:T.toUpperCase())||"BUS",p=((R=(k=l.transitDetails)==null?void 0:k.line)==null?void 0:R.shortName)||((O=(D=l.transitDetails)==null?void 0:D.line)==null?void 0:O.name)||"";let r="";return u.includes("SUBWAY")||u.includes("METRO")?r="":u.includes("TRAIN")||u.includes("RAIL")?r="":u.includes("TRAM")&&(r=""),p?`${r}${p}`:r}).join("  ")},wbe=({transitParams:t})=>{const e=new URLSearchParams(window.location.search),n=e.get("to")||"",s=e.get("lat"),l=e.get("lng"),[u,p]=he.useState(""),[r,v]=he.useState((t==null?void 0:t.to)||n||""),[w,E]=he.useState(""),[T,k]=he.useState([]),[R,D]=he.useState(!1),[O,F]=he.useState(null),[U,X]=he.useState(),[W,K]=he.useState(null),[ne,te]=he.useState(null),[re,xe]=he.useState(null),{user:ae}=ba(),{user:ce}=El(),ye=ae||ce,[Ce,Me]=he.useState(null);he.useEffect(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(yt=>{X({lat:yt.coords.latitude,lng:yt.coords.longitude}),u||p(`${yt.coords.latitude.toFixed(4)}, ${yt.coords.longitude.toFixed(4)}`)},()=>{X({lat:52.2297,lng:21.0122})}):X({lat:52.2297,lng:21.0122});const st=(t==null?void 0:t.to)||n,bt=(t==null?void 0:t.toCoords)||(s&&l?{}:null);st&&bt&&(v(st),setTimeout(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(yt=>{X({lat:yt.coords.latitude,lng:yt.coords.longitude}),p(`${yt.coords.latitude.toFixed(4)}, ${yt.coords.longitude.toFixed(4)}`),setTimeout(()=>{Ke()},1e3)},()=>{X({lat:52.2297,lng:21.0122}),p("52.2297, 21.0122"),setTimeout(()=>{Ke()},1e3)})},500))},[]),he.useEffect(()=>{t!=null&&t.to&&(t!=null&&t.toCoords)&&U?(v(t.to),setTimeout(()=>{U&&(p(`${U.lat.toFixed(4)}, ${U.lng.toFixed(4)}`),setTimeout(()=>{Ke()},500))},1e3)):n&&s&&l&&U&&(v(n),setTimeout(()=>{U&&(p(`${U.lat.toFixed(4)}, ${U.lng.toFixed(4)}`),setTimeout(()=>{Ke()},500))},1e3))},[t,U]);const Ke=async()=>{if(!u||!r){F('Please fill in both "From" and "To" fields');return}D(!0),F(null),k([]),K(null),te(null);try{const st=w?new Date(w):void 0,bt=await ube(u,r,st);if(bt.length===0)F("No routes found. Try different locations or check your input.");else{const yt=[...bt].sort((Vt,_t)=>{const vt=Mz(Vt.totalDuration),qt=Mz(_t.totalDuration),kt=cT(Vt),on=cT(_t);return vt!==qt?vt-qt:kt-on});k(yt),console.log(`Found ${yt.length} routes (sorted by fastest then cheapest)`)}}catch(st){console.error("Transit search error:",st),F(st.message||"Failed to search routes. Please try again.")}finally{D(!1)}},ke=async st=>{try{return await zW(st,U)}catch(bt){return console.error("Error getting place suggestions:",bt),[]}},je=st=>{K(W===st?null:st),te(null)},$e=st=>{xe(re===st?null:st)},Ae=async(st,bt)=>{if(!ye){alert("Please log in to save routes");return}Me(bt);try{const{error:yt}=await Kt.from("saved_routes").insert({user_id:ye.id,from_location:u,to_location:r,route_data:st,departure_time:st.departureTime,arrival_time:st.arrivalTime,total_duration:st.totalDuration,total_distance:st.totalDistance});if(yt)throw yt;alert("Route saved successfully!")}catch(yt){console.error("Error saving route:",yt),alert("Failed to save route: "+yt.message)}finally{Me(null)}},He=(st,bt,yt)=>{const Vt=[],vt=yt.map(Un=>cT(Un)),qt=Math.min(...vt),kt=vt.indexOf(qt),on=C1(st),mn=yt.map(Un=>C1(Un)),Hr=Math.min(...mn);return bt===0&&Vt.push({label:" Fastest",color:"from-green-500/30 to-emerald-500/30 border-green-400/40 text-green-300"}),(bt===kt||vt[bt]===qt)&&Vt.push({label:" Cheapest",color:"from-amber-500/30 to-yellow-500/30 border-amber-400/40 text-amber-300"}),on===Hr&&on<2&&Vt.push({label:" Fewest Transfers",color:"from-blue-500/30 to-indigo-500/30 border-blue-400/40 text-blue-300"}),bt===0?{type:"Fastest",color:"from-green-500/30 to-emerald-500/30 border-green-400/40 text-green-300",icon:md,badges:Vt}:bt===kt||vt[bt]===qt?{type:"Cheapest",color:"from-amber-500/30 to-yellow-500/30 border-amber-400/40 text-amber-300",icon:id,badges:Vt}:{type:"Alternative",color:"from-purple-500/30 to-pink-500/30 border-purple-400/40 text-purple-300",icon:g0e,badges:Vt}},qe=st=>{const bt=st.legs.some(_t=>{var vt,qt,kt,on,mn,Hr,Un,$r;return((on=(kt=(qt=(vt=_t.transitDetails)==null?void 0:vt.line)==null?void 0:qt.vehicle)==null?void 0:kt.type)==null?void 0:on.toUpperCase().includes("SUBWAY"))||(($r=(Un=(Hr=(mn=_t.transitDetails)==null?void 0:mn.line)==null?void 0:Hr.vehicle)==null?void 0:Un.type)==null?void 0:$r.toUpperCase().includes("METRO"))}),yt=st.legs.some(_t=>{var vt,qt,kt,on;return(on=(kt=(qt=(vt=_t.transitDetails)==null?void 0:vt.line)==null?void 0:qt.vehicle)==null?void 0:kt.type)==null?void 0:on.toUpperCase().includes("BUS")}),Vt=st.legs.some(_t=>{var vt,qt,kt,on,mn,Hr,Un,$r;return((on=(kt=(qt=(vt=_t.transitDetails)==null?void 0:vt.line)==null?void 0:qt.vehicle)==null?void 0:kt.type)==null?void 0:on.toUpperCase().includes("TRAIN"))||(($r=(Un=(Hr=(mn=_t.transitDetails)==null?void 0:mn.line)==null?void 0:Hr.vehicle)==null?void 0:Un.type)==null?void 0:$r.toUpperCase().includes("RAIL"))});return u.toLowerCase().includes("warsaw")||r.toLowerCase().includes("warsaw")||u.toLowerCase().includes("warszawa")||r.toLowerCase().includes("warszawa")?"https://www.wtp.waw.pl/en/ticket-offer/":Vt?"https://www.intercity.pl/":bt||yt?"https://jakdojade.pl/":"https://www.google.com/search?q=buy+public+transport+ticket"},Le=st=>{te(ne===st?null:st)};return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 relative z-10",children:[f.jsx(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx(it.div,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.95},className:"w-12 h-12 backdrop-blur-xl bg-gradient-to-br from-blue-400/80 to-indigo-500/80 rounded-xl flex items-center justify-center shadow-[0_8px_24px_rgba(79,70,229,0.3)] border border-white/[0.15]",children:f.jsx(Nw,{className:"w-6 h-6 text-white"})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:"Transit Planner"}),f.jsx("p",{className:"text-white",style:{textShadow:"0 1px 5px rgba(0,0,0,0.5)"},children:"Find public transport connections"})]})]})}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-2xl backdrop-blur-xl bg-white/[0.03] border border-white/[0.08] p-6 shadow-[0_8px_32px_rgba(0,0,0,0.12)]",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[f.jsx(mI,{label:"From",value:u,onChange:p,getSuggestions:ke,placeholder:"e.g., Warsaw Central Station"}),f.jsx(mI,{label:"To",value:r,onChange:v,getSuggestions:ke,placeholder:"e.g., Krakow Main Square"})]}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-white mb-2",children:[f.jsx(ig,{className:"w-4 h-4 text-teal-400"}),"Departure Date & Time (optional)"]}),f.jsx("div",{className:"relative",children:f.jsx(it.input,{whileFocus:{scale:1.01},type:"datetime-local",value:w,onChange:st=>E(st.target.value),className:"w-full backdrop-blur-lg bg-white/[0.03] border border-white/[0.08] rounded-xl px-4 py-3 pr-12 text-white placeholder-white/40 focus:outline-none focus:border-white/[0.15] focus:bg-white/[0.05] transition-all duration-300"})})]}),O&&f.jsx(it.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 rounded-xl backdrop-blur-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:O}),f.jsx(it.button,{onClick:Ke,disabled:R,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},className:"w-full relative overflow-hidden py-4 rounded-xl backdrop-blur-xl bg-gradient-to-r from-blue-500/90 to-indigo-500/90 border border-white/[0.15] text-white font-semibold shadow-[0_8px_24px_rgba(79,70,229,0.3)] hover:shadow-[0_12px_32px_rgba(79,70,229,0.4)] transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:f.jsx("span",{className:"relative flex items-center gap-2",children:R?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-5 h-5 animate-spin"}),"Searching..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Nw,{className:"w-5 h-5"}),"Find Connections"]})})})]}),T.length>0&&f.jsx("div",{className:"space-y-4",children:T.map((st,bt)=>f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:bt*.1},className:"rounded-2xl backdrop-blur-xl bg-white/[0.03] border border-white/[0.08] overflow-hidden shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_12px_48px_rgba(0,0,0,0.16)] transition-all duration-300",children:[f.jsxs("div",{className:"p-6",children:[f.jsx("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-white/[0.08]",children:f.jsxs("div",{className:"flex-1",children:[f.jsx("div",{className:"flex items-center gap-3 mb-3",children:f.jsx("h3",{className:"text-xl font-bold text-white",style:{textShadow:"0 2px 8px rgba(0,0,0,0.5)"},children:bbe(st)})}),f.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-3",children:[f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-lg bg-blue-500/10 border border-blue-500/20",children:[f.jsx(nh,{className:"w-5 h-5 text-blue-400"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-blue-300/70",children:"Duration"}),f.jsx("div",{className:"text-sm font-bold text-blue-300",children:st.totalDuration})]})]}),f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-lg bg-purple-500/10 border border-purple-500/20",children:[f.jsx(Mv,{className:"w-5 h-5 text-purple-400"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-purple-300/70",children:"Distance"}),f.jsx("div",{className:"text-sm font-bold text-purple-300",children:st.totalDistance})]})]}),f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-lg bg-orange-500/10 border border-orange-500/20",children:[f.jsx(Sx,{className:"w-5 h-5 text-orange-400"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-orange-300/70",children:"Transfers"}),f.jsx("div",{className:"text-sm font-bold text-orange-300",children:C1(st)===0?"Direct":`${C1(st)} transfer${C1(st)>1?"s":""}`})]})]}),f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-lg bg-green-500/10 border border-green-500/20",children:[f.jsx(id,{className:"w-5 h-5 text-green-400"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-green-300/70",children:"Est. Cost"}),f.jsxs("div",{className:"text-sm font-bold text-green-300",children:["~",cT(st)," PLN"]})]})]})]}),f.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[f.jsx(nh,{className:"w-4 h-4 text-green-400"}),f.jsx("span",{className:"font-medium",children:st.departureTime}),f.jsx(Sx,{className:"w-4 h-4 text-white/40"}),f.jsx(nh,{className:"w-4 h-4 text-red-400"}),f.jsx("span",{className:"font-medium",children:st.arrivalTime})]})]})}),f.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:He(st,bt,T).badges.map((Vt,_t)=>f.jsx(it.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:bt*.1+_t*.05,type:"spring",stiffness:200},whileHover:{scale:1.05,y:-2},className:`px-4 py-2 rounded-full text-xs font-semibold backdrop-blur-lg border bg-gradient-to-r ${Vt.color} shadow-lg`,children:f.jsx("span",{children:Vt.label})},_t))}),f.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.jsxs(it.a,{href:qe(st),target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-lg bg-gradient-to-r from-green-500/30 to-emerald-500/30 border border-green-400/40 text-green-300 hover:from-green-500/40 hover:to-emerald-500/40 transition-all duration-300 shadow-lg",children:[f.jsx(id,{className:"w-4 h-4"}),f.jsx("span",{className:"text-sm font-medium",children:"Buy Ticket"}),f.jsx(Jo,{className:"w-3 h-3"})]}),ye&&f.jsxs(it.button,{onClick:()=>Ae(st,bt),disabled:Ce===bt,whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-lg bg-gradient-to-r from-yellow-500/30 to-orange-500/30 border border-yellow-400/40 text-yellow-300 hover:from-yellow-500/40 hover:to-orange-500/40 transition-all duration-300 shadow-lg disabled:opacity-50",children:[Ce===bt?f.jsx(va,{className:"w-4 h-4 animate-spin"}):f.jsx(o0e,{className:"w-4 h-4"}),f.jsx("span",{className:"text-sm font-medium",children:"Save"})]}),f.jsxs(it.button,{onClick:()=>$e(bt),whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-lg bg-gradient-to-r from-blue-500/30 to-indigo-500/30 border border-blue-400/40 text-blue-300 hover:from-blue-500/40 hover:to-indigo-500/40 transition-all duration-300 shadow-lg",children:[f.jsx(VA,{className:"w-4 h-4"}),f.jsx("span",{className:"text-sm font-medium",children:re===bt?"Hide Map":"View Map"})]}),f.jsx(it.button,{onClick:()=>je(bt),whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-lg bg-white/5 border border-white/10 text-white/70 hover:bg-white/10 transition-all duration-300",children:f.jsx("span",{className:"text-sm font-medium",children:W===bt?"Hide Details":"Show Details"})})]}),f.jsx(Xc,{children:W===bt&&st.legs&&f.jsx(it.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-3 mt-4",children:st.legs.map((yt,Vt)=>{var qt,kt,on,mn,Hr,Un,$r,ht,Lr,Br,wn,Nn;const _t=xbe(yt.mode,(on=(kt=(qt=yt.transitDetails)==null?void 0:qt.line)==null?void 0:kt.vehicle)==null?void 0:on.type),vt=_be(yt.mode,(Un=(Hr=(mn=yt.transitDetails)==null?void 0:mn.line)==null?void 0:Hr.vehicle)==null?void 0:Un.type);return f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Vt*.05},className:"rounded-xl backdrop-blur-lg bg-white/[0.02] border border-white/[0.05] hover:bg-white/[0.04] transition-all duration-300 overflow-hidden",children:[f.jsxs("div",{onClick:()=>yt.mode==="TRANSIT"&&Le(Vt),className:`flex items-start gap-3 p-4 ${yt.mode==="TRANSIT"?"cursor-pointer":""}`,children:[f.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center border ${vt}`,children:f.jsx(_t,{className:"w-5 h-5"})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("h4",{className:"text-sm font-semibold text-white",children:yt.mode==="WALKING"?"Walk":((ht=($r=yt.transitDetails)==null?void 0:$r.line)==null?void 0:ht.shortName)||((Br=(Lr=yt.transitDetails)==null?void 0:Lr.line)==null?void 0:Br.name)||yt.mode}),f.jsx("span",{className:"text-xs text-white/50",children:yt.duration})]}),f.jsx("p",{className:"text-xs text-white/70 mb-2",children:yt.instructions}),yt.transitDetails&&f.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md backdrop-blur-lg bg-white/[0.05] text-white/60",children:[f.jsx(Mo,{className:"w-3 h-3"}),(wn=yt.transitDetails.departureStop)==null?void 0:wn.name]}),f.jsx(Sx,{className:"w-3 h-3 text-white/40"}),f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md backdrop-blur-lg bg-white/[0.05] text-white/60",children:[f.jsx(Mo,{className:"w-3 h-3"}),(Nn=yt.transitDetails.arrivalStop)==null?void 0:Nn.name]}),f.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md backdrop-blur-lg bg-white/[0.05] text-white/60",children:[f.jsx(nh,{className:"w-3 h-3"}),yt.transitDetails.departureTime,"  ",yt.transitDetails.arrivalTime]}),yt.transitDetails.numStops>0&&f.jsxs("div",{className:"px-2 py-1 rounded-md backdrop-blur-lg bg-white/[0.05] text-white/60",children:[yt.transitDetails.numStops," stops"]}),yt.transitDetails.headsign&&f.jsxs("div",{className:"px-2 py-1 rounded-md backdrop-blur-lg bg-white/[0.05] text-white/60 italic",children:[" ",yt.transitDetails.headsign]})]}),yt.mode==="TRANSIT"&&(()=>{const mr=Cz(yt);return mr?f.jsxs(it.a,{href:mr.url,target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center gap-1.5 mt-2 px-3 py-1.5 rounded-lg backdrop-blur-lg bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-400/30 text-green-300 hover:from-green-500/30 hover:to-emerald-500/30 transition-all duration-300 text-xs font-medium",children:[f.jsx(id,{className:"w-3.5 h-3.5"}),f.jsx("span",{children:mr.displayName}),f.jsx(Jo,{className:"w-3 h-3"})]}):null})()]})]}),f.jsx(Xc,{children:ne===Vt&&yt.transitDetails&&f.jsx(it.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"px-4 pb-4 border-t border-white/[0.05]",children:f.jsxs("div",{className:"mt-3 p-3 rounded-lg backdrop-blur-lg bg-white/[0.02] space-y-2",children:[f.jsxs("div",{className:"text-xs text-white/70",children:[f.jsx("span",{className:"font-semibold text-white",children:"Line:"})," ",yt.transitDetails.line.name]}),yt.transitDetails.line.agencies&&yt.transitDetails.line.agencies.length>0&&f.jsxs("div",{className:"text-xs text-white/70",children:[f.jsx("span",{className:"font-semibold text-white",children:"Operator:"})," ",yt.transitDetails.line.agencies[0].name]}),f.jsxs("div",{className:"text-xs text-white/70",children:[f.jsx("span",{className:"font-semibold text-white",children:"Vehicle:"})," ",yt.transitDetails.line.vehicle.type]}),f.jsxs("div",{className:"text-xs text-white/70",children:[f.jsx("span",{className:"font-semibold text-white",children:"Distance:"})," ",yt.distance]}),(()=>{const mr=Cz(yt);return mr?f.jsx("div",{className:"pt-2 mt-2 border-t border-white/[0.05]",children:f.jsxs(it.a,{href:mr.url,target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-lg bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-400/30 text-green-300 hover:from-green-500/30 hover:to-emerald-500/30 transition-all duration-300 text-xs font-medium w-full justify-center",children:[f.jsx(id,{className:"w-4 h-4"}),f.jsxs("span",{children:["Buy ",mr.displayName," from ",mr.provider]}),f.jsx(Jo,{className:"w-3 h-3"})]})}):null})()]})})})]},Vt)})})})]}),re===bt&&f.jsx("div",{className:"border-t border-white/[0.08] relative",style:{backgroundColor:"transparent"},children:f.jsx("div",{className:"h-[500px] w-full relative",children:f.jsx(mbe,{route:st,isOpen:!0})})})]},bt))}),R&&T.length===0&&f.jsxs(it.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl backdrop-blur-xl bg-white/[0.03] border border-white/[0.08] p-12 text-center shadow-[0_8px_32px_rgba(0,0,0,0.12)]",children:[f.jsx(va,{className:"w-12 h-12 animate-spin mx-auto mb-4 text-blue-400"}),f.jsx("p",{className:"text-white",children:"Searching for best connections..."})]})]})})},Sbe="0x6819143a95aeed963348b5f1e9c9405999bd1588";function nl(){return Sbe}async function Tbe(t){try{const e=t||nl();console.log("[AdminService] getAdminStats - Using Supabase directly");const[n,s,l,u,p,r,v,w,E,T]=await Promise.all([Kt.from("users").select("id",{count:"exact",head:!0}),Kt.from("users").select("id",{count:"exact",head:!0}).gte("last_active_at",new Date(Date.now()-10080*60*1e3).toISOString()),Kt.from("quests").select("id",{count:"exact",head:!0}),Kt.from("user_quests").select("id",{count:"exact",head:!0}).eq("status","completed"),Kt.from("trips").select("id",{count:"exact",head:!0}),Kt.from("token_transactions").select("id",{count:"exact",head:!0}),Kt.from("nft_passports").select("id",{count:"exact",head:!0}),Kt.from("token_transactions").select(`
          *,
          users:user_id (
            id,
            username,
            wallet_address
          )
        `).order("created_at",{ascending:!1}).limit(10),Kt.from("user_quests").select(`
          *,
          users:user_id (
            id,
            username,
            wallet_address
          ),
          quests:quest_id (
            id,
            title
          )
        `).eq("status","completed").order("completed_at",{ascending:!1}).limit(10),Kt.from("trips").select(`
          *,
          users:user_id (
            id,
            username,
            wallet_address
          )
        `).order("created_at",{ascending:!1}).limit(10)]),{data:k}=await Kt.from("token_transactions").select("amount, transaction_type").eq("status","confirmed"),R=(k==null?void 0:k.reduce((F,U)=>{var X;return F+(parseFloat(((X=U.amount)==null?void 0:X.toString())||"0")||0)},0))||0,D=(k==null?void 0:k.filter(F=>F.transaction_type==="mint"||F.transaction_type==="reward").reduce((F,U)=>{var X;return F+(parseFloat(((X=U.amount)==null?void 0:X.toString())||"0")||0)},0))||0;return{stats:{totalUsers:n.count||0,activeUsers:s.count||0,totalQuests:l.count||0,completedQuests:u.count||0,totalTrips:p.count||0,totalTPXTransfers:R,totalTPXMinted:D,totalNFTPassports:v.count||0,totalTransactions:r.count||0,recentActivity:[],recentTransactions:w.data||[],recentQuestCompletions:E.data||[],recentTrips:T.data||[],systemHealth:{database:"healthy",api:"healthy",blockchain:"healthy"}}}}catch(e){throw console.error("Error fetching admin stats:",e),e}}async function Ebe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||20,l=(t==null?void 0:t.offset)||0,u=(t==null?void 0:t.sortBy)||"created_at",p=(t==null?void 0:t.sortOrder)||"desc";console.log("[AdminService] getAllUsers - Using Supabase directly",{params:t});let r=Kt.from("users").select("*",{count:"exact"});if(t!=null&&t.search){const O=t.search.toLowerCase();r=r.or(`wallet_address.ilike.%${O}%,email.ilike.%${O}%,username.ilike.%${O}%`)}r=r.order(u,{ascending:p==="asc"}),r=r.range(l,l+s-1);const{data:v,error:w,count:E}=await r;if(w)throw console.error("[AdminService] getAllUsers - Error:",w),new Error(w.message||"Failed to fetch users");const T=(v||[]).map(O=>O.id),{data:k}=await Kt.from("user_sessions").select("user_id, country, city, ip_address, device_type, os, browser, os_info, browser_info, created_at").in("user_id",T).order("created_at",{ascending:!1}),R={};return k==null||k.forEach(O=>{(!R[O.user_id]||new Date(O.created_at)>new Date(R[O.user_id].created_at))&&(R[O.user_id]=O)}),{users:(v||[]).map(O=>{var U,X,W;const F=R[O.id];return{id:O.id,wallet_address:O.wallet_address,email:O.email,username:O.username,total_xp:O.total_xp||0,level:O.level||1,passport_tier:O.passport_tier||"bronze",quests_completed:O.quests_completed||0,total_tokens_earned:parseFloat(((U=O.total_tokens_earned)==null?void 0:U.toString())||"0")||0,created_at:O.created_at,last_active_at:O.last_active_at,countries_visited:O.countries_visited||[],cities_visited:O.cities_visited||[],is_banned:O.is_banned||!1,osint:F?{country:F.country,city:F.city,ip_address:F.ip_address,device_type:F.device_type,os:F.os||((X=F.os_info)==null?void 0:X.name),browser:F.browser||((W=F.browser_info)==null?void 0:W.name),os_info:F.os_info,browser_info:F.browser_info}:null}}),total:E||0}}catch(n){throw console.error("Error fetching users:",n),n}}async function Abe(t,e){var n;try{const s=e||nl();console.log("[AdminService] getUserDetails - Using Supabase directly",{userId:t});const{data:l,error:u}=await Kt.from("users").select("*").eq("id",t).single();if(u)throw new Error(u.message||"Failed to fetch user");const[p,r,v,w,E,T]=await Promise.all([Kt.from("user_quests").select(`
          *,
          quests:quest_id (
            id,
            title,
            description
          )
        `).eq("user_id",t),Kt.from("trips").select("*").eq("user_id",t),Kt.from("token_transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(50),Kt.from("user_achievements").select(`
          *,
          achievements:achievement_id (
            id,
            title,
            description
          )
        `).eq("user_id",t),Kt.from("user_sessions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(50),Kt.from("user_activity_events").select("*").eq("user_id",t).order("timestamp",{ascending:!1}).limit(100)]),k=E.data||[],R=T.data||[],D=[...new Set(k.map(re=>re.country).filter(Boolean))],O=[...new Set(k.map(re=>re.city).filter(Boolean))],F=[...new Set(k.map(re=>re.ip_address).filter(Boolean))],U=[...new Set(k.map(re=>re.fingerprint_hash||re.fingerprint).filter(Boolean))],X=[...new Set(k.map(re=>re.device_type).filter(Boolean))],W=[...new Set(k.map(re=>re.os).filter(Boolean))],K=[...new Set(k.map(re=>re.browser).filter(Boolean))],ne=k[0]||null,te={totalSessions:k.length,activeSessions:k.filter(re=>re.is_active).length,uniqueCountries:D.length,uniqueCities:O.length,uniqueIPs:F.length,uniqueFingerprints:U.length,uniqueDevices:X.length,uniqueOS:W.length,uniqueBrowsers:K.length,totalActivityEvents:R.length,firstSeen:k.length>0?(n=k[k.length-1])==null?void 0:n.created_at:null,lastSeen:(ne==null?void 0:ne.last_activity_at)||(ne==null?void 0:ne.created_at)||null};return{user:l,quests:p.data||[],trips:r.data||[],transactions:v.data||[],achievements:w.data||[],sessions:k,activities:R,osint:{stats:te,mostRecentSession:ne,uniqueCountries:D,uniqueCities:O,uniqueIPs:F,uniqueFingerprints:U,uniqueDevices:X,uniqueOS:W,uniqueBrowsers:K,allSessions:k,allActivities:R}}}catch(s){throw console.error("Error fetching user details:",s),s}}async function Cbe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||100,l=(t==null?void 0:t.offset)||0;console.log("[AdminService] getActivityLog - Using Supabase directly",{params:t});let u=Kt.from("user_activity_events").select(`
        *,
        users:user_id (
          username,
          wallet_address
        )
      `,{count:"exact"});t!=null&&t.userId&&(u=u.eq("user_id",t.userId)),t!=null&&t.actionType&&(u=u.eq("event_type",t.actionType)),t!=null&&t.startDate&&(u=u.gte("timestamp",t.startDate)),t!=null&&t.endDate&&(u=u.lte("timestamp",t.endDate)),u=u.order("timestamp",{ascending:!1}),u=u.range(l,l+s-1);const p=await u;if(p.error){console.error("[AdminService] getActivityLog - Error:",p.error),console.log("[AdminService] Trying admin_activity_log as fallback...");let T=Kt.from("admin_activity_log").select(`
          *,
          users:user_id (
            username,
            wallet_address
          )
        `,{count:"exact"});t!=null&&t.userId&&(T=T.eq("user_id",t.userId)),t!=null&&t.actionType&&(T=T.eq("action_type",t.actionType)),t!=null&&t.startDate&&(T=T.gte("timestamp",t.startDate)),t!=null&&t.endDate&&(T=T.lte("timestamp",t.endDate)),T=T.order("timestamp",{ascending:!1}),T=T.range(l,l+s-1);const k=await T;if(k.error)throw new Error(k.error.message||"Failed to fetch activity log");return{logs:(k.data||[]).map(D=>{var O,F;return{id:D.id,user_id:D.user_id,action_type:D.action_type,action_details:D.action_details,ip_address:D.ip_address,user_agent:D.user_agent,fingerprint_hash:D.fingerprint_hash,country:D.country,city:D.city,device_type:D.device_type,os_info:D.os_info,browser_info:D.browser_info,action_timestamp:D.timestamp||D.action_timestamp,timestamp:D.timestamp||D.action_timestamp,username:((O=D.users)==null?void 0:O.username)||null,wallet_address:((F=D.users)==null?void 0:F.wallet_address)||null}}),total:k.count||0}}const r=(p.data||[]).map(T=>{var k,R;return{id:T.id,user_id:T.user_id,action_type:T.event_type||T.action_type,action_details:T.event_data||T.action_details,ip_address:T.ip_address,user_agent:T.user_agent,fingerprint_hash:T.fingerprint_hash,country:T.country,city:T.city,device_type:T.device_type,os_info:T.os_info,browser_info:T.browser_info,action_timestamp:T.timestamp||T.action_timestamp,timestamp:T.timestamp||T.action_timestamp,username:((k=T.users)==null?void 0:k.username)||null,wallet_address:((R=T.users)==null?void 0:R.wallet_address)||null}});let v=Kt.from("user_activity_events").select("id",{count:"exact",head:!0});t!=null&&t.userId&&(v=v.eq("user_id",t.userId)),t!=null&&t.actionType&&(v=v.eq("event_type",t.actionType)),t!=null&&t.startDate&&(v=v.gte("timestamp",t.startDate)),t!=null&&t.endDate&&(v=v.lte("timestamp",t.endDate));const{count:w,error:E}=await v;return E&&console.warn("[AdminService] Count query error, using data length:",E),console.log("[AdminService] getActivityLog - Found logs:",r.length,"Total:",w||r.length),{logs:r,total:w||r.length||0}}catch(n){throw console.error("Error fetching activity log:",n),n}}async function Mbe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||50,l=(t==null?void 0:t.offset)||0;console.log("[AdminService] getAllSessions - Using Supabase directly",{params:t});let u=Kt.from("user_sessions").select(`
        *,
        users:user_id (
          id,
          username,
          wallet_address,
          email
        )
      `,{count:"exact"});t!=null&&t.userId&&(u=u.eq("user_id",t.userId)),(t==null?void 0:t.isActive)!==void 0&&(u=u.eq("is_active",t.isActive)),u=u.order("created_at",{ascending:!1}),u=u.range(l,l+s-1);const{data:p,error:r,count:v}=await u;if(r)throw console.error("[AdminService] getAllSessions - Error:",r),new Error(r.message||"Failed to fetch sessions");return console.log("[AdminService] getAllSessions - Found sessions:",(p==null?void 0:p.length)||0,"Total:",v||0),{sessions:p||[],total:v||0}}catch(n){throw console.error("Error fetching sessions:",n),n}}async function kbe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||50,l=(t==null?void 0:t.offset)||0;console.log("[AdminService] getAllQuests - Using Supabase directly",{params:t});let u=Kt.from("quests").select("*",{count:"exact"});(t==null?void 0:t.isActive)!==void 0&&(u=u.eq("is_active",t.isActive)),u=u.order("created_at",{ascending:!1}),u=u.range(l,l+s-1);const{data:p,error:r,count:v}=await u;if(r)throw console.error("[AdminService] getAllQuests - Error:",r),new Error(r.message||"Failed to fetch quests");const[w,E,T]=await Promise.all([Kt.from("quests").select("id",{count:"exact",head:!0}),Kt.from("quests").select("id",{count:"exact",head:!0}).eq("is_active",!0),Kt.from("user_quests").select("id",{count:"exact",head:!0}).eq("status","completed")]),k={total:w.count||0,active:E.count||0,completed:T.count||0};return{quests:p||[],total:v||0,stats:k}}catch(n){throw console.error("Error fetching quests:",n),n}}async function Ibe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||50,l=(t==null?void 0:t.offset)||0;console.log("[AdminService] getAllTrips - Using Supabase directly",{params:t});let u=Kt.from("trips").select(`
        *,
        users:user_id (
          id,
          username,
          wallet_address
        )
      `,{count:"exact"});t!=null&&t.userId&&(u=u.eq("user_id",t.userId)),u=u.order("created_at",{ascending:!1}),u=u.range(l,l+s-1);const{data:p,error:r,count:v}=await u;if(r)throw console.error("[AdminService] getAllTrips - Error:",r),new Error(r.message||"Failed to fetch trips");return{trips:p||[],total:v||0}}catch(n){throw console.error("Error fetching trips:",n),n}}async function Pbe(t,e){try{const n=e||nl(),s=(t==null?void 0:t.limit)||50,l=(t==null?void 0:t.offset)||0;console.log("[AdminService] getAllTransactions - Using Supabase directly",{params:t});let u=Kt.from("token_transactions").select(`
        *,
        users:user_id (
          id,
          username,
          wallet_address
        )
      `,{count:"exact"});t!=null&&t.userId&&(u=u.eq("user_id",t.userId)),t!=null&&t.type&&(u=u.eq("transaction_type",t.type)),t!=null&&t.status&&(u=u.eq("status",t.status)),u=u.order("created_at",{ascending:!1}),u=u.range(l,l+s-1);const{data:p,error:r,count:v}=await u;if(r)throw console.error("[AdminService] getAllTransactions - Error:",r),new Error(r.message||"Failed to fetch transactions");return{transactions:p||[],total:v||0}}catch(n){throw console.error("Error fetching transactions:",n),n}}async function Rbe(t,e,n){try{const s=n||nl(),{error:l}=await Kt.from("users").update({is_banned:!0}).eq("id",t);if(l)throw new Error(l.message||"Failed to ban user")}catch(s){throw console.error("Error banning user:",s),s}}async function Nbe(t,e){try{const n=e||nl(),{error:s}=await Kt.from("users").update({is_banned:!1}).eq("id",t);if(s)throw new Error(s.message||"Failed to unban user")}catch(n){throw console.error("Error unbanning user:",n),n}}async function jbe(t,e,n){try{const s=n||nl(),{data:l,error:u}=await Kt.from("users").update(e).eq("id",t).select().single();if(u)throw new Error(u.message||"Failed to update user");return l}catch(s){throw console.error("Error updating user:",s),s}}async function Dbe(t,e){try{const n=e||nl(),{error:s}=await Kt.from("users").delete().eq("id",t);if(s)throw new Error(s.message||"Failed to delete user")}catch(n){throw console.error("Error deleting user:",n),n}}async function Lbe(t,e,n="add",s,l){var u;try{const p=l||nl(),{data:r,error:v}=await Kt.from("users").select("total_tokens_earned").eq("id",t).single();if(v)throw new Error(v.message||"Failed to fetch user");const w=parseFloat(((u=r.total_tokens_earned)==null?void 0:u.toString())||"0")||0,E=n==="add"?w+e:Math.max(0,w-e),{data:T,error:k}=await Kt.from("users").update({total_tokens_earned:E}).eq("id",t).select().single();if(k)throw new Error(k.message||"Failed to update tokens");return await Kt.from("token_transactions").insert({user_id:t,transaction_type:n==="add"?"admin_adjustment":"admin_deduction",amount:e,status:"confirmed",metadata:{reason:s||"Admin adjustment",admin_wallet:p}}),T}catch(p){throw console.error("Error updating tokens:",p),p}}async function Obe(t,e,n="add",s,l){try{const u=l||nl(),{data:p,error:r}=await Kt.from("users").select("total_xp, level").eq("id",t).single();if(r)throw new Error(r.message||"Failed to fetch user");const v=p.total_xp||0,w=n==="add"?v+e:Math.max(0,v-e),E=Math.floor(Math.sqrt(w)/10)+1,{data:T,error:k}=await Kt.from("users").update({total_xp:w,level:E}).eq("id",t).select().single();if(k)throw new Error(k.message||"Failed to update XP");return T}catch(u){throw console.error("Error updating XP:",u),u}}async function Fbe(t,e){try{const n=e||nl(),{data:s,error:l}=await Kt.from("quests").insert(t).select().single();if(l)throw new Error(l.message||"Failed to create quest");return s}catch(n){throw console.error("Error creating quest:",n),n}}async function Bbe(t,e,n){try{const s=n||nl(),{data:l,error:u}=await Kt.from("quests").update(e).eq("id",t).select().single();if(u)throw new Error(u.message||"Failed to update quest");return l}catch(s){throw console.error("Error updating quest:",s),s}}async function zbe(t,e){try{const n=e||nl(),{error:s}=await Kt.from("quests").delete().eq("id",t);if(s)throw new Error(s.message||"Failed to delete quest")}catch(n){throw console.error("Error deleting quest:",n),n}}async function Ube(t,e){var n,s,l,u,p;try{const r=e||nl(),v=(t==null?void 0:t.dateRange)||"30d",w=v==="7d"?7:v==="30d"?30:v==="90d"?90:365,E=new Date(Date.now()-w*24*60*60*1e3).toISOString(),[T,k,R,D,O,F,U,X,W,K]=await Promise.all([Kt.from("users").select("created_at").gte("created_at",E).order("created_at",{ascending:!0}),Kt.from("user_quests").select("completed_at, quest_id").gte("completed_at",E).eq("status","completed").order("completed_at",{ascending:!0}),Kt.from("token_transactions").select("amount, created_at, transaction_type").gte("created_at",E).order("created_at",{ascending:!0}),Kt.from("trips").select("created_at").gte("created_at",E).order("created_at",{ascending:!0}),Kt.from("user_sessions").select("created_at, country, city").gte("created_at",E).eq("is_active",!0),Kt.from("user_activity_events").select("timestamp, event_type").gte("timestamp",E).order("timestamp",{ascending:!0}),Kt.from("user_sessions").select("country").gte("created_at",E).not("country","is",null),Kt.from("user_sessions").select("city").gte("created_at",E).not("city","is",null),Kt.from("user_quests").select("quest_id, quests:quest_id(title)").gte("completed_at",E).eq("status","completed"),Kt.from("users").select("id, username, wallet_address, total_tokens_earned").gte("created_at",E).order("total_tokens_earned",{ascending:!1}).limit(10)]),ne=($e,Ae)=>{const He={};return $e==null||$e.forEach(qe=>{if(qe[Ae]){const Le=new Date(qe[Ae]).toISOString().split("T")[0];He[Le]=(He[Le]||0)+1}}),Object.entries(He).map(([qe,Le])=>({date:qe,count:Le})).sort((qe,Le)=>qe.date.localeCompare(Le.date))},te=$e=>{const Ae={};return $e==null||$e.forEach(He=>{var qe;if(He.created_at){const Le=new Date(He.created_at).toISOString().split("T")[0],st=parseFloat(((qe=He.amount)==null?void 0:qe.toString())||"0")||0;Ae[Le]=(Ae[Le]||0)+st}}),Object.entries(Ae).map(([He,qe])=>({date:He,volume:qe})).sort((He,qe)=>He.date.localeCompare(qe.date))},re=($e,Ae)=>{const He={};return $e==null||$e.forEach(qe=>{const Le=qe[Ae];Le&&(He[Le]=(He[Le]||0)+1)}),Object.entries(He).map(([qe,Le])=>({[Ae==="country"?"country":Ae==="city"?"city":"title"]:qe,count:Le})).sort((qe,Le)=>Le.count-qe.count).slice(0,10)},xe=$e=>{const Ae={};return $e==null||$e.forEach(He=>{var Le;const qe=((Le=He.quests)==null?void 0:Le.title)||"Unknown";Ae[qe]=(Ae[qe]||0)+1}),Object.entries(Ae).map(([He,qe])=>({title:He,count:qe})).sort((He,qe)=>qe.count-He.count).slice(0,10)},ae=ne(T.data||[],"created_at"),ce=ne(k.data||[],"completed_at"),ye=te(R.data||[]),Ce=ne(O.data||[],"created_at"),Me=re(U.data||[],"country"),Ke=re(X.data||[],"city"),ke=xe(W.data||[]),je=(K.data||[]).map($e=>{var Ae,He;return{user:$e.username||((Ae=$e.wallet_address)==null?void 0:Ae.substring(0,10))||"Unknown",tokens:parseFloat(((He=$e.total_tokens_earned)==null?void 0:He.toString())||"0")||0}});return{dateRange:v,userGrowth:ae.map($e=>({users:$e.count})),questTrends:ce.map($e=>({completions:$e.count})),transactionVolume:ye.map($e=>({volume:$e.volume})),activeUsers:Ce.map($e=>({active_users:$e.count})),topCountries:Me,topCities:Ke,topQuests:ke,tokenDistribution:je,users:{total:((n=T.data)==null?void 0:n.length)||0,data:T.data||[]},quests:{total:((s=k.data)==null?void 0:s.length)||0,data:k.data||[]},transactions:{total:((l=R.data)==null?void 0:l.length)||0,totalAmount:((u=R.data)==null?void 0:u.reduce(($e,Ae)=>{var He;return $e+(parseFloat(((He=Ae.amount)==null?void 0:He.toString())||"0")||0)},0))||0,data:R.data||[]},trips:{total:((p=D.data)==null?void 0:p.length)||0,data:D.data||[]}}}catch(r){throw console.error("Error fetching analytics:",r),r}}async function Vbe(t,e){try{const n=e||nl(),{data:s,error:l}=await Kt.from("quests").select("is_active").eq("id",t).single();if(l)throw new Error(l.message||"Failed to fetch quest");const{error:u}=await Kt.from("quests").update({is_active:!s.is_active}).eq("id",t);if(u)throw new Error(u.message||"Failed to toggle quest")}catch(n){throw console.error("Error toggling quest:",n),n}}const Tb=({children:t,className:e="",minWidth:n="100%"})=>{var k,R;const s=he.useRef(null),l=he.useRef(null),u=he.useRef(null),[p,r]=he.useState(!1),v=he.useRef(`scrollable-content-${Math.random().toString(36).substr(2,9)}`);he.useEffect(()=>{const D=()=>{if(u.current){const F=u.current.scrollWidth>u.current.clientWidth;r(F)}};D(),window.addEventListener("resize",D);const O=setTimeout(D,100);return()=>{window.removeEventListener("resize",D),clearTimeout(O)}},[t]);const w=D=>{const O=D.currentTarget.scrollLeft;l.current&&l.current.scrollLeft!==O&&(l.current.scrollLeft=O),u.current&&u.current.scrollLeft!==O&&(u.current.scrollLeft=O)},E=D=>{const O=D.currentTarget.scrollLeft;s.current&&s.current.scrollLeft!==O&&(s.current.scrollLeft=O),u.current&&u.current.scrollLeft!==O&&(u.current.scrollLeft=O)},T=D=>{const O=D.currentTarget.scrollLeft;s.current&&s.current.scrollLeft!==O&&(s.current.scrollLeft=O),l.current&&l.current.scrollLeft!==O&&(l.current.scrollLeft=O)};return f.jsxs(f.Fragment,{children:[f.jsx("style",{children:`
        .${v.current}::-webkit-scrollbar {
          display: none !important;
          width: 0 !important;
          height: 0 !important;
        }
      `}),f.jsxs("div",{className:`relative ${e}`,children:[p&&f.jsx("div",{ref:s,onScroll:w,className:"overflow-x-auto overflow-y-hidden mb-2",style:{scrollbarWidth:"thin",scrollbarColor:"#4b5563 #1f2937",height:"17px"},children:f.jsx("div",{style:{width:((k=u.current)==null?void 0:k.scrollWidth)||"100%",height:"1px"}})}),f.jsx("div",{ref:u,onScroll:T,className:`overflow-x-auto ${v.current}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:f.jsx("div",{style:{minWidth:n},children:t})}),p&&f.jsx("div",{ref:l,onScroll:E,className:"overflow-x-auto overflow-y-hidden mt-2",style:{scrollbarWidth:"thin",scrollbarColor:"#4b5563 #1f2937",height:"17px"},children:f.jsx("div",{style:{width:((R=u.current)==null?void 0:R.scrollWidth)||"100%",height:"1px"}})})]})]})},Hbe=()=>{var yt,Vt,_t,vt,qt,kt,on,mn,Hr,Un,$r,ht,Lr,Br,wn,Nn,mr,Qn;const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState(""),[r,v]=he.useState(null),[w,E]=he.useState(!1),[T,k]=he.useState(!1),[R,D]=he.useState(!1),[O,F]=he.useState(null),[U,X]=he.useState({username:"",email:"",level:"",total_xp:""}),[W,K]=he.useState({amount:"",operation:"add",reason:""}),[ne,te]=he.useState({amount:"",operation:"add",reason:""}),[re,xe]=he.useState(1),[ae,ce]=he.useState(0),[ye,Ce]=he.useState(!1),Me=20;he.useEffect(()=>{Ke()},[re,u,t]);const Ke=async()=>{if(!(t!=null&&t.wallet_address)){console.warn("[AdminUsers] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminUsers] Loading users with wallet:",t.wallet_address);const Nt=await Ebe({search:u||void 0,limit:Me,offset:(re-1)*Me,sortBy:"created_at",sortOrder:"desc"},t.wallet_address);console.log("[AdminUsers] Response:",Nt),Nt&&Nt.users?(n(Nt.users),ce(Nt.total||0)):(console.warn("[AdminUsers] Unexpected response format:",Nt),n([]),ce(0))}catch(Nt){console.error("Error loading users:",Nt),alert(`Failed to load users: ${Nt.message||"Unknown error"}`),n([]),ce(0)}finally{l(!1)}},ke=async Nt=>{try{const et=await Abe(Nt,(t==null?void 0:t.wallet_address)||void 0);v(et)}catch(et){console.error("Error loading user details:",et),alert("Failed to load user details")}},je=Nt=>{var et,Oe;F(Nt),X({username:Nt.username||"",email:Nt.email||"",level:((et=Nt.level)==null?void 0:et.toString())||"1",total_xp:((Oe=Nt.total_xp)==null?void 0:Oe.toString())||"0"}),E(!0)},$e=async()=>{if(O)try{await jbe(O.id,{username:U.username||void 0,email:U.email||void 0,level:parseInt(U.level)||void 0,total_xp:parseInt(U.total_xp)||void 0},t==null?void 0:t.wallet_address),alert("User updated successfully!"),E(!1),F(null),Ke()}catch(Nt){console.error("Error updating user:",Nt),alert(`Failed to update user: ${Nt.message||"Unknown error"}`)}},Ae=async Nt=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{await Dbe(Nt,t==null?void 0:t.wallet_address),alert("User deleted successfully!"),Ke()}catch(et){console.error("Error deleting user:",et),alert(`Failed to delete user: ${et.message||"Unknown error"}`)}},He=async Nt=>{if(confirm("Are you sure you want to ban this user?"))try{await Rbe(Nt,void 0,(t==null?void 0:t.wallet_address)||void 0),Ke()}catch(et){console.error("Error banning user:",et),alert("Failed to ban user")}},qe=async Nt=>{try{await Nbe(Nt,(t==null?void 0:t.wallet_address)||void 0),Ke()}catch(et){console.error("Error unbanning user:",et),alert("Failed to unban user")}},Le=async Nt=>{var et;if(!W.amount||isNaN(parseFloat(W.amount))){alert("Please enter a valid amount");return}try{await Lbe(Nt,parseFloat(W.amount),W.operation,W.reason,t==null?void 0:t.wallet_address),alert(`Tokens ${W.operation==="add"?"added":"subtracted"} successfully!`),k(!1),K({amount:"",operation:"add",reason:""}),Ke(),r&&((et=r.user)==null?void 0:et.id)===Nt&&ke(Nt)}catch(Oe){console.error("Error updating tokens:",Oe),alert(`Failed to update tokens: ${Oe.message||"Unknown error"}`)}},st=async Nt=>{var et;if(!ne.amount||isNaN(parseInt(ne.amount))){alert("Please enter a valid amount");return}try{await Obe(Nt,parseInt(ne.amount),ne.operation,ne.reason,t==null?void 0:t.wallet_address),alert(`XP ${ne.operation==="add"?"added":"subtracted"} successfully!`),D(!1),te({amount:"",operation:"add",reason:""}),Ke(),r&&((et=r.user)==null?void 0:et.id)===Nt&&ke(Nt)}catch(Oe){console.error("Error updating XP:",Oe),alert(`Failed to update XP: ${Oe.message||"Unknown error"}`)}},bt=Nt=>{navigator.clipboard.writeText(Nt),alert("Copied to clipboard!")};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Users Management"}),f.jsx("p",{className:"text-gray-400",children:"Manage all platform users"})]}),f.jsx("button",{onClick:()=>Ce(!ye),className:"px-4 py-2 bg-gray-800/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:ye?"Full View":"Compact View"})]}),f.jsxs("div",{className:"relative",children:[f.jsx(HA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),f.jsx("input",{type:"text",placeholder:"Search by wallet, email, or username...",value:u,onChange:Nt=>{p(Nt.target.value),xe(1)},className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:ye?"800px":"2000px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"User"}),!ye&&f.jsxs(f.Fragment,{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Wallet/Email"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Location"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"IP Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Device/OS"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Browser"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Tokens"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Countries"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Last Active"})]}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"XP"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Level"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Quests"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Status"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.map(Nt=>{var et,Oe,Bt,En,Dn,rn,wr,cr;return f.jsxs(it.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-800/30 transition-colors",children:[f.jsx("td",{className:"px-6 py-4",children:f.jsxs("div",{children:[f.jsx("p",{className:"font-medium",children:Nt.username||"No username"}),f.jsx("p",{className:"text-sm text-gray-400",children:new Date(Nt.created_at).toLocaleDateString()})]})}),!ye&&f.jsxs(f.Fragment,{children:[f.jsx("td",{className:"px-6 py-4",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"font-mono text-sm",children:Nt.wallet_address||Nt.email||"N/A"}),(Nt.wallet_address||Nt.email)&&f.jsx("button",{onClick:()=>bt(Nt.wallet_address||Nt.email||""),className:"p-1 text-gray-400 hover:text-cyan-400 transition-colors",title:"Copy",children:f.jsx(G_,{className:"w-3 h-3"})})]})}),f.jsx("td",{className:"px-6 py-4",children:(et=Nt.osint)!=null&&et.country||(Oe=Nt.osint)!=null&&Oe.city?f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Mo,{className:"w-3 h-3 text-blue-400"}),f.jsxs("span",{className:"text-sm text-blue-400",children:[Nt.osint.country||"Unknown",Nt.osint.city&&`, ${Nt.osint.city}`]})]}):f.jsx("span",{className:"text-sm text-gray-500",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:(Bt=Nt.osint)!=null&&Bt.ip_address?f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(DM,{className:"w-3 h-3 text-green-400"}),f.jsx("span",{className:"font-mono text-xs text-green-400",children:Nt.osint.ip_address}),f.jsx("button",{onClick:()=>{var Jn;return bt(((Jn=Nt.osint)==null?void 0:Jn.ip_address)||"")},className:"p-0.5 text-gray-400 hover:text-green-400 transition-colors",title:"Copy IP",children:f.jsx(G_,{className:"w-2.5 h-2.5"})})]}):f.jsx("span",{className:"text-sm text-gray-500",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:(En=Nt.osint)!=null&&En.device_type||(Dn=Nt.osint)!=null&&Dn.os?f.jsxs("div",{className:"flex items-center gap-1",children:[Nt.osint.device_type==="mobile"&&f.jsx(IB,{className:"w-3 h-3 text-purple-400"}),Nt.osint.device_type==="tablet"&&f.jsx(PB,{className:"w-3 h-3 text-purple-400"}),(Nt.osint.device_type==="desktop"||!Nt.osint.device_type)&&f.jsx(jM,{className:"w-3 h-3 text-purple-400"}),f.jsx("span",{className:"text-xs text-purple-400 capitalize",children:Nt.osint.device_type||"Desktop"}),Nt.osint.os&&f.jsxs("span",{className:"text-xs text-gray-500",children:["/ ",Nt.osint.os]})]}):f.jsx("span",{className:"text-sm text-gray-500",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:(rn=Nt.osint)!=null&&rn.browser?f.jsx("span",{className:"text-xs text-cyan-400",children:Nt.osint.browser}):f.jsx("span",{className:"text-sm text-gray-500",children:"N/A"})}),f.jsxs("td",{className:"px-6 py-4",children:[Nt.total_tokens_earned?Nt.total_tokens_earned.toLocaleString():"0"," TPX"]}),f.jsxs("td",{className:"px-6 py-4 text-sm",children:[((wr=Nt.countries_visited)==null?void 0:wr.length)||0," countries"]}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:Nt.last_active_at?new Date(Nt.last_active_at).toLocaleDateString():"Never"})]}),f.jsx("td",{className:"px-6 py-4",children:((cr=Nt.total_xp)==null?void 0:cr.toLocaleString())||0}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:"px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-sm",children:Nt.level||1})}),f.jsx("td",{className:"px-6 py-4",children:Nt.quests_completed||0}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:`px-2 py-1 rounded text-xs ${Nt.is_banned?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:Nt.is_banned?"Banned":"Active"})}),f.jsx("td",{className:"px-6 py-4",children:f.jsxs("div",{className:"flex items-center space-x-1",children:[f.jsx("button",{onClick:()=>ke(Nt.id),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})}),f.jsx("button",{onClick:()=>je(Nt),className:"p-2 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Edit User",children:f.jsx(P$,{className:"w-4 h-4"})}),Nt.is_banned?f.jsx("button",{onClick:()=>qe(Nt.id),className:"p-2 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Unban User",children:f.jsx($0,{className:"w-4 h-4"})}):f.jsx("button",{onClick:()=>He(Nt.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded transition-colors",title:"Ban User",children:f.jsx(s0e,{className:"w-4 h-4"})}),f.jsx("button",{onClick:()=>Ae(Nt.id),className:"p-2 text-red-600 hover:bg-red-600/20 rounded transition-colors",title:"Delete User",children:f.jsx(E2,{className:"w-4 h-4"})})]})})]},Nt.id)})})]})})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(re-1)*Me+1," to ",Math.min(re*Me,ae)," of ",ae," users"]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("button",{onClick:()=>xe(Nt=>Math.max(1,Nt-1)),disabled:re===1,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors",children:"Previous"}),f.jsx("button",{onClick:()=>xe(Nt=>Nt+1),disabled:re*Me>=ae,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors",children:"Next"})]})]})]}),r&&f.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md z-50 flex items-center justify-center p-4",children:f.jsxs(it.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.3},className:"bg-gradient-to-br from-gray-800/95 to-gray-900/95 rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/10 max-w-7xl w-full max-h-[95vh] overflow-hidden flex flex-col",children:[f.jsx("div",{className:"p-6 border-b border-gray-700/50 bg-gradient-to-r from-gray-800/50 to-gray-900/50",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent",children:"User Intelligence Report"}),f.jsx("p",{className:"text-gray-400 mt-1",children:((yt=r.user)==null?void 0:yt.username)||((Vt=r.user)==null?void 0:Vt.wallet_address)||"Unknown User"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("button",{onClick:()=>{k(!0),K({amount:"",operation:"add",reason:""})},className:"px-3 py-1 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-all hover:scale-105 flex items-center gap-1 text-sm",children:[f.jsx(Ya,{className:"w-4 h-4"}),"Tokens"]}),f.jsxs("button",{onClick:()=>{D(!0),te({amount:"",operation:"add",reason:""})},className:"px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-all hover:scale-105 flex items-center gap-1 text-sm",children:[f.jsx(Vl,{className:"w-4 h-4"}),"XP"]}),f.jsx("button",{onClick:()=>v(null),className:"p-2 text-gray-400 hover:text-white hover:bg-red-500/20 rounded-lg transition-all",children:f.jsx(Qa,{className:"w-5 h-5"})})]})]})}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-4 border border-gray-700/50",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Wallet"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("p",{className:"font-mono text-sm truncate",children:[((vt=(_t=r.user)==null?void 0:_t.wallet_address)==null?void 0:vt.substring(0,12))||"N/A","..."]}),((qt=r.user)==null?void 0:qt.wallet_address)&&f.jsx("button",{onClick:()=>bt(r.user.wallet_address),className:"p-1 text-gray-400 hover:text-cyan-400 transition-colors",children:f.jsx(G_,{className:"w-3 h-3"})})]})]}),f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-4 border border-gray-700/50",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Level"}),f.jsx("p",{className:"text-xl font-bold text-cyan-400",children:((kt=r.user)==null?void 0:kt.level)||1})]}),f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-4 border border-gray-700/50",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"XP"}),f.jsx("p",{className:"text-xl font-bold text-yellow-400",children:((mn=(on=r.user)==null?void 0:on.total_xp)==null?void 0:mn.toLocaleString())||0})]}),f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-4 border border-gray-700/50",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"TPX"}),f.jsx("p",{className:"text-xl font-bold text-green-400",children:((Un=(Hr=r.user)==null?void 0:Hr.total_tokens_earned)==null?void 0:Un.toLocaleString())||0})]})]}),r.osint&&f.jsxs(f.Fragment,{children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-6 border border-cyan-500/30 shadow-lg shadow-cyan-500/10",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(Hx,{className:"w-6 h-6 text-cyan-400"}),f.jsx("h4",{className:"text-xl font-bold",children:"OSINT Intelligence Overview"})]}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"bg-gray-900/50 rounded-lg p-4 border border-blue-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(PE,{className:"w-4 h-4 text-blue-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Countries"})]}),f.jsx("p",{className:"text-2xl font-bold text-blue-400",children:r.osint.stats.uniqueCountries})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.35},className:"bg-gray-900/50 rounded-lg p-4 border border-purple-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(TB,{className:"w-4 h-4 text-purple-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Cities"})]}),f.jsx("p",{className:"text-2xl font-bold text-purple-400",children:r.osint.stats.uniqueCities})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.4},className:"bg-gray-900/50 rounded-lg p-4 border border-green-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(DM,{className:"w-4 h-4 text-green-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"IP Addresses"})]}),f.jsx("p",{className:"text-2xl font-bold text-green-400",children:r.osint.stats.uniqueIPs})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.45},className:"bg-gray-900/50 rounded-lg p-4 border border-yellow-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(AB,{className:"w-4 h-4 text-yellow-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Fingerprints"})]}),f.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:r.osint.stats.uniqueFingerprints})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.5},className:"bg-gray-900/50 rounded-lg p-4 border border-cyan-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(lN,{className:"w-4 h-4 text-cyan-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Sessions"})]}),f.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:r.osint.stats.totalSessions}),f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[r.osint.stats.activeSessions," active"]})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.55},className:"bg-gray-900/50 rounded-lg p-4 border border-pink-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(jM,{className:"w-4 h-4 text-pink-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Devices"})]}),f.jsx("p",{className:"text-2xl font-bold text-pink-400",children:r.osint.stats.uniqueDevices})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.6},className:"bg-gray-900/50 rounded-lg p-4 border border-indigo-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(x0e,{className:"w-4 h-4 text-indigo-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"OS Types"})]}),f.jsx("p",{className:"text-2xl font-bold text-indigo-400",children:r.osint.stats.uniqueOS})]}),f.jsxs(it.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.65},className:"bg-gray-900/50 rounded-lg p-4 border border-orange-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(PE,{className:"w-4 h-4 text-orange-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Browsers"})]}),f.jsx("p",{className:"text-2xl font-bold text-orange-400",children:r.osint.stats.uniqueBrowsers})]})]})]}),r.osint.mostRecentSession&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-6 border border-green-500/30 shadow-lg shadow-green-500/10",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(Mo,{className:"w-6 h-6 text-green-400"}),f.jsx("h4",{className:"text-xl font-bold",children:"Current Location & Connection"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-green-500/20",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(d0e,{className:"w-4 h-4 text-green-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"Country"})]}),f.jsx("p",{className:"text-lg font-bold text-green-400",children:r.osint.mostRecentSession.country||"Unknown"})]}),f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-blue-500/20",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(TB,{className:"w-4 h-4 text-blue-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"City"})]}),f.jsx("p",{className:"text-lg font-bold text-blue-400",children:r.osint.mostRecentSession.city||"Unknown"})]}),f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-cyan-500/20",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(DM,{className:"w-4 h-4 text-cyan-400"}),f.jsx("p",{className:"text-xs text-gray-400",children:"IP Address"}),r.osint.mostRecentSession.ip_address&&f.jsx("button",{onClick:()=>bt(r.osint.mostRecentSession.ip_address),className:"p-1 text-gray-400 hover:text-cyan-400 transition-colors",children:f.jsx(G_,{className:"w-3 h-3"})})]}),f.jsx("p",{className:"text-lg font-bold text-cyan-400 font-mono",children:r.osint.mostRecentSession.ip_address||"Unknown"})]})]})]}),r.osint.mostRecentSession&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-6 border border-yellow-500/30 shadow-lg shadow-yellow-500/10",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(AB,{className:"w-6 h-6 text-yellow-400"}),f.jsx("h4",{className:"text-xl font-bold",children:"Device Fingerprint & Hardware"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-yellow-500/20",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Fingerprint Hash"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"font-mono text-sm text-yellow-400 truncate",children:r.osint.mostRecentSession.fingerprint_hash||r.osint.mostRecentSession.fingerprint||"N/A"}),(r.osint.mostRecentSession.fingerprint_hash||r.osint.mostRecentSession.fingerprint)&&f.jsx("button",{onClick:()=>bt(r.osint.mostRecentSession.fingerprint_hash||r.osint.mostRecentSession.fingerprint),className:"p-1 text-gray-400 hover:text-yellow-400 transition-colors",children:f.jsx(G_,{className:"w-3 h-3"})})]})]}),f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-purple-500/20",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Device Type"}),f.jsxs("div",{className:"flex items-center gap-2",children:[r.osint.mostRecentSession.device_type==="mobile"&&f.jsx(IB,{className:"w-4 h-4 text-purple-400"}),r.osint.mostRecentSession.device_type==="tablet"&&f.jsx(PB,{className:"w-4 h-4 text-purple-400"}),(r.osint.mostRecentSession.device_type==="desktop"||!r.osint.mostRecentSession.device_type)&&f.jsx(jM,{className:"w-4 h-4 text-purple-400"}),f.jsx("p",{className:"text-sm font-semibold text-purple-400 capitalize",children:r.osint.mostRecentSession.device_type||"Desktop"})]})]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-blue-500/20",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Operating System"}),f.jsxs("p",{className:"text-sm font-semibold text-blue-400",children:[(($r=r.osint.mostRecentSession.os_info)==null?void 0:$r.name)||r.osint.mostRecentSession.os||"Unknown",((ht=r.osint.mostRecentSession.os_info)==null?void 0:ht.version)&&` ${r.osint.mostRecentSession.os_info.version}`]}),r.osint.mostRecentSession.os_info&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Platform: ",r.osint.mostRecentSession.os_info.platform||"N/A"]})]}),f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-cyan-500/20",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Browser"}),f.jsxs("p",{className:"text-sm font-semibold text-cyan-400",children:[((Lr=r.osint.mostRecentSession.browser_info)==null?void 0:Lr.name)||r.osint.mostRecentSession.browser||"Unknown",((Br=r.osint.mostRecentSession.browser_info)==null?void 0:Br.version)&&` ${r.osint.mostRecentSession.browser_info.version}`]}),r.osint.mostRecentSession.browser_info&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Engine: ",r.osint.mostRecentSession.browser_info.engine||"N/A"]})]})]}),f.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700/50 col-span-1 md:col-span-2",children:[f.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"User Agent"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"font-mono text-xs text-gray-300 truncate flex-1",children:r.osint.mostRecentSession.user_agent||"N/A"}),r.osint.mostRecentSession.user_agent&&f.jsx("button",{onClick:()=>bt(r.osint.mostRecentSession.user_agent),className:"p-1 text-gray-400 hover:text-cyan-400 transition-colors",children:f.jsx(G_,{className:"w-3 h-3"})})]})]})]})]}),r.osint.uniqueCountries&&r.osint.uniqueCountries.length>0&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-6 border border-blue-500/30 shadow-lg shadow-blue-500/10",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(VA,{className:"w-6 h-6 text-blue-400"}),f.jsx("h4",{className:"text-xl font-bold",children:"Location History"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["Countries Visited (",r.osint.uniqueCountries.length,")"]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:r.osint.uniqueCountries.map((Nt,et)=>f.jsx(it.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.6+et*.05},className:"px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg text-sm border border-blue-500/30",children:Nt},et))})]}),f.jsxs("div",{children:[f.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["Cities Visited (",r.osint.uniqueCities.length,")"]}),f.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.osint.uniqueCities.slice(0,10).map((Nt,et)=>f.jsx(it.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.7+et*.05},className:"px-3 py-1 bg-purple-500/20 text-purple-400 rounded-lg text-sm border border-purple-500/30",children:Nt},et)),r.osint.uniqueCities.length>10&&f.jsxs("span",{className:"px-3 py-1 bg-gray-700/50 text-gray-400 rounded-lg text-sm",children:["+",r.osint.uniqueCities.length-10," more"]})]})]})]})]}),r.osint.allSessions&&r.osint.allSessions.length>0&&f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-6 border border-cyan-500/30 shadow-lg shadow-cyan-500/10",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(nh,{className:"w-6 h-6 text-cyan-400"}),f.jsxs("h4",{className:"text-xl font-bold",children:["Session History (",r.osint.allSessions.length,")"]})]}),f.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.osint.allSessions.slice(0,10).map((Nt,et)=>f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7+et*.05},className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/50 transition-colors",children:[f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Date"}),f.jsx("p",{className:"text-cyan-400",children:new Date(Nt.created_at).toLocaleString()})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Location"}),f.jsxs("p",{className:"text-blue-400",children:[Nt.country||"Unknown",", ",Nt.city||"Unknown"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-gray-400",children:"IP"}),f.jsx("p",{className:"font-mono text-xs text-green-400",children:Nt.ip_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${Nt.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:Nt.is_active?"Active":"Ended"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs mt-2",children:[f.jsxs("div",{children:[f.jsx("span",{className:"text-gray-500",children:"Device: "}),f.jsx("span",{className:"text-purple-400 capitalize",children:Nt.device_type||"Desktop"})]}),f.jsxs("div",{children:[f.jsx("span",{className:"text-gray-500",children:"OS: "}),f.jsx("span",{className:"text-blue-400",children:Nt.os||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("span",{className:"text-gray-500",children:"Browser: "}),f.jsx("span",{className:"text-cyan-400",children:Nt.browser||"Unknown"})]})]})]},Nt.id))})]})]}),!r.osint&&f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-gray-900/50 rounded-xl p-6 border border-gray-700/50 text-center",children:f.jsx("p",{className:"text-gray-400",children:"No OSINT data available for this user"})}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Quests Completed"}),f.jsx("p",{className:"text-lg font-bold",children:((wn=r.quests)==null?void 0:wn.length)||0})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Trips Created"}),f.jsx("p",{className:"text-lg font-bold",children:((Nn=r.trips)==null?void 0:Nn.length)||0})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Transactions"}),f.jsx("p",{className:"text-lg font-bold",children:((mr=r.transactions)==null?void 0:mr.length)||0})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Created At"}),f.jsx("p",{className:"text-sm",children:new Date((Qn=r.user)==null?void 0:Qn.created_at).toLocaleString()})]})]})]})]})}),w&&O&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-2xl w-full",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Edit User"}),f.jsx("button",{onClick:()=>{E(!1),F(null)},className:"text-gray-400 hover:text-white",children:f.jsx(Qa,{className:"w-6 h-6"})})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Username"}),f.jsx("input",{type:"text",value:U.username,onChange:Nt=>X({...U,username:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Email"}),f.jsx("input",{type:"email",value:U.email,onChange:Nt=>X({...U,email:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Level"}),f.jsx("input",{type:"number",min:"1",value:U.level,onChange:Nt=>X({...U,level:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Total XP"}),f.jsx("input",{type:"number",min:"0",value:U.total_xp,onChange:Nt=>X({...U,total_xp:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[f.jsx("button",{onClick:()=>{E(!1),F(null)},className:"px-4 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:$e,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(nb,{className:"w-4 h-4"}),"Save Changes"]})]})]})]})})}),T&&r&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-md w-full",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Manage Tokens"}),f.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-white",children:f.jsx(Qa,{className:"w-6 h-6"})})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Operation"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>K({...W,operation:"add"}),className:`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${W.operation==="add"?"bg-green-500/20 text-green-400":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[f.jsx(RE,{className:"w-4 h-4"}),"Add"]}),f.jsxs("button",{onClick:()=>K({...W,operation:"subtract"}),className:`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${W.operation==="subtract"?"bg-red-500/20 text-red-400":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[f.jsx(kB,{className:"w-4 h-4"}),"Subtract"]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Amount (TPX)"}),f.jsx("input",{type:"number",step:"0.01",min:"0",value:W.amount,onChange:Nt=>K({...W,amount:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reason (optional)"}),f.jsx("input",{type:"text",value:W.reason,onChange:Nt=>K({...W,reason:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Admin adjustment, reward, etc."})]}),f.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[f.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:()=>{var Nt;return Le((Nt=r.user)==null?void 0:Nt.id)},className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors",children:[W.operation==="add"?"Add":"Subtract"," Tokens"]})]})]})]})})}),R&&r&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-md w-full",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Manage XP"}),f.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-white",children:f.jsx(Qa,{className:"w-6 h-6"})})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Operation"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>te({...ne,operation:"add"}),className:`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${ne.operation==="add"?"bg-green-500/20 text-green-400":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[f.jsx(RE,{className:"w-4 h-4"}),"Add"]}),f.jsxs("button",{onClick:()=>te({...ne,operation:"subtract"}),className:`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${ne.operation==="subtract"?"bg-red-500/20 text-red-400":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[f.jsx(kB,{className:"w-4 h-4"}),"Subtract"]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Amount (XP)"}),f.jsx("input",{type:"number",min:"0",value:ne.amount,onChange:Nt=>te({...ne,amount:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reason (optional)"}),f.jsx("input",{type:"text",value:ne.reason,onChange:Nt=>te({...ne,reason:Nt.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Admin adjustment, reward, etc."})]}),f.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[f.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:()=>{var Nt;return st((Nt=r.user)==null?void 0:Nt.id)},className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors",children:[ne.operation==="add"?"Add":"Subtract"," XP"]})]})]})]})})})]})},Gbe=()=>{const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState({userId:"",actionType:"",startDate:"",endDate:"",search:""}),[r,v]=he.useState(1),[w,E]=he.useState(0),[T,k]=he.useState(null),R=50;he.useEffect(()=>{D()},[r,u,t]);const D=async()=>{var F;if(!(t!=null&&t.wallet_address)){console.warn("[AdminActivityLog] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminActivityLog] Loading logs with wallet:",t.wallet_address);const U=await Cbe({userId:u.userId||void 0,actionType:u.actionType||void 0,startDate:u.startDate||void 0,endDate:u.endDate||void 0,limit:R,offset:(r-1)*R},t.wallet_address);if(console.log("[AdminActivityLog] Response:",U),console.log("[AdminActivityLog] Logs count:",((F=U==null?void 0:U.logs)==null?void 0:F.length)||0),console.log("[AdminActivityLog] Total:",(U==null?void 0:U.total)||0),U&&U.logs){let X=U.logs;if(u.search){const W=u.search.toLowerCase();X=X.filter(K=>{var ne,te,re,xe,ae;return((ne=K.fingerprint_hash)==null?void 0:ne.toLowerCase().includes(W))||((te=K.user_agent)==null?void 0:te.toLowerCase().includes(W))||((re=K.ip_address)==null?void 0:re.toLowerCase().includes(W))||((xe=K.username)==null?void 0:xe.toLowerCase().includes(W))||((ae=K.wallet_address)==null?void 0:ae.toLowerCase().includes(W))})}console.log("[AdminActivityLog] Filtered logs count:",X.length),n(X),E(U.total||0)}else console.warn("[AdminActivityLog] Unexpected response format:",U),console.warn("[AdminActivityLog] Response keys:",U?Object.keys(U):"null"),n([]),E(0)}catch(U){console.error("Error loading activity log:",U),alert(`Failed to load activity log: ${U.message||"Unknown error"}`),n([]),E(0)}finally{l(!1)}},O=()=>{const F=["Timestamp","User","Action Type","IP Address","Country","City","Device Type","OS","Browser","Fingerprint Hash"],U=e.map(te=>{var re,xe;return[new Date(te.action_timestamp||te.timestamp||"").toLocaleString(),te.username||te.wallet_address||"Unknown",te.action_type,te.ip_address||"N/A",te.country||"N/A",te.city||"N/A",te.device_type||"N/A",(re=te.os_info)!=null&&re.name?`${te.os_info.name} ${te.os_info.version}`:"N/A",(xe=te.browser_info)!=null&&xe.name?`${te.browser_info.name} ${te.browser_info.version}`:"N/A",te.fingerprint_hash||"N/A"]}),X=[F.join(","),...U.map(te=>te.map(re=>`"${re}"`).join(","))].join(`
`),W=new Blob([X],{type:"text/csv"}),K=window.URL.createObjectURL(W),ne=document.createElement("a");ne.href=K,ne.download=`activity_log_${new Date().toISOString().split("T")[0]}.csv`,ne.click(),window.URL.revokeObjectURL(K)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Activity Log"}),f.jsx("p",{className:"text-gray-400",children:"Comprehensive log of all user actions with detailed device and location info"})]}),f.jsxs("button",{onClick:O,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(UA,{className:"w-4 h-4"}),"Export CSV"]})]}),f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 border border-gray-700/50",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[f.jsxs("div",{className:"relative md:col-span-2",children:[f.jsx(HA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),f.jsx("input",{type:"text",placeholder:"Search by fingerprint, user agent, IP...",value:u.search,onChange:F=>{p({...u,search:F.target.value}),v(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsx("input",{type:"text",placeholder:"User ID",value:u.userId,onChange:F=>{p({...u,userId:F.target.value}),v(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("input",{type:"text",placeholder:"Action Type",value:u.actionType,onChange:F=>{p({...u,actionType:F.target.value}),v(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("input",{type:"date",value:u.startDate,onChange:F=>{p({...u,startDate:F.target.value}),v(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("input",{type:"date",value:u.endDate,onChange:F=>{p({...u,endDate:F.target.value}),v(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:"1400px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Timestamp"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"User"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Action"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"IP Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Location"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Device"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"OS"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Browser"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Fingerprint"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.length===0?f.jsx("tr",{children:f.jsx("td",{colSpan:10,className:"px-6 py-12 text-center text-gray-400",children:"No activity logs found"})}):e.map(F=>{var U;return f.jsxs(it.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-800/30 transition-colors",children:[f.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(F.action_timestamp||F.timestamp||"").toLocaleString()}),f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("p",{className:"font-medium",children:F.username||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:[((U=F.wallet_address)==null?void 0:U.substring(0,10))||"N/A","..."]})]}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:"px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-xs",children:F.action_type})}),f.jsx("td",{className:"px-6 py-4 text-sm font-mono",children:F.ip_address||"N/A"}),f.jsx("td",{className:"px-6 py-4 text-sm",children:F.city&&F.country?f.jsxs("div",{children:[f.jsx("p",{children:F.city}),f.jsx("p",{className:"text-xs text-gray-400",children:F.country})]}):F.country?f.jsx("p",{children:F.country}):f.jsx("span",{className:"text-gray-400",children:"Unknown"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:F.device_type||"Unknown"}),f.jsx("td",{className:"px-6 py-4 text-sm",children:F.os_info&&typeof F.os_info=="object"?f.jsxs("div",{children:[f.jsx("p",{children:F.os_info.name||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400",children:[F.os_info.version||""," ",F.os_info.architecture||""]})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:F.browser_info&&typeof F.browser_info=="object"?f.jsxs("div",{children:[f.jsx("p",{children:F.browser_info.name||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400",children:[F.browser_info.version||""," (",F.browser_info.engine||"",")"]})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("p",{className:"font-mono text-xs text-gray-400",children:F.fingerprint_hash?F.fingerprint_hash.substring(0,16)+"...":"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("button",{onClick:()=>k(F),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})})})]},F.id)})})]})})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(r-1)*R+1," to ",Math.min(r*R,w)," of ",w," logs"]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsxs("button",{onClick:()=>v(F=>Math.max(1,F-1)),disabled:r===1,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:[f.jsx(S2,{className:"w-4 h-4"}),"Previous"]}),f.jsxs("button",{onClick:()=>v(F=>F+1),disabled:r*R>=w,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:["Next",f.jsx(T2,{className:"w-4 h-4"})]})]})]})]}),T&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Activity Details"}),f.jsx("button",{onClick:()=>k(null),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Action Type"}),f.jsx("p",{className:"font-medium",children:T.action_type})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User"}),f.jsx("p",{children:T.username||T.wallet_address||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"IP Address"}),f.jsx("p",{className:"font-mono text-sm",children:T.ip_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Location"}),f.jsx("p",{children:T.city&&T.country?`${T.city}, ${T.country}`:T.country||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Device Type"}),f.jsx("p",{children:T.device_type||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Timestamp"}),f.jsx("p",{children:new Date(T.action_timestamp||T.timestamp||"").toLocaleString()})]})]}),T.os_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"OS Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(T.os_info,null,2)})]}),T.browser_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Browser Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(T.browser_info,null,2)})]}),T.device_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Device Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(T.device_info,null,2)})]}),T.user_agent&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User Agent"}),f.jsx("p",{className:"text-xs font-mono break-all bg-gray-900/50 p-3 rounded",children:T.user_agent})]}),T.fingerprint_hash&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Fingerprint Hash"}),f.jsx("p",{className:"text-xs font-mono break-all bg-gray-900/50 p-3 rounded",children:T.fingerprint_hash})]}),T.action_details&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Action Details"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto max-h-64",children:JSON.stringify(T.action_details,null,2)})]})]})]})})})]})},$be=()=>{var F,U;const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState(null),[r,v]=he.useState({userId:"",ipAddress:"",deviceType:"",os:"",status:"",search:""}),[w,E]=he.useState(1),[T,k]=he.useState(0),R=50;he.useEffect(()=>{D()},[t,w,r]);const D=async()=>{var X;if(!(t!=null&&t.wallet_address)){console.warn("[AdminSessions] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminSessions] Loading sessions with wallet:",t.wallet_address);const W=await Mbe({userId:r.userId||void 0,isActive:r.status==="active"?!0:r.status==="ended"?!1:void 0,limit:R,offset:(w-1)*R},t.wallet_address);if(console.log("[AdminSessions] Response:",W),console.log("[AdminSessions] Sessions count:",((X=W==null?void 0:W.sessions)==null?void 0:X.length)||0),console.log("[AdminSessions] Total:",(W==null?void 0:W.total)||0),W&&W.sessions){let K=W.sessions;if(r.search){const ne=r.search.toLowerCase();K=K.filter(te=>{var re,xe,ae,ce,ye,Ce;return((re=te.ip_address)==null?void 0:re.toLowerCase().includes(ne))||((xe=te.fingerprint)==null?void 0:xe.toLowerCase().includes(ne))||((ce=(ae=te.users)==null?void 0:ae.wallet_address)==null?void 0:ce.toLowerCase().includes(ne))||((Ce=(ye=te.users)==null?void 0:ye.username)==null?void 0:Ce.toLowerCase().includes(ne))})}r.deviceType&&(K=K.filter(ne=>{var te;return((te=ne.device_type)==null?void 0:te.toLowerCase())===r.deviceType.toLowerCase()})),r.os&&(K=K.filter(ne=>{var te,re,xe;return((te=ne.os)==null?void 0:te.toLowerCase().includes(r.os.toLowerCase()))||((xe=(re=ne.os_info)==null?void 0:re.name)==null?void 0:xe.toLowerCase().includes(r.os.toLowerCase()))})),r.ipAddress&&(K=K.filter(ne=>{var te;return(te=ne.ip_address)==null?void 0:te.includes(r.ipAddress)})),console.log("[AdminSessions] Filtered sessions count:",K.length),n(K),k(W.total||0)}else console.warn("[AdminSessions] Unexpected response format:",W),console.warn("[AdminSessions] Response keys:",W?Object.keys(W):"null"),n([]),k(0)}catch(W){console.error("Error loading sessions:",W),alert(`Failed to load sessions: ${W.message||"Unknown error"}`),n([]),k(0)}finally{l(!1)}},O=()=>{const X=["User","IP Address","Country","City","Device Type","OS","Browser","Fingerprint Hash","Status","Created","Last Activity","Duration"],W=e.map(xe=>{var ae,ce,ye,Ce;return[((ae=xe.users)==null?void 0:ae.username)||((ce=xe.users)==null?void 0:ce.wallet_address)||"Unknown",xe.ip_address||"N/A",xe.country||"N/A",xe.city||"N/A",xe.device_type||"N/A",(ye=xe.os_info)!=null&&ye.name?`${xe.os_info.name} ${xe.os_info.version}`:xe.os||"N/A",(Ce=xe.browser_info)!=null&&Ce.name?`${xe.browser_info.name} ${xe.browser_info.version}`:xe.browser||"N/A",xe.fingerprint_hash||xe.fingerprint||"N/A",xe.is_active?"Active":"Ended",new Date(xe.created_at).toLocaleString(),xe.last_activity_at?new Date(xe.last_activity_at).toLocaleString():"N/A",xe.session_duration_seconds?`${Math.floor(xe.session_duration_seconds/60)}m`:"N/A"]}),K=[X.join(","),...W.map(xe=>xe.map(ae=>`"${ae}"`).join(","))].join(`
`),ne=new Blob([K],{type:"text/csv"}),te=window.URL.createObjectURL(ne),re=document.createElement("a");re.href=te,re.download=`sessions_${new Date().toISOString().split("T")[0]}.csv`,re.click(),window.URL.revokeObjectURL(te)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"User Sessions"}),f.jsx("p",{className:"text-gray-400",children:"All user sessions with detailed device and location info"})]}),f.jsxs("button",{onClick:O,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(UA,{className:"w-4 h-4"}),"Export CSV"]})]}),f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 border border-gray-700/50",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[f.jsxs("div",{className:"relative md:col-span-2",children:[f.jsx(HA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),f.jsx("input",{type:"text",placeholder:"Search by IP, fingerprint, user...",value:r.search,onChange:X=>{v({...r,search:X.target.value}),E(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsx("input",{type:"text",placeholder:"User ID",value:r.userId,onChange:X=>{v({...r,userId:X.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("input",{type:"text",placeholder:"IP Address",value:r.ipAddress,onChange:X=>{v({...r,ipAddress:X.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsxs("select",{value:r.deviceType,onChange:X=>{v({...r,deviceType:X.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Devices"}),f.jsx("option",{value:"mobile",children:"Mobile"}),f.jsx("option",{value:"tablet",children:"Tablet"}),f.jsx("option",{value:"desktop",children:"Desktop"})]}),f.jsxs("select",{value:r.status,onChange:X=>{v({...r,status:X.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Statuses"}),f.jsx("option",{value:"active",children:"Active"}),f.jsx("option",{value:"ended",children:"Ended"})]})]})}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:"1400px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"User"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"IP Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Location"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Device"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"OS"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Browser"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Fingerprint"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Status"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Duration"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Created"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.length===0?f.jsx("tr",{children:f.jsx("td",{colSpan:11,className:"px-6 py-12 text-center text-gray-400",children:"No sessions found"})}):e.map(X=>{var W,K,ne,te,re;return f.jsxs(it.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-800/30 transition-colors",children:[f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("p",{className:"font-medium",children:((W=X.users)==null?void 0:W.username)||((ne=(K=X.users)==null?void 0:K.wallet_address)==null?void 0:ne.substring(0,10))||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:[((re=(te=X.users)==null?void 0:te.wallet_address)==null?void 0:re.substring(0,10))||"N/A","..."]})]}),f.jsx("td",{className:"px-6 py-4 text-sm font-mono",children:X.ip_address||"N/A"}),f.jsx("td",{className:"px-6 py-4 text-sm",children:X.city&&X.country?f.jsxs("div",{children:[f.jsx("p",{children:X.city}),f.jsx("p",{className:"text-xs text-gray-400",children:X.country})]}):X.country?f.jsx("p",{children:X.country}):f.jsx("span",{className:"text-gray-400",children:"Unknown"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:f.jsx("p",{children:X.device_type||"Unknown"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:X.os_info&&typeof X.os_info=="object"?f.jsxs("div",{children:[f.jsx("p",{children:X.os_info.name||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400",children:[X.os_info.version||""," ",X.os_info.architecture||""]})]}):X.os?f.jsx("p",{children:X.os}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:X.browser_info&&typeof X.browser_info=="object"?f.jsxs("div",{children:[f.jsx("p",{children:X.browser_info.name||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400",children:[X.browser_info.version||""," (",X.browser_info.engine||"",")"]})]}):X.browser?f.jsx("p",{children:X.browser}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("p",{className:"font-mono text-xs text-gray-400",children:X.fingerprint_hash||X.fingerprint?(X.fingerprint_hash||X.fingerprint).substring(0,16)+"...":"N/A"})}),f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("span",{className:`px-2 py-1 rounded text-xs ${X.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:X.is_active?"Active":"Ended"}),X.end_reason&&f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:X.end_reason})]}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:X.session_duration_seconds?`${Math.floor(X.session_duration_seconds/60)}m ${X.session_duration_seconds%60}s`:X.is_active?"Ongoing":"N/A"}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:new Date(X.created_at).toLocaleString()}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("button",{onClick:()=>p(X),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})})})]},X.id)})})]})})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(w-1)*R+1," to ",Math.min(w*R,T)," of ",T," sessions"]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsxs("button",{onClick:()=>E(X=>Math.max(1,X-1)),disabled:w===1,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:[f.jsx(S2,{className:"w-4 h-4"}),"Previous"]}),f.jsxs("button",{onClick:()=>E(X=>X+1),disabled:w*R>=T,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:["Next",f.jsx(T2,{className:"w-4 h-4"})]})]})]})]}),u&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Session Details"}),f.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User"}),f.jsx("p",{children:((F=u.users)==null?void 0:F.username)||((U=u.users)==null?void 0:U.wallet_address)||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"IP Address"}),f.jsx("p",{className:"font-mono text-sm",children:u.ip_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Country"}),f.jsx("p",{children:u.country||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"City"}),f.jsx("p",{children:u.city||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Device Type"}),f.jsx("p",{children:u.device_type||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${u.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:u.is_active?"Active":"Ended"}),u.end_reason&&f.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Reason: ",u.end_reason]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Created At"}),f.jsx("p",{children:new Date(u.created_at).toLocaleString()})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Last Activity"}),f.jsx("p",{children:u.last_activity_at?new Date(u.last_activity_at).toLocaleString():"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Expires At"}),f.jsx("p",{children:u.expires_at?new Date(u.expires_at).toLocaleString():"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Duration"}),f.jsx("p",{children:u.session_duration_seconds?`${Math.floor(u.session_duration_seconds/3600)}h ${Math.floor(u.session_duration_seconds%3600/60)}m ${u.session_duration_seconds%60}s`:"N/A"})]})]}),u.os_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"OS Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(u.os_info,null,2)})]}),u.browser_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Browser Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(u.browser_info,null,2)})]}),u.device_info&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Device Information"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto",children:JSON.stringify(u.device_info,null,2)})]}),u.user_agent&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User Agent"}),f.jsx("p",{className:"text-xs font-mono break-all bg-gray-900/50 p-3 rounded",children:u.user_agent})]}),u.fingerprint&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Fingerprint"}),f.jsx("p",{className:"text-xs font-mono break-all bg-gray-900/50 p-3 rounded",children:u.fingerprint})]}),u.fingerprint_hash&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Fingerprint Hash"}),f.jsx("p",{className:"text-xs font-mono break-all bg-gray-900/50 p-3 rounded",children:u.fingerprint_hash})]}),u.session_token&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Session Token (masked)"}),f.jsxs("p",{className:"text-xs font-mono bg-gray-900/50 p-3 rounded",children:[u.session_token.substring(0,20),"...",u.session_token.substring(u.session_token.length-10)]})]})]})]})})})]})},Wbe=()=>{const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState(null),[r,v]=he.useState(!1),[w,E]=he.useState(!1),[T,k]=he.useState(null),[R,D]=he.useState({title:"",description:"",location:"",latitude:"",longitude:"",difficulty:"1",reward_tokens:"10",reward_xp:"100",quest_type:"standard",category:"",sponsor_name:"",is_active:!0,is_permanent:!1,auto_add_to_dashboard:!1});he.useEffect(()=>{O()},[t]);const O=async()=>{if(!(t!=null&&t.wallet_address)){console.warn("[AdminQuests] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminQuests] Loading quests with wallet:",t.wallet_address);const te=await kbe({limit:100},t.wallet_address);console.log("[AdminQuests] Response:",te),te&&te.quests?n(te.quests):(console.warn("[AdminQuests] Unexpected response format:",te),n([]))}catch(te){console.error("Error loading quests:",te),alert(`Failed to load quests: ${te.message||"Unknown error"}`),n([])}finally{l(!1)}},F=async()=>{if(!R.title||!R.description||!R.location||!R.latitude||!R.longitude){alert("Please fill in all required fields");return}try{const te={title:R.title,description:R.description,location:R.location,latitude:parseFloat(R.latitude),longitude:parseFloat(R.longitude),difficulty:parseInt(R.difficulty),reward_tokens:parseFloat(R.reward_tokens),reward_xp:parseInt(R.reward_xp),quest_type:R.quest_type,category:R.category||null,sponsor_name:R.sponsor_name||null,is_active:R.is_active,is_permanent:R.is_permanent},re=await Fbe(te,t==null?void 0:t.wallet_address);re&&re.quest&&(alert("Quest created successfully!"),v(!1),K(),O())}catch(te){console.error("Error creating quest:",te),alert(`Failed to create quest: ${te.message||"Unknown error"}`)}},U=async()=>{if(T)try{const te={title:R.title,description:R.description,location:R.location,latitude:parseFloat(R.latitude),longitude:parseFloat(R.longitude),difficulty:parseInt(R.difficulty),reward_tokens:parseFloat(R.reward_tokens),reward_xp:parseInt(R.reward_xp),quest_type:R.quest_type,category:R.category||null,sponsor_name:R.sponsor_name||null,is_active:R.is_active,is_permanent:R.is_permanent},re=await Bbe(T.id,te,t==null?void 0:t.wallet_address);re&&re.quest&&(alert("Quest updated successfully!"),E(!1),k(null),K(),O())}catch(te){console.error("Error updating quest:",te),alert(`Failed to update quest: ${te.message||"Unknown error"}`)}},X=async te=>{if(confirm("Are you sure you want to delete this quest? This action cannot be undone."))try{await zbe(te,t==null?void 0:t.wallet_address),alert("Quest deleted successfully!"),O()}catch(re){console.error("Error deleting quest:",re),alert(`Failed to delete quest: ${re.message||"Unknown error"}`)}},W=async te=>{try{await Vbe(te,(t==null?void 0:t.wallet_address)||void 0),O()}catch(re){console.error("Error toggling quest:",re)}},K=()=>{D({title:"",description:"",location:"",latitude:"",longitude:"",difficulty:"1",reward_tokens:"10",reward_xp:"100",quest_type:"standard",category:"",sponsor_name:"",is_active:!0,is_permanent:!1,auto_add_to_dashboard:!1})},ne=te=>{var re,xe,ae,ce,ye;k(te),D({title:te.title||"",description:te.description||"",location:te.location||"",latitude:((re=te.latitude)==null?void 0:re.toString())||"",longitude:((xe=te.longitude)==null?void 0:xe.toString())||"",difficulty:((ae=te.difficulty)==null?void 0:ae.toString())||"1",reward_tokens:((ce=te.reward_tokens)==null?void 0:ce.toString())||"10",reward_xp:((ye=te.reward_xp)==null?void 0:ye.toString())||"100",quest_type:te.quest_type||"standard",category:te.category||"",sponsor_name:te.sponsor_name||"",is_active:te.is_active!==!1,is_permanent:te.is_permanent||!1,auto_add_to_dashboard:!1}),E(!0)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Quests Management"}),f.jsx("p",{className:"text-gray-400",children:"Manage all platform quests"})]}),f.jsxs("button",{onClick:()=>{K(),v(!0)},className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(RE,{className:"w-4 h-4"}),"Add New Quest"]})]}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:"1000px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Title"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Location"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Reward"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Type"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Status"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.map(te=>{var re;return f.jsxs("tr",{className:"hover:bg-gray-800/30",children:[f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("p",{className:"font-medium",children:te.title}),f.jsxs("p",{className:"text-xs text-gray-400",children:[(re=te.description)==null?void 0:re.substring(0,50),"..."]})]}),f.jsx("td",{className:"px-6 py-4 text-sm",children:te.location}),f.jsxs("td",{className:"px-6 py-4",children:[f.jsxs("p",{children:[te.reward_tokens," TPX"]}),f.jsxs("p",{className:"text-xs text-gray-400",children:[te.reward_xp," XP"]})]}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs",children:te.quest_type})}),f.jsx("td",{className:"px-6 py-4",children:f.jsxs("button",{onClick:()=>W(te.id),className:"flex items-center gap-2",children:[te.is_active?f.jsx(E0e,{className:"w-5 h-5 text-green-400"}):f.jsx(T0e,{className:"w-5 h-5 text-gray-400"}),f.jsx("span",{className:`text-xs ${te.is_active?"text-green-400":"text-gray-400"}`,children:te.is_active?"Active":"Inactive"})]})}),f.jsx("td",{className:"px-6 py-4",children:f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("button",{onClick:()=>p(te),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})}),f.jsx("button",{onClick:()=>ne(te),className:"p-2 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Edit Quest",children:f.jsx(P$,{className:"w-4 h-4"})}),f.jsx("button",{onClick:()=>X(te.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded transition-colors",title:"Delete Quest",children:f.jsx(E2,{className:"w-4 h-4"})})]})})]},te.id)})})]})})}),r&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Create New Quest"}),f.jsx("button",{onClick:()=>{v(!1),K()},className:"text-gray-400 hover:text-white",children:f.jsx(Qa,{className:"w-6 h-6"})})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title *"}),f.jsx("input",{type:"text",value:R.title,onChange:te=>D({...R,title:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description *"}),f.jsx("textarea",{value:R.description,onChange:te=>D({...R,description:te.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Location *"}),f.jsx("input",{type:"text",value:R.location,onChange:te=>D({...R,location:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category"}),f.jsx("input",{type:"text",value:R.category,onChange:te=>D({...R,category:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Latitude *"}),f.jsx("input",{type:"number",step:"any",value:R.latitude,onChange:te=>D({...R,latitude:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Longitude *"}),f.jsx("input",{type:"number",step:"any",value:R.longitude,onChange:te=>D({...R,longitude:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Difficulty"}),f.jsx("input",{type:"number",min:"1",max:"10",value:R.difficulty,onChange:te=>D({...R,difficulty:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reward Tokens"}),f.jsx("input",{type:"number",min:"0",step:"0.01",value:R.reward_tokens,onChange:te=>D({...R,reward_tokens:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reward XP"}),f.jsx("input",{type:"number",min:"0",value:R.reward_xp,onChange:te=>D({...R,reward_xp:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Quest Type"}),f.jsxs("select",{value:R.quest_type,onChange:te=>D({...R,quest_type:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"standard",children:"Standard"}),f.jsx("option",{value:"sponsored",children:"Sponsored"}),f.jsx("option",{value:"hidden_gem",children:"Hidden Gem"}),f.jsx("option",{value:"secret",children:"Secret"}),f.jsx("option",{value:"custom",children:"Custom"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sponsor Name"}),f.jsx("input",{type:"text",value:R.sponsor_name,onChange:te=>D({...R,sponsor_name:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"flex items-center space-x-6",children:[f.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:R.is_active,onChange:te=>D({...R,is_active:te.target.checked}),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Active"})]}),f.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:R.is_permanent,onChange:te=>D({...R,is_permanent:te.target.checked}),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Permanent"})]}),f.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:R.auto_add_to_dashboard,onChange:te=>D({...R,auto_add_to_dashboard:te.target.checked}),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Auto-add to Dashboard"})]})]}),f.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[f.jsx("button",{onClick:()=>{v(!1),K()},className:"px-4 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:F,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(nb,{className:"w-4 h-4"}),"Create Quest"]})]})]})]})})}),w&&T&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Edit Quest"}),f.jsx("button",{onClick:()=>{E(!1),k(null),K()},className:"text-gray-400 hover:text-white",children:f.jsx(Qa,{className:"w-6 h-6"})})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title *"}),f.jsx("input",{type:"text",value:R.title,onChange:te=>D({...R,title:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description *"}),f.jsx("textarea",{value:R.description,onChange:te=>D({...R,description:te.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Location *"}),f.jsx("input",{type:"text",value:R.location,onChange:te=>D({...R,location:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category"}),f.jsx("input",{type:"text",value:R.category,onChange:te=>D({...R,category:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Latitude *"}),f.jsx("input",{type:"number",step:"any",value:R.latitude,onChange:te=>D({...R,latitude:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Longitude *"}),f.jsx("input",{type:"number",step:"any",value:R.longitude,onChange:te=>D({...R,longitude:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Difficulty"}),f.jsx("input",{type:"number",min:"1",max:"10",value:R.difficulty,onChange:te=>D({...R,difficulty:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reward Tokens"}),f.jsx("input",{type:"number",min:"0",step:"0.01",value:R.reward_tokens,onChange:te=>D({...R,reward_tokens:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reward XP"}),f.jsx("input",{type:"number",min:"0",value:R.reward_xp,onChange:te=>D({...R,reward_xp:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Quest Type"}),f.jsxs("select",{value:R.quest_type,onChange:te=>D({...R,quest_type:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"standard",children:"Standard"}),f.jsx("option",{value:"sponsored",children:"Sponsored"}),f.jsx("option",{value:"hidden_gem",children:"Hidden Gem"}),f.jsx("option",{value:"secret",children:"Secret"}),f.jsx("option",{value:"custom",children:"Custom"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sponsor Name"}),f.jsx("input",{type:"text",value:R.sponsor_name,onChange:te=>D({...R,sponsor_name:te.target.value}),className:"w-full px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),f.jsxs("div",{className:"flex items-center space-x-6",children:[f.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:R.is_active,onChange:te=>D({...R,is_active:te.target.checked}),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Active"})]}),f.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:R.is_permanent,onChange:te=>D({...R,is_permanent:te.target.checked}),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Permanent"})]})]}),f.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[f.jsx("button",{onClick:()=>{E(!1),k(null),K()},className:"px-4 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:U,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(nb,{className:"w-4 h-4"}),"Update Quest"]})]})]})]})})}),u&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Quest Details"}),f.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Title"}),f.jsx("p",{className:"font-medium text-lg",children:u.title})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Description"}),f.jsx("p",{children:u.description})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Location"}),f.jsx("p",{children:u.location})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Coordinates"}),f.jsxs("p",{className:"font-mono text-sm",children:[u.latitude,", ",u.longitude]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Difficulty"}),f.jsxs("p",{children:[u.difficulty,"/10"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Reward"}),f.jsxs("p",{children:[u.reward_tokens," TPX + ",u.reward_xp," XP"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Type"}),f.jsx("p",{children:u.quest_type})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Category"}),f.jsx("p",{children:u.category||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${u.is_active?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:u.is_active?"Active":"Inactive"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Permanent"}),f.jsx("p",{children:u.is_permanent?"Yes":"No"})]})]}),u.sponsor_name&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Sponsor"}),f.jsx("p",{children:u.sponsor_name})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Created At"}),f.jsx("p",{children:new Date(u.created_at).toLocaleString()})]})]})]})})})]})},qbe=()=>{var O,F;const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState(null),[r,v]=he.useState({userId:"",country:"",status:""}),[w,E]=he.useState(1),[T,k]=he.useState(0),R=50;he.useEffect(()=>{D()},[t,w,r]);const D=async()=>{if(!(t!=null&&t.wallet_address)){console.warn("[AdminTrips] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminTrips] Loading trips with wallet:",t.wallet_address);const U=await Ibe({userId:r.userId||void 0,limit:R,offset:(w-1)*R},t.wallet_address);if(console.log("[AdminTrips] Response:",U),U&&U.trips){let X=U.trips;r.country&&(X=X.filter(W=>{var K;return(K=W.country)==null?void 0:K.toLowerCase().includes(r.country.toLowerCase())})),r.status&&(X=X.filter(W=>{var K;return((K=W.status)==null?void 0:K.toLowerCase())===r.status.toLowerCase()})),n(X),k(U.total||0)}else console.warn("[AdminTrips] Unexpected response format:",U),n([]),k(0)}catch(U){console.error("Error loading trips:",U),alert(`Failed to load trips: ${U.message||"Unknown error"}`),n([]),k(0)}finally{l(!1)}};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Trips Management"}),f.jsx("p",{className:"text-gray-400",children:"All user trips with detailed information"})]}),f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 border border-gray-700/50",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsx("input",{type:"text",placeholder:"User ID",value:r.userId,onChange:U=>{v({...r,userId:U.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("input",{type:"text",placeholder:"Country",value:r.country,onChange:U=>{v({...r,country:U.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsxs("select",{value:r.status,onChange:U=>{v({...r,status:U.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Statuses"}),f.jsx("option",{value:"draft",children:"Draft"}),f.jsx("option",{value:"active",children:"Active"}),f.jsx("option",{value:"completed",children:"Completed"}),f.jsx("option",{value:"archived",children:"Archived"})]})]})}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:"1000px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"User"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Destination"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Location"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Duration"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Dates"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Cost"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Quests"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Status"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Created"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.length===0?f.jsx("tr",{children:f.jsx("td",{colSpan:10,className:"px-6 py-12 text-center text-gray-400",children:"No trips found"})}):e.map(U=>{var X,W,K,ne,te;return f.jsxs(it.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-800/30 transition-colors",children:[f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("p",{className:"font-medium",children:((X=U.users)==null?void 0:X.username)||((K=(W=U.users)==null?void 0:W.wallet_address)==null?void 0:K.substring(0,10))||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:[((te=(ne=U.users)==null?void 0:ne.wallet_address)==null?void 0:te.substring(0,10))||"N/A","..."]})]}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("p",{className:"font-medium",children:U.destination||U.title||"N/A"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:U.city&&U.country?f.jsxs("div",{children:[f.jsx("p",{children:U.city}),f.jsx("p",{className:"text-xs text-gray-400",children:U.country})]}):U.country?f.jsx("p",{children:U.country}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:U.duration_days||U.days?f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ig,{className:"w-4 h-4 text-gray-400"}),f.jsxs("span",{children:[U.duration_days||U.days," days"]})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4 text-sm",children:U.start_date&&U.end_date?f.jsxs("div",{children:[f.jsx("p",{children:new Date(U.start_date).toLocaleDateString()}),f.jsxs("p",{className:"text-xs text-gray-400",children:["to ",new Date(U.end_date).toLocaleDateString()]})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:U.total_cost?f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(id,{className:"w-4 h-4 text-gray-400"}),f.jsxs("span",{children:["$",U.total_cost.toLocaleString()]})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:U.quests_count!==void 0?f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ja,{className:"w-4 h-4 text-yellow-400"}),f.jsx("span",{children:U.quests_count})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:`px-2 py-1 rounded text-xs ${U.status==="active"?"bg-green-500/20 text-green-400":U.status==="completed"?"bg-blue-500/20 text-blue-400":U.status==="archived"?"bg-gray-500/20 text-gray-400":"bg-yellow-500/20 text-yellow-400"}`,children:U.status||"draft"})}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:new Date(U.created_at).toLocaleDateString()}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("button",{onClick:()=>p(U),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})})})]},U.id)})})]})})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(w-1)*R+1," to ",Math.min(w*R,T)," of ",T," trips"]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsxs("button",{onClick:()=>E(U=>Math.max(1,U-1)),disabled:w===1,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:[f.jsx(S2,{className:"w-4 h-4"}),"Previous"]}),f.jsxs("button",{onClick:()=>E(U=>U+1),disabled:w*R>=T,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:["Next",f.jsx(T2,{className:"w-4 h-4"})]})]})]})]}),u&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Trip Details"}),f.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Destination"}),f.jsx("p",{className:"font-medium",children:u.destination||u.title||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User"}),f.jsx("p",{children:((O=u.users)==null?void 0:O.username)||((F=u.users)==null?void 0:F.wallet_address)||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Country"}),f.jsx("p",{children:u.country||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"City"}),f.jsx("p",{children:u.city||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Duration"}),f.jsxs("p",{children:[u.duration_days||u.days||"N/A"," days"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Total Cost"}),f.jsxs("p",{children:["$",u.total_cost?u.total_cost.toLocaleString():"0"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Quests Count"}),f.jsx("p",{children:u.quests_count||0})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${u.status==="active"?"bg-green-500/20 text-green-400":u.status==="completed"?"bg-blue-500/20 text-blue-400":"bg-yellow-500/20 text-yellow-400"}`,children:u.status||"draft"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Start Date"}),f.jsx("p",{children:u.start_date?new Date(u.start_date).toLocaleDateString():"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"End Date"}),f.jsx("p",{children:u.end_date?new Date(u.end_date).toLocaleDateString():"N/A"})]})]}),u.plan_data&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Plan Data"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto max-h-64",children:JSON.stringify(u.plan_data,null,2)})]}),u.route_data&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Route Data"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-4 rounded overflow-auto max-h-64",children:JSON.stringify(u.route_data,null,2)})]}),(u.latitude||u.longitude)&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Coordinates"}),f.jsxs("p",{className:"font-mono text-sm",children:[u.latitude,", ",u.longitude]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Created At"}),f.jsx("p",{children:new Date(u.created_at).toLocaleString()})]})]})]})})})]})},Xbe=()=>{var U,X;const{adminUser:t}=Ap(),[e,n]=he.useState([]),[s,l]=he.useState(!0),[u,p]=he.useState(null),[r,v]=he.useState({type:"",status:"",userId:"",search:""}),[w,E]=he.useState(1),[T,k]=he.useState(0),R=50;he.useEffect(()=>{D()},[t,w,r]);const D=async()=>{if(!(t!=null&&t.wallet_address)){console.warn("[AdminTransactions] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminTransactions] Loading transactions with wallet:",t.wallet_address);const W=await Pbe({userId:r.userId||void 0,type:r.type||void 0,status:r.status||void 0,limit:R,offset:(w-1)*R},t.wallet_address);if(console.log("[AdminTransactions] Response:",W),W&&W.transactions){let K=W.transactions;if(r.search){const ne=r.search.toLowerCase();K=K.filter(te=>{var re,xe,ae,ce,ye;return((re=te.tx_hash)==null?void 0:re.toLowerCase().includes(ne))||((xe=te.from_address)==null?void 0:xe.toLowerCase().includes(ne))||((ae=te.to_address)==null?void 0:ae.toLowerCase().includes(ne))||((ye=(ce=te.users)==null?void 0:ce.wallet_address)==null?void 0:ye.toLowerCase().includes(ne))})}n(K),k(W.total||0)}else console.warn("[AdminTransactions] Unexpected response format:",W),n([]),k(0)}catch(W){console.error("Error loading transactions:",W),alert(`Failed to load transactions: ${W.message||"Unknown error"}`),n([]),k(0)}finally{l(!1)}},O=W=>`https://sepolia.etherscan.io/tx/${W}`,F=()=>{const W=["Date","User","Type","From Address","To Address","Amount","Status","TX Hash","Block","Gas Used","IP Address"],K=e.map(ae=>{var ce,ye,Ce;return[new Date(ae.created_at).toLocaleString(),((ce=ae.users)==null?void 0:ce.username)||((Ce=(ye=ae.users)==null?void 0:ye.wallet_address)==null?void 0:Ce.substring(0,10))||"Unknown",ae.transaction_type,ae.from_address||"N/A",ae.to_address||"N/A",ae.amount||0,ae.status,ae.tx_hash||"N/A",ae.block_number||"N/A",ae.gas_used||"N/A",ae.ip_address||"N/A"]}),ne=[W.join(","),...K.map(ae=>ae.map(ce=>`"${ce}"`).join(","))].join(`
`),te=new Blob([ne],{type:"text/csv"}),re=window.URL.createObjectURL(te),xe=document.createElement("a");xe.href=re,xe.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,xe.click(),window.URL.revokeObjectURL(re)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Transactions"}),f.jsx("p",{className:"text-gray-400",children:"All blockchain transactions with full details"})]}),f.jsxs("button",{onClick:F,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(UA,{className:"w-4 h-4"}),"Export CSV"]})]}),f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 border border-gray-700/50",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[f.jsxs("div",{className:"relative",children:[f.jsx(HA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),f.jsx("input",{type:"text",placeholder:"Search by TX hash, address...",value:r.search,onChange:W=>{v({...r,search:W.target.value}),E(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),f.jsxs("select",{value:r.type,onChange:W=>{v({...r,type:W.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Types"}),f.jsx("option",{value:"claim",children:"Claim"}),f.jsx("option",{value:"burn",children:"Burn"}),f.jsx("option",{value:"reward",children:"Reward"}),f.jsx("option",{value:"transfer",children:"Transfer"})]}),f.jsxs("select",{value:r.status,onChange:W=>{v({...r,status:W.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Statuses"}),f.jsx("option",{value:"pending",children:"Pending"}),f.jsx("option",{value:"confirmed",children:"Confirmed"}),f.jsx("option",{value:"failed",children:"Failed"})]}),f.jsx("input",{type:"text",placeholder:"User ID",value:r.userId,onChange:W=>{v({...r,userId:W.target.value}),E(1)},className:"px-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})}),s?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 overflow-hidden p-4",children:f.jsx(Tb,{minWidth:"1200px",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-900/50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Date"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"User"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Type"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"From Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"To Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Amount"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Status"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"TX Hash"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Block"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Gas"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"IP Address"}),f.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700/50",children:e.length===0?f.jsx("tr",{children:f.jsx("td",{colSpan:12,className:"px-6 py-12 text-center text-gray-400",children:"No transactions found"})}):e.map(W=>{var K,ne,te,re,xe;return f.jsxs(it.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-800/30 transition-colors",children:[f.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(W.created_at).toLocaleString()}),f.jsxs("td",{className:"px-6 py-4",children:[f.jsx("p",{className:"font-medium",children:((K=W.users)==null?void 0:K.username)||((te=(ne=W.users)==null?void 0:ne.wallet_address)==null?void 0:te.substring(0,10))||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:[((xe=(re=W.users)==null?void 0:re.wallet_address)==null?void 0:xe.substring(0,10))||"N/A","..."]})]}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:"px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-xs",children:W.transaction_type})}),f.jsx("td",{className:"px-6 py-4",children:W.from_address?f.jsxs("p",{className:"font-mono text-xs text-gray-300",children:[W.from_address.substring(0,10),"...",W.from_address.substring(W.from_address.length-8)]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4",children:W.to_address?f.jsxs("p",{className:"font-mono text-xs text-gray-300",children:[W.to_address.substring(0,10),"...",W.to_address.substring(W.to_address.length-8)]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsxs("td",{className:"px-6 py-4 font-medium",children:[W.amount||0," TPX"]}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("span",{className:`px-2 py-1 rounded text-xs ${W.status==="confirmed"?"bg-green-500/20 text-green-400":W.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:W.status})}),f.jsx("td",{className:"px-6 py-4",children:W.tx_hash?f.jsxs("a",{href:O(W.tx_hash),target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 text-cyan-400 hover:text-cyan-300 font-mono text-xs",children:[f.jsxs("span",{children:[W.tx_hash.substring(0,10),"..."]}),f.jsx(Jo,{className:"w-3 h-3"})]}):f.jsx("span",{className:"text-gray-400",children:"N/A"})}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:W.block_number?W.block_number.toLocaleString():"N/A"}),f.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:W.gas_used?`${W.gas_used.toLocaleString()} (${W.gas_price?(W.gas_used*W.gas_price/1e18).toFixed(6):"N/A"} ETH)`:"N/A"}),f.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-400",children:W.ip_address||"N/A"}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("button",{onClick:()=>p(W),className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"View Details",children:f.jsx(Ep,{className:"w-4 h-4"})})})]},W.id)})})]})})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(w-1)*R+1," to ",Math.min(w*R,T)," of ",T," transactions"]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsxs("button",{onClick:()=>E(W=>Math.max(1,W-1)),disabled:w===1,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:[f.jsx(S2,{className:"w-4 h-4"}),"Previous"]}),f.jsxs("button",{onClick:()=>E(W=>W+1),disabled:w*R>=T,className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:["Next",f.jsx(T2,{className:"w-4 h-4"})]})]})]})]}),u&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:f.jsx(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl border border-gray-700 max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-2xl font-bold",children:"Transaction Details"}),f.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Transaction Hash"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"font-mono text-sm",children:u.tx_hash||"N/A"}),u.tx_hash&&f.jsx("a",{href:O(u.tx_hash),target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300",children:f.jsx(Jo,{className:"w-4 h-4"})})]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${u.status==="confirmed"?"bg-green-500/20 text-green-400":u.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:u.status})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"From Address"}),f.jsx("p",{className:"font-mono text-sm",children:u.from_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"To Address"}),f.jsx("p",{className:"font-mono text-sm",children:u.to_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Amount"}),f.jsxs("p",{className:"font-medium",children:[u.amount||0," TPX"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Type"}),f.jsx("p",{children:u.transaction_type})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Block Number"}),f.jsx("p",{children:u.block_number?u.block_number.toLocaleString():"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Gas Used"}),f.jsx("p",{children:u.gas_used?u.gas_used.toLocaleString():"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Gas Price"}),f.jsx("p",{children:u.gas_price?`${(u.gas_price/1e9).toFixed(2)} Gwei`:"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"IP Address"}),f.jsx("p",{className:"font-mono text-sm",children:u.ip_address||"N/A"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User"}),f.jsx("p",{children:((U=u.users)==null?void 0:U.username)||((X=u.users)==null?void 0:X.wallet_address)||"Unknown"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Created At"}),f.jsx("p",{children:new Date(u.created_at).toLocaleString()})]}),u.blockchain_confirmed_at&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Confirmed At"}),f.jsx("p",{children:new Date(u.blockchain_confirmed_at).toLocaleString()})]})]}),u.metadata&&Object.keys(u.metadata).length>0&&f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Metadata"}),f.jsx("pre",{className:"text-xs bg-gray-900/50 p-3 rounded overflow-auto",children:JSON.stringify(u.metadata,null,2)})]})]})]})})})]})},UE="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd",jN="0xFc22556bb4ae5740610bE43457d46AdA5200b994",xI=[{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],type:"function"}],nq=[{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{name:"",type:"address"}],type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],type:"function"}],Zbe=[...nq,{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"getTier",outputs:[{name:"",type:"string"}],type:"function"}],rq="https://ethereum-sepolia.publicnode.com",zw=lR({chain:Ux,transport:f2(rq,{timeout:15e3})});async function Qbe(){try{const t=await zw.readContract({address:UE,abi:xI,functionName:"totalSupply"}),e=await zw.readContract({address:UE,abi:xI,functionName:"decimals"}),n=BigInt(t),s=Number(e),l=BigInt(10**s);return(Number(n)/Number(l)).toFixed(2)}catch(t){throw console.error("Error fetching TPX total supply:",t),t}}async function iq(){try{const t=await zw.readContract({address:jN,abi:nq,functionName:"totalSupply"});return Number(t)}catch(t){return console.error("Error fetching NFT Passport total supply:",t),0}}async function Kbe(){try{const t=await iq(),e={bronze:0,silver:0,gold:0,platinum:0},n=Math.min(t,100);for(let s=1;s<=n;s++)try{const u=(await zw.readContract({address:jN,abi:Zbe,functionName:"getTier",args:[BigInt(s)]})).toLowerCase();u.includes("bronze")?e.bronze++:u.includes("silver")?e.silver++:u.includes("gold")?e.gold++:u.includes("platinum")&&e.platinum++}catch{continue}if(n<t&&n>0){const s=t/n;e.bronze=Math.round(e.bronze*s),e.silver=Math.round(e.silver*s),e.gold=Math.round(e.gold*s),e.platinum=Math.round(e.platinum*s)}return e}catch(t){return console.error("Error fetching NFT Passport tier distribution:",t),{bronze:0,silver:0,gold:0,platinum:0}}}async function Ybe(){try{const[t,e,n,s]=await Promise.all([Qbe(),zw.readContract({address:UE,abi:xI,functionName:"decimals"}).catch(()=>18),iq(),Kbe()]);return{tpx:{totalSupply:t,decimals:Number(e)||18,contractAddress:UE||"",holders:0},nftPassport:{totalSupply:n,contractAddress:jN||"",tierDistribution:s},network:{chainId:Ux.id,name:Ux.name,rpcUrl:rq}}}catch(t){throw console.error("Error fetching blockchain stats:",t),t}}const Jbe=()=>{const[t,e]=he.useState(null),[n,s]=he.useState(!0);he.useEffect(()=>{l()},[]);const l=async()=>{try{s(!0),console.log("[AdminBlockchain] Loading blockchain stats...");const u=await Ybe();console.log("[AdminBlockchain] Stats loaded:",u),e(u)}catch(u){console.error("Error loading blockchain stats:",u),alert(`Failed to load blockchain stats: ${u.message||"Unknown error"}`),e(null)}finally{s(!1)}};return n?f.jsx("div",{className:"flex justify-center py-12",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Blockchain Statistics"}),f.jsx("p",{className:"text-gray-400",children:"TPX Token and NFT Passport statistics"})]}),t&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[f.jsx(Ya,{className:"w-8 h-8 text-cyan-400"}),f.jsx("h3",{className:"text-xl font-bold",children:"TPX Token"})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Total Supply"}),f.jsxs("p",{className:"text-2xl font-bold",children:[t.tpx.totalSupply," TPX"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Decimals"}),f.jsx("p",{className:"text-lg",children:t.tpx.decimals})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Contract Address"}),f.jsx("p",{className:"text-xs font-mono text-cyan-400 break-all",children:t.tpx.contractAddress})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[f.jsx(Hx,{className:"w-8 h-8 text-purple-400"}),f.jsx("h3",{className:"text-xl font-bold",children:"NFT Passports"})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Total Mints"}),f.jsx("p",{className:"text-2xl font-bold",children:t.nftPassport.totalSupply})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Tier Distribution"}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[f.jsxs("div",{className:"bg-gray-900/50 p-2 rounded",children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Bronze"}),f.jsx("p",{className:"font-bold",children:t.nftPassport.tierDistribution.bronze})]}),f.jsxs("div",{className:"bg-gray-900/50 p-2 rounded",children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Silver"}),f.jsx("p",{className:"font-bold",children:t.nftPassport.tierDistribution.silver})]}),f.jsxs("div",{className:"bg-gray-900/50 p-2 rounded",children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Gold"}),f.jsx("p",{className:"font-bold",children:t.nftPassport.tierDistribution.gold})]}),f.jsxs("div",{className:"bg-gray-900/50 p-2 rounded",children:[f.jsx("p",{className:"text-xs text-gray-400",children:"Platinum"}),f.jsx("p",{className:"font-bold",children:t.nftPassport.tierDistribution.platinum})]})]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Contract Address"}),f.jsx("p",{className:"text-xs font-mono text-purple-400 break-all",children:t.nftPassport.contractAddress})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 md:col-span-2",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[f.jsx(IE,{className:"w-8 h-8 text-green-400"}),f.jsx("h3",{className:"text-xl font-bold",children:"Network Information"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Network"}),f.jsx("p",{className:"font-bold",children:t.network.name})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Chain ID"}),f.jsx("p",{className:"font-bold",children:t.network.chainId})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-gray-400",children:"RPC URL"}),f.jsx("p",{className:"text-xs font-mono text-green-400 break-all",children:t.network.rpcUrl})]})]})]})]})]})},e1e=()=>{var T,k,R,D,O,F,U,X,W,K,ne,te;const{adminUser:t}=Ap(),[e,n]=he.useState(null),[s,l]=he.useState(!0),[u,p]=he.useState("30d");he.useEffect(()=>{r()},[t,u]);const r=async()=>{if(!(t!=null&&t.wallet_address)){console.warn("[AdminAnalytics] No admin wallet address"),l(!1);return}try{l(!0),console.log("[AdminAnalytics] Loading analytics with wallet:",t.wallet_address);const re=await Ube({dateRange:u},t.wallet_address);console.log("[AdminAnalytics] Response:",re),re?n(re):(console.warn("[AdminAnalytics] Unexpected response format:",re),n(null))}catch(re){console.error("Error loading analytics:",re),alert(`Failed to load analytics: ${re.message||"Unknown error"}`),n(null)}finally{l(!1)}},v=({data:re,label:xe,color:ae="cyan"})=>{if(!re||re.length===0)return f.jsx("div",{className:"flex items-center justify-center h-32",children:f.jsx("p",{className:"text-gray-400 text-sm",children:"No data available"})});try{const ce=re.map(Ae=>Ae.users||Ae.completions||Ae.volume||Ae.active_users||0),ye=Math.max(...ce),Ce=Math.min(...ce),Me=ye-Ce||1,Ke=re.map((Ae,He)=>{const qe=Ae.users||Ae.completions||Ae.volume||Ae.active_users||0,Le=re.length>1?He/(re.length-1)*100:re.length===1?50:0,st=Me>0?100-(qe-Ce)/Me*80:50;return`${Le},${st}`}).join(" "),ke={cyan:{stroke:"rgb(6, 182, 212)",fill:"rgba(6, 182, 212, 0.1)",glow:"rgba(6, 182, 212, 0.3)"},yellow:{stroke:"rgb(234, 179, 8)",fill:"rgba(234, 179, 8, 0.1)",glow:"rgba(234, 179, 8, 0.3)"},green:{stroke:"rgb(34, 197, 94)",fill:"rgba(34, 197, 94, 0.1)",glow:"rgba(34, 197, 94, 0.3)"},blue:{stroke:"rgb(59, 130, 246)",fill:"rgba(59, 130, 246, 0.1)",glow:"rgba(59, 130, 246, 0.3)"},purple:{stroke:"rgb(168, 85, 247)",fill:"rgba(168, 85, 247, 0.1)",glow:"rgba(168, 85, 247, 0.3)"}},je=ke[ae]||ke.cyan,$e=`${Ke} 100,100 0,100`;return f.jsxs(it.div,{className:"relative h-48 w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[f.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",preserveAspectRatio:"none",children:[f.jsxs("defs",{children:[f.jsxs("linearGradient",{id:`gradient-${ae}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[f.jsx("stop",{offset:"0%",stopColor:je.fill,stopOpacity:"0.3"}),f.jsx("stop",{offset:"100%",stopColor:je.fill,stopOpacity:"0"})]}),f.jsxs("filter",{id:`glow-${ae}`,children:[f.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),f.jsxs("feMerge",{children:[f.jsx("feMergeNode",{in:"coloredBlur"}),f.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),f.jsx(it.polygon,{fill:`url(#gradient-${ae})`,points:$e,initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),f.jsx(it.polyline,{fill:"none",stroke:je.stroke,strokeWidth:"3",points:Ke,filter:`url(#glow-${ae})`,initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),re.map((Ae,He)=>{const qe=Ae.users||Ae.completions||Ae.volume||Ae.active_users||0,Le=re.length>1?He/(re.length-1)*100:re.length===1?50:0,st=Me>0?100-(qe-Ce)/Me*80:50;return f.jsx(it.circle,{cx:Le,cy:st,r:"2",fill:je.stroke,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:1.5+He*.1,duration:.3}},He)})]}),f.jsx("div",{className:"absolute bottom-0 left-0 right-0 text-xs text-gray-400 text-center pt-2",children:xe}),f.jsxs("div",{className:"absolute top-2 right-2 text-xs font-bold",style:{color:je.stroke},children:["Max: ",ye.toLocaleString()]})]})}catch(ce){return console.error("Error rendering line chart:",ce),f.jsx("p",{className:"text-gray-400 text-sm",children:"Error rendering chart"})}},w=({data:re,label:xe,color:ae="cyan"})=>{if(!re||re.length===0)return f.jsx("div",{className:"flex items-center justify-center h-32",children:f.jsx("p",{className:"text-gray-400 text-sm",children:"No data available"})});const ce=Math.max(...re.map(Me=>Me.count||0)),ye={cyan:{bg:"bg-cyan-500",gradient:"from-cyan-500 to-cyan-600"},blue:{bg:"bg-blue-500",gradient:"from-blue-500 to-blue-600"},purple:{bg:"bg-purple-500",gradient:"from-purple-500 to-purple-600"},yellow:{bg:"bg-yellow-500",gradient:"from-yellow-500 to-yellow-600"},green:{bg:"bg-green-500",gradient:"from-green-500 to-green-600"},red:{bg:"bg-red-500",gradient:"from-red-500 to-red-600"}},Ce=ye[ae]||ye.cyan;return f.jsx("div",{className:"space-y-3",children:re.slice(0,10).map((Me,Ke)=>{const ke=ce>0?Me.count/ce*100:0;return f.jsxs(it.div,{className:"flex items-center gap-3",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Ke*.1,duration:.5},children:[f.jsxs("div",{className:"flex-1 bg-gray-700/30 rounded-full h-8 relative overflow-hidden border border-gray-600/30",children:[f.jsx(it.div,{className:`h-full bg-gradient-to-r ${Ce.gradient} rounded-full shadow-lg`,style:{width:`${ke}%`},initial:{width:0},animate:{width:`${ke}%`},transition:{delay:Ke*.1+.3,duration:.8,ease:"easeOut"}}),f.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-semibold truncate px-3 z-10",children:Me.country||Me.city||Me.title||Me.user||"Unknown"})]}),f.jsx(it.span,{className:"text-sm text-gray-200 w-20 text-right font-bold",initial:{opacity:0},animate:{opacity:1},transition:{delay:Ke*.1+.5},children:Me.count.toLocaleString()})]},Ke)})})},E=({data:re})=>{if(!re||re.length===0)return f.jsx("div",{className:"flex items-center justify-center h-48",children:f.jsx("p",{className:"text-gray-400 text-sm",children:"No data available"})});try{const xe=re.reduce((ye,Ce)=>ye+(parseFloat(Ce.tokens)||0),0);if(xe===0)return f.jsx("div",{className:"flex items-center justify-center h-48",children:f.jsx("p",{className:"text-gray-400 text-sm",children:"No token data"})});let ae=0;const ce=[{fill:"#06b6d4",glow:"rgba(6, 182, 212, 0.5)"},{fill:"#3b82f6",glow:"rgba(59, 130, 246, 0.5)"},{fill:"#8b5cf6",glow:"rgba(139, 92, 246, 0.5)"},{fill:"#ec4899",glow:"rgba(236, 72, 153, 0.5)"},{fill:"#f59e0b",glow:"rgba(245, 158, 11, 0.5)"},{fill:"#10b981",glow:"rgba(16, 185, 129, 0.5)"},{fill:"#ef4444",glow:"rgba(239, 68, 68, 0.5)"}];return f.jsxs(it.div,{className:"relative h-64 w-64 mx-auto",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[f.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full drop-shadow-2xl",children:[f.jsx("defs",{children:ce.map((ye,Ce)=>f.jsxs("filter",{id:`pieGlow${Ce}`,children:[f.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),f.jsxs("feMerge",{children:[f.jsx("feMergeNode",{in:"coloredBlur"}),f.jsx("feMergeNode",{in:"SourceGraphic"})]})]},Ce))}),re.slice(0,7).map((ye,Ce)=>{const Me=parseFloat(ye.tokens)||0;if(Me===0)return null;const ke=Me/xe*100/100*360,je=ae,$e=ae+ke;ae+=ke;const Ae=(je-90)*(Math.PI/180),He=($e-90)*(Math.PI/180),qe=ke>180?1:0,Le=50+40*Math.cos(Ae),st=50+40*Math.sin(Ae),bt=50+40*Math.cos(He),yt=50+40*Math.sin(He),Vt=["M 50 50",`L ${Le} ${st}`,`A 40 40 0 ${qe} 1 ${bt} ${yt}`,"Z"].join(" "),_t=ce[Ce%ce.length];return f.jsx(it.path,{d:Vt,fill:_t.fill,opacity:.85,filter:`url(#pieGlow${Ce})`,initial:{pathLength:0},animate:{pathLength:1},transition:{delay:Ce*.1,duration:.8,ease:"easeInOut"},whileHover:{opacity:1,scale:1.05,transformOrigin:"50% 50%"}},Ce)})]}),f.jsx(it.div,{className:"absolute inset-0 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.8,duration:.3},children:f.jsxs("div",{className:"text-center",children:[f.jsx(it.p,{className:"text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1,duration:.3},children:xe.toLocaleString()}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Total TPX"})]})})]})}catch(xe){return console.error("Error rendering pie chart:",xe),f.jsx("p",{className:"text-gray-400 text-sm",children:"Error rendering chart"})}};return s?f.jsx("div",{className:"flex items-center justify-center h-64",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})}):e?f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Analytics & Insights"}),f.jsx("p",{className:"text-gray-400",children:"Platform analytics and trends"})]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("select",{value:u,onChange:re=>p(re.target.value),className:"px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"7d",children:"Last 7 days"}),f.jsx("option",{value:"30d",children:"Last 30 days"}),f.jsx("option",{value:"90d",children:"Last 90 days"}),f.jsx("option",{value:"1y",children:"Last year"})]}),f.jsxs("button",{onClick:r,className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors flex items-center gap-2",children:[f.jsx(R$,{className:"w-4 h-4"}),"Refresh"]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02,y:-5},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-blue-500/30 shadow-lg shadow-blue-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative flex items-center justify-between",children:[f.jsx("div",{className:"p-3 bg-blue-500/20 rounded-lg",children:f.jsx(jw,{className:"w-8 h-8 text-blue-400"})}),f.jsxs("div",{className:"text-right",children:[f.jsx(it.p,{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.userGrowth&&e.userGrowth.length>0?((T=e.userGrowth[e.userGrowth.length-1])==null?void 0:T.users)||((k=e.users)==null?void 0:k.total)||0:((R=e.users)==null?void 0:R.total)||0}),f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Total Users"})]})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},whileHover:{scale:1.02,y:-5},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-yellow-500/30 shadow-lg shadow-yellow-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative flex items-center justify-between",children:[f.jsx("div",{className:"p-3 bg-yellow-500/20 rounded-lg",children:f.jsx(Ja,{className:"w-8 h-8 text-yellow-400"})}),f.jsxs("div",{className:"text-right",children:[f.jsx(it.p,{className:"text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:((D=e.questTrends)==null?void 0:D.reduce((re,xe)=>re+(xe.completions||0),0))||((O=e.quests)==null?void 0:O.total)||0}),f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Quest Completions"})]})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},whileHover:{scale:1.02,y:-5},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-cyan-500/30 shadow-lg shadow-cyan-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative flex items-center justify-between",children:[f.jsx("div",{className:"p-3 bg-cyan-500/20 rounded-lg",children:f.jsx(Ya,{className:"w-8 h-8 text-cyan-400"})}),f.jsxs("div",{className:"text-right",children:[f.jsx(it.p,{className:"text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:((F=e.transactionVolume)==null?void 0:F.reduce((re,xe)=>{var ae;return re+(parseFloat(((ae=xe.volume)==null?void 0:ae.toString())||"0")||0)},0).toLocaleString())||((X=(U=e.transactions)==null?void 0:U.totalAmount)==null?void 0:X.toLocaleString())||"0"}),f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"TPX Volume"})]})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},whileHover:{scale:1.02,y:-5},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-green-500/30 shadow-lg shadow-green-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative flex items-center justify-between",children:[f.jsx("div",{className:"p-3 bg-green-500/20 rounded-lg",children:f.jsx(sg,{className:"w-8 h-8 text-green-400"})}),f.jsxs("div",{className:"text-right",children:[f.jsx(it.p,{className:"text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:((W=e.topCountries)==null?void 0:W.length)||0}),f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Active Countries"})]})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-cyan-500/30 shadow-lg shadow-cyan-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-cyan-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:f.jsx(_0e,{className:"w-5 h-5 text-cyan-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"User Growth"})]}),f.jsx(v,{data:e.userGrowth||((K=e.users)==null?void 0:K.data)||[],label:"Users over time",color:"cyan"})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},whileHover:{scale:1.01},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-yellow-500/30 shadow-lg shadow-yellow-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-yellow-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-yellow-500/20 rounded-lg",children:f.jsx(cN,{className:"w-5 h-5 text-yellow-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Quest Completion Trends"})]}),f.jsx(v,{data:e.questTrends||((ne=e.quests)==null?void 0:ne.data)||[],label:"Completions over time",color:"yellow"})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},whileHover:{scale:1.01},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-purple-500/30 shadow-lg shadow-purple-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-purple-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:f.jsx(w0e,{className:"w-5 h-5 text-purple-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Token Distribution"})]}),f.jsx(E,{data:e.tokenDistribution||[]}),f.jsx("div",{className:"mt-6 space-y-3",children:(e.tokenDistribution||[]).slice(0,5).map((re,xe)=>{var ae;return f.jsxs(it.div,{className:"flex items-center justify-between text-sm p-2 bg-gray-900/30 rounded-lg",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:1.2+xe*.1},children:[f.jsx("span",{className:"text-gray-300 truncate font-medium",children:re.user||"Unknown"}),f.jsxs("span",{className:"text-purple-400 font-bold",children:[(parseFloat(((ae=re.tokens)==null?void 0:ae.toString())||"0")||0).toLocaleString()," TPX"]})]},xe)})})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},whileHover:{scale:1.01},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-green-500/30 shadow-lg shadow-green-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-green-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:f.jsx(sg,{className:"w-5 h-5 text-green-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Transaction Volume"})]}),f.jsx(v,{data:e.transactionVolume||((te=e.transactions)==null?void 0:te.data)||[],label:"Volume over time",color:"green"})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-blue-500/30 shadow-lg shadow-blue-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:f.jsx(Mo,{className:"w-5 h-5 text-blue-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Top Countries"})]}),f.jsx(w,{data:e.topCountries||[],label:"Countries",color:"blue"})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},whileHover:{scale:1.02},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-purple-500/30 shadow-lg shadow-purple-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:f.jsx(Mo,{className:"w-5 h-5 text-purple-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Top Cities"})]}),f.jsx(w,{data:e.topCities||[],label:"Cities",color:"purple"})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},whileHover:{scale:1.02},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-yellow-500/30 shadow-lg shadow-yellow-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-yellow-500/20 rounded-lg",children:f.jsx(Ja,{className:"w-5 h-5 text-yellow-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Top Quests"})]}),f.jsx(w,{data:e.topQuests||[],label:"Quests",color:"yellow"})]})]})]}),f.jsxs(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01},className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-green-500/30 shadow-lg shadow-green-500/10 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-green-500/5 rounded-full blur-3xl"}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[f.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:f.jsx(jw,{className:"w-5 h-5 text-green-400"})}),f.jsx("h3",{className:"text-xl font-bold",children:"Active Users Over Time"})]}),f.jsx(v,{data:e.activeUsers||[],label:"Active users",color:"green"})]})]})]}):f.jsx("div",{className:"text-center py-12",children:f.jsx("p",{className:"text-gray-400",children:"No analytics data available"})})},kz=({onNavigate:t})=>{const{isAdmin:e,adminUser:n,loading:s}=Ap(),[l,u]=he.useState("overview"),[p,r]=he.useState(null),[v,w]=he.useState(!0),[E,T]=he.useState(!1);he.useEffect(()=>{if(!s){if(!e){console.log("[AdminDashboard] User is not admin"),w(!1);return}console.log("[AdminDashboard] User is admin, loading stats..."),k()}},[e,s]);const k=async()=>{if(!(n!=null&&n.wallet_address)){console.warn("[AdminDashboard] No admin wallet address available"),w(!1);return}try{w(!0),console.log("[AdminDashboard] Loading stats with wallet:",n.wallet_address.substring(0,10)+"...");const O=await Tbe(n.wallet_address);console.log("[AdminDashboard] Stats response:",O),O&&O.stats?r(O.stats):O?r(O):(console.warn("[AdminDashboard] Empty response from getAdminStats"),r(null))}catch(O){console.error("[AdminDashboard] Error loading admin stats:",{message:O.message,stack:O.stack}),r(null)}finally{w(!1)}},R=[{id:"overview",label:"Overview",icon:cN},{id:"users",label:"Users",icon:jw},{id:"activity",label:"Activity Log",icon:lN},{id:"sessions",label:"Sessions",icon:nh},{id:"quests",label:"Quests",icon:Ja},{id:"trips",label:"Trips",icon:Mo},{id:"transactions",label:"Transactions",icon:Ya},{id:"blockchain",label:"Blockchain",icon:IE},{id:"analytics",label:"Analytics",icon:sg}],D=()=>{switch(l){case"overview":return f.jsx(Iz,{stats:p,loading:v,onNavigate:t});case"users":return f.jsx(Hbe,{});case"activity":return f.jsx(Gbe,{});case"sessions":return f.jsx($be,{});case"quests":return f.jsx(Wbe,{});case"trips":return f.jsx(qbe,{});case"transactions":return f.jsx(Xbe,{});case"blockchain":return f.jsx(Jbe,{});case"analytics":return f.jsx(e1e,{});default:return f.jsx(Iz,{stats:p,loading:v})}};return s?f.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400 mx-auto mb-4"}),f.jsx("p",{className:"text-gray-400",children:"Checking admin access..."})]})}):e?f.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white",children:[f.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border-b border-gray-700",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[t&&f.jsx("button",{onClick:()=>t("dashboard"),className:"p-2 hover:bg-gray-700/50 rounded-lg transition-colors",title:"Back to Dashboard",children:f.jsx(i0e,{className:"w-5 h-5 text-gray-400 hover:text-white"})}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(Hx,{className:"w-6 h-6 sm:w-8 sm:h-8 text-cyan-400"}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-lg sm:text-2xl font-bold",children:"Admin Dashboard"}),f.jsx("p",{className:"text-xs sm:text-sm text-gray-400 hidden sm:block",children:"TripX Platform Management"})]})]})]}),f.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[f.jsx("button",{onClick:()=>T(!E),className:"lg:hidden p-2 hover:bg-gray-700/50 rounded-lg transition-colors",title:"Toggle Menu",children:f.jsx(S0e,{className:"w-5 h-5 text-gray-400 hover:text-white"})}),f.jsxs("div",{className:"text-right hidden sm:block",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Admin Wallet"}),f.jsx("p",{className:"text-xs font-mono text-cyan-400 truncate max-w-[200px]",children:n==null?void 0:n.wallet_address})]})]})]})})}),f.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-8",children:f.jsxs("div",{className:"flex gap-4 lg:gap-8 relative",children:[f.jsxs("aside",{className:`
            ${E?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            fixed lg:static
            inset-y-0 left-0 z-50
            w-64 flex-shrink-0
            bg-gray-900/95 lg:bg-transparent
            backdrop-blur-xl
            border-r border-gray-700 lg:border-r-0
            p-4 lg:p-0
            transition-transform duration-300 ease-in-out
            lg:transition-none
          `,children:[f.jsxs("div",{className:"flex items-center justify-between mb-4 lg:hidden",children:[f.jsx("h2",{className:"text-lg font-semibold text-white",children:"Menu"}),f.jsx("button",{onClick:()=>T(!1),className:"p-2 hover:bg-gray-700/50 rounded-lg transition-colors",children:f.jsx(Qa,{className:"w-5 h-5 text-gray-400 hover:text-white"})})]}),f.jsx("nav",{className:"space-y-2",children:R.map(O=>{const F=O.icon,U=l===O.id;return f.jsxs(it.button,{onClick:()=>{u(O.id),T(!1)},className:`w-full flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg transition-all ${U?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"text-gray-400 hover:text-white hover:bg-gray-800/50"}`,whileHover:{x:4},whileTap:{scale:.98},children:[f.jsx(F,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),f.jsx("span",{className:"font-medium text-sm sm:text-base",children:O.label})]},O.id)})})]}),E&&f.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden",onClick:()=>T(!1)}),f.jsx("main",{className:"flex-1 min-w-0 w-full lg:w-auto",children:D()})]})})]}):f.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:f.jsxs("div",{className:"text-center",children:[f.jsx(Hx,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),f.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Access Denied"}),f.jsx("p",{className:"text-gray-400 mb-4",children:"You don't have permission to access this panel."}),t&&f.jsx("button",{onClick:()=>t("dashboard"),className:"px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors",children:"Back to Dashboard"})]})})},Iz=({stats:t,loading:e,onNavigate:n})=>{var w,E,T,k,R,D,O,F;const[s,l]=he.useState(!0),[u,p]=he.useState(new Date);if(he.useEffect(()=>{if(!s)return;const U=setInterval(()=>{p(new Date)},3e4);return()=>clearInterval(U)},[s]),e)return f.jsx("div",{className:"flex items-center justify-center h-64",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-400"})});if(!t)return f.jsx("div",{className:"text-center py-12",children:"No stats available"});const r=(U,X)=>U>0?f.jsxs("div",{className:"flex items-center gap-1 text-green-400",children:[f.jsx(sg,{className:"w-4 h-4"}),f.jsxs("span",{className:"text-xs",children:["+",X,"%"]})]}):U<0?f.jsxs("div",{className:"flex items-center gap-1 text-red-400",children:[f.jsx(N$,{className:"w-4 h-4"}),f.jsxs("span",{className:"text-xs",children:[X,"%"]})]}):f.jsx("span",{className:"text-xs text-gray-400",children:"No change"}),v=[{label:"Total Users",value:t.totalUsers||0,icon:jw,color:"blue",change:t.activeUsersChange||0,changePercent:t.activeUsersChangePercent||"0"},{label:"Active Users (7d)",value:t.activeUsers||0,icon:lN,color:"green",change:t.activeUsersChange||0,changePercent:t.activeUsersChangePercent||"0"},{label:"Total Quests",value:t.totalQuests||0,icon:Ja,color:"yellow"},{label:"Completed Quests",value:t.completedQuests||0,icon:Ja,color:"purple"},{label:"Total Trips",value:t.totalTrips||0,icon:Mo,color:"pink"},{label:"TPX Transfers",value:((w=t.totalTPXTransfers)==null?void 0:w.toLocaleString())||((E=t.totalTPXMinted)==null?void 0:E.toLocaleString())||"0",icon:Ya,color:"cyan"},{label:"NFT Passports",value:t.totalNFTPassports||0,icon:Hx,color:"indigo"},{label:"Transactions",value:t.totalTransactions||0,icon:IE,color:"orange"}];return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Platform Overview"}),f.jsx("p",{className:"text-gray-400",children:"Real-time statistics and system health"})]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:s,onChange:U=>l(U.target.checked),className:"w-4 h-4 text-cyan-500 bg-gray-900 border-gray-700 rounded focus:ring-cyan-500"}),f.jsx("span",{className:"text-sm text-gray-300",children:"Auto-refresh (30s)"})]}),f.jsxs("span",{className:"text-xs text-gray-400",children:["Last update: ",u.toLocaleTimeString()]})]})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:v.map((U,X)=>{const W=U.icon;return f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:X*.1},className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx(W,{className:`w-8 h-8 text-${U.color}-400`}),f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.jsx("p",{className:"text-3xl font-bold",children:U.value}),U.change!==void 0&&r(U.change,U.changePercent)]}),f.jsx("p",{className:"text-sm text-gray-400",children:U.label})]})]})},U.label)})}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:[f.jsx("h3",{className:"text-xl font-bold mb-4",children:"System Health"}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-gray-300",children:"Database"}),f.jsx("span",{className:`px-3 py-1 rounded text-xs ${((T=t.systemHealth)==null?void 0:T.database)==="healthy"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:((k=t.systemHealth)==null?void 0:k.database)||"Unknown"})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-gray-300",children:"API"}),f.jsx("span",{className:`px-3 py-1 rounded text-xs ${((R=t.systemHealth)==null?void 0:R.api)==="healthy"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:((D=t.systemHealth)==null?void 0:D.api)||"Unknown"})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-gray-300",children:"Blockchain"}),f.jsx("span",{className:`px-3 py-1 rounded text-xs ${((O=t.systemHealth)==null?void 0:O.blockchain)==="healthy"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:((F=t.systemHealth)==null?void 0:F.blockchain)||"Unknown"})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:[f.jsx("h3",{className:"text-xl font-bold mb-4",children:"Quick Actions"}),f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("button",{onClick:()=>n==null?void 0:n("quests"),className:"px-4 py-3 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-colors text-left",children:[f.jsx(RE,{className:"w-5 h-5 mb-1"}),f.jsx("p",{className:"text-sm font-medium",children:"Create Quest"})]}),f.jsxs("button",{onClick:()=>n==null?void 0:n("users"),className:"px-4 py-3 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors text-left",children:[f.jsx(jw,{className:"w-5 h-5 mb-1"}),f.jsx("p",{className:"text-sm font-medium",children:"View Users"})]}),f.jsxs("button",{onClick:()=>n==null?void 0:n("transactions"),className:"px-4 py-3 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-left",children:[f.jsx(IE,{className:"w-5 h-5 mb-1"}),f.jsx("p",{className:"text-sm font-medium",children:"View Transactions"})]}),f.jsxs("button",{onClick:()=>n==null?void 0:n("analytics"),className:"px-4 py-3 bg-purple-500/20 text-purple-400 rounded-lg hover:bg-purple-500/30 transition-colors text-left",children:[f.jsx(cN,{className:"w-5 h-5 mb-1"}),f.jsx("p",{className:"text-sm font-medium",children:"View Analytics"})]})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50",children:[f.jsx("h3",{className:"text-xl font-bold mb-4",children:"Recent Activity"}),f.jsxs("div",{className:"space-y-4",children:[t.recentTransactions&&t.recentTransactions.length>0&&f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Recent Transactions"}),f.jsx("div",{className:"space-y-2",children:t.recentTransactions.map((U,X)=>{var W,K,ne;return f.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900/50 rounded-lg",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium",children:((W=U.users)==null?void 0:W.username)||((ne=(K=U.users)==null?void 0:K.wallet_address)==null?void 0:ne.substring(0,10))||"Unknown"}),f.jsxs("p",{className:"text-xs text-gray-400",children:[U.transaction_type," - ",U.amount," TPX"]})]}),f.jsx("span",{className:`text-xs px-2 py-1 rounded ${U.status==="confirmed"?"bg-green-500/20 text-green-400":U.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:U.status})]},X)})})]}),t.recentQuestCompletions&&t.recentQuestCompletions.length>0&&f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Recent Quest Completions"}),f.jsx("div",{className:"space-y-2",children:t.recentQuestCompletions.map((U,X)=>{var W,K,ne,te;return f.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900/50 rounded-lg",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium",children:((W=U.users)==null?void 0:W.username)||((ne=(K=U.users)==null?void 0:K.wallet_address)==null?void 0:ne.substring(0,10))||"Unknown"}),f.jsx("p",{className:"text-xs text-gray-400",children:((te=U.quests)==null?void 0:te.title)||"Unknown Quest"})]}),f.jsx("span",{className:"text-xs text-gray-400",children:U.completed_at?new Date(U.completed_at).toLocaleDateString():"N/A"})]},X)})})]}),t.recentTrips&&t.recentTrips.length>0&&f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Recent Trips"}),f.jsx("div",{className:"space-y-2",children:t.recentTrips.map((U,X)=>{var W,K,ne;return f.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900/50 rounded-lg",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium",children:((W=U.users)==null?void 0:W.username)||((ne=(K=U.users)==null?void 0:K.wallet_address)==null?void 0:ne.substring(0,10))||"Unknown"}),f.jsx("p",{className:"text-xs text-gray-400",children:U.destination||U.title||"Unknown Destination"})]}),f.jsx("span",{className:"text-xs text-gray-400",children:new Date(U.created_at).toLocaleDateString()})]},X)})})]}),(!t.recentTransactions||t.recentTransactions.length===0)&&(!t.recentQuestCompletions||t.recentQuestCompletions.length===0)&&(!t.recentTrips||t.recentTrips.length===0)&&t.recentActivity&&t.recentActivity.length>0?f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Recent Activity"}),f.jsx("div",{className:"space-y-2",children:t.recentActivity.map((U,X)=>{var W,K;return f.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900/50 rounded-lg",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium",children:U.action_type||"Unknown action"}),f.jsx("p",{className:"text-xs text-gray-400",children:((W=U.users)==null?void 0:W.username)||((K=U.users)==null?void 0:K.wallet_address)||U.username||"Unknown user"})]}),f.jsx("p",{className:"text-xs text-gray-400",children:U.timestamp?new Date(U.timestamp).toLocaleString():"Unknown time"})]},U.id||X)})})]}):null,(!t.recentTransactions||t.recentTransactions.length===0)&&(!t.recentQuestCompletions||t.recentQuestCompletions.length===0)&&(!t.recentTrips||t.recentTrips.length===0)&&(!t.recentActivity||t.recentActivity.length===0)&&f.jsx("p",{className:"text-gray-400 text-center py-4",children:"No recent activity"})]})]})]})},t1e=({destination:t,isVisited:e,quest:n,onStartQuest:s,onCompleteQuest:l,onClaimRewards:u,onMarkAsVisited:p,onViewDetails:r,isClaimingRewards:v})=>{const w=T=>{switch(T){case"legendary":return"text-purple-400 border-purple-400/30 bg-purple-400/10";case"hard":return"text-bloodOrange border-bloodOrange/30 bg-bloodOrange/10";case"medium":return"text-pumpkinOrange border-pumpkinOrange/30 bg-pumpkinOrange/10";case"easy":return"text-toxicGreen border-toxicGreen/30 bg-toxicGreen/10";default:return"text-ghostlyWhite/70 border-ghostlyWhite/20 bg-ghostlyWhite/5"}},E=()=>{if(!n)return null;switch(n.status){case"claimed":return f.jsxs("div",{className:"absolute top-3 left-3 bg-toxicGreen/90 text-deepPurple px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 shadow-lg",children:[f.jsx(la,{className:"w-3 h-3"}),"Completed"]});case"completed":return f.jsxs("div",{className:"absolute top-3 left-3 bg-yellow-500/90 text-deepPurple px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 shadow-lg animate-pulse",children:[f.jsx(vp,{className:"w-3 h-3"}),"Claim Rewards!"]});case"in_progress":return f.jsxs("div",{className:"absolute top-3 left-3 bg-pumpkinOrange/90 text-deepPurple px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 shadow-lg",children:[f.jsx(Rw,{className:"w-3 h-3"}),"In Progress"]});default:return null}};return f.jsxs(YT,{variant:"trip",hoverEffect:!0,children:[f.jsxs("div",{className:"relative w-full h-48 mb-4 rounded-xl overflow-hidden group",children:[f.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-deepPurple/80 via-transparent to-transparent"}),E(),f.jsx("div",{className:"absolute top-3 right-3 flex items-center gap-0.5 bg-black/50 backdrop-blur-sm px-2 py-1 rounded-full",children:[...Array(5)].map((T,k)=>f.jsx(Za,{name:"skull",size:14,className:k<t.spookinessRating?"text-bloodOrange":"text-white/20"},k))}),n&&f.jsx("div",{className:`absolute bottom-3 right-3 px-2 py-1 rounded-full text-xs font-bold border ${w(n.difficulty)}`,children:n.difficulty.toUpperCase()})]}),f.jsx("h3",{className:"text-xl font-bold text-ghostlyWhite mb-1 line-clamp-1",children:t.name}),f.jsxs("div",{className:"flex items-center gap-2 text-ghostlyWhite/60 mb-3",children:[f.jsx(Mo,{className:"w-3 h-3"}),f.jsxs("span",{className:"text-sm line-clamp-1",children:[t.location,", ",t.country]})]}),f.jsx("p",{className:"text-ghostlyWhite/70 text-sm mb-4 line-clamp-2",children:t.description}),n&&f.jsxs("div",{className:"flex items-center gap-4 mb-4 p-3 bg-deepPurple/40 rounded-lg border border-ghostlyWhite/10",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(md,{className:"w-4 h-4 text-yellow-400"}),f.jsx("span",{className:"text-yellow-400 font-bold text-sm",children:n.xpReward})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ya,{className:"w-4 h-4 text-pumpkinOrange"}),f.jsx("span",{className:"text-pumpkinOrange font-bold text-sm",children:n.tpxReward})]}),n.nftReward&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ja,{className:"w-4 h-4 text-purple-400"}),f.jsx("span",{className:"text-purple-400 font-bold text-sm",children:"NFT"})]})]}),f.jsx("div",{className:"flex flex-wrap gap-1.5 mb-4",children:t.tags.slice(0,3).map(T=>f.jsx("span",{className:"px-2 py-0.5 bg-deepPurple/50 text-ghostlyWhite/70 text-xs rounded-full border border-pumpkinOrange/20",children:T},T))}),f.jsxs("div",{className:"flex gap-2",children:[(n==null?void 0:n.status)==="available"&&s&&f.jsx(Vc,{variant:"primary",onClick:s,size:"sm",className:"flex-1",children:"Start Quest"}),(n==null?void 0:n.status)==="in_progress"&&l&&f.jsxs(Vc,{variant:"primary",onClick:l,size:"sm",className:"flex-1",children:[f.jsx(Rw,{className:"w-4 h-4 mr-1"}),"Complete"]}),(n==null?void 0:n.status)==="completed"&&u&&f.jsx(Vc,{variant:"primary",onClick:u,size:"sm",className:"flex-1 animate-pulse",disabled:v,children:v?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-4 h-4 mr-1 animate-spin"}),"Claiming..."]}):f.jsxs(f.Fragment,{children:[f.jsx(vp,{className:"w-4 h-4 mr-1"}),"Claim Rewards"]})}),(n==null?void 0:n.status)==="claimed"&&f.jsx("div",{className:"flex-1 text-center py-2 bg-toxicGreen/10 rounded-lg border border-toxicGreen/30",children:f.jsxs("span",{className:"text-toxicGreen text-sm font-medium flex items-center justify-center gap-1",children:[f.jsx(la,{className:"w-4 h-4"}),"Completed"]})}),!n&&!e&&p&&f.jsx(Vc,{variant:"primary",onClick:()=>p(t.id),size:"sm",className:"flex-1",children:"Mark as Visited"}),r&&f.jsx(Vc,{variant:"secondary",onClick:r,size:"sm",children:"Details"})]})]})},Iv=[{id:"bran-castle",name:"Bran Castle (Dracula's Castle)",location:"Bran, Braov County",country:"Romania",coordinates:{lat:45.5152,lng:25.3673},description:"The legendary castle associated with Vlad the Impaler and Bram Stoker's Dracula. Perched on a cliff, this Gothic fortress offers stunning views and a chilling atmosphere.",spookinessRating:5,activities:[{name:"Castle Tour",description:"Explore the medieval rooms and secret passages",duration:"2 hours",spookinessLevel:4},{name:"Vampire Legends Tour",description:"Learn about Vlad the Impaler and vampire folklore",duration:"1.5 hours",spookinessLevel:5},{name:"Night Photography",description:"Capture the castle illuminated against the night sky",duration:"1 hour",spookinessLevel:3}],imageUrl:"https://images.unsplash.com/photo-1590073242678-70ee3fc28e8e?w=800",tags:["castle","vampire","medieval","gothic"],bestTimeToVisit:"October (Halloween season)",historicalBackground:"Built in the 14th century, Bran Castle is often associated with Vlad III Dracula, though he likely never lived there. The castle's Gothic architecture and mountain setting inspired Bram Stoker's Dracula novel.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/bran-castle.png",xpReward:500,tpxReward:100},{id:"tower-of-london",name:"Tower of London",location:"Tower Hill, London",country:"United Kingdom",coordinates:{lat:51.5081,lng:-.0759},description:"A historic castle with a dark past of executions, torture, and ghostly sightings. Home to the Crown Jewels and countless tales of imprisoned royalty.",spookinessRating:5,activities:[{name:"Yeoman Warder Tour",description:"Hear tales of torture and execution from the Beefeaters",duration:"1 hour",spookinessLevel:4},{name:"Ghost Walk",description:"Evening tour focusing on paranormal activity",duration:"1.5 hours",spookinessLevel:5},{name:"Ravens Watch",description:"Meet the legendary ravens that guard the tower",duration:"30 minutes",spookinessLevel:3}],imageUrl:"https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=800",tags:["castle","haunted","historical","ghosts"],bestTimeToVisit:"October-November (Halloween events)",historicalBackground:"Founded in 1066, the Tower has served as a royal palace, prison, and execution site. Famous prisoners include Anne Boleyn, whose ghost is said to roam the grounds.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/tower-london.png",xpReward:450,tpxReward:90},{id:"bone-church",name:"Sedlec Ossuary (Bone Church)",location:"Kutn Hora",country:"Czech Republic",coordinates:{lat:49.9617,lng:15.2881},description:"A small chapel decorated with the bones of 40,000-70,000 people. Chandeliers, coats of arms, and decorations all made from human skeletal remains.",spookinessRating:5,activities:[{name:"Ossuary Tour",description:"Explore the bone-decorated interior",duration:"45 minutes",spookinessLevel:5},{name:"Photography Session",description:"Capture the macabre artistry",duration:"30 minutes",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=800",tags:["ossuary","bones","church","macabre"],bestTimeToVisit:"Year-round",historicalBackground:"Created in the 19th century by Frantiek Rint, who was tasked with organizing bones from a cemetery that had become overcrowded after the Black Death.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/bone-church.png",xpReward:400,tpxReward:80},{id:"chernobyl",name:"Chernobyl Exclusion Zone",location:"Pripyat",country:"Ukraine",coordinates:{lat:51.389,lng:30.0992},description:"The abandoned city near the site of the 1986 nuclear disaster. A haunting ghost town frozen in time with decaying Soviet-era buildings.",spookinessRating:5,activities:[{name:"Guided Zone Tour",description:"Explore the abandoned city with radiation monitoring",duration:"8 hours",spookinessLevel:5},{name:"Reactor 4 Viewing",description:"See the New Safe Confinement structure",duration:"1 hour",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1565711561500-49678a10a63f?w=800",tags:["abandoned","nuclear","ghost-town","soviet"],bestTimeToVisit:"Spring or Fall (moderate weather)",historicalBackground:"The 1986 Chernobyl disaster was the worst nuclear accident in history. The city of Pripyat was evacuated and remains abandoned to this day.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/chernobyl.png",xpReward:600,tpxReward:150},{id:"island-of-dolls",name:"Island of the Dolls",location:"Xochimilco, Mexico City",country:"Mexico",coordinates:{lat:19.2833,lng:-99.0833},description:"A small island covered with hundreds of decaying dolls hanging from trees. Created by a hermit to appease the spirit of a drowned girl.",spookinessRating:5,activities:[{name:"Boat Tour",description:"Navigate the canals to reach the island",duration:"3 hours",spookinessLevel:4},{name:"Island Exploration",description:"Walk among the hanging dolls",duration:"1 hour",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1509248961158-e54f6934749c?w=800",tags:["dolls","island","paranormal","creepy"],bestTimeToVisit:"October-November",historicalBackground:"Don Julin Santana Barrera began hanging dolls after finding a drowned girl in the canal. He believed the dolls would appease her spirit.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/island-dolls.png",xpReward:550,tpxReward:120},{id:"catacombs-rome",name:"Capuchin Crypt",location:"Via Vittorio Veneto, Rome",country:"Italy",coordinates:{lat:41.9049,lng:12.4892},description:"Underground burial site containing the skeletal remains of 3,700 Capuchin friars, arranged in elaborate decorative patterns.",spookinessRating:4,activities:[{name:"Crypt Tour",description:"Explore the six chapels decorated with bones",duration:"1 hour",spookinessLevel:4},{name:"Museum Visit",description:"Learn about Capuchin history and traditions",duration:"45 minutes",spookinessLevel:2}],imageUrl:"https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=800",tags:["crypt","bones","religious","underground"],bestTimeToVisit:"Year-round",historicalBackground:'Created between 1631 and 1870, the crypt serves as a reminder of mortality with the inscription "What you are now, we once were; what we are now, you shall be."',nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/capuchin-crypt.png",xpReward:350,tpxReward:70},{id:"eastern-state-penitentiary",name:"Eastern State Penitentiary",location:"Philadelphia, Pennsylvania",country:"USA",coordinates:{lat:39.9683,lng:-75.1727},description:"A former prison known for its harsh conditions and famous inmates like Al Capone. Now a crumbling ruin with reported paranormal activity.",spookinessRating:5,activities:[{name:"Day Tour",description:"Explore the cellblocks and learn prison history",duration:"2 hours",spookinessLevel:3},{name:"Terror Behind the Walls",description:"Halloween haunted house experience",duration:"1.5 hours",spookinessLevel:5},{name:"Night Tour",description:"Flashlight tour of the darkened prison",duration:"1 hour",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=800",tags:["prison","haunted","abandoned","paranormal"],bestTimeToVisit:"October (Terror Behind the Walls)",historicalBackground:"Opened in 1829, it was the most expensive building in America and pioneered solitary confinement. Closed in 1971, it now operates as a museum and haunted attraction.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/eastern-state.png",xpReward:500,tpxReward:100},{id:"poveglia-island",name:"Poveglia Island",location:"Venetian Lagoon",country:"Italy",coordinates:{lat:45.3833,lng:12.3333},description:"An abandoned island that served as a plague quarantine station and later a mental asylum. Considered one of the most haunted places on Earth.",spookinessRating:5,activities:[{name:"Boat Viewing",description:"Circle the island by boat (landing restricted)",duration:"1 hour",spookinessLevel:3},{name:"Special Access Tour",description:"Rare guided tours when available",duration:"3 hours",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1523906834658-6e24ef2386f9?w=800",tags:["island","plague","asylum","abandoned"],bestTimeToVisit:"Spring-Fall (boat access)",historicalBackground:"Used as a plague quarantine station in the 1700s, then as a mental asylum until 1968. Estimated 160,000 people died on the island.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/poveglia.png",xpReward:700,tpxReward:200},{id:"hellfire-caves",name:"Hellfire Caves",location:"West Wycombe, Buckinghamshire",country:"United Kingdom",coordinates:{lat:51.6447,lng:-.8003},description:"Man-made chalk caves that were the meeting place of the infamous Hellfire Club, known for their debauchery and occult rituals.",spookinessRating:4,activities:[{name:"Cave Tour",description:"Explore the underground chambers",duration:"1 hour",spookinessLevel:4},{name:"Ghost Hunt",description:"Paranormal investigation events",duration:"3 hours",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1504701954957-2010ec3bcec1?w=800",tags:["caves","occult","secret-society","underground"],bestTimeToVisit:"Year-round",historicalBackground:"Excavated in the 1750s by Sir Francis Dashwood, the caves hosted the Hellfire Club whose members included Benjamin Franklin.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/hellfire-caves.png",xpReward:400,tpxReward:80},{id:"aokigahara-forest",name:"Aokigahara Forest",location:"Mount Fuji, Yamanashi",country:"Japan",coordinates:{lat:35.4667,lng:138.6333},description:'The "Sea of Trees" at the base of Mount Fuji. Known for its dense forest, volcanic rock formations, and eerie silence.',spookinessRating:5,activities:[{name:"Guided Nature Walk",description:"Explore the forest with an experienced guide",duration:"2 hours",spookinessLevel:3},{name:"Ice Cave Exploration",description:"Visit the nearby volcanic ice caves",duration:"1.5 hours",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1528164344705-47542687000d?w=800",tags:["forest","nature","volcanic","mysterious"],bestTimeToVisit:"Summer (July-September)",historicalBackground:"Formed by volcanic eruptions in 864 AD, Aokigahara is known for its dense vegetation and magnetic anomalies.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/aokigahara.png",xpReward:450,tpxReward:90},{id:"hill-of-crosses",name:"Hill of Crosses",location:"iauliai",country:"Lithuania",coordinates:{lat:56.0153,lng:23.4167},description:"A pilgrimage site covered with over 100,000 crosses of all sizes. A haunting symbol of Lithuanian resistance and faith.",spookinessRating:3,activities:[{name:"Hill Exploration",description:"Walk among the thousands of crosses",duration:"1 hour",spookinessLevel:3},{name:"Sunset Visit",description:"Experience the eerie atmosphere at dusk",duration:"2 hours",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["crosses","pilgrimage","religious","memorial"],bestTimeToVisit:"Spring or Fall",historicalBackground:"The tradition began in the 1831 uprising. Despite Soviet attempts to destroy it, locals kept rebuilding. Pope John Paul II visited in 1993.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/hill-crosses.png",xpReward:300,tpxReward:60},{id:"waverly-hills",name:"Waverly Hills Sanatorium",location:"Louisville, Kentucky",country:"USA",coordinates:{lat:38.1606,lng:-85.8342},description:"A former tuberculosis hospital where thousands died. Known as one of the most haunted places in America with frequent paranormal investigations.",spookinessRating:5,activities:[{name:"Historical Tour",description:"Learn about the sanatorium history",duration:"2 hours",spookinessLevel:3},{name:"Paranormal Investigation",description:"Overnight ghost hunting experience",duration:"8 hours",spookinessLevel:5},{name:"Death Tunnel Tour",description:"Explore the infamous body chute",duration:"1 hour",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1509248961158-e54f6934749c?w=800",tags:["hospital","haunted","paranormal","abandoned"],bestTimeToVisit:"October (Halloween events)",historicalBackground:'Opened in 1910 to treat tuberculosis patients. At its peak, one patient died every hour. The "body chute" was used to secretly remove corpses.',nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/waverly-hills.png",xpReward:600,tpxReward:150},{id:"edinburgh-vaults",name:"Edinburgh Underground Vaults",location:"South Bridge, Edinburgh",country:"Scotland",coordinates:{lat:55.9486,lng:-3.1864},description:"Dark underground chambers beneath Edinburgh that once housed taverns, workshops, and the city's poorest residents. Now known for paranormal activity and ghost sightings.",spookinessRating:5,activities:[{name:"Ghost Tour",description:"Explore haunted vaults with paranormal investigators",duration:"1.5 hours",spookinessLevel:5},{name:"Historical Tour",description:"Learn about Edinburgh's dark underground history",duration:"1 hour",spookinessLevel:3},{name:"Paranormal Investigation",description:"Use ghost-hunting equipment in the most haunted chambers",duration:"2 hours",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1599982454276-a7c9c5f8e3f5?w=800",tags:["underground","haunted","paranormal","historical"],bestTimeToVisit:"Year-round (especially October-November)",historicalBackground:"Built in the late 18th century, these vaults were used for storage and housing. They became notorious for criminal activity and were eventually sealed off. Rediscovered in the 1980s, they are now considered one of the most haunted locations in Scotland.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/edinburgh-vaults.png",xpReward:500,tpxReward:100},{id:"salem-witch-trials",name:"Salem Witch Trial Memorial",location:"Salem, Massachusetts",country:"USA",coordinates:{lat:42.5195,lng:-70.8967},description:"The historic site of the infamous 1692 witch trials. Visit museums, memorials, and locations where accused witches were tried and executed.",spookinessRating:4,activities:[{name:"Witch Trial Walking Tour",description:"Visit execution sites and trial locations",duration:"2 hours",spookinessLevel:4},{name:"Witch Museum Visit",description:"Interactive exhibits about the witch trials",duration:"1.5 hours",spookinessLevel:3},{name:"Cemetery Tour",description:"Explore historic graveyards with witch trial connections",duration:"1 hour",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1509248961158-e54f6934749c?w=800",tags:["witch","historical","memorial","museum"],bestTimeToVisit:"October (Haunted Happenings festival)",historicalBackground:"In 1692, Salem experienced mass hysteria leading to the execution of 20 people accused of witchcraft. The trials remain one of the most notorious cases of mass hysteria and injustice in American history.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/salem-witch.png",xpReward:400,tpxReward:80},{id:"paris-catacombs",name:"Paris Catacombs",location:"Place Denfert-Rochereau, Paris",country:"France",coordinates:{lat:48.8338,lng:2.3324},description:"Underground ossuary holding the remains of over 6 million people. A labyrinth of tunnels lined with carefully arranged bones and skulls.",spookinessRating:5,activities:[{name:"Official Catacombs Tour",description:"Walk through the bone-lined tunnels",duration:"1 hour",spookinessLevel:5},{name:"Photography Session",description:"Capture the eerie beauty of the ossuary",duration:"45 minutes",spookinessLevel:4},{name:"Historical Lecture",description:"Learn about the catacombs' creation and history",duration:"30 minutes",spookinessLevel:2}],imageUrl:"https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=800",tags:["catacombs","bones","underground","historical"],bestTimeToVisit:"Year-round (book in advance)",historicalBackground:"Created in the late 18th century to address overflowing cemeteries, the catacombs were formed by transferring remains from various Parisian graveyards into former limestone quarries. The bones were arranged in decorative patterns.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/paris-catacombs.png",xpReward:550,tpxReward:110},{id:"prague-cemetery",name:"Old Jewish Cemetery",location:"Josefov, Prague",country:"Czech Republic",coordinates:{lat:50.0899,lng:14.4186},description:"One of the oldest Jewish cemeteries in Europe with over 12,000 gravestones layered on top of each other. The crowded, tilting tombstones create an otherworldly atmosphere.",spookinessRating:4,activities:[{name:"Cemetery Walking Tour",description:"Explore the ancient gravestones and learn their stories",duration:"1 hour",spookinessLevel:3},{name:"Jewish Quarter Tour",description:"Visit synagogues and Jewish historical sites",duration:"2 hours",spookinessLevel:2},{name:"Golem Legend Tour",description:"Learn about the legendary Golem of Prague",duration:"1.5 hours",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1541849546-216549ae216d?w=800",tags:["cemetery","historical","jewish","legend"],bestTimeToVisit:"Spring or Fall (avoid summer crowds)",historicalBackground:"Dating from the 15th century, this cemetery was used for over 300 years. Due to space constraints, bodies were buried in layers up to 12 deep, creating the unique crowded appearance of tilting gravestones.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/prague-cemetery.png",xpReward:350,tpxReward:70},{id:"gettysburg-battlefield",name:"Gettysburg Battlefield",location:"Gettysburg, Pennsylvania",country:"USA",coordinates:{lat:39.8107,lng:-77.2311},description:"Site of the bloodiest battle of the American Civil War. Over 50,000 soldiers died here, and countless ghost sightings have been reported.",spookinessRating:4,activities:[{name:"Battlefield Tour",description:"Visit key battle sites and monuments",duration:"3 hours",spookinessLevel:3},{name:"Ghost Tour",description:"Evening tour of haunted locations",duration:"2 hours",spookinessLevel:5},{name:"Cemetery Walk",description:"Visit the National Cemetery",duration:"1 hour",spookinessLevel:4}],imageUrl:"https://images.unsplash.com/photo-1568515387631-8b650bbcdb90?w=800",tags:["battlefield","civil-war","haunted","historical"],bestTimeToVisit:"October-November",historicalBackground:"The Battle of Gettysburg (July 1-3, 1863) was a turning point in the Civil War. The battlefield is now one of the most haunted places in America.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/gettysburg.png",xpReward:400,tpxReward:80},{id:"monte-cristo-homestead",name:"Monte Cristo Homestead",location:"Junee, New South Wales",country:"Australia",coordinates:{lat:-34.8667,lng:147.5833},description:"Australia's most haunted house with a tragic history of deaths, including a maid who fell from the balcony and a stable boy burned alive.",spookinessRating:5,activities:[{name:"Day Tour",description:"Explore the Victorian mansion",duration:"1.5 hours",spookinessLevel:3},{name:"Overnight Stay",description:"Sleep in the haunted house",duration:"12 hours",spookinessLevel:5},{name:"Sance Experience",description:"Attempt to contact spirits",duration:"2 hours",spookinessLevel:5}],imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=800",tags:["mansion","haunted","victorian","paranormal"],bestTimeToVisit:"Year-round",historicalBackground:"Built in 1885, the homestead has witnessed numerous tragic deaths. The original owner's wife became a recluse after his death, leaving the house only twice in 23 years.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/monte-cristo.png",xpReward:500,tpxReward:100},{id:"highgate-cemetery",name:"Highgate Cemetery",location:"Highgate, London",country:"United Kingdom",coordinates:{lat:51.5677,lng:-.1467},description:"A Victorian cemetery famous for its Gothic architecture, overgrown graves, and the legend of the Highgate Vampire.",spookinessRating:4,activities:[{name:"West Cemetery Tour",description:"Guided tour of the Gothic west side",duration:"1 hour",spookinessLevel:4},{name:"East Cemetery Walk",description:"Self-guided exploration including Karl Marx's grave",duration:"1.5 hours",spookinessLevel:3}],imageUrl:"https://images.unsplash.com/photo-1509248961158-e54f6934749c?w=800",tags:["cemetery","victorian","gothic","vampire"],bestTimeToVisit:"Autumn (atmospheric fog)",historicalBackground:"Opened in 1839, Highgate became the center of a vampire scare in the 1970s. The overgrown west cemetery features Egyptian Avenue and the Circle of Lebanon.",nftImageUrl:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/nft-images/highgate.png",xpReward:350,tpxReward:70}],n1e=()=>Iv,r1e=t=>{KW(t),NN()},i1e=()=>{const t=wb();return Iv.filter(e=>t.includes(e.id))},s1e=()=>{const t=wb();return{total:Iv.length,visited:t.length,unvisited:Iv.length-t.length,visitedPercentage:t.length/Iv.length*100}},Pz="tripx_spooky_destination_quests";let ad=null;const o1e=t=>{const e=ad;ad=t,e!==t&&y1e(),console.log("[SpookyQuestService] Current user set to:",t)},DN=()=>ad?`${Pz}_${ad}`:`${Pz}_anonymous`,a1e=t=>{const e=h1e(t.spookinessRating);return{id:`spooky-quest-${t.id}`,destinationId:t.id,title:`Explore ${t.name}`,description:`Visit ${t.name} in ${t.country} and document your paranormal experience. Complete activities and earn exclusive Halloween rewards!`,requirements:[`Visit ${t.name}`,"Take a photo at the location","Complete at least one activity","Share your experience"],xpReward:t.xpReward||f1e(e),tpxReward:t.tpxReward||p1e(e),nftReward:!0,nftImageUrl:t.nftImageUrl,difficulty:e,status:"available"}},M2=()=>{const t=LN();return Iv.map(e=>{const n=t.find(s=>s.destinationId===e.id);return n||a1e(e)})},l1e=async()=>{if(!ad){console.log("[SpookyQuestService] No user ID, skipping sync");return}try{const t=await m1e();if(t.length===0){console.log("[SpookyQuestService] No quests in Supabase to sync");return}const e=DN(),n=LN(),s=new Map(n.map(u=>[u.id,u]));for(const u of t)s.set(u.id,u);const l=Array.from(s.values());localStorage.setItem(e,JSON.stringify(l)),console.log("[SpookyQuestService] Synced",t.length,"quests from Supabase to localStorage")}catch(t){console.error("[SpookyQuestService] Error syncing from Supabase:",t)}},c1e=t=>{const n=M2().find(s=>s.id===t);return!n||n.status!=="available"?null:(n.status="in_progress",ON(n),n)},u1e=(t,e)=>{const s=M2().find(l=>l.id===t);return s?s.status==="completed"||s.status==="claimed"?{success:!1,error:"Quest already completed"}:(s.status="completed",s.completedAt=new Date,ON(s),NN(),JW(),{success:!0,quest:s}):{success:!1,error:"Quest not found"}},JT=async(t,e)=>{var l;const s=M2().find(u=>u.id===t);if(!s)return{success:!1,error:"Quest not found"};if(s.status!=="completed")return{success:!1,error:"Quest must be completed first"};if(s.status="claimed",s.claimedAt=new Date,ON(s),eq(s.tpxReward),e)try{const{data:u}=await Kt.from("users").select("total_tokens_earned, total_xp, quests_completed, level").eq("id",e).single();if(u){const p=parseFloat(((l=u.total_tokens_earned)==null?void 0:l.toString())||"0"),r=u.total_xp||0,v=u.quests_completed||0,w=r+s.xpReward,E=Math.floor(Math.sqrt(w/100))+1;let T="bronze";E>=15?T="platinum":E>=10?T="gold":E>=5&&(T="silver"),await Kt.from("users").update({total_tokens_earned:(p+s.tpxReward).toString(),total_xp:w,level:E,passport_tier:T,quests_completed:v+1}).eq("id",e),await PW(e),window.dispatchEvent(new CustomEvent("userDataUpdated")),console.log(`[claimQuestRewards] Updated Supabase for user ${e}: +${s.tpxReward} TPX, +${s.xpReward} XP, Level ${E}, Tier ${T}`)}}catch(u){console.error("[claimQuestRewards] Error updating Supabase:",u)}return{success:!0,rewards:{xp:s.xpReward,tpx:s.tpxReward,nft:s.nftReward,nftImageUrl:s.nftImageUrl}}},d1e=()=>{const t=M2();return{total:t.length,available:t.filter(e=>e.status==="available").length,inProgress:t.filter(e=>e.status==="in_progress").length,completed:t.filter(e=>e.status==="completed").length,claimed:t.filter(e=>e.status==="claimed").length,totalXPAvailable:t.reduce((e,n)=>e+n.xpReward,0),totalTPXAvailable:t.reduce((e,n)=>e+n.tpxReward,0),earnedXP:t.filter(e=>e.status==="claimed").reduce((e,n)=>e+n.xpReward,0),earnedTPX:t.filter(e=>e.status==="claimed").reduce((e,n)=>e+n.tpxReward,0)}};function h1e(t){return t>=5?"legendary":t>=4?"hard":t>=3?"medium":"easy"}function f1e(t){switch(t){case"legendary":return 600;case"hard":return 400;case"medium":return 250;case"easy":return 100}}function p1e(t){switch(t){case"legendary":return 150;case"hard":return 100;case"medium":return 50;case"easy":return 25}}let K1=null,VE=null;const m1e=async()=>{if(!ad)return console.log("[SpookyQuestService] No user ID, skipping Supabase load"),[];if(K1&&VE===ad)return K1;try{console.log("[SpookyQuestService] Loading quests from Supabase for user:",ad);const{data:t,error:e}=await Kt.from("user_spooky_quests").select("*").eq("user_id",ad);if(e)return console.warn("[SpookyQuestService] Error loading from Supabase (table may not exist):",e.message),[];const n=(t||[]).map(s=>({id:s.quest_id,destinationId:s.destination_id,title:s.title,description:s.description||"",requirements:s.requirements||[],xpReward:s.xp_reward||0,tpxReward:s.tpx_reward||0,nftReward:s.nft_reward||!1,nftImageUrl:s.nft_image_url,difficulty:s.difficulty||"medium",status:s.status||"available",completedAt:s.completed_at?new Date(s.completed_at):void 0,claimedAt:s.claimed_at?new Date(s.claimed_at):void 0}));return K1=n,VE=ad,console.log("[SpookyQuestService] Loaded",n.length,"quests from Supabase"),n}catch(t){return console.error("[SpookyQuestService] Error loading quests from Supabase:",t),[]}},g1e=async t=>{var e,n;if(!ad){console.log("[SpookyQuestService] No user ID, skipping Supabase save");return}try{const s={user_id:ad,quest_id:t.id,destination_id:t.destinationId,title:t.title,description:t.description,requirements:t.requirements,xp_reward:t.xpReward,tpx_reward:t.tpxReward,nft_reward:t.nftReward,nft_image_url:t.nftImageUrl,difficulty:t.difficulty,status:t.status,completed_at:((e=t.completedAt)==null?void 0:e.toISOString())||null,claimed_at:((n=t.claimedAt)==null?void 0:n.toISOString())||null,updated_at:new Date().toISOString()},{error:l}=await Kt.from("user_spooky_quests").upsert(s,{onConflict:"user_id,quest_id"});l?console.warn("[SpookyQuestService] Error saving to Supabase:",l.message):(console.log("[SpookyQuestService] Quest saved to Supabase:",t.id,"status:",t.status),VE===ad&&(K1=null))}catch(s){console.error("[SpookyQuestService] Error saving quest to Supabase:",s)}},y1e=()=>{K1=null,VE=null};function LN(){try{const t=DN(),e=localStorage.getItem(t);return e?JSON.parse(e).map(s=>({...s,completedAt:s.completedAt?new Date(s.completedAt):void 0,claimedAt:s.claimedAt?new Date(s.claimedAt):void 0})):[]}catch(t){return console.error("Error reading saved quests:",t),[]}}function ON(t){try{const e=DN(),n=LN(),s=n.findIndex(l=>l.id===t.id);s>=0?n[s]=t:n.push(t),localStorage.setItem(e,JSON.stringify(n))}catch(e){console.error("Error saving quest to localStorage:",e)}g1e(t)}const Rz="pk.eyJ1IjoicGFoaXYiLCJhIjoiY21ocm1pbDl6MDlxbDJxc2RmZTFxanhhdyJ9.0NYhap2uwOXs6slRCnKS4g",x1e=({latitude:t,longitude:e,name:n,className:s="w-full h-48",showPulse:l=!0})=>{const u=he.useRef(null),p=he.useRef(null),[r,v]=he.useState(!1);return he.useEffect(()=>{if(!(!u.current||p.current||!Rz))return Na.accessToken=Rz,p.current=new Na.Map({container:u.current,style:"mapbox://styles/mapbox/dark-v11",center:[e,t],zoom:12,pitch:45,bearing:-17.6,antialias:!0}),p.current.on("load",()=>{var D;if(!p.current)return;v(!0),p.current.setFog({color:"rgb(26, 10, 46)","high-color":"rgb(13, 27, 42)","horizon-blend":.4,"space-color":"rgb(10, 5, 20)","star-intensity":.8}),p.current.addSource("pulse-point",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[e,t]},properties:{}}}),p.current.addLayer({id:"pulse-ring",type:"circle",source:"pulse-point",paint:{"circle-radius":30,"circle-color":"rgba(255, 107, 53, 0.3)","circle-stroke-width":2,"circle-stroke-color":"rgba(255, 107, 53, 0.6)"}}),p.current.addLayer({id:"pulse-center",type:"circle",source:"pulse-point",paint:{"circle-radius":10,"circle-color":"#ff6b35","circle-stroke-width":3,"circle-stroke-color":"#ffffff"}});let w=30,E=!0;const T=()=>{p.current&&(E?(w+=.5,w>=50&&(E=!1)):(w-=.5,w<=30&&(E=!0)),p.current.setPaintProperty("pulse-ring","circle-radius",w),p.current.setPaintProperty("pulse-ring","circle-color",`rgba(255, 107, 53, ${.4-(w-30)*.01})`),requestAnimationFrame(T))};l&&T();const k=p.current.getStyle().layers,R=(D=k==null?void 0:k.find(O=>{var F;return O.type==="symbol"&&((F=O.layout)==null?void 0:F["text-field"])}))==null?void 0:D.id;R&&p.current.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:12,paint:{"fill-extrusion-color":"#1a0a2e","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.7}},R)}),p.current.addControl(new Na.NavigationControl({visualizePitch:!0}),"top-right"),()=>{p.current&&(p.current.remove(),p.current=null)}},[t,e,n,l]),f.jsxs("div",{className:`relative ${s} rounded-xl overflow-hidden`,children:[f.jsx("div",{ref:u,className:"w-full h-full"}),!r&&f.jsx("div",{className:"absolute inset-0 bg-deepPurple/80 flex items-center justify-center",children:f.jsx(it.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"text-3xl",children:""})}),f.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-t from-deepPurple/30 via-transparent to-deepPurple/20"}),f.jsx("div",{className:"absolute top-2 left-2 text-xl opacity-50",children:""}),f.jsx("div",{className:"absolute bottom-2 right-2 text-xl opacity-50",children:""}),f.jsxs("div",{className:"absolute bottom-1 left-1 px-2 py-0.5 bg-black/50 rounded text-[10px] text-white/60 flex items-center gap-1",children:[f.jsx("span",{children:""}),f.jsx("span",{children:"Mapbox"})]})]})},_1e=({destination:t,quest:e,userId:n,walletAddress:s,onClose:l,onComplete:u})=>{const[p,r]=he.useState(null),[v,w]=he.useState(null),[E,T]=he.useState(!1),[k,R]=he.useState("upload"),[D,O]=he.useState(null),[F,U]=he.useState(null),[X,W]=he.useState(null),K=ye=>{var Ke;const Ce=(Ke=ye.target.files)==null?void 0:Ke[0];if(!Ce)return;r(Ce);const Me=new FileReader;Me.onloadend=()=>{w(Me.result)},Me.readAsDataURL(Ce)},ne=async()=>{if(!p){dr.error("Please upload a photo first");return}T(!0),W(null);try{const ye=p.name.split(".").pop(),Ce=Date.now(),Me=`${n}/spooky-${t.id}/${Ce}.${ye}`,{error:Ke}=await Kt.storage.from("quest-proofs").upload(Me,p,{cacheControl:"3600",upsert:!1});if(Ke)throw new Error(`Upload failed: ${Ke.message}`);const{data:{publicUrl:ke}}=Kt.storage.from("quest-proofs").getPublicUrl(Me);u1e(e.id,{photoUrl:ke,latitude:t.coordinates.lat,longitude:t.coordinates.lng}),r1e(t.id),O({xp:e.xpReward,tpx:e.tpxReward,nft:e.nftReward}),R("verified"),dr.success("Quest Verified! ",{description:"Your photo has been accepted. Claim your rewards!"})}catch(ye){W(ye.message||"Verification failed. Please try again."),dr.error("Verification failed",{description:ye.message})}finally{T(!1)}},te=async()=>{if(D){R("claiming");try{const ye=await qA();let Ce=null;const Me="0x6A19B0E01cB227B9fcc7eD95b8f13D2894d63Ffd",Ke="0x110D62545d416d3DFEfA12D0298aBf197CF0e828";if(D.tpx>0){dr.loading(`Sending ${D.tpx} TPX tokens...`,{id:"tpx-claim"});const ke=await VW(s,D.tpx,t.id);ke.success?(dr.dismiss("tpx-claim"),dr.loading(" Waiting for TPX confirmation...",{id:"tpx-monitor"}),await new Promise(je=>{let $e=!1;EW(s,async Ae=>{if(!$e){if($e=!0,dr.dismiss("tpx-monitor"),dr.success(`${D.tpx} TPX confirmed!`,{action:{label:"View",onClick:()=>window.open(Cx(Ae.transactionHash),"_blank")}}),window.ethereum&&Me)try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:Me,symbol:"TPX",decimals:18,image:"https://jjzksgzieuguuolfcekk.supabase.co/storage/v1/object/public/assets/tpx-logo.png"}}})}catch{}je()}},()=>{},60,ye).then(()=>{$e||($e=!0,dr.dismiss("tpx-monitor"),je())})})):(dr.dismiss("tpx-claim"),dr.error("TPX transfer failed",{description:ke.error}))}if(D.nft){dr.loading("Minting Halloween NFT...",{id:"nft-mint"});const ke=await HW(s,t.id,n);if(ke.success&&ke.txHash){dr.dismiss("nft-mint"),dr.loading(" Waiting for NFT confirmation on blockchain...",{id:"nft-monitor"});const je=await C2(s,()=>{},()=>{},Ke,60,ye);if(dr.dismiss("nft-monitor"),je.found&&je.tokenId){Ce=je.tokenId,dr.success(" NFT confirmed on blockchain!",{description:`Token #${Ce}`,action:{label:"View TX",onClick:()=>window.open(Cx(je.transactionHash),"_blank")}}),U({tokenId:Ce,contractAddress:Ke||""}),await JT(e.id,n);try{D.tpx>0&&await Ax(n,D.tpx,je.transactionHash||""),await rb(n,"achievement",Ce,je.transactionHash||""),await Ex(n,t.name,D.xp,D.tpx)}catch($e){console.warn("[SpookyVerification] Failed to create notifications:",$e)}R("nft-success");return}else{Ce=ke.tokenId||1,dr.success(" NFT minted! Awaiting confirmation...",{description:`TX: ${ke.txHash.slice(0,10)}...`}),U({tokenId:Ce,contractAddress:Ke||""}),await JT(e.id,n);try{D.tpx>0&&await Ax(n,D.tpx,ke.txHash||""),await rb(n,"achievement",Ce,ke.txHash||""),await Ex(n,t.name,D.xp,D.tpx)}catch($e){console.warn("[SpookyVerification] Failed to create notifications:",$e)}R("nft-success");return}}else dr.dismiss("nft-mint"),dr.error("NFT mint failed",{description:ke.error})}await JT(e.id,n);try{D.tpx>0&&await Ax(n,D.tpx,""),await Ex(n,t.name,D.xp,D.tpx)}catch(ke){console.warn("[SpookyVerification] Failed to create notifications:",ke)}dr.success("All rewards claimed! ",{description:`+${D.xp} XP, +${D.tpx} TPX`}),R("complete")}catch(ye){dr.error("Failed to claim rewards",{description:ye.message}),R("verified")}}},re=async()=>{if(!(!F||!window.ethereum))try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:F.contractAddress,tokenId:F.tokenId.toString()}}}),dr.success("NFT added to wallet!"),Zm(F.tokenId,F.contractAddress)}catch{Zm(F.tokenId,F.contractAddress)}},xe=()=>{window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:{userId:n,walletAddress:s}})),u(),l(),window.location.reload()},ae=F?`https://sepolia.etherscan.io/nft/${F.contractAddress}/${F.tokenId}`:"",ce=f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/85 backdrop-blur-md",onClick:ye=>{k==="upload"&&l()},children:f.jsxs(it.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},onClick:ye=>ye.stopPropagation(),className:"bg-gradient-to-br from-deepPurple to-midnightBlue border border-pumpkinOrange/40 rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden",children:[f.jsxs("div",{className:"relative p-6 border-b border-pumpkinOrange/20",children:[k==="upload"&&f.jsx("button",{onClick:l,className:"absolute top-4 right-4 p-2 rounded-full bg-black/30 hover:bg-black/50 transition-colors",children:f.jsx(Qa,{className:"w-5 h-5 text-ghostlyWhite"})}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(Za,{name:"ghost",size:40,className:"text-pumpkinOrange"}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-spooky text-ghostlyWhite",children:k==="nft-success"?" NFT Minted!":"Verify Quest"}),f.jsx("p",{className:"text-ghostlyWhite/60 text-sm",children:t.name})]})]})]}),f.jsx("div",{className:"p-6",children:f.jsxs(Xc,{mode:"wait",children:[k==="upload"&&f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:[f.jsxs("div",{className:"mb-6",children:[f.jsxs("label",{className:"block text-ghostlyWhite font-medium mb-2",children:[f.jsx(Rw,{className:"w-4 h-4 inline mr-2"}),"Upload Photo Proof"]}),v?f.jsxs("div",{className:"relative rounded-xl overflow-hidden",children:[f.jsx("img",{src:v,alt:"Preview",className:"w-full h-48 object-cover"}),f.jsx("button",{onClick:()=>{r(null),w(null)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/50 hover:bg-black/70",children:f.jsx(Qa,{className:"w-4 h-4 text-white"})})]}):f.jsxs("label",{className:"flex flex-col items-center justify-center h-48 border-2 border-dashed border-pumpkinOrange/40 rounded-xl cursor-pointer hover:border-pumpkinOrange/60 transition-colors bg-deepPurple/30",children:[f.jsx(j$,{className:"w-10 h-10 text-pumpkinOrange/60 mb-2"}),f.jsx("span",{className:"text-ghostlyWhite/60 text-sm",children:"Click to upload photo"}),f.jsx("input",{type:"file",accept:"image/*",onChange:K,className:"hidden"})]})]}),f.jsxs("div",{className:"bg-deepPurple/40 rounded-xl p-4 mb-6 border border-ghostlyWhite/10",children:[f.jsx("h3",{className:"text-sm font-medium text-ghostlyWhite/70 mb-3",children:"Rewards you'll earn:"}),f.jsxs("div",{className:"flex items-center justify-around",children:[f.jsxs("div",{className:"text-center",children:[f.jsx(md,{className:"w-6 h-6 text-yellow-400 mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-yellow-400",children:e.xpReward}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx(Ya,{className:"w-6 h-6 text-pumpkinOrange mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-pumpkinOrange",children:e.tpxReward}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"TPX"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx(vp,{className:"w-6 h-6 text-purple-400 mx-auto mb-1"}),f.jsx("div",{className:"text-lg font-bold text-purple-400",children:"1"}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"NFT"})]})]})]}),X&&f.jsx("div",{className:"mb-4 p-3 bg-bloodOrange/20 border border-bloodOrange/40 rounded-lg text-bloodOrange text-sm",children:X}),f.jsx(Vc,{variant:"primary",onClick:ne,disabled:!p||E,className:"w-full",children:E?f.jsxs(f.Fragment,{children:[f.jsx(va,{className:"w-5 h-5 mr-2 animate-spin"})," Verifying..."]}):f.jsxs(f.Fragment,{children:[f.jsx(la,{className:"w-5 h-5 mr-2"})," Verify & Complete Quest"]})})]},"upload"),k==="verified"&&D&&f.jsxs(it.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0},animate:{scale:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-toxicGreen/20 flex items-center justify-center",children:f.jsx(la,{className:"w-10 h-10 text-toxicGreen"})}),f.jsx("h3",{className:"text-2xl font-spooky text-toxicGreen mb-2",children:"Quest Verified!"}),f.jsx("p",{className:"text-ghostlyWhite/70 mb-6",children:"Your photo has been accepted."}),f.jsxs("div",{className:"bg-deepPurple/40 rounded-xl p-4 mb-6 border border-toxicGreen/30",children:[f.jsx("h4",{className:"text-sm font-medium text-ghostlyWhite/70 mb-3",children:"Your Rewards:"}),f.jsxs("div",{className:"flex items-center justify-around",children:[f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:D.xp}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-pumpkinOrange",children:D.tpx}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"TPX"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"1"}),f.jsx("div",{className:"text-xs text-ghostlyWhite/50",children:"NFT"})]})]})]}),f.jsxs(Vc,{variant:"primary",onClick:te,className:"w-full",children:[f.jsx(vp,{className:"w-5 h-5 mr-2"})," Claim All Rewards"]})]},"verified"),k==="claiming"&&f.jsxs(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-8",children:[f.jsx(va,{className:"w-16 h-16 text-pumpkinOrange mx-auto mb-4 animate-spin"}),f.jsx("h3",{className:"text-xl font-spooky text-ghostlyWhite mb-2",children:"Claiming Rewards..."}),f.jsx("p",{className:"text-ghostlyWhite/60",children:"Please wait and approve any wallet popups"})]},"claiming"),k==="nft-success"&&F&&f.jsxs(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",duration:.8},className:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500 to-pumpkinOrange flex items-center justify-center",children:f.jsx(Ho,{className:"w-12 h-12 text-white"})}),f.jsx("h3",{className:"text-2xl font-spooky text-purple-400 mb-2",children:"Halloween NFT Minted!"}),f.jsxs("p",{className:"text-ghostlyWhite/70 mb-2",children:["Token #",F.tokenId]}),f.jsx("p",{className:"text-ghostlyWhite/50 text-sm mb-6",children:t.name}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("button",{onClick:re,className:"w-full py-3 px-6 bg-gradient-to-r from-purple-600 to-purple-800 text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(vp,{className:"w-5 h-5"})," Add NFT to MetaMask"]}),f.jsxs("a",{href:ae,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-6 bg-deepPurple/50 text-ghostlyWhite font-medium rounded-xl hover:bg-deepPurple/70 transition-colors border border-ghostlyWhite/20 flex items-center justify-center gap-2",children:[f.jsx(Jo,{className:"w-5 h-5"})," View on Etherscan"]}),f.jsxs("button",{onClick:xe,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(la,{className:"w-5 h-5"})," Done - Close & Refresh"]})]})]},"nft-success"),k==="complete"&&f.jsxs(it.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0},className:"text-center",children:[f.jsx(it.div,{initial:{scale:0},animate:{scale:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-toxicGreen/20 flex items-center justify-center",children:f.jsx(la,{className:"w-10 h-10 text-toxicGreen"})}),f.jsx("h3",{className:"text-2xl font-spooky text-toxicGreen mb-2",children:"All Rewards Claimed!"}),f.jsxs("p",{className:"text-ghostlyWhite/70 mb-6",children:["+",D==null?void 0:D.xp," XP, +",D==null?void 0:D.tpx," TPX"]}),f.jsxs("button",{onClick:xe,className:"w-full py-3 px-6 bg-gradient-to-r from-pumpkinOrange to-bloodOrange text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[f.jsx(la,{className:"w-5 h-5"})," Done - Close & Refresh"]})]},"complete")]})})]})});return typeof document<"u"?CA.createPortal(ce,document.body):ce},v1e=({onNavigate:t})=>{const{user:e,address:n}=ba(),{user:s}=El(),l=e||s,[u,p]=he.useState([]),[r,v]=he.useState([]),[w,E]=he.useState([]),[T,k]=he.useState([]),[R,D]=he.useState(!0),[O,F]=he.useState(0),[U,X]=he.useState(!1),[W,K]=he.useState("quest"),[ne,te]=he.useState(null),[re,xe]=he.useState(null),[ae,ce]=he.useState(null);he.useEffect(()=>{const He=(l==null?void 0:l.id)||null;o1e(He),hr(()=>Promise.resolve().then(()=>Jve),void 0).then(qe=>{qe.setCurrentUser(He)}),He&&l1e().then(()=>{ye()})},[l==null?void 0:l.id]),he.useEffect(()=>{l!=null&&l.id||ye()},[]),he.useEffect(()=>{Ce()},[u,O]);const ye=()=>{D(!0);try{const He=n1e(),qe=i1e(),Le=M2();p(He),k(qe.map(st=>st.id)),v(Le)}catch(He){console.error("Error loading destinations:",He)}finally{D(!1)}},Ce=()=>{let He=[...u];O>0&&(He=He.filter(qe=>qe.spookinessRating>=O)),He.sort((qe,Le)=>Le.spookinessRating-qe.spookinessRating),E(He)},Me=He=>r.find(qe=>qe.destinationId===He),Ke=async He=>{const qe=Me(He);if(!qe)return;if(!l){dr.error("Please connect your wallet to start quests");return}const Le=c1e(qe.id);if(Le){try{const{addQuestToUser:st}=await hr(async()=>{const{addQuestToUser:Vt}=await Promise.resolve().then(()=>uve);return{addQuestToUser:Vt}},void 0),bt=u.find(Vt=>Vt.id===He),yt={id:`spooky-${He}`,title:Le.title,description:Le.description,category:"halloween",difficulty:Le.difficulty,xp_reward:Le.xpReward,token_reward:Le.tpxReward,nft_reward:Le.nftReward,location:(bt==null?void 0:bt.location)||"Unknown",latitude:(bt==null?void 0:bt.coordinates.lat)||0,longitude:(bt==null?void 0:bt.coordinates.lng)||0,requirements:Le.requirements};await st(l.id,yt),dr.success("Quest Started! ",{description:"Quest added to My Quests. Visit the location to complete it!"})}catch(st){console.error("Error adding quest to user:",st),dr.success("Quest Started!",{description:`You've started the quest for ${Le.title}`})}ye()}},ke=async He=>{if(!Me(He))return;if(!l){dr.error("Please connect your wallet first");return}if(!n){dr.error("Please connect your wallet to complete quests");return}const Le=u.find(st=>st.id===He);Le&&(ce(Le),te(null))},je=async He=>{var Le;if(!l||!n){dr.error("Please connect your wallet to claim rewards");return}const qe=Me(He);if(qe){xe(qe.id);try{const st=await JT(qe.id,l==null?void 0:l.id);if(st.success&&st.rewards){if(K("achievement"),X(!0),dr.success("Rewards Claimed! ",{description:`+${st.rewards.xp} XP, +${st.rewards.tpx} TPX${st.rewards.nft?", +1 NFT":""}`,duration:5e3}),st.rewards.nft&&st.rewards.nftImageUrl)try{const{mintAchievementAPI:bt}=await hr(async()=>{const{mintAchievementAPI:Vt}=await Promise.resolve().then(()=>BE);return{mintAchievementAPI:Vt}},void 0),yt=await bt(l.id,`spooky-${He}`,n);yt.success&&dr.success("NFT Minted! ",{description:`Token #${(Le=yt.data)==null?void 0:Le.tokenId} minted successfully!`,action:{label:"View on Etherscan",onClick:()=>{var Vt;return window.open(`https://sepolia.etherscan.io/tx/${(Vt=yt.data)==null?void 0:Vt.txHash}`,"_blank")}}})}catch(bt){console.error("NFT mint error:",bt)}if(st.rewards.tpx>0)try{const{claimQuestRewardAPI:bt}=await hr(async()=>{const{claimQuestRewardAPI:yt}=await Promise.resolve().then(()=>BE);return{claimQuestRewardAPI:yt}},void 0);await bt(l.id,`spooky-${He}`,n,st.rewards.tpx)}catch(bt){console.error("TPX claim error:",bt)}ye()}else dr.error("Failed to claim rewards",{description:st.error})}finally{xe(null)}}},$e=s1e(),Ae=d1e();return R?f.jsx("div",{className:"flex items-center justify-center min-h-screen",children:f.jsx(Bw,{variant:"ghost",text:"Loading spooky destinations..."})}):f.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[f.jsxs(it.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[f.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[f.jsx(Za,{name:"hauntedCastle",size:48,className:"text-pumpkinOrange"}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-spooky text-ghostlyWhite tracking-wider",children:"Spooky Destinations"}),f.jsx("p",{className:"text-ghostlyWhite/70 text-lg",children:"Explore haunted locations, complete quests, earn NFTs & TPX tokens"})]})]}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[f.jsxs(it.div,{whileHover:{scale:1.02},className:"bg-deepPurple/40 backdrop-blur-xl rounded-xl p-4 border border-pumpkinOrange/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(Mo,{className:"w-5 h-5 text-pumpkinOrange"}),f.jsx("span",{className:"text-ghostlyWhite/70 text-sm",children:"Destinations"})]}),f.jsx("div",{className:"text-3xl font-bold text-pumpkinOrange",children:$e.total})]}),f.jsxs(it.div,{whileHover:{scale:1.02},className:"bg-deepPurple/40 backdrop-blur-xl rounded-xl p-4 border border-toxicGreen/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(la,{className:"w-5 h-5 text-toxicGreen"}),f.jsx("span",{className:"text-ghostlyWhite/70 text-sm",children:"Visited"})]}),f.jsx("div",{className:"text-3xl font-bold text-toxicGreen",children:$e.visited})]}),f.jsxs(it.div,{whileHover:{scale:1.02},className:"bg-deepPurple/40 backdrop-blur-xl rounded-xl p-4 border border-bloodOrange/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(Ja,{className:"w-5 h-5 text-bloodOrange"}),f.jsx("span",{className:"text-ghostlyWhite/70 text-sm",children:"Quests Done"})]}),f.jsx("div",{className:"text-3xl font-bold text-bloodOrange",children:Ae.claimed})]}),f.jsxs(it.div,{whileHover:{scale:1.02},className:"bg-deepPurple/40 backdrop-blur-xl rounded-xl p-4 border border-purple-500/30",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx(Ya,{className:"w-5 h-5 text-purple-400"}),f.jsx("span",{className:"text-ghostlyWhite/70 text-sm",children:"TPX Earned"})]}),f.jsx("div",{className:"text-3xl font-bold text-purple-400",children:Ae.earnedTPX})]})]}),f.jsx("div",{className:"bg-gradient-to-r from-deepPurple/60 to-midnightBlue/60 backdrop-blur-xl rounded-xl p-4 border border-ghostlyWhite/10 mb-6",children:f.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(Ho,{className:"w-6 h-6 text-pumpkinOrange"}),f.jsx("span",{className:"text-ghostlyWhite font-medium",children:"Total Rewards Available:"})]}),f.jsxs("div",{className:"flex items-center gap-6",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(md,{className:"w-5 h-5 text-yellow-400"}),f.jsxs("span",{className:"text-yellow-400 font-bold",children:[Ae.totalXPAvailable," XP"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Ya,{className:"w-5 h-5 text-pumpkinOrange"}),f.jsxs("span",{className:"text-pumpkinOrange font-bold",children:[Ae.totalTPXAvailable," TPX"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(vp,{className:"w-5 h-5 text-purple-400"}),f.jsxs("span",{className:"text-purple-400 font-bold",children:[$e.total," NFTs"]})]})]})]})}),f.jsxs("div",{className:"flex items-center gap-4 bg-deepPurple/30 backdrop-blur-lg rounded-xl p-4 border border-ghostlyWhite/10",children:[f.jsx(I$,{className:"w-5 h-5 text-ghostlyWhite"}),f.jsx("span",{className:"text-ghostlyWhite font-medium",children:"Min Spookiness:"}),f.jsx("div",{className:"flex gap-2",children:[0,1,2,3,4,5].map(He=>f.jsx("button",{onClick:()=>F(He),className:`px-3 py-1.5 rounded-lg transition-all ${O===He?"bg-pumpkinOrange text-deepPurple font-bold shadow-lg shadow-pumpkinOrange/30":"bg-deepPurple/50 text-ghostlyWhite/70 hover:bg-deepPurple/70 hover:text-ghostlyWhite"}`,children:He===0?"All":f.jsxs("span",{className:"flex items-center gap-1",children:[He," ",f.jsx(Yk,{className:"w-3 h-3"})]})},He))})]})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map((He,qe)=>{const Le=Me(He.id),st=T.includes(He.id);return f.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:qe*.05},children:f.jsx(t1e,{destination:He,isVisited:st,quest:Le,onStartQuest:()=>Ke(He.id),onCompleteQuest:()=>ke(He.id),onClaimRewards:()=>je(He.id),onViewDetails:()=>te(He),isClaimingRewards:re===(Le==null?void 0:Le.id)})},He.id)})}),w.length===0&&f.jsxs(it.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[f.jsx(Za,{name:"ghost",size:64,className:"text-ghostlyWhite/30 mx-auto mb-4"}),f.jsx("p",{className:"text-ghostlyWhite/70 text-lg",children:"No destinations match your filter. Try adjusting the spookiness level."})]}),f.jsx(Xc,{children:ne&&f.jsx(b1e,{destination:ne,quest:Me(ne.id),isVisited:T.includes(ne.id),onClose:()=>te(null),onStartQuest:()=>{Ke(ne.id),te(null)},onCompleteQuest:()=>{ke(ne.id),te(null)},onClaimRewards:()=>{je(ne.id),te(null)}})}),f.jsx(Xc,{children:ae&&l&&n&&f.jsx(_1e,{destination:ae,quest:Me(ae.id),userId:l.id,walletAddress:n,onClose:()=>ce(null),onComplete:()=>{K("achievement"),X(!0),ye()}})}),U&&f.jsx(XA,{type:W,onComplete:()=>X(!1)})]})},b1e=({destination:t,quest:e,isVisited:n,onClose:s,onStartQuest:l,onCompleteQuest:u,onClaimRewards:p})=>{const r=f.jsx(it.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm overflow-y-auto",style:{position:"fixed",top:0,left:0,right:0,bottom:0},onClick:s,children:f.jsxs(it.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},onClick:v=>v.stopPropagation(),className:"bg-gradient-to-br from-deepPurple to-midnightBlue border border-pumpkinOrange/30 rounded-2xl max-w-2xl w-full max-h-[85vh] overflow-y-auto shadow-2xl my-auto",style:{margin:"auto"},children:[f.jsxs("div",{className:"relative h-56",children:[f.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-deepPurple via-transparent to-transparent"}),f.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 transition-colors",children:f.jsx(Qa,{className:"w-5 h-5 text-white"})}),f.jsx("div",{className:"absolute top-4 left-4 flex items-center gap-1 bg-black/50 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[...Array(5)].map((v,w)=>f.jsx(Yk,{className:`w-4 h-4 ${w<t.spookinessRating?"text-bloodOrange":"text-white/20"}`},w))}),n&&f.jsxs("div",{className:"absolute bottom-4 right-4 bg-toxicGreen/90 text-deepPurple px-4 py-2 rounded-full font-bold flex items-center gap-2",children:[f.jsx(la,{className:"w-5 h-5"}),"Visited"]})]}),f.jsxs("div",{className:"p-6",children:[f.jsx("h2",{className:"text-3xl font-spooky text-ghostlyWhite mb-2",children:t.name}),f.jsxs("div",{className:"flex items-center gap-2 text-ghostlyWhite/70 mb-4",children:[f.jsx(Mo,{className:"w-4 h-4"}),f.jsxs("span",{children:[t.location,", ",t.country]})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx(x1e,{latitude:t.coordinates.lat,longitude:t.coordinates.lng,name:t.name,className:"w-full h-56 rounded-xl",showPulse:!0}),f.jsxs("div",{className:"bg-deepPurple/30 px-4 py-2 rounded-b-xl -mt-2 flex items-center justify-between border border-t-0 border-ghostlyWhite/10",children:[f.jsxs("span",{className:"text-ghostlyWhite/60 text-xs",children:[" ",t.coordinates.lat.toFixed(4),", ",t.coordinates.lng.toFixed(4)]}),f.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${t.coordinates.lat},${t.coordinates.lng}`,target:"_blank",rel:"noopener noreferrer",className:"text-pumpkinOrange text-xs hover:underline flex items-center gap-1",children:["Open in Maps ",f.jsx(Jo,{className:"w-3 h-3"})]})]})]}),f.jsx("p",{className:"text-ghostlyWhite/80 mb-6",children:t.description}),f.jsxs("div",{className:"bg-deepPurple/50 rounded-xl p-4 mb-6 border border-ghostlyWhite/10",children:[f.jsx("h3",{className:"text-lg font-bold text-pumpkinOrange mb-2",children:"Historical Background"}),f.jsx("p",{className:"text-ghostlyWhite/70 text-sm",children:t.historicalBackground})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h3",{className:"text-lg font-bold text-ghostlyWhite mb-3",children:"Spooky Activities"}),f.jsx("div",{className:"space-y-3",children:t.activities.map((v,w)=>f.jsxs("div",{className:"bg-deepPurple/30 rounded-lg p-3 border border-ghostlyWhite/10",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("span",{className:"font-medium text-ghostlyWhite",children:v.name}),f.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((E,T)=>f.jsx(Yk,{className:`w-3 h-3 ${T<v.spookinessLevel?"text-bloodOrange":"text-white/20"}`},T))})]}),f.jsx("p",{className:"text-ghostlyWhite/60 text-sm",children:v.description}),f.jsx("span",{className:"text-ghostlyWhite/40 text-xs",children:v.duration})]},w))})]}),e&&f.jsxs("div",{className:"bg-gradient-to-r from-pumpkinOrange/20 to-bloodOrange/20 rounded-xl p-4 mb-6 border border-pumpkinOrange/30",children:[f.jsxs("h3",{className:"text-lg font-bold text-pumpkinOrange mb-3 flex items-center gap-2",children:[f.jsx(Ja,{className:"w-5 h-5"}),"Quest Rewards"]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:e.xpReward}),f.jsx("div",{className:"text-ghostlyWhite/60 text-sm",children:"XP"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-pumpkinOrange",children:e.tpxReward}),f.jsx("div",{className:"text-ghostlyWhite/60 text-sm",children:"TPX"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"1"}),f.jsx("div",{className:"text-ghostlyWhite/60 text-sm",children:"NFT"})]})]}),f.jsx("div",{className:"mt-4 pt-4 border-t border-pumpkinOrange/20",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-ghostlyWhite/70",children:"Status:"}),f.jsx("span",{className:`font-medium ${e.status==="claimed"?"text-toxicGreen":e.status==="completed"?"text-yellow-400":e.status==="in_progress"?"text-pumpkinOrange":"text-ghostlyWhite/50"}`,children:e.status==="claimed"?" Rewards Claimed":e.status==="completed"?" Ready to Claim":e.status==="in_progress"?" In Progress":" Available"})]})})]}),f.jsxs("div",{className:"flex gap-3",children:[(e==null?void 0:e.status)==="available"&&f.jsx(Vc,{variant:"primary",onClick:l,className:"flex-1",children:"Start Quest"}),(e==null?void 0:e.status)==="in_progress"&&f.jsxs(Vc,{variant:"primary",onClick:u,className:"flex-1",children:[f.jsx(Rw,{className:"w-4 h-4 mr-2"}),"Verify & Complete",f.jsx(Sx,{className:"w-4 h-4 ml-2"})]}),(e==null?void 0:e.status)==="completed"&&f.jsxs(Vc,{variant:"primary",onClick:p,className:"flex-1",children:[f.jsx(vp,{className:"w-4 h-4 mr-2"}),"Claim Rewards"]}),(e==null?void 0:e.status)==="claimed"&&f.jsx("div",{className:"flex-1 text-center py-3 bg-toxicGreen/20 rounded-xl border border-toxicGreen/30",children:f.jsx("span",{className:"text-toxicGreen font-medium",children:" All Rewards Claimed!"})})]})]})]})});return typeof document<"u"?CA.createPortal(r,document.body):r},w1e=()=>{const[t,e]=he.useState("dashboard"),[n,s]=he.useState([]),[l,u]=he.useState(null),p=(w,E)=>{e(w),w==="transit"&&E&&u(E)};he.useEffect(()=>{const w=E=>{p("transit",E.detail)};return window.addEventListener("navigateToTransit",w),()=>{window.removeEventListener("navigateToTransit",w)}},[]);const r=w=>{s(w.quests)},v=()=>{switch(t){case"dashboard":return f.jsx(mz,{onNavigate:p});case"transit":return f.jsx(wbe,{transitParams:l});case"create":return f.jsx(Cve,{onTripGenerated:r,onNavigate:p});case"trips":return f.jsx(Uve,{onNavigate:p});case"quests":return f.jsx(Lve,{onNavigate:p});case"profile":return f.jsx(rbe,{onNavigate:p});case"leaderboard":return f.jsx(sbe,{});case"achievements":return f.jsx(lbe,{});case"spooky":return f.jsx(v1e,{onNavigate:p});case"admin":return f.jsx(kz,{onNavigate:p});default:return f.jsx(mz,{onNavigate:p})}};return t==="admin"?f.jsx(kz,{onNavigate:p}):f.jsx(m_e,{currentPage:t,onNavigate:p,children:v()})};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const FN="181",S1e=0,Nz=1,T1e=2,sq=1,E1e=2,Rm=3,W0=0,wu=1,zm=2,Km=0,Pv=1,HE=2,jz=3,Dz=4,A1e=5,tx=100,C1e=101,M1e=102,k1e=103,I1e=104,P1e=200,R1e=201,N1e=202,j1e=203,_I=204,vI=205,D1e=206,L1e=207,O1e=208,F1e=209,B1e=210,z1e=211,U1e=212,V1e=213,H1e=214,bI=0,wI=1,SI=2,sb=3,TI=4,EI=5,AI=6,CI=7,oq=0,G1e=1,$1e=2,B0=0,W1e=1,q1e=2,X1e=3,Z1e=4,Q1e=5,K1e=6,Y1e=7,aq=300,ob=301,ab=302,MI=303,kI=304,YA=306,II=1e3,Vm=1001,PI=1002,ud=1003,J1e=1004,uT=1005,rh=1006,QM=1007,cx=1008,og=1009,lq=1010,cq=1011,Uw=1012,BN=1013,Gx=1014,Hm=1015,Eb=1016,zN=1017,UN=1018,Vw=1020,uq=35902,dq=35899,hq=1021,fq=1022,uf=1023,Hw=1026,Gw=1027,pq=1028,VN=1029,HN=1030,GN=1031,$N=1033,eE=33776,tE=33777,nE=33778,rE=33779,RI=35840,NI=35841,jI=35842,DI=35843,LI=36196,OI=37492,FI=37496,BI=37808,zI=37809,UI=37810,VI=37811,HI=37812,GI=37813,$I=37814,WI=37815,qI=37816,XI=37817,ZI=37818,QI=37819,KI=37820,YI=37821,JI=36492,eP=36494,tP=36495,nP=36283,rP=36284,iP=36285,sP=36286,ewe=3200,twe=3201,nwe=0,rwe=1,T0="",Yd="srgb",lb="srgb-linear",GE="linear",fo="srgb",Y_=7680,Lz=519,iwe=512,swe=513,owe=514,mq=515,awe=516,lwe=517,cwe=518,uwe=519,Oz=35044,Fz="300 es",gp=2e3,$E=2001;function gq(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function WE(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function dwe(){const t=WE("canvas");return t.style.display="block",t}const Bz={};function zz(...t){const e="THREE."+t.shift();console.log(e,...t)}function us(...t){const e="THREE."+t.shift();console.warn(e,...t)}function xa(...t){const e="THREE."+t.shift();console.error(e,...t)}function $w(...t){const e=t.join(" ");e in Bz||(Bz[e]=!0,us(...t))}function hwe(t,e,n){return new Promise(function(s,l){function u(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:l();break;case t.TIMEOUT_EXPIRED:setTimeout(u,n);break;default:s()}}setTimeout(u,n)})}class Ab{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n)}hasEventListener(e,n){const s=this._listeners;return s===void 0?!1:s[e]!==void 0&&s[e].indexOf(n)!==-1}removeEventListener(e,n){const s=this._listeners;if(s===void 0)return;const l=s[e];if(l!==void 0){const u=l.indexOf(n);u!==-1&&l.splice(u,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const s=n[e.type];if(s!==void 0){e.target=this;const l=s.slice(0);for(let u=0,p=l.length;u<p;u++)l[u].call(this,e);e.target=null}}}const dc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],KM=Math.PI/180,oP=180/Math.PI;function k2(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(dc[t&255]+dc[t>>8&255]+dc[t>>16&255]+dc[t>>24&255]+"-"+dc[e&255]+dc[e>>8&255]+"-"+dc[e>>16&15|64]+dc[e>>24&255]+"-"+dc[n&63|128]+dc[n>>8&255]+"-"+dc[n>>16&255]+dc[n>>24&255]+dc[s&255]+dc[s>>8&255]+dc[s>>16&255]+dc[s>>24&255]).toLowerCase()}function Us(t,e,n){return Math.max(e,Math.min(n,t))}function fwe(t,e){return(t%e+e)%e}function YM(t,e,n){return(1-n)*t+n*e}function M1(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function pu(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}class po{constructor(e=0,n=0){po.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,s=this.y,l=e.elements;return this.x=l[0]*n+l[3]*s+l[6],this.y=l[1]*n+l[4]*s+l[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Us(this.x,e.x,n.x),this.y=Us(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Us(this.x,e,n),this.y=Us(this.y,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Us(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const s=this.dot(e)/n;return Math.acos(Us(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,s=this.y-e.y;return n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const s=Math.cos(n),l=Math.sin(n),u=this.x-e.x,p=this.y-e.y;return this.x=u*s-p*l+e.x,this.y=u*l+p*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class I2{constructor(e=0,n=0,s=0,l=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=s,this._w=l}static slerpFlat(e,n,s,l,u,p,r){let v=s[l+0],w=s[l+1],E=s[l+2],T=s[l+3],k=u[p+0],R=u[p+1],D=u[p+2],O=u[p+3];if(r<=0){e[n+0]=v,e[n+1]=w,e[n+2]=E,e[n+3]=T;return}if(r>=1){e[n+0]=k,e[n+1]=R,e[n+2]=D,e[n+3]=O;return}if(T!==O||v!==k||w!==R||E!==D){let F=v*k+w*R+E*D+T*O;F<0&&(k=-k,R=-R,D=-D,O=-O,F=-F);let U=1-r;if(F<.9995){const X=Math.acos(F),W=Math.sin(X);U=Math.sin(U*X)/W,r=Math.sin(r*X)/W,v=v*U+k*r,w=w*U+R*r,E=E*U+D*r,T=T*U+O*r}else{v=v*U+k*r,w=w*U+R*r,E=E*U+D*r,T=T*U+O*r;const X=1/Math.sqrt(v*v+w*w+E*E+T*T);v*=X,w*=X,E*=X,T*=X}}e[n]=v,e[n+1]=w,e[n+2]=E,e[n+3]=T}static multiplyQuaternionsFlat(e,n,s,l,u,p){const r=s[l],v=s[l+1],w=s[l+2],E=s[l+3],T=u[p],k=u[p+1],R=u[p+2],D=u[p+3];return e[n]=r*D+E*T+v*R-w*k,e[n+1]=v*D+E*k+w*T-r*R,e[n+2]=w*D+E*R+r*k-v*T,e[n+3]=E*D-r*T-v*k-w*R,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,s,l){return this._x=e,this._y=n,this._z=s,this._w=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const s=e._x,l=e._y,u=e._z,p=e._order,r=Math.cos,v=Math.sin,w=r(s/2),E=r(l/2),T=r(u/2),k=v(s/2),R=v(l/2),D=v(u/2);switch(p){case"XYZ":this._x=k*E*T+w*R*D,this._y=w*R*T-k*E*D,this._z=w*E*D+k*R*T,this._w=w*E*T-k*R*D;break;case"YXZ":this._x=k*E*T+w*R*D,this._y=w*R*T-k*E*D,this._z=w*E*D-k*R*T,this._w=w*E*T+k*R*D;break;case"ZXY":this._x=k*E*T-w*R*D,this._y=w*R*T+k*E*D,this._z=w*E*D+k*R*T,this._w=w*E*T-k*R*D;break;case"ZYX":this._x=k*E*T-w*R*D,this._y=w*R*T+k*E*D,this._z=w*E*D-k*R*T,this._w=w*E*T+k*R*D;break;case"YZX":this._x=k*E*T+w*R*D,this._y=w*R*T+k*E*D,this._z=w*E*D-k*R*T,this._w=w*E*T-k*R*D;break;case"XZY":this._x=k*E*T-w*R*D,this._y=w*R*T-k*E*D,this._z=w*E*D+k*R*T,this._w=w*E*T+k*R*D;break;default:us("Quaternion: .setFromEuler() encountered an unknown order: "+p)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const s=n/2,l=Math.sin(s);return this._x=e.x*l,this._y=e.y*l,this._z=e.z*l,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,s=n[0],l=n[4],u=n[8],p=n[1],r=n[5],v=n[9],w=n[2],E=n[6],T=n[10],k=s+r+T;if(k>0){const R=.5/Math.sqrt(k+1);this._w=.25/R,this._x=(E-v)*R,this._y=(u-w)*R,this._z=(p-l)*R}else if(s>r&&s>T){const R=2*Math.sqrt(1+s-r-T);this._w=(E-v)/R,this._x=.25*R,this._y=(l+p)/R,this._z=(u+w)/R}else if(r>T){const R=2*Math.sqrt(1+r-s-T);this._w=(u-w)/R,this._x=(l+p)/R,this._y=.25*R,this._z=(v+E)/R}else{const R=2*Math.sqrt(1+T-s-r);this._w=(p-l)/R,this._x=(u+w)/R,this._y=(v+E)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let s=e.dot(n)+1;return s<1e-8?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Us(this.dot(e),-1,1)))}rotateTowards(e,n){const s=this.angleTo(e);if(s===0)return this;const l=Math.min(1,n/s);return this.slerp(e,l),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const s=e._x,l=e._y,u=e._z,p=e._w,r=n._x,v=n._y,w=n._z,E=n._w;return this._x=s*E+p*r+l*w-u*v,this._y=l*E+p*v+u*r-s*w,this._z=u*E+p*w+s*v-l*r,this._w=p*E-s*r-l*v-u*w,this._onChangeCallback(),this}slerp(e,n){if(n<=0)return this;if(n>=1)return this.copy(e);let s=e._x,l=e._y,u=e._z,p=e._w,r=this.dot(e);r<0&&(s=-s,l=-l,u=-u,p=-p,r=-r);let v=1-n;if(r<.9995){const w=Math.acos(r),E=Math.sin(w);v=Math.sin(v*w)/E,n=Math.sin(n*w)/E,this._x=this._x*v+s*n,this._y=this._y*v+l*n,this._z=this._z*v+u*n,this._w=this._w*v+p*n,this._onChangeCallback()}else this._x=this._x*v+s*n,this._y=this._y*v+l*n,this._z=this._z*v+u*n,this._w=this._w*v+p*n,this.normalize();return this}slerpQuaternions(e,n,s){return this.copy(e).slerp(n,s)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),s=Math.random(),l=Math.sqrt(1-s),u=Math.sqrt(s);return this.set(l*Math.sin(e),l*Math.cos(e),u*Math.sin(n),u*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ln{constructor(e=0,n=0,s=0){Ln.prototype.isVector3=!0,this.x=e,this.y=n,this.z=s}set(e,n,s){return s===void 0&&(s=this.z),this.x=e,this.y=n,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(Uz.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(Uz.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,s=this.y,l=this.z,u=e.elements;return this.x=u[0]*n+u[3]*s+u[6]*l,this.y=u[1]*n+u[4]*s+u[7]*l,this.z=u[2]*n+u[5]*s+u[8]*l,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,s=this.y,l=this.z,u=e.elements,p=1/(u[3]*n+u[7]*s+u[11]*l+u[15]);return this.x=(u[0]*n+u[4]*s+u[8]*l+u[12])*p,this.y=(u[1]*n+u[5]*s+u[9]*l+u[13])*p,this.z=(u[2]*n+u[6]*s+u[10]*l+u[14])*p,this}applyQuaternion(e){const n=this.x,s=this.y,l=this.z,u=e.x,p=e.y,r=e.z,v=e.w,w=2*(p*l-r*s),E=2*(r*n-u*l),T=2*(u*s-p*n);return this.x=n+v*w+p*T-r*E,this.y=s+v*E+r*w-u*T,this.z=l+v*T+u*E-p*w,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,s=this.y,l=this.z,u=e.elements;return this.x=u[0]*n+u[4]*s+u[8]*l,this.y=u[1]*n+u[5]*s+u[9]*l,this.z=u[2]*n+u[6]*s+u[10]*l,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Us(this.x,e.x,n.x),this.y=Us(this.y,e.y,n.y),this.z=Us(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=Us(this.x,e,n),this.y=Us(this.y,e,n),this.z=Us(this.z,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Us(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this.z=e.z+(n.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const s=e.x,l=e.y,u=e.z,p=n.x,r=n.y,v=n.z;return this.x=l*v-u*r,this.y=u*p-s*v,this.z=s*r-l*p,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const s=e.dot(this)/n;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return JM.copy(this).projectOnVector(e),this.sub(JM)}reflect(e){return this.sub(JM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const s=this.dot(e)/n;return Math.acos(Us(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,s=this.y-e.y,l=this.z-e.z;return n*n+s*s+l*l}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,s){const l=Math.sin(n)*e;return this.x=l*Math.sin(s),this.y=Math.cos(n)*e,this.z=l*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,s){return this.x=e*Math.sin(n),this.y=s,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),l=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=s,this.z=l,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,s=Math.sqrt(1-n*n);return this.x=s*Math.cos(e),this.y=n,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const JM=new Ln,Uz=new I2;class ms{constructor(e,n,s,l,u,p,r,v,w){ms.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,s,l,u,p,r,v,w)}set(e,n,s,l,u,p,r,v,w){const E=this.elements;return E[0]=e,E[1]=l,E[2]=r,E[3]=n,E[4]=u,E[5]=v,E[6]=s,E[7]=p,E[8]=w,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,s=e.elements;return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],this}extractBasis(e,n,s){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const s=e.elements,l=n.elements,u=this.elements,p=s[0],r=s[3],v=s[6],w=s[1],E=s[4],T=s[7],k=s[2],R=s[5],D=s[8],O=l[0],F=l[3],U=l[6],X=l[1],W=l[4],K=l[7],ne=l[2],te=l[5],re=l[8];return u[0]=p*O+r*X+v*ne,u[3]=p*F+r*W+v*te,u[6]=p*U+r*K+v*re,u[1]=w*O+E*X+T*ne,u[4]=w*F+E*W+T*te,u[7]=w*U+E*K+T*re,u[2]=k*O+R*X+D*ne,u[5]=k*F+R*W+D*te,u[8]=k*U+R*K+D*re,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],s=e[1],l=e[2],u=e[3],p=e[4],r=e[5],v=e[6],w=e[7],E=e[8];return n*p*E-n*r*w-s*u*E+s*r*v+l*u*w-l*p*v}invert(){const e=this.elements,n=e[0],s=e[1],l=e[2],u=e[3],p=e[4],r=e[5],v=e[6],w=e[7],E=e[8],T=E*p-r*w,k=r*v-E*u,R=w*u-p*v,D=n*T+s*k+l*R;if(D===0)return this.set(0,0,0,0,0,0,0,0,0);const O=1/D;return e[0]=T*O,e[1]=(l*w-E*s)*O,e[2]=(r*s-l*p)*O,e[3]=k*O,e[4]=(E*n-l*v)*O,e[5]=(l*u-r*n)*O,e[6]=R*O,e[7]=(s*v-w*n)*O,e[8]=(p*n-s*u)*O,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,s,l,u,p,r){const v=Math.cos(u),w=Math.sin(u);return this.set(s*v,s*w,-s*(v*p+w*r)+p+e,-l*w,l*v,-l*(-w*p+v*r)+r+n,0,0,1),this}scale(e,n){return this.premultiply(e5.makeScale(e,n)),this}rotate(e){return this.premultiply(e5.makeRotation(-e)),this}translate(e,n){return this.premultiply(e5.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,-s,0,s,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,s=e.elements;for(let l=0;l<9;l++)if(n[l]!==s[l])return!1;return!0}fromArray(e,n=0){for(let s=0;s<9;s++)this.elements[s]=e[s+n];return this}toArray(e=[],n=0){const s=this.elements;return e[n]=s[0],e[n+1]=s[1],e[n+2]=s[2],e[n+3]=s[3],e[n+4]=s[4],e[n+5]=s[5],e[n+6]=s[6],e[n+7]=s[7],e[n+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const e5=new ms,Vz=new ms().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Hz=new ms().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function pwe(){const t={enabled:!0,workingColorSpace:lb,spaces:{},convert:function(l,u,p){return this.enabled===!1||u===p||!u||!p||(this.spaces[u].transfer===fo&&(l.r=Ym(l.r),l.g=Ym(l.g),l.b=Ym(l.b)),this.spaces[u].primaries!==this.spaces[p].primaries&&(l.applyMatrix3(this.spaces[u].toXYZ),l.applyMatrix3(this.spaces[p].fromXYZ)),this.spaces[p].transfer===fo&&(l.r=Rv(l.r),l.g=Rv(l.g),l.b=Rv(l.b))),l},workingToColorSpace:function(l,u){return this.convert(l,this.workingColorSpace,u)},colorSpaceToWorking:function(l,u){return this.convert(l,u,this.workingColorSpace)},getPrimaries:function(l){return this.spaces[l].primaries},getTransfer:function(l){return l===T0?GE:this.spaces[l].transfer},getToneMappingMode:function(l){return this.spaces[l].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(l,u=this.workingColorSpace){return l.fromArray(this.spaces[u].luminanceCoefficients)},define:function(l){Object.assign(this.spaces,l)},_getMatrix:function(l,u,p){return l.copy(this.spaces[u].toXYZ).multiply(this.spaces[p].fromXYZ)},_getDrawingBufferColorSpace:function(l){return this.spaces[l].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(l=this.workingColorSpace){return this.spaces[l].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(l,u){return $w("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(l,u)},toWorkingColorSpace:function(l,u){return $w("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(l,u)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],s=[.3127,.329];return t.define({[lb]:{primaries:e,whitePoint:s,transfer:GE,toXYZ:Vz,fromXYZ:Hz,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Yd},outputColorSpaceConfig:{drawingBufferColorSpace:Yd}},[Yd]:{primaries:e,whitePoint:s,transfer:fo,toXYZ:Vz,fromXYZ:Hz,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Yd}}}),t}const Js=pwe();function Ym(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Rv(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let J_;class mwe{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{J_===void 0&&(J_=WE("canvas")),J_.width=e.width,J_.height=e.height;const l=J_.getContext("2d");e instanceof ImageData?l.putImageData(e,0,0):l.drawImage(e,0,0,e.width,e.height),s=J_}return s.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=WE("canvas");n.width=e.width,n.height=e.height;const s=n.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const l=s.getImageData(0,0,e.width,e.height),u=l.data;for(let p=0;p<u.length;p++)u[p]=Ym(u[p]/255)*255;return s.putImageData(l,0,0),n}else if(e.data){const n=e.data.slice(0);for(let s=0;s<n.length;s++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[s]=Math.floor(Ym(n[s]/255)*255):n[s]=Ym(n[s]);return{data:n,width:e.width,height:e.height}}else return us("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let gwe=0;class WN{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:gwe++}),this.uuid=k2(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const n=this.data;return typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?e.set(n.videoWidth,n.videoHeight,0):n instanceof VideoFrame?e.set(n.displayHeight,n.displayWidth,0):n!==null?e.set(n.width,n.height,n.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},l=this.data;if(l!==null){let u;if(Array.isArray(l)){u=[];for(let p=0,r=l.length;p<r;p++)l[p].isDataTexture?u.push(t5(l[p].image)):u.push(t5(l[p]))}else u=t5(l);s.url=u}return n||(e.images[this.uuid]=s),s}}function t5(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?mwe.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(us("Texture: Unable to serialize Texture."),{})}let ywe=0;const n5=new Ln;class $c extends Ab{constructor(e=$c.DEFAULT_IMAGE,n=$c.DEFAULT_MAPPING,s=Vm,l=Vm,u=rh,p=cx,r=uf,v=og,w=$c.DEFAULT_ANISOTROPY,E=T0){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ywe++}),this.uuid=k2(),this.name="",this.source=new WN(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=s,this.wrapT=l,this.magFilter=u,this.minFilter=p,this.anisotropy=w,this.format=r,this.internalFormat=null,this.type=v,this.offset=new po(0,0),this.repeat=new po(1,1),this.center=new po(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ms,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=E,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(n5).x}get height(){return this.source.getSize(n5).y}get depth(){return this.source.getSize(n5).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const n in e){const s=e[n];if(s===void 0){us(`Texture.setValues(): parameter '${n}' has value of undefined.`);continue}const l=this[n];if(l===void 0){us(`Texture.setValues(): property '${n}' does not exist.`);continue}l&&s&&l.isVector2&&s.isVector2||l&&s&&l.isVector3&&s.isVector3||l&&s&&l.isMatrix3&&s.isMatrix3?l.copy(s):this[n]=s}}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),n||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==aq)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case II:e.x=e.x-Math.floor(e.x);break;case Vm:e.x=e.x<0?0:1;break;case PI:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case II:e.y=e.y-Math.floor(e.y);break;case Vm:e.y=e.y<0?0:1;break;case PI:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}$c.DEFAULT_IMAGE=null;$c.DEFAULT_MAPPING=aq;$c.DEFAULT_ANISOTROPY=1;class _a{constructor(e=0,n=0,s=0,l=1){_a.prototype.isVector4=!0,this.x=e,this.y=n,this.z=s,this.w=l}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,s,l){return this.x=e,this.y=n,this.z=s,this.w=l,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,s=this.y,l=this.z,u=this.w,p=e.elements;return this.x=p[0]*n+p[4]*s+p[8]*l+p[12]*u,this.y=p[1]*n+p[5]*s+p[9]*l+p[13]*u,this.z=p[2]*n+p[6]*s+p[10]*l+p[14]*u,this.w=p[3]*n+p[7]*s+p[11]*l+p[15]*u,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,s,l,u;const v=e.elements,w=v[0],E=v[4],T=v[8],k=v[1],R=v[5],D=v[9],O=v[2],F=v[6],U=v[10];if(Math.abs(E-k)<.01&&Math.abs(T-O)<.01&&Math.abs(D-F)<.01){if(Math.abs(E+k)<.1&&Math.abs(T+O)<.1&&Math.abs(D+F)<.1&&Math.abs(w+R+U-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const W=(w+1)/2,K=(R+1)/2,ne=(U+1)/2,te=(E+k)/4,re=(T+O)/4,xe=(D+F)/4;return W>K&&W>ne?W<.01?(s=0,l=.707106781,u=.707106781):(s=Math.sqrt(W),l=te/s,u=re/s):K>ne?K<.01?(s=.707106781,l=0,u=.707106781):(l=Math.sqrt(K),s=te/l,u=xe/l):ne<.01?(s=.707106781,l=.707106781,u=0):(u=Math.sqrt(ne),s=re/u,l=xe/u),this.set(s,l,u,n),this}let X=Math.sqrt((F-D)*(F-D)+(T-O)*(T-O)+(k-E)*(k-E));return Math.abs(X)<.001&&(X=1),this.x=(F-D)/X,this.y=(T-O)/X,this.z=(k-E)/X,this.w=Math.acos((w+R+U-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Us(this.x,e.x,n.x),this.y=Us(this.y,e.y,n.y),this.z=Us(this.z,e.z,n.z),this.w=Us(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=Us(this.x,e,n),this.y=Us(this.y,e,n),this.z=Us(this.z,e,n),this.w=Us(this.w,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Us(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this.z=e.z+(n.z-e.z)*s,this.w=e.w+(n.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xwe extends Ab{constructor(e=1,n=1,s={}){super(),s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:rh,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},s),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=s.depth,this.scissor=new _a(0,0,e,n),this.scissorTest=!1,this.viewport=new _a(0,0,e,n);const l={width:e,height:n,depth:s.depth},u=new $c(l);this.textures=[];const p=s.count;for(let r=0;r<p;r++)this.textures[r]=u.clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;this._setTextureOptions(s),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=s.depthTexture,this.samples=s.samples,this.multiview=s.multiview}_setTextureOptions(e={}){const n={minFilter:rh,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(n.mapping=e.mapping),e.wrapS!==void 0&&(n.wrapS=e.wrapS),e.wrapT!==void 0&&(n.wrapT=e.wrapT),e.wrapR!==void 0&&(n.wrapR=e.wrapR),e.magFilter!==void 0&&(n.magFilter=e.magFilter),e.minFilter!==void 0&&(n.minFilter=e.minFilter),e.format!==void 0&&(n.format=e.format),e.type!==void 0&&(n.type=e.type),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(n.colorSpace=e.colorSpace),e.flipY!==void 0&&(n.flipY=e.flipY),e.generateMipmaps!==void 0&&(n.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(n.internalFormat=e.internalFormat);for(let s=0;s<this.textures.length;s++)this.textures[s].setValues(n)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,s=1){if(this.width!==e||this.height!==n||this.depth!==s){this.width=e,this.height=n,this.depth=s;for(let l=0,u=this.textures.length;l<u;l++)this.textures[l].image.width=e,this.textures[l].image.height=n,this.textures[l].image.depth=s,this.textures[l].isData3DTexture!==!0&&(this.textures[l].isArrayTexture=this.textures[l].image.depth>1);this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const l=Object.assign({},e.textures[n].image);this.textures[n].source=new WN(l)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $x extends xwe{constructor(e=1,n=1,s={}){super(e,n,s),this.isWebGLRenderTarget=!0}}class yq extends $c{constructor(e=null,n=1,s=1,l=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:s,depth:l},this.magFilter=ud,this.minFilter=ud,this.wrapR=Vm,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class _we extends $c{constructor(e=null,n=1,s=1,l=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:s,depth:l},this.magFilter=ud,this.minFilter=ud,this.wrapR=Vm,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class P2{constructor(e=new Ln(1/0,1/0,1/0),n=new Ln(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,s=e.length;n<s;n+=3)this.expandByPoint(Jh.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,s=e.count;n<s;n++)this.expandByPoint(Jh.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,s=e.length;n<s;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const s=Jh.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const u=s.getAttribute("position");if(n===!0&&u!==void 0&&e.isInstancedMesh!==!0)for(let p=0,r=u.count;p<r;p++)e.isMesh===!0?e.getVertexPosition(p,Jh):Jh.fromBufferAttribute(u,p),Jh.applyMatrix4(e.matrixWorld),this.expandByPoint(Jh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),dT.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),dT.copy(s.boundingBox)),dT.applyMatrix4(e.matrixWorld),this.union(dT)}const l=e.children;for(let u=0,p=l.length;u<p;u++)this.expandByObject(l[u],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Jh),Jh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,s;return e.normal.x>0?(n=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),n<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(k1),hT.subVectors(this.max,k1),ev.subVectors(e.a,k1),tv.subVectors(e.b,k1),nv.subVectors(e.c,k1),f0.subVectors(tv,ev),p0.subVectors(nv,tv),zy.subVectors(ev,nv);let n=[0,-f0.z,f0.y,0,-p0.z,p0.y,0,-zy.z,zy.y,f0.z,0,-f0.x,p0.z,0,-p0.x,zy.z,0,-zy.x,-f0.y,f0.x,0,-p0.y,p0.x,0,-zy.y,zy.x,0];return!r5(n,ev,tv,nv,hT)||(n=[1,0,0,0,1,0,0,0,1],!r5(n,ev,tv,nv,hT))?!1:(fT.crossVectors(f0,p0),n=[fT.x,fT.y,fT.z],r5(n,ev,tv,nv,hT))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Jh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Em[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Em[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Em[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Em[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Em[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Em[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Em[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Em[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Em),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Em=[new Ln,new Ln,new Ln,new Ln,new Ln,new Ln,new Ln,new Ln],Jh=new Ln,dT=new P2,ev=new Ln,tv=new Ln,nv=new Ln,f0=new Ln,p0=new Ln,zy=new Ln,k1=new Ln,hT=new Ln,fT=new Ln,Uy=new Ln;function r5(t,e,n,s,l){for(let u=0,p=t.length-3;u<=p;u+=3){Uy.fromArray(t,u);const r=l.x*Math.abs(Uy.x)+l.y*Math.abs(Uy.y)+l.z*Math.abs(Uy.z),v=e.dot(Uy),w=n.dot(Uy),E=s.dot(Uy);if(Math.max(-Math.max(v,w,E),Math.min(v,w,E))>r)return!1}return!0}const vwe=new P2,I1=new Ln,i5=new Ln;class JA{constructor(e=new Ln,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const s=this.center;n!==void 0?s.copy(n):vwe.setFromPoints(e).getCenter(s);let l=0;for(let u=0,p=e.length;u<p;u++)l=Math.max(l,s.distanceToSquared(e[u]));return this.radius=Math.sqrt(l),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const s=this.center.distanceToSquared(e);return n.copy(e),s>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;I1.subVectors(e,this.center);const n=I1.lengthSq();if(n>this.radius*this.radius){const s=Math.sqrt(n),l=(s-this.radius)*.5;this.center.addScaledVector(I1,l/s),this.radius+=l}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(i5.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(I1.copy(e.center).add(i5)),this.expandByPoint(I1.copy(e.center).sub(i5))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Am=new Ln,s5=new Ln,pT=new Ln,m0=new Ln,o5=new Ln,mT=new Ln,a5=new Ln;class xq{constructor(e=new Ln,n=new Ln(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Am)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const s=n.dot(this.direction);return s<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Am.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Am.copy(this.origin).addScaledVector(this.direction,n),Am.distanceToSquared(e))}distanceSqToSegment(e,n,s,l){s5.copy(e).add(n).multiplyScalar(.5),pT.copy(n).sub(e).normalize(),m0.copy(this.origin).sub(s5);const u=e.distanceTo(n)*.5,p=-this.direction.dot(pT),r=m0.dot(this.direction),v=-m0.dot(pT),w=m0.lengthSq(),E=Math.abs(1-p*p);let T,k,R,D;if(E>0)if(T=p*v-r,k=p*r-v,D=u*E,T>=0)if(k>=-D)if(k<=D){const O=1/E;T*=O,k*=O,R=T*(T+p*k+2*r)+k*(p*T+k+2*v)+w}else k=u,T=Math.max(0,-(p*k+r)),R=-T*T+k*(k+2*v)+w;else k=-u,T=Math.max(0,-(p*k+r)),R=-T*T+k*(k+2*v)+w;else k<=-D?(T=Math.max(0,-(-p*u+r)),k=T>0?-u:Math.min(Math.max(-u,-v),u),R=-T*T+k*(k+2*v)+w):k<=D?(T=0,k=Math.min(Math.max(-u,-v),u),R=k*(k+2*v)+w):(T=Math.max(0,-(p*u+r)),k=T>0?u:Math.min(Math.max(-u,-v),u),R=-T*T+k*(k+2*v)+w);else k=p>0?-u:u,T=Math.max(0,-(p*k+r)),R=-T*T+k*(k+2*v)+w;return s&&s.copy(this.origin).addScaledVector(this.direction,T),l&&l.copy(s5).addScaledVector(pT,k),R}intersectSphere(e,n){Am.subVectors(e.center,this.origin);const s=Am.dot(this.direction),l=Am.dot(Am)-s*s,u=e.radius*e.radius;if(l>u)return null;const p=Math.sqrt(u-l),r=s-p,v=s+p;return v<0?null:r<0?this.at(v,n):this.at(r,n)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/n;return s>=0?s:null}intersectPlane(e,n){const s=this.distanceToPlane(e);return s===null?null:this.at(s,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let s,l,u,p,r,v;const w=1/this.direction.x,E=1/this.direction.y,T=1/this.direction.z,k=this.origin;return w>=0?(s=(e.min.x-k.x)*w,l=(e.max.x-k.x)*w):(s=(e.max.x-k.x)*w,l=(e.min.x-k.x)*w),E>=0?(u=(e.min.y-k.y)*E,p=(e.max.y-k.y)*E):(u=(e.max.y-k.y)*E,p=(e.min.y-k.y)*E),s>p||u>l||((u>s||isNaN(s))&&(s=u),(p<l||isNaN(l))&&(l=p),T>=0?(r=(e.min.z-k.z)*T,v=(e.max.z-k.z)*T):(r=(e.max.z-k.z)*T,v=(e.min.z-k.z)*T),s>v||r>l)||((r>s||s!==s)&&(s=r),(v<l||l!==l)&&(l=v),l<0)?null:this.at(s>=0?s:l,n)}intersectsBox(e){return this.intersectBox(e,Am)!==null}intersectTriangle(e,n,s,l,u){o5.subVectors(n,e),mT.subVectors(s,e),a5.crossVectors(o5,mT);let p=this.direction.dot(a5),r;if(p>0){if(l)return null;r=1}else if(p<0)r=-1,p=-p;else return null;m0.subVectors(this.origin,e);const v=r*this.direction.dot(mT.crossVectors(m0,mT));if(v<0)return null;const w=r*this.direction.dot(o5.cross(m0));if(w<0||v+w>p)return null;const E=-r*m0.dot(a5);return E<0?null:this.at(E/p,u)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Da{constructor(e,n,s,l,u,p,r,v,w,E,T,k,R,D,O,F){Da.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,s,l,u,p,r,v,w,E,T,k,R,D,O,F)}set(e,n,s,l,u,p,r,v,w,E,T,k,R,D,O,F){const U=this.elements;return U[0]=e,U[4]=n,U[8]=s,U[12]=l,U[1]=u,U[5]=p,U[9]=r,U[13]=v,U[2]=w,U[6]=E,U[10]=T,U[14]=k,U[3]=R,U[7]=D,U[11]=O,U[15]=F,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Da().fromArray(this.elements)}copy(e){const n=this.elements,s=e.elements;return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],this}copyPosition(e){const n=this.elements,s=e.elements;return n[12]=s[12],n[13]=s[13],n[14]=s[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,s){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,n,s){return this.set(e.x,n.x,s.x,0,e.y,n.y,s.y,0,e.z,n.z,s.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,s=e.elements,l=1/rv.setFromMatrixColumn(e,0).length(),u=1/rv.setFromMatrixColumn(e,1).length(),p=1/rv.setFromMatrixColumn(e,2).length();return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n[3]=0,n[4]=s[4]*u,n[5]=s[5]*u,n[6]=s[6]*u,n[7]=0,n[8]=s[8]*p,n[9]=s[9]*p,n[10]=s[10]*p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,s=e.x,l=e.y,u=e.z,p=Math.cos(s),r=Math.sin(s),v=Math.cos(l),w=Math.sin(l),E=Math.cos(u),T=Math.sin(u);if(e.order==="XYZ"){const k=p*E,R=p*T,D=r*E,O=r*T;n[0]=v*E,n[4]=-v*T,n[8]=w,n[1]=R+D*w,n[5]=k-O*w,n[9]=-r*v,n[2]=O-k*w,n[6]=D+R*w,n[10]=p*v}else if(e.order==="YXZ"){const k=v*E,R=v*T,D=w*E,O=w*T;n[0]=k+O*r,n[4]=D*r-R,n[8]=p*w,n[1]=p*T,n[5]=p*E,n[9]=-r,n[2]=R*r-D,n[6]=O+k*r,n[10]=p*v}else if(e.order==="ZXY"){const k=v*E,R=v*T,D=w*E,O=w*T;n[0]=k-O*r,n[4]=-p*T,n[8]=D+R*r,n[1]=R+D*r,n[5]=p*E,n[9]=O-k*r,n[2]=-p*w,n[6]=r,n[10]=p*v}else if(e.order==="ZYX"){const k=p*E,R=p*T,D=r*E,O=r*T;n[0]=v*E,n[4]=D*w-R,n[8]=k*w+O,n[1]=v*T,n[5]=O*w+k,n[9]=R*w-D,n[2]=-w,n[6]=r*v,n[10]=p*v}else if(e.order==="YZX"){const k=p*v,R=p*w,D=r*v,O=r*w;n[0]=v*E,n[4]=O-k*T,n[8]=D*T+R,n[1]=T,n[5]=p*E,n[9]=-r*E,n[2]=-w*E,n[6]=R*T+D,n[10]=k-O*T}else if(e.order==="XZY"){const k=p*v,R=p*w,D=r*v,O=r*w;n[0]=v*E,n[4]=-T,n[8]=w*E,n[1]=k*T+O,n[5]=p*E,n[9]=R*T-D,n[2]=D*T-R,n[6]=r*E,n[10]=O*T+k}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(bwe,e,wwe)}lookAt(e,n,s){const l=this.elements;return Qu.subVectors(e,n),Qu.lengthSq()===0&&(Qu.z=1),Qu.normalize(),g0.crossVectors(s,Qu),g0.lengthSq()===0&&(Math.abs(s.z)===1?Qu.x+=1e-4:Qu.z+=1e-4,Qu.normalize(),g0.crossVectors(s,Qu)),g0.normalize(),gT.crossVectors(Qu,g0),l[0]=g0.x,l[4]=gT.x,l[8]=Qu.x,l[1]=g0.y,l[5]=gT.y,l[9]=Qu.y,l[2]=g0.z,l[6]=gT.z,l[10]=Qu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const s=e.elements,l=n.elements,u=this.elements,p=s[0],r=s[4],v=s[8],w=s[12],E=s[1],T=s[5],k=s[9],R=s[13],D=s[2],O=s[6],F=s[10],U=s[14],X=s[3],W=s[7],K=s[11],ne=s[15],te=l[0],re=l[4],xe=l[8],ae=l[12],ce=l[1],ye=l[5],Ce=l[9],Me=l[13],Ke=l[2],ke=l[6],je=l[10],$e=l[14],Ae=l[3],He=l[7],qe=l[11],Le=l[15];return u[0]=p*te+r*ce+v*Ke+w*Ae,u[4]=p*re+r*ye+v*ke+w*He,u[8]=p*xe+r*Ce+v*je+w*qe,u[12]=p*ae+r*Me+v*$e+w*Le,u[1]=E*te+T*ce+k*Ke+R*Ae,u[5]=E*re+T*ye+k*ke+R*He,u[9]=E*xe+T*Ce+k*je+R*qe,u[13]=E*ae+T*Me+k*$e+R*Le,u[2]=D*te+O*ce+F*Ke+U*Ae,u[6]=D*re+O*ye+F*ke+U*He,u[10]=D*xe+O*Ce+F*je+U*qe,u[14]=D*ae+O*Me+F*$e+U*Le,u[3]=X*te+W*ce+K*Ke+ne*Ae,u[7]=X*re+W*ye+K*ke+ne*He,u[11]=X*xe+W*Ce+K*je+ne*qe,u[15]=X*ae+W*Me+K*$e+ne*Le,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],s=e[4],l=e[8],u=e[12],p=e[1],r=e[5],v=e[9],w=e[13],E=e[2],T=e[6],k=e[10],R=e[14],D=e[3],O=e[7],F=e[11],U=e[15];return D*(+u*v*T-l*w*T-u*r*k+s*w*k+l*r*R-s*v*R)+O*(+n*v*R-n*w*k+u*p*k-l*p*R+l*w*E-u*v*E)+F*(+n*w*T-n*r*R-u*p*T+s*p*R+u*r*E-s*w*E)+U*(-l*r*E-n*v*T+n*r*k+l*p*T-s*p*k+s*v*E)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,s){const l=this.elements;return e.isVector3?(l[12]=e.x,l[13]=e.y,l[14]=e.z):(l[12]=e,l[13]=n,l[14]=s),this}invert(){const e=this.elements,n=e[0],s=e[1],l=e[2],u=e[3],p=e[4],r=e[5],v=e[6],w=e[7],E=e[8],T=e[9],k=e[10],R=e[11],D=e[12],O=e[13],F=e[14],U=e[15],X=T*F*w-O*k*w+O*v*R-r*F*R-T*v*U+r*k*U,W=D*k*w-E*F*w-D*v*R+p*F*R+E*v*U-p*k*U,K=E*O*w-D*T*w+D*r*R-p*O*R-E*r*U+p*T*U,ne=D*T*v-E*O*v-D*r*k+p*O*k+E*r*F-p*T*F,te=n*X+s*W+l*K+u*ne;if(te===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const re=1/te;return e[0]=X*re,e[1]=(O*k*u-T*F*u-O*l*R+s*F*R+T*l*U-s*k*U)*re,e[2]=(r*F*u-O*v*u+O*l*w-s*F*w-r*l*U+s*v*U)*re,e[3]=(T*v*u-r*k*u-T*l*w+s*k*w+r*l*R-s*v*R)*re,e[4]=W*re,e[5]=(E*F*u-D*k*u+D*l*R-n*F*R-E*l*U+n*k*U)*re,e[6]=(D*v*u-p*F*u-D*l*w+n*F*w+p*l*U-n*v*U)*re,e[7]=(p*k*u-E*v*u+E*l*w-n*k*w-p*l*R+n*v*R)*re,e[8]=K*re,e[9]=(D*T*u-E*O*u-D*s*R+n*O*R+E*s*U-n*T*U)*re,e[10]=(p*O*u-D*r*u+D*s*w-n*O*w-p*s*U+n*r*U)*re,e[11]=(E*r*u-p*T*u-E*s*w+n*T*w+p*s*R-n*r*R)*re,e[12]=ne*re,e[13]=(E*O*l-D*T*l+D*s*k-n*O*k-E*s*F+n*T*F)*re,e[14]=(D*r*l-p*O*l-D*s*v+n*O*v+p*s*F-n*r*F)*re,e[15]=(p*T*l-E*r*l+E*s*v-n*T*v-p*s*k+n*r*k)*re,this}scale(e){const n=this.elements,s=e.x,l=e.y,u=e.z;return n[0]*=s,n[4]*=l,n[8]*=u,n[1]*=s,n[5]*=l,n[9]*=u,n[2]*=s,n[6]*=l,n[10]*=u,n[3]*=s,n[7]*=l,n[11]*=u,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],l=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,s,l))}makeTranslation(e,n,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,s,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,n,-s,0,0,s,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,0,s,0,0,1,0,0,-s,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,-s,0,0,s,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const s=Math.cos(n),l=Math.sin(n),u=1-s,p=e.x,r=e.y,v=e.z,w=u*p,E=u*r;return this.set(w*p+s,w*r-l*v,w*v+l*r,0,w*r+l*v,E*r+s,E*v-l*p,0,w*v-l*r,E*v+l*p,u*v*v+s,0,0,0,0,1),this}makeScale(e,n,s){return this.set(e,0,0,0,0,n,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,n,s,l,u,p){return this.set(1,s,u,0,e,1,p,0,n,l,1,0,0,0,0,1),this}compose(e,n,s){const l=this.elements,u=n._x,p=n._y,r=n._z,v=n._w,w=u+u,E=p+p,T=r+r,k=u*w,R=u*E,D=u*T,O=p*E,F=p*T,U=r*T,X=v*w,W=v*E,K=v*T,ne=s.x,te=s.y,re=s.z;return l[0]=(1-(O+U))*ne,l[1]=(R+K)*ne,l[2]=(D-W)*ne,l[3]=0,l[4]=(R-K)*te,l[5]=(1-(k+U))*te,l[6]=(F+X)*te,l[7]=0,l[8]=(D+W)*re,l[9]=(F-X)*re,l[10]=(1-(k+O))*re,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,this}decompose(e,n,s){const l=this.elements;let u=rv.set(l[0],l[1],l[2]).length();const p=rv.set(l[4],l[5],l[6]).length(),r=rv.set(l[8],l[9],l[10]).length();this.determinant()<0&&(u=-u),e.x=l[12],e.y=l[13],e.z=l[14],ef.copy(this);const w=1/u,E=1/p,T=1/r;return ef.elements[0]*=w,ef.elements[1]*=w,ef.elements[2]*=w,ef.elements[4]*=E,ef.elements[5]*=E,ef.elements[6]*=E,ef.elements[8]*=T,ef.elements[9]*=T,ef.elements[10]*=T,n.setFromRotationMatrix(ef),s.x=u,s.y=p,s.z=r,this}makePerspective(e,n,s,l,u,p,r=gp,v=!1){const w=this.elements,E=2*u/(n-e),T=2*u/(s-l),k=(n+e)/(n-e),R=(s+l)/(s-l);let D,O;if(v)D=u/(p-u),O=p*u/(p-u);else if(r===gp)D=-(p+u)/(p-u),O=-2*p*u/(p-u);else if(r===$E)D=-p/(p-u),O=-p*u/(p-u);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+r);return w[0]=E,w[4]=0,w[8]=k,w[12]=0,w[1]=0,w[5]=T,w[9]=R,w[13]=0,w[2]=0,w[6]=0,w[10]=D,w[14]=O,w[3]=0,w[7]=0,w[11]=-1,w[15]=0,this}makeOrthographic(e,n,s,l,u,p,r=gp,v=!1){const w=this.elements,E=2/(n-e),T=2/(s-l),k=-(n+e)/(n-e),R=-(s+l)/(s-l);let D,O;if(v)D=1/(p-u),O=p/(p-u);else if(r===gp)D=-2/(p-u),O=-(p+u)/(p-u);else if(r===$E)D=-1/(p-u),O=-u/(p-u);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+r);return w[0]=E,w[4]=0,w[8]=0,w[12]=k,w[1]=0,w[5]=T,w[9]=0,w[13]=R,w[2]=0,w[6]=0,w[10]=D,w[14]=O,w[3]=0,w[7]=0,w[11]=0,w[15]=1,this}equals(e){const n=this.elements,s=e.elements;for(let l=0;l<16;l++)if(n[l]!==s[l])return!1;return!0}fromArray(e,n=0){for(let s=0;s<16;s++)this.elements[s]=e[s+n];return this}toArray(e=[],n=0){const s=this.elements;return e[n]=s[0],e[n+1]=s[1],e[n+2]=s[2],e[n+3]=s[3],e[n+4]=s[4],e[n+5]=s[5],e[n+6]=s[6],e[n+7]=s[7],e[n+8]=s[8],e[n+9]=s[9],e[n+10]=s[10],e[n+11]=s[11],e[n+12]=s[12],e[n+13]=s[13],e[n+14]=s[14],e[n+15]=s[15],e}}const rv=new Ln,ef=new Da,bwe=new Ln(0,0,0),wwe=new Ln(1,1,1),g0=new Ln,gT=new Ln,Qu=new Ln,Gz=new Da,$z=new I2;class ag{constructor(e=0,n=0,s=0,l=ag.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=s,this._order=l}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,s,l=this._order){return this._x=e,this._y=n,this._z=s,this._order=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,s=!0){const l=e.elements,u=l[0],p=l[4],r=l[8],v=l[1],w=l[5],E=l[9],T=l[2],k=l[6],R=l[10];switch(n){case"XYZ":this._y=Math.asin(Us(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-E,R),this._z=Math.atan2(-p,u)):(this._x=Math.atan2(k,w),this._z=0);break;case"YXZ":this._x=Math.asin(-Us(E,-1,1)),Math.abs(E)<.9999999?(this._y=Math.atan2(r,R),this._z=Math.atan2(v,w)):(this._y=Math.atan2(-T,u),this._z=0);break;case"ZXY":this._x=Math.asin(Us(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-T,R),this._z=Math.atan2(-p,w)):(this._y=0,this._z=Math.atan2(v,u));break;case"ZYX":this._y=Math.asin(-Us(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(k,R),this._z=Math.atan2(v,u)):(this._x=0,this._z=Math.atan2(-p,w));break;case"YZX":this._z=Math.asin(Us(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-E,w),this._y=Math.atan2(-T,u)):(this._x=0,this._y=Math.atan2(r,R));break;case"XZY":this._z=Math.asin(-Us(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(k,w),this._y=Math.atan2(r,u)):(this._x=Math.atan2(-E,R),this._y=0);break;default:us("Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,s){return Gz.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Gz,n,s)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return $z.setFromEuler(this),this.setFromQuaternion($z,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ag.DEFAULT_ORDER="XYZ";class _q{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Swe=0;const Wz=new Ln,iv=new I2,Cm=new Da,yT=new Ln,P1=new Ln,Twe=new Ln,Ewe=new I2,qz=new Ln(1,0,0),Xz=new Ln(0,1,0),Zz=new Ln(0,0,1),Qz={type:"added"},Awe={type:"removed"},sv={type:"childadded",child:null},l5={type:"childremoved",child:null};class Su extends Ab{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Swe++}),this.uuid=k2(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Su.DEFAULT_UP.clone();const e=new Ln,n=new ag,s=new I2,l=new Ln(1,1,1);function u(){s.setFromEuler(n,!1)}function p(){n.setFromQuaternion(s,void 0,!1)}n._onChange(u),s._onChange(p),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:l},modelViewMatrix:{value:new Da},normalMatrix:{value:new ms}}),this.matrix=new Da,this.matrixWorld=new Da,this.matrixAutoUpdate=Su.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Su.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _q,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return iv.setFromAxisAngle(e,n),this.quaternion.multiply(iv),this}rotateOnWorldAxis(e,n){return iv.setFromAxisAngle(e,n),this.quaternion.premultiply(iv),this}rotateX(e){return this.rotateOnAxis(qz,e)}rotateY(e){return this.rotateOnAxis(Xz,e)}rotateZ(e){return this.rotateOnAxis(Zz,e)}translateOnAxis(e,n){return Wz.copy(e).applyQuaternion(this.quaternion),this.position.add(Wz.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(qz,e)}translateY(e){return this.translateOnAxis(Xz,e)}translateZ(e){return this.translateOnAxis(Zz,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Cm.copy(this.matrixWorld).invert())}lookAt(e,n,s){e.isVector3?yT.copy(e):yT.set(e,n,s);const l=this.parent;this.updateWorldMatrix(!0,!1),P1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Cm.lookAt(P1,yT,this.up):Cm.lookAt(yT,P1,this.up),this.quaternion.setFromRotationMatrix(Cm),l&&(Cm.extractRotation(l.matrixWorld),iv.setFromRotationMatrix(Cm),this.quaternion.premultiply(iv.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(xa("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Qz),sv.child=e,this.dispatchEvent(sv),sv.child=null):xa("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Awe),l5.child=e,this.dispatchEvent(l5),l5.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Cm.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Cm.multiply(e.parent.matrixWorld)),e.applyMatrix4(Cm),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Qz),sv.child=e,this.dispatchEvent(sv),sv.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let s=0,l=this.children.length;s<l;s++){const p=this.children[s].getObjectByProperty(e,n);if(p!==void 0)return p}}getObjectsByProperty(e,n,s=[]){this[e]===n&&s.push(this);const l=this.children;for(let u=0,p=l.length;u<p;u++)l[u].getObjectsByProperty(e,n,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(P1,e,Twe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(P1,Ewe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let s=0,l=n.length;s<l;s++)n[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let s=0,l=n.length;s<l;s++)n[s].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let s=0,l=n.length;s<l;s++)n[s].updateMatrixWorld(e)}updateWorldMatrix(e,n){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const l=this.children;for(let u=0,p=l.length;u<p;u++)l[u].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",s={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const l={};l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),l.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(l.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(l.type="BatchedMesh",l.perObjectFrustumCulled=this.perObjectFrustumCulled,l.sortObjects=this.sortObjects,l.drawRanges=this._drawRanges,l.reservedRanges=this._reservedRanges,l.geometryInfo=this._geometryInfo.map(r=>({...r,boundingBox:r.boundingBox?r.boundingBox.toJSON():void 0,boundingSphere:r.boundingSphere?r.boundingSphere.toJSON():void 0})),l.instanceInfo=this._instanceInfo.map(r=>({...r})),l.availableInstanceIds=this._availableInstanceIds.slice(),l.availableGeometryIds=this._availableGeometryIds.slice(),l.nextIndexStart=this._nextIndexStart,l.nextVertexStart=this._nextVertexStart,l.geometryCount=this._geometryCount,l.maxInstanceCount=this._maxInstanceCount,l.maxVertexCount=this._maxVertexCount,l.maxIndexCount=this._maxIndexCount,l.geometryInitialized=this._geometryInitialized,l.matricesTexture=this._matricesTexture.toJSON(e),l.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(l.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(l.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(l.boundingBox=this.boundingBox.toJSON()));function u(r,v){return r[v.uuid]===void 0&&(r[v.uuid]=v.toJSON(e)),v.uuid}if(this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(l.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=u(e.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const v=r.shapes;if(Array.isArray(v))for(let w=0,E=v.length;w<E;w++){const T=v[w];u(e.shapes,T)}else u(e.shapes,v)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(u(e.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let v=0,w=this.material.length;v<w;v++)r.push(u(e.materials,this.material[v]));l.material=r}else l.material=u(e.materials,this.material);if(this.children.length>0){l.children=[];for(let r=0;r<this.children.length;r++)l.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){l.animations=[];for(let r=0;r<this.animations.length;r++){const v=this.animations[r];l.animations.push(u(e.animations,v))}}if(n){const r=p(e.geometries),v=p(e.materials),w=p(e.textures),E=p(e.images),T=p(e.shapes),k=p(e.skeletons),R=p(e.animations),D=p(e.nodes);r.length>0&&(s.geometries=r),v.length>0&&(s.materials=v),w.length>0&&(s.textures=w),E.length>0&&(s.images=E),T.length>0&&(s.shapes=T),k.length>0&&(s.skeletons=k),R.length>0&&(s.animations=R),D.length>0&&(s.nodes=D)}return s.object=l,s;function p(r){const v=[];for(const w in r){const E=r[w];delete E.metadata,v.push(E)}return v}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let s=0;s<e.children.length;s++){const l=e.children[s];this.add(l.clone())}return this}}Su.DEFAULT_UP=new Ln(0,1,0);Su.DEFAULT_MATRIX_AUTO_UPDATE=!0;Su.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const tf=new Ln,Mm=new Ln,c5=new Ln,km=new Ln,ov=new Ln,av=new Ln,Kz=new Ln,u5=new Ln,d5=new Ln,h5=new Ln,f5=new _a,p5=new _a,m5=new _a;class lf{constructor(e=new Ln,n=new Ln,s=new Ln){this.a=e,this.b=n,this.c=s}static getNormal(e,n,s,l){l.subVectors(s,n),tf.subVectors(e,n),l.cross(tf);const u=l.lengthSq();return u>0?l.multiplyScalar(1/Math.sqrt(u)):l.set(0,0,0)}static getBarycoord(e,n,s,l,u){tf.subVectors(l,n),Mm.subVectors(s,n),c5.subVectors(e,n);const p=tf.dot(tf),r=tf.dot(Mm),v=tf.dot(c5),w=Mm.dot(Mm),E=Mm.dot(c5),T=p*w-r*r;if(T===0)return u.set(0,0,0),null;const k=1/T,R=(w*v-r*E)*k,D=(p*E-r*v)*k;return u.set(1-R-D,D,R)}static containsPoint(e,n,s,l){return this.getBarycoord(e,n,s,l,km)===null?!1:km.x>=0&&km.y>=0&&km.x+km.y<=1}static getInterpolation(e,n,s,l,u,p,r,v){return this.getBarycoord(e,n,s,l,km)===null?(v.x=0,v.y=0,"z"in v&&(v.z=0),"w"in v&&(v.w=0),null):(v.setScalar(0),v.addScaledVector(u,km.x),v.addScaledVector(p,km.y),v.addScaledVector(r,km.z),v)}static getInterpolatedAttribute(e,n,s,l,u,p){return f5.setScalar(0),p5.setScalar(0),m5.setScalar(0),f5.fromBufferAttribute(e,n),p5.fromBufferAttribute(e,s),m5.fromBufferAttribute(e,l),p.setScalar(0),p.addScaledVector(f5,u.x),p.addScaledVector(p5,u.y),p.addScaledVector(m5,u.z),p}static isFrontFacing(e,n,s,l){return tf.subVectors(s,n),Mm.subVectors(e,n),tf.cross(Mm).dot(l)<0}set(e,n,s){return this.a.copy(e),this.b.copy(n),this.c.copy(s),this}setFromPointsAndIndices(e,n,s,l){return this.a.copy(e[n]),this.b.copy(e[s]),this.c.copy(e[l]),this}setFromAttributeAndIndices(e,n,s,l){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,l),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tf.subVectors(this.c,this.b),Mm.subVectors(this.a,this.b),tf.cross(Mm).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lf.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return lf.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,s,l,u){return lf.getInterpolation(e,this.a,this.b,this.c,n,s,l,u)}containsPoint(e){return lf.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lf.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const s=this.a,l=this.b,u=this.c;let p,r;ov.subVectors(l,s),av.subVectors(u,s),u5.subVectors(e,s);const v=ov.dot(u5),w=av.dot(u5);if(v<=0&&w<=0)return n.copy(s);d5.subVectors(e,l);const E=ov.dot(d5),T=av.dot(d5);if(E>=0&&T<=E)return n.copy(l);const k=v*T-E*w;if(k<=0&&v>=0&&E<=0)return p=v/(v-E),n.copy(s).addScaledVector(ov,p);h5.subVectors(e,u);const R=ov.dot(h5),D=av.dot(h5);if(D>=0&&R<=D)return n.copy(u);const O=R*w-v*D;if(O<=0&&w>=0&&D<=0)return r=w/(w-D),n.copy(s).addScaledVector(av,r);const F=E*D-R*T;if(F<=0&&T-E>=0&&R-D>=0)return Kz.subVectors(u,l),r=(T-E)/(T-E+(R-D)),n.copy(l).addScaledVector(Kz,r);const U=1/(F+O+k);return p=O*U,r=k*U,n.copy(s).addScaledVector(ov,p).addScaledVector(av,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const vq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},y0={h:0,s:0,l:0},xT={h:0,s:0,l:0};function g5(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class ro{constructor(e,n,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,s)}set(e,n,s){if(n===void 0&&s===void 0){const l=e;l&&l.isColor?this.copy(l):typeof l=="number"?this.setHex(l):typeof l=="string"&&this.setStyle(l)}else this.setRGB(e,n,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Yd){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Js.colorSpaceToWorking(this,n),this}setRGB(e,n,s,l=Js.workingColorSpace){return this.r=e,this.g=n,this.b=s,Js.colorSpaceToWorking(this,l),this}setHSL(e,n,s,l=Js.workingColorSpace){if(e=fwe(e,1),n=Us(n,0,1),s=Us(s,0,1),n===0)this.r=this.g=this.b=s;else{const u=s<=.5?s*(1+n):s+n-s*n,p=2*s-u;this.r=g5(p,u,e+1/3),this.g=g5(p,u,e),this.b=g5(p,u,e-1/3)}return Js.colorSpaceToWorking(this,l),this}setStyle(e,n=Yd){function s(u){u!==void 0&&parseFloat(u)<1&&us("Color: Alpha component of "+e+" will be ignored.")}let l;if(l=/^(\w+)\(([^\)]*)\)/.exec(e)){let u;const p=l[1],r=l[2];switch(p){case"rgb":case"rgba":if(u=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return s(u[4]),this.setRGB(Math.min(255,parseInt(u[1],10))/255,Math.min(255,parseInt(u[2],10))/255,Math.min(255,parseInt(u[3],10))/255,n);if(u=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return s(u[4]),this.setRGB(Math.min(100,parseInt(u[1],10))/100,Math.min(100,parseInt(u[2],10))/100,Math.min(100,parseInt(u[3],10))/100,n);break;case"hsl":case"hsla":if(u=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return s(u[4]),this.setHSL(parseFloat(u[1])/360,parseFloat(u[2])/100,parseFloat(u[3])/100,n);break;default:us("Color: Unknown color model "+e)}}else if(l=/^\#([A-Fa-f\d]+)$/.exec(e)){const u=l[1],p=u.length;if(p===3)return this.setRGB(parseInt(u.charAt(0),16)/15,parseInt(u.charAt(1),16)/15,parseInt(u.charAt(2),16)/15,n);if(p===6)return this.setHex(parseInt(u,16),n);us("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Yd){const s=vq[e.toLowerCase()];return s!==void 0?this.setHex(s,n):us("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ym(e.r),this.g=Ym(e.g),this.b=Ym(e.b),this}copyLinearToSRGB(e){return this.r=Rv(e.r),this.g=Rv(e.g),this.b=Rv(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Yd){return Js.workingToColorSpace(hc.copy(this),e),Math.round(Us(hc.r*255,0,255))*65536+Math.round(Us(hc.g*255,0,255))*256+Math.round(Us(hc.b*255,0,255))}getHexString(e=Yd){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Js.workingColorSpace){Js.workingToColorSpace(hc.copy(this),n);const s=hc.r,l=hc.g,u=hc.b,p=Math.max(s,l,u),r=Math.min(s,l,u);let v,w;const E=(r+p)/2;if(r===p)v=0,w=0;else{const T=p-r;switch(w=E<=.5?T/(p+r):T/(2-p-r),p){case s:v=(l-u)/T+(l<u?6:0);break;case l:v=(u-s)/T+2;break;case u:v=(s-l)/T+4;break}v/=6}return e.h=v,e.s=w,e.l=E,e}getRGB(e,n=Js.workingColorSpace){return Js.workingToColorSpace(hc.copy(this),n),e.r=hc.r,e.g=hc.g,e.b=hc.b,e}getStyle(e=Yd){Js.workingToColorSpace(hc.copy(this),e);const n=hc.r,s=hc.g,l=hc.b;return e!==Yd?`color(${e} ${n.toFixed(3)} ${s.toFixed(3)} ${l.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(s*255)},${Math.round(l*255)})`}offsetHSL(e,n,s){return this.getHSL(y0),this.setHSL(y0.h+e,y0.s+n,y0.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,s){return this.r=e.r+(n.r-e.r)*s,this.g=e.g+(n.g-e.g)*s,this.b=e.b+(n.b-e.b)*s,this}lerpHSL(e,n){this.getHSL(y0),e.getHSL(xT);const s=YM(y0.h,xT.h,n),l=YM(y0.s,xT.s,n),u=YM(y0.l,xT.l,n);return this.setHSL(s,l,u),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,s=this.g,l=this.b,u=e.elements;return this.r=u[0]*n+u[3]*s+u[6]*l,this.g=u[1]*n+u[4]*s+u[7]*l,this.b=u[2]*n+u[5]*s+u[8]*l,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const hc=new ro;ro.NAMES=vq;let Cwe=0;class R2 extends Ab{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Cwe++}),this.uuid=k2(),this.name="",this.type="Material",this.blending=Pv,this.side=W0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=_I,this.blendDst=vI,this.blendEquation=tx,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ro(0,0,0),this.blendAlpha=0,this.depthFunc=sb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Lz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Y_,this.stencilZFail=Y_,this.stencilZPass=Y_,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const s=e[n];if(s===void 0){us(`Material: parameter '${n}' has value of undefined.`);continue}const l=this[n];if(l===void 0){us(`Material: '${n}' is not a property of THREE.${this.type}.`);continue}l&&l.isColor?l.set(s):l&&l.isVector3&&s&&s.isVector3?l.copy(s):this[n]=s}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const s={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(s.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(s.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Pv&&(s.blending=this.blending),this.side!==W0&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==_I&&(s.blendSrc=this.blendSrc),this.blendDst!==vI&&(s.blendDst=this.blendDst),this.blendEquation!==tx&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==sb&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Lz&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Y_&&(s.stencilFail=this.stencilFail),this.stencilZFail!==Y_&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==Y_&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function l(u){const p=[];for(const r in u){const v=u[r];delete v.metadata,p.push(v)}return p}if(n){const u=l(e.textures),p=l(e.images);u.length>0&&(s.textures=u),p.length>0&&(s.images=p)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let s=null;if(n!==null){const l=n.length;s=new Array(l);for(let u=0;u!==l;++u)s[u]=n[u].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class bq extends R2{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ro(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ag,this.combine=oq,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ia=new Ln,_T=new po;let Mwe=0;class wp{constructor(e,n,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Mwe++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=s,this.usage=Oz,this.updateRanges=[],this.gpuType=Hm,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,s){e*=this.itemSize,s*=n.itemSize;for(let l=0,u=this.itemSize;l<u;l++)this.array[e+l]=n.array[s+l];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,s=this.count;n<s;n++)_T.fromBufferAttribute(this,n),_T.applyMatrix3(e),this.setXY(n,_T.x,_T.y);else if(this.itemSize===3)for(let n=0,s=this.count;n<s;n++)Ia.fromBufferAttribute(this,n),Ia.applyMatrix3(e),this.setXYZ(n,Ia.x,Ia.y,Ia.z);return this}applyMatrix4(e){for(let n=0,s=this.count;n<s;n++)Ia.fromBufferAttribute(this,n),Ia.applyMatrix4(e),this.setXYZ(n,Ia.x,Ia.y,Ia.z);return this}applyNormalMatrix(e){for(let n=0,s=this.count;n<s;n++)Ia.fromBufferAttribute(this,n),Ia.applyNormalMatrix(e),this.setXYZ(n,Ia.x,Ia.y,Ia.z);return this}transformDirection(e){for(let n=0,s=this.count;n<s;n++)Ia.fromBufferAttribute(this,n),Ia.transformDirection(e),this.setXYZ(n,Ia.x,Ia.y,Ia.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let s=this.array[e*this.itemSize+n];return this.normalized&&(s=M1(s,this.array)),s}setComponent(e,n,s){return this.normalized&&(s=pu(s,this.array)),this.array[e*this.itemSize+n]=s,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=M1(n,this.array)),n}setX(e,n){return this.normalized&&(n=pu(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=M1(n,this.array)),n}setY(e,n){return this.normalized&&(n=pu(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=M1(n,this.array)),n}setZ(e,n){return this.normalized&&(n=pu(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=M1(n,this.array)),n}setW(e,n){return this.normalized&&(n=pu(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,s){return e*=this.itemSize,this.normalized&&(n=pu(n,this.array),s=pu(s,this.array)),this.array[e+0]=n,this.array[e+1]=s,this}setXYZ(e,n,s,l){return e*=this.itemSize,this.normalized&&(n=pu(n,this.array),s=pu(s,this.array),l=pu(l,this.array)),this.array[e+0]=n,this.array[e+1]=s,this.array[e+2]=l,this}setXYZW(e,n,s,l,u){return e*=this.itemSize,this.normalized&&(n=pu(n,this.array),s=pu(s,this.array),l=pu(l,this.array),u=pu(u,this.array)),this.array[e+0]=n,this.array[e+1]=s,this.array[e+2]=l,this.array[e+3]=u,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Oz&&(e.usage=this.usage),e}}class wq extends wp{constructor(e,n,s){super(new Uint16Array(e),n,s)}}class Sq extends wp{constructor(e,n,s){super(new Uint32Array(e),n,s)}}class nd extends wp{constructor(e,n,s){super(new Float32Array(e),n,s)}}let kwe=0;const qd=new Da,y5=new Su,lv=new Ln,Ku=new P2,R1=new P2,xl=new Ln;class mf extends Ab{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:kwe++}),this.uuid=k2(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gq(e)?Sq:wq)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,s=0){this.groups.push({start:e,count:n,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const u=new ms().getNormalMatrix(e);s.applyNormalMatrix(u),s.needsUpdate=!0}const l=this.attributes.tangent;return l!==void 0&&(l.transformDirection(e),l.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return qd.makeRotationFromQuaternion(e),this.applyMatrix4(qd),this}rotateX(e){return qd.makeRotationX(e),this.applyMatrix4(qd),this}rotateY(e){return qd.makeRotationY(e),this.applyMatrix4(qd),this}rotateZ(e){return qd.makeRotationZ(e),this.applyMatrix4(qd),this}translate(e,n,s){return qd.makeTranslation(e,n,s),this.applyMatrix4(qd),this}scale(e,n,s){return qd.makeScale(e,n,s),this.applyMatrix4(qd),this}lookAt(e){return y5.lookAt(e),y5.updateMatrix(),this.applyMatrix4(y5.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(lv).negate(),this.translate(lv.x,lv.y,lv.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const s=[];for(let l=0,u=e.length;l<u;l++){const p=e[l];s.push(p.x,p.y,p.z||0)}this.setAttribute("position",new nd(s,3))}else{const s=Math.min(e.length,n.count);for(let l=0;l<s;l++){const u=e[l];n.setXYZ(l,u.x,u.y,u.z||0)}e.length>n.count&&us("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new P2);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){xa("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ln(-1/0,-1/0,-1/0),new Ln(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let s=0,l=n.length;s<l;s++){const u=n[s];Ku.setFromBufferAttribute(u),this.morphTargetsRelative?(xl.addVectors(this.boundingBox.min,Ku.min),this.boundingBox.expandByPoint(xl),xl.addVectors(this.boundingBox.max,Ku.max),this.boundingBox.expandByPoint(xl)):(this.boundingBox.expandByPoint(Ku.min),this.boundingBox.expandByPoint(Ku.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&xa('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new JA);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){xa("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ln,1/0);return}if(e){const s=this.boundingSphere.center;if(Ku.setFromBufferAttribute(e),n)for(let u=0,p=n.length;u<p;u++){const r=n[u];R1.setFromBufferAttribute(r),this.morphTargetsRelative?(xl.addVectors(Ku.min,R1.min),Ku.expandByPoint(xl),xl.addVectors(Ku.max,R1.max),Ku.expandByPoint(xl)):(Ku.expandByPoint(R1.min),Ku.expandByPoint(R1.max))}Ku.getCenter(s);let l=0;for(let u=0,p=e.count;u<p;u++)xl.fromBufferAttribute(e,u),l=Math.max(l,s.distanceToSquared(xl));if(n)for(let u=0,p=n.length;u<p;u++){const r=n[u],v=this.morphTargetsRelative;for(let w=0,E=r.count;w<E;w++)xl.fromBufferAttribute(r,w),v&&(lv.fromBufferAttribute(e,w),xl.add(lv)),l=Math.max(l,s.distanceToSquared(xl))}this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&xa('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){xa("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=n.position,l=n.normal,u=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new wp(new Float32Array(4*s.count),4));const p=this.getAttribute("tangent"),r=[],v=[];for(let xe=0;xe<s.count;xe++)r[xe]=new Ln,v[xe]=new Ln;const w=new Ln,E=new Ln,T=new Ln,k=new po,R=new po,D=new po,O=new Ln,F=new Ln;function U(xe,ae,ce){w.fromBufferAttribute(s,xe),E.fromBufferAttribute(s,ae),T.fromBufferAttribute(s,ce),k.fromBufferAttribute(u,xe),R.fromBufferAttribute(u,ae),D.fromBufferAttribute(u,ce),E.sub(w),T.sub(w),R.sub(k),D.sub(k);const ye=1/(R.x*D.y-D.x*R.y);isFinite(ye)&&(O.copy(E).multiplyScalar(D.y).addScaledVector(T,-R.y).multiplyScalar(ye),F.copy(T).multiplyScalar(R.x).addScaledVector(E,-D.x).multiplyScalar(ye),r[xe].add(O),r[ae].add(O),r[ce].add(O),v[xe].add(F),v[ae].add(F),v[ce].add(F))}let X=this.groups;X.length===0&&(X=[{start:0,count:e.count}]);for(let xe=0,ae=X.length;xe<ae;++xe){const ce=X[xe],ye=ce.start,Ce=ce.count;for(let Me=ye,Ke=ye+Ce;Me<Ke;Me+=3)U(e.getX(Me+0),e.getX(Me+1),e.getX(Me+2))}const W=new Ln,K=new Ln,ne=new Ln,te=new Ln;function re(xe){ne.fromBufferAttribute(l,xe),te.copy(ne);const ae=r[xe];W.copy(ae),W.sub(ne.multiplyScalar(ne.dot(ae))).normalize(),K.crossVectors(te,ae);const ye=K.dot(v[xe])<0?-1:1;p.setXYZW(xe,W.x,W.y,W.z,ye)}for(let xe=0,ae=X.length;xe<ae;++xe){const ce=X[xe],ye=ce.start,Ce=ce.count;for(let Me=ye,Ke=ye+Ce;Me<Ke;Me+=3)re(e.getX(Me+0)),re(e.getX(Me+1)),re(e.getX(Me+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new wp(new Float32Array(n.count*3),3),this.setAttribute("normal",s);else for(let k=0,R=s.count;k<R;k++)s.setXYZ(k,0,0,0);const l=new Ln,u=new Ln,p=new Ln,r=new Ln,v=new Ln,w=new Ln,E=new Ln,T=new Ln;if(e)for(let k=0,R=e.count;k<R;k+=3){const D=e.getX(k+0),O=e.getX(k+1),F=e.getX(k+2);l.fromBufferAttribute(n,D),u.fromBufferAttribute(n,O),p.fromBufferAttribute(n,F),E.subVectors(p,u),T.subVectors(l,u),E.cross(T),r.fromBufferAttribute(s,D),v.fromBufferAttribute(s,O),w.fromBufferAttribute(s,F),r.add(E),v.add(E),w.add(E),s.setXYZ(D,r.x,r.y,r.z),s.setXYZ(O,v.x,v.y,v.z),s.setXYZ(F,w.x,w.y,w.z)}else for(let k=0,R=n.count;k<R;k+=3)l.fromBufferAttribute(n,k+0),u.fromBufferAttribute(n,k+1),p.fromBufferAttribute(n,k+2),E.subVectors(p,u),T.subVectors(l,u),E.cross(T),s.setXYZ(k+0,E.x,E.y,E.z),s.setXYZ(k+1,E.x,E.y,E.z),s.setXYZ(k+2,E.x,E.y,E.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,s=e.count;n<s;n++)xl.fromBufferAttribute(e,n),xl.normalize(),e.setXYZ(n,xl.x,xl.y,xl.z)}toNonIndexed(){function e(r,v){const w=r.array,E=r.itemSize,T=r.normalized,k=new w.constructor(v.length*E);let R=0,D=0;for(let O=0,F=v.length;O<F;O++){r.isInterleavedBufferAttribute?R=v[O]*r.data.stride+r.offset:R=v[O]*E;for(let U=0;U<E;U++)k[D++]=w[R++]}return new wp(k,E,T)}if(this.index===null)return us("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new mf,s=this.index.array,l=this.attributes;for(const r in l){const v=l[r],w=e(v,s);n.setAttribute(r,w)}const u=this.morphAttributes;for(const r in u){const v=[],w=u[r];for(let E=0,T=w.length;E<T;E++){const k=w[E],R=e(k,s);v.push(R)}n.morphAttributes[r]=v}n.morphTargetsRelative=this.morphTargetsRelative;const p=this.groups;for(let r=0,v=p.length;r<v;r++){const w=p[r];n.addGroup(w.start,w.count,w.materialIndex)}return n}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const v=this.parameters;for(const w in v)v[w]!==void 0&&(e[w]=v[w]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const s=this.attributes;for(const v in s){const w=s[v];e.data.attributes[v]=w.toJSON(e.data)}const l={};let u=!1;for(const v in this.morphAttributes){const w=this.morphAttributes[v],E=[];for(let T=0,k=w.length;T<k;T++){const R=w[T];E.push(R.toJSON(e.data))}E.length>0&&(l[v]=E,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);const p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));const r=this.boundingSphere;return r!==null&&(e.data.boundingSphere=r.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone());const l=e.attributes;for(const w in l){const E=l[w];this.setAttribute(w,E.clone(n))}const u=e.morphAttributes;for(const w in u){const E=[],T=u[w];for(let k=0,R=T.length;k<R;k++)E.push(T[k].clone(n));this.morphAttributes[w]=E}this.morphTargetsRelative=e.morphTargetsRelative;const p=e.groups;for(let w=0,E=p.length;w<E;w++){const T=p[w];this.addGroup(T.start,T.count,T.materialIndex)}const r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());const v=e.boundingSphere;return v!==null&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Yz=new Da,Vy=new xq,vT=new JA,Jz=new Ln,bT=new Ln,wT=new Ln,ST=new Ln,x5=new Ln,TT=new Ln,e8=new Ln,ET=new Ln;class q0 extends Su{constructor(e=new mf,n=new bq){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,s=Object.keys(n);if(s.length>0){const l=n[s[0]];if(l!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,p=l.length;u<p;u++){const r=l[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=u}}}}getVertexPosition(e,n){const s=this.geometry,l=s.attributes.position,u=s.morphAttributes.position,p=s.morphTargetsRelative;n.fromBufferAttribute(l,e);const r=this.morphTargetInfluences;if(u&&r){TT.set(0,0,0);for(let v=0,w=u.length;v<w;v++){const E=r[v],T=u[v];E!==0&&(x5.fromBufferAttribute(T,e),p?TT.addScaledVector(x5,E):TT.addScaledVector(x5.sub(n),E))}n.add(TT)}return n}raycast(e,n){const s=this.geometry,l=this.material,u=this.matrixWorld;l!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),vT.copy(s.boundingSphere),vT.applyMatrix4(u),Vy.copy(e.ray).recast(e.near),!(vT.containsPoint(Vy.origin)===!1&&(Vy.intersectSphere(vT,Jz)===null||Vy.origin.distanceToSquared(Jz)>(e.far-e.near)**2))&&(Yz.copy(u).invert(),Vy.copy(e.ray).applyMatrix4(Yz),!(s.boundingBox!==null&&Vy.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(e,n,Vy)))}_computeIntersections(e,n,s){let l;const u=this.geometry,p=this.material,r=u.index,v=u.attributes.position,w=u.attributes.uv,E=u.attributes.uv1,T=u.attributes.normal,k=u.groups,R=u.drawRange;if(r!==null)if(Array.isArray(p))for(let D=0,O=k.length;D<O;D++){const F=k[D],U=p[F.materialIndex],X=Math.max(F.start,R.start),W=Math.min(r.count,Math.min(F.start+F.count,R.start+R.count));for(let K=X,ne=W;K<ne;K+=3){const te=r.getX(K),re=r.getX(K+1),xe=r.getX(K+2);l=AT(this,U,e,s,w,E,T,te,re,xe),l&&(l.faceIndex=Math.floor(K/3),l.face.materialIndex=F.materialIndex,n.push(l))}}else{const D=Math.max(0,R.start),O=Math.min(r.count,R.start+R.count);for(let F=D,U=O;F<U;F+=3){const X=r.getX(F),W=r.getX(F+1),K=r.getX(F+2);l=AT(this,p,e,s,w,E,T,X,W,K),l&&(l.faceIndex=Math.floor(F/3),n.push(l))}}else if(v!==void 0)if(Array.isArray(p))for(let D=0,O=k.length;D<O;D++){const F=k[D],U=p[F.materialIndex],X=Math.max(F.start,R.start),W=Math.min(v.count,Math.min(F.start+F.count,R.start+R.count));for(let K=X,ne=W;K<ne;K+=3){const te=K,re=K+1,xe=K+2;l=AT(this,U,e,s,w,E,T,te,re,xe),l&&(l.faceIndex=Math.floor(K/3),l.face.materialIndex=F.materialIndex,n.push(l))}}else{const D=Math.max(0,R.start),O=Math.min(v.count,R.start+R.count);for(let F=D,U=O;F<U;F+=3){const X=F,W=F+1,K=F+2;l=AT(this,p,e,s,w,E,T,X,W,K),l&&(l.faceIndex=Math.floor(F/3),n.push(l))}}}}function Iwe(t,e,n,s,l,u,p,r){let v;if(e.side===wu?v=s.intersectTriangle(p,u,l,!0,r):v=s.intersectTriangle(l,u,p,e.side===W0,r),v===null)return null;ET.copy(r),ET.applyMatrix4(t.matrixWorld);const w=n.ray.origin.distanceTo(ET);return w<n.near||w>n.far?null:{distance:w,point:ET.clone(),object:t}}function AT(t,e,n,s,l,u,p,r,v,w){t.getVertexPosition(r,bT),t.getVertexPosition(v,wT),t.getVertexPosition(w,ST);const E=Iwe(t,e,n,s,bT,wT,ST,e8);if(E){const T=new Ln;lf.getBarycoord(e8,bT,wT,ST,T),l&&(E.uv=lf.getInterpolatedAttribute(l,r,v,w,T,new po)),u&&(E.uv1=lf.getInterpolatedAttribute(u,r,v,w,T,new po)),p&&(E.normal=lf.getInterpolatedAttribute(p,r,v,w,T,new Ln),E.normal.dot(s.direction)>0&&E.normal.multiplyScalar(-1));const k={a:r,b:v,c:w,normal:new Ln,materialIndex:0};lf.getNormal(bT,wT,ST,k.normal),E.face=k,E.barycoord=T}return E}class N2 extends mf{constructor(e=1,n=1,s=1,l=1,u=1,p=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:s,widthSegments:l,heightSegments:u,depthSegments:p};const r=this;l=Math.floor(l),u=Math.floor(u),p=Math.floor(p);const v=[],w=[],E=[],T=[];let k=0,R=0;D("z","y","x",-1,-1,s,n,e,p,u,0),D("z","y","x",1,-1,s,n,-e,p,u,1),D("x","z","y",1,1,e,s,n,l,p,2),D("x","z","y",1,-1,e,s,-n,l,p,3),D("x","y","z",1,-1,e,n,s,l,u,4),D("x","y","z",-1,-1,e,n,-s,l,u,5),this.setIndex(v),this.setAttribute("position",new nd(w,3)),this.setAttribute("normal",new nd(E,3)),this.setAttribute("uv",new nd(T,2));function D(O,F,U,X,W,K,ne,te,re,xe,ae){const ce=K/re,ye=ne/xe,Ce=K/2,Me=ne/2,Ke=te/2,ke=re+1,je=xe+1;let $e=0,Ae=0;const He=new Ln;for(let qe=0;qe<je;qe++){const Le=qe*ye-Me;for(let st=0;st<ke;st++){const bt=st*ce-Ce;He[O]=bt*X,He[F]=Le*W,He[U]=Ke,w.push(He.x,He.y,He.z),He[O]=0,He[F]=0,He[U]=te>0?1:-1,E.push(He.x,He.y,He.z),T.push(st/re),T.push(1-qe/xe),$e+=1}}for(let qe=0;qe<xe;qe++)for(let Le=0;Le<re;Le++){const st=k+Le+ke*qe,bt=k+Le+ke*(qe+1),yt=k+(Le+1)+ke*(qe+1),Vt=k+(Le+1)+ke*qe;v.push(st,bt,Vt),v.push(bt,yt,Vt),Ae+=6}r.addGroup(R,Ae,ae),R+=Ae,k+=$e}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new N2(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cb(t){const e={};for(const n in t){e[n]={};for(const s in t[n]){const l=t[n][s];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture||l.isQuaternion)?l.isRenderTargetTexture?(us("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][s]=null):e[n][s]=l.clone():Array.isArray(l)?e[n][s]=l.slice():e[n][s]=l}}return e}function Lc(t){const e={};for(let n=0;n<t.length;n++){const s=cb(t[n]);for(const l in s)e[l]=s[l]}return e}function Pwe(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function Tq(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Js.workingColorSpace}const Rwe={clone:cb,merge:Lc};var Nwe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jwe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class lg extends R2{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Nwe,this.fragmentShader=jwe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cb(e.uniforms),this.uniformsGroups=Pwe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const l in this.uniforms){const p=this.uniforms[l].value;p&&p.isTexture?n.uniforms[l]={type:"t",value:p.toJSON(e).uuid}:p&&p.isColor?n.uniforms[l]={type:"c",value:p.getHex()}:p&&p.isVector2?n.uniforms[l]={type:"v2",value:p.toArray()}:p&&p.isVector3?n.uniforms[l]={type:"v3",value:p.toArray()}:p&&p.isVector4?n.uniforms[l]={type:"v4",value:p.toArray()}:p&&p.isMatrix3?n.uniforms[l]={type:"m3",value:p.toArray()}:p&&p.isMatrix4?n.uniforms[l]={type:"m4",value:p.toArray()}:n.uniforms[l]={value:p}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const s={};for(const l in this.extensions)this.extensions[l]===!0&&(s[l]=!0);return Object.keys(s).length>0&&(n.extensions=s),n}}class Eq extends Su{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Da,this.projectionMatrix=new Da,this.projectionMatrixInverse=new Da,this.coordinateSystem=gp,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const x0=new Ln,t8=new po,n8=new po;class Jd extends Eq{constructor(e=50,n=1,s=.1,l=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=l,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=oP*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(KM*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return oP*2*Math.atan(Math.tan(KM*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,s){x0.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(x0.x,x0.y).multiplyScalar(-e/x0.z),x0.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(x0.x,x0.y).multiplyScalar(-e/x0.z)}getViewSize(e,n){return this.getViewBounds(e,t8,n8),n.subVectors(n8,t8)}setViewOffset(e,n,s,l,u,p){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=s,this.view.offsetY=l,this.view.width=u,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(KM*.5*this.fov)/this.zoom,s=2*n,l=this.aspect*s,u=-.5*l;const p=this.view;if(this.view!==null&&this.view.enabled){const v=p.fullWidth,w=p.fullHeight;u+=p.offsetX*l/v,n-=p.offsetY*s/w,l*=p.width/v,s*=p.height/w}const r=this.filmOffset;r!==0&&(u+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(u,u+l,n,n-s,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const cv=-90,uv=1;class Dwe extends Su{constructor(e,n,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const l=new Jd(cv,uv,e,n);l.layers=this.layers,this.add(l);const u=new Jd(cv,uv,e,n);u.layers=this.layers,this.add(u);const p=new Jd(cv,uv,e,n);p.layers=this.layers,this.add(p);const r=new Jd(cv,uv,e,n);r.layers=this.layers,this.add(r);const v=new Jd(cv,uv,e,n);v.layers=this.layers,this.add(v);const w=new Jd(cv,uv,e,n);w.layers=this.layers,this.add(w)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[s,l,u,p,r,v]=n;for(const w of n)this.remove(w);if(e===gp)s.up.set(0,1,0),s.lookAt(1,0,0),l.up.set(0,1,0),l.lookAt(-1,0,0),u.up.set(0,0,-1),u.lookAt(0,1,0),p.up.set(0,0,1),p.lookAt(0,-1,0),r.up.set(0,1,0),r.lookAt(0,0,1),v.up.set(0,1,0),v.lookAt(0,0,-1);else if(e===$E)s.up.set(0,-1,0),s.lookAt(-1,0,0),l.up.set(0,-1,0),l.lookAt(1,0,0),u.up.set(0,0,1),u.lookAt(0,1,0),p.up.set(0,0,-1),p.lookAt(0,-1,0),r.up.set(0,-1,0),r.lookAt(0,0,1),v.up.set(0,-1,0),v.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const w of n)this.add(w),w.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:l}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[u,p,r,v,w,E]=this.children,T=e.getRenderTarget(),k=e.getActiveCubeFace(),R=e.getActiveMipmapLevel(),D=e.xr.enabled;e.xr.enabled=!1;const O=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0,l),e.render(n,u),e.setRenderTarget(s,1,l),e.render(n,p),e.setRenderTarget(s,2,l),e.render(n,r),e.setRenderTarget(s,3,l),e.render(n,v),e.setRenderTarget(s,4,l),e.render(n,w),s.texture.generateMipmaps=O,e.setRenderTarget(s,5,l),e.render(n,E),e.setRenderTarget(T,k,R),e.xr.enabled=D,s.texture.needsPMREMUpdate=!0}}class Aq extends $c{constructor(e=[],n=ob,s,l,u,p,r,v,w,E){super(e,n,s,l,u,p,r,v,w,E),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Lwe extends $x{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const s={width:e,height:e,depth:1},l=[s,s,s,s,s,s];this.texture=new Aq(l),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},l=new N2(5,5,5),u=new lg({name:"CubemapFromEquirect",uniforms:cb(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:wu,blending:Km});u.uniforms.tEquirect.value=n;const p=new q0(l,u),r=n.minFilter;return n.minFilter===cx&&(n.minFilter=rh),new Dwe(1,10,this).update(e,p),n.minFilter=r,p.geometry.dispose(),p.material.dispose(),this}clear(e,n=!0,s=!0,l=!0){const u=e.getRenderTarget();for(let p=0;p<6;p++)e.setRenderTarget(this,p),e.clear(n,s,l);e.setRenderTarget(u)}}class CT extends Su{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Owe={type:"move"};class _5{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new CT,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new CT,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ln,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ln),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new CT,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ln,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ln),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const s of e.hand.values())this._getHandJoint(n,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,s){let l=null,u=null,p=null;const r=this._targetRay,v=this._grip,w=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(w&&e.hand){p=!0;for(const O of e.hand.values()){const F=n.getJointPose(O,s),U=this._getHandJoint(w,O);F!==null&&(U.matrix.fromArray(F.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.matrixWorldNeedsUpdate=!0,U.jointRadius=F.radius),U.visible=F!==null}const E=w.joints["index-finger-tip"],T=w.joints["thumb-tip"],k=E.position.distanceTo(T.position),R=.02,D=.005;w.inputState.pinching&&k>R+D?(w.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!w.inputState.pinching&&k<=R-D&&(w.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else v!==null&&e.gripSpace&&(u=n.getPose(e.gripSpace,s),u!==null&&(v.matrix.fromArray(u.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,u.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(u.linearVelocity)):v.hasLinearVelocity=!1,u.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(u.angularVelocity)):v.hasAngularVelocity=!1));r!==null&&(l=n.getPose(e.targetRaySpace,s),l===null&&u!==null&&(l=u),l!==null&&(r.matrix.fromArray(l.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,l.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(l.linearVelocity)):r.hasLinearVelocity=!1,l.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(l.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(Owe)))}return r!==null&&(r.visible=l!==null),v!==null&&(v.visible=u!==null),w!==null&&(w.visible=p!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const s=new CT;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[n.jointName]=s,e.add(s)}return e.joints[n.jointName]}}class Fwe extends Su{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ag,this.environmentIntensity=1,this.environmentRotation=new ag,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class Bwe extends $c{constructor(e=null,n=1,s=1,l,u,p,r,v,w=ud,E=ud,T,k){super(null,p,r,v,w,E,l,u,T,k),this.isDataTexture=!0,this.image={data:e,width:n,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const v5=new Ln,zwe=new Ln,Uwe=new ms;class Ky{constructor(e=new Ln(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,s,l){return this.normal.set(e,n,s),this.constant=l,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,s){const l=v5.subVectors(s,n).cross(zwe.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(l,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const s=e.delta(v5),l=this.normal.dot(s);if(l===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const u=-(e.start.dot(this.normal)+this.constant)/l;return u<0||u>1?null:n.copy(e.start).addScaledVector(s,u)}intersectsLine(e){const n=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return n<0&&s>0||s<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const s=n||Uwe.getNormalMatrix(e),l=this.coplanarPoint(v5).applyMatrix4(e),u=this.normal.applyMatrix3(s).normalize();return this.constant=-l.dot(u),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Hy=new JA,Vwe=new po(.5,.5),MT=new Ln;class Cq{constructor(e=new Ky,n=new Ky,s=new Ky,l=new Ky,u=new Ky,p=new Ky){this.planes=[e,n,s,l,u,p]}set(e,n,s,l,u,p){const r=this.planes;return r[0].copy(e),r[1].copy(n),r[2].copy(s),r[3].copy(l),r[4].copy(u),r[5].copy(p),this}copy(e){const n=this.planes;for(let s=0;s<6;s++)n[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,n=gp,s=!1){const l=this.planes,u=e.elements,p=u[0],r=u[1],v=u[2],w=u[3],E=u[4],T=u[5],k=u[6],R=u[7],D=u[8],O=u[9],F=u[10],U=u[11],X=u[12],W=u[13],K=u[14],ne=u[15];if(l[0].setComponents(w-p,R-E,U-D,ne-X).normalize(),l[1].setComponents(w+p,R+E,U+D,ne+X).normalize(),l[2].setComponents(w+r,R+T,U+O,ne+W).normalize(),l[3].setComponents(w-r,R-T,U-O,ne-W).normalize(),s)l[4].setComponents(v,k,F,K).normalize(),l[5].setComponents(w-v,R-k,U-F,ne-K).normalize();else if(l[4].setComponents(w-v,R-k,U-F,ne-K).normalize(),n===gp)l[5].setComponents(w+v,R+k,U+F,ne+K).normalize();else if(n===$E)l[5].setComponents(v,k,F,K).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Hy.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Hy.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Hy)}intersectsSprite(e){Hy.center.set(0,0,0);const n=Vwe.distanceTo(e.center);return Hy.radius=.7071067811865476+n,Hy.applyMatrix4(e.matrixWorld),this.intersectsSphere(Hy)}intersectsSphere(e){const n=this.planes,s=e.center,l=-e.radius;for(let u=0;u<6;u++)if(n[u].distanceToPoint(s)<l)return!1;return!0}intersectsBox(e){const n=this.planes;for(let s=0;s<6;s++){const l=n[s];if(MT.x=l.normal.x>0?e.max.x:e.min.x,MT.y=l.normal.y>0?e.max.y:e.min.y,MT.z=l.normal.z>0?e.max.z:e.min.z,l.distanceToPoint(MT)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let s=0;s<6;s++)if(n[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class aP extends R2{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ro(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const r8=new Da,lP=new xq,kT=new JA,IT=new Ln;class i8 extends Su{constructor(e=new mf,n=new aP){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const s=this.geometry,l=this.matrixWorld,u=e.params.Points.threshold,p=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),kT.copy(s.boundingSphere),kT.applyMatrix4(l),kT.radius+=u,e.ray.intersectsSphere(kT)===!1)return;r8.copy(l).invert(),lP.copy(e.ray).applyMatrix4(r8);const r=u/((this.scale.x+this.scale.y+this.scale.z)/3),v=r*r,w=s.index,T=s.attributes.position;if(w!==null){const k=Math.max(0,p.start),R=Math.min(w.count,p.start+p.count);for(let D=k,O=R;D<O;D++){const F=w.getX(D);IT.fromBufferAttribute(T,F),s8(IT,F,v,l,e,n,this)}}else{const k=Math.max(0,p.start),R=Math.min(T.count,p.start+p.count);for(let D=k,O=R;D<O;D++)IT.fromBufferAttribute(T,D),s8(IT,D,v,l,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,s=Object.keys(n);if(s.length>0){const l=n[s[0]];if(l!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,p=l.length;u<p;u++){const r=l[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=u}}}}}function s8(t,e,n,s,l,u,p){const r=lP.distanceSqToPoint(t);if(r<n){const v=new Ln;lP.closestPointToPoint(t,v),v.applyMatrix4(s);const w=l.ray.origin.distanceTo(v);if(w<l.near||w>l.far)return;u.push({distance:w,distanceToRay:Math.sqrt(r),point:v,index:e,face:null,faceIndex:null,barycoord:null,object:p})}}class Mq extends $c{constructor(e,n,s=Gx,l,u,p,r=ud,v=ud,w,E=Hw,T=1){if(E!==Hw&&E!==Gw)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const k={width:e,height:n,depth:T};super(k,l,u,p,r,v,E,s,w),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new WN(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class kq extends $c{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class e3 extends mf{constructor(e=1,n=1,s=1,l=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:s,heightSegments:l};const u=e/2,p=n/2,r=Math.floor(s),v=Math.floor(l),w=r+1,E=v+1,T=e/r,k=n/v,R=[],D=[],O=[],F=[];for(let U=0;U<E;U++){const X=U*k-p;for(let W=0;W<w;W++){const K=W*T-u;D.push(K,-X,0),O.push(0,0,1),F.push(W/r),F.push(1-U/v)}}for(let U=0;U<v;U++)for(let X=0;X<r;X++){const W=X+w*U,K=X+w*(U+1),ne=X+1+w*(U+1),te=X+1+w*U;R.push(W,K,te),R.push(K,ne,te)}this.setIndex(R),this.setAttribute("position",new nd(D,3)),this.setAttribute("normal",new nd(O,3)),this.setAttribute("uv",new nd(F,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new e3(e.width,e.height,e.widthSegments,e.heightSegments)}}class Hwe extends R2{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ewe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Gwe extends R2{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class $we extends Eq{constructor(e=-1,n=1,s=1,l=-1,u=.1,p=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=s,this.bottom=l,this.near=u,this.far=p,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,s,l,u,p){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=s,this.view.offsetY=l,this.view.width=u,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,l=(this.top+this.bottom)/2;let u=s-e,p=s+e,r=l+n,v=l-n;if(this.view!==null&&this.view.enabled){const w=(this.right-this.left)/this.view.fullWidth/this.zoom,E=(this.top-this.bottom)/this.view.fullHeight/this.zoom;u+=w*this.view.offsetX,p=u+w*this.view.width,r-=E*this.view.offsetY,v=r-E*this.view.height}this.projectionMatrix.makeOrthographic(u,p,r,v,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class Wwe extends Jd{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}function o8(t,e,n,s){const l=qwe(s);switch(n){case hq:return t*e;case pq:return t*e/l.components*l.byteLength;case VN:return t*e/l.components*l.byteLength;case HN:return t*e*2/l.components*l.byteLength;case GN:return t*e*2/l.components*l.byteLength;case fq:return t*e*3/l.components*l.byteLength;case uf:return t*e*4/l.components*l.byteLength;case $N:return t*e*4/l.components*l.byteLength;case eE:case tE:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case nE:case rE:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case NI:case DI:return Math.max(t,16)*Math.max(e,8)/4;case RI:case jI:return Math.max(t,8)*Math.max(e,8)/2;case LI:case OI:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case FI:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case BI:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case zI:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case UI:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case VI:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case HI:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case GI:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case $I:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case WI:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case qI:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case XI:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case ZI:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case QI:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case KI:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case YI:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case JI:case eP:case tP:return Math.ceil(t/4)*Math.ceil(e/4)*16;case nP:case rP:return Math.ceil(t/4)*Math.ceil(e/4)*8;case iP:case sP:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function qwe(t){switch(t){case og:case lq:return{byteLength:1,components:1};case Uw:case cq:case Eb:return{byteLength:2,components:1};case zN:case UN:return{byteLength:2,components:4};case Gx:case BN:case Hm:return{byteLength:4,components:1};case uq:case dq:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:FN}}));typeof window<"u"&&(window.__THREE__?us("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=FN);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Iq(){let t=null,e=!1,n=null,s=null;function l(u,p){n(u,p),s=t.requestAnimationFrame(l)}return{start:function(){e!==!0&&n!==null&&(s=t.requestAnimationFrame(l),e=!0)},stop:function(){t.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(u){n=u},setContext:function(u){t=u}}}function Xwe(t){const e=new WeakMap;function n(r,v){const w=r.array,E=r.usage,T=w.byteLength,k=t.createBuffer();t.bindBuffer(v,k),t.bufferData(v,w,E),r.onUploadCallback();let R;if(w instanceof Float32Array)R=t.FLOAT;else if(typeof Float16Array<"u"&&w instanceof Float16Array)R=t.HALF_FLOAT;else if(w instanceof Uint16Array)r.isFloat16BufferAttribute?R=t.HALF_FLOAT:R=t.UNSIGNED_SHORT;else if(w instanceof Int16Array)R=t.SHORT;else if(w instanceof Uint32Array)R=t.UNSIGNED_INT;else if(w instanceof Int32Array)R=t.INT;else if(w instanceof Int8Array)R=t.BYTE;else if(w instanceof Uint8Array)R=t.UNSIGNED_BYTE;else if(w instanceof Uint8ClampedArray)R=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+w);return{buffer:k,type:R,bytesPerElement:w.BYTES_PER_ELEMENT,version:r.version,size:T}}function s(r,v,w){const E=v.array,T=v.updateRanges;if(t.bindBuffer(w,r),T.length===0)t.bufferSubData(w,0,E);else{T.sort((R,D)=>R.start-D.start);let k=0;for(let R=1;R<T.length;R++){const D=T[k],O=T[R];O.start<=D.start+D.count+1?D.count=Math.max(D.count,O.start+O.count-D.start):(++k,T[k]=O)}T.length=k+1;for(let R=0,D=T.length;R<D;R++){const O=T[R];t.bufferSubData(w,O.start*E.BYTES_PER_ELEMENT,E,O.start,O.count)}v.clearUpdateRanges()}v.onUploadCallback()}function l(r){return r.isInterleavedBufferAttribute&&(r=r.data),e.get(r)}function u(r){r.isInterleavedBufferAttribute&&(r=r.data);const v=e.get(r);v&&(t.deleteBuffer(v.buffer),e.delete(r))}function p(r,v){if(r.isInterleavedBufferAttribute&&(r=r.data),r.isGLBufferAttribute){const E=e.get(r);(!E||E.version<r.version)&&e.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}const w=e.get(r);if(w===void 0)e.set(r,n(r,v));else if(w.version<r.version){if(w.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(w.buffer,r,v),w.version=r.version}}return{get:l,remove:u,update:p}}var Zwe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Qwe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Kwe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Ywe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Jwe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,e2e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,t2e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,n2e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,r2e=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,i2e=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,s2e=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,o2e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,a2e=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,l2e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,c2e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,u2e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,d2e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,h2e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,f2e=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,p2e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,m2e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,g2e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,y2e=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,x2e=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,_2e=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,v2e=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,b2e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,w2e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,S2e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,T2e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,E2e="gl_FragColor = linearToOutputTexel( gl_FragColor );",A2e=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,C2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,M2e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,k2e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,I2e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,P2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,R2e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,N2e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,j2e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,D2e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,L2e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,O2e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,F2e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,B2e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,z2e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,U2e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,V2e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,H2e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,G2e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,$2e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,W2e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,q2e=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,X2e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Z2e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Q2e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,K2e=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Y2e=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,J2e=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eSe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,tSe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,nSe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,rSe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,iSe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sSe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oSe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,aSe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,lSe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,cSe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,uSe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,dSe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,hSe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,fSe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pSe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mSe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gSe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,ySe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,xSe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,_Se=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,vSe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bSe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,wSe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,SSe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,TSe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ESe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ASe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CSe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,MSe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,kSe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ISe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,PSe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RSe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,NSe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,jSe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,DSe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,LSe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OSe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,FSe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,BSe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zSe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,USe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,VSe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,HSe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,GSe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,$Se=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,WSe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,qSe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const XSe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,ZSe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QSe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KSe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,YSe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,JSe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,eTe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,tTe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,nTe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,rTe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,iTe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sTe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,oTe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aTe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lTe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,cTe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uTe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dTe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hTe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fTe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pTe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,mTe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,gTe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yTe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xTe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_Te=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vTe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bTe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wTe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,STe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TTe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ETe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ATe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,CTe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vs={alphahash_fragment:Zwe,alphahash_pars_fragment:Qwe,alphamap_fragment:Kwe,alphamap_pars_fragment:Ywe,alphatest_fragment:Jwe,alphatest_pars_fragment:e2e,aomap_fragment:t2e,aomap_pars_fragment:n2e,batching_pars_vertex:r2e,batching_vertex:i2e,begin_vertex:s2e,beginnormal_vertex:o2e,bsdfs:a2e,iridescence_fragment:l2e,bumpmap_pars_fragment:c2e,clipping_planes_fragment:u2e,clipping_planes_pars_fragment:d2e,clipping_planes_pars_vertex:h2e,clipping_planes_vertex:f2e,color_fragment:p2e,color_pars_fragment:m2e,color_pars_vertex:g2e,color_vertex:y2e,common:x2e,cube_uv_reflection_fragment:_2e,defaultnormal_vertex:v2e,displacementmap_pars_vertex:b2e,displacementmap_vertex:w2e,emissivemap_fragment:S2e,emissivemap_pars_fragment:T2e,colorspace_fragment:E2e,colorspace_pars_fragment:A2e,envmap_fragment:C2e,envmap_common_pars_fragment:M2e,envmap_pars_fragment:k2e,envmap_pars_vertex:I2e,envmap_physical_pars_fragment:U2e,envmap_vertex:P2e,fog_vertex:R2e,fog_pars_vertex:N2e,fog_fragment:j2e,fog_pars_fragment:D2e,gradientmap_pars_fragment:L2e,lightmap_pars_fragment:O2e,lights_lambert_fragment:F2e,lights_lambert_pars_fragment:B2e,lights_pars_begin:z2e,lights_toon_fragment:V2e,lights_toon_pars_fragment:H2e,lights_phong_fragment:G2e,lights_phong_pars_fragment:$2e,lights_physical_fragment:W2e,lights_physical_pars_fragment:q2e,lights_fragment_begin:X2e,lights_fragment_maps:Z2e,lights_fragment_end:Q2e,logdepthbuf_fragment:K2e,logdepthbuf_pars_fragment:Y2e,logdepthbuf_pars_vertex:J2e,logdepthbuf_vertex:eSe,map_fragment:tSe,map_pars_fragment:nSe,map_particle_fragment:rSe,map_particle_pars_fragment:iSe,metalnessmap_fragment:sSe,metalnessmap_pars_fragment:oSe,morphinstance_vertex:aSe,morphcolor_vertex:lSe,morphnormal_vertex:cSe,morphtarget_pars_vertex:uSe,morphtarget_vertex:dSe,normal_fragment_begin:hSe,normal_fragment_maps:fSe,normal_pars_fragment:pSe,normal_pars_vertex:mSe,normal_vertex:gSe,normalmap_pars_fragment:ySe,clearcoat_normal_fragment_begin:xSe,clearcoat_normal_fragment_maps:_Se,clearcoat_pars_fragment:vSe,iridescence_pars_fragment:bSe,opaque_fragment:wSe,packing:SSe,premultiplied_alpha_fragment:TSe,project_vertex:ESe,dithering_fragment:ASe,dithering_pars_fragment:CSe,roughnessmap_fragment:MSe,roughnessmap_pars_fragment:kSe,shadowmap_pars_fragment:ISe,shadowmap_pars_vertex:PSe,shadowmap_vertex:RSe,shadowmask_pars_fragment:NSe,skinbase_vertex:jSe,skinning_pars_vertex:DSe,skinning_vertex:LSe,skinnormal_vertex:OSe,specularmap_fragment:FSe,specularmap_pars_fragment:BSe,tonemapping_fragment:zSe,tonemapping_pars_fragment:USe,transmission_fragment:VSe,transmission_pars_fragment:HSe,uv_pars_fragment:GSe,uv_pars_vertex:$Se,uv_vertex:WSe,worldpos_vertex:qSe,background_vert:XSe,background_frag:ZSe,backgroundCube_vert:QSe,backgroundCube_frag:KSe,cube_vert:YSe,cube_frag:JSe,depth_vert:eTe,depth_frag:tTe,distanceRGBA_vert:nTe,distanceRGBA_frag:rTe,equirect_vert:iTe,equirect_frag:sTe,linedashed_vert:oTe,linedashed_frag:aTe,meshbasic_vert:lTe,meshbasic_frag:cTe,meshlambert_vert:uTe,meshlambert_frag:dTe,meshmatcap_vert:hTe,meshmatcap_frag:fTe,meshnormal_vert:pTe,meshnormal_frag:mTe,meshphong_vert:gTe,meshphong_frag:yTe,meshphysical_vert:xTe,meshphysical_frag:_Te,meshtoon_vert:vTe,meshtoon_frag:bTe,points_vert:wTe,points_frag:STe,shadow_vert:TTe,shadow_frag:ETe,sprite_vert:ATe,sprite_frag:CTe},qr={common:{diffuse:{value:new ro(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ms},alphaMap:{value:null},alphaMapTransform:{value:new ms},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ms}},envmap:{envMap:{value:null},envMapRotation:{value:new ms},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ms}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ms}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ms},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ms},normalScale:{value:new po(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ms},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ms}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ms}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ms}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ro(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ro(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ms},alphaTest:{value:0},uvTransform:{value:new ms}},sprite:{diffuse:{value:new ro(16777215)},opacity:{value:1},center:{value:new po(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ms},alphaMap:{value:null},alphaMapTransform:{value:new ms},alphaTest:{value:0}}},pp={basic:{uniforms:Lc([qr.common,qr.specularmap,qr.envmap,qr.aomap,qr.lightmap,qr.fog]),vertexShader:vs.meshbasic_vert,fragmentShader:vs.meshbasic_frag},lambert:{uniforms:Lc([qr.common,qr.specularmap,qr.envmap,qr.aomap,qr.lightmap,qr.emissivemap,qr.bumpmap,qr.normalmap,qr.displacementmap,qr.fog,qr.lights,{emissive:{value:new ro(0)}}]),vertexShader:vs.meshlambert_vert,fragmentShader:vs.meshlambert_frag},phong:{uniforms:Lc([qr.common,qr.specularmap,qr.envmap,qr.aomap,qr.lightmap,qr.emissivemap,qr.bumpmap,qr.normalmap,qr.displacementmap,qr.fog,qr.lights,{emissive:{value:new ro(0)},specular:{value:new ro(1118481)},shininess:{value:30}}]),vertexShader:vs.meshphong_vert,fragmentShader:vs.meshphong_frag},standard:{uniforms:Lc([qr.common,qr.envmap,qr.aomap,qr.lightmap,qr.emissivemap,qr.bumpmap,qr.normalmap,qr.displacementmap,qr.roughnessmap,qr.metalnessmap,qr.fog,qr.lights,{emissive:{value:new ro(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vs.meshphysical_vert,fragmentShader:vs.meshphysical_frag},toon:{uniforms:Lc([qr.common,qr.aomap,qr.lightmap,qr.emissivemap,qr.bumpmap,qr.normalmap,qr.displacementmap,qr.gradientmap,qr.fog,qr.lights,{emissive:{value:new ro(0)}}]),vertexShader:vs.meshtoon_vert,fragmentShader:vs.meshtoon_frag},matcap:{uniforms:Lc([qr.common,qr.bumpmap,qr.normalmap,qr.displacementmap,qr.fog,{matcap:{value:null}}]),vertexShader:vs.meshmatcap_vert,fragmentShader:vs.meshmatcap_frag},points:{uniforms:Lc([qr.points,qr.fog]),vertexShader:vs.points_vert,fragmentShader:vs.points_frag},dashed:{uniforms:Lc([qr.common,qr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vs.linedashed_vert,fragmentShader:vs.linedashed_frag},depth:{uniforms:Lc([qr.common,qr.displacementmap]),vertexShader:vs.depth_vert,fragmentShader:vs.depth_frag},normal:{uniforms:Lc([qr.common,qr.bumpmap,qr.normalmap,qr.displacementmap,{opacity:{value:1}}]),vertexShader:vs.meshnormal_vert,fragmentShader:vs.meshnormal_frag},sprite:{uniforms:Lc([qr.sprite,qr.fog]),vertexShader:vs.sprite_vert,fragmentShader:vs.sprite_frag},background:{uniforms:{uvTransform:{value:new ms},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:vs.background_vert,fragmentShader:vs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ms}},vertexShader:vs.backgroundCube_vert,fragmentShader:vs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vs.cube_vert,fragmentShader:vs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vs.equirect_vert,fragmentShader:vs.equirect_frag},distanceRGBA:{uniforms:Lc([qr.common,qr.displacementmap,{referencePosition:{value:new Ln},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vs.distanceRGBA_vert,fragmentShader:vs.distanceRGBA_frag},shadow:{uniforms:Lc([qr.lights,qr.fog,{color:{value:new ro(0)},opacity:{value:1}}]),vertexShader:vs.shadow_vert,fragmentShader:vs.shadow_frag}};pp.physical={uniforms:Lc([pp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ms},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ms},clearcoatNormalScale:{value:new po(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ms},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ms},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ms},sheen:{value:0},sheenColor:{value:new ro(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ms},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ms},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ms},transmissionSamplerSize:{value:new po},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ms},attenuationDistance:{value:0},attenuationColor:{value:new ro(0)},specularColor:{value:new ro(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ms},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ms},anisotropyVector:{value:new po},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ms}}]),vertexShader:vs.meshphysical_vert,fragmentShader:vs.meshphysical_frag};const PT={r:0,b:0,g:0},Gy=new ag,MTe=new Da;function kTe(t,e,n,s,l,u,p){const r=new ro(0);let v=u===!0?0:1,w,E,T=null,k=0,R=null;function D(W){let K=W.isScene===!0?W.background:null;return K&&K.isTexture&&(K=(W.backgroundBlurriness>0?n:e).get(K)),K}function O(W){let K=!1;const ne=D(W);ne===null?U(r,v):ne&&ne.isColor&&(U(ne,1),K=!0);const te=t.xr.getEnvironmentBlendMode();te==="additive"?s.buffers.color.setClear(0,0,0,1,p):te==="alpha-blend"&&s.buffers.color.setClear(0,0,0,0,p),(t.autoClear||K)&&(s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function F(W,K){const ne=D(K);ne&&(ne.isCubeTexture||ne.mapping===YA)?(E===void 0&&(E=new q0(new N2(1,1,1),new lg({name:"BackgroundCubeMaterial",uniforms:cb(pp.backgroundCube.uniforms),vertexShader:pp.backgroundCube.vertexShader,fragmentShader:pp.backgroundCube.fragmentShader,side:wu,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),E.geometry.deleteAttribute("normal"),E.geometry.deleteAttribute("uv"),E.onBeforeRender=function(te,re,xe){this.matrixWorld.copyPosition(xe.matrixWorld)},Object.defineProperty(E.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(E)),Gy.copy(K.backgroundRotation),Gy.x*=-1,Gy.y*=-1,Gy.z*=-1,ne.isCubeTexture&&ne.isRenderTargetTexture===!1&&(Gy.y*=-1,Gy.z*=-1),E.material.uniforms.envMap.value=ne,E.material.uniforms.flipEnvMap.value=ne.isCubeTexture&&ne.isRenderTargetTexture===!1?-1:1,E.material.uniforms.backgroundBlurriness.value=K.backgroundBlurriness,E.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,E.material.uniforms.backgroundRotation.value.setFromMatrix4(MTe.makeRotationFromEuler(Gy)),E.material.toneMapped=Js.getTransfer(ne.colorSpace)!==fo,(T!==ne||k!==ne.version||R!==t.toneMapping)&&(E.material.needsUpdate=!0,T=ne,k=ne.version,R=t.toneMapping),E.layers.enableAll(),W.unshift(E,E.geometry,E.material,0,0,null)):ne&&ne.isTexture&&(w===void 0&&(w=new q0(new e3(2,2),new lg({name:"BackgroundMaterial",uniforms:cb(pp.background.uniforms),vertexShader:pp.background.vertexShader,fragmentShader:pp.background.fragmentShader,side:W0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),w.geometry.deleteAttribute("normal"),Object.defineProperty(w.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(w)),w.material.uniforms.t2D.value=ne,w.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,w.material.toneMapped=Js.getTransfer(ne.colorSpace)!==fo,ne.matrixAutoUpdate===!0&&ne.updateMatrix(),w.material.uniforms.uvTransform.value.copy(ne.matrix),(T!==ne||k!==ne.version||R!==t.toneMapping)&&(w.material.needsUpdate=!0,T=ne,k=ne.version,R=t.toneMapping),w.layers.enableAll(),W.unshift(w,w.geometry,w.material,0,0,null))}function U(W,K){W.getRGB(PT,Tq(t)),s.buffers.color.setClear(PT.r,PT.g,PT.b,K,p)}function X(){E!==void 0&&(E.geometry.dispose(),E.material.dispose(),E=void 0),w!==void 0&&(w.geometry.dispose(),w.material.dispose(),w=void 0)}return{getClearColor:function(){return r},setClearColor:function(W,K=1){r.set(W),v=K,U(r,v)},getClearAlpha:function(){return v},setClearAlpha:function(W){v=W,U(r,v)},render:O,addToRenderList:F,dispose:X}}function ITe(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),s={},l=k(null);let u=l,p=!1;function r(ce,ye,Ce,Me,Ke){let ke=!1;const je=T(Me,Ce,ye);u!==je&&(u=je,w(u.object)),ke=R(ce,Me,Ce,Ke),ke&&D(ce,Me,Ce,Ke),Ke!==null&&e.update(Ke,t.ELEMENT_ARRAY_BUFFER),(ke||p)&&(p=!1,K(ce,ye,Ce,Me),Ke!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(Ke).buffer))}function v(){return t.createVertexArray()}function w(ce){return t.bindVertexArray(ce)}function E(ce){return t.deleteVertexArray(ce)}function T(ce,ye,Ce){const Me=Ce.wireframe===!0;let Ke=s[ce.id];Ke===void 0&&(Ke={},s[ce.id]=Ke);let ke=Ke[ye.id];ke===void 0&&(ke={},Ke[ye.id]=ke);let je=ke[Me];return je===void 0&&(je=k(v()),ke[Me]=je),je}function k(ce){const ye=[],Ce=[],Me=[];for(let Ke=0;Ke<n;Ke++)ye[Ke]=0,Ce[Ke]=0,Me[Ke]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ye,enabledAttributes:Ce,attributeDivisors:Me,object:ce,attributes:{},index:null}}function R(ce,ye,Ce,Me){const Ke=u.attributes,ke=ye.attributes;let je=0;const $e=Ce.getAttributes();for(const Ae in $e)if($e[Ae].location>=0){const qe=Ke[Ae];let Le=ke[Ae];if(Le===void 0&&(Ae==="instanceMatrix"&&ce.instanceMatrix&&(Le=ce.instanceMatrix),Ae==="instanceColor"&&ce.instanceColor&&(Le=ce.instanceColor)),qe===void 0||qe.attribute!==Le||Le&&qe.data!==Le.data)return!0;je++}return u.attributesNum!==je||u.index!==Me}function D(ce,ye,Ce,Me){const Ke={},ke=ye.attributes;let je=0;const $e=Ce.getAttributes();for(const Ae in $e)if($e[Ae].location>=0){let qe=ke[Ae];qe===void 0&&(Ae==="instanceMatrix"&&ce.instanceMatrix&&(qe=ce.instanceMatrix),Ae==="instanceColor"&&ce.instanceColor&&(qe=ce.instanceColor));const Le={};Le.attribute=qe,qe&&qe.data&&(Le.data=qe.data),Ke[Ae]=Le,je++}u.attributes=Ke,u.attributesNum=je,u.index=Me}function O(){const ce=u.newAttributes;for(let ye=0,Ce=ce.length;ye<Ce;ye++)ce[ye]=0}function F(ce){U(ce,0)}function U(ce,ye){const Ce=u.newAttributes,Me=u.enabledAttributes,Ke=u.attributeDivisors;Ce[ce]=1,Me[ce]===0&&(t.enableVertexAttribArray(ce),Me[ce]=1),Ke[ce]!==ye&&(t.vertexAttribDivisor(ce,ye),Ke[ce]=ye)}function X(){const ce=u.newAttributes,ye=u.enabledAttributes;for(let Ce=0,Me=ye.length;Ce<Me;Ce++)ye[Ce]!==ce[Ce]&&(t.disableVertexAttribArray(Ce),ye[Ce]=0)}function W(ce,ye,Ce,Me,Ke,ke,je){je===!0?t.vertexAttribIPointer(ce,ye,Ce,Ke,ke):t.vertexAttribPointer(ce,ye,Ce,Me,Ke,ke)}function K(ce,ye,Ce,Me){O();const Ke=Me.attributes,ke=Ce.getAttributes(),je=ye.defaultAttributeValues;for(const $e in ke){const Ae=ke[$e];if(Ae.location>=0){let He=Ke[$e];if(He===void 0&&($e==="instanceMatrix"&&ce.instanceMatrix&&(He=ce.instanceMatrix),$e==="instanceColor"&&ce.instanceColor&&(He=ce.instanceColor)),He!==void 0){const qe=He.normalized,Le=He.itemSize,st=e.get(He);if(st===void 0)continue;const bt=st.buffer,yt=st.type,Vt=st.bytesPerElement,_t=yt===t.INT||yt===t.UNSIGNED_INT||He.gpuType===BN;if(He.isInterleavedBufferAttribute){const vt=He.data,qt=vt.stride,kt=He.offset;if(vt.isInstancedInterleavedBuffer){for(let on=0;on<Ae.locationSize;on++)U(Ae.location+on,vt.meshPerAttribute);ce.isInstancedMesh!==!0&&Me._maxInstanceCount===void 0&&(Me._maxInstanceCount=vt.meshPerAttribute*vt.count)}else for(let on=0;on<Ae.locationSize;on++)F(Ae.location+on);t.bindBuffer(t.ARRAY_BUFFER,bt);for(let on=0;on<Ae.locationSize;on++)W(Ae.location+on,Le/Ae.locationSize,yt,qe,qt*Vt,(kt+Le/Ae.locationSize*on)*Vt,_t)}else{if(He.isInstancedBufferAttribute){for(let vt=0;vt<Ae.locationSize;vt++)U(Ae.location+vt,He.meshPerAttribute);ce.isInstancedMesh!==!0&&Me._maxInstanceCount===void 0&&(Me._maxInstanceCount=He.meshPerAttribute*He.count)}else for(let vt=0;vt<Ae.locationSize;vt++)F(Ae.location+vt);t.bindBuffer(t.ARRAY_BUFFER,bt);for(let vt=0;vt<Ae.locationSize;vt++)W(Ae.location+vt,Le/Ae.locationSize,yt,qe,Le*Vt,Le/Ae.locationSize*vt*Vt,_t)}}else if(je!==void 0){const qe=je[$e];if(qe!==void 0)switch(qe.length){case 2:t.vertexAttrib2fv(Ae.location,qe);break;case 3:t.vertexAttrib3fv(Ae.location,qe);break;case 4:t.vertexAttrib4fv(Ae.location,qe);break;default:t.vertexAttrib1fv(Ae.location,qe)}}}}X()}function ne(){xe();for(const ce in s){const ye=s[ce];for(const Ce in ye){const Me=ye[Ce];for(const Ke in Me)E(Me[Ke].object),delete Me[Ke];delete ye[Ce]}delete s[ce]}}function te(ce){if(s[ce.id]===void 0)return;const ye=s[ce.id];for(const Ce in ye){const Me=ye[Ce];for(const Ke in Me)E(Me[Ke].object),delete Me[Ke];delete ye[Ce]}delete s[ce.id]}function re(ce){for(const ye in s){const Ce=s[ye];if(Ce[ce.id]===void 0)continue;const Me=Ce[ce.id];for(const Ke in Me)E(Me[Ke].object),delete Me[Ke];delete Ce[ce.id]}}function xe(){ae(),p=!0,u!==l&&(u=l,w(u.object))}function ae(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:r,reset:xe,resetDefaultState:ae,dispose:ne,releaseStatesOfGeometry:te,releaseStatesOfProgram:re,initAttributes:O,enableAttribute:F,disableUnusedAttributes:X}}function PTe(t,e,n){let s;function l(w){s=w}function u(w,E){t.drawArrays(s,w,E),n.update(E,s,1)}function p(w,E,T){T!==0&&(t.drawArraysInstanced(s,w,E,T),n.update(E,s,T))}function r(w,E,T){if(T===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(s,w,0,E,0,T);let R=0;for(let D=0;D<T;D++)R+=E[D];n.update(R,s,1)}function v(w,E,T,k){if(T===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let D=0;D<w.length;D++)p(w[D],E[D],k[D]);else{R.multiDrawArraysInstancedWEBGL(s,w,0,E,0,k,0,T);let D=0;for(let O=0;O<T;O++)D+=E[O]*k[O];n.update(D,s,1)}}this.setMode=l,this.render=u,this.renderInstances=p,this.renderMultiDraw=r,this.renderMultiDrawInstances=v}function RTe(t,e,n,s){let l;function u(){if(l!==void 0)return l;if(e.has("EXT_texture_filter_anisotropic")===!0){const re=e.get("EXT_texture_filter_anisotropic");l=t.getParameter(re.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else l=0;return l}function p(re){return!(re!==uf&&s.convert(re)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function r(re){const xe=re===Eb&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(re!==og&&s.convert(re)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&re!==Hm&&!xe)}function v(re){if(re==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";re="mediump"}return re==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let w=n.precision!==void 0?n.precision:"highp";const E=v(w);E!==w&&(us("WebGLRenderer:",w,"not supported, using",E,"instead."),w=E);const T=n.logarithmicDepthBuffer===!0,k=n.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),R=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),D=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),O=t.getParameter(t.MAX_TEXTURE_SIZE),F=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),U=t.getParameter(t.MAX_VERTEX_ATTRIBS),X=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),W=t.getParameter(t.MAX_VARYING_VECTORS),K=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),ne=D>0,te=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:u,getMaxPrecision:v,textureFormatReadable:p,textureTypeReadable:r,precision:w,logarithmicDepthBuffer:T,reversedDepthBuffer:k,maxTextures:R,maxVertexTextures:D,maxTextureSize:O,maxCubemapSize:F,maxAttributes:U,maxVertexUniforms:X,maxVaryings:W,maxFragmentUniforms:K,vertexTextures:ne,maxSamples:te}}function NTe(t){const e=this;let n=null,s=0,l=!1,u=!1;const p=new Ky,r=new ms,v={value:null,needsUpdate:!1};this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(T,k){const R=T.length!==0||k||s!==0||l;return l=k,s=T.length,R},this.beginShadows=function(){u=!0,E(null)},this.endShadows=function(){u=!1},this.setGlobalState=function(T,k){n=E(T,k,0)},this.setState=function(T,k,R){const D=T.clippingPlanes,O=T.clipIntersection,F=T.clipShadows,U=t.get(T);if(!l||D===null||D.length===0||u&&!F)u?E(null):w();else{const X=u?0:s,W=X*4;let K=U.clippingState||null;v.value=K,K=E(D,k,W,R);for(let ne=0;ne!==W;++ne)K[ne]=n[ne];U.clippingState=K,this.numIntersection=O?this.numPlanes:0,this.numPlanes+=X}};function w(){v.value!==n&&(v.value=n,v.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function E(T,k,R,D){const O=T!==null?T.length:0;let F=null;if(O!==0){if(F=v.value,D!==!0||F===null){const U=R+O*4,X=k.matrixWorldInverse;r.getNormalMatrix(X),(F===null||F.length<U)&&(F=new Float32Array(U));for(let W=0,K=R;W!==O;++W,K+=4)p.copy(T[W]).applyMatrix4(X,r),p.normal.toArray(F,K),F[K+3]=p.constant}v.value=F,v.needsUpdate=!0}return e.numPlanes=O,e.numIntersection=0,F}}function jTe(t){let e=new WeakMap;function n(p,r){return r===MI?p.mapping=ob:r===kI&&(p.mapping=ab),p}function s(p){if(p&&p.isTexture){const r=p.mapping;if(r===MI||r===kI)if(e.has(p)){const v=e.get(p).texture;return n(v,p.mapping)}else{const v=p.image;if(v&&v.height>0){const w=new Lwe(v.height);return w.fromEquirectangularTexture(t,p),e.set(p,w),p.addEventListener("dispose",l),n(w.texture,p.mapping)}else return null}}return p}function l(p){const r=p.target;r.removeEventListener("dispose",l);const v=e.get(r);v!==void 0&&(e.delete(r),v.dispose())}function u(){e=new WeakMap}return{get:s,dispose:u}}const j0=4,a8=[.125,.215,.35,.446,.526,.582],nx=20,DTe=256,N1=new $we,l8=new ro;let b5=null,w5=0,S5=0,T5=!1;const LTe=new Ln;class c8{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,n=0,s=.1,l=100,u={}){const{size:p=256,position:r=LTe}=u;b5=this._renderer.getRenderTarget(),w5=this._renderer.getActiveCubeFace(),S5=this._renderer.getActiveMipmapLevel(),T5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(p);const v=this._allocateTargets();return v.depthBuffer=!0,this._sceneToCubeUV(e,s,l,v,r),n>0&&this._blur(v,0,0,n),this._applyPMREM(v),this._cleanup(v),v}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=h8(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=d8(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(b5,w5,S5),this._renderer.xr.enabled=T5,e.scissorTest=!1,dv(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===ob||e.mapping===ab?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),b5=this._renderer.getRenderTarget(),w5=this._renderer.getActiveCubeFace(),S5=this._renderer.getActiveMipmapLevel(),T5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const s=n||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,s={magFilter:rh,minFilter:rh,generateMipmaps:!1,type:Eb,format:uf,colorSpace:lb,depthBuffer:!1},l=u8(e,n,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=u8(e,n,s);const{_lodMax:u}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=OTe(u)),this._blurMaterial=BTe(u,e,n),this._ggxMaterial=FTe(u,e,n)}return l}_compileMaterial(e){const n=new q0(new mf,e);this._renderer.compile(n,N1)}_sceneToCubeUV(e,n,s,l,u){const v=new Jd(90,1,n,s),w=[1,-1,1,1,1,1],E=[1,1,1,-1,-1,-1],T=this._renderer,k=T.autoClear,R=T.toneMapping;T.getClearColor(l8),T.toneMapping=B0,T.autoClear=!1,T.state.buffers.depth.getReversed()&&(T.setRenderTarget(l),T.clearDepth(),T.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new q0(new N2,new bq({name:"PMREM.Background",side:wu,depthWrite:!1,depthTest:!1})));const O=this._backgroundBox,F=O.material;let U=!1;const X=e.background;X?X.isColor&&(F.color.copy(X),e.background=null,U=!0):(F.color.copy(l8),U=!0);for(let W=0;W<6;W++){const K=W%3;K===0?(v.up.set(0,w[W],0),v.position.set(u.x,u.y,u.z),v.lookAt(u.x+E[W],u.y,u.z)):K===1?(v.up.set(0,0,w[W]),v.position.set(u.x,u.y,u.z),v.lookAt(u.x,u.y+E[W],u.z)):(v.up.set(0,w[W],0),v.position.set(u.x,u.y,u.z),v.lookAt(u.x,u.y,u.z+E[W]));const ne=this._cubeSize;dv(l,K*ne,W>2?ne:0,ne,ne),T.setRenderTarget(l),U&&T.render(O,v),T.render(e,v)}T.toneMapping=R,T.autoClear=k,e.background=X}_textureToCubeUV(e,n){const s=this._renderer,l=e.mapping===ob||e.mapping===ab;l?(this._cubemapMaterial===null&&(this._cubemapMaterial=h8()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=d8());const u=l?this._cubemapMaterial:this._equirectMaterial,p=this._lodMeshes[0];p.material=u;const r=u.uniforms;r.envMap.value=e;const v=this._cubeSize;dv(n,0,0,3*v,2*v),s.setRenderTarget(n),s.render(p,N1)}_applyPMREM(e){const n=this._renderer,s=n.autoClear;n.autoClear=!1;const l=this._lodMeshes.length;for(let u=1;u<l;u++)this._applyGGXFilter(e,u-1,u);n.autoClear=s}_applyGGXFilter(e,n,s){const l=this._renderer,u=this._pingPongRenderTarget,p=this._ggxMaterial,r=this._lodMeshes[s];r.material=p;const v=p.uniforms,w=s/(this._lodMeshes.length-1),E=n/(this._lodMeshes.length-1),T=Math.sqrt(w*w-E*E),k=.05+w*.95,R=T*k,{_lodMax:D}=this,O=this._sizeLods[s],F=3*O*(s>D-j0?s-D+j0:0),U=4*(this._cubeSize-O);v.envMap.value=e.texture,v.roughness.value=R,v.mipInt.value=D-n,dv(u,F,U,3*O,2*O),l.setRenderTarget(u),l.render(r,N1),v.envMap.value=u.texture,v.roughness.value=0,v.mipInt.value=D-s,dv(e,F,U,3*O,2*O),l.setRenderTarget(e),l.render(r,N1)}_blur(e,n,s,l,u){const p=this._pingPongRenderTarget;this._halfBlur(e,p,n,s,l,"latitudinal",u),this._halfBlur(p,e,s,s,l,"longitudinal",u)}_halfBlur(e,n,s,l,u,p,r){const v=this._renderer,w=this._blurMaterial;p!=="latitudinal"&&p!=="longitudinal"&&xa("blur direction must be either latitudinal or longitudinal!");const E=3,T=this._lodMeshes[l];T.material=w;const k=w.uniforms,R=this._sizeLods[s]-1,D=isFinite(u)?Math.PI/(2*R):2*Math.PI/(2*nx-1),O=u/D,F=isFinite(u)?1+Math.floor(E*O):nx;F>nx&&us(`sigmaRadians, ${u}, is too large and will clip, as it requested ${F} samples when the maximum is set to ${nx}`);const U=[];let X=0;for(let re=0;re<nx;++re){const xe=re/O,ae=Math.exp(-xe*xe/2);U.push(ae),re===0?X+=ae:re<F&&(X+=2*ae)}for(let re=0;re<U.length;re++)U[re]=U[re]/X;k.envMap.value=e.texture,k.samples.value=F,k.weights.value=U,k.latitudinal.value=p==="latitudinal",r&&(k.poleAxis.value=r);const{_lodMax:W}=this;k.dTheta.value=D,k.mipInt.value=W-s;const K=this._sizeLods[l],ne=3*K*(l>W-j0?l-W+j0:0),te=4*(this._cubeSize-K);dv(n,ne,te,3*K,2*K),v.setRenderTarget(n),v.render(T,N1)}}function OTe(t){const e=[],n=[],s=[];let l=t;const u=t-j0+1+a8.length;for(let p=0;p<u;p++){const r=Math.pow(2,l);e.push(r);let v=1/r;p>t-j0?v=a8[p-t+j0-1]:p===0&&(v=0),n.push(v);const w=1/(r-2),E=-w,T=1+w,k=[E,E,T,E,T,T,E,E,T,T,E,T],R=6,D=6,O=3,F=2,U=1,X=new Float32Array(O*D*R),W=new Float32Array(F*D*R),K=new Float32Array(U*D*R);for(let te=0;te<R;te++){const re=te%3*2/3-1,xe=te>2?0:-1,ae=[re,xe,0,re+2/3,xe,0,re+2/3,xe+1,0,re,xe,0,re+2/3,xe+1,0,re,xe+1,0];X.set(ae,O*D*te),W.set(k,F*D*te);const ce=[te,te,te,te,te,te];K.set(ce,U*D*te)}const ne=new mf;ne.setAttribute("position",new wp(X,O)),ne.setAttribute("uv",new wp(W,F)),ne.setAttribute("faceIndex",new wp(K,U)),s.push(new q0(ne,null)),l>j0&&l--}return{lodMeshes:s,sizeLods:e,sigmas:n}}function u8(t,e,n){const s=new $x(t,e,n);return s.texture.mapping=YA,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function dv(t,e,n,s,l){t.viewport.set(e,n,s,l),t.scissor.set(e,n,s,l)}function FTe(t,e,n){return new lg({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:DTe,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:t3(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:Km,depthTest:!1,depthWrite:!1})}function BTe(t,e,n){const s=new Float32Array(nx),l=new Ln(0,1,0);return new lg({name:"SphericalGaussianBlur",defines:{n:nx,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:l}},vertexShader:t3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Km,depthTest:!1,depthWrite:!1})}function d8(){return new lg({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:t3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Km,depthTest:!1,depthWrite:!1})}function h8(){return new lg({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:t3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Km,depthTest:!1,depthWrite:!1})}function t3(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zTe(t){let e=new WeakMap,n=null;function s(r){if(r&&r.isTexture){const v=r.mapping,w=v===MI||v===kI,E=v===ob||v===ab;if(w||E){let T=e.get(r);const k=T!==void 0?T.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==k)return n===null&&(n=new c8(t)),T=w?n.fromEquirectangular(r,T):n.fromCubemap(r,T),T.texture.pmremVersion=r.pmremVersion,e.set(r,T),T.texture;if(T!==void 0)return T.texture;{const R=r.image;return w&&R&&R.height>0||E&&R&&l(R)?(n===null&&(n=new c8(t)),T=w?n.fromEquirectangular(r):n.fromCubemap(r),T.texture.pmremVersion=r.pmremVersion,e.set(r,T),r.addEventListener("dispose",u),T.texture):null}}}return r}function l(r){let v=0;const w=6;for(let E=0;E<w;E++)r[E]!==void 0&&v++;return v===w}function u(r){const v=r.target;v.removeEventListener("dispose",u);const w=e.get(v);w!==void 0&&(e.delete(v),w.dispose())}function p(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:s,dispose:p}}function UTe(t){const e={};function n(s){if(e[s]!==void 0)return e[s];const l=t.getExtension(s);return e[s]=l,l}return{has:function(s){return n(s)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(s){const l=n(s);return l===null&&$w("WebGLRenderer: "+s+" extension not supported."),l}}}function VTe(t,e,n,s){const l={},u=new WeakMap;function p(T){const k=T.target;k.index!==null&&e.remove(k.index);for(const D in k.attributes)e.remove(k.attributes[D]);k.removeEventListener("dispose",p),delete l[k.id];const R=u.get(k);R&&(e.remove(R),u.delete(k)),s.releaseStatesOfGeometry(k),k.isInstancedBufferGeometry===!0&&delete k._maxInstanceCount,n.memory.geometries--}function r(T,k){return l[k.id]===!0||(k.addEventListener("dispose",p),l[k.id]=!0,n.memory.geometries++),k}function v(T){const k=T.attributes;for(const R in k)e.update(k[R],t.ARRAY_BUFFER)}function w(T){const k=[],R=T.index,D=T.attributes.position;let O=0;if(R!==null){const X=R.array;O=R.version;for(let W=0,K=X.length;W<K;W+=3){const ne=X[W+0],te=X[W+1],re=X[W+2];k.push(ne,te,te,re,re,ne)}}else if(D!==void 0){const X=D.array;O=D.version;for(let W=0,K=X.length/3-1;W<K;W+=3){const ne=W+0,te=W+1,re=W+2;k.push(ne,te,te,re,re,ne)}}else return;const F=new(gq(k)?Sq:wq)(k,1);F.version=O;const U=u.get(T);U&&e.remove(U),u.set(T,F)}function E(T){const k=u.get(T);if(k){const R=T.index;R!==null&&k.version<R.version&&w(T)}else w(T);return u.get(T)}return{get:r,update:v,getWireframeAttribute:E}}function HTe(t,e,n){let s;function l(k){s=k}let u,p;function r(k){u=k.type,p=k.bytesPerElement}function v(k,R){t.drawElements(s,R,u,k*p),n.update(R,s,1)}function w(k,R,D){D!==0&&(t.drawElementsInstanced(s,R,u,k*p,D),n.update(R,s,D))}function E(k,R,D){if(D===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(s,R,0,u,k,0,D);let F=0;for(let U=0;U<D;U++)F+=R[U];n.update(F,s,1)}function T(k,R,D,O){if(D===0)return;const F=e.get("WEBGL_multi_draw");if(F===null)for(let U=0;U<k.length;U++)w(k[U]/p,R[U],O[U]);else{F.multiDrawElementsInstancedWEBGL(s,R,0,u,k,0,O,0,D);let U=0;for(let X=0;X<D;X++)U+=R[X]*O[X];n.update(U,s,1)}}this.setMode=l,this.setIndex=r,this.render=v,this.renderInstances=w,this.renderMultiDraw=E,this.renderMultiDrawInstances=T}function GTe(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function s(u,p,r){switch(n.calls++,p){case t.TRIANGLES:n.triangles+=r*(u/3);break;case t.LINES:n.lines+=r*(u/2);break;case t.LINE_STRIP:n.lines+=r*(u-1);break;case t.LINE_LOOP:n.lines+=r*u;break;case t.POINTS:n.points+=r*u;break;default:xa("WebGLInfo: Unknown draw mode:",p);break}}function l(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:l,update:s}}function $Te(t,e,n){const s=new WeakMap,l=new _a;function u(p,r,v){const w=p.morphTargetInfluences,E=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,T=E!==void 0?E.length:0;let k=s.get(r);if(k===void 0||k.count!==T){let ae=function(){re.dispose(),s.delete(r),r.removeEventListener("dispose",ae)};k!==void 0&&k.texture.dispose();const R=r.morphAttributes.position!==void 0,D=r.morphAttributes.normal!==void 0,O=r.morphAttributes.color!==void 0,F=r.morphAttributes.position||[],U=r.morphAttributes.normal||[],X=r.morphAttributes.color||[];let W=0;R===!0&&(W=1),D===!0&&(W=2),O===!0&&(W=3);let K=r.attributes.position.count*W,ne=1;K>e.maxTextureSize&&(ne=Math.ceil(K/e.maxTextureSize),K=e.maxTextureSize);const te=new Float32Array(K*ne*4*T),re=new yq(te,K,ne,T);re.type=Hm,re.needsUpdate=!0;const xe=W*4;for(let ce=0;ce<T;ce++){const ye=F[ce],Ce=U[ce],Me=X[ce],Ke=K*ne*4*ce;for(let ke=0;ke<ye.count;ke++){const je=ke*xe;R===!0&&(l.fromBufferAttribute(ye,ke),te[Ke+je+0]=l.x,te[Ke+je+1]=l.y,te[Ke+je+2]=l.z,te[Ke+je+3]=0),D===!0&&(l.fromBufferAttribute(Ce,ke),te[Ke+je+4]=l.x,te[Ke+je+5]=l.y,te[Ke+je+6]=l.z,te[Ke+je+7]=0),O===!0&&(l.fromBufferAttribute(Me,ke),te[Ke+je+8]=l.x,te[Ke+je+9]=l.y,te[Ke+je+10]=l.z,te[Ke+je+11]=Me.itemSize===4?l.w:1)}}k={count:T,texture:re,size:new po(K,ne)},s.set(r,k),r.addEventListener("dispose",ae)}if(p.isInstancedMesh===!0&&p.morphTexture!==null)v.getUniforms().setValue(t,"morphTexture",p.morphTexture,n);else{let R=0;for(let O=0;O<w.length;O++)R+=w[O];const D=r.morphTargetsRelative?1:1-R;v.getUniforms().setValue(t,"morphTargetBaseInfluence",D),v.getUniforms().setValue(t,"morphTargetInfluences",w)}v.getUniforms().setValue(t,"morphTargetsTexture",k.texture,n),v.getUniforms().setValue(t,"morphTargetsTextureSize",k.size)}return{update:u}}function WTe(t,e,n,s){let l=new WeakMap;function u(v){const w=s.render.frame,E=v.geometry,T=e.get(v,E);if(l.get(T)!==w&&(e.update(T),l.set(T,w)),v.isInstancedMesh&&(v.hasEventListener("dispose",r)===!1&&v.addEventListener("dispose",r),l.get(v)!==w&&(n.update(v.instanceMatrix,t.ARRAY_BUFFER),v.instanceColor!==null&&n.update(v.instanceColor,t.ARRAY_BUFFER),l.set(v,w))),v.isSkinnedMesh){const k=v.skeleton;l.get(k)!==w&&(k.update(),l.set(k,w))}return T}function p(){l=new WeakMap}function r(v){const w=v.target;w.removeEventListener("dispose",r),n.remove(w.instanceMatrix),w.instanceColor!==null&&n.remove(w.instanceColor)}return{update:u,dispose:p}}const Pq=new $c,f8=new Mq(1,1),Rq=new yq,Nq=new _we,jq=new Aq,p8=[],m8=[],g8=new Float32Array(16),y8=new Float32Array(9),x8=new Float32Array(4);function Cb(t,e,n){const s=t[0];if(s<=0||s>0)return t;const l=e*n;let u=p8[l];if(u===void 0&&(u=new Float32Array(l),p8[l]=u),e!==0){s.toArray(u,0);for(let p=1,r=0;p!==e;++p)r+=n,t[p].toArray(u,r)}return u}function el(t,e){if(t.length!==e.length)return!1;for(let n=0,s=t.length;n<s;n++)if(t[n]!==e[n])return!1;return!0}function tl(t,e){for(let n=0,s=e.length;n<s;n++)t[n]=e[n]}function n3(t,e){let n=m8[e];n===void 0&&(n=new Int32Array(e),m8[e]=n);for(let s=0;s!==e;++s)n[s]=t.allocateTextureUnit();return n}function qTe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function XTe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(el(n,e))return;t.uniform2fv(this.addr,e),tl(n,e)}}function ZTe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(el(n,e))return;t.uniform3fv(this.addr,e),tl(n,e)}}function QTe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(el(n,e))return;t.uniform4fv(this.addr,e),tl(n,e)}}function KTe(t,e){const n=this.cache,s=e.elements;if(s===void 0){if(el(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),tl(n,e)}else{if(el(n,s))return;x8.set(s),t.uniformMatrix2fv(this.addr,!1,x8),tl(n,s)}}function YTe(t,e){const n=this.cache,s=e.elements;if(s===void 0){if(el(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),tl(n,e)}else{if(el(n,s))return;y8.set(s),t.uniformMatrix3fv(this.addr,!1,y8),tl(n,s)}}function JTe(t,e){const n=this.cache,s=e.elements;if(s===void 0){if(el(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),tl(n,e)}else{if(el(n,s))return;g8.set(s),t.uniformMatrix4fv(this.addr,!1,g8),tl(n,s)}}function eEe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function tEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(el(n,e))return;t.uniform2iv(this.addr,e),tl(n,e)}}function nEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(el(n,e))return;t.uniform3iv(this.addr,e),tl(n,e)}}function rEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(el(n,e))return;t.uniform4iv(this.addr,e),tl(n,e)}}function iEe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function sEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(el(n,e))return;t.uniform2uiv(this.addr,e),tl(n,e)}}function oEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(el(n,e))return;t.uniform3uiv(this.addr,e),tl(n,e)}}function aEe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(el(n,e))return;t.uniform4uiv(this.addr,e),tl(n,e)}}function lEe(t,e,n){const s=this.cache,l=n.allocateTextureUnit();s[0]!==l&&(t.uniform1i(this.addr,l),s[0]=l);let u;this.type===t.SAMPLER_2D_SHADOW?(f8.compareFunction=mq,u=f8):u=Pq,n.setTexture2D(e||u,l)}function cEe(t,e,n){const s=this.cache,l=n.allocateTextureUnit();s[0]!==l&&(t.uniform1i(this.addr,l),s[0]=l),n.setTexture3D(e||Nq,l)}function uEe(t,e,n){const s=this.cache,l=n.allocateTextureUnit();s[0]!==l&&(t.uniform1i(this.addr,l),s[0]=l),n.setTextureCube(e||jq,l)}function dEe(t,e,n){const s=this.cache,l=n.allocateTextureUnit();s[0]!==l&&(t.uniform1i(this.addr,l),s[0]=l),n.setTexture2DArray(e||Rq,l)}function hEe(t){switch(t){case 5126:return qTe;case 35664:return XTe;case 35665:return ZTe;case 35666:return QTe;case 35674:return KTe;case 35675:return YTe;case 35676:return JTe;case 5124:case 35670:return eEe;case 35667:case 35671:return tEe;case 35668:case 35672:return nEe;case 35669:case 35673:return rEe;case 5125:return iEe;case 36294:return sEe;case 36295:return oEe;case 36296:return aEe;case 35678:case 36198:case 36298:case 36306:case 35682:return lEe;case 35679:case 36299:case 36307:return cEe;case 35680:case 36300:case 36308:case 36293:return uEe;case 36289:case 36303:case 36311:case 36292:return dEe}}function fEe(t,e){t.uniform1fv(this.addr,e)}function pEe(t,e){const n=Cb(e,this.size,2);t.uniform2fv(this.addr,n)}function mEe(t,e){const n=Cb(e,this.size,3);t.uniform3fv(this.addr,n)}function gEe(t,e){const n=Cb(e,this.size,4);t.uniform4fv(this.addr,n)}function yEe(t,e){const n=Cb(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function xEe(t,e){const n=Cb(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function _Ee(t,e){const n=Cb(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function vEe(t,e){t.uniform1iv(this.addr,e)}function bEe(t,e){t.uniform2iv(this.addr,e)}function wEe(t,e){t.uniform3iv(this.addr,e)}function SEe(t,e){t.uniform4iv(this.addr,e)}function TEe(t,e){t.uniform1uiv(this.addr,e)}function EEe(t,e){t.uniform2uiv(this.addr,e)}function AEe(t,e){t.uniform3uiv(this.addr,e)}function CEe(t,e){t.uniform4uiv(this.addr,e)}function MEe(t,e,n){const s=this.cache,l=e.length,u=n3(n,l);el(s,u)||(t.uniform1iv(this.addr,u),tl(s,u));for(let p=0;p!==l;++p)n.setTexture2D(e[p]||Pq,u[p])}function kEe(t,e,n){const s=this.cache,l=e.length,u=n3(n,l);el(s,u)||(t.uniform1iv(this.addr,u),tl(s,u));for(let p=0;p!==l;++p)n.setTexture3D(e[p]||Nq,u[p])}function IEe(t,e,n){const s=this.cache,l=e.length,u=n3(n,l);el(s,u)||(t.uniform1iv(this.addr,u),tl(s,u));for(let p=0;p!==l;++p)n.setTextureCube(e[p]||jq,u[p])}function PEe(t,e,n){const s=this.cache,l=e.length,u=n3(n,l);el(s,u)||(t.uniform1iv(this.addr,u),tl(s,u));for(let p=0;p!==l;++p)n.setTexture2DArray(e[p]||Rq,u[p])}function REe(t){switch(t){case 5126:return fEe;case 35664:return pEe;case 35665:return mEe;case 35666:return gEe;case 35674:return yEe;case 35675:return xEe;case 35676:return _Ee;case 5124:case 35670:return vEe;case 35667:case 35671:return bEe;case 35668:case 35672:return wEe;case 35669:case 35673:return SEe;case 5125:return TEe;case 36294:return EEe;case 36295:return AEe;case 36296:return CEe;case 35678:case 36198:case 36298:case 36306:case 35682:return MEe;case 35679:case 36299:case 36307:return kEe;case 35680:case 36300:case 36308:case 36293:return IEe;case 36289:case 36303:case 36311:case 36292:return PEe}}class NEe{constructor(e,n,s){this.id=e,this.addr=s,this.cache=[],this.type=n.type,this.setValue=hEe(n.type)}}class jEe{constructor(e,n,s){this.id=e,this.addr=s,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=REe(n.type)}}class DEe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,s){const l=this.seq;for(let u=0,p=l.length;u!==p;++u){const r=l[u];r.setValue(e,n[r.id],s)}}}const E5=/(\w+)(\])?(\[|\.)?/g;function _8(t,e){t.seq.push(e),t.map[e.id]=e}function LEe(t,e,n){const s=t.name,l=s.length;for(E5.lastIndex=0;;){const u=E5.exec(s),p=E5.lastIndex;let r=u[1];const v=u[2]==="]",w=u[3];if(v&&(r=r|0),w===void 0||w==="["&&p+2===l){_8(n,w===void 0?new NEe(r,t,e):new jEe(r,t,e));break}else{let T=n.map[r];T===void 0&&(T=new DEe(r),_8(n,T)),n=T}}}class iE{constructor(e,n){this.seq=[],this.map={};const s=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let l=0;l<s;++l){const u=e.getActiveUniform(n,l),p=e.getUniformLocation(n,u.name);LEe(u,p,this)}}setValue(e,n,s,l){const u=this.map[n];u!==void 0&&u.setValue(e,s,l)}setOptional(e,n,s){const l=n[s];l!==void 0&&this.setValue(e,s,l)}static upload(e,n,s,l){for(let u=0,p=n.length;u!==p;++u){const r=n[u],v=s[r.id];v.needsUpdate!==!1&&r.setValue(e,v.value,l)}}static seqWithValue(e,n){const s=[];for(let l=0,u=e.length;l!==u;++l){const p=e[l];p.id in n&&s.push(p)}return s}}function v8(t,e,n){const s=t.createShader(e);return t.shaderSource(s,n),t.compileShader(s),s}const OEe=37297;let FEe=0;function BEe(t,e){const n=t.split(`
`),s=[],l=Math.max(e-6,0),u=Math.min(e+6,n.length);for(let p=l;p<u;p++){const r=p+1;s.push(`${r===e?">":" "} ${r}: ${n[p]}`)}return s.join(`
`)}const b8=new ms;function zEe(t){Js._getMatrix(b8,Js.workingColorSpace,t);const e=`mat3( ${b8.elements.map(n=>n.toFixed(4))} )`;switch(Js.getTransfer(t)){case GE:return[e,"LinearTransferOETF"];case fo:return[e,"sRGBTransferOETF"];default:return us("WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function w8(t,e,n){const s=t.getShaderParameter(e,t.COMPILE_STATUS),u=(t.getShaderInfoLog(e)||"").trim();if(s&&u==="")return"";const p=/ERROR: 0:(\d+)/.exec(u);if(p){const r=parseInt(p[1]);return n.toUpperCase()+`

`+u+`

`+BEe(t.getShaderSource(e),r)}else return u}function UEe(t,e){const n=zEe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function VEe(t,e){let n;switch(e){case W1e:n="Linear";break;case q1e:n="Reinhard";break;case X1e:n="Cineon";break;case Z1e:n="ACESFilmic";break;case K1e:n="AgX";break;case Y1e:n="Neutral";break;case Q1e:n="Custom";break;default:us("WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const RT=new Ln;function HEe(){Js.getLuminanceCoefficients(RT);const t=RT.x.toFixed(4),e=RT.y.toFixed(4),n=RT.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function GEe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(U1).join(`
`)}function $Ee(t){const e=[];for(const n in t){const s=t[n];s!==!1&&e.push("#define "+n+" "+s)}return e.join(`
`)}function WEe(t,e){const n={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let l=0;l<s;l++){const u=t.getActiveAttrib(e,l),p=u.name;let r=1;u.type===t.FLOAT_MAT2&&(r=2),u.type===t.FLOAT_MAT3&&(r=3),u.type===t.FLOAT_MAT4&&(r=4),n[p]={type:u.type,location:t.getAttribLocation(e,p),locationSize:r}}return n}function U1(t){return t!==""}function S8(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function T8(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const qEe=/^[ \t]*#include +<([\w\d./]+)>/gm;function cP(t){return t.replace(qEe,ZEe)}const XEe=new Map;function ZEe(t,e){let n=vs[e];if(n===void 0){const s=XEe.get(e);if(s!==void 0)n=vs[s],us('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,s);else throw new Error("Can not resolve #include <"+e+">")}return cP(n)}const QEe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function E8(t){return t.replace(QEe,KEe)}function KEe(t,e,n,s){let l="";for(let u=parseInt(e);u<parseInt(n);u++)l+=s.replace(/\[\s*i\s*\]/g,"[ "+u+" ]").replace(/UNROLLED_LOOP_INDEX/g,u);return l}function A8(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function YEe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===sq?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===E1e?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Rm&&(e="SHADOWMAP_TYPE_VSM"),e}function JEe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ob:case ab:e="ENVMAP_TYPE_CUBE";break;case YA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function eAe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ab:e="ENVMAP_MODE_REFRACTION";break}return e}function tAe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case oq:e="ENVMAP_BLENDING_MULTIPLY";break;case G1e:e="ENVMAP_BLENDING_MIX";break;case $1e:e="ENVMAP_BLENDING_ADD";break}return e}function nAe(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:s,maxMip:n}}function rAe(t,e,n,s){const l=t.getContext(),u=n.defines;let p=n.vertexShader,r=n.fragmentShader;const v=YEe(n),w=JEe(n),E=eAe(n),T=tAe(n),k=nAe(n),R=GEe(n),D=$Ee(u),O=l.createProgram();let F,U,X=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(F=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,D].filter(U1).join(`
`),F.length>0&&(F+=`
`),U=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,D].filter(U1).join(`
`),U.length>0&&(U+=`
`)):(F=[A8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,D,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+E:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+v:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(U1).join(`
`),U=[A8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,D,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+w:"",n.envMap?"#define "+E:"",n.envMap?"#define "+T:"",k?"#define CUBEUV_TEXEL_WIDTH "+k.texelWidth:"",k?"#define CUBEUV_TEXEL_HEIGHT "+k.texelHeight:"",k?"#define CUBEUV_MAX_MIP "+k.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+v:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==B0?"#define TONE_MAPPING":"",n.toneMapping!==B0?vs.tonemapping_pars_fragment:"",n.toneMapping!==B0?VEe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",vs.colorspace_pars_fragment,UEe("linearToOutputTexel",n.outputColorSpace),HEe(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(U1).join(`
`)),p=cP(p),p=S8(p,n),p=T8(p,n),r=cP(r),r=S8(r,n),r=T8(r,n),p=E8(p),r=E8(r),n.isRawShaderMaterial!==!0&&(X=`#version 300 es
`,F=[R,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+F,U=["#define varying in",n.glslVersion===Fz?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Fz?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+U);const W=X+F+p,K=X+U+r,ne=v8(l,l.VERTEX_SHADER,W),te=v8(l,l.FRAGMENT_SHADER,K);l.attachShader(O,ne),l.attachShader(O,te),n.index0AttributeName!==void 0?l.bindAttribLocation(O,0,n.index0AttributeName):n.morphTargets===!0&&l.bindAttribLocation(O,0,"position"),l.linkProgram(O);function re(ye){if(t.debug.checkShaderErrors){const Ce=l.getProgramInfoLog(O)||"",Me=l.getShaderInfoLog(ne)||"",Ke=l.getShaderInfoLog(te)||"",ke=Ce.trim(),je=Me.trim(),$e=Ke.trim();let Ae=!0,He=!0;if(l.getProgramParameter(O,l.LINK_STATUS)===!1)if(Ae=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(l,O,ne,te);else{const qe=w8(l,ne,"vertex"),Le=w8(l,te,"fragment");xa("THREE.WebGLProgram: Shader Error "+l.getError()+" - VALIDATE_STATUS "+l.getProgramParameter(O,l.VALIDATE_STATUS)+`

Material Name: `+ye.name+`
Material Type: `+ye.type+`

Program Info Log: `+ke+`
`+qe+`
`+Le)}else ke!==""?us("WebGLProgram: Program Info Log:",ke):(je===""||$e==="")&&(He=!1);He&&(ye.diagnostics={runnable:Ae,programLog:ke,vertexShader:{log:je,prefix:F},fragmentShader:{log:$e,prefix:U}})}l.deleteShader(ne),l.deleteShader(te),xe=new iE(l,O),ae=WEe(l,O)}let xe;this.getUniforms=function(){return xe===void 0&&re(this),xe};let ae;this.getAttributes=function(){return ae===void 0&&re(this),ae};let ce=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ce===!1&&(ce=l.getProgramParameter(O,OEe)),ce},this.destroy=function(){s.releaseStatesOfProgram(this),l.deleteProgram(O),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=FEe++,this.cacheKey=e,this.usedTimes=1,this.program=O,this.vertexShader=ne,this.fragmentShader=te,this}let iAe=0;class sAe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,s=e.fragmentShader,l=this._getShaderStage(n),u=this._getShaderStage(s),p=this._getShaderCacheForMaterial(e);return p.has(l)===!1&&(p.add(l),l.usedTimes++),p.has(u)===!1&&(p.add(u),u.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const s of n)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let s=n.get(e);return s===void 0&&(s=new Set,n.set(e,s)),s}_getShaderStage(e){const n=this.shaderCache;let s=n.get(e);return s===void 0&&(s=new oAe(e),n.set(e,s)),s}}class oAe{constructor(e){this.id=iAe++,this.code=e,this.usedTimes=0}}function aAe(t,e,n,s,l,u,p){const r=new _q,v=new sAe,w=new Set,E=[],T=l.logarithmicDepthBuffer,k=l.vertexTextures;let R=l.precision;const D={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function O(ae){return w.add(ae),ae===0?"uv":`uv${ae}`}function F(ae,ce,ye,Ce,Me){const Ke=Ce.fog,ke=Me.geometry,je=ae.isMeshStandardMaterial?Ce.environment:null,$e=(ae.isMeshStandardMaterial?n:e).get(ae.envMap||je),Ae=$e&&$e.mapping===YA?$e.image.height:null,He=D[ae.type];ae.precision!==null&&(R=l.getMaxPrecision(ae.precision),R!==ae.precision&&us("WebGLProgram.getParameters:",ae.precision,"not supported, using",R,"instead."));const qe=ke.morphAttributes.position||ke.morphAttributes.normal||ke.morphAttributes.color,Le=qe!==void 0?qe.length:0;let st=0;ke.morphAttributes.position!==void 0&&(st=1),ke.morphAttributes.normal!==void 0&&(st=2),ke.morphAttributes.color!==void 0&&(st=3);let bt,yt,Vt,_t;if(He){const ns=pp[He];bt=ns.vertexShader,yt=ns.fragmentShader}else bt=ae.vertexShader,yt=ae.fragmentShader,v.update(ae),Vt=v.getVertexShaderID(ae),_t=v.getFragmentShaderID(ae);const vt=t.getRenderTarget(),qt=t.state.buffers.depth.getReversed(),kt=Me.isInstancedMesh===!0,on=Me.isBatchedMesh===!0,mn=!!ae.map,Hr=!!ae.matcap,Un=!!$e,$r=!!ae.aoMap,ht=!!ae.lightMap,Lr=!!ae.bumpMap,Br=!!ae.normalMap,wn=!!ae.displacementMap,Nn=!!ae.emissiveMap,mr=!!ae.metalnessMap,Qn=!!ae.roughnessMap,Nt=ae.anisotropy>0,et=ae.clearcoat>0,Oe=ae.dispersion>0,Bt=ae.iridescence>0,En=ae.sheen>0,Dn=ae.transmission>0,rn=Nt&&!!ae.anisotropyMap,wr=et&&!!ae.clearcoatMap,cr=et&&!!ae.clearcoatNormalMap,Jn=et&&!!ae.clearcoatRoughnessMap,ir=Bt&&!!ae.iridescenceMap,bn=Bt&&!!ae.iridescenceThicknessMap,In=En&&!!ae.sheenColorMap,Zr=En&&!!ae.sheenRoughnessMap,Vr=!!ae.specularMap,qn=!!ae.specularColorMap,Kn=!!ae.specularIntensityMap,St=Dn&&!!ae.transmissionMap,Gn=Dn&&!!ae.thicknessMap,er=!!ae.gradientMap,gr=!!ae.alphaMap,nr=ae.alphaTest>0,ln=!!ae.alphaHash,Tr=!!ae.extensions;let ni=B0;ae.toneMapped&&(vt===null||vt.isXRRenderTarget===!0)&&(ni=t.toneMapping);const Yi={shaderID:He,shaderType:ae.type,shaderName:ae.name,vertexShader:bt,fragmentShader:yt,defines:ae.defines,customVertexShaderID:Vt,customFragmentShaderID:_t,isRawShaderMaterial:ae.isRawShaderMaterial===!0,glslVersion:ae.glslVersion,precision:R,batching:on,batchingColor:on&&Me._colorsTexture!==null,instancing:kt,instancingColor:kt&&Me.instanceColor!==null,instancingMorph:kt&&Me.morphTexture!==null,supportsVertexTextures:k,outputColorSpace:vt===null?t.outputColorSpace:vt.isXRRenderTarget===!0?vt.texture.colorSpace:lb,alphaToCoverage:!!ae.alphaToCoverage,map:mn,matcap:Hr,envMap:Un,envMapMode:Un&&$e.mapping,envMapCubeUVHeight:Ae,aoMap:$r,lightMap:ht,bumpMap:Lr,normalMap:Br,displacementMap:k&&wn,emissiveMap:Nn,normalMapObjectSpace:Br&&ae.normalMapType===rwe,normalMapTangentSpace:Br&&ae.normalMapType===nwe,metalnessMap:mr,roughnessMap:Qn,anisotropy:Nt,anisotropyMap:rn,clearcoat:et,clearcoatMap:wr,clearcoatNormalMap:cr,clearcoatRoughnessMap:Jn,dispersion:Oe,iridescence:Bt,iridescenceMap:ir,iridescenceThicknessMap:bn,sheen:En,sheenColorMap:In,sheenRoughnessMap:Zr,specularMap:Vr,specularColorMap:qn,specularIntensityMap:Kn,transmission:Dn,transmissionMap:St,thicknessMap:Gn,gradientMap:er,opaque:ae.transparent===!1&&ae.blending===Pv&&ae.alphaToCoverage===!1,alphaMap:gr,alphaTest:nr,alphaHash:ln,combine:ae.combine,mapUv:mn&&O(ae.map.channel),aoMapUv:$r&&O(ae.aoMap.channel),lightMapUv:ht&&O(ae.lightMap.channel),bumpMapUv:Lr&&O(ae.bumpMap.channel),normalMapUv:Br&&O(ae.normalMap.channel),displacementMapUv:wn&&O(ae.displacementMap.channel),emissiveMapUv:Nn&&O(ae.emissiveMap.channel),metalnessMapUv:mr&&O(ae.metalnessMap.channel),roughnessMapUv:Qn&&O(ae.roughnessMap.channel),anisotropyMapUv:rn&&O(ae.anisotropyMap.channel),clearcoatMapUv:wr&&O(ae.clearcoatMap.channel),clearcoatNormalMapUv:cr&&O(ae.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Jn&&O(ae.clearcoatRoughnessMap.channel),iridescenceMapUv:ir&&O(ae.iridescenceMap.channel),iridescenceThicknessMapUv:bn&&O(ae.iridescenceThicknessMap.channel),sheenColorMapUv:In&&O(ae.sheenColorMap.channel),sheenRoughnessMapUv:Zr&&O(ae.sheenRoughnessMap.channel),specularMapUv:Vr&&O(ae.specularMap.channel),specularColorMapUv:qn&&O(ae.specularColorMap.channel),specularIntensityMapUv:Kn&&O(ae.specularIntensityMap.channel),transmissionMapUv:St&&O(ae.transmissionMap.channel),thicknessMapUv:Gn&&O(ae.thicknessMap.channel),alphaMapUv:gr&&O(ae.alphaMap.channel),vertexTangents:!!ke.attributes.tangent&&(Br||Nt),vertexColors:ae.vertexColors,vertexAlphas:ae.vertexColors===!0&&!!ke.attributes.color&&ke.attributes.color.itemSize===4,pointsUvs:Me.isPoints===!0&&!!ke.attributes.uv&&(mn||gr),fog:!!Ke,useFog:ae.fog===!0,fogExp2:!!Ke&&Ke.isFogExp2,flatShading:ae.flatShading===!0&&ae.wireframe===!1,sizeAttenuation:ae.sizeAttenuation===!0,logarithmicDepthBuffer:T,reversedDepthBuffer:qt,skinning:Me.isSkinnedMesh===!0,morphTargets:ke.morphAttributes.position!==void 0,morphNormals:ke.morphAttributes.normal!==void 0,morphColors:ke.morphAttributes.color!==void 0,morphTargetsCount:Le,morphTextureStride:st,numDirLights:ce.directional.length,numPointLights:ce.point.length,numSpotLights:ce.spot.length,numSpotLightMaps:ce.spotLightMap.length,numRectAreaLights:ce.rectArea.length,numHemiLights:ce.hemi.length,numDirLightShadows:ce.directionalShadowMap.length,numPointLightShadows:ce.pointShadowMap.length,numSpotLightShadows:ce.spotShadowMap.length,numSpotLightShadowsWithMaps:ce.numSpotLightShadowsWithMaps,numLightProbes:ce.numLightProbes,numClippingPlanes:p.numPlanes,numClipIntersection:p.numIntersection,dithering:ae.dithering,shadowMapEnabled:t.shadowMap.enabled&&ye.length>0,shadowMapType:t.shadowMap.type,toneMapping:ni,decodeVideoTexture:mn&&ae.map.isVideoTexture===!0&&Js.getTransfer(ae.map.colorSpace)===fo,decodeVideoTextureEmissive:Nn&&ae.emissiveMap.isVideoTexture===!0&&Js.getTransfer(ae.emissiveMap.colorSpace)===fo,premultipliedAlpha:ae.premultipliedAlpha,doubleSided:ae.side===zm,flipSided:ae.side===wu,useDepthPacking:ae.depthPacking>=0,depthPacking:ae.depthPacking||0,index0AttributeName:ae.index0AttributeName,extensionClipCullDistance:Tr&&ae.extensions.clipCullDistance===!0&&s.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Tr&&ae.extensions.multiDraw===!0||on)&&s.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:s.has("KHR_parallel_shader_compile"),customProgramCacheKey:ae.customProgramCacheKey()};return Yi.vertexUv1s=w.has(1),Yi.vertexUv2s=w.has(2),Yi.vertexUv3s=w.has(3),w.clear(),Yi}function U(ae){const ce=[];if(ae.shaderID?ce.push(ae.shaderID):(ce.push(ae.customVertexShaderID),ce.push(ae.customFragmentShaderID)),ae.defines!==void 0)for(const ye in ae.defines)ce.push(ye),ce.push(ae.defines[ye]);return ae.isRawShaderMaterial===!1&&(X(ce,ae),W(ce,ae),ce.push(t.outputColorSpace)),ce.push(ae.customProgramCacheKey),ce.join()}function X(ae,ce){ae.push(ce.precision),ae.push(ce.outputColorSpace),ae.push(ce.envMapMode),ae.push(ce.envMapCubeUVHeight),ae.push(ce.mapUv),ae.push(ce.alphaMapUv),ae.push(ce.lightMapUv),ae.push(ce.aoMapUv),ae.push(ce.bumpMapUv),ae.push(ce.normalMapUv),ae.push(ce.displacementMapUv),ae.push(ce.emissiveMapUv),ae.push(ce.metalnessMapUv),ae.push(ce.roughnessMapUv),ae.push(ce.anisotropyMapUv),ae.push(ce.clearcoatMapUv),ae.push(ce.clearcoatNormalMapUv),ae.push(ce.clearcoatRoughnessMapUv),ae.push(ce.iridescenceMapUv),ae.push(ce.iridescenceThicknessMapUv),ae.push(ce.sheenColorMapUv),ae.push(ce.sheenRoughnessMapUv),ae.push(ce.specularMapUv),ae.push(ce.specularColorMapUv),ae.push(ce.specularIntensityMapUv),ae.push(ce.transmissionMapUv),ae.push(ce.thicknessMapUv),ae.push(ce.combine),ae.push(ce.fogExp2),ae.push(ce.sizeAttenuation),ae.push(ce.morphTargetsCount),ae.push(ce.morphAttributeCount),ae.push(ce.numDirLights),ae.push(ce.numPointLights),ae.push(ce.numSpotLights),ae.push(ce.numSpotLightMaps),ae.push(ce.numHemiLights),ae.push(ce.numRectAreaLights),ae.push(ce.numDirLightShadows),ae.push(ce.numPointLightShadows),ae.push(ce.numSpotLightShadows),ae.push(ce.numSpotLightShadowsWithMaps),ae.push(ce.numLightProbes),ae.push(ce.shadowMapType),ae.push(ce.toneMapping),ae.push(ce.numClippingPlanes),ae.push(ce.numClipIntersection),ae.push(ce.depthPacking)}function W(ae,ce){r.disableAll(),ce.supportsVertexTextures&&r.enable(0),ce.instancing&&r.enable(1),ce.instancingColor&&r.enable(2),ce.instancingMorph&&r.enable(3),ce.matcap&&r.enable(4),ce.envMap&&r.enable(5),ce.normalMapObjectSpace&&r.enable(6),ce.normalMapTangentSpace&&r.enable(7),ce.clearcoat&&r.enable(8),ce.iridescence&&r.enable(9),ce.alphaTest&&r.enable(10),ce.vertexColors&&r.enable(11),ce.vertexAlphas&&r.enable(12),ce.vertexUv1s&&r.enable(13),ce.vertexUv2s&&r.enable(14),ce.vertexUv3s&&r.enable(15),ce.vertexTangents&&r.enable(16),ce.anisotropy&&r.enable(17),ce.alphaHash&&r.enable(18),ce.batching&&r.enable(19),ce.dispersion&&r.enable(20),ce.batchingColor&&r.enable(21),ce.gradientMap&&r.enable(22),ae.push(r.mask),r.disableAll(),ce.fog&&r.enable(0),ce.useFog&&r.enable(1),ce.flatShading&&r.enable(2),ce.logarithmicDepthBuffer&&r.enable(3),ce.reversedDepthBuffer&&r.enable(4),ce.skinning&&r.enable(5),ce.morphTargets&&r.enable(6),ce.morphNormals&&r.enable(7),ce.morphColors&&r.enable(8),ce.premultipliedAlpha&&r.enable(9),ce.shadowMapEnabled&&r.enable(10),ce.doubleSided&&r.enable(11),ce.flipSided&&r.enable(12),ce.useDepthPacking&&r.enable(13),ce.dithering&&r.enable(14),ce.transmission&&r.enable(15),ce.sheen&&r.enable(16),ce.opaque&&r.enable(17),ce.pointsUvs&&r.enable(18),ce.decodeVideoTexture&&r.enable(19),ce.decodeVideoTextureEmissive&&r.enable(20),ce.alphaToCoverage&&r.enable(21),ae.push(r.mask)}function K(ae){const ce=D[ae.type];let ye;if(ce){const Ce=pp[ce];ye=Rwe.clone(Ce.uniforms)}else ye=ae.uniforms;return ye}function ne(ae,ce){let ye;for(let Ce=0,Me=E.length;Ce<Me;Ce++){const Ke=E[Ce];if(Ke.cacheKey===ce){ye=Ke,++ye.usedTimes;break}}return ye===void 0&&(ye=new rAe(t,ce,ae,u),E.push(ye)),ye}function te(ae){if(--ae.usedTimes===0){const ce=E.indexOf(ae);E[ce]=E[E.length-1],E.pop(),ae.destroy()}}function re(ae){v.remove(ae)}function xe(){v.dispose()}return{getParameters:F,getProgramCacheKey:U,getUniforms:K,acquireProgram:ne,releaseProgram:te,releaseShaderCache:re,programs:E,dispose:xe}}function lAe(){let t=new WeakMap;function e(p){return t.has(p)}function n(p){let r=t.get(p);return r===void 0&&(r={},t.set(p,r)),r}function s(p){t.delete(p)}function l(p,r,v){t.get(p)[r]=v}function u(){t=new WeakMap}return{has:e,get:n,remove:s,update:l,dispose:u}}function cAe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function C8(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function M8(){const t=[];let e=0;const n=[],s=[],l=[];function u(){e=0,n.length=0,s.length=0,l.length=0}function p(T,k,R,D,O,F){let U=t[e];return U===void 0?(U={id:T.id,object:T,geometry:k,material:R,groupOrder:D,renderOrder:T.renderOrder,z:O,group:F},t[e]=U):(U.id=T.id,U.object=T,U.geometry=k,U.material=R,U.groupOrder=D,U.renderOrder=T.renderOrder,U.z=O,U.group=F),e++,U}function r(T,k,R,D,O,F){const U=p(T,k,R,D,O,F);R.transmission>0?s.push(U):R.transparent===!0?l.push(U):n.push(U)}function v(T,k,R,D,O,F){const U=p(T,k,R,D,O,F);R.transmission>0?s.unshift(U):R.transparent===!0?l.unshift(U):n.unshift(U)}function w(T,k){n.length>1&&n.sort(T||cAe),s.length>1&&s.sort(k||C8),l.length>1&&l.sort(k||C8)}function E(){for(let T=e,k=t.length;T<k;T++){const R=t[T];if(R.id===null)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}}return{opaque:n,transmissive:s,transparent:l,init:u,push:r,unshift:v,finish:E,sort:w}}function uAe(){let t=new WeakMap;function e(s,l){const u=t.get(s);let p;return u===void 0?(p=new M8,t.set(s,[p])):l>=u.length?(p=new M8,u.push(p)):p=u[l],p}function n(){t=new WeakMap}return{get:e,dispose:n}}function dAe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Ln,color:new ro};break;case"SpotLight":n={position:new Ln,direction:new Ln,color:new ro,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ln,color:new ro,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ln,skyColor:new ro,groundColor:new ro};break;case"RectAreaLight":n={color:new ro,position:new Ln,halfWidth:new Ln,halfHeight:new Ln};break}return t[e.id]=n,n}}}function hAe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new po};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new po};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new po,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let fAe=0;function pAe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function mAe(t){const e=new dAe,n=hAe(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let w=0;w<9;w++)s.probe.push(new Ln);const l=new Ln,u=new Da,p=new Da;function r(w){let E=0,T=0,k=0;for(let ae=0;ae<9;ae++)s.probe[ae].set(0,0,0);let R=0,D=0,O=0,F=0,U=0,X=0,W=0,K=0,ne=0,te=0,re=0;w.sort(pAe);for(let ae=0,ce=w.length;ae<ce;ae++){const ye=w[ae],Ce=ye.color,Me=ye.intensity,Ke=ye.distance,ke=ye.shadow&&ye.shadow.map?ye.shadow.map.texture:null;if(ye.isAmbientLight)E+=Ce.r*Me,T+=Ce.g*Me,k+=Ce.b*Me;else if(ye.isLightProbe){for(let je=0;je<9;je++)s.probe[je].addScaledVector(ye.sh.coefficients[je],Me);re++}else if(ye.isDirectionalLight){const je=e.get(ye);if(je.color.copy(ye.color).multiplyScalar(ye.intensity),ye.castShadow){const $e=ye.shadow,Ae=n.get(ye);Ae.shadowIntensity=$e.intensity,Ae.shadowBias=$e.bias,Ae.shadowNormalBias=$e.normalBias,Ae.shadowRadius=$e.radius,Ae.shadowMapSize=$e.mapSize,s.directionalShadow[R]=Ae,s.directionalShadowMap[R]=ke,s.directionalShadowMatrix[R]=ye.shadow.matrix,X++}s.directional[R]=je,R++}else if(ye.isSpotLight){const je=e.get(ye);je.position.setFromMatrixPosition(ye.matrixWorld),je.color.copy(Ce).multiplyScalar(Me),je.distance=Ke,je.coneCos=Math.cos(ye.angle),je.penumbraCos=Math.cos(ye.angle*(1-ye.penumbra)),je.decay=ye.decay,s.spot[O]=je;const $e=ye.shadow;if(ye.map&&(s.spotLightMap[ne]=ye.map,ne++,$e.updateMatrices(ye),ye.castShadow&&te++),s.spotLightMatrix[O]=$e.matrix,ye.castShadow){const Ae=n.get(ye);Ae.shadowIntensity=$e.intensity,Ae.shadowBias=$e.bias,Ae.shadowNormalBias=$e.normalBias,Ae.shadowRadius=$e.radius,Ae.shadowMapSize=$e.mapSize,s.spotShadow[O]=Ae,s.spotShadowMap[O]=ke,K++}O++}else if(ye.isRectAreaLight){const je=e.get(ye);je.color.copy(Ce).multiplyScalar(Me),je.halfWidth.set(ye.width*.5,0,0),je.halfHeight.set(0,ye.height*.5,0),s.rectArea[F]=je,F++}else if(ye.isPointLight){const je=e.get(ye);if(je.color.copy(ye.color).multiplyScalar(ye.intensity),je.distance=ye.distance,je.decay=ye.decay,ye.castShadow){const $e=ye.shadow,Ae=n.get(ye);Ae.shadowIntensity=$e.intensity,Ae.shadowBias=$e.bias,Ae.shadowNormalBias=$e.normalBias,Ae.shadowRadius=$e.radius,Ae.shadowMapSize=$e.mapSize,Ae.shadowCameraNear=$e.camera.near,Ae.shadowCameraFar=$e.camera.far,s.pointShadow[D]=Ae,s.pointShadowMap[D]=ke,s.pointShadowMatrix[D]=ye.shadow.matrix,W++}s.point[D]=je,D++}else if(ye.isHemisphereLight){const je=e.get(ye);je.skyColor.copy(ye.color).multiplyScalar(Me),je.groundColor.copy(ye.groundColor).multiplyScalar(Me),s.hemi[U]=je,U++}}F>0&&(t.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=qr.LTC_FLOAT_1,s.rectAreaLTC2=qr.LTC_FLOAT_2):(s.rectAreaLTC1=qr.LTC_HALF_1,s.rectAreaLTC2=qr.LTC_HALF_2)),s.ambient[0]=E,s.ambient[1]=T,s.ambient[2]=k;const xe=s.hash;(xe.directionalLength!==R||xe.pointLength!==D||xe.spotLength!==O||xe.rectAreaLength!==F||xe.hemiLength!==U||xe.numDirectionalShadows!==X||xe.numPointShadows!==W||xe.numSpotShadows!==K||xe.numSpotMaps!==ne||xe.numLightProbes!==re)&&(s.directional.length=R,s.spot.length=O,s.rectArea.length=F,s.point.length=D,s.hemi.length=U,s.directionalShadow.length=X,s.directionalShadowMap.length=X,s.pointShadow.length=W,s.pointShadowMap.length=W,s.spotShadow.length=K,s.spotShadowMap.length=K,s.directionalShadowMatrix.length=X,s.pointShadowMatrix.length=W,s.spotLightMatrix.length=K+ne-te,s.spotLightMap.length=ne,s.numSpotLightShadowsWithMaps=te,s.numLightProbes=re,xe.directionalLength=R,xe.pointLength=D,xe.spotLength=O,xe.rectAreaLength=F,xe.hemiLength=U,xe.numDirectionalShadows=X,xe.numPointShadows=W,xe.numSpotShadows=K,xe.numSpotMaps=ne,xe.numLightProbes=re,s.version=fAe++)}function v(w,E){let T=0,k=0,R=0,D=0,O=0;const F=E.matrixWorldInverse;for(let U=0,X=w.length;U<X;U++){const W=w[U];if(W.isDirectionalLight){const K=s.directional[T];K.direction.setFromMatrixPosition(W.matrixWorld),l.setFromMatrixPosition(W.target.matrixWorld),K.direction.sub(l),K.direction.transformDirection(F),T++}else if(W.isSpotLight){const K=s.spot[R];K.position.setFromMatrixPosition(W.matrixWorld),K.position.applyMatrix4(F),K.direction.setFromMatrixPosition(W.matrixWorld),l.setFromMatrixPosition(W.target.matrixWorld),K.direction.sub(l),K.direction.transformDirection(F),R++}else if(W.isRectAreaLight){const K=s.rectArea[D];K.position.setFromMatrixPosition(W.matrixWorld),K.position.applyMatrix4(F),p.identity(),u.copy(W.matrixWorld),u.premultiply(F),p.extractRotation(u),K.halfWidth.set(W.width*.5,0,0),K.halfHeight.set(0,W.height*.5,0),K.halfWidth.applyMatrix4(p),K.halfHeight.applyMatrix4(p),D++}else if(W.isPointLight){const K=s.point[k];K.position.setFromMatrixPosition(W.matrixWorld),K.position.applyMatrix4(F),k++}else if(W.isHemisphereLight){const K=s.hemi[O];K.direction.setFromMatrixPosition(W.matrixWorld),K.direction.transformDirection(F),O++}}}return{setup:r,setupView:v,state:s}}function k8(t){const e=new mAe(t),n=[],s=[];function l(E){w.camera=E,n.length=0,s.length=0}function u(E){n.push(E)}function p(E){s.push(E)}function r(){e.setup(n)}function v(E){e.setupView(n,E)}const w={lightsArray:n,shadowsArray:s,camera:null,lights:e,transmissionRenderTarget:{}};return{init:l,state:w,setupLights:r,setupLightsView:v,pushLight:u,pushShadow:p}}function gAe(t){let e=new WeakMap;function n(l,u=0){const p=e.get(l);let r;return p===void 0?(r=new k8(t),e.set(l,[r])):u>=p.length?(r=new k8(t),p.push(r)):r=p[u],r}function s(){e=new WeakMap}return{get:n,dispose:s}}const yAe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,xAe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function _Ae(t,e,n){let s=new Cq;const l=new po,u=new po,p=new _a,r=new Hwe({depthPacking:twe}),v=new Gwe,w={},E=n.maxTextureSize,T={[W0]:wu,[wu]:W0,[zm]:zm},k=new lg({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new po},radius:{value:4}},vertexShader:yAe,fragmentShader:xAe}),R=k.clone();R.defines.HORIZONTAL_PASS=1;const D=new mf;D.setAttribute("position",new wp(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const O=new q0(D,k),F=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sq;let U=this.type;this.render=function(te,re,xe){if(F.enabled===!1||F.autoUpdate===!1&&F.needsUpdate===!1||te.length===0)return;const ae=t.getRenderTarget(),ce=t.getActiveCubeFace(),ye=t.getActiveMipmapLevel(),Ce=t.state;Ce.setBlending(Km),Ce.buffers.depth.getReversed()===!0?Ce.buffers.color.setClear(0,0,0,0):Ce.buffers.color.setClear(1,1,1,1),Ce.buffers.depth.setTest(!0),Ce.setScissorTest(!1);const Me=U!==Rm&&this.type===Rm,Ke=U===Rm&&this.type!==Rm;for(let ke=0,je=te.length;ke<je;ke++){const $e=te[ke],Ae=$e.shadow;if(Ae===void 0){us("WebGLShadowMap:",$e,"has no shadow.");continue}if(Ae.autoUpdate===!1&&Ae.needsUpdate===!1)continue;l.copy(Ae.mapSize);const He=Ae.getFrameExtents();if(l.multiply(He),u.copy(Ae.mapSize),(l.x>E||l.y>E)&&(l.x>E&&(u.x=Math.floor(E/He.x),l.x=u.x*He.x,Ae.mapSize.x=u.x),l.y>E&&(u.y=Math.floor(E/He.y),l.y=u.y*He.y,Ae.mapSize.y=u.y)),Ae.map===null||Me===!0||Ke===!0){const Le=this.type!==Rm?{minFilter:ud,magFilter:ud}:{};Ae.map!==null&&Ae.map.dispose(),Ae.map=new $x(l.x,l.y,Le),Ae.map.texture.name=$e.name+".shadowMap",Ae.camera.updateProjectionMatrix()}t.setRenderTarget(Ae.map),t.clear();const qe=Ae.getViewportCount();for(let Le=0;Le<qe;Le++){const st=Ae.getViewport(Le);p.set(u.x*st.x,u.y*st.y,u.x*st.z,u.y*st.w),Ce.viewport(p),Ae.updateMatrices($e,Le),s=Ae.getFrustum(),K(re,xe,Ae.camera,$e,this.type)}Ae.isPointLightShadow!==!0&&this.type===Rm&&X(Ae,xe),Ae.needsUpdate=!1}U=this.type,F.needsUpdate=!1,t.setRenderTarget(ae,ce,ye)};function X(te,re){const xe=e.update(O);k.defines.VSM_SAMPLES!==te.blurSamples&&(k.defines.VSM_SAMPLES=te.blurSamples,R.defines.VSM_SAMPLES=te.blurSamples,k.needsUpdate=!0,R.needsUpdate=!0),te.mapPass===null&&(te.mapPass=new $x(l.x,l.y)),k.uniforms.shadow_pass.value=te.map.texture,k.uniforms.resolution.value=te.mapSize,k.uniforms.radius.value=te.radius,t.setRenderTarget(te.mapPass),t.clear(),t.renderBufferDirect(re,null,xe,k,O,null),R.uniforms.shadow_pass.value=te.mapPass.texture,R.uniforms.resolution.value=te.mapSize,R.uniforms.radius.value=te.radius,t.setRenderTarget(te.map),t.clear(),t.renderBufferDirect(re,null,xe,R,O,null)}function W(te,re,xe,ae){let ce=null;const ye=xe.isPointLight===!0?te.customDistanceMaterial:te.customDepthMaterial;if(ye!==void 0)ce=ye;else if(ce=xe.isPointLight===!0?v:r,t.localClippingEnabled&&re.clipShadows===!0&&Array.isArray(re.clippingPlanes)&&re.clippingPlanes.length!==0||re.displacementMap&&re.displacementScale!==0||re.alphaMap&&re.alphaTest>0||re.map&&re.alphaTest>0||re.alphaToCoverage===!0){const Ce=ce.uuid,Me=re.uuid;let Ke=w[Ce];Ke===void 0&&(Ke={},w[Ce]=Ke);let ke=Ke[Me];ke===void 0&&(ke=ce.clone(),Ke[Me]=ke,re.addEventListener("dispose",ne)),ce=ke}if(ce.visible=re.visible,ce.wireframe=re.wireframe,ae===Rm?ce.side=re.shadowSide!==null?re.shadowSide:re.side:ce.side=re.shadowSide!==null?re.shadowSide:T[re.side],ce.alphaMap=re.alphaMap,ce.alphaTest=re.alphaToCoverage===!0?.5:re.alphaTest,ce.map=re.map,ce.clipShadows=re.clipShadows,ce.clippingPlanes=re.clippingPlanes,ce.clipIntersection=re.clipIntersection,ce.displacementMap=re.displacementMap,ce.displacementScale=re.displacementScale,ce.displacementBias=re.displacementBias,ce.wireframeLinewidth=re.wireframeLinewidth,ce.linewidth=re.linewidth,xe.isPointLight===!0&&ce.isMeshDistanceMaterial===!0){const Ce=t.properties.get(ce);Ce.light=xe}return ce}function K(te,re,xe,ae,ce){if(te.visible===!1)return;if(te.layers.test(re.layers)&&(te.isMesh||te.isLine||te.isPoints)&&(te.castShadow||te.receiveShadow&&ce===Rm)&&(!te.frustumCulled||s.intersectsObject(te))){te.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,te.matrixWorld);const Me=e.update(te),Ke=te.material;if(Array.isArray(Ke)){const ke=Me.groups;for(let je=0,$e=ke.length;je<$e;je++){const Ae=ke[je],He=Ke[Ae.materialIndex];if(He&&He.visible){const qe=W(te,He,ae,ce);te.onBeforeShadow(t,te,re,xe,Me,qe,Ae),t.renderBufferDirect(xe,null,Me,qe,te,Ae),te.onAfterShadow(t,te,re,xe,Me,qe,Ae)}}}else if(Ke.visible){const ke=W(te,Ke,ae,ce);te.onBeforeShadow(t,te,re,xe,Me,ke,null),t.renderBufferDirect(xe,null,Me,ke,te,null),te.onAfterShadow(t,te,re,xe,Me,ke,null)}}const Ce=te.children;for(let Me=0,Ke=Ce.length;Me<Ke;Me++)K(Ce[Me],re,xe,ae,ce)}function ne(te){te.target.removeEventListener("dispose",ne);for(const xe in w){const ae=w[xe],ce=te.target.uuid;ce in ae&&(ae[ce].dispose(),delete ae[ce])}}}const vAe={[bI]:wI,[SI]:AI,[TI]:CI,[sb]:EI,[wI]:bI,[AI]:SI,[CI]:TI,[EI]:sb};function bAe(t,e){function n(){let St=!1;const Gn=new _a;let er=null;const gr=new _a(0,0,0,0);return{setMask:function(nr){er!==nr&&!St&&(t.colorMask(nr,nr,nr,nr),er=nr)},setLocked:function(nr){St=nr},setClear:function(nr,ln,Tr,ni,Yi){Yi===!0&&(nr*=ni,ln*=ni,Tr*=ni),Gn.set(nr,ln,Tr,ni),gr.equals(Gn)===!1&&(t.clearColor(nr,ln,Tr,ni),gr.copy(Gn))},reset:function(){St=!1,er=null,gr.set(-1,0,0,0)}}}function s(){let St=!1,Gn=!1,er=null,gr=null,nr=null;return{setReversed:function(ln){if(Gn!==ln){const Tr=e.get("EXT_clip_control");ln?Tr.clipControlEXT(Tr.LOWER_LEFT_EXT,Tr.ZERO_TO_ONE_EXT):Tr.clipControlEXT(Tr.LOWER_LEFT_EXT,Tr.NEGATIVE_ONE_TO_ONE_EXT),Gn=ln;const ni=nr;nr=null,this.setClear(ni)}},getReversed:function(){return Gn},setTest:function(ln){ln?vt(t.DEPTH_TEST):qt(t.DEPTH_TEST)},setMask:function(ln){er!==ln&&!St&&(t.depthMask(ln),er=ln)},setFunc:function(ln){if(Gn&&(ln=vAe[ln]),gr!==ln){switch(ln){case bI:t.depthFunc(t.NEVER);break;case wI:t.depthFunc(t.ALWAYS);break;case SI:t.depthFunc(t.LESS);break;case sb:t.depthFunc(t.LEQUAL);break;case TI:t.depthFunc(t.EQUAL);break;case EI:t.depthFunc(t.GEQUAL);break;case AI:t.depthFunc(t.GREATER);break;case CI:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}gr=ln}},setLocked:function(ln){St=ln},setClear:function(ln){nr!==ln&&(Gn&&(ln=1-ln),t.clearDepth(ln),nr=ln)},reset:function(){St=!1,er=null,gr=null,nr=null,Gn=!1}}}function l(){let St=!1,Gn=null,er=null,gr=null,nr=null,ln=null,Tr=null,ni=null,Yi=null;return{setTest:function(ns){St||(ns?vt(t.STENCIL_TEST):qt(t.STENCIL_TEST))},setMask:function(ns){Gn!==ns&&!St&&(t.stencilMask(ns),Gn=ns)},setFunc:function(ns,Ht,cs){(er!==ns||gr!==Ht||nr!==cs)&&(t.stencilFunc(ns,Ht,cs),er=ns,gr=Ht,nr=cs)},setOp:function(ns,Ht,cs){(ln!==ns||Tr!==Ht||ni!==cs)&&(t.stencilOp(ns,Ht,cs),ln=ns,Tr=Ht,ni=cs)},setLocked:function(ns){St=ns},setClear:function(ns){Yi!==ns&&(t.clearStencil(ns),Yi=ns)},reset:function(){St=!1,Gn=null,er=null,gr=null,nr=null,ln=null,Tr=null,ni=null,Yi=null}}}const u=new n,p=new s,r=new l,v=new WeakMap,w=new WeakMap;let E={},T={},k=new WeakMap,R=[],D=null,O=!1,F=null,U=null,X=null,W=null,K=null,ne=null,te=null,re=new ro(0,0,0),xe=0,ae=!1,ce=null,ye=null,Ce=null,Me=null,Ke=null;const ke=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let je=!1,$e=0;const Ae=t.getParameter(t.VERSION);Ae.indexOf("WebGL")!==-1?($e=parseFloat(/^WebGL (\d)/.exec(Ae)[1]),je=$e>=1):Ae.indexOf("OpenGL ES")!==-1&&($e=parseFloat(/^OpenGL ES (\d)/.exec(Ae)[1]),je=$e>=2);let He=null,qe={};const Le=t.getParameter(t.SCISSOR_BOX),st=t.getParameter(t.VIEWPORT),bt=new _a().fromArray(Le),yt=new _a().fromArray(st);function Vt(St,Gn,er,gr){const nr=new Uint8Array(4),ln=t.createTexture();t.bindTexture(St,ln),t.texParameteri(St,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(St,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Tr=0;Tr<er;Tr++)St===t.TEXTURE_3D||St===t.TEXTURE_2D_ARRAY?t.texImage3D(Gn,0,t.RGBA,1,1,gr,0,t.RGBA,t.UNSIGNED_BYTE,nr):t.texImage2D(Gn+Tr,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,nr);return ln}const _t={};_t[t.TEXTURE_2D]=Vt(t.TEXTURE_2D,t.TEXTURE_2D,1),_t[t.TEXTURE_CUBE_MAP]=Vt(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),_t[t.TEXTURE_2D_ARRAY]=Vt(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),_t[t.TEXTURE_3D]=Vt(t.TEXTURE_3D,t.TEXTURE_3D,1,1),u.setClear(0,0,0,1),p.setClear(1),r.setClear(0),vt(t.DEPTH_TEST),p.setFunc(sb),Lr(!1),Br(Nz),vt(t.CULL_FACE),$r(Km);function vt(St){E[St]!==!0&&(t.enable(St),E[St]=!0)}function qt(St){E[St]!==!1&&(t.disable(St),E[St]=!1)}function kt(St,Gn){return T[St]!==Gn?(t.bindFramebuffer(St,Gn),T[St]=Gn,St===t.DRAW_FRAMEBUFFER&&(T[t.FRAMEBUFFER]=Gn),St===t.FRAMEBUFFER&&(T[t.DRAW_FRAMEBUFFER]=Gn),!0):!1}function on(St,Gn){let er=R,gr=!1;if(St){er=k.get(Gn),er===void 0&&(er=[],k.set(Gn,er));const nr=St.textures;if(er.length!==nr.length||er[0]!==t.COLOR_ATTACHMENT0){for(let ln=0,Tr=nr.length;ln<Tr;ln++)er[ln]=t.COLOR_ATTACHMENT0+ln;er.length=nr.length,gr=!0}}else er[0]!==t.BACK&&(er[0]=t.BACK,gr=!0);gr&&t.drawBuffers(er)}function mn(St){return D!==St?(t.useProgram(St),D=St,!0):!1}const Hr={[tx]:t.FUNC_ADD,[C1e]:t.FUNC_SUBTRACT,[M1e]:t.FUNC_REVERSE_SUBTRACT};Hr[k1e]=t.MIN,Hr[I1e]=t.MAX;const Un={[P1e]:t.ZERO,[R1e]:t.ONE,[N1e]:t.SRC_COLOR,[_I]:t.SRC_ALPHA,[B1e]:t.SRC_ALPHA_SATURATE,[O1e]:t.DST_COLOR,[D1e]:t.DST_ALPHA,[j1e]:t.ONE_MINUS_SRC_COLOR,[vI]:t.ONE_MINUS_SRC_ALPHA,[F1e]:t.ONE_MINUS_DST_COLOR,[L1e]:t.ONE_MINUS_DST_ALPHA,[z1e]:t.CONSTANT_COLOR,[U1e]:t.ONE_MINUS_CONSTANT_COLOR,[V1e]:t.CONSTANT_ALPHA,[H1e]:t.ONE_MINUS_CONSTANT_ALPHA};function $r(St,Gn,er,gr,nr,ln,Tr,ni,Yi,ns){if(St===Km){O===!0&&(qt(t.BLEND),O=!1);return}if(O===!1&&(vt(t.BLEND),O=!0),St!==A1e){if(St!==F||ns!==ae){if((U!==tx||K!==tx)&&(t.blendEquation(t.FUNC_ADD),U=tx,K=tx),ns)switch(St){case Pv:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case HE:t.blendFunc(t.ONE,t.ONE);break;case jz:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Dz:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:xa("WebGLState: Invalid blending: ",St);break}else switch(St){case Pv:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case HE:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case jz:xa("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Dz:xa("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:xa("WebGLState: Invalid blending: ",St);break}X=null,W=null,ne=null,te=null,re.set(0,0,0),xe=0,F=St,ae=ns}return}nr=nr||Gn,ln=ln||er,Tr=Tr||gr,(Gn!==U||nr!==K)&&(t.blendEquationSeparate(Hr[Gn],Hr[nr]),U=Gn,K=nr),(er!==X||gr!==W||ln!==ne||Tr!==te)&&(t.blendFuncSeparate(Un[er],Un[gr],Un[ln],Un[Tr]),X=er,W=gr,ne=ln,te=Tr),(ni.equals(re)===!1||Yi!==xe)&&(t.blendColor(ni.r,ni.g,ni.b,Yi),re.copy(ni),xe=Yi),F=St,ae=!1}function ht(St,Gn){St.side===zm?qt(t.CULL_FACE):vt(t.CULL_FACE);let er=St.side===wu;Gn&&(er=!er),Lr(er),St.blending===Pv&&St.transparent===!1?$r(Km):$r(St.blending,St.blendEquation,St.blendSrc,St.blendDst,St.blendEquationAlpha,St.blendSrcAlpha,St.blendDstAlpha,St.blendColor,St.blendAlpha,St.premultipliedAlpha),p.setFunc(St.depthFunc),p.setTest(St.depthTest),p.setMask(St.depthWrite),u.setMask(St.colorWrite);const gr=St.stencilWrite;r.setTest(gr),gr&&(r.setMask(St.stencilWriteMask),r.setFunc(St.stencilFunc,St.stencilRef,St.stencilFuncMask),r.setOp(St.stencilFail,St.stencilZFail,St.stencilZPass)),Nn(St.polygonOffset,St.polygonOffsetFactor,St.polygonOffsetUnits),St.alphaToCoverage===!0?vt(t.SAMPLE_ALPHA_TO_COVERAGE):qt(t.SAMPLE_ALPHA_TO_COVERAGE)}function Lr(St){ce!==St&&(St?t.frontFace(t.CW):t.frontFace(t.CCW),ce=St)}function Br(St){St!==S1e?(vt(t.CULL_FACE),St!==ye&&(St===Nz?t.cullFace(t.BACK):St===T1e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):qt(t.CULL_FACE),ye=St}function wn(St){St!==Ce&&(je&&t.lineWidth(St),Ce=St)}function Nn(St,Gn,er){St?(vt(t.POLYGON_OFFSET_FILL),(Me!==Gn||Ke!==er)&&(t.polygonOffset(Gn,er),Me=Gn,Ke=er)):qt(t.POLYGON_OFFSET_FILL)}function mr(St){St?vt(t.SCISSOR_TEST):qt(t.SCISSOR_TEST)}function Qn(St){St===void 0&&(St=t.TEXTURE0+ke-1),He!==St&&(t.activeTexture(St),He=St)}function Nt(St,Gn,er){er===void 0&&(He===null?er=t.TEXTURE0+ke-1:er=He);let gr=qe[er];gr===void 0&&(gr={type:void 0,texture:void 0},qe[er]=gr),(gr.type!==St||gr.texture!==Gn)&&(He!==er&&(t.activeTexture(er),He=er),t.bindTexture(St,Gn||_t[St]),gr.type=St,gr.texture=Gn)}function et(){const St=qe[He];St!==void 0&&St.type!==void 0&&(t.bindTexture(St.type,null),St.type=void 0,St.texture=void 0)}function Oe(){try{t.compressedTexImage2D(...arguments)}catch(St){St("WebGLState:",St)}}function Bt(){try{t.compressedTexImage3D(...arguments)}catch(St){St("WebGLState:",St)}}function En(){try{t.texSubImage2D(...arguments)}catch(St){St("WebGLState:",St)}}function Dn(){try{t.texSubImage3D(...arguments)}catch(St){St("WebGLState:",St)}}function rn(){try{t.compressedTexSubImage2D(...arguments)}catch(St){St("WebGLState:",St)}}function wr(){try{t.compressedTexSubImage3D(...arguments)}catch(St){St("WebGLState:",St)}}function cr(){try{t.texStorage2D(...arguments)}catch(St){St("WebGLState:",St)}}function Jn(){try{t.texStorage3D(...arguments)}catch(St){St("WebGLState:",St)}}function ir(){try{t.texImage2D(...arguments)}catch(St){St("WebGLState:",St)}}function bn(){try{t.texImage3D(...arguments)}catch(St){St("WebGLState:",St)}}function In(St){bt.equals(St)===!1&&(t.scissor(St.x,St.y,St.z,St.w),bt.copy(St))}function Zr(St){yt.equals(St)===!1&&(t.viewport(St.x,St.y,St.z,St.w),yt.copy(St))}function Vr(St,Gn){let er=w.get(Gn);er===void 0&&(er=new WeakMap,w.set(Gn,er));let gr=er.get(St);gr===void 0&&(gr=t.getUniformBlockIndex(Gn,St.name),er.set(St,gr))}function qn(St,Gn){const gr=w.get(Gn).get(St);v.get(Gn)!==gr&&(t.uniformBlockBinding(Gn,gr,St.__bindingPointIndex),v.set(Gn,gr))}function Kn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),p.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),E={},He=null,qe={},T={},k=new WeakMap,R=[],D=null,O=!1,F=null,U=null,X=null,W=null,K=null,ne=null,te=null,re=new ro(0,0,0),xe=0,ae=!1,ce=null,ye=null,Ce=null,Me=null,Ke=null,bt.set(0,0,t.canvas.width,t.canvas.height),yt.set(0,0,t.canvas.width,t.canvas.height),u.reset(),p.reset(),r.reset()}return{buffers:{color:u,depth:p,stencil:r},enable:vt,disable:qt,bindFramebuffer:kt,drawBuffers:on,useProgram:mn,setBlending:$r,setMaterial:ht,setFlipSided:Lr,setCullFace:Br,setLineWidth:wn,setPolygonOffset:Nn,setScissorTest:mr,activeTexture:Qn,bindTexture:Nt,unbindTexture:et,compressedTexImage2D:Oe,compressedTexImage3D:Bt,texImage2D:ir,texImage3D:bn,updateUBOMapping:Vr,uniformBlockBinding:qn,texStorage2D:cr,texStorage3D:Jn,texSubImage2D:En,texSubImage3D:Dn,compressedTexSubImage2D:rn,compressedTexSubImage3D:wr,scissor:In,viewport:Zr,reset:Kn}}function wAe(t,e,n,s,l,u,p){const r=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,v=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),w=new po,E=new WeakMap;let T;const k=new WeakMap;let R=!1;try{R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function D(et,Oe){return R?new OffscreenCanvas(et,Oe):WE("canvas")}function O(et,Oe,Bt){let En=1;const Dn=Nt(et);if((Dn.width>Bt||Dn.height>Bt)&&(En=Bt/Math.max(Dn.width,Dn.height)),En<1)if(typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&et instanceof ImageBitmap||typeof VideoFrame<"u"&&et instanceof VideoFrame){const rn=Math.floor(En*Dn.width),wr=Math.floor(En*Dn.height);T===void 0&&(T=D(rn,wr));const cr=Oe?D(rn,wr):T;return cr.width=rn,cr.height=wr,cr.getContext("2d").drawImage(et,0,0,rn,wr),us("WebGLRenderer: Texture has been resized from ("+Dn.width+"x"+Dn.height+") to ("+rn+"x"+wr+")."),cr}else return"data"in et&&us("WebGLRenderer: Image in DataTexture is too big ("+Dn.width+"x"+Dn.height+")."),et;return et}function F(et){return et.generateMipmaps}function U(et){t.generateMipmap(et)}function X(et){return et.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:et.isWebGL3DRenderTarget?t.TEXTURE_3D:et.isWebGLArrayRenderTarget||et.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function W(et,Oe,Bt,En,Dn=!1){if(et!==null){if(t[et]!==void 0)return t[et];us("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let rn=Oe;if(Oe===t.RED&&(Bt===t.FLOAT&&(rn=t.R32F),Bt===t.HALF_FLOAT&&(rn=t.R16F),Bt===t.UNSIGNED_BYTE&&(rn=t.R8)),Oe===t.RED_INTEGER&&(Bt===t.UNSIGNED_BYTE&&(rn=t.R8UI),Bt===t.UNSIGNED_SHORT&&(rn=t.R16UI),Bt===t.UNSIGNED_INT&&(rn=t.R32UI),Bt===t.BYTE&&(rn=t.R8I),Bt===t.SHORT&&(rn=t.R16I),Bt===t.INT&&(rn=t.R32I)),Oe===t.RG&&(Bt===t.FLOAT&&(rn=t.RG32F),Bt===t.HALF_FLOAT&&(rn=t.RG16F),Bt===t.UNSIGNED_BYTE&&(rn=t.RG8)),Oe===t.RG_INTEGER&&(Bt===t.UNSIGNED_BYTE&&(rn=t.RG8UI),Bt===t.UNSIGNED_SHORT&&(rn=t.RG16UI),Bt===t.UNSIGNED_INT&&(rn=t.RG32UI),Bt===t.BYTE&&(rn=t.RG8I),Bt===t.SHORT&&(rn=t.RG16I),Bt===t.INT&&(rn=t.RG32I)),Oe===t.RGB_INTEGER&&(Bt===t.UNSIGNED_BYTE&&(rn=t.RGB8UI),Bt===t.UNSIGNED_SHORT&&(rn=t.RGB16UI),Bt===t.UNSIGNED_INT&&(rn=t.RGB32UI),Bt===t.BYTE&&(rn=t.RGB8I),Bt===t.SHORT&&(rn=t.RGB16I),Bt===t.INT&&(rn=t.RGB32I)),Oe===t.RGBA_INTEGER&&(Bt===t.UNSIGNED_BYTE&&(rn=t.RGBA8UI),Bt===t.UNSIGNED_SHORT&&(rn=t.RGBA16UI),Bt===t.UNSIGNED_INT&&(rn=t.RGBA32UI),Bt===t.BYTE&&(rn=t.RGBA8I),Bt===t.SHORT&&(rn=t.RGBA16I),Bt===t.INT&&(rn=t.RGBA32I)),Oe===t.RGB&&(Bt===t.UNSIGNED_INT_5_9_9_9_REV&&(rn=t.RGB9_E5),Bt===t.UNSIGNED_INT_10F_11F_11F_REV&&(rn=t.R11F_G11F_B10F)),Oe===t.RGBA){const wr=Dn?GE:Js.getTransfer(En);Bt===t.FLOAT&&(rn=t.RGBA32F),Bt===t.HALF_FLOAT&&(rn=t.RGBA16F),Bt===t.UNSIGNED_BYTE&&(rn=wr===fo?t.SRGB8_ALPHA8:t.RGBA8),Bt===t.UNSIGNED_SHORT_4_4_4_4&&(rn=t.RGBA4),Bt===t.UNSIGNED_SHORT_5_5_5_1&&(rn=t.RGB5_A1)}return(rn===t.R16F||rn===t.R32F||rn===t.RG16F||rn===t.RG32F||rn===t.RGBA16F||rn===t.RGBA32F)&&e.get("EXT_color_buffer_float"),rn}function K(et,Oe){let Bt;return et?Oe===null||Oe===Gx||Oe===Vw?Bt=t.DEPTH24_STENCIL8:Oe===Hm?Bt=t.DEPTH32F_STENCIL8:Oe===Uw&&(Bt=t.DEPTH24_STENCIL8,us("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Oe===null||Oe===Gx||Oe===Vw?Bt=t.DEPTH_COMPONENT24:Oe===Hm?Bt=t.DEPTH_COMPONENT32F:Oe===Uw&&(Bt=t.DEPTH_COMPONENT16),Bt}function ne(et,Oe){return F(et)===!0||et.isFramebufferTexture&&et.minFilter!==ud&&et.minFilter!==rh?Math.log2(Math.max(Oe.width,Oe.height))+1:et.mipmaps!==void 0&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?Oe.mipmaps.length:1}function te(et){const Oe=et.target;Oe.removeEventListener("dispose",te),xe(Oe),Oe.isVideoTexture&&E.delete(Oe)}function re(et){const Oe=et.target;Oe.removeEventListener("dispose",re),ce(Oe)}function xe(et){const Oe=s.get(et);if(Oe.__webglInit===void 0)return;const Bt=et.source,En=k.get(Bt);if(En){const Dn=En[Oe.__cacheKey];Dn.usedTimes--,Dn.usedTimes===0&&ae(et),Object.keys(En).length===0&&k.delete(Bt)}s.remove(et)}function ae(et){const Oe=s.get(et);t.deleteTexture(Oe.__webglTexture);const Bt=et.source,En=k.get(Bt);delete En[Oe.__cacheKey],p.memory.textures--}function ce(et){const Oe=s.get(et);if(et.depthTexture&&(et.depthTexture.dispose(),s.remove(et.depthTexture)),et.isWebGLCubeRenderTarget)for(let En=0;En<6;En++){if(Array.isArray(Oe.__webglFramebuffer[En]))for(let Dn=0;Dn<Oe.__webglFramebuffer[En].length;Dn++)t.deleteFramebuffer(Oe.__webglFramebuffer[En][Dn]);else t.deleteFramebuffer(Oe.__webglFramebuffer[En]);Oe.__webglDepthbuffer&&t.deleteRenderbuffer(Oe.__webglDepthbuffer[En])}else{if(Array.isArray(Oe.__webglFramebuffer))for(let En=0;En<Oe.__webglFramebuffer.length;En++)t.deleteFramebuffer(Oe.__webglFramebuffer[En]);else t.deleteFramebuffer(Oe.__webglFramebuffer);if(Oe.__webglDepthbuffer&&t.deleteRenderbuffer(Oe.__webglDepthbuffer),Oe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(Oe.__webglMultisampledFramebuffer),Oe.__webglColorRenderbuffer)for(let En=0;En<Oe.__webglColorRenderbuffer.length;En++)Oe.__webglColorRenderbuffer[En]&&t.deleteRenderbuffer(Oe.__webglColorRenderbuffer[En]);Oe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(Oe.__webglDepthRenderbuffer)}const Bt=et.textures;for(let En=0,Dn=Bt.length;En<Dn;En++){const rn=s.get(Bt[En]);rn.__webglTexture&&(t.deleteTexture(rn.__webglTexture),p.memory.textures--),s.remove(Bt[En])}s.remove(et)}let ye=0;function Ce(){ye=0}function Me(){const et=ye;return et>=l.maxTextures&&us("WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+l.maxTextures),ye+=1,et}function Ke(et){const Oe=[];return Oe.push(et.wrapS),Oe.push(et.wrapT),Oe.push(et.wrapR||0),Oe.push(et.magFilter),Oe.push(et.minFilter),Oe.push(et.anisotropy),Oe.push(et.internalFormat),Oe.push(et.format),Oe.push(et.type),Oe.push(et.generateMipmaps),Oe.push(et.premultiplyAlpha),Oe.push(et.flipY),Oe.push(et.unpackAlignment),Oe.push(et.colorSpace),Oe.join()}function ke(et,Oe){const Bt=s.get(et);if(et.isVideoTexture&&mr(et),et.isRenderTargetTexture===!1&&et.isExternalTexture!==!0&&et.version>0&&Bt.__version!==et.version){const En=et.image;if(En===null)us("WebGLRenderer: Texture marked for update but no image data found.");else if(En.complete===!1)us("WebGLRenderer: Texture marked for update but image is incomplete");else{_t(Bt,et,Oe);return}}else et.isExternalTexture&&(Bt.__webglTexture=et.sourceTexture?et.sourceTexture:null);n.bindTexture(t.TEXTURE_2D,Bt.__webglTexture,t.TEXTURE0+Oe)}function je(et,Oe){const Bt=s.get(et);if(et.isRenderTargetTexture===!1&&et.version>0&&Bt.__version!==et.version){_t(Bt,et,Oe);return}else et.isExternalTexture&&(Bt.__webglTexture=et.sourceTexture?et.sourceTexture:null);n.bindTexture(t.TEXTURE_2D_ARRAY,Bt.__webglTexture,t.TEXTURE0+Oe)}function $e(et,Oe){const Bt=s.get(et);if(et.isRenderTargetTexture===!1&&et.version>0&&Bt.__version!==et.version){_t(Bt,et,Oe);return}n.bindTexture(t.TEXTURE_3D,Bt.__webglTexture,t.TEXTURE0+Oe)}function Ae(et,Oe){const Bt=s.get(et);if(et.version>0&&Bt.__version!==et.version){vt(Bt,et,Oe);return}n.bindTexture(t.TEXTURE_CUBE_MAP,Bt.__webglTexture,t.TEXTURE0+Oe)}const He={[II]:t.REPEAT,[Vm]:t.CLAMP_TO_EDGE,[PI]:t.MIRRORED_REPEAT},qe={[ud]:t.NEAREST,[J1e]:t.NEAREST_MIPMAP_NEAREST,[uT]:t.NEAREST_MIPMAP_LINEAR,[rh]:t.LINEAR,[QM]:t.LINEAR_MIPMAP_NEAREST,[cx]:t.LINEAR_MIPMAP_LINEAR},Le={[iwe]:t.NEVER,[uwe]:t.ALWAYS,[swe]:t.LESS,[mq]:t.LEQUAL,[owe]:t.EQUAL,[cwe]:t.GEQUAL,[awe]:t.GREATER,[lwe]:t.NOTEQUAL};function st(et,Oe){if(Oe.type===Hm&&e.has("OES_texture_float_linear")===!1&&(Oe.magFilter===rh||Oe.magFilter===QM||Oe.magFilter===uT||Oe.magFilter===cx||Oe.minFilter===rh||Oe.minFilter===QM||Oe.minFilter===uT||Oe.minFilter===cx)&&us("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(et,t.TEXTURE_WRAP_S,He[Oe.wrapS]),t.texParameteri(et,t.TEXTURE_WRAP_T,He[Oe.wrapT]),(et===t.TEXTURE_3D||et===t.TEXTURE_2D_ARRAY)&&t.texParameteri(et,t.TEXTURE_WRAP_R,He[Oe.wrapR]),t.texParameteri(et,t.TEXTURE_MAG_FILTER,qe[Oe.magFilter]),t.texParameteri(et,t.TEXTURE_MIN_FILTER,qe[Oe.minFilter]),Oe.compareFunction&&(t.texParameteri(et,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(et,t.TEXTURE_COMPARE_FUNC,Le[Oe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Oe.magFilter===ud||Oe.minFilter!==uT&&Oe.minFilter!==cx||Oe.type===Hm&&e.has("OES_texture_float_linear")===!1)return;if(Oe.anisotropy>1||s.get(Oe).__currentAnisotropy){const Bt=e.get("EXT_texture_filter_anisotropic");t.texParameterf(et,Bt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Oe.anisotropy,l.getMaxAnisotropy())),s.get(Oe).__currentAnisotropy=Oe.anisotropy}}}function bt(et,Oe){let Bt=!1;et.__webglInit===void 0&&(et.__webglInit=!0,Oe.addEventListener("dispose",te));const En=Oe.source;let Dn=k.get(En);Dn===void 0&&(Dn={},k.set(En,Dn));const rn=Ke(Oe);if(rn!==et.__cacheKey){Dn[rn]===void 0&&(Dn[rn]={texture:t.createTexture(),usedTimes:0},p.memory.textures++,Bt=!0),Dn[rn].usedTimes++;const wr=Dn[et.__cacheKey];wr!==void 0&&(Dn[et.__cacheKey].usedTimes--,wr.usedTimes===0&&ae(Oe)),et.__cacheKey=rn,et.__webglTexture=Dn[rn].texture}return Bt}function yt(et,Oe,Bt){return Math.floor(Math.floor(et/Bt)/Oe)}function Vt(et,Oe,Bt,En){const rn=et.updateRanges;if(rn.length===0)n.texSubImage2D(t.TEXTURE_2D,0,0,0,Oe.width,Oe.height,Bt,En,Oe.data);else{rn.sort((bn,In)=>bn.start-In.start);let wr=0;for(let bn=1;bn<rn.length;bn++){const In=rn[wr],Zr=rn[bn],Vr=In.start+In.count,qn=yt(Zr.start,Oe.width,4),Kn=yt(In.start,Oe.width,4);Zr.start<=Vr+1&&qn===Kn&&yt(Zr.start+Zr.count-1,Oe.width,4)===qn?In.count=Math.max(In.count,Zr.start+Zr.count-In.start):(++wr,rn[wr]=Zr)}rn.length=wr+1;const cr=t.getParameter(t.UNPACK_ROW_LENGTH),Jn=t.getParameter(t.UNPACK_SKIP_PIXELS),ir=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,Oe.width);for(let bn=0,In=rn.length;bn<In;bn++){const Zr=rn[bn],Vr=Math.floor(Zr.start/4),qn=Math.ceil(Zr.count/4),Kn=Vr%Oe.width,St=Math.floor(Vr/Oe.width),Gn=qn,er=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,Kn),t.pixelStorei(t.UNPACK_SKIP_ROWS,St),n.texSubImage2D(t.TEXTURE_2D,0,Kn,St,Gn,er,Bt,En,Oe.data)}et.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,cr),t.pixelStorei(t.UNPACK_SKIP_PIXELS,Jn),t.pixelStorei(t.UNPACK_SKIP_ROWS,ir)}}function _t(et,Oe,Bt){let En=t.TEXTURE_2D;(Oe.isDataArrayTexture||Oe.isCompressedArrayTexture)&&(En=t.TEXTURE_2D_ARRAY),Oe.isData3DTexture&&(En=t.TEXTURE_3D);const Dn=bt(et,Oe),rn=Oe.source;n.bindTexture(En,et.__webglTexture,t.TEXTURE0+Bt);const wr=s.get(rn);if(rn.version!==wr.__version||Dn===!0){n.activeTexture(t.TEXTURE0+Bt);const cr=Js.getPrimaries(Js.workingColorSpace),Jn=Oe.colorSpace===T0?null:Js.getPrimaries(Oe.colorSpace),ir=Oe.colorSpace===T0||cr===Jn?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Oe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Oe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,ir);let bn=O(Oe.image,!1,l.maxTextureSize);bn=Qn(Oe,bn);const In=u.convert(Oe.format,Oe.colorSpace),Zr=u.convert(Oe.type);let Vr=W(Oe.internalFormat,In,Zr,Oe.colorSpace,Oe.isVideoTexture);st(En,Oe);let qn;const Kn=Oe.mipmaps,St=Oe.isVideoTexture!==!0,Gn=wr.__version===void 0||Dn===!0,er=rn.dataReady,gr=ne(Oe,bn);if(Oe.isDepthTexture)Vr=K(Oe.format===Gw,Oe.type),Gn&&(St?n.texStorage2D(t.TEXTURE_2D,1,Vr,bn.width,bn.height):n.texImage2D(t.TEXTURE_2D,0,Vr,bn.width,bn.height,0,In,Zr,null));else if(Oe.isDataTexture)if(Kn.length>0){St&&Gn&&n.texStorage2D(t.TEXTURE_2D,gr,Vr,Kn[0].width,Kn[0].height);for(let nr=0,ln=Kn.length;nr<ln;nr++)qn=Kn[nr],St?er&&n.texSubImage2D(t.TEXTURE_2D,nr,0,0,qn.width,qn.height,In,Zr,qn.data):n.texImage2D(t.TEXTURE_2D,nr,Vr,qn.width,qn.height,0,In,Zr,qn.data);Oe.generateMipmaps=!1}else St?(Gn&&n.texStorage2D(t.TEXTURE_2D,gr,Vr,bn.width,bn.height),er&&Vt(Oe,bn,In,Zr)):n.texImage2D(t.TEXTURE_2D,0,Vr,bn.width,bn.height,0,In,Zr,bn.data);else if(Oe.isCompressedTexture)if(Oe.isCompressedArrayTexture){St&&Gn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,gr,Vr,Kn[0].width,Kn[0].height,bn.depth);for(let nr=0,ln=Kn.length;nr<ln;nr++)if(qn=Kn[nr],Oe.format!==uf)if(In!==null)if(St){if(er)if(Oe.layerUpdates.size>0){const Tr=o8(qn.width,qn.height,Oe.format,Oe.type);for(const ni of Oe.layerUpdates){const Yi=qn.data.subarray(ni*Tr/qn.data.BYTES_PER_ELEMENT,(ni+1)*Tr/qn.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,nr,0,0,ni,qn.width,qn.height,1,In,Yi)}Oe.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,nr,0,0,0,qn.width,qn.height,bn.depth,In,qn.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,nr,Vr,qn.width,qn.height,bn.depth,0,qn.data,0,0);else us("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else St?er&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,nr,0,0,0,qn.width,qn.height,bn.depth,In,Zr,qn.data):n.texImage3D(t.TEXTURE_2D_ARRAY,nr,Vr,qn.width,qn.height,bn.depth,0,In,Zr,qn.data)}else{St&&Gn&&n.texStorage2D(t.TEXTURE_2D,gr,Vr,Kn[0].width,Kn[0].height);for(let nr=0,ln=Kn.length;nr<ln;nr++)qn=Kn[nr],Oe.format!==uf?In!==null?St?er&&n.compressedTexSubImage2D(t.TEXTURE_2D,nr,0,0,qn.width,qn.height,In,qn.data):n.compressedTexImage2D(t.TEXTURE_2D,nr,Vr,qn.width,qn.height,0,qn.data):us("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):St?er&&n.texSubImage2D(t.TEXTURE_2D,nr,0,0,qn.width,qn.height,In,Zr,qn.data):n.texImage2D(t.TEXTURE_2D,nr,Vr,qn.width,qn.height,0,In,Zr,qn.data)}else if(Oe.isDataArrayTexture)if(St){if(Gn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,gr,Vr,bn.width,bn.height,bn.depth),er)if(Oe.layerUpdates.size>0){const nr=o8(bn.width,bn.height,Oe.format,Oe.type);for(const ln of Oe.layerUpdates){const Tr=bn.data.subarray(ln*nr/bn.data.BYTES_PER_ELEMENT,(ln+1)*nr/bn.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,ln,bn.width,bn.height,1,In,Zr,Tr)}Oe.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,bn.width,bn.height,bn.depth,In,Zr,bn.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Vr,bn.width,bn.height,bn.depth,0,In,Zr,bn.data);else if(Oe.isData3DTexture)St?(Gn&&n.texStorage3D(t.TEXTURE_3D,gr,Vr,bn.width,bn.height,bn.depth),er&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,bn.width,bn.height,bn.depth,In,Zr,bn.data)):n.texImage3D(t.TEXTURE_3D,0,Vr,bn.width,bn.height,bn.depth,0,In,Zr,bn.data);else if(Oe.isFramebufferTexture){if(Gn)if(St)n.texStorage2D(t.TEXTURE_2D,gr,Vr,bn.width,bn.height);else{let nr=bn.width,ln=bn.height;for(let Tr=0;Tr<gr;Tr++)n.texImage2D(t.TEXTURE_2D,Tr,Vr,nr,ln,0,In,Zr,null),nr>>=1,ln>>=1}}else if(Kn.length>0){if(St&&Gn){const nr=Nt(Kn[0]);n.texStorage2D(t.TEXTURE_2D,gr,Vr,nr.width,nr.height)}for(let nr=0,ln=Kn.length;nr<ln;nr++)qn=Kn[nr],St?er&&n.texSubImage2D(t.TEXTURE_2D,nr,0,0,In,Zr,qn):n.texImage2D(t.TEXTURE_2D,nr,Vr,In,Zr,qn);Oe.generateMipmaps=!1}else if(St){if(Gn){const nr=Nt(bn);n.texStorage2D(t.TEXTURE_2D,gr,Vr,nr.width,nr.height)}er&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,In,Zr,bn)}else n.texImage2D(t.TEXTURE_2D,0,Vr,In,Zr,bn);F(Oe)&&U(En),wr.__version=rn.version,Oe.onUpdate&&Oe.onUpdate(Oe)}et.__version=Oe.version}function vt(et,Oe,Bt){if(Oe.image.length!==6)return;const En=bt(et,Oe),Dn=Oe.source;n.bindTexture(t.TEXTURE_CUBE_MAP,et.__webglTexture,t.TEXTURE0+Bt);const rn=s.get(Dn);if(Dn.version!==rn.__version||En===!0){n.activeTexture(t.TEXTURE0+Bt);const wr=Js.getPrimaries(Js.workingColorSpace),cr=Oe.colorSpace===T0?null:Js.getPrimaries(Oe.colorSpace),Jn=Oe.colorSpace===T0||wr===cr?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Oe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Oe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Jn);const ir=Oe.isCompressedTexture||Oe.image[0].isCompressedTexture,bn=Oe.image[0]&&Oe.image[0].isDataTexture,In=[];for(let ln=0;ln<6;ln++)!ir&&!bn?In[ln]=O(Oe.image[ln],!0,l.maxCubemapSize):In[ln]=bn?Oe.image[ln].image:Oe.image[ln],In[ln]=Qn(Oe,In[ln]);const Zr=In[0],Vr=u.convert(Oe.format,Oe.colorSpace),qn=u.convert(Oe.type),Kn=W(Oe.internalFormat,Vr,qn,Oe.colorSpace),St=Oe.isVideoTexture!==!0,Gn=rn.__version===void 0||En===!0,er=Dn.dataReady;let gr=ne(Oe,Zr);st(t.TEXTURE_CUBE_MAP,Oe);let nr;if(ir){St&&Gn&&n.texStorage2D(t.TEXTURE_CUBE_MAP,gr,Kn,Zr.width,Zr.height);for(let ln=0;ln<6;ln++){nr=In[ln].mipmaps;for(let Tr=0;Tr<nr.length;Tr++){const ni=nr[Tr];Oe.format!==uf?Vr!==null?St?er&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr,0,0,ni.width,ni.height,Vr,ni.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr,Kn,ni.width,ni.height,0,ni.data):us("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):St?er&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr,0,0,ni.width,ni.height,Vr,qn,ni.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr,Kn,ni.width,ni.height,0,Vr,qn,ni.data)}}}else{if(nr=Oe.mipmaps,St&&Gn){nr.length>0&&gr++;const ln=Nt(In[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,gr,Kn,ln.width,ln.height)}for(let ln=0;ln<6;ln++)if(bn){St?er&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,0,0,0,In[ln].width,In[ln].height,Vr,qn,In[ln].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,0,Kn,In[ln].width,In[ln].height,0,Vr,qn,In[ln].data);for(let Tr=0;Tr<nr.length;Tr++){const Yi=nr[Tr].image[ln].image;St?er&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr+1,0,0,Yi.width,Yi.height,Vr,qn,Yi.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr+1,Kn,Yi.width,Yi.height,0,Vr,qn,Yi.data)}}else{St?er&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,0,0,0,Vr,qn,In[ln]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,0,Kn,Vr,qn,In[ln]);for(let Tr=0;Tr<nr.length;Tr++){const ni=nr[Tr];St?er&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr+1,0,0,Vr,qn,ni.image[ln]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ln,Tr+1,Kn,Vr,qn,ni.image[ln])}}}F(Oe)&&U(t.TEXTURE_CUBE_MAP),rn.__version=Dn.version,Oe.onUpdate&&Oe.onUpdate(Oe)}et.__version=Oe.version}function qt(et,Oe,Bt,En,Dn,rn){const wr=u.convert(Bt.format,Bt.colorSpace),cr=u.convert(Bt.type),Jn=W(Bt.internalFormat,wr,cr,Bt.colorSpace),ir=s.get(Oe),bn=s.get(Bt);if(bn.__renderTarget=Oe,!ir.__hasExternalTextures){const In=Math.max(1,Oe.width>>rn),Zr=Math.max(1,Oe.height>>rn);Dn===t.TEXTURE_3D||Dn===t.TEXTURE_2D_ARRAY?n.texImage3D(Dn,rn,Jn,In,Zr,Oe.depth,0,wr,cr,null):n.texImage2D(Dn,rn,Jn,In,Zr,0,wr,cr,null)}n.bindFramebuffer(t.FRAMEBUFFER,et),Nn(Oe)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,En,Dn,bn.__webglTexture,0,wn(Oe)):(Dn===t.TEXTURE_2D||Dn>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Dn<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,En,Dn,bn.__webglTexture,rn),n.bindFramebuffer(t.FRAMEBUFFER,null)}function kt(et,Oe,Bt){if(t.bindRenderbuffer(t.RENDERBUFFER,et),Oe.depthBuffer){const En=Oe.depthTexture,Dn=En&&En.isDepthTexture?En.type:null,rn=K(Oe.stencilBuffer,Dn),wr=Oe.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,cr=wn(Oe);Nn(Oe)?r.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,cr,rn,Oe.width,Oe.height):Bt?t.renderbufferStorageMultisample(t.RENDERBUFFER,cr,rn,Oe.width,Oe.height):t.renderbufferStorage(t.RENDERBUFFER,rn,Oe.width,Oe.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,wr,t.RENDERBUFFER,et)}else{const En=Oe.textures;for(let Dn=0;Dn<En.length;Dn++){const rn=En[Dn],wr=u.convert(rn.format,rn.colorSpace),cr=u.convert(rn.type),Jn=W(rn.internalFormat,wr,cr,rn.colorSpace),ir=wn(Oe);Bt&&Nn(Oe)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ir,Jn,Oe.width,Oe.height):Nn(Oe)?r.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ir,Jn,Oe.width,Oe.height):t.renderbufferStorage(t.RENDERBUFFER,Jn,Oe.width,Oe.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function on(et,Oe){if(Oe&&Oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,et),!(Oe.depthTexture&&Oe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const En=s.get(Oe.depthTexture);En.__renderTarget=Oe,(!En.__webglTexture||Oe.depthTexture.image.width!==Oe.width||Oe.depthTexture.image.height!==Oe.height)&&(Oe.depthTexture.image.width=Oe.width,Oe.depthTexture.image.height=Oe.height,Oe.depthTexture.needsUpdate=!0),ke(Oe.depthTexture,0);const Dn=En.__webglTexture,rn=wn(Oe);if(Oe.depthTexture.format===Hw)Nn(Oe)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Dn,0,rn):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Dn,0);else if(Oe.depthTexture.format===Gw)Nn(Oe)?r.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Dn,0,rn):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Dn,0);else throw new Error("Unknown depthTexture format")}function mn(et){const Oe=s.get(et),Bt=et.isWebGLCubeRenderTarget===!0;if(Oe.__boundDepthTexture!==et.depthTexture){const En=et.depthTexture;if(Oe.__depthDisposeCallback&&Oe.__depthDisposeCallback(),En){const Dn=()=>{delete Oe.__boundDepthTexture,delete Oe.__depthDisposeCallback,En.removeEventListener("dispose",Dn)};En.addEventListener("dispose",Dn),Oe.__depthDisposeCallback=Dn}Oe.__boundDepthTexture=En}if(et.depthTexture&&!Oe.__autoAllocateDepthBuffer){if(Bt)throw new Error("target.depthTexture not supported in Cube render targets");const En=et.texture.mipmaps;En&&En.length>0?on(Oe.__webglFramebuffer[0],et):on(Oe.__webglFramebuffer,et)}else if(Bt){Oe.__webglDepthbuffer=[];for(let En=0;En<6;En++)if(n.bindFramebuffer(t.FRAMEBUFFER,Oe.__webglFramebuffer[En]),Oe.__webglDepthbuffer[En]===void 0)Oe.__webglDepthbuffer[En]=t.createRenderbuffer(),kt(Oe.__webglDepthbuffer[En],et,!1);else{const Dn=et.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,rn=Oe.__webglDepthbuffer[En];t.bindRenderbuffer(t.RENDERBUFFER,rn),t.framebufferRenderbuffer(t.FRAMEBUFFER,Dn,t.RENDERBUFFER,rn)}}else{const En=et.texture.mipmaps;if(En&&En.length>0?n.bindFramebuffer(t.FRAMEBUFFER,Oe.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,Oe.__webglFramebuffer),Oe.__webglDepthbuffer===void 0)Oe.__webglDepthbuffer=t.createRenderbuffer(),kt(Oe.__webglDepthbuffer,et,!1);else{const Dn=et.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,rn=Oe.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,rn),t.framebufferRenderbuffer(t.FRAMEBUFFER,Dn,t.RENDERBUFFER,rn)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Hr(et,Oe,Bt){const En=s.get(et);Oe!==void 0&&qt(En.__webglFramebuffer,et,et.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Bt!==void 0&&mn(et)}function Un(et){const Oe=et.texture,Bt=s.get(et),En=s.get(Oe);et.addEventListener("dispose",re);const Dn=et.textures,rn=et.isWebGLCubeRenderTarget===!0,wr=Dn.length>1;if(wr||(En.__webglTexture===void 0&&(En.__webglTexture=t.createTexture()),En.__version=Oe.version,p.memory.textures++),rn){Bt.__webglFramebuffer=[];for(let cr=0;cr<6;cr++)if(Oe.mipmaps&&Oe.mipmaps.length>0){Bt.__webglFramebuffer[cr]=[];for(let Jn=0;Jn<Oe.mipmaps.length;Jn++)Bt.__webglFramebuffer[cr][Jn]=t.createFramebuffer()}else Bt.__webglFramebuffer[cr]=t.createFramebuffer()}else{if(Oe.mipmaps&&Oe.mipmaps.length>0){Bt.__webglFramebuffer=[];for(let cr=0;cr<Oe.mipmaps.length;cr++)Bt.__webglFramebuffer[cr]=t.createFramebuffer()}else Bt.__webglFramebuffer=t.createFramebuffer();if(wr)for(let cr=0,Jn=Dn.length;cr<Jn;cr++){const ir=s.get(Dn[cr]);ir.__webglTexture===void 0&&(ir.__webglTexture=t.createTexture(),p.memory.textures++)}if(et.samples>0&&Nn(et)===!1){Bt.__webglMultisampledFramebuffer=t.createFramebuffer(),Bt.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,Bt.__webglMultisampledFramebuffer);for(let cr=0;cr<Dn.length;cr++){const Jn=Dn[cr];Bt.__webglColorRenderbuffer[cr]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Bt.__webglColorRenderbuffer[cr]);const ir=u.convert(Jn.format,Jn.colorSpace),bn=u.convert(Jn.type),In=W(Jn.internalFormat,ir,bn,Jn.colorSpace,et.isXRRenderTarget===!0),Zr=wn(et);t.renderbufferStorageMultisample(t.RENDERBUFFER,Zr,In,et.width,et.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+cr,t.RENDERBUFFER,Bt.__webglColorRenderbuffer[cr])}t.bindRenderbuffer(t.RENDERBUFFER,null),et.depthBuffer&&(Bt.__webglDepthRenderbuffer=t.createRenderbuffer(),kt(Bt.__webglDepthRenderbuffer,et,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(rn){n.bindTexture(t.TEXTURE_CUBE_MAP,En.__webglTexture),st(t.TEXTURE_CUBE_MAP,Oe);for(let cr=0;cr<6;cr++)if(Oe.mipmaps&&Oe.mipmaps.length>0)for(let Jn=0;Jn<Oe.mipmaps.length;Jn++)qt(Bt.__webglFramebuffer[cr][Jn],et,Oe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+cr,Jn);else qt(Bt.__webglFramebuffer[cr],et,Oe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+cr,0);F(Oe)&&U(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(wr){for(let cr=0,Jn=Dn.length;cr<Jn;cr++){const ir=Dn[cr],bn=s.get(ir);let In=t.TEXTURE_2D;(et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(In=et.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(In,bn.__webglTexture),st(In,ir),qt(Bt.__webglFramebuffer,et,ir,t.COLOR_ATTACHMENT0+cr,In,0),F(ir)&&U(In)}n.unbindTexture()}else{let cr=t.TEXTURE_2D;if((et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(cr=et.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(cr,En.__webglTexture),st(cr,Oe),Oe.mipmaps&&Oe.mipmaps.length>0)for(let Jn=0;Jn<Oe.mipmaps.length;Jn++)qt(Bt.__webglFramebuffer[Jn],et,Oe,t.COLOR_ATTACHMENT0,cr,Jn);else qt(Bt.__webglFramebuffer,et,Oe,t.COLOR_ATTACHMENT0,cr,0);F(Oe)&&U(cr),n.unbindTexture()}et.depthBuffer&&mn(et)}function $r(et){const Oe=et.textures;for(let Bt=0,En=Oe.length;Bt<En;Bt++){const Dn=Oe[Bt];if(F(Dn)){const rn=X(et),wr=s.get(Dn).__webglTexture;n.bindTexture(rn,wr),U(rn),n.unbindTexture()}}}const ht=[],Lr=[];function Br(et){if(et.samples>0){if(Nn(et)===!1){const Oe=et.textures,Bt=et.width,En=et.height;let Dn=t.COLOR_BUFFER_BIT;const rn=et.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,wr=s.get(et),cr=Oe.length>1;if(cr)for(let ir=0;ir<Oe.length;ir++)n.bindFramebuffer(t.FRAMEBUFFER,wr.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ir,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,wr.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ir,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,wr.__webglMultisampledFramebuffer);const Jn=et.texture.mipmaps;Jn&&Jn.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,wr.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,wr.__webglFramebuffer);for(let ir=0;ir<Oe.length;ir++){if(et.resolveDepthBuffer&&(et.depthBuffer&&(Dn|=t.DEPTH_BUFFER_BIT),et.stencilBuffer&&et.resolveStencilBuffer&&(Dn|=t.STENCIL_BUFFER_BIT)),cr){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,wr.__webglColorRenderbuffer[ir]);const bn=s.get(Oe[ir]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,bn,0)}t.blitFramebuffer(0,0,Bt,En,0,0,Bt,En,Dn,t.NEAREST),v===!0&&(ht.length=0,Lr.length=0,ht.push(t.COLOR_ATTACHMENT0+ir),et.depthBuffer&&et.resolveDepthBuffer===!1&&(ht.push(rn),Lr.push(rn),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Lr)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,ht))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),cr)for(let ir=0;ir<Oe.length;ir++){n.bindFramebuffer(t.FRAMEBUFFER,wr.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ir,t.RENDERBUFFER,wr.__webglColorRenderbuffer[ir]);const bn=s.get(Oe[ir]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,wr.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ir,t.TEXTURE_2D,bn,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,wr.__webglMultisampledFramebuffer)}else if(et.depthBuffer&&et.resolveDepthBuffer===!1&&v){const Oe=et.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[Oe])}}}function wn(et){return Math.min(l.maxSamples,et.samples)}function Nn(et){const Oe=s.get(et);return et.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Oe.__useRenderToTexture!==!1}function mr(et){const Oe=p.render.frame;E.get(et)!==Oe&&(E.set(et,Oe),et.update())}function Qn(et,Oe){const Bt=et.colorSpace,En=et.format,Dn=et.type;return et.isCompressedTexture===!0||et.isVideoTexture===!0||Bt!==lb&&Bt!==T0&&(Js.getTransfer(Bt)===fo?(En!==uf||Dn!==og)&&us("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):xa("WebGLTextures: Unsupported texture color space:",Bt)),Oe}function Nt(et){return typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement?(w.width=et.naturalWidth||et.width,w.height=et.naturalHeight||et.height):typeof VideoFrame<"u"&&et instanceof VideoFrame?(w.width=et.displayWidth,w.height=et.displayHeight):(w.width=et.width,w.height=et.height),w}this.allocateTextureUnit=Me,this.resetTextureUnits=Ce,this.setTexture2D=ke,this.setTexture2DArray=je,this.setTexture3D=$e,this.setTextureCube=Ae,this.rebindTextures=Hr,this.setupRenderTarget=Un,this.updateRenderTargetMipmap=$r,this.updateMultisampleRenderTarget=Br,this.setupDepthRenderbuffer=mn,this.setupFrameBufferTexture=qt,this.useMultisampledRTT=Nn}function SAe(t,e){function n(s,l=T0){let u;const p=Js.getTransfer(l);if(s===og)return t.UNSIGNED_BYTE;if(s===zN)return t.UNSIGNED_SHORT_4_4_4_4;if(s===UN)return t.UNSIGNED_SHORT_5_5_5_1;if(s===uq)return t.UNSIGNED_INT_5_9_9_9_REV;if(s===dq)return t.UNSIGNED_INT_10F_11F_11F_REV;if(s===lq)return t.BYTE;if(s===cq)return t.SHORT;if(s===Uw)return t.UNSIGNED_SHORT;if(s===BN)return t.INT;if(s===Gx)return t.UNSIGNED_INT;if(s===Hm)return t.FLOAT;if(s===Eb)return t.HALF_FLOAT;if(s===hq)return t.ALPHA;if(s===fq)return t.RGB;if(s===uf)return t.RGBA;if(s===Hw)return t.DEPTH_COMPONENT;if(s===Gw)return t.DEPTH_STENCIL;if(s===pq)return t.RED;if(s===VN)return t.RED_INTEGER;if(s===HN)return t.RG;if(s===GN)return t.RG_INTEGER;if(s===$N)return t.RGBA_INTEGER;if(s===eE||s===tE||s===nE||s===rE)if(p===fo)if(u=e.get("WEBGL_compressed_texture_s3tc_srgb"),u!==null){if(s===eE)return u.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===tE)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===nE)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===rE)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(u=e.get("WEBGL_compressed_texture_s3tc"),u!==null){if(s===eE)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===tE)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===nE)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===rE)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===RI||s===NI||s===jI||s===DI)if(u=e.get("WEBGL_compressed_texture_pvrtc"),u!==null){if(s===RI)return u.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===NI)return u.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===jI)return u.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===DI)return u.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===LI||s===OI||s===FI)if(u=e.get("WEBGL_compressed_texture_etc"),u!==null){if(s===LI||s===OI)return p===fo?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(s===FI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===BI||s===zI||s===UI||s===VI||s===HI||s===GI||s===$I||s===WI||s===qI||s===XI||s===ZI||s===QI||s===KI||s===YI)if(u=e.get("WEBGL_compressed_texture_astc"),u!==null){if(s===BI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:u.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===zI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:u.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===UI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:u.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===VI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:u.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===HI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:u.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===GI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:u.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===$I)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:u.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===WI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:u.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===qI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:u.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===XI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:u.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===ZI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:u.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===QI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:u.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===KI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:u.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===YI)return p===fo?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:u.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===JI||s===eP||s===tP)if(u=e.get("EXT_texture_compression_bptc"),u!==null){if(s===JI)return p===fo?u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:u.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===eP)return u.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===tP)return u.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===nP||s===rP||s===iP||s===sP)if(u=e.get("EXT_texture_compression_rgtc"),u!==null){if(s===nP)return u.COMPRESSED_RED_RGTC1_EXT;if(s===rP)return u.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===iP)return u.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===sP)return u.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Vw?t.UNSIGNED_INT_24_8:t[s]!==void 0?t[s]:null}return{convert:n}}const TAe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,EAe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class AAe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n){if(this.texture===null){const s=new kq(e.texture);(e.depthNear!==n.depthNear||e.depthFar!==n.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,s=new lg({vertexShader:TAe,fragmentShader:EAe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new q0(new e3(20,20),s)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class CAe extends Ab{constructor(e,n){super();const s=this;let l=null,u=1,p=null,r="local-floor",v=1,w=null,E=null,T=null,k=null,R=null,D=null;const O=typeof XRWebGLBinding<"u",F=new AAe,U={},X=n.getContextAttributes();let W=null,K=null;const ne=[],te=[],re=new po;let xe=null;const ae=new Jd;ae.viewport=new _a;const ce=new Jd;ce.viewport=new _a;const ye=[ae,ce],Ce=new Wwe;let Me=null,Ke=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(_t){let vt=ne[_t];return vt===void 0&&(vt=new _5,ne[_t]=vt),vt.getTargetRaySpace()},this.getControllerGrip=function(_t){let vt=ne[_t];return vt===void 0&&(vt=new _5,ne[_t]=vt),vt.getGripSpace()},this.getHand=function(_t){let vt=ne[_t];return vt===void 0&&(vt=new _5,ne[_t]=vt),vt.getHandSpace()};function ke(_t){const vt=te.indexOf(_t.inputSource);if(vt===-1)return;const qt=ne[vt];qt!==void 0&&(qt.update(_t.inputSource,_t.frame,w||p),qt.dispatchEvent({type:_t.type,data:_t.inputSource}))}function je(){l.removeEventListener("select",ke),l.removeEventListener("selectstart",ke),l.removeEventListener("selectend",ke),l.removeEventListener("squeeze",ke),l.removeEventListener("squeezestart",ke),l.removeEventListener("squeezeend",ke),l.removeEventListener("end",je),l.removeEventListener("inputsourceschange",$e);for(let _t=0;_t<ne.length;_t++){const vt=te[_t];vt!==null&&(te[_t]=null,ne[_t].disconnect(vt))}Me=null,Ke=null,F.reset();for(const _t in U)delete U[_t];e.setRenderTarget(W),R=null,k=null,T=null,l=null,K=null,Vt.stop(),s.isPresenting=!1,e.setPixelRatio(xe),e.setSize(re.width,re.height,!1),s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(_t){u=_t,s.isPresenting===!0&&us("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(_t){r=_t,s.isPresenting===!0&&us("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return w||p},this.setReferenceSpace=function(_t){w=_t},this.getBaseLayer=function(){return k!==null?k:R},this.getBinding=function(){return T===null&&O&&(T=new XRWebGLBinding(l,n)),T},this.getFrame=function(){return D},this.getSession=function(){return l},this.setSession=async function(_t){if(l=_t,l!==null){if(W=e.getRenderTarget(),l.addEventListener("select",ke),l.addEventListener("selectstart",ke),l.addEventListener("selectend",ke),l.addEventListener("squeeze",ke),l.addEventListener("squeezestart",ke),l.addEventListener("squeezeend",ke),l.addEventListener("end",je),l.addEventListener("inputsourceschange",$e),X.xrCompatible!==!0&&await n.makeXRCompatible(),xe=e.getPixelRatio(),e.getSize(re),O&&"createProjectionLayer"in XRWebGLBinding.prototype){let qt=null,kt=null,on=null;X.depth&&(on=X.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,qt=X.stencil?Gw:Hw,kt=X.stencil?Vw:Gx);const mn={colorFormat:n.RGBA8,depthFormat:on,scaleFactor:u};T=this.getBinding(),k=T.createProjectionLayer(mn),l.updateRenderState({layers:[k]}),e.setPixelRatio(1),e.setSize(k.textureWidth,k.textureHeight,!1),K=new $x(k.textureWidth,k.textureHeight,{format:uf,type:og,depthTexture:new Mq(k.textureWidth,k.textureHeight,kt,void 0,void 0,void 0,void 0,void 0,void 0,qt),stencilBuffer:X.stencil,colorSpace:e.outputColorSpace,samples:X.antialias?4:0,resolveDepthBuffer:k.ignoreDepthValues===!1,resolveStencilBuffer:k.ignoreDepthValues===!1})}else{const qt={antialias:X.antialias,alpha:!0,depth:X.depth,stencil:X.stencil,framebufferScaleFactor:u};R=new XRWebGLLayer(l,n,qt),l.updateRenderState({baseLayer:R}),e.setPixelRatio(1),e.setSize(R.framebufferWidth,R.framebufferHeight,!1),K=new $x(R.framebufferWidth,R.framebufferHeight,{format:uf,type:og,colorSpace:e.outputColorSpace,stencilBuffer:X.stencil,resolveDepthBuffer:R.ignoreDepthValues===!1,resolveStencilBuffer:R.ignoreDepthValues===!1})}K.isXRRenderTarget=!0,this.setFoveation(v),w=null,p=await l.requestReferenceSpace(r),Vt.setContext(l),Vt.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(l!==null)return l.environmentBlendMode},this.getDepthTexture=function(){return F.getDepthTexture()};function $e(_t){for(let vt=0;vt<_t.removed.length;vt++){const qt=_t.removed[vt],kt=te.indexOf(qt);kt>=0&&(te[kt]=null,ne[kt].disconnect(qt))}for(let vt=0;vt<_t.added.length;vt++){const qt=_t.added[vt];let kt=te.indexOf(qt);if(kt===-1){for(let mn=0;mn<ne.length;mn++)if(mn>=te.length){te.push(qt),kt=mn;break}else if(te[mn]===null){te[mn]=qt,kt=mn;break}if(kt===-1)break}const on=ne[kt];on&&on.connect(qt)}}const Ae=new Ln,He=new Ln;function qe(_t,vt,qt){Ae.setFromMatrixPosition(vt.matrixWorld),He.setFromMatrixPosition(qt.matrixWorld);const kt=Ae.distanceTo(He),on=vt.projectionMatrix.elements,mn=qt.projectionMatrix.elements,Hr=on[14]/(on[10]-1),Un=on[14]/(on[10]+1),$r=(on[9]+1)/on[5],ht=(on[9]-1)/on[5],Lr=(on[8]-1)/on[0],Br=(mn[8]+1)/mn[0],wn=Hr*Lr,Nn=Hr*Br,mr=kt/(-Lr+Br),Qn=mr*-Lr;if(vt.matrixWorld.decompose(_t.position,_t.quaternion,_t.scale),_t.translateX(Qn),_t.translateZ(mr),_t.matrixWorld.compose(_t.position,_t.quaternion,_t.scale),_t.matrixWorldInverse.copy(_t.matrixWorld).invert(),on[10]===-1)_t.projectionMatrix.copy(vt.projectionMatrix),_t.projectionMatrixInverse.copy(vt.projectionMatrixInverse);else{const Nt=Hr+mr,et=Un+mr,Oe=wn-Qn,Bt=Nn+(kt-Qn),En=$r*Un/et*Nt,Dn=ht*Un/et*Nt;_t.projectionMatrix.makePerspective(Oe,Bt,En,Dn,Nt,et),_t.projectionMatrixInverse.copy(_t.projectionMatrix).invert()}}function Le(_t,vt){vt===null?_t.matrixWorld.copy(_t.matrix):_t.matrixWorld.multiplyMatrices(vt.matrixWorld,_t.matrix),_t.matrixWorldInverse.copy(_t.matrixWorld).invert()}this.updateCamera=function(_t){if(l===null)return;let vt=_t.near,qt=_t.far;F.texture!==null&&(F.depthNear>0&&(vt=F.depthNear),F.depthFar>0&&(qt=F.depthFar)),Ce.near=ce.near=ae.near=vt,Ce.far=ce.far=ae.far=qt,(Me!==Ce.near||Ke!==Ce.far)&&(l.updateRenderState({depthNear:Ce.near,depthFar:Ce.far}),Me=Ce.near,Ke=Ce.far),Ce.layers.mask=_t.layers.mask|6,ae.layers.mask=Ce.layers.mask&3,ce.layers.mask=Ce.layers.mask&5;const kt=_t.parent,on=Ce.cameras;Le(Ce,kt);for(let mn=0;mn<on.length;mn++)Le(on[mn],kt);on.length===2?qe(Ce,ae,ce):Ce.projectionMatrix.copy(ae.projectionMatrix),st(_t,Ce,kt)};function st(_t,vt,qt){qt===null?_t.matrix.copy(vt.matrixWorld):(_t.matrix.copy(qt.matrixWorld),_t.matrix.invert(),_t.matrix.multiply(vt.matrixWorld)),_t.matrix.decompose(_t.position,_t.quaternion,_t.scale),_t.updateMatrixWorld(!0),_t.projectionMatrix.copy(vt.projectionMatrix),_t.projectionMatrixInverse.copy(vt.projectionMatrixInverse),_t.isPerspectiveCamera&&(_t.fov=oP*2*Math.atan(1/_t.projectionMatrix.elements[5]),_t.zoom=1)}this.getCamera=function(){return Ce},this.getFoveation=function(){if(!(k===null&&R===null))return v},this.setFoveation=function(_t){v=_t,k!==null&&(k.fixedFoveation=_t),R!==null&&R.fixedFoveation!==void 0&&(R.fixedFoveation=_t)},this.hasDepthSensing=function(){return F.texture!==null},this.getDepthSensingMesh=function(){return F.getMesh(Ce)},this.getCameraTexture=function(_t){return U[_t]};let bt=null;function yt(_t,vt){if(E=vt.getViewerPose(w||p),D=vt,E!==null){const qt=E.views;R!==null&&(e.setRenderTargetFramebuffer(K,R.framebuffer),e.setRenderTarget(K));let kt=!1;qt.length!==Ce.cameras.length&&(Ce.cameras.length=0,kt=!0);for(let Un=0;Un<qt.length;Un++){const $r=qt[Un];let ht=null;if(R!==null)ht=R.getViewport($r);else{const Br=T.getViewSubImage(k,$r);ht=Br.viewport,Un===0&&(e.setRenderTargetTextures(K,Br.colorTexture,Br.depthStencilTexture),e.setRenderTarget(K))}let Lr=ye[Un];Lr===void 0&&(Lr=new Jd,Lr.layers.enable(Un),Lr.viewport=new _a,ye[Un]=Lr),Lr.matrix.fromArray($r.transform.matrix),Lr.matrix.decompose(Lr.position,Lr.quaternion,Lr.scale),Lr.projectionMatrix.fromArray($r.projectionMatrix),Lr.projectionMatrixInverse.copy(Lr.projectionMatrix).invert(),Lr.viewport.set(ht.x,ht.y,ht.width,ht.height),Un===0&&(Ce.matrix.copy(Lr.matrix),Ce.matrix.decompose(Ce.position,Ce.quaternion,Ce.scale)),kt===!0&&Ce.cameras.push(Lr)}const on=l.enabledFeatures;if(on&&on.includes("depth-sensing")&&l.depthUsage=="gpu-optimized"&&O){T=s.getBinding();const Un=T.getDepthInformation(qt[0]);Un&&Un.isValid&&Un.texture&&F.init(Un,l.renderState)}if(on&&on.includes("camera-access")&&O){e.state.unbindTexture(),T=s.getBinding();for(let Un=0;Un<qt.length;Un++){const $r=qt[Un].camera;if($r){let ht=U[$r];ht||(ht=new kq,U[$r]=ht);const Lr=T.getCameraImage($r);ht.sourceTexture=Lr}}}}for(let qt=0;qt<ne.length;qt++){const kt=te[qt],on=ne[qt];kt!==null&&on!==void 0&&on.update(kt,vt,w||p)}bt&&bt(_t,vt),vt.detectedPlanes&&s.dispatchEvent({type:"planesdetected",data:vt}),D=null}const Vt=new Iq;Vt.setAnimationLoop(yt),this.setAnimationLoop=function(_t){bt=_t},this.dispose=function(){}}}const $y=new ag,MAe=new Da;function kAe(t,e){function n(F,U){F.matrixAutoUpdate===!0&&F.updateMatrix(),U.value.copy(F.matrix)}function s(F,U){U.color.getRGB(F.fogColor.value,Tq(t)),U.isFog?(F.fogNear.value=U.near,F.fogFar.value=U.far):U.isFogExp2&&(F.fogDensity.value=U.density)}function l(F,U,X,W,K){U.isMeshBasicMaterial||U.isMeshLambertMaterial?u(F,U):U.isMeshToonMaterial?(u(F,U),T(F,U)):U.isMeshPhongMaterial?(u(F,U),E(F,U)):U.isMeshStandardMaterial?(u(F,U),k(F,U),U.isMeshPhysicalMaterial&&R(F,U,K)):U.isMeshMatcapMaterial?(u(F,U),D(F,U)):U.isMeshDepthMaterial?u(F,U):U.isMeshDistanceMaterial?(u(F,U),O(F,U)):U.isMeshNormalMaterial?u(F,U):U.isLineBasicMaterial?(p(F,U),U.isLineDashedMaterial&&r(F,U)):U.isPointsMaterial?v(F,U,X,W):U.isSpriteMaterial?w(F,U):U.isShadowMaterial?(F.color.value.copy(U.color),F.opacity.value=U.opacity):U.isShaderMaterial&&(U.uniformsNeedUpdate=!1)}function u(F,U){F.opacity.value=U.opacity,U.color&&F.diffuse.value.copy(U.color),U.emissive&&F.emissive.value.copy(U.emissive).multiplyScalar(U.emissiveIntensity),U.map&&(F.map.value=U.map,n(U.map,F.mapTransform)),U.alphaMap&&(F.alphaMap.value=U.alphaMap,n(U.alphaMap,F.alphaMapTransform)),U.bumpMap&&(F.bumpMap.value=U.bumpMap,n(U.bumpMap,F.bumpMapTransform),F.bumpScale.value=U.bumpScale,U.side===wu&&(F.bumpScale.value*=-1)),U.normalMap&&(F.normalMap.value=U.normalMap,n(U.normalMap,F.normalMapTransform),F.normalScale.value.copy(U.normalScale),U.side===wu&&F.normalScale.value.negate()),U.displacementMap&&(F.displacementMap.value=U.displacementMap,n(U.displacementMap,F.displacementMapTransform),F.displacementScale.value=U.displacementScale,F.displacementBias.value=U.displacementBias),U.emissiveMap&&(F.emissiveMap.value=U.emissiveMap,n(U.emissiveMap,F.emissiveMapTransform)),U.specularMap&&(F.specularMap.value=U.specularMap,n(U.specularMap,F.specularMapTransform)),U.alphaTest>0&&(F.alphaTest.value=U.alphaTest);const X=e.get(U),W=X.envMap,K=X.envMapRotation;W&&(F.envMap.value=W,$y.copy(K),$y.x*=-1,$y.y*=-1,$y.z*=-1,W.isCubeTexture&&W.isRenderTargetTexture===!1&&($y.y*=-1,$y.z*=-1),F.envMapRotation.value.setFromMatrix4(MAe.makeRotationFromEuler($y)),F.flipEnvMap.value=W.isCubeTexture&&W.isRenderTargetTexture===!1?-1:1,F.reflectivity.value=U.reflectivity,F.ior.value=U.ior,F.refractionRatio.value=U.refractionRatio),U.lightMap&&(F.lightMap.value=U.lightMap,F.lightMapIntensity.value=U.lightMapIntensity,n(U.lightMap,F.lightMapTransform)),U.aoMap&&(F.aoMap.value=U.aoMap,F.aoMapIntensity.value=U.aoMapIntensity,n(U.aoMap,F.aoMapTransform))}function p(F,U){F.diffuse.value.copy(U.color),F.opacity.value=U.opacity,U.map&&(F.map.value=U.map,n(U.map,F.mapTransform))}function r(F,U){F.dashSize.value=U.dashSize,F.totalSize.value=U.dashSize+U.gapSize,F.scale.value=U.scale}function v(F,U,X,W){F.diffuse.value.copy(U.color),F.opacity.value=U.opacity,F.size.value=U.size*X,F.scale.value=W*.5,U.map&&(F.map.value=U.map,n(U.map,F.uvTransform)),U.alphaMap&&(F.alphaMap.value=U.alphaMap,n(U.alphaMap,F.alphaMapTransform)),U.alphaTest>0&&(F.alphaTest.value=U.alphaTest)}function w(F,U){F.diffuse.value.copy(U.color),F.opacity.value=U.opacity,F.rotation.value=U.rotation,U.map&&(F.map.value=U.map,n(U.map,F.mapTransform)),U.alphaMap&&(F.alphaMap.value=U.alphaMap,n(U.alphaMap,F.alphaMapTransform)),U.alphaTest>0&&(F.alphaTest.value=U.alphaTest)}function E(F,U){F.specular.value.copy(U.specular),F.shininess.value=Math.max(U.shininess,1e-4)}function T(F,U){U.gradientMap&&(F.gradientMap.value=U.gradientMap)}function k(F,U){F.metalness.value=U.metalness,U.metalnessMap&&(F.metalnessMap.value=U.metalnessMap,n(U.metalnessMap,F.metalnessMapTransform)),F.roughness.value=U.roughness,U.roughnessMap&&(F.roughnessMap.value=U.roughnessMap,n(U.roughnessMap,F.roughnessMapTransform)),U.envMap&&(F.envMapIntensity.value=U.envMapIntensity)}function R(F,U,X){F.ior.value=U.ior,U.sheen>0&&(F.sheenColor.value.copy(U.sheenColor).multiplyScalar(U.sheen),F.sheenRoughness.value=U.sheenRoughness,U.sheenColorMap&&(F.sheenColorMap.value=U.sheenColorMap,n(U.sheenColorMap,F.sheenColorMapTransform)),U.sheenRoughnessMap&&(F.sheenRoughnessMap.value=U.sheenRoughnessMap,n(U.sheenRoughnessMap,F.sheenRoughnessMapTransform))),U.clearcoat>0&&(F.clearcoat.value=U.clearcoat,F.clearcoatRoughness.value=U.clearcoatRoughness,U.clearcoatMap&&(F.clearcoatMap.value=U.clearcoatMap,n(U.clearcoatMap,F.clearcoatMapTransform)),U.clearcoatRoughnessMap&&(F.clearcoatRoughnessMap.value=U.clearcoatRoughnessMap,n(U.clearcoatRoughnessMap,F.clearcoatRoughnessMapTransform)),U.clearcoatNormalMap&&(F.clearcoatNormalMap.value=U.clearcoatNormalMap,n(U.clearcoatNormalMap,F.clearcoatNormalMapTransform),F.clearcoatNormalScale.value.copy(U.clearcoatNormalScale),U.side===wu&&F.clearcoatNormalScale.value.negate())),U.dispersion>0&&(F.dispersion.value=U.dispersion),U.iridescence>0&&(F.iridescence.value=U.iridescence,F.iridescenceIOR.value=U.iridescenceIOR,F.iridescenceThicknessMinimum.value=U.iridescenceThicknessRange[0],F.iridescenceThicknessMaximum.value=U.iridescenceThicknessRange[1],U.iridescenceMap&&(F.iridescenceMap.value=U.iridescenceMap,n(U.iridescenceMap,F.iridescenceMapTransform)),U.iridescenceThicknessMap&&(F.iridescenceThicknessMap.value=U.iridescenceThicknessMap,n(U.iridescenceThicknessMap,F.iridescenceThicknessMapTransform))),U.transmission>0&&(F.transmission.value=U.transmission,F.transmissionSamplerMap.value=X.texture,F.transmissionSamplerSize.value.set(X.width,X.height),U.transmissionMap&&(F.transmissionMap.value=U.transmissionMap,n(U.transmissionMap,F.transmissionMapTransform)),F.thickness.value=U.thickness,U.thicknessMap&&(F.thicknessMap.value=U.thicknessMap,n(U.thicknessMap,F.thicknessMapTransform)),F.attenuationDistance.value=U.attenuationDistance,F.attenuationColor.value.copy(U.attenuationColor)),U.anisotropy>0&&(F.anisotropyVector.value.set(U.anisotropy*Math.cos(U.anisotropyRotation),U.anisotropy*Math.sin(U.anisotropyRotation)),U.anisotropyMap&&(F.anisotropyMap.value=U.anisotropyMap,n(U.anisotropyMap,F.anisotropyMapTransform))),F.specularIntensity.value=U.specularIntensity,F.specularColor.value.copy(U.specularColor),U.specularColorMap&&(F.specularColorMap.value=U.specularColorMap,n(U.specularColorMap,F.specularColorMapTransform)),U.specularIntensityMap&&(F.specularIntensityMap.value=U.specularIntensityMap,n(U.specularIntensityMap,F.specularIntensityMapTransform))}function D(F,U){U.matcap&&(F.matcap.value=U.matcap)}function O(F,U){const X=e.get(U).light;F.referencePosition.value.setFromMatrixPosition(X.matrixWorld),F.nearDistance.value=X.shadow.camera.near,F.farDistance.value=X.shadow.camera.far}return{refreshFogUniforms:s,refreshMaterialUniforms:l}}function IAe(t,e,n,s){let l={},u={},p=[];const r=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function v(X,W){const K=W.program;s.uniformBlockBinding(X,K)}function w(X,W){let K=l[X.id];K===void 0&&(D(X),K=E(X),l[X.id]=K,X.addEventListener("dispose",F));const ne=W.program;s.updateUBOMapping(X,ne);const te=e.render.frame;u[X.id]!==te&&(k(X),u[X.id]=te)}function E(X){const W=T();X.__bindingPointIndex=W;const K=t.createBuffer(),ne=X.__size,te=X.usage;return t.bindBuffer(t.UNIFORM_BUFFER,K),t.bufferData(t.UNIFORM_BUFFER,ne,te),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,W,K),K}function T(){for(let X=0;X<r;X++)if(p.indexOf(X)===-1)return p.push(X),X;return xa("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function k(X){const W=l[X.id],K=X.uniforms,ne=X.__cache;t.bindBuffer(t.UNIFORM_BUFFER,W);for(let te=0,re=K.length;te<re;te++){const xe=Array.isArray(K[te])?K[te]:[K[te]];for(let ae=0,ce=xe.length;ae<ce;ae++){const ye=xe[ae];if(R(ye,te,ae,ne)===!0){const Ce=ye.__offset,Me=Array.isArray(ye.value)?ye.value:[ye.value];let Ke=0;for(let ke=0;ke<Me.length;ke++){const je=Me[ke],$e=O(je);typeof je=="number"||typeof je=="boolean"?(ye.__data[0]=je,t.bufferSubData(t.UNIFORM_BUFFER,Ce+Ke,ye.__data)):je.isMatrix3?(ye.__data[0]=je.elements[0],ye.__data[1]=je.elements[1],ye.__data[2]=je.elements[2],ye.__data[3]=0,ye.__data[4]=je.elements[3],ye.__data[5]=je.elements[4],ye.__data[6]=je.elements[5],ye.__data[7]=0,ye.__data[8]=je.elements[6],ye.__data[9]=je.elements[7],ye.__data[10]=je.elements[8],ye.__data[11]=0):(je.toArray(ye.__data,Ke),Ke+=$e.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,Ce,ye.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function R(X,W,K,ne){const te=X.value,re=W+"_"+K;if(ne[re]===void 0)return typeof te=="number"||typeof te=="boolean"?ne[re]=te:ne[re]=te.clone(),!0;{const xe=ne[re];if(typeof te=="number"||typeof te=="boolean"){if(xe!==te)return ne[re]=te,!0}else if(xe.equals(te)===!1)return xe.copy(te),!0}return!1}function D(X){const W=X.uniforms;let K=0;const ne=16;for(let re=0,xe=W.length;re<xe;re++){const ae=Array.isArray(W[re])?W[re]:[W[re]];for(let ce=0,ye=ae.length;ce<ye;ce++){const Ce=ae[ce],Me=Array.isArray(Ce.value)?Ce.value:[Ce.value];for(let Ke=0,ke=Me.length;Ke<ke;Ke++){const je=Me[Ke],$e=O(je),Ae=K%ne,He=Ae%$e.boundary,qe=Ae+He;K+=He,qe!==0&&ne-qe<$e.storage&&(K+=ne-qe),Ce.__data=new Float32Array($e.storage/Float32Array.BYTES_PER_ELEMENT),Ce.__offset=K,K+=$e.storage}}}const te=K%ne;return te>0&&(K+=ne-te),X.__size=K,X.__cache={},this}function O(X){const W={boundary:0,storage:0};return typeof X=="number"||typeof X=="boolean"?(W.boundary=4,W.storage=4):X.isVector2?(W.boundary=8,W.storage=8):X.isVector3||X.isColor?(W.boundary=16,W.storage=12):X.isVector4?(W.boundary=16,W.storage=16):X.isMatrix3?(W.boundary=48,W.storage=48):X.isMatrix4?(W.boundary=64,W.storage=64):X.isTexture?us("WebGLRenderer: Texture samplers can not be part of an uniforms group."):us("WebGLRenderer: Unsupported uniform value type.",X),W}function F(X){const W=X.target;W.removeEventListener("dispose",F);const K=p.indexOf(W.__bindingPointIndex);p.splice(K,1),t.deleteBuffer(l[W.id]),delete l[W.id],delete u[W.id]}function U(){for(const X in l)t.deleteBuffer(l[X]);p=[],l={},u={}}return{bind:v,update:w,dispose:U}}const PAe=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let Im=null;function RAe(){return Im===null&&(Im=new Bwe(PAe,32,32,HN,Eb),Im.minFilter=rh,Im.magFilter=rh,Im.wrapS=Vm,Im.wrapT=Vm,Im.generateMipmaps=!1,Im.needsUpdate=!0),Im}class NAe{constructor(e={}){const{canvas:n=dwe(),context:s=null,depth:l=!0,stencil:u=!1,alpha:p=!1,antialias:r=!1,premultipliedAlpha:v=!0,preserveDrawingBuffer:w=!1,powerPreference:E="default",failIfMajorPerformanceCaveat:T=!1,reversedDepthBuffer:k=!1}=e;this.isWebGLRenderer=!0;let R;if(s!==null){if(typeof WebGLRenderingContext<"u"&&s instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");R=s.getContextAttributes().alpha}else R=p;const D=new Set([$N,GN,VN]),O=new Set([og,Gx,Uw,Vw,zN,UN]),F=new Uint32Array(4),U=new Int32Array(4);let X=null,W=null;const K=[],ne=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=B0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const te=this;let re=!1;this._outputColorSpace=Yd;let xe=0,ae=0,ce=null,ye=-1,Ce=null;const Me=new _a,Ke=new _a;let ke=null;const je=new ro(0);let $e=0,Ae=n.width,He=n.height,qe=1,Le=null,st=null;const bt=new _a(0,0,Ae,He),yt=new _a(0,0,Ae,He);let Vt=!1;const _t=new Cq;let vt=!1,qt=!1;const kt=new Da,on=new Ln,mn=new _a,Hr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Un=!1;function $r(){return ce===null?qe:1}let ht=s;function Lr(Re,gt){return n.getContext(Re,gt)}try{const Re={alpha:!0,depth:l,stencil:u,antialias:r,premultipliedAlpha:v,preserveDrawingBuffer:w,powerPreference:E,failIfMajorPerformanceCaveat:T};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${FN}`),n.addEventListener("webglcontextlost",nr,!1),n.addEventListener("webglcontextrestored",ln,!1),n.addEventListener("webglcontextcreationerror",Tr,!1),ht===null){const gt="webgl2";if(ht=Lr(gt,Re),ht===null)throw Lr(gt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Re){throw Re("WebGLRenderer: "+Re.message),Re}let Br,wn,Nn,mr,Qn,Nt,et,Oe,Bt,En,Dn,rn,wr,cr,Jn,ir,bn,In,Zr,Vr,qn,Kn,St,Gn;function er(){Br=new UTe(ht),Br.init(),Kn=new SAe(ht,Br),wn=new RTe(ht,Br,e,Kn),Nn=new bAe(ht,Br),wn.reversedDepthBuffer&&k&&Nn.buffers.depth.setReversed(!0),mr=new GTe(ht),Qn=new lAe,Nt=new wAe(ht,Br,Nn,Qn,wn,Kn,mr),et=new jTe(te),Oe=new zTe(te),Bt=new Xwe(ht),St=new ITe(ht,Bt),En=new VTe(ht,Bt,mr,St),Dn=new WTe(ht,En,Bt,mr),Zr=new $Te(ht,wn,Nt),ir=new NTe(Qn),rn=new aAe(te,et,Oe,Br,wn,St,ir),wr=new kAe(te,Qn),cr=new uAe,Jn=new gAe(Br),In=new kTe(te,et,Oe,Nn,Dn,R,v),bn=new _Ae(te,Dn,wn),Gn=new IAe(ht,mr,wn,Nn),Vr=new PTe(ht,Br,mr),qn=new HTe(ht,Br,mr),mr.programs=rn.programs,te.capabilities=wn,te.extensions=Br,te.properties=Qn,te.renderLists=cr,te.shadowMap=bn,te.state=Nn,te.info=mr}er();const gr=new CAe(te,ht);this.xr=gr,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){const Re=Br.get("WEBGL_lose_context");Re&&Re.loseContext()},this.forceContextRestore=function(){const Re=Br.get("WEBGL_lose_context");Re&&Re.restoreContext()},this.getPixelRatio=function(){return qe},this.setPixelRatio=function(Re){Re!==void 0&&(qe=Re,this.setSize(Ae,He,!1))},this.getSize=function(Re){return Re.set(Ae,He)},this.setSize=function(Re,gt,wt=!0){if(gr.isPresenting){us("WebGLRenderer: Can't change size while VR device is presenting.");return}Ae=Re,He=gt,n.width=Math.floor(Re*qe),n.height=Math.floor(gt*qe),wt===!0&&(n.style.width=Re+"px",n.style.height=gt+"px"),this.setViewport(0,0,Re,gt)},this.getDrawingBufferSize=function(Re){return Re.set(Ae*qe,He*qe).floor()},this.setDrawingBufferSize=function(Re,gt,wt){Ae=Re,He=gt,qe=wt,n.width=Math.floor(Re*wt),n.height=Math.floor(gt*wt),this.setViewport(0,0,Re,gt)},this.getCurrentViewport=function(Re){return Re.copy(Me)},this.getViewport=function(Re){return Re.copy(bt)},this.setViewport=function(Re,gt,wt,It){Re.isVector4?bt.set(Re.x,Re.y,Re.z,Re.w):bt.set(Re,gt,wt,It),Nn.viewport(Me.copy(bt).multiplyScalar(qe).round())},this.getScissor=function(Re){return Re.copy(yt)},this.setScissor=function(Re,gt,wt,It){Re.isVector4?yt.set(Re.x,Re.y,Re.z,Re.w):yt.set(Re,gt,wt,It),Nn.scissor(Ke.copy(yt).multiplyScalar(qe).round())},this.getScissorTest=function(){return Vt},this.setScissorTest=function(Re){Nn.setScissorTest(Vt=Re)},this.setOpaqueSort=function(Re){Le=Re},this.setTransparentSort=function(Re){st=Re},this.getClearColor=function(Re){return Re.copy(In.getClearColor())},this.setClearColor=function(){In.setClearColor(...arguments)},this.getClearAlpha=function(){return In.getClearAlpha()},this.setClearAlpha=function(){In.setClearAlpha(...arguments)},this.clear=function(Re=!0,gt=!0,wt=!0){let It=0;if(Re){let Et=!1;if(ce!==null){const Sn=ce.texture.format;Et=D.has(Sn)}if(Et){const Sn=ce.texture.type,Hn=O.has(Sn),xr=In.getClearColor(),vr=In.getClearAlpha(),jr=xr.r,Er=xr.g,fr=xr.b;Hn?(F[0]=jr,F[1]=Er,F[2]=fr,F[3]=vr,ht.clearBufferuiv(ht.COLOR,0,F)):(U[0]=jr,U[1]=Er,U[2]=fr,U[3]=vr,ht.clearBufferiv(ht.COLOR,0,U))}else It|=ht.COLOR_BUFFER_BIT}gt&&(It|=ht.DEPTH_BUFFER_BIT),wt&&(It|=ht.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ht.clear(It)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",nr,!1),n.removeEventListener("webglcontextrestored",ln,!1),n.removeEventListener("webglcontextcreationerror",Tr,!1),In.dispose(),cr.dispose(),Jn.dispose(),Qn.dispose(),et.dispose(),Oe.dispose(),Dn.dispose(),St.dispose(),Gn.dispose(),rn.dispose(),gr.dispose(),gr.removeEventListener("sessionstart",ho),gr.removeEventListener("sessionend",Qr),Rs.stop()};function nr(Re){Re.preventDefault(),zz("WebGLRenderer: Context Lost."),re=!0}function ln(){zz("WebGLRenderer: Context Restored."),re=!1;const Re=mr.autoReset,gt=bn.enabled,wt=bn.autoUpdate,It=bn.needsUpdate,Et=bn.type;er(),mr.autoReset=Re,bn.enabled=gt,bn.autoUpdate=wt,bn.needsUpdate=It,bn.type=Et}function Tr(Re){xa("WebGLRenderer: A WebGL context could not be created. Reason: ",Re.statusMessage)}function ni(Re){const gt=Re.target;gt.removeEventListener("dispose",ni),Yi(gt)}function Yi(Re){ns(Re),Qn.remove(Re)}function ns(Re){const gt=Qn.get(Re).programs;gt!==void 0&&(gt.forEach(function(wt){rn.releaseProgram(wt)}),Re.isShaderMaterial&&rn.releaseShaderCache(Re))}this.renderBufferDirect=function(Re,gt,wt,It,Et,Sn){gt===null&&(gt=Hr);const Hn=Et.isMesh&&Et.matrixWorld.determinant()<0,xr=at(Re,gt,wt,It,Et);Nn.setMaterial(It,Hn);let vr=wt.index,jr=1;if(It.wireframe===!0){if(vr=En.getWireframeAttribute(wt),vr===void 0)return;jr=2}const Er=wt.drawRange,fr=wt.attributes.position;let ur=Er.start*jr,ai=(Er.start+Er.count)*jr;Sn!==null&&(ur=Math.max(ur,Sn.start*jr),ai=Math.min(ai,(Sn.start+Sn.count)*jr)),vr!==null?(ur=Math.max(ur,0),ai=Math.min(ai,vr.count)):fr!=null&&(ur=Math.max(ur,0),ai=Math.min(ai,fr.count));const vi=ai-ur;if(vi<0||vi===1/0)return;St.setup(Et,It,xr,wt,vr);let li,ii=Vr;if(vr!==null&&(li=Bt.get(vr),ii=qn,ii.setIndex(li)),Et.isMesh)It.wireframe===!0?(Nn.setLineWidth(It.wireframeLinewidth*$r()),ii.setMode(ht.LINES)):ii.setMode(ht.TRIANGLES);else if(Et.isLine){let Or=It.linewidth;Or===void 0&&(Or=1),Nn.setLineWidth(Or*$r()),Et.isLineSegments?ii.setMode(ht.LINES):Et.isLineLoop?ii.setMode(ht.LINE_LOOP):ii.setMode(ht.LINE_STRIP)}else Et.isPoints?ii.setMode(ht.POINTS):Et.isSprite&&ii.setMode(ht.TRIANGLES);if(Et.isBatchedMesh)if(Et._multiDrawInstances!==null)$w("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),ii.renderMultiDrawInstances(Et._multiDrawStarts,Et._multiDrawCounts,Et._multiDrawCount,Et._multiDrawInstances);else if(Br.get("WEBGL_multi_draw"))ii.renderMultiDraw(Et._multiDrawStarts,Et._multiDrawCounts,Et._multiDrawCount);else{const Or=Et._multiDrawStarts,Qi=Et._multiDrawCounts,Ni=Et._multiDrawCount,ko=vr?Bt.get(vr).bytesPerElement:1,Gs=Qn.get(It).currentProgram.getUniforms();for(let Zs=0;Zs<Ni;Zs++)Gs.setValue(ht,"_gl_DrawID",Zs),ii.render(Or[Zs]/ko,Qi[Zs])}else if(Et.isInstancedMesh)ii.renderInstances(ur,vi,Et.count);else if(wt.isInstancedBufferGeometry){const Or=wt._maxInstanceCount!==void 0?wt._maxInstanceCount:1/0,Qi=Math.min(wt.instanceCount,Or);ii.renderInstances(ur,vi,Qi)}else ii.render(ur,vi)};function Ht(Re,gt,wt){Re.transparent===!0&&Re.side===zm&&Re.forceSinglePass===!1?(Re.side=wu,Re.needsUpdate=!0,Fe(Re,gt,wt),Re.side=W0,Re.needsUpdate=!0,Fe(Re,gt,wt),Re.side=zm):Fe(Re,gt,wt)}this.compile=function(Re,gt,wt=null){wt===null&&(wt=Re),W=Jn.get(wt),W.init(gt),ne.push(W),wt.traverseVisible(function(Et){Et.isLight&&Et.layers.test(gt.layers)&&(W.pushLight(Et),Et.castShadow&&W.pushShadow(Et))}),Re!==wt&&Re.traverseVisible(function(Et){Et.isLight&&Et.layers.test(gt.layers)&&(W.pushLight(Et),Et.castShadow&&W.pushShadow(Et))}),W.setupLights();const It=new Set;return Re.traverse(function(Et){if(!(Et.isMesh||Et.isPoints||Et.isLine||Et.isSprite))return;const Sn=Et.material;if(Sn)if(Array.isArray(Sn))for(let Hn=0;Hn<Sn.length;Hn++){const xr=Sn[Hn];Ht(xr,wt,Et),It.add(xr)}else Ht(Sn,wt,Et),It.add(Sn)}),W=ne.pop(),It},this.compileAsync=function(Re,gt,wt=null){const It=this.compile(Re,gt,wt);return new Promise(Et=>{function Sn(){if(It.forEach(function(Hn){Qn.get(Hn).currentProgram.isReady()&&It.delete(Hn)}),It.size===0){Et(Re);return}setTimeout(Sn,10)}Br.get("KHR_parallel_shader_compile")!==null?Sn():setTimeout(Sn,10)})};let cs=null;function rl(Re){cs&&cs(Re)}function ho(){Rs.stop()}function Qr(){Rs.start()}const Rs=new Iq;Rs.setAnimationLoop(rl),typeof self<"u"&&Rs.setContext(self),this.setAnimationLoop=function(Re){cs=Re,gr.setAnimationLoop(Re),Re===null?Rs.stop():Rs.start()},gr.addEventListener("sessionstart",ho),gr.addEventListener("sessionend",Qr),this.render=function(Re,gt){if(gt!==void 0&&gt.isCamera!==!0){xa("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(re===!0)return;if(Re.matrixWorldAutoUpdate===!0&&Re.updateMatrixWorld(),gt.parent===null&&gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),gr.enabled===!0&&gr.isPresenting===!0&&(gr.cameraAutoUpdate===!0&&gr.updateCamera(gt),gt=gr.getCamera()),Re.isScene===!0&&Re.onBeforeRender(te,Re,gt,ce),W=Jn.get(Re,ne.length),W.init(gt),ne.push(W),kt.multiplyMatrices(gt.projectionMatrix,gt.matrixWorldInverse),_t.setFromProjectionMatrix(kt,gp,gt.reversedDepth),qt=this.localClippingEnabled,vt=ir.init(this.clippingPlanes,qt),X=cr.get(Re,K.length),X.init(),K.push(X),gr.enabled===!0&&gr.isPresenting===!0){const Sn=te.xr.getDepthSensingMesh();Sn!==null&&ea(Sn,gt,-1/0,te.sortObjects)}ea(Re,gt,0,te.sortObjects),X.finish(),te.sortObjects===!0&&X.sort(Le,st),Un=gr.enabled===!1||gr.isPresenting===!1||gr.hasDepthSensing()===!1,Un&&In.addToRenderList(X,Re),this.info.render.frame++,vt===!0&&ir.beginShadows();const wt=W.state.shadowsArray;bn.render(wt,Re,gt),vt===!0&&ir.endShadows(),this.info.autoReset===!0&&this.info.reset();const It=X.opaque,Et=X.transmissive;if(W.setupLights(),gt.isArrayCamera){const Sn=gt.cameras;if(Et.length>0)for(let Hn=0,xr=Sn.length;Hn<xr;Hn++){const vr=Sn[Hn];ut(It,Et,Re,vr)}Un&&In.render(Re);for(let Hn=0,xr=Sn.length;Hn<xr;Hn++){const vr=Sn[Hn];Hl(X,Re,vr,vr.viewport)}}else Et.length>0&&ut(It,Et,Re,gt),Un&&In.render(Re),Hl(X,Re,gt);ce!==null&&ae===0&&(Nt.updateMultisampleRenderTarget(ce),Nt.updateRenderTargetMipmap(ce)),Re.isScene===!0&&Re.onAfterRender(te,Re,gt),St.resetDefaultState(),ye=-1,Ce=null,ne.pop(),ne.length>0?(W=ne[ne.length-1],vt===!0&&ir.setGlobalState(te.clippingPlanes,W.state.camera)):W=null,K.pop(),K.length>0?X=K[K.length-1]:X=null};function ea(Re,gt,wt,It){if(Re.visible===!1)return;if(Re.layers.test(gt.layers)){if(Re.isGroup)wt=Re.renderOrder;else if(Re.isLOD)Re.autoUpdate===!0&&Re.update(gt);else if(Re.isLight)W.pushLight(Re),Re.castShadow&&W.pushShadow(Re);else if(Re.isSprite){if(!Re.frustumCulled||_t.intersectsSprite(Re)){It&&mn.setFromMatrixPosition(Re.matrixWorld).applyMatrix4(kt);const Hn=Dn.update(Re),xr=Re.material;xr.visible&&X.push(Re,Hn,xr,wt,mn.z,null)}}else if((Re.isMesh||Re.isLine||Re.isPoints)&&(!Re.frustumCulled||_t.intersectsObject(Re))){const Hn=Dn.update(Re),xr=Re.material;if(It&&(Re.boundingSphere!==void 0?(Re.boundingSphere===null&&Re.computeBoundingSphere(),mn.copy(Re.boundingSphere.center)):(Hn.boundingSphere===null&&Hn.computeBoundingSphere(),mn.copy(Hn.boundingSphere.center)),mn.applyMatrix4(Re.matrixWorld).applyMatrix4(kt)),Array.isArray(xr)){const vr=Hn.groups;for(let jr=0,Er=vr.length;jr<Er;jr++){const fr=vr[jr],ur=xr[fr.materialIndex];ur&&ur.visible&&X.push(Re,Hn,ur,wt,mn.z,fr)}}else xr.visible&&X.push(Re,Hn,xr,wt,mn.z,null)}}const Sn=Re.children;for(let Hn=0,xr=Sn.length;Hn<xr;Hn++)ea(Sn[Hn],gt,wt,It)}function Hl(Re,gt,wt,It){const{opaque:Et,transmissive:Sn,transparent:Hn}=Re;W.setupLightsView(wt),vt===!0&&ir.setGlobalState(te.clippingPlanes,wt),It&&Nn.viewport(Me.copy(It)),Et.length>0&&me(Et,gt,wt),Sn.length>0&&me(Sn,gt,wt),Hn.length>0&&me(Hn,gt,wt),Nn.buffers.depth.setTest(!0),Nn.buffers.depth.setMask(!0),Nn.buffers.color.setMask(!0),Nn.setPolygonOffset(!1)}function ut(Re,gt,wt,It){if((wt.isScene===!0?wt.overrideMaterial:null)!==null)return;W.state.transmissionRenderTarget[It.id]===void 0&&(W.state.transmissionRenderTarget[It.id]=new $x(1,1,{generateMipmaps:!0,type:Br.has("EXT_color_buffer_half_float")||Br.has("EXT_color_buffer_float")?Eb:og,minFilter:cx,samples:4,stencilBuffer:u,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Js.workingColorSpace}));const Sn=W.state.transmissionRenderTarget[It.id],Hn=It.viewport||Me;Sn.setSize(Hn.z*te.transmissionResolutionScale,Hn.w*te.transmissionResolutionScale);const xr=te.getRenderTarget(),vr=te.getActiveCubeFace(),jr=te.getActiveMipmapLevel();te.setRenderTarget(Sn),te.getClearColor(je),$e=te.getClearAlpha(),$e<1&&te.setClearColor(16777215,.5),te.clear(),Un&&In.render(wt);const Er=te.toneMapping;te.toneMapping=B0;const fr=It.viewport;if(It.viewport!==void 0&&(It.viewport=void 0),W.setupLightsView(It),vt===!0&&ir.setGlobalState(te.clippingPlanes,It),me(Re,wt,It),Nt.updateMultisampleRenderTarget(Sn),Nt.updateRenderTargetMipmap(Sn),Br.has("WEBGL_multisampled_render_to_texture")===!1){let ur=!1;for(let ai=0,vi=gt.length;ai<vi;ai++){const li=gt[ai],{object:ii,geometry:Or,material:Qi,group:Ni}=li;if(Qi.side===zm&&ii.layers.test(It.layers)){const ko=Qi.side;Qi.side=wu,Qi.needsUpdate=!0,ve(ii,wt,It,Or,Qi,Ni),Qi.side=ko,Qi.needsUpdate=!0,ur=!0}}ur===!0&&(Nt.updateMultisampleRenderTarget(Sn),Nt.updateRenderTargetMipmap(Sn))}te.setRenderTarget(xr,vr,jr),te.setClearColor(je,$e),fr!==void 0&&(It.viewport=fr),te.toneMapping=Er}function me(Re,gt,wt){const It=gt.isScene===!0?gt.overrideMaterial:null;for(let Et=0,Sn=Re.length;Et<Sn;Et++){const Hn=Re[Et],{object:xr,geometry:vr,group:jr}=Hn;let Er=Hn.material;Er.allowOverride===!0&&It!==null&&(Er=It),xr.layers.test(wt.layers)&&ve(xr,gt,wt,vr,Er,jr)}}function ve(Re,gt,wt,It,Et,Sn){Re.onBeforeRender(te,gt,wt,It,Et,Sn),Re.modelViewMatrix.multiplyMatrices(wt.matrixWorldInverse,Re.matrixWorld),Re.normalMatrix.getNormalMatrix(Re.modelViewMatrix),Et.onBeforeRender(te,gt,wt,It,Re,Sn),Et.transparent===!0&&Et.side===zm&&Et.forceSinglePass===!1?(Et.side=wu,Et.needsUpdate=!0,te.renderBufferDirect(wt,gt,It,Et,Re,Sn),Et.side=W0,Et.needsUpdate=!0,te.renderBufferDirect(wt,gt,It,Et,Re,Sn),Et.side=zm):te.renderBufferDirect(wt,gt,It,Et,Re,Sn),Re.onAfterRender(te,gt,wt,It,Et,Sn)}function Fe(Re,gt,wt){gt.isScene!==!0&&(gt=Hr);const It=Qn.get(Re),Et=W.state.lights,Sn=W.state.shadowsArray,Hn=Et.state.version,xr=rn.getParameters(Re,Et.state,Sn,gt,wt),vr=rn.getProgramCacheKey(xr);let jr=It.programs;It.environment=Re.isMeshStandardMaterial?gt.environment:null,It.fog=gt.fog,It.envMap=(Re.isMeshStandardMaterial?Oe:et).get(Re.envMap||It.environment),It.envMapRotation=It.environment!==null&&Re.envMap===null?gt.environmentRotation:Re.envMapRotation,jr===void 0&&(Re.addEventListener("dispose",ni),jr=new Map,It.programs=jr);let Er=jr.get(vr);if(Er!==void 0){if(It.currentProgram===Er&&It.lightsStateVersion===Hn)return Je(Re,xr),Er}else xr.uniforms=rn.getUniforms(Re),Re.onBeforeCompile(xr,te),Er=rn.acquireProgram(xr,vr),jr.set(vr,Er),It.uniforms=xr.uniforms;const fr=It.uniforms;return(!Re.isShaderMaterial&&!Re.isRawShaderMaterial||Re.clipping===!0)&&(fr.clippingPlanes=ir.uniform),Je(Re,xr),It.needsLights=ct(Re),It.lightsStateVersion=Hn,It.needsLights&&(fr.ambientLightColor.value=Et.state.ambient,fr.lightProbe.value=Et.state.probe,fr.directionalLights.value=Et.state.directional,fr.directionalLightShadows.value=Et.state.directionalShadow,fr.spotLights.value=Et.state.spot,fr.spotLightShadows.value=Et.state.spotShadow,fr.rectAreaLights.value=Et.state.rectArea,fr.ltc_1.value=Et.state.rectAreaLTC1,fr.ltc_2.value=Et.state.rectAreaLTC2,fr.pointLights.value=Et.state.point,fr.pointLightShadows.value=Et.state.pointShadow,fr.hemisphereLights.value=Et.state.hemi,fr.directionalShadowMap.value=Et.state.directionalShadowMap,fr.directionalShadowMatrix.value=Et.state.directionalShadowMatrix,fr.spotShadowMap.value=Et.state.spotShadowMap,fr.spotLightMatrix.value=Et.state.spotLightMatrix,fr.spotLightMap.value=Et.state.spotLightMap,fr.pointShadowMap.value=Et.state.pointShadowMap,fr.pointShadowMatrix.value=Et.state.pointShadowMatrix),It.currentProgram=Er,It.uniformsList=null,Er}function tt(Re){if(Re.uniformsList===null){const gt=Re.currentProgram.getUniforms();Re.uniformsList=iE.seqWithValue(gt.seq,Re.uniforms)}return Re.uniformsList}function Je(Re,gt){const wt=Qn.get(Re);wt.outputColorSpace=gt.outputColorSpace,wt.batching=gt.batching,wt.batchingColor=gt.batchingColor,wt.instancing=gt.instancing,wt.instancingColor=gt.instancingColor,wt.instancingMorph=gt.instancingMorph,wt.skinning=gt.skinning,wt.morphTargets=gt.morphTargets,wt.morphNormals=gt.morphNormals,wt.morphColors=gt.morphColors,wt.morphTargetsCount=gt.morphTargetsCount,wt.numClippingPlanes=gt.numClippingPlanes,wt.numIntersection=gt.numClipIntersection,wt.vertexAlphas=gt.vertexAlphas,wt.vertexTangents=gt.vertexTangents,wt.toneMapping=gt.toneMapping}function at(Re,gt,wt,It,Et){gt.isScene!==!0&&(gt=Hr),Nt.resetTextureUnits();const Sn=gt.fog,Hn=It.isMeshStandardMaterial?gt.environment:null,xr=ce===null?te.outputColorSpace:ce.isXRRenderTarget===!0?ce.texture.colorSpace:lb,vr=(It.isMeshStandardMaterial?Oe:et).get(It.envMap||Hn),jr=It.vertexColors===!0&&!!wt.attributes.color&&wt.attributes.color.itemSize===4,Er=!!wt.attributes.tangent&&(!!It.normalMap||It.anisotropy>0),fr=!!wt.morphAttributes.position,ur=!!wt.morphAttributes.normal,ai=!!wt.morphAttributes.color;let vi=B0;It.toneMapped&&(ce===null||ce.isXRRenderTarget===!0)&&(vi=te.toneMapping);const li=wt.morphAttributes.position||wt.morphAttributes.normal||wt.morphAttributes.color,ii=li!==void 0?li.length:0,Or=Qn.get(It),Qi=W.state.lights;if(vt===!0&&(qt===!0||Re!==Ce)){const wo=Re===Ce&&It.id===ye;ir.setState(It,Re,wo)}let Ni=!1;It.version===Or.__version?(Or.needsLights&&Or.lightsStateVersion!==Qi.state.version||Or.outputColorSpace!==xr||Et.isBatchedMesh&&Or.batching===!1||!Et.isBatchedMesh&&Or.batching===!0||Et.isBatchedMesh&&Or.batchingColor===!0&&Et.colorTexture===null||Et.isBatchedMesh&&Or.batchingColor===!1&&Et.colorTexture!==null||Et.isInstancedMesh&&Or.instancing===!1||!Et.isInstancedMesh&&Or.instancing===!0||Et.isSkinnedMesh&&Or.skinning===!1||!Et.isSkinnedMesh&&Or.skinning===!0||Et.isInstancedMesh&&Or.instancingColor===!0&&Et.instanceColor===null||Et.isInstancedMesh&&Or.instancingColor===!1&&Et.instanceColor!==null||Et.isInstancedMesh&&Or.instancingMorph===!0&&Et.morphTexture===null||Et.isInstancedMesh&&Or.instancingMorph===!1&&Et.morphTexture!==null||Or.envMap!==vr||It.fog===!0&&Or.fog!==Sn||Or.numClippingPlanes!==void 0&&(Or.numClippingPlanes!==ir.numPlanes||Or.numIntersection!==ir.numIntersection)||Or.vertexAlphas!==jr||Or.vertexTangents!==Er||Or.morphTargets!==fr||Or.morphNormals!==ur||Or.morphColors!==ai||Or.toneMapping!==vi||Or.morphTargetsCount!==ii)&&(Ni=!0):(Ni=!0,Or.__version=It.version);let ko=Or.currentProgram;Ni===!0&&(ko=Fe(It,gt,Et));let Gs=!1,Zs=!1,mo=!1;const ds=ko.getUniforms(),Is=Or.uniforms;if(Nn.useProgram(ko.program)&&(Gs=!0,Zs=!0,mo=!0),It.id!==ye&&(ye=It.id,Zs=!0),Gs||Ce!==Re){Nn.buffers.depth.getReversed()&&Re.reversedDepth!==!0&&(Re._reversedDepth=!0,Re.updateProjectionMatrix()),ds.setValue(ht,"projectionMatrix",Re.projectionMatrix),ds.setValue(ht,"viewMatrix",Re.matrixWorldInverse);const ji=ds.map.cameraPosition;ji!==void 0&&ji.setValue(ht,on.setFromMatrixPosition(Re.matrixWorld)),wn.logarithmicDepthBuffer&&ds.setValue(ht,"logDepthBufFC",2/(Math.log(Re.far+1)/Math.LN2)),(It.isMeshPhongMaterial||It.isMeshToonMaterial||It.isMeshLambertMaterial||It.isMeshBasicMaterial||It.isMeshStandardMaterial||It.isShaderMaterial)&&ds.setValue(ht,"isOrthographic",Re.isOrthographicCamera===!0),Ce!==Re&&(Ce=Re,Zs=!0,mo=!0)}if(Et.isSkinnedMesh){ds.setOptional(ht,Et,"bindMatrix"),ds.setOptional(ht,Et,"bindMatrixInverse");const wo=Et.skeleton;wo&&(wo.boneTexture===null&&wo.computeBoneTexture(),ds.setValue(ht,"boneTexture",wo.boneTexture,Nt))}Et.isBatchedMesh&&(ds.setOptional(ht,Et,"batchingTexture"),ds.setValue(ht,"batchingTexture",Et._matricesTexture,Nt),ds.setOptional(ht,Et,"batchingIdTexture"),ds.setValue(ht,"batchingIdTexture",Et._indirectTexture,Nt),ds.setOptional(ht,Et,"batchingColorTexture"),Et._colorsTexture!==null&&ds.setValue(ht,"batchingColorTexture",Et._colorsTexture,Nt));const eo=wt.morphAttributes;if((eo.position!==void 0||eo.normal!==void 0||eo.color!==void 0)&&Zr.update(Et,wt,ko),(Zs||Or.receiveShadow!==Et.receiveShadow)&&(Or.receiveShadow=Et.receiveShadow,ds.setValue(ht,"receiveShadow",Et.receiveShadow)),It.isMeshGouraudMaterial&&It.envMap!==null&&(Is.envMap.value=vr,Is.flipEnvMap.value=vr.isCubeTexture&&vr.isRenderTargetTexture===!1?-1:1),It.isMeshStandardMaterial&&It.envMap===null&&gt.environment!==null&&(Is.envMapIntensity.value=gt.environmentIntensity),Is.dfgLUT!==void 0&&(Is.dfgLUT.value=RAe()),Zs&&(ds.setValue(ht,"toneMappingExposure",te.toneMappingExposure),Or.needsLights&&Pt(Is,mo),Sn&&It.fog===!0&&wr.refreshFogUniforms(Is,Sn),wr.refreshMaterialUniforms(Is,It,qe,He,W.state.transmissionRenderTarget[Re.id]),iE.upload(ht,tt(Or),Is,Nt)),It.isShaderMaterial&&It.uniformsNeedUpdate===!0&&(iE.upload(ht,tt(Or),Is,Nt),It.uniformsNeedUpdate=!1),It.isSpriteMaterial&&ds.setValue(ht,"center",Et.center),ds.setValue(ht,"modelViewMatrix",Et.modelViewMatrix),ds.setValue(ht,"normalMatrix",Et.normalMatrix),ds.setValue(ht,"modelMatrix",Et.matrixWorld),It.isShaderMaterial||It.isRawShaderMaterial){const wo=It.uniformsGroups;for(let ji=0,Zc=wo.length;ji<Zc;ji++){const il=wo[ji];Gn.update(il,ko),Gn.bind(il,ko)}}return ko}function Pt(Re,gt){Re.ambientLightColor.needsUpdate=gt,Re.lightProbe.needsUpdate=gt,Re.directionalLights.needsUpdate=gt,Re.directionalLightShadows.needsUpdate=gt,Re.pointLights.needsUpdate=gt,Re.pointLightShadows.needsUpdate=gt,Re.spotLights.needsUpdate=gt,Re.spotLightShadows.needsUpdate=gt,Re.rectAreaLights.needsUpdate=gt,Re.hemisphereLights.needsUpdate=gt}function ct(Re){return Re.isMeshLambertMaterial||Re.isMeshToonMaterial||Re.isMeshPhongMaterial||Re.isMeshStandardMaterial||Re.isShadowMaterial||Re.isShaderMaterial&&Re.lights===!0}this.getActiveCubeFace=function(){return xe},this.getActiveMipmapLevel=function(){return ae},this.getRenderTarget=function(){return ce},this.setRenderTargetTextures=function(Re,gt,wt){const It=Qn.get(Re);It.__autoAllocateDepthBuffer=Re.resolveDepthBuffer===!1,It.__autoAllocateDepthBuffer===!1&&(It.__useRenderToTexture=!1),Qn.get(Re.texture).__webglTexture=gt,Qn.get(Re.depthTexture).__webglTexture=It.__autoAllocateDepthBuffer?void 0:wt,It.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Re,gt){const wt=Qn.get(Re);wt.__webglFramebuffer=gt,wt.__useDefaultFramebuffer=gt===void 0};const Ct=ht.createFramebuffer();this.setRenderTarget=function(Re,gt=0,wt=0){ce=Re,xe=gt,ae=wt;let It=!0,Et=null,Sn=!1,Hn=!1;if(Re){const vr=Qn.get(Re);if(vr.__useDefaultFramebuffer!==void 0)Nn.bindFramebuffer(ht.FRAMEBUFFER,null),It=!1;else if(vr.__webglFramebuffer===void 0)Nt.setupRenderTarget(Re);else if(vr.__hasExternalTextures)Nt.rebindTextures(Re,Qn.get(Re.texture).__webglTexture,Qn.get(Re.depthTexture).__webglTexture);else if(Re.depthBuffer){const fr=Re.depthTexture;if(vr.__boundDepthTexture!==fr){if(fr!==null&&Qn.has(fr)&&(Re.width!==fr.image.width||Re.height!==fr.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Nt.setupDepthRenderbuffer(Re)}}const jr=Re.texture;(jr.isData3DTexture||jr.isDataArrayTexture||jr.isCompressedArrayTexture)&&(Hn=!0);const Er=Qn.get(Re).__webglFramebuffer;Re.isWebGLCubeRenderTarget?(Array.isArray(Er[gt])?Et=Er[gt][wt]:Et=Er[gt],Sn=!0):Re.samples>0&&Nt.useMultisampledRTT(Re)===!1?Et=Qn.get(Re).__webglMultisampledFramebuffer:Array.isArray(Er)?Et=Er[wt]:Et=Er,Me.copy(Re.viewport),Ke.copy(Re.scissor),ke=Re.scissorTest}else Me.copy(bt).multiplyScalar(qe).floor(),Ke.copy(yt).multiplyScalar(qe).floor(),ke=Vt;if(wt!==0&&(Et=Ct),Nn.bindFramebuffer(ht.FRAMEBUFFER,Et)&&It&&Nn.drawBuffers(Re,Et),Nn.viewport(Me),Nn.scissor(Ke),Nn.setScissorTest(ke),Sn){const vr=Qn.get(Re.texture);ht.framebufferTexture2D(ht.FRAMEBUFFER,ht.COLOR_ATTACHMENT0,ht.TEXTURE_CUBE_MAP_POSITIVE_X+gt,vr.__webglTexture,wt)}else if(Hn){const vr=gt;for(let jr=0;jr<Re.textures.length;jr++){const Er=Qn.get(Re.textures[jr]);ht.framebufferTextureLayer(ht.FRAMEBUFFER,ht.COLOR_ATTACHMENT0+jr,Er.__webglTexture,wt,vr)}}else if(Re!==null&&wt!==0){const vr=Qn.get(Re.texture);ht.framebufferTexture2D(ht.FRAMEBUFFER,ht.COLOR_ATTACHMENT0,ht.TEXTURE_2D,vr.__webglTexture,wt)}ye=-1},this.readRenderTargetPixels=function(Re,gt,wt,It,Et,Sn,Hn,xr=0){if(!(Re&&Re.isWebGLRenderTarget)){xa("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let vr=Qn.get(Re).__webglFramebuffer;if(Re.isWebGLCubeRenderTarget&&Hn!==void 0&&(vr=vr[Hn]),vr){Nn.bindFramebuffer(ht.FRAMEBUFFER,vr);try{const jr=Re.textures[xr],Er=jr.format,fr=jr.type;if(!wn.textureFormatReadable(Er)){xa("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!wn.textureTypeReadable(fr)){xa("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}gt>=0&&gt<=Re.width-It&&wt>=0&&wt<=Re.height-Et&&(Re.textures.length>1&&ht.readBuffer(ht.COLOR_ATTACHMENT0+xr),ht.readPixels(gt,wt,It,Et,Kn.convert(Er),Kn.convert(fr),Sn))}finally{const jr=ce!==null?Qn.get(ce).__webglFramebuffer:null;Nn.bindFramebuffer(ht.FRAMEBUFFER,jr)}}},this.readRenderTargetPixelsAsync=async function(Re,gt,wt,It,Et,Sn,Hn,xr=0){if(!(Re&&Re.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let vr=Qn.get(Re).__webglFramebuffer;if(Re.isWebGLCubeRenderTarget&&Hn!==void 0&&(vr=vr[Hn]),vr)if(gt>=0&&gt<=Re.width-It&&wt>=0&&wt<=Re.height-Et){Nn.bindFramebuffer(ht.FRAMEBUFFER,vr);const jr=Re.textures[xr],Er=jr.format,fr=jr.type;if(!wn.textureFormatReadable(Er))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!wn.textureTypeReadable(fr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const ur=ht.createBuffer();ht.bindBuffer(ht.PIXEL_PACK_BUFFER,ur),ht.bufferData(ht.PIXEL_PACK_BUFFER,Sn.byteLength,ht.STREAM_READ),Re.textures.length>1&&ht.readBuffer(ht.COLOR_ATTACHMENT0+xr),ht.readPixels(gt,wt,It,Et,Kn.convert(Er),Kn.convert(fr),0);const ai=ce!==null?Qn.get(ce).__webglFramebuffer:null;Nn.bindFramebuffer(ht.FRAMEBUFFER,ai);const vi=ht.fenceSync(ht.SYNC_GPU_COMMANDS_COMPLETE,0);return ht.flush(),await hwe(ht,vi,4),ht.bindBuffer(ht.PIXEL_PACK_BUFFER,ur),ht.getBufferSubData(ht.PIXEL_PACK_BUFFER,0,Sn),ht.deleteBuffer(ur),ht.deleteSync(vi),Sn}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Re,gt=null,wt=0){const It=Math.pow(2,-wt),Et=Math.floor(Re.image.width*It),Sn=Math.floor(Re.image.height*It),Hn=gt!==null?gt.x:0,xr=gt!==null?gt.y:0;Nt.setTexture2D(Re,0),ht.copyTexSubImage2D(ht.TEXTURE_2D,wt,0,0,Hn,xr,Et,Sn),Nn.unbindTexture()};const un=ht.createFramebuffer(),tn=ht.createFramebuffer();this.copyTextureToTexture=function(Re,gt,wt=null,It=null,Et=0,Sn=null){Sn===null&&(Et!==0?($w("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Sn=Et,Et=0):Sn=0);let Hn,xr,vr,jr,Er,fr,ur,ai,vi;const li=Re.isCompressedTexture?Re.mipmaps[Sn]:Re.image;if(wt!==null)Hn=wt.max.x-wt.min.x,xr=wt.max.y-wt.min.y,vr=wt.isBox3?wt.max.z-wt.min.z:1,jr=wt.min.x,Er=wt.min.y,fr=wt.isBox3?wt.min.z:0;else{const eo=Math.pow(2,-Et);Hn=Math.floor(li.width*eo),xr=Math.floor(li.height*eo),Re.isDataArrayTexture?vr=li.depth:Re.isData3DTexture?vr=Math.floor(li.depth*eo):vr=1,jr=0,Er=0,fr=0}It!==null?(ur=It.x,ai=It.y,vi=It.z):(ur=0,ai=0,vi=0);const ii=Kn.convert(gt.format),Or=Kn.convert(gt.type);let Qi;gt.isData3DTexture?(Nt.setTexture3D(gt,0),Qi=ht.TEXTURE_3D):gt.isDataArrayTexture||gt.isCompressedArrayTexture?(Nt.setTexture2DArray(gt,0),Qi=ht.TEXTURE_2D_ARRAY):(Nt.setTexture2D(gt,0),Qi=ht.TEXTURE_2D),ht.pixelStorei(ht.UNPACK_FLIP_Y_WEBGL,gt.flipY),ht.pixelStorei(ht.UNPACK_PREMULTIPLY_ALPHA_WEBGL,gt.premultiplyAlpha),ht.pixelStorei(ht.UNPACK_ALIGNMENT,gt.unpackAlignment);const Ni=ht.getParameter(ht.UNPACK_ROW_LENGTH),ko=ht.getParameter(ht.UNPACK_IMAGE_HEIGHT),Gs=ht.getParameter(ht.UNPACK_SKIP_PIXELS),Zs=ht.getParameter(ht.UNPACK_SKIP_ROWS),mo=ht.getParameter(ht.UNPACK_SKIP_IMAGES);ht.pixelStorei(ht.UNPACK_ROW_LENGTH,li.width),ht.pixelStorei(ht.UNPACK_IMAGE_HEIGHT,li.height),ht.pixelStorei(ht.UNPACK_SKIP_PIXELS,jr),ht.pixelStorei(ht.UNPACK_SKIP_ROWS,Er),ht.pixelStorei(ht.UNPACK_SKIP_IMAGES,fr);const ds=Re.isDataArrayTexture||Re.isData3DTexture,Is=gt.isDataArrayTexture||gt.isData3DTexture;if(Re.isDepthTexture){const eo=Qn.get(Re),wo=Qn.get(gt),ji=Qn.get(eo.__renderTarget),Zc=Qn.get(wo.__renderTarget);Nn.bindFramebuffer(ht.READ_FRAMEBUFFER,ji.__webglFramebuffer),Nn.bindFramebuffer(ht.DRAW_FRAMEBUFFER,Zc.__webglFramebuffer);for(let il=0;il<vr;il++)ds&&(ht.framebufferTextureLayer(ht.READ_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,Qn.get(Re).__webglTexture,Et,fr+il),ht.framebufferTextureLayer(ht.DRAW_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,Qn.get(gt).__webglTexture,Sn,vi+il)),ht.blitFramebuffer(jr,Er,Hn,xr,ur,ai,Hn,xr,ht.DEPTH_BUFFER_BIT,ht.NEAREST);Nn.bindFramebuffer(ht.READ_FRAMEBUFFER,null),Nn.bindFramebuffer(ht.DRAW_FRAMEBUFFER,null)}else if(Et!==0||Re.isRenderTargetTexture||Qn.has(Re)){const eo=Qn.get(Re),wo=Qn.get(gt);Nn.bindFramebuffer(ht.READ_FRAMEBUFFER,un),Nn.bindFramebuffer(ht.DRAW_FRAMEBUFFER,tn);for(let ji=0;ji<vr;ji++)ds?ht.framebufferTextureLayer(ht.READ_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,eo.__webglTexture,Et,fr+ji):ht.framebufferTexture2D(ht.READ_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,ht.TEXTURE_2D,eo.__webglTexture,Et),Is?ht.framebufferTextureLayer(ht.DRAW_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,wo.__webglTexture,Sn,vi+ji):ht.framebufferTexture2D(ht.DRAW_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,ht.TEXTURE_2D,wo.__webglTexture,Sn),Et!==0?ht.blitFramebuffer(jr,Er,Hn,xr,ur,ai,Hn,xr,ht.COLOR_BUFFER_BIT,ht.NEAREST):Is?ht.copyTexSubImage3D(Qi,Sn,ur,ai,vi+ji,jr,Er,Hn,xr):ht.copyTexSubImage2D(Qi,Sn,ur,ai,jr,Er,Hn,xr);Nn.bindFramebuffer(ht.READ_FRAMEBUFFER,null),Nn.bindFramebuffer(ht.DRAW_FRAMEBUFFER,null)}else Is?Re.isDataTexture||Re.isData3DTexture?ht.texSubImage3D(Qi,Sn,ur,ai,vi,Hn,xr,vr,ii,Or,li.data):gt.isCompressedArrayTexture?ht.compressedTexSubImage3D(Qi,Sn,ur,ai,vi,Hn,xr,vr,ii,li.data):ht.texSubImage3D(Qi,Sn,ur,ai,vi,Hn,xr,vr,ii,Or,li):Re.isDataTexture?ht.texSubImage2D(ht.TEXTURE_2D,Sn,ur,ai,Hn,xr,ii,Or,li.data):Re.isCompressedTexture?ht.compressedTexSubImage2D(ht.TEXTURE_2D,Sn,ur,ai,li.width,li.height,ii,li.data):ht.texSubImage2D(ht.TEXTURE_2D,Sn,ur,ai,Hn,xr,ii,Or,li);ht.pixelStorei(ht.UNPACK_ROW_LENGTH,Ni),ht.pixelStorei(ht.UNPACK_IMAGE_HEIGHT,ko),ht.pixelStorei(ht.UNPACK_SKIP_PIXELS,Gs),ht.pixelStorei(ht.UNPACK_SKIP_ROWS,Zs),ht.pixelStorei(ht.UNPACK_SKIP_IMAGES,mo),Sn===0&&gt.generateMipmaps&&ht.generateMipmap(Qi),Nn.unbindTexture()},this.initRenderTarget=function(Re){Qn.get(Re).__webglFramebuffer===void 0&&Nt.setupRenderTarget(Re)},this.initTexture=function(Re){Re.isCubeTexture?Nt.setTextureCube(Re,0):Re.isData3DTexture?Nt.setTexture3D(Re,0):Re.isDataArrayTexture||Re.isCompressedArrayTexture?Nt.setTexture2DArray(Re,0):Nt.setTexture2D(Re,0),Nn.unbindTexture()},this.resetState=function(){xe=0,ae=0,ce=null,Nn.reset(),St.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return gp}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=Js._getDrawingBufferColorSpace(e),n.unpackColorSpace=Js._getUnpackColorSpace()}}const jAe=({starCount:t=15e3,animationSpeed:e=1,interactionEnabled:n=!1,enableHalloweenMode:s=!1})=>{const l=he.useRef(null),u=he.useRef(null),p=he.useRef(null),r=he.useRef(null),v=he.useRef(null),w=he.useRef(null),E=he.useRef([]),T=he.useRef([]),k=he.useRef(null),R=he.useRef(!1),D=he.useRef({x:0,y:0}),O=he.useRef({x:0,y:0}),F=he.useRef({x:0,y:0}),U=he.useRef(400),X=he.useRef(!0),W=he.useRef({x:0,y:0}),[K,ne]=he.useState(!1);he.useEffect(()=>{const ye=window.matchMedia("(prefers-reduced-motion: reduce)"),Ce=Me=>{ne(Me.matches)};return Ce(ye),ye.addEventListener("change",Ce),()=>{ye.removeEventListener("change",Ce)}},[]);const te=()=>{if(s){const Ce=Math.random();return Ce<.4?16739125:Ce<.7?16749824:Ce<.85?1706542:Ce<.95?15787775:3800852}const ye=Math.random();return ye<.5?16777215:ye<.7?16777181:ye<.85?16768443:ye<.93?12312063:16759739},re=()=>{const ye=[],Ce=K?.2:1,Me=Math.floor(t*.85);for(let ke=0;ke<Me;ke++){const je=Math.random()*Math.PI*2,$e=Math.acos(2*Math.random()-1),Ae=Math.random()*300+80;ye.push({x:Ae*Math.sin($e)*Math.cos(je),y:Ae*Math.sin($e)*Math.sin(je),z:Ae*Math.cos($e),size:Math.random()*1.5+.5,brightness:Math.random()*.4+.4,color:te(),velocityX:(Math.random()-.5)*.08*e*Ce,velocityY:(Math.random()-.5)*.08*e*Ce,velocityZ:(Math.random()-.5)*.08*e*Ce,twinkleSpeed:(Math.random()*.003+.001)*Ce,twinkleOffset:Math.random()*1e3})}const Ke=Math.floor(t*.15);for(let ke=0;ke<Ke;ke++){const je=ke/Ke,$e=je*Math.PI*1.5,Ae=250,He=Math.sin(je*Math.PI*8)*80,qe=Math.cos(je*Math.PI*5)*60,Le=Math.sin(je*137.5)*40,st=(Math.random()-.5)*(30+Math.sin(je*Math.PI*3)*20),bt=(Math.random()-.5)*(25+Math.cos(je*Math.PI*4)*15),yt=Math.random()<.7?1:.3;if(Math.random()>yt)continue;const Vt=Math.cos($e)*(Ae+He)+Le+st,_t=Math.sin($e*.5)*30+qe*.3+bt,vt=Math.sin($e)*(Ae+He)+qe+st;ye.push({x:Vt,y:_t,z:vt,size:Math.random()*1.5+.3,brightness:Math.random()*.7+.2,color:Math.random()>.15?16777215:Math.random()>.5?16777198:16772829,velocityX:(Math.random()-.5)*.03*e*Ce,velocityY:(Math.random()-.5)*.02*e*Ce,velocityZ:(Math.random()-.5)*.03*e*Ce,twinkleSpeed:(Math.random()*.002+.001)*Ce,twinkleOffset:Math.random()*1e3})}E.current=ye},xe=()=>{const ye=Math.random()*Math.PI*2,Ce=Math.random()*Math.PI,Me=400,Ke=Math.random()*Math.PI*2,ke=Math.random()*Math.PI,je=K?.2:1;T.current.push({x:Me*Math.sin(Ce)*Math.cos(ye),y:Me*Math.sin(Ce)*Math.sin(ye),z:Me*Math.cos(Ce),vx:Math.sin(ke)*Math.cos(Ke)*15*e*je,vy:Math.sin(ke)*Math.sin(Ke)*15*e*je,vz:Math.cos(ke)*15*e*je,life:1,size:4})},ae=ye=>{v.current&&(ye.remove(v.current),v.current.geometry.dispose(),v.current.material.dispose());const Ce=new mf,Me=[],Ke=[],ke=[];E.current.forEach($e=>{Me.push($e.x,$e.y,$e.z);const Ae=new ro($e.color);Ke.push(Ae.r,Ae.g,Ae.b),ke.push($e.size)}),Ce.setAttribute("position",new nd(Me,3)),Ce.setAttribute("color",new nd(Ke,3)),Ce.setAttribute("size",new nd(ke,1));const je=new aP({size:2,vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!1,blending:HE});v.current=new i8(Ce,je),ye.add(v.current)},ce=ye=>{w.current&&(ye.remove(w.current),w.current.geometry.dispose(),w.current.material.dispose());const Ce=new mf,Me=[],Ke=[],ke=[];for(let $e=0;$e<5;$e++)Me.push(0,0,0),Ke.push(0,0,0),ke.push(0);Ce.setAttribute("position",new nd(Me,3)),Ce.setAttribute("color",new nd(Ke,3)),Ce.setAttribute("size",new nd(ke,1));const je=new aP({size:6,vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!1,blending:HE});w.current=new i8(Ce,je),ye.add(w.current)};return he.useEffect(()=>{if(!l.current){console.error("CosmosBackground: containerRef.current is null");return}X.current=!0;let ye=null,Ce=null;const Me=()=>{!p.current||!r.current||!X.current||(p.current.aspect=window.innerWidth/window.innerHeight,p.current.updateProjectionMatrix(),r.current.setSize(window.innerWidth,window.innerHeight))},Ke=Ae=>{if(!n||!X.current)return;const He=Ae.target;He&&(He.tagName==="BUTTON"||He.tagName==="INPUT"||He.tagName==="A"||He.tagName==="SELECT"||He.tagName==="TEXTAREA"||He.closest("button")||He.closest("a")||He.closest("input")||He.closest("select")||He.closest("textarea")||He.closest('[role="button"]')||He.closest("[onclick]"))||(R.current=!0,D.current={x:Ae.clientX,y:Ae.clientY})},ke=Ae=>{if(!n||!X.current)return;W.current={x:Ae.clientX,y:Ae.clientY};const He=window.innerWidth/2,qe=window.innerHeight/2,Le=(Ae.clientX-He)/He,st=(Ae.clientY-qe)/qe;if(O.current.y=Le*.785,O.current.x=st*.785,O.current.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,O.current.x)),R.current){const bt=Ae.clientX-D.current.x,yt=Ae.clientY-D.current.y;O.current.y+=bt*.005,O.current.x+=yt*.005,O.current.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,O.current.x))}D.current={x:Ae.clientX,y:Ae.clientY}},je=()=>{R.current=!1},$e=Ae=>{!n||!X.current||(U.current-=Ae.deltaY*.3,U.current=Math.max(100,Math.min(800,U.current)))};try{const Ae=new Fwe;u.current=Ae;const He=new Jd(75,window.innerWidth/window.innerHeight,.1,2e3);He.position.z=U.current,p.current=He;const qe=new NAe({antialias:!0,alpha:!0,powerPreference:"high-performance"});qe.setSize(window.innerWidth,window.innerHeight),qe.setClearColor(0,0),qe.setPixelRatio(Math.min(window.devicePixelRatio,2)),qe.domElement.style.position="absolute",qe.domElement.style.top="0",qe.domElement.style.left="0",qe.domElement.style.width="100%",qe.domElement.style.height="100%",qe.domElement.style.pointerEvents="auto",l.current.appendChild(qe.domElement),r.current=qe,Ce=qe,re(),ae(Ae),ce(Ae),window.addEventListener("resize",Me),n&&(document.addEventListener("mousedown",Ke),document.addEventListener("mousemove",ke),document.addEventListener("mouseup",je),document.addEventListener("wheel",$e,{passive:!1}));const Le=()=>{if(!(!X.current||!u.current||!p.current||!r.current))try{if(F.current.x+=(O.current.x-F.current.x)*.05,F.current.y+=(O.current.y-F.current.y)*.05,v.current&&(v.current.rotation.x=F.current.x,v.current.rotation.y=F.current.y),p.current.position.z+=(U.current-p.current.position.z)*.05,v.current&&E.current.length>0){const st=v.current.geometry.attributes.position.array,bt=v.current.geometry.attributes.color.array,yt=Date.now()*.001;for(let Vt=0;Vt<E.current.length&&Vt*3+2<st.length;Vt++){const _t=E.current[Vt],vt=Vt*3;st[vt]+=_t.velocityX,st[vt+1]+=_t.velocityY,st[vt+2]+=_t.velocityZ;const qt=Math.sqrt(st[vt]**2+st[vt+1]**2+st[vt+2]**2);if(qt>350||qt<30){const Un=(150+Math.random()*100)/qt;st[vt]*=Un,st[vt+1]*=Un,st[vt+2]*=Un}const kt=.7+Math.sin(yt*_t.twinkleSpeed*100+_t.twinkleOffset)*.3,on=new ro(_t.color),mn=_t.brightness*kt;bt[vt]=on.r*mn,bt[vt+1]=on.g*mn,bt[vt+2]=on.b*mn}v.current.geometry.attributes.position.needsUpdate=!0,v.current.geometry.attributes.color.needsUpdate=!0}if(w.current){const st=w.current.geometry.attributes.position.array,bt=w.current.geometry.attributes.color.array,yt=w.current.geometry.attributes.size.array;for(let _t=T.current.length-1;_t>=0;_t--){const vt=T.current[_t],qt=_t*3;vt.x+=vt.vx,vt.y+=vt.vy,vt.z+=vt.vz,vt.life-=.02*e,qt<st.length&&qt+2<st.length&&(st[qt]=vt.x,st[qt+1]=vt.y,st[qt+2]=vt.z,s?(bt[qt]=vt.life*2,bt[qt+1]=vt.life*1.2,bt[qt+2]=vt.life*.5):(bt[qt]=vt.life*2,bt[qt+1]=vt.life*2,bt[qt+2]=vt.life*1.5),yt[qt/3]=vt.size*vt.life),vt.life<=0&&T.current.splice(_t,1)}const Vt=K?.001:.005;T.current.length===0&&Math.random()<Vt&&xe(),w.current.geometry.attributes.position.needsUpdate=!0,w.current.geometry.attributes.color.needsUpdate=!0,w.current.geometry.attributes.size.needsUpdate=!0}r.current.render(u.current,p.current),k.current=requestAnimationFrame(Le),ye=k.current}catch(st){console.error("Cosmos animation error:",st),X.current&&(ye=requestAnimationFrame(Le))}};console.log("CosmosBackground: Starting animation"),ye=requestAnimationFrame(Le),k.current=ye}catch(Ae){console.error("CosmosBackground initialization error:",Ae)}return()=>{X.current=!1,ye!==null&&cancelAnimationFrame(ye),k.current&&cancelAnimationFrame(k.current),window.removeEventListener("resize",Me),n&&(document.removeEventListener("mousedown",Ke),document.removeEventListener("mousemove",ke),document.removeEventListener("mouseup",je),document.removeEventListener("wheel",$e)),v.current&&(v.current.geometry.dispose(),v.current.material.dispose()),w.current&&(w.current.geometry.dispose(),w.current.material.dispose()),r.current&&l.current&&r.current.domElement&&l.current.contains(r.current.domElement)&&(l.current.removeChild(r.current.domElement),r.current.dispose()),u.current=null,p.current=null,r.current=null,v.current=null,w.current=null}},[]),he.useEffect(()=>{u.current&&v.current&&(re(),ae(u.current))},[K]),f.jsx("div",{ref:l,className:"fixed inset-0 w-screen h-screen",style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:0,overflow:"hidden",pointerEvents:"auto",backgroundColor:"transparent",touchAction:"none"}})},DAe=t=>{const e=[];for(let n=0;n<t;n++)e.push({id:n,x:Math.random()*100,y:Math.random()*100,size:Math.random()*30+40,opacity:Math.random()*.4+.3,rotation:Math.random()*20-10,floatDuration:Math.random()*10+15,swayAmplitude:Math.random()*30+20,delay:Math.random()*5});return e},LAe=({opacity:t=.8})=>{const e=yve(),n=he.useMemo(()=>DAe(e),[e]);return e===0?null:f.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0","aria-hidden":"true",children:n.map(s=>f.jsx(it.div,{className:"absolute",style:{left:`${s.x}%`},initial:{y:"100vh",opacity:0,rotate:s.rotation},animate:{y:"-10vh",opacity:[0,s.opacity*t,s.opacity*t,0],x:[0,s.swayAmplitude,-s.swayAmplitude,0],rotate:[s.rotation,s.rotation+10,s.rotation-10,s.rotation]},transition:{duration:s.floatDuration,repeat:1/0,ease:"easeInOut",times:[0,.3,.7,1],delay:s.delay},children:f.jsx(Za,{name:"ghost",size:s.size,className:"text-ghostlyWhite"})},s.id))})},OAe=()=>f.jsx(it.div,{className:"fixed bottom-6 right-6 z-50 pointer-events-none",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:1.5,ease:[.16,1,.3,1]},children:f.jsxs(it.div,{className:"relative",animate:{y:[0,-15,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[f.jsx(it.div,{className:"absolute -inset-6 rounded-full pointer-events-none",style:{background:"radial-gradient(circle, rgba(255, 172, 9, 0.15) 0%, transparent 70%)"},animate:{scale:[1,1.3,1],opacity:[.4,.7,.4]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),f.jsx("div",{className:"relative p-2",style:{background:"rgba(255,255,255,0.005)",borderRadius:"50%"},children:f.jsx(it.img,{src:"/happyhalloween/pumpkin02.png",alt:"Pumpkin",className:"w-16 h-16 object-contain",style:{filter:"drop-shadow(0 0 20px rgba(255, 172, 9, 0.6)) drop-shadow(0 0 40px rgba(255, 172, 9, 0.3))"},animate:{rotate:[0,-3,3,-3,0]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}})})]})}),FAe=()=>{const t=Jx();return f.jsx(it.div,{className:"fixed inset-0 pointer-events-none z-40",initial:{opacity:0},animate:{opacity:t?1:0},transition:{duration:2},children:f.jsx("img",{src:"/happyhalloween/spiderWeb.png",alt:"",className:"absolute inset-0 w-full h-full object-cover",style:{mixBlendMode:"screen",opacity:.15}})})},BAe=()=>Jx()?f.jsxs(it.div,{className:"fixed top-0 left-[15%] z-30 pointer-events-none",initial:{y:-200},animate:{y:[-200,150,-200]},transition:{duration:15,repeat:1/0,ease:"easeInOut"},children:[f.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-[1px] h-[200px] -top-[200px]",style:{background:"linear-gradient(to bottom, transparent, rgba(255,255,255,0.2))"}}),f.jsx(it.img,{src:"/happyhalloween/spider.png",alt:"",className:"w-12 h-12 object-contain",style:{filter:"drop-shadow(0 0 10px rgba(0,0,0,0.5))"},animate:{rotate:[0,5,-5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}})]}):null,zAe=()=>{if(!Jx())return null;const e=[{id:1,delay:0,duration:18,startX:280,startY:100,size:12},{id:2,delay:8,duration:22,startX:260,startY:85,size:10},{id:3,delay:15,duration:20,startX:300,startY:110,size:14}];return f.jsx("div",{className:"fixed top-0 left-0 z-50 pointer-events-none overflow-hidden",style:{width:"350px",height:"180px"},children:e.map(n=>f.jsx(it.div,{className:"absolute",style:{fontSize:`${n.size}px`},initial:{x:n.startX,y:n.startY,opacity:0},animate:{x:[n.startX,n.startX-80,n.startX-150,n.startX-200,-60],y:[n.startY,n.startY-15,n.startY-35,n.startY-60,-40],opacity:[0,.8,1,.8,0]},transition:{duration:n.duration,delay:n.delay,repeat:1/0,ease:"linear"},children:f.jsx(it.span,{animate:{y:[0,-4,0,4,0],rotate:[-10,-15,-8,-12,-10],scale:[1,1.05,1,.95,1]},transition:{duration:.8,repeat:1/0,ease:"easeInOut"},style:{display:"block",filter:"drop-shadow(0 0 3px rgba(0,0,0,0.6))",transform:"scaleX(-1)"},children:""})},n.id))})},UAe=[{pattern:/network|fetch|ECONNREFUSED|ETIMEDOUT|ERR_NETWORK/i,message:"Unable to connect. Please check your internet connection and try again."},{pattern:/timeout|timed out/i,message:"The request took too long. Please try again."},{pattern:/401|unauthorized|authentication/i,message:"Please sign in to continue."},{pattern:/403|forbidden|permission/i,message:"You don't have permission to do this."},{pattern:/404|not found/i,message:"The requested resource was not found."},{pattern:/429|rate limit|too many requests/i,message:"Too many requests. Please wait a moment and try again."},{pattern:/500|internal server|server error/i,message:"Something went wrong on our end. Please try again later."},{pattern:/502|bad gateway/i,message:"Service temporarily unavailable. Please try again."},{pattern:/503|service unavailable/i,message:"Service is temporarily down for maintenance."},{pattern:/user rejected|user denied|rejected by user/i,message:"Transaction was cancelled."},{pattern:/insufficient funds|not enough/i,message:"Insufficient funds for this transaction."},{pattern:/wallet.*connect|connect.*wallet/i,message:"Please connect your wallet to continue."},{pattern:/chain.*mismatch|wrong.*network|switch.*network/i,message:"Please switch to the correct network."},{pattern:/nonce|replacement.*underpriced/i,message:"Transaction conflict. Please try again."},{pattern:/gas.*estimate|out of gas/i,message:"Transaction failed. Please try again with more gas."},{pattern:/gemini|ai.*generation|model.*error/i,message:"AI service is temporarily unavailable. Please try again."},{pattern:/quota|limit.*exceeded/i,message:"Service limit reached. Please try again later."},{pattern:/supabase|database|postgres/i,message:"Database error. Please try again."},{pattern:/duplicate|already exists|unique.*constraint/i,message:"This item already exists."},{pattern:/foreign key|reference/i,message:"Related data not found."},{pattern:/invalid|validation|required field/i,message:"Please check your input and try again."},{pattern:/email.*invalid|invalid.*email/i,message:"Please enter a valid email address."},{pattern:/file.*too.*large|size.*exceeded/i,message:"File is too large. Please choose a smaller file."},{pattern:/unsupported.*format|invalid.*type/i,message:"File format not supported."},{pattern:/upload.*failed/i,message:"Upload failed. Please try again."}];function VAe(t){const e=HAe(t);for(const{pattern:n,message:s}of UAe)if(n.test(e))return s;return"Something went wrong. Please try again."}function HAe(t){if(typeof t=="string")return t;if(t instanceof Error)return t.message;if(t&&typeof t=="object"){const e=t;if(e.message&&typeof e.message=="string")return e.message;if(e.error&&typeof e.error=="string")return e.error;if(e.statusText&&typeof e.statusText=="string")return e.statusText}return String(t)}const GAe=({error:t,resetError:e,title:n="Oops! Something spooky happened..."})=>{const s=VAe(t);return f.jsx(it.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex items-center justify-center min-h-[400px] p-8",children:f.jsxs("div",{className:"relative max-w-md w-full p-8 rounded-2xl backdrop-blur-xl border border-white/10 text-center overflow-hidden",style:{background:`linear-gradient(135deg, ${gs.colors.primary.deepPurple}90, ${gs.colors.primary.midnightBlue}95)`,boxShadow:`0 0 40px ${gs.colors.primary.bloodOrange}20`},children:[f.jsx(it.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",animate:{boxShadow:[`inset 0 0 30px ${gs.colors.primary.bloodOrange}10`,`inset 0 0 50px ${gs.colors.primary.bloodOrange}20`,`inset 0 0 30px ${gs.colors.primary.bloodOrange}10`]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),f.jsx(it.div,{className:"relative mb-6 inline-block",animate:{y:[0,-10,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:f.jsx(Za,{name:"ghost",size:80,color:gs.colors.accent.ghostlyWhite})}),f.jsx("h2",{className:"text-2xl font-bold mb-3",style:{color:gs.colors.accent.ghostlyWhite},children:n}),f.jsx("p",{className:"text-base mb-6 opacity-80",style:{color:gs.colors.accent.ghostlyWhite},children:s}),f.jsx("div",{className:"absolute top-4 left-4 opacity-30",children:f.jsx(Za,{name:"cobweb",size:40,color:gs.colors.accent.ghostlyWhite})}),f.jsx("div",{className:"absolute top-4 right-4 opacity-30",style:{transform:"scaleX(-1)"},children:f.jsx(Za,{name:"cobweb",size:40,color:gs.colors.accent.ghostlyWhite})}),f.jsxs("div",{className:"relative flex flex-col sm:flex-row gap-3 justify-center",children:[e&&f.jsx(Vc,{variant:"primary",onClick:e,className:"px-6 py-3",children:f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsx(Za,{name:"potion",size:18}),"Try Again"]})}),f.jsx(Vc,{variant:"ghost",onClick:()=>window.location.reload(),className:"px-6 py-3",children:f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsx(Za,{name:"cauldron",size:18}),"Refresh Page"]})})]}),f.jsx(it.div,{className:"absolute bottom-4 left-1/2 -translate-x-1/2 opacity-20",animate:{scale:[1,1.1,1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:f.jsx(Za,{name:"pumpkin",size:30,color:gs.colors.accent.pumpkinOrange})})]})})};class $Ae extends he.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleReset=()=>{this.setState({hasError:!1,error:null})}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("[ErrorBoundary] Uncaught error:",e),console.error("[ErrorBoundary] Component stack:",n.componentStack)}render(){return this.state.hasError&&this.state.error?this.props.fallback?this.props.fallback:f.jsx(GAe,{error:this.state.error,resetError:this.handleReset}):this.props.children}}function WAe(){const{user:t}=ba();he.useEffect(()=>{if(!(t!=null&&t.id)){console.log("[useActivityTracking] No user ID, skipping tracking");return}console.log("[useActivityTracking] User ID found, starting tracking:",t.id),(async()=>{try{console.log("[useActivityTracking] Tracking page visit:",window.location.pathname),await ZT(t.id,"page_visit",{page:window.location.pathname,referrer:document.referrer||null,timestamp:new Date().toISOString()}),console.log("[useActivityTracking] Page visit tracked successfully")}catch(u){console.error("[useActivityTracking] Failed to track page visit:",u)}})();const n=()=>{!document.hidden&&(t!=null&&t.id)&&(console.log("[useActivityTracking] Tracking page visibility"),ZT(t.id,"page_visible",{page:window.location.pathname,timestamp:new Date().toISOString()}).catch(u=>console.error("[useActivityTracking] Failed to track visibility:",u)))};document.addEventListener("visibilitychange",n);let s=0;const l=()=>{s++,s%10===0&&(t!=null&&t.id)&&(console.log("[useActivityTracking] Tracking user interaction:",s),ZT(t.id,"user_interaction",{type:"click",count:s,page:window.location.pathname}).catch(u=>console.error("[useActivityTracking] Failed to track clicks:",u)))};return document.addEventListener("click",l),()=>{document.removeEventListener("visibilitychange",n),document.removeEventListener("click",l)}},[t==null?void 0:t.id])}function qAe(){return WAe(),f.jsx(w1e,{})}function XAe(){return f.jsx(gve,{children:f.jsxs("div",{className:"relative min-h-screen bg-black overflow-hidden",children:[f.jsx($_e,{position:"top-center",richColors:!0,closeButton:!0,duration:5e3,toastOptions:{style:{background:"rgba(0, 0, 0, 0.9)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"#fff",backdropFilter:"blur(12px)"}}}),f.jsx(jAe,{starCount:15e3,animationSpeed:1,interactionEnabled:!0,enableHalloweenMode:!0}),f.jsx(LAe,{}),f.jsx(FAe,{}),f.jsx(BAe,{}),f.jsx(zAe,{}),f.jsx(OAe,{}),f.jsx("div",{className:"relative z-10",style:{backgroundColor:"transparent"},children:f.jsx($Ae,{children:f.jsx(Bhe,{children:f.jsx(qAe,{})})})})]})})}const Dq=document.getElementById("root");if(!Dq)throw new Error("Could not find root element to mount to");const ZAe=kK.createRoot(Dq);ZAe.render(f.jsx(fe.StrictMode,{children:f.jsx(XAe,{})}));const I8=Object.freeze(Object.defineProperty({__proto__:null,default:Ck},Symbol.toStringTag,{value:"Module"}));export{m3e as $,DK as A,Wn as B,ub as C,Wv as D,yv as E,nU as F,pU as G,V1 as H,Wc as I,lr as J,OY as K,zK as L,d3e as M,e3e as N,hb as O,sh as P,yA as Q,jre as R,nR as S,ow as T,ao as U,T7 as V,y3e as W,g3e as X,x3e as Y,p3e as Z,hr as _,Ux as a,dd as a0,dA as a1,mne as a2,Dx as a3,j7 as a4,Bse as a5,bl as a6,pi as a7,Z5 as a8,ah as a9,hd as aA,AU as aa,r2 as ab,bu as ac,lee as ad,L5 as ae,vP as af,Q0 as ag,Fo as ah,Nte as ai,T9 as aj,Z0 as ak,PP as al,tg as am,ZP as an,ng as ao,gb as ap,wA as aq,_R as ar,kx as as,E9 as at,_x as au,vu as av,uee as aw,Yo as ax,ZK as ay,e2 as az,Ka as b,lR as c,ZJ as d,hee as e,n2 as f,_P as g,f2 as h,d2 as i,lA as j,oh as k,tA as l,qx as m,hf as n,gd as o,QP as p,F7 as q,KAe as r,Kt as s,Wx as t,R9 as u,ih as v,Q5 as w,vK as x,Tp as y,Oa as z};
