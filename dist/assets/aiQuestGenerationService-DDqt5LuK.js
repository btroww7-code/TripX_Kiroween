import{s as l}from"./index-s9rZPGJJ.js";async function $(r,s){try{const{data:e,error:n}=await l.functions.invoke("generate-trip-quests",{body:{attractions:r,tripContext:s}});return n?(console.error("Error generating quests with AI:",n),p(r)):(e==null?void 0:e.quests)||p(r)}catch(e){return console.error("Error in AI quest generation:",e),p(r)}}function p(r){return r.map(s=>{const e=s.rating||4,n=e>=4.5?3:e>=4?2:1,d=n*50+Math.floor(e*20),y=n*15+Math.floor(e*5);return{title:`Visit ${s.name}`,description:s.description||`Explore ${s.name} and capture your experience. Share your adventure with the TripX community!`,difficulty:n,reward_xp:d,reward_tokens:y}})}async function x(r,s,e,n,d){console.log("ðŸ’¾ createQuestsFromGenerated CALLED"),console.log("ðŸ’¾ userId:",r),console.log("ðŸ’¾ tripId:",s),console.log("ðŸ’¾ generatedQuests length:",e.length),console.log("ðŸ’¾ attractions length:",n.length);const q=[...e.map((t,o)=>({...t,index:o}))].sort((t,o)=>o.difficulty-t.difficulty),h=Math.max(1,Math.ceil(e.length/3)),m=new Set(q.slice(0,h).map(t=>t.index));console.log(`ðŸ’Ž NFT rewards for ${h}/${e.length} hardest quests`);const g=[];for(let t=0;t<e.length;t++){const o=e[t],i=n[t],w=d[t]||1;if(console.log(`ðŸ’¾ [${t+1}/${e.length}] Creating: ${o.title}`),!i||!i.coordinates){console.log(`âš ï¸  Skipping quest ${t} - no attraction or coordinates`);continue}try{const c=m.has(t);console.log(`ðŸ’¾ Inserting quest into database... (NFT reward: ${c})`);const{data:a,error:f}=await l.from("quests").insert({title:o.title,description:o.description,location:i.name,latitude:i.coordinates.lat,longitude:i.coordinates.lng,difficulty:o.difficulty,reward_xp:o.reward_xp,reward_tokens:o.reward_tokens,quest_type:"standard",category:i.type==="restaurant"?"food":i.type==="museum"?"culture":i.type==="park"?"nature":"culture",creator_id:r,is_active:!0,nft_reward:c}).select().single();if(f&&console.error("âŒ Error creating quest:",f),!f&&a){console.log(`âœ… Quest created successfully: ${a.id}`),g.push(a.id),console.log("ðŸ”— Linking quest to trip..."),await l.from("trip_quests").insert({trip_id:s,quest_id:a.id,day_number:w,order_in_day:t+1});try{console.log(`ðŸ‘¤ Auto-assigning quest to user ${r}...`);const{error:u}=await l.from("user_quests").insert({user_id:r,quest_id:a.id,status:"pending",created_at:new Date().toISOString()});u?console.error("âŒ Could not auto-assign quest:",u):console.log(`âœ… Auto-assigned quest "${a.title}" to user`)}catch(u){console.error("âš ï¸  Could not auto-assign quest to user:",u)}}}catch(c){console.error(`âŒ Error creating quest: ${o.title}`,c)}}return console.log(`ðŸ createQuestsFromGenerated DONE: ${g.length} quests created`),g}export{x as createQuestsFromGenerated,$ as generateTripQuests};
